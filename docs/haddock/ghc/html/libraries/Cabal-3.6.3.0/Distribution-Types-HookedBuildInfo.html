<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Distribution.Types.HookedBuildInfo</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">Cabal-3.6.3.0: A framework for packaging Haskell software</span><ul class="links" id="page-menu"><li><a href="src/Distribution.Types.HookedBuildInfo.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Distribution.Types.HookedBuildInfo</p></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">type</span> <a href="#t:HookedBuildInfo">HookedBuildInfo</a> = (<a href="Distribution-Compat-Prelude-Internal.html#t:Maybe" title="Distribution.Compat.Prelude.Internal">Maybe</a> <a href="Distribution-Types-BuildInfo.html#t:BuildInfo" title="Distribution.Types.BuildInfo">BuildInfo</a>, [(<a href="Distribution-Types-UnqualComponentName.html#t:UnqualComponentName" title="Distribution.Types.UnqualComponentName">UnqualComponentName</a>, <a href="Distribution-Types-BuildInfo.html#t:BuildInfo" title="Distribution.Types.BuildInfo">BuildInfo</a>)])</li><li class="src short"><a href="#v:emptyHookedBuildInfo">emptyHookedBuildInfo</a> :: <a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:HookedBuildInfo" class="def">HookedBuildInfo</a> = (<a href="Distribution-Compat-Prelude-Internal.html#t:Maybe" title="Distribution.Compat.Prelude.Internal">Maybe</a> <a href="Distribution-Types-BuildInfo.html#t:BuildInfo" title="Distribution.Types.BuildInfo">BuildInfo</a>, [(<a href="Distribution-Types-UnqualComponentName.html#t:UnqualComponentName" title="Distribution.Types.UnqualComponentName">UnqualComponentName</a>, <a href="Distribution-Types-BuildInfo.html#t:BuildInfo" title="Distribution.Types.BuildInfo">BuildInfo</a>)]) <a href="src/Distribution.Types.HookedBuildInfo.html#HookedBuildInfo" class="link">Source</a> <a href="#t:HookedBuildInfo" class="selflink">#</a></p><div class="doc"><p><code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> is mechanism that hooks can use to
 override the <code><a href="Distribution-Types-BuildInfo.html#t:BuildInfo" title="Distribution.Types.BuildInfo">BuildInfo</a></code>s inside packages.  One example
 use-case (which is used in core libraries today) is as
 a way of passing flags which are computed by a configure
 script into Cabal.  In this case, the autoconf build type adds
 hooks to read in a textual <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> format prior
 to doing any operations.</p><p>Quite honestly, this mechanism is a massive hack since we shouldn't
 be editing the <code>PackageDescription</code> data structure (it's easy
 to assume that this data structure shouldn't change and
 run into bugs, see for example 1c20a6328579af9e37677d507e2e9836ef70ab9d).
 But it's a bit convenient, because there isn't another data
 structure that allows adding extra <code><a href="Distribution-Types-BuildInfo.html#t:BuildInfo" title="Distribution.Types.BuildInfo">BuildInfo</a></code> style things.</p><p>In any case, a lot of care has to be taken to make sure the
 <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> is applied to the <code>PackageDescription</code>.  In
 general this process occurs in <a href="Distribution-Simple.html">Distribution.Simple</a>, which is
 responsible for orchestrating the hooks mechanism.  The
 general strategy:</p><ol><li>We run the pre-hook, which produces a <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code>
         (e.g., in the Autoconf case, it reads it out from a file).</li><li>We sanity-check the hooked build info with
         <code>sanityCheckHookedBuildInfo</code>.</li><li>We update our <code>PackageDescription</code> (either freshly read
         or cached from <code>LocalBuildInfo</code>) with <code>updatePackageDescription</code>.</li></ol><p>In principle, we are also supposed to update the copy of
         the <code>PackageDescription</code> stored in <code>LocalBuildInfo</code>
         at <code>localPkgDescr</code>.  Unfortunately, in practice, there
         are lots of Custom setup scripts which fail to update
         <code>localPkgDescr</code> so you really shouldn't rely on it.
         It's not DEPRECATED because there are legitimate uses
         for it, but... yeah.  Sharp knife.  See
         <a href="https://github.com/haskell/cabal/issues/3606">https://github.com/haskell/cabal/issues/3606</a>
         for more information on the issue.</p><p>It is not well-specified whether or not a <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> applied
 at configure time is persistent to the <code>LocalBuildInfo</code>.  The
 fact that <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> is passed to <code>confHook</code> MIGHT SUGGEST
 that the <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> is applied at this time, but actually
 since 9317b67e6122ab14e53f81b573bd0ecb388eca5a it has been ONLY used
 to create a modified package description that we check for problems:
 it is never actually saved to the LBI.  Since <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> is
 applied monoidally to the existing build infos (and it is not an
 idempotent monoid), it could break things to save it, since we
 are obligated to apply any new <code><a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a></code> and then we'd
 get the effect twice.  But this does mean we have to re-apply
 it every time. Hey, it's more flexibility.</p></div></div><div class="top"><p class="src"><a id="v:emptyHookedBuildInfo" class="def">emptyHookedBuildInfo</a> :: <a href="Distribution-Types-HookedBuildInfo.html#t:HookedBuildInfo" title="Distribution.Types.HookedBuildInfo">HookedBuildInfo</a> <a href="src/Distribution.Types.HookedBuildInfo.html#emptyHookedBuildInfo" class="link">Source</a> <a href="#v:emptyHookedBuildInfo" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>
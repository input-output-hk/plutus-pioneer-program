<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Text/Read/Lex.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE Trustworthy #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE NoImplicitPrelude #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-5"></a><span class='hs-comment'>-- |</span>
<a name="line-6"></a><span class='hs-comment'>-- Module      :  Text.Read.Lex</span>
<a name="line-7"></a><span class='hs-comment'>-- Copyright   :  (c) The University of Glasgow 2002</span>
<a name="line-8"></a><span class='hs-comment'>-- License     :  BSD-style (see the file libraries/base/LICENSE)</span>
<a name="line-9"></a><span class='hs-comment'>--</span>
<a name="line-10"></a><span class='hs-comment'>-- Maintainer  :  libraries@haskell.org</span>
<a name="line-11"></a><span class='hs-comment'>-- Stability   :  provisional</span>
<a name="line-12"></a><span class='hs-comment'>-- Portability :  non-portable (uses Text.ParserCombinators.ReadP)</span>
<a name="line-13"></a><span class='hs-comment'>--</span>
<a name="line-14"></a><span class='hs-comment'>-- The cut-down Haskell lexer, used by Text.Read</span>
<a name="line-15"></a><span class='hs-comment'>--</span>
<a name="line-16"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Text.Read.Lex</span>
<a name="line-19"></a>  <span class='hs-comment'>-- lexing types</span>
<a name="line-20"></a>  <span class='hs-layout'>(</span> <span class='hs-conid'>Lexeme</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Number</span>
<a name="line-21"></a>
<a name="line-22"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>numberToInteger</span><span class='hs-layout'>,</span> <span class='hs-varid'>numberToFixed</span><span class='hs-layout'>,</span> <span class='hs-varid'>numberToRational</span><span class='hs-layout'>,</span> <span class='hs-varid'>numberToRangedRational</span>
<a name="line-23"></a>
<a name="line-24"></a>  <span class='hs-comment'>-- lexer</span>
<a name="line-25"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>lex</span><span class='hs-layout'>,</span> <span class='hs-varid'>expect</span>
<a name="line-26"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>hsLex</span>
<a name="line-27"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>lexChar</span>
<a name="line-28"></a>
<a name="line-29"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>readBinP</span>
<a name="line-30"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>readIntP</span>
<a name="line-31"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>readOctP</span>
<a name="line-32"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>readDecP</span>
<a name="line-33"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>readHexP</span>
<a name="line-34"></a>
<a name="line-35"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>isSymbolChar</span>
<a name="line-36"></a>  <span class='hs-layout'>)</span>
<a name="line-37"></a> <span class='hs-keyword'>where</span>
<a name="line-38"></a>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text.ParserCombinators.ReadP</span>
<a name="line-40"></a>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Base</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Char</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Num</span><span class='hs-layout'>(</span> <span class='hs-conid'>Num</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Integer</span> <span class='hs-layout'>)</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Show</span><span class='hs-layout'>(</span> <span class='hs-conid'>Show</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unicode</span>
<a name="line-46"></a>  <span class='hs-layout'>(</span> <span class='hs-conid'>GeneralCategory</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>generalCategory</span><span class='hs-layout'>,</span> <span class='hs-varid'>isSpace</span><span class='hs-layout'>,</span> <span class='hs-varid'>isAlpha</span><span class='hs-layout'>,</span> <span class='hs-varid'>isAlphaNum</span> <span class='hs-layout'>)</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Real</span><span class='hs-layout'>(</span> <span class='hs-conid'>Rational</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>%</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromIntegral</span><span class='hs-layout'>,</span> <span class='hs-conid'>Integral</span><span class='hs-layout'>,</span>
<a name="line-48"></a>                 <span class='hs-varid'>toInteger</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>^</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>quot</span><span class='hs-layout'>,</span> <span class='hs-varid'>even</span> <span class='hs-layout'>)</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.List</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Enum</span><span class='hs-layout'>(</span> <span class='hs-varid'>minBound</span><span class='hs-layout'>,</span> <span class='hs-varid'>maxBound</span> <span class='hs-layout'>)</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Maybe</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="guard"></a><span class='hs-comment'>-- local copy to break import-cycle</span>
<a name="line-54"></a><span class='hs-comment'>-- | @'guard' b@ is @'return' ()@ if @b@ is 'True',</span>
<a name="line-55"></a><span class='hs-comment'>-- and 'mzero' if @b@ is 'False'.</span>
<a name="line-56"></a><span class='hs-definition'>guard</span>           <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonadPlus</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-57"></a><span class='hs-definition'>guard</span> <span class='hs-conid'>True</span>      <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-58"></a><span class='hs-definition'>guard</span> <span class='hs-conid'>False</span>     <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>mzero</span>
<a name="line-59"></a>
<a name="line-60"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-61"></a><span class='hs-comment'>-- Lexing types</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="Lexeme"></a><span class='hs-comment'>-- ^ Haskell lexemes.</span>
<a name="line-64"></a><a name="Lexeme"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Lexeme</span>
<a name="line-65"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Char</span>   <span class='hs-conid'>Char</span>         <span class='hs-comment'>-- ^ Character literal</span>
<a name="line-66"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>String</span> <span class='hs-conid'>String</span>       <span class='hs-comment'>-- ^ String literal, with escapes interpreted</span>
<a name="line-67"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Punc</span>   <span class='hs-conid'>String</span>       <span class='hs-comment'>-- ^ Punctuation or reserved symbol, e.g. @(@, @::@</span>
<a name="line-68"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Ident</span>  <span class='hs-conid'>String</span>       <span class='hs-comment'>-- ^ Haskell identifier, e.g. @foo@, @Baz@</span>
<a name="line-69"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Symbol</span> <span class='hs-conid'>String</span>       <span class='hs-comment'>-- ^ Haskell symbol, e.g. @&gt;&gt;@, @:%@</span>
<a name="line-70"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Number</span> <span class='hs-conid'>Number</span>       <span class='hs-comment'>-- ^ @since 4.6.0.0</span>
<a name="line-71"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EOF</span>
<a name="line-72"></a> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span>   <span class='hs-comment'>-- ^ @since 2.01</span>
<a name="line-73"></a>          <span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-comment'>-- ^ @since 2.01</span>
<a name="line-74"></a>          <span class='hs-layout'>)</span>
<a name="line-75"></a>
<a name="line-76"></a><a name="Number"></a><span class='hs-comment'>-- | @since 4.6.0.0</span>
<a name="line-77"></a><a name="Number"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Number</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkNumber</span> <span class='hs-conid'>Int</span>              <span class='hs-comment'>-- Base</span>
<a name="line-78"></a>                       <span class='hs-conid'>Digits</span>           <span class='hs-comment'>-- Integral part</span>
<a name="line-79"></a>            <span class='hs-keyglyph'>|</span> <span class='hs-conid'>MkDecimal</span> <span class='hs-conid'>Digits</span>          <span class='hs-comment'>-- Integral part</span>
<a name="line-80"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Digits</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Fractional part</span>
<a name="line-81"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Exponent</span>
<a name="line-82"></a> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span>   <span class='hs-comment'>-- ^ @since 4.6.0.0</span>
<a name="line-83"></a>          <span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-comment'>-- ^ @since 4.6.0.0</span>
<a name="line-84"></a>          <span class='hs-layout'>)</span>
<a name="line-85"></a>
<a name="line-86"></a><a name="numberToInteger"></a><span class='hs-comment'>-- | @since 4.5.1.0</span>
<a name="line-87"></a><span class='hs-definition'>numberToInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Number</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Integer</span>
<a name="line-88"></a><span class='hs-definition'>numberToInteger</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkNumber</span> <span class='hs-varid'>base</span> <span class='hs-varid'>iPart</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>val</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>base</span><span class='hs-layout'>)</span> <span class='hs-varid'>iPart</span><span class='hs-layout'>)</span>
<a name="line-89"></a><span class='hs-definition'>numberToInteger</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkDecimal</span> <span class='hs-varid'>iPart</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>val</span> <span class='hs-num'>10</span> <span class='hs-varid'>iPart</span><span class='hs-layout'>)</span>
<a name="line-90"></a><span class='hs-definition'>numberToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="numberToFixed"></a><span class='hs-comment'>-- | @since 4.7.0.0</span>
<a name="line-93"></a><span class='hs-definition'>numberToFixed</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Number</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span><span class='hs-layout'>,</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
<a name="line-94"></a><span class='hs-definition'>numberToFixed</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkNumber</span> <span class='hs-varid'>base</span> <span class='hs-varid'>iPart</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>val</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>base</span><span class='hs-layout'>)</span> <span class='hs-varid'>iPart</span><span class='hs-layout'>,</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>
<a name="line-95"></a><span class='hs-definition'>numberToFixed</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkDecimal</span> <span class='hs-varid'>iPart</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>val</span> <span class='hs-num'>10</span> <span class='hs-varid'>iPart</span><span class='hs-layout'>,</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>
<a name="line-96"></a><span class='hs-definition'>numberToFixed</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkDecimal</span> <span class='hs-varid'>iPart</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>fPart</span><span class='hs-layout'>)</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-97"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val</span> <span class='hs-num'>10</span> <span class='hs-varid'>iPart</span>
<a name="line-98"></a>          <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val</span> <span class='hs-num'>10</span> <span class='hs-layout'>(</span><span class='hs-varid'>integerTake</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>fPart</span> <span class='hs-varop'>++</span> <span class='hs-varid'>repeat</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-99"></a>          <span class='hs-comment'>-- Sigh, we really want genericTake, but that's above us in</span>
<a name="line-100"></a>          <span class='hs-comment'>-- the hierarchy, so we define our own version here (actually</span>
<a name="line-101"></a>          <span class='hs-comment'>-- specialised to Integer)</span>
<a name="line-102"></a>          <span class='hs-varid'>integerTake</span>             <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-103"></a>          <span class='hs-varid'>integerTake</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-104"></a>          <span class='hs-varid'>integerTake</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span>        <span class='hs-keyglyph'>=</span>  <span class='hs-conid'>[]</span>
<a name="line-105"></a>          <span class='hs-varid'>integerTake</span> <span class='hs-varid'>n</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>x</span> <span class='hs-conop'>:</span> <span class='hs-varid'>integerTake</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-106"></a>      <span class='hs-keyword'>in</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-107"></a><span class='hs-definition'>numberToFixed</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-108"></a>
<a name="line-109"></a><a name="numberToRangedRational"></a><span class='hs-comment'>-- This takes a floatRange, and if the Rational would be outside of</span>
<a name="line-110"></a><span class='hs-comment'>-- the floatRange then it may return Nothing. Not that it will not</span>
<a name="line-111"></a><span class='hs-comment'>-- /necessarily/ return Nothing, but it is good enough to fix the</span>
<a name="line-112"></a><span class='hs-comment'>-- space problems in #5688</span>
<a name="line-113"></a><span class='hs-comment'>-- Ways this is conservative:</span>
<a name="line-114"></a><span class='hs-comment'>-- * the floatRange is in base 2, but we pretend it is in base 10</span>
<a name="line-115"></a><span class='hs-comment'>-- * we pad the floateRange a bit, just in case it is very small</span>
<a name="line-116"></a><span class='hs-comment'>--   and we would otherwise hit an edge case</span>
<a name="line-117"></a><span class='hs-comment'>-- * We only worry about numbers that have an exponent. If they don't</span>
<a name="line-118"></a><span class='hs-comment'>--   have an exponent then the Rational won't be much larger than the</span>
<a name="line-119"></a><span class='hs-comment'>--   Number, so there is no problem</span>
<a name="line-120"></a><span class='hs-comment'>-- | @since 4.5.1.0</span>
<a name="line-121"></a><span class='hs-definition'>numberToRangedRational</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Number</span>
<a name="line-122"></a>                       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Rational</span> <span class='hs-comment'>-- Nothing = Inf</span>
<a name="line-123"></a><span class='hs-definition'>numberToRangedRational</span> <span class='hs-layout'>(</span><span class='hs-varid'>neg</span><span class='hs-layout'>,</span> <span class='hs-varid'>pos</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>MkDecimal</span> <span class='hs-varid'>iPart</span> <span class='hs-varid'>mFPart</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-124"></a>    <span class='hs-comment'>-- if exp is out of integer bounds,</span>
<a name="line-125"></a>    <span class='hs-comment'>-- then the number is definitely out of range</span>
<a name="line-126"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>exp</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-layout'>(</span><span class='hs-varid'>maxBound</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-varop'>||</span>
<a name="line-127"></a>      <span class='hs-varid'>exp</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-layout'>(</span><span class='hs-varid'>minBound</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-128"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-129"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-130"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>mFirstDigit</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>dropWhile</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-varid'>iPart</span> <span class='hs-keyword'>of</span>
<a name="line-131"></a>                        <span class='hs-varid'>iPart'</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>iPart'</span><span class='hs-layout'>)</span>
<a name="line-132"></a>                        <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mFPart</span> <span class='hs-keyword'>of</span>
<a name="line-133"></a>                              <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-134"></a>                              <span class='hs-conid'>Just</span> <span class='hs-varid'>fPart</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-135"></a>                                  <span class='hs-keyword'>case</span> <span class='hs-varid'>span</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-varid'>fPart</span> <span class='hs-keyword'>of</span>
<a name="line-136"></a>                                  <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-137"></a>                                  <span class='hs-layout'>(</span><span class='hs-varid'>zeroes</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-138"></a>                                      <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>negate</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>zeroes</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-139"></a>      <span class='hs-keyword'>in</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mFirstDigit</span> <span class='hs-keyword'>of</span>
<a name="line-140"></a>         <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-num'>0</span>
<a name="line-141"></a>         <span class='hs-conid'>Just</span> <span class='hs-varid'>firstDigit</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-142"></a>             <span class='hs-keyword'>let</span> <span class='hs-varid'>firstDigit'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>firstDigit</span> <span class='hs-varop'>+</span> <span class='hs-varid'>fromInteger</span> <span class='hs-varid'>exp</span>
<a name="line-143"></a>             <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>firstDigit'</span> <span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>+</span> <span class='hs-num'>3</span><span class='hs-layout'>)</span>
<a name="line-144"></a>                <span class='hs-keyword'>then</span> <span class='hs-conid'>Nothing</span>
<a name="line-145"></a>                <span class='hs-keyword'>else</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>firstDigit'</span> <span class='hs-varop'>&lt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>neg</span> <span class='hs-comment'>-</span> <span class='hs-num'>3</span><span class='hs-layout'>)</span>
<a name="line-146"></a>                <span class='hs-keyword'>then</span> <span class='hs-conid'>Just</span> <span class='hs-num'>0</span>
<a name="line-147"></a>                <span class='hs-keyword'>else</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>numberToRational</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-148"></a><span class='hs-definition'>numberToRangedRational</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>numberToRational</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-149"></a>
<a name="line-150"></a><a name="numberToRational"></a><span class='hs-comment'>-- | @since 4.6.0.0</span>
<a name="line-151"></a><span class='hs-definition'>numberToRational</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Number</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span>
<a name="line-152"></a><span class='hs-definition'>numberToRational</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkNumber</span> <span class='hs-varid'>base</span> <span class='hs-varid'>iPart</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>base</span><span class='hs-layout'>)</span> <span class='hs-varid'>iPart</span> <span class='hs-varop'>%</span> <span class='hs-num'>1</span>
<a name="line-153"></a><span class='hs-definition'>numberToRational</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkDecimal</span> <span class='hs-varid'>iPart</span> <span class='hs-varid'>mFPart</span> <span class='hs-varid'>mExp</span><span class='hs-layout'>)</span>
<a name="line-154"></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val</span> <span class='hs-num'>10</span> <span class='hs-varid'>iPart</span>
<a name="line-155"></a>   <span class='hs-keyword'>in</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>mFPart</span><span class='hs-layout'>,</span> <span class='hs-varid'>mExp</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-156"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>i</span> <span class='hs-varop'>%</span> <span class='hs-num'>1</span>
<a name="line-157"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-158"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>exp</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>*</span> <span class='hs-layout'>(</span><span class='hs-num'>10</span> <span class='hs-varop'>^</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>%</span> <span class='hs-num'>1</span>
<a name="line-159"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>i</span> <span class='hs-varop'>%</span> <span class='hs-layout'>(</span><span class='hs-num'>10</span> <span class='hs-varop'>^</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-160"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>fPart</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fracExp</span> <span class='hs-num'>0</span>   <span class='hs-varid'>i</span> <span class='hs-varid'>fPart</span>
<a name="line-161"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>fPart</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fracExp</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>i</span> <span class='hs-varid'>fPart</span>
<a name="line-162"></a>      <span class='hs-comment'>-- fracExp is a bit more efficient in calculating the Rational.</span>
<a name="line-163"></a>      <span class='hs-comment'>-- Instead of calculating the fractional part alone, then</span>
<a name="line-164"></a>      <span class='hs-comment'>-- adding the integral part and finally multiplying with</span>
<a name="line-165"></a>      <span class='hs-comment'>-- 10 ^ exp if an exponent was given, do it all at once.</span>
<a name="line-166"></a>
<a name="line-167"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-168"></a><span class='hs-comment'>-- Lexing</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="lex"></a><span class='hs-definition'>lex</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-171"></a><span class='hs-definition'>lex</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>skipSpaces</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>lexToken</span>
<a name="line-172"></a>
<a name="line-173"></a><a name="expect"></a><span class='hs-comment'>-- | @since 4.7.0.0</span>
<a name="line-174"></a><span class='hs-definition'>expect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lexeme</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>()</span>
<a name="line-175"></a><span class='hs-definition'>expect</span> <span class='hs-varid'>lexeme</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>skipSpaces</span>
<a name="line-176"></a>                   <span class='hs-layout'>;</span> <span class='hs-varid'>thing</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexToken</span>
<a name="line-177"></a>                   <span class='hs-layout'>;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>thing</span> <span class='hs-varop'>==</span> <span class='hs-varid'>lexeme</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>pfail</span> <span class='hs-layout'>}</span>
<a name="line-178"></a>
<a name="line-179"></a><a name="hsLex"></a><span class='hs-definition'>hsLex</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>String</span>
<a name="line-180"></a><span class='hs-comment'>-- ^ Haskell lexer: returns the lexed string, rather than the lexeme</span>
<a name="line-181"></a><span class='hs-definition'>hsLex</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>skipSpaces</span>
<a name="line-182"></a>           <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>gather</span> <span class='hs-varid'>lexToken</span>
<a name="line-183"></a>           <span class='hs-varid'>return</span> <span class='hs-varid'>s</span>
<a name="line-184"></a>
<a name="line-185"></a><a name="lexToken"></a><span class='hs-definition'>lexToken</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-186"></a><span class='hs-definition'>lexToken</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lexEOF</span>     <span class='hs-varop'>+++</span>
<a name="line-187"></a>           <span class='hs-varid'>lexLitChar</span> <span class='hs-varop'>+++</span>
<a name="line-188"></a>           <span class='hs-varid'>lexString</span>  <span class='hs-varop'>+++</span>
<a name="line-189"></a>           <span class='hs-varid'>lexPunc</span>    <span class='hs-varop'>+++</span>
<a name="line-190"></a>           <span class='hs-varid'>lexSymbol</span>  <span class='hs-varop'>+++</span>
<a name="line-191"></a>           <span class='hs-varid'>lexId</span>      <span class='hs-varop'>+++</span>
<a name="line-192"></a>           <span class='hs-varid'>lexNumber</span>
<a name="line-193"></a>
<a name="line-194"></a>
<a name="line-195"></a><a name="lexEOF"></a><span class='hs-comment'>-- ----------------------------------------------------------------------</span>
<a name="line-196"></a><span class='hs-comment'>-- End of file</span>
<a name="line-197"></a><span class='hs-definition'>lexEOF</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-198"></a><span class='hs-definition'>lexEOF</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>look</span>
<a name="line-199"></a>            <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-200"></a>            <span class='hs-varid'>return</span> <span class='hs-conid'>EOF</span>
<a name="line-201"></a>
<a name="line-202"></a><span class='hs-comment'>-- ---------------------------------------------------------------------------</span>
<a name="line-203"></a><span class='hs-comment'>-- Single character lexemes</span>
<a name="line-204"></a>
<a name="line-205"></a><a name="lexPunc"></a><span class='hs-definition'>lexPunc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-206"></a><span class='hs-definition'>lexPunc</span> <span class='hs-keyglyph'>=</span>
<a name="line-207"></a>  <span class='hs-keyword'>do</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>satisfy</span> <span class='hs-varid'>isPuncChar</span>
<a name="line-208"></a>     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Punc</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-209"></a>
<a name="line-210"></a><a name="isPuncChar"></a><span class='hs-comment'>-- | The @special@ character class as defined in the Haskell Report.</span>
<a name="line-211"></a><span class='hs-definition'>isPuncChar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-212"></a><span class='hs-definition'>isPuncChar</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`elem`</span> <span class='hs-str'>",;()[]{}`"</span>
<a name="line-213"></a>
<a name="line-214"></a><span class='hs-comment'>-- ----------------------------------------------------------------------</span>
<a name="line-215"></a><span class='hs-comment'>-- Symbols</span>
<a name="line-216"></a>
<a name="line-217"></a><a name="lexSymbol"></a><span class='hs-definition'>lexSymbol</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-218"></a><span class='hs-definition'>lexSymbol</span> <span class='hs-keyglyph'>=</span>
<a name="line-219"></a>  <span class='hs-keyword'>do</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>munch1</span> <span class='hs-varid'>isSymbolChar</span>
<a name="line-220"></a>     <span class='hs-keyword'>if</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>reserved_ops</span> <span class='hs-keyword'>then</span>
<a name="line-221"></a>        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Punc</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- Reserved-ops count as punctuation</span>
<a name="line-222"></a>      <span class='hs-keyword'>else</span>
<a name="line-223"></a>        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Symbol</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-224"></a>  <span class='hs-keyword'>where</span>
<a name="line-225"></a>    <span class='hs-varid'>reserved_ops</span>   <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>".."</span><span class='hs-layout'>,</span> <span class='hs-str'>"::"</span><span class='hs-layout'>,</span> <span class='hs-str'>"="</span><span class='hs-layout'>,</span> <span class='hs-str'>"\\"</span><span class='hs-layout'>,</span> <span class='hs-str'>"|"</span><span class='hs-layout'>,</span> <span class='hs-str'>"&lt;-"</span><span class='hs-layout'>,</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>,</span> <span class='hs-str'>"@"</span><span class='hs-layout'>,</span> <span class='hs-str'>"~"</span><span class='hs-layout'>,</span> <span class='hs-str'>"=&gt;"</span><span class='hs-keyglyph'>]</span>
<a name="line-226"></a>
<a name="line-227"></a><a name="isSymbolChar"></a><span class='hs-definition'>isSymbolChar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-228"></a><span class='hs-definition'>isSymbolChar</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isPuncChar</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>generalCategory</span> <span class='hs-varid'>c</span> <span class='hs-keyword'>of</span>
<a name="line-229"></a>    <span class='hs-conid'>MathSymbol</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-230"></a>    <span class='hs-conid'>CurrencySymbol</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-231"></a>    <span class='hs-conid'>ModifierSymbol</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-232"></a>    <span class='hs-conid'>OtherSymbol</span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-233"></a>    <span class='hs-conid'>DashPunctuation</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-234"></a>    <span class='hs-conid'>OtherPunctuation</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-varop'>`elem`</span> <span class='hs-str'>"'\""</span><span class='hs-layout'>)</span>
<a name="line-235"></a>    <span class='hs-conid'>ConnectorPunctuation</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>/=</span> <span class='hs-chr'>'_'</span>
<a name="line-236"></a>    <span class='hs-keyword'>_</span>                       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-237"></a><span class='hs-comment'>-- ----------------------------------------------------------------------</span>
<a name="line-238"></a><span class='hs-comment'>-- identifiers</span>
<a name="line-239"></a>
<a name="line-240"></a><a name="lexId"></a><span class='hs-definition'>lexId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-241"></a><span class='hs-definition'>lexId</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>satisfy</span> <span class='hs-varid'>isIdsChar</span>
<a name="line-242"></a>           <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>munch</span> <span class='hs-varid'>isIdfChar</span>
<a name="line-243"></a>           <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ident</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-244"></a>  <span class='hs-keyword'>where</span>
<a name="line-245"></a>          <span class='hs-comment'>-- Identifiers can start with a '_'</span>
<a name="line-246"></a>    <span class='hs-varid'>isIdsChar</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isAlpha</span> <span class='hs-varid'>c</span> <span class='hs-varop'>||</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'_'</span>
<a name="line-247"></a>    <span class='hs-varid'>isIdfChar</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isAlphaNum</span> <span class='hs-varid'>c</span> <span class='hs-varop'>||</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`elem`</span> <span class='hs-str'>"_'"</span>
<a name="line-248"></a>
<a name="line-249"></a><span class='hs-comment'>-- ---------------------------------------------------------------------------</span>
<a name="line-250"></a><span class='hs-comment'>-- Lexing character literals</span>
<a name="line-251"></a>
<a name="line-252"></a><a name="lexLitChar"></a><span class='hs-definition'>lexLitChar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-253"></a><span class='hs-definition'>lexLitChar</span> <span class='hs-keyglyph'>=</span>
<a name="line-254"></a>  <span class='hs-keyword'>do</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span>
<a name="line-255"></a>     <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>esc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexCharE</span>
<a name="line-256"></a>     <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>esc</span> <span class='hs-varop'>||</span> <span class='hs-varid'>c</span> <span class='hs-varop'>/=</span> <span class='hs-chr'>'\''</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- Eliminate '' possibility</span>
<a name="line-257"></a>     <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span>
<a name="line-258"></a>     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-259"></a>
<a name="line-260"></a><a name="lexChar"></a><span class='hs-definition'>lexChar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Char</span>
<a name="line-261"></a><span class='hs-definition'>lexChar</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexCharE</span><span class='hs-layout'>;</span> <span class='hs-varid'>consumeEmpties</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>c</span> <span class='hs-layout'>}</span>
<a name="line-262"></a>    <span class='hs-keyword'>where</span>
<a name="line-263"></a>    <span class='hs-comment'>-- Consumes the string "\&amp;" repeatedly and greedily (will only produce one match)</span>
<a name="line-264"></a>    <span class='hs-varid'>consumeEmpties</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>()</span>
<a name="line-265"></a>    <span class='hs-varid'>consumeEmpties</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-266"></a>        <span class='hs-varid'>rest</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>look</span>
<a name="line-267"></a>        <span class='hs-keyword'>case</span> <span class='hs-varid'>rest</span> <span class='hs-keyword'>of</span>
<a name="line-268"></a>            <span class='hs-layout'>(</span><span class='hs-chr'>'\\'</span><span class='hs-conop'>:</span><span class='hs-chr'>'&amp;'</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>string</span> <span class='hs-str'>"\\&amp;"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>consumeEmpties</span>
<a name="line-269"></a>            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-270"></a>
<a name="line-271"></a>
<a name="line-272"></a><a name="lexCharE"></a><span class='hs-definition'>lexCharE</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span><span class='hs-layout'>,</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- "escaped or not"?</span>
<a name="line-273"></a><span class='hs-definition'>lexCharE</span> <span class='hs-keyglyph'>=</span>
<a name="line-274"></a>  <span class='hs-keyword'>do</span> <span class='hs-varid'>c1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span>
<a name="line-275"></a>     <span class='hs-keyword'>if</span> <span class='hs-varid'>c1</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'\\'</span>
<a name="line-276"></a>       <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>c2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexEsc</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>c2</span><span class='hs-layout'>,</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-277"></a>       <span class='hs-keyword'>else</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>c1</span><span class='hs-layout'>,</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-278"></a> <span class='hs-keyword'>where</span>
<a name="line-279"></a>  <span class='hs-varid'>lexEsc</span> <span class='hs-keyglyph'>=</span>
<a name="line-280"></a>    <span class='hs-varid'>lexEscChar</span>
<a name="line-281"></a>      <span class='hs-varop'>+++</span> <span class='hs-varid'>lexNumeric</span>
<a name="line-282"></a>        <span class='hs-varop'>+++</span> <span class='hs-varid'>lexCntrlChar</span>
<a name="line-283"></a>          <span class='hs-varop'>+++</span> <span class='hs-varid'>lexAscii</span>
<a name="line-284"></a>
<a name="line-285"></a>  <span class='hs-varid'>lexEscChar</span> <span class='hs-keyglyph'>=</span>
<a name="line-286"></a>    <span class='hs-keyword'>do</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span>
<a name="line-287"></a>       <span class='hs-keyword'>case</span> <span class='hs-varid'>c</span> <span class='hs-keyword'>of</span>
<a name="line-288"></a>         <span class='hs-chr'>'a'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\a'</span>
<a name="line-289"></a>         <span class='hs-chr'>'b'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\b'</span>
<a name="line-290"></a>         <span class='hs-chr'>'f'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\f'</span>
<a name="line-291"></a>         <span class='hs-chr'>'n'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\n'</span>
<a name="line-292"></a>         <span class='hs-chr'>'r'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\r'</span>
<a name="line-293"></a>         <span class='hs-chr'>'t'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\t'</span>
<a name="line-294"></a>         <span class='hs-chr'>'v'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\v'</span>
<a name="line-295"></a>         <span class='hs-chr'>'\\'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\\'</span>
<a name="line-296"></a>         <span class='hs-chr'>'\"'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\"'</span>
<a name="line-297"></a>         <span class='hs-chr'>'\''</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\''</span>
<a name="line-298"></a>         <span class='hs-keyword'>_</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pfail</span>
<a name="line-299"></a>
<a name="line-300"></a>  <span class='hs-varid'>lexNumeric</span> <span class='hs-keyglyph'>=</span>
<a name="line-301"></a>    <span class='hs-keyword'>do</span> <span class='hs-varid'>base</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexBaseChar</span> <span class='hs-varop'>&lt;++</span> <span class='hs-varid'>return</span> <span class='hs-num'>10</span>
<a name="line-302"></a>       <span class='hs-varid'>n</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexInteger</span> <span class='hs-varid'>base</span>
<a name="line-303"></a>       <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-varid'>maxBound</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-304"></a>       <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>chr</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-305"></a>
<a name="line-306"></a>  <span class='hs-varid'>lexCntrlChar</span> <span class='hs-keyglyph'>=</span>
<a name="line-307"></a>    <span class='hs-keyword'>do</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'^'</span>
<a name="line-308"></a>       <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span>
<a name="line-309"></a>       <span class='hs-keyword'>case</span> <span class='hs-varid'>c</span> <span class='hs-keyword'>of</span>
<a name="line-310"></a>         <span class='hs-chr'>'@'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^@'</span>
<a name="line-311"></a>         <span class='hs-chr'>'A'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^A'</span>
<a name="line-312"></a>         <span class='hs-chr'>'B'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^B'</span>
<a name="line-313"></a>         <span class='hs-chr'>'C'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^C'</span>
<a name="line-314"></a>         <span class='hs-chr'>'D'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^D'</span>
<a name="line-315"></a>         <span class='hs-chr'>'E'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^E'</span>
<a name="line-316"></a>         <span class='hs-chr'>'F'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^F'</span>
<a name="line-317"></a>         <span class='hs-chr'>'G'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^G'</span>
<a name="line-318"></a>         <span class='hs-chr'>'H'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^H'</span>
<a name="line-319"></a>         <span class='hs-chr'>'I'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^I'</span>
<a name="line-320"></a>         <span class='hs-chr'>'J'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^J'</span>
<a name="line-321"></a>         <span class='hs-chr'>'K'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^K'</span>
<a name="line-322"></a>         <span class='hs-chr'>'L'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^L'</span>
<a name="line-323"></a>         <span class='hs-chr'>'M'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^M'</span>
<a name="line-324"></a>         <span class='hs-chr'>'N'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^N'</span>
<a name="line-325"></a>         <span class='hs-chr'>'O'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^O'</span>
<a name="line-326"></a>         <span class='hs-chr'>'P'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^P'</span>
<a name="line-327"></a>         <span class='hs-chr'>'Q'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^Q'</span>
<a name="line-328"></a>         <span class='hs-chr'>'R'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^R'</span>
<a name="line-329"></a>         <span class='hs-chr'>'S'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^S'</span>
<a name="line-330"></a>         <span class='hs-chr'>'T'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^T'</span>
<a name="line-331"></a>         <span class='hs-chr'>'U'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^U'</span>
<a name="line-332"></a>         <span class='hs-chr'>'V'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^V'</span>
<a name="line-333"></a>         <span class='hs-chr'>'W'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^W'</span>
<a name="line-334"></a>         <span class='hs-chr'>'X'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^X'</span>
<a name="line-335"></a>         <span class='hs-chr'>'Y'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^Y'</span>
<a name="line-336"></a>         <span class='hs-chr'>'Z'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^Z'</span>
<a name="line-337"></a>         <span class='hs-chr'>'['</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^['</span>
<a name="line-338"></a>         <span class='hs-chr'>'\\'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^\'</span>
<a name="line-339"></a>         <span class='hs-chr'>']'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^]'</span>
<a name="line-340"></a>         <span class='hs-chr'>'^'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^^'</span>
<a name="line-341"></a>         <span class='hs-chr'>'_'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\^_'</span>
<a name="line-342"></a>         <span class='hs-keyword'>_</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pfail</span>
<a name="line-343"></a>
<a name="line-344"></a>  <span class='hs-varid'>lexAscii</span> <span class='hs-keyglyph'>=</span>
<a name="line-345"></a>     <span class='hs-varid'>choice</span>
<a name="line-346"></a>         <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"SOH"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\SOH'</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;++</span>
<a name="line-347"></a>           <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"SO"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\SO'</span><span class='hs-layout'>)</span>
<a name="line-348"></a>                <span class='hs-comment'>-- \SO and \SOH need maximal-munch treatment</span>
<a name="line-349"></a>                <span class='hs-comment'>-- See the Haskell report Sect 2.6</span>
<a name="line-350"></a>
<a name="line-351"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"NUL"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\NUL'</span>
<a name="line-352"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"STX"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\STX'</span>
<a name="line-353"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"ETX"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\ETX'</span>
<a name="line-354"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"EOT"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\EOT'</span>
<a name="line-355"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"ENQ"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\ENQ'</span>
<a name="line-356"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"ACK"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\ACK'</span>
<a name="line-357"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"BEL"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\BEL'</span>
<a name="line-358"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"BS"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\BS'</span>
<a name="line-359"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"HT"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\HT'</span>
<a name="line-360"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"LF"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\LF'</span>
<a name="line-361"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"VT"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\VT'</span>
<a name="line-362"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"FF"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\FF'</span>
<a name="line-363"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"CR"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\CR'</span>
<a name="line-364"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"SI"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\SI'</span>
<a name="line-365"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"DLE"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\DLE'</span>
<a name="line-366"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"DC1"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\DC1'</span>
<a name="line-367"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"DC2"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\DC2'</span>
<a name="line-368"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"DC3"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\DC3'</span>
<a name="line-369"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"DC4"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\DC4'</span>
<a name="line-370"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"NAK"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\NAK'</span>
<a name="line-371"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"SYN"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\SYN'</span>
<a name="line-372"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"ETB"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\ETB'</span>
<a name="line-373"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"CAN"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\CAN'</span>
<a name="line-374"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"EM"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\EM'</span>
<a name="line-375"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"SUB"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\SUB'</span>
<a name="line-376"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"ESC"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\ESC'</span>
<a name="line-377"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"FS"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\FS'</span>
<a name="line-378"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"GS"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\GS'</span>
<a name="line-379"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"RS"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\RS'</span>
<a name="line-380"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"US"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\US'</span>
<a name="line-381"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"SP"</span>  <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\SP'</span>
<a name="line-382"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"DEL"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>return</span> <span class='hs-chr'>'\DEL'</span>
<a name="line-383"></a>         <span class='hs-keyglyph'>]</span>
<a name="line-384"></a>
<a name="line-385"></a>
<a name="line-386"></a><span class='hs-comment'>-- ---------------------------------------------------------------------------</span>
<a name="line-387"></a><span class='hs-comment'>-- string literal</span>
<a name="line-388"></a>
<a name="line-389"></a><a name="lexString"></a><span class='hs-definition'>lexString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-390"></a><span class='hs-definition'>lexString</span> <span class='hs-keyglyph'>=</span>
<a name="line-391"></a>  <span class='hs-keyword'>do</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span>
<a name="line-392"></a>     <span class='hs-varid'>body</span> <span class='hs-varid'>id</span>
<a name="line-393"></a> <span class='hs-keyword'>where</span>
<a name="line-394"></a>  <span class='hs-varid'>body</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span>
<a name="line-395"></a>    <span class='hs-keyword'>do</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>esc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexStrItem</span>
<a name="line-396"></a>       <span class='hs-keyword'>if</span> <span class='hs-varid'>c</span> <span class='hs-varop'>/=</span> <span class='hs-chr'>'"'</span> <span class='hs-varop'>||</span> <span class='hs-varid'>esc</span>
<a name="line-397"></a>         <span class='hs-keyword'>then</span> <span class='hs-varid'>body</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span><span class='hs-varop'>.</span><span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-398"></a>         <span class='hs-keyword'>else</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-str'>""</span> <span class='hs-keyword'>in</span>
<a name="line-399"></a>              <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-400"></a>
<a name="line-401"></a>  <span class='hs-varid'>lexStrItem</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>lexEmpty</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>lexStrItem</span><span class='hs-layout'>)</span>
<a name="line-402"></a>               <span class='hs-varop'>+++</span> <span class='hs-varid'>lexCharE</span>
<a name="line-403"></a>
<a name="line-404"></a>  <span class='hs-varid'>lexEmpty</span> <span class='hs-keyglyph'>=</span>
<a name="line-405"></a>    <span class='hs-keyword'>do</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\\'</span>
<a name="line-406"></a>       <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span>
<a name="line-407"></a>       <span class='hs-keyword'>case</span> <span class='hs-varid'>c</span> <span class='hs-keyword'>of</span>
<a name="line-408"></a>         <span class='hs-chr'>'&amp;'</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-409"></a>         <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isSpace</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>skipSpaces</span><span class='hs-layout'>;</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\\'</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-410"></a>         <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pfail</span>
<a name="line-411"></a>
<a name="line-412"></a><span class='hs-comment'>-- ---------------------------------------------------------------------------</span>
<a name="line-413"></a><span class='hs-comment'>--  Lexing numbers</span>
<a name="line-414"></a>
<a name="line-415"></a><a name="Base"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Base</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Int</span>
<a name="line-416"></a><a name="Digits"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Digits</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Int</span><span class='hs-keyglyph'>]</span>
<a name="line-417"></a>
<a name="line-418"></a><a name="lexNumber"></a><span class='hs-definition'>lexNumber</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-419"></a><span class='hs-definition'>lexNumber</span>
<a name="line-420"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lexHexOct</span>  <span class='hs-varop'>&lt;++</span>      <span class='hs-comment'>-- First try for hex or octal 0x, 0o etc</span>
<a name="line-421"></a>                        <span class='hs-comment'>-- If that fails, try for a decimal number</span>
<a name="line-422"></a>    <span class='hs-varid'>lexDecNumber</span>        <span class='hs-comment'>-- Start with ordinary digits</span>
<a name="line-423"></a>
<a name="line-424"></a><a name="lexHexOct"></a><span class='hs-definition'>lexHexOct</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-425"></a><span class='hs-definition'>lexHexOct</span>
<a name="line-426"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'0'</span>
<a name="line-427"></a>        <span class='hs-varid'>base</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexBaseChar</span>
<a name="line-428"></a>        <span class='hs-varid'>digits</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexDigits</span> <span class='hs-varid'>base</span>
<a name="line-429"></a>        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Number</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkNumber</span> <span class='hs-varid'>base</span> <span class='hs-varid'>digits</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-430"></a>
<a name="line-431"></a><a name="lexBaseChar"></a><span class='hs-definition'>lexBaseChar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Int</span>
<a name="line-432"></a><span class='hs-comment'>-- Lex a single character indicating the base; fail if not there</span>
<a name="line-433"></a><span class='hs-definition'>lexBaseChar</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-434"></a>  <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span>
<a name="line-435"></a>  <span class='hs-keyword'>case</span> <span class='hs-varid'>c</span> <span class='hs-keyword'>of</span>
<a name="line-436"></a>    <span class='hs-chr'>'o'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-num'>8</span>
<a name="line-437"></a>    <span class='hs-chr'>'O'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-num'>8</span>
<a name="line-438"></a>    <span class='hs-chr'>'x'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-num'>16</span>
<a name="line-439"></a>    <span class='hs-chr'>'X'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-num'>16</span>
<a name="line-440"></a>    <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pfail</span>
<a name="line-441"></a>
<a name="line-442"></a><a name="lexDecNumber"></a><span class='hs-definition'>lexDecNumber</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Lexeme</span>
<a name="line-443"></a><span class='hs-definition'>lexDecNumber</span> <span class='hs-keyglyph'>=</span>
<a name="line-444"></a>  <span class='hs-keyword'>do</span> <span class='hs-varid'>xs</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexDigits</span> <span class='hs-num'>10</span>
<a name="line-445"></a>     <span class='hs-varid'>mFrac</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexFrac</span> <span class='hs-varop'>&lt;++</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-446"></a>     <span class='hs-varid'>mExp</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexExp</span>  <span class='hs-varop'>&lt;++</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-447"></a>     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Number</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkDecimal</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>mFrac</span> <span class='hs-varid'>mExp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-448"></a>
<a name="line-449"></a><a name="lexFrac"></a><span class='hs-definition'>lexFrac</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Digits</span><span class='hs-layout'>)</span>
<a name="line-450"></a><span class='hs-comment'>-- Read the fractional part; fail if it doesn't</span>
<a name="line-451"></a><span class='hs-comment'>-- start ".d" where d is a digit</span>
<a name="line-452"></a><span class='hs-definition'>lexFrac</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'.'</span>
<a name="line-453"></a>             <span class='hs-varid'>fraction</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexDigits</span> <span class='hs-num'>10</span>
<a name="line-454"></a>             <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>fraction</span><span class='hs-layout'>)</span>
<a name="line-455"></a>
<a name="line-456"></a><a name="lexExp"></a><span class='hs-definition'>lexExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReadP</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
<a name="line-457"></a><span class='hs-definition'>lexExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'e'</span> <span class='hs-varop'>+++</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'E'</span>
<a name="line-458"></a>            <span class='hs-varid'>exp</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>signedExp</span> <span class='hs-varop'>+++</span> <span class='hs-varid'>lexInteger</span> <span class='hs-num'>10</span>
<a name="line-459"></a>            <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-460"></a> <span class='hs-keyword'>where</span>
<a name="line-461"></a>   <span class='hs-varid'>signedExp</span>
<a name="line-462"></a>     <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span> <span class='hs-varop'>+++</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'+'</span>
<a name="line-463"></a>          <span class='hs-varid'>n</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexInteger</span> <span class='hs-num'>10</span>
<a name="line-464"></a>          <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'-'</span> <span class='hs-keyword'>then</span> <span class='hs-comment'>-</span><span class='hs-varid'>n</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-465"></a>
<a name="line-466"></a><a name="lexDigits"></a><span class='hs-definition'>lexDigits</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Digits</span>
<a name="line-467"></a><span class='hs-comment'>-- Lex a non-empty sequence of digits in specified base</span>
<a name="line-468"></a><span class='hs-definition'>lexDigits</span> <span class='hs-varid'>base</span> <span class='hs-keyglyph'>=</span>
<a name="line-469"></a>  <span class='hs-keyword'>do</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>look</span>
<a name="line-470"></a>     <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>scan</span> <span class='hs-varid'>s</span> <span class='hs-varid'>id</span>
<a name="line-471"></a>     <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-472"></a>     <span class='hs-varid'>return</span> <span class='hs-varid'>xs</span>
<a name="line-473"></a> <span class='hs-keyword'>where</span>
<a name="line-474"></a>  <span class='hs-varid'>scan</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>valDig</span> <span class='hs-varid'>base</span> <span class='hs-varid'>c</span> <span class='hs-keyword'>of</span>
<a name="line-475"></a>                    <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span><span class='hs-layout'>;</span> <span class='hs-varid'>scan</span> <span class='hs-varid'>cs</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span><span class='hs-varop'>.</span><span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-476"></a>                    <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-477"></a>  <span class='hs-varid'>scan</span> <span class='hs-conid'>[]</span>     <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-478"></a>
<a name="line-479"></a><a name="lexInteger"></a><span class='hs-definition'>lexInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Base</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ReadP</span> <span class='hs-conid'>Integer</span>
<a name="line-480"></a><span class='hs-definition'>lexInteger</span> <span class='hs-varid'>base</span> <span class='hs-keyglyph'>=</span>
<a name="line-481"></a>  <span class='hs-keyword'>do</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexDigits</span> <span class='hs-varid'>base</span>
<a name="line-482"></a>     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>val</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>base</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-483"></a>
<a name="line-484"></a><a name="val"></a><span class='hs-definition'>val</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Digits</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-485"></a><span class='hs-definition'>val</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>valSimple</span>
<a name="line-486"></a><span class='hs-comment'>{-# RULES
<a name="line-487"></a>"val/Integer" val = valInteger
<a name="line-488"></a>  #-}</span>
<a name="line-489"></a><span class='hs-comment'>{-# INLINE [1] val #-}</span>
<a name="line-490"></a>
<a name="line-491"></a><a name="valSimple"></a><span class='hs-comment'>-- The following algorithm is only linear for types whose Num operations</span>
<a name="line-492"></a><span class='hs-comment'>-- are in constant time.</span>
<a name="line-493"></a><span class='hs-definition'>valSimple</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>d</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-494"></a><span class='hs-definition'>valSimple</span> <span class='hs-varid'>base</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-num'>0</span>
<a name="line-495"></a>  <span class='hs-keyword'>where</span>
<a name="line-496"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>r</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r</span>
<a name="line-497"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>r</span> <span class='hs-layout'>(</span><span class='hs-varid'>d</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r'</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>go</span> <span class='hs-varid'>r'</span> <span class='hs-varid'>ds</span>
<a name="line-498"></a>      <span class='hs-keyword'>where</span>
<a name="line-499"></a>        <span class='hs-varid'>r'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r</span> <span class='hs-varop'>*</span> <span class='hs-varid'>base</span> <span class='hs-varop'>+</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>d</span>
<a name="line-500"></a><span class='hs-comment'>{-# INLINE valSimple #-}</span>
<a name="line-501"></a>
<a name="line-502"></a><a name="valInteger"></a><span class='hs-comment'>-- A sub-quadratic algorithm for Integer. Pairs of adjacent radix b</span>
<a name="line-503"></a><span class='hs-comment'>-- digits are combined into a single radix b^2 digit. This process is</span>
<a name="line-504"></a><span class='hs-comment'>-- repeated until we are left with a single digit. This algorithm</span>
<a name="line-505"></a><span class='hs-comment'>-- performs well only on large inputs, so we use the simple algorithm</span>
<a name="line-506"></a><span class='hs-comment'>-- for smaller inputs.</span>
<a name="line-507"></a><span class='hs-definition'>valInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Digits</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span>
<a name="line-508"></a><span class='hs-definition'>valInteger</span> <span class='hs-varid'>b0</span> <span class='hs-varid'>ds0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>b0</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>ds0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>ds0</span>
<a name="line-509"></a>  <span class='hs-keyword'>where</span>
<a name="line-510"></a>    <span class='hs-varid'>go</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-511"></a>    <span class='hs-varid'>go</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>d</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-512"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>b</span> <span class='hs-varid'>l</span> <span class='hs-varid'>ds</span>
<a name="line-513"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&gt;</span> <span class='hs-num'>40</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b'</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>go</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>l'</span> <span class='hs-layout'>(</span><span class='hs-varid'>combine</span> <span class='hs-varid'>b</span> <span class='hs-varid'>ds'</span><span class='hs-layout'>)</span>
<a name="line-514"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>valSimple</span> <span class='hs-varid'>b</span> <span class='hs-varid'>ds</span>
<a name="line-515"></a>      <span class='hs-keyword'>where</span>
<a name="line-516"></a>        <span class='hs-comment'>-- ensure that we have an even number of digits</span>
<a name="line-517"></a>        <span class='hs-comment'>-- before we call combine:</span>
<a name="line-518"></a>        <span class='hs-varid'>ds'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>even</span> <span class='hs-varid'>l</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>ds</span> <span class='hs-keyword'>else</span> <span class='hs-num'>0</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ds</span>
<a name="line-519"></a>        <span class='hs-varid'>b'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b</span> <span class='hs-varop'>*</span> <span class='hs-varid'>b</span>
<a name="line-520"></a>        <span class='hs-varid'>l'</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>`quot`</span> <span class='hs-num'>2</span>
<a name="line-521"></a>    <span class='hs-varid'>combine</span> <span class='hs-varid'>b</span> <span class='hs-layout'>(</span><span class='hs-varid'>d1</span> <span class='hs-conop'>:</span> <span class='hs-varid'>d2</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`seq`</span> <span class='hs-layout'>(</span><span class='hs-varid'>d</span> <span class='hs-conop'>:</span> <span class='hs-varid'>combine</span> <span class='hs-varid'>b</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span>
<a name="line-522"></a>      <span class='hs-keyword'>where</span>
<a name="line-523"></a>        <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d1</span> <span class='hs-varop'>*</span> <span class='hs-varid'>b</span> <span class='hs-varop'>+</span> <span class='hs-varid'>d2</span>
<a name="line-524"></a>    <span class='hs-varid'>combine</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-525"></a>    <span class='hs-varid'>combine</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>_</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>errorWithoutStackTrace</span> <span class='hs-str'>"this should not happen"</span>
<a name="line-526"></a>
<a name="line-527"></a><a name="fracExp"></a><span class='hs-comment'>-- Calculate a Rational from the exponent [of 10 to multiply with],</span>
<a name="line-528"></a><span class='hs-comment'>-- the integral part of the mantissa and the digits of the fractional</span>
<a name="line-529"></a><span class='hs-comment'>-- part. Leaving the calculation of the power of 10 until the end,</span>
<a name="line-530"></a><span class='hs-comment'>-- when we know the effective exponent, saves multiplications.</span>
<a name="line-531"></a><span class='hs-comment'>-- More importantly, this way we need at most one gcd instead of three.</span>
<a name="line-532"></a><span class='hs-comment'>--</span>
<a name="line-533"></a><span class='hs-comment'>-- frac was never used with anything but Integer and base 10, so</span>
<a name="line-534"></a><span class='hs-comment'>-- those are hardcoded now (trivial to change if necessary).</span>
<a name="line-535"></a><span class='hs-definition'>fracExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Digits</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span>
<a name="line-536"></a><span class='hs-definition'>fracExp</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>mant</span> <span class='hs-conid'>[]</span>
<a name="line-537"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>exp</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mant</span> <span class='hs-varop'>%</span> <span class='hs-layout'>(</span><span class='hs-num'>10</span> <span class='hs-varop'>^</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-varid'>exp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-538"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>mant</span> <span class='hs-varop'>*</span> <span class='hs-num'>10</span> <span class='hs-varop'>^</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-539"></a><span class='hs-definition'>fracExp</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>mant</span> <span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-conop'>:</span><span class='hs-varid'>ds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>exp'</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>mant'</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>fracExp</span> <span class='hs-varid'>exp'</span> <span class='hs-varid'>mant'</span> <span class='hs-varid'>ds</span>
<a name="line-540"></a>  <span class='hs-keyword'>where</span>
<a name="line-541"></a>    <span class='hs-varid'>exp'</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>exp</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span>
<a name="line-542"></a>    <span class='hs-varid'>mant'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mant</span> <span class='hs-varop'>*</span> <span class='hs-num'>10</span> <span class='hs-varop'>+</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>d</span>
<a name="line-543"></a>
<a name="line-544"></a><a name="valDig"></a><span class='hs-definition'>valDig</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-545"></a><span class='hs-definition'>valDig</span> <span class='hs-num'>2</span> <span class='hs-varid'>c</span>
<a name="line-546"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-chr'>'0'</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;=</span> <span class='hs-chr'>'1'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-comment'>-</span> <span class='hs-varid'>ord</span> <span class='hs-chr'>'0'</span><span class='hs-layout'>)</span>
<a name="line-547"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-548"></a>
<a name="line-549"></a><span class='hs-definition'>valDig</span> <span class='hs-num'>8</span> <span class='hs-varid'>c</span>
<a name="line-550"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-chr'>'0'</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;=</span> <span class='hs-chr'>'7'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-comment'>-</span> <span class='hs-varid'>ord</span> <span class='hs-chr'>'0'</span><span class='hs-layout'>)</span>
<a name="line-551"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-552"></a>
<a name="line-553"></a><span class='hs-definition'>valDig</span> <span class='hs-num'>10</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>valDecDig</span> <span class='hs-varid'>c</span>
<a name="line-554"></a>
<a name="line-555"></a><span class='hs-definition'>valDig</span> <span class='hs-num'>16</span> <span class='hs-varid'>c</span>
<a name="line-556"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-chr'>'0'</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;=</span> <span class='hs-chr'>'9'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-comment'>-</span> <span class='hs-varid'>ord</span> <span class='hs-chr'>'0'</span><span class='hs-layout'>)</span>
<a name="line-557"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-chr'>'a'</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;=</span> <span class='hs-chr'>'f'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-comment'>-</span> <span class='hs-varid'>ord</span> <span class='hs-chr'>'a'</span> <span class='hs-varop'>+</span> <span class='hs-num'>10</span><span class='hs-layout'>)</span>
<a name="line-558"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-chr'>'A'</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;=</span> <span class='hs-chr'>'F'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-comment'>-</span> <span class='hs-varid'>ord</span> <span class='hs-chr'>'A'</span> <span class='hs-varop'>+</span> <span class='hs-num'>10</span><span class='hs-layout'>)</span>
<a name="line-559"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-560"></a>
<a name="line-561"></a><span class='hs-definition'>valDig</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>errorWithoutStackTrace</span> <span class='hs-str'>"valDig: Bad base"</span>
<a name="line-562"></a>
<a name="line-563"></a><a name="valDecDig"></a><span class='hs-definition'>valDecDig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-564"></a><span class='hs-definition'>valDecDig</span> <span class='hs-varid'>c</span>
<a name="line-565"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-chr'>'0'</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;=</span> <span class='hs-chr'>'9'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-comment'>-</span> <span class='hs-varid'>ord</span> <span class='hs-chr'>'0'</span><span class='hs-layout'>)</span>
<a name="line-566"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-567"></a>
<a name="line-568"></a><span class='hs-comment'>-- ----------------------------------------------------------------------</span>
<a name="line-569"></a><span class='hs-comment'>-- other numeric lexing functions</span>
<a name="line-570"></a>
<a name="line-571"></a><a name="readIntP"></a><span class='hs-definition'>readIntP</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ReadP</span> <span class='hs-varid'>a</span>
<a name="line-572"></a><span class='hs-definition'>readIntP</span> <span class='hs-varid'>base</span> <span class='hs-varid'>isDigit</span> <span class='hs-varid'>valDigit</span> <span class='hs-keyglyph'>=</span>
<a name="line-573"></a>  <span class='hs-keyword'>do</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>munch1</span> <span class='hs-varid'>isDigit</span>
<a name="line-574"></a>     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>val</span> <span class='hs-varid'>base</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>valDigit</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-575"></a><span class='hs-comment'>{-# SPECIALISE readIntP
<a name="line-576"></a>        :: Integer -&gt; (Char -&gt; Bool) -&gt; (Char -&gt; Int) -&gt; ReadP Integer #-}</span>
<a name="line-577"></a>
<a name="line-578"></a><a name="readIntP'"></a><span class='hs-definition'>readIntP'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ReadP</span> <span class='hs-varid'>a</span>
<a name="line-579"></a><span class='hs-definition'>readIntP'</span> <span class='hs-varid'>base</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readIntP</span> <span class='hs-varid'>base</span> <span class='hs-varid'>isDigit</span> <span class='hs-varid'>valDigit</span>
<a name="line-580"></a> <span class='hs-keyword'>where</span>
<a name="line-581"></a>  <span class='hs-varid'>isDigit</span>  <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-conid'>False</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>valDig</span> <span class='hs-varid'>base</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-582"></a>  <span class='hs-varid'>valDigit</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-num'>0</span>     <span class='hs-varid'>id</span>           <span class='hs-layout'>(</span><span class='hs-varid'>valDig</span> <span class='hs-varid'>base</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-583"></a><span class='hs-comment'>{-# SPECIALISE readIntP' :: Integer -&gt; ReadP Integer #-}</span>
<a name="line-584"></a>
<a name="line-585"></a><a name="readBinP"></a><span class='hs-definition'>readBinP</span><span class='hs-layout'>,</span> <span class='hs-varid'>readOctP</span><span class='hs-layout'>,</span> <span class='hs-varid'>readDecP</span><span class='hs-layout'>,</span> <span class='hs-varid'>readHexP</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ReadP</span> <span class='hs-varid'>a</span>
<a name="line-586"></a><span class='hs-definition'>readBinP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readIntP'</span> <span class='hs-num'>2</span>
<a name="line-587"></a><a name="readOctP"></a><span class='hs-definition'>readOctP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readIntP'</span> <span class='hs-num'>8</span>
<a name="line-588"></a><a name="readDecP"></a><span class='hs-definition'>readDecP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readIntP'</span> <span class='hs-num'>10</span>
<a name="line-589"></a><a name="readHexP"></a><span class='hs-definition'>readHexP</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readIntP'</span> <span class='hs-num'>16</span>
<a name="line-590"></a><span class='hs-comment'>{-# SPECIALISE readBinP :: ReadP Integer #-}</span>
<a name="line-591"></a><span class='hs-comment'>{-# SPECIALISE readOctP :: ReadP Integer #-}</span>
<a name="line-592"></a><span class='hs-comment'>{-# SPECIALISE readDecP :: ReadP Integer #-}</span>
<a name="line-593"></a><span class='hs-comment'>{-# SPECIALISE readHexP :: ReadP Integer #-}</span>
</pre></body>
</html>

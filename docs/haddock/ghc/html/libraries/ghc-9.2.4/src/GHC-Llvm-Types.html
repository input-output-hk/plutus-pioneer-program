<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Llvm/Types.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP        #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE LambdaCase #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-5"></a><span class='hs-comment'>-- | The LLVM Type System.</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Llvm.Types</span> <span class='hs-keyword'>where</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-13"></a>
<a name="line-14"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Char</span>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Numeric</span>
<a name="line-16"></a>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Platform</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Session</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.FastString</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Panic</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique</span>
<a name="line-23"></a>
<a name="line-24"></a><span class='hs-comment'>-- from NCG</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Ppr</span>
<a name="line-26"></a>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Float</span>
<a name="line-28"></a>
<a name="line-29"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-30"></a><span class='hs-comment'>-- * LLVM Basic Types and Variables</span>
<a name="line-31"></a><span class='hs-comment'>--</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="LMGlobal"></a><span class='hs-comment'>-- | A global mutable variable. Maybe defined or external</span>
<a name="line-34"></a><a name="LMGlobal"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LMGlobal</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMGlobal</span> <span class='hs-layout'>{</span>
<a name="line-35"></a>  <span class='hs-varid'>getGlobalVar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmVar</span><span class='hs-layout'>,</span>          <span class='hs-comment'>-- ^ Returns the variable of the 'LMGlobal'</span>
<a name="line-36"></a>  <span class='hs-varid'>getGlobalValue</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>LlvmStatic</span> <span class='hs-comment'>-- ^ Return the value of the 'LMGlobal'</span>
<a name="line-37"></a>  <span class='hs-layout'>}</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="LMString"></a><span class='hs-comment'>-- | A String in LLVM</span>
<a name="line-40"></a><a name="LMString"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LMString</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FastString</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="LlvmAlias"></a><span class='hs-comment'>-- | A type alias</span>
<a name="line-43"></a><a name="LlvmAlias"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LlvmAlias</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMString</span><span class='hs-layout'>,</span> <span class='hs-conid'>LlvmType</span><span class='hs-layout'>)</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="LlvmType"></a><span class='hs-comment'>-- | Llvm Types</span>
<a name="line-46"></a><a name="LlvmType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmType</span>
<a name="line-47"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span> <span class='hs-conid'>Int</span>             <span class='hs-comment'>-- ^ An integer with a given width in bits.</span>
<a name="line-48"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMFloat</span>               <span class='hs-comment'>-- ^ 32 bit floating point</span>
<a name="line-49"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMDouble</span>              <span class='hs-comment'>-- ^ 64 bit floating point</span>
<a name="line-50"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMFloat80</span>             <span class='hs-comment'>-- ^ 80 bit (x86 only) floating point</span>
<a name="line-51"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMFloat128</span>            <span class='hs-comment'>-- ^ 128 bit floating point</span>
<a name="line-52"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMPointer</span> <span class='hs-conid'>LlvmType</span>    <span class='hs-comment'>-- ^ A pointer to a 'LlvmType'</span>
<a name="line-53"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMArray</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>LlvmType</span>  <span class='hs-comment'>-- ^ An array of 'LlvmType'</span>
<a name="line-54"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMVector</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>LlvmType</span> <span class='hs-comment'>-- ^ A vector of 'LlvmType'</span>
<a name="line-55"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMLabel</span>               <span class='hs-comment'>-- ^ A 'LlvmVar' can represent a label (address)</span>
<a name="line-56"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMVoid</span>                <span class='hs-comment'>-- ^ Void type</span>
<a name="line-57"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMStruct</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmType</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- ^ Packed structure type</span>
<a name="line-58"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMStructU</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmType</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- ^ Unpacked structure type</span>
<a name="line-59"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMAlias</span> <span class='hs-conid'>LlvmAlias</span>     <span class='hs-comment'>-- ^ A type alias</span>
<a name="line-60"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMMetadata</span>            <span class='hs-comment'>-- ^ LLVM Metadata</span>
<a name="line-61"></a>
<a name="line-62"></a>  <span class='hs-comment'>-- | Function type, used to create pointers to functions</span>
<a name="line-63"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMFunction</span> <span class='hs-conid'>LlvmFunctionDecl</span>
<a name="line-64"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-65"></a>
<a name="line-66"></a><a name="instance%20Outputable%20LlvmType"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyword'>where</span>
<a name="line-67"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppType</span>
<a name="line-68"></a>
<a name="line-69"></a><a name="ppType"></a><span class='hs-definition'>ppType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-70"></a><span class='hs-definition'>ppType</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>t</span> <span class='hs-keyword'>of</span>
<a name="line-71"></a>  <span class='hs-conid'>LMInt</span> <span class='hs-varid'>size</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'i'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>size</span>
<a name="line-72"></a>  <span class='hs-conid'>LMFloat</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"float"</span>
<a name="line-73"></a>  <span class='hs-conid'>LMDouble</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"double"</span>
<a name="line-74"></a>  <span class='hs-conid'>LMFloat80</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"x86_fp80"</span>
<a name="line-75"></a>  <span class='hs-conid'>LMFloat128</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fp128"</span>
<a name="line-76"></a>  <span class='hs-conid'>LMPointer</span> <span class='hs-varid'>x</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'*'</span>
<a name="line-77"></a>  <span class='hs-conid'>LMArray</span> <span class='hs-varid'>nr</span> <span class='hs-varid'>tp</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'['</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>nr</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>" x "</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tp</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>']'</span>
<a name="line-78"></a>  <span class='hs-conid'>LMVector</span> <span class='hs-varid'>nr</span> <span class='hs-varid'>tp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'&lt;'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>nr</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>" x "</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tp</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'&gt;'</span>
<a name="line-79"></a>  <span class='hs-conid'>LMLabel</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"label"</span>
<a name="line-80"></a>  <span class='hs-conid'>LMVoid</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"void"</span>
<a name="line-81"></a>  <span class='hs-conid'>LMStruct</span> <span class='hs-varid'>tys</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"&lt;{"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppCommaJoin</span> <span class='hs-varid'>tys</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"}&gt;"</span>
<a name="line-82"></a>  <span class='hs-conid'>LMStructU</span> <span class='hs-varid'>tys</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"{"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppCommaJoin</span> <span class='hs-varid'>tys</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"}"</span>
<a name="line-83"></a>  <span class='hs-conid'>LMMetadata</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"metadata"</span>
<a name="line-84"></a>  <span class='hs-conid'>LMAlias</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'%'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>s</span>
<a name="line-85"></a>  <span class='hs-conid'>LMFunction</span> <span class='hs-layout'>(</span><span class='hs-conid'>LlvmFunctionDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>r</span> <span class='hs-varid'>varg</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-86"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>lparen</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppParams</span> <span class='hs-varid'>varg</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>rparen</span>
<a name="line-87"></a>
<a name="line-88"></a><a name="ppParams"></a><span class='hs-definition'>ppParams</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmParameterListType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmParameter</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-89"></a><span class='hs-definition'>ppParams</span> <span class='hs-varid'>varg</span> <span class='hs-varid'>p</span>
<a name="line-90"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>varg'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>varg</span> <span class='hs-keyword'>of</span>
<a name="line-91"></a>          <span class='hs-conid'>VarArgs</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sLit</span> <span class='hs-str'>"..."</span>
<a name="line-92"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sLit</span> <span class='hs-str'>", ..."</span>
<a name="line-93"></a>          <span class='hs-sel'>_otherwise</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sLit</span> <span class='hs-str'>""</span>
<a name="line-94"></a>        <span class='hs-comment'>-- by default we don't print param attributes</span>
<a name="line-95"></a>        <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>p</span>
<a name="line-96"></a>    <span class='hs-keyword'>in</span> <span class='hs-varid'>ppCommaJoin</span> <span class='hs-varid'>args</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-varid'>varg'</span>
<a name="line-97"></a>
<a name="line-98"></a><a name="LMSection"></a><span class='hs-comment'>-- | An LLVM section definition. If Nothing then let LLVM decide the section</span>
<a name="line-99"></a><a name="LMSection"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LMSection</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>LMString</span>
<a name="line-100"></a><a name="LMAlign"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LMAlign</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-101"></a>
<a name="line-102"></a><a name="LMConst"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LMConst</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Global</span>      <span class='hs-comment'>-- ^ Mutable global variable</span>
<a name="line-103"></a>             <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Constant</span>    <span class='hs-comment'>-- ^ Constant global variable</span>
<a name="line-104"></a>             <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Alias</span>       <span class='hs-comment'>-- ^ Alias of another variable</span>
<a name="line-105"></a>             <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-106"></a>
<a name="line-107"></a><a name="LlvmVar"></a><span class='hs-comment'>-- | LLVM Variables</span>
<a name="line-108"></a><a name="LlvmVar"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmVar</span>
<a name="line-109"></a>  <span class='hs-comment'>-- | Variables with a global scope.</span>
<a name="line-110"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMGlobalVar</span> <span class='hs-conid'>LMString</span> <span class='hs-conid'>LlvmType</span> <span class='hs-conid'>LlvmLinkageType</span> <span class='hs-conid'>LMSection</span> <span class='hs-conid'>LMAlign</span> <span class='hs-conid'>LMConst</span>
<a name="line-111"></a>  <span class='hs-comment'>-- | Variables local to a function or parameters.</span>
<a name="line-112"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMLocalVar</span> <span class='hs-conid'>Unique</span> <span class='hs-conid'>LlvmType</span>
<a name="line-113"></a>  <span class='hs-comment'>-- | Named local variables. Sometimes we need to be able to explicitly name</span>
<a name="line-114"></a>  <span class='hs-comment'>-- variables (e.g for function arguments).</span>
<a name="line-115"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMNLocalVar</span> <span class='hs-conid'>LMString</span> <span class='hs-conid'>LlvmType</span>
<a name="line-116"></a>  <span class='hs-comment'>-- | A constant variable</span>
<a name="line-117"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMLitVar</span> <span class='hs-conid'>LlvmLit</span>
<a name="line-118"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-119"></a>
<a name="line-120"></a><a name="LlvmLit"></a><span class='hs-comment'>-- | Llvm Literal Data.</span>
<a name="line-121"></a><a name="LlvmLit"></a><span class='hs-comment'>--</span>
<a name="line-122"></a><a name="LlvmLit"></a><span class='hs-comment'>-- These can be used inline in expressions.</span>
<a name="line-123"></a><a name="LlvmLit"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmLit</span>
<a name="line-124"></a>  <span class='hs-comment'>-- | Refers to an integer constant (i64 42).</span>
<a name="line-125"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMIntLit</span> <span class='hs-conid'>Integer</span> <span class='hs-conid'>LlvmType</span>
<a name="line-126"></a>  <span class='hs-comment'>-- | Floating point literal</span>
<a name="line-127"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMFloatLit</span> <span class='hs-conid'>Double</span> <span class='hs-conid'>LlvmType</span>
<a name="line-128"></a>  <span class='hs-comment'>-- | Literal NULL, only applicable to pointer types</span>
<a name="line-129"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMNullLit</span> <span class='hs-conid'>LlvmType</span>
<a name="line-130"></a>  <span class='hs-comment'>-- | Vector literal</span>
<a name="line-131"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMVectorLit</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmLit</span><span class='hs-keyglyph'>]</span>
<a name="line-132"></a>  <span class='hs-comment'>-- | Undefined value, random bit pattern. Useful for optimisations.</span>
<a name="line-133"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMUndefLit</span> <span class='hs-conid'>LlvmType</span>
<a name="line-134"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-135"></a>
<a name="line-136"></a><a name="LlvmStatic"></a><span class='hs-comment'>-- | Llvm Static Data.</span>
<a name="line-137"></a><a name="LlvmStatic"></a><span class='hs-comment'>--</span>
<a name="line-138"></a><a name="LlvmStatic"></a><span class='hs-comment'>-- These represent the possible global level variables and constants.</span>
<a name="line-139"></a><a name="LlvmStatic"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmStatic</span>
<a name="line-140"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMComment</span> <span class='hs-conid'>LMString</span>                  <span class='hs-comment'>-- ^ A comment in a static section</span>
<a name="line-141"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMStaticLit</span> <span class='hs-conid'>LlvmLit</span>                 <span class='hs-comment'>-- ^ A static variant of a literal value</span>
<a name="line-142"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMUninitType</span> <span class='hs-conid'>LlvmType</span>               <span class='hs-comment'>-- ^ For uninitialised data</span>
<a name="line-143"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMStaticStr</span> <span class='hs-conid'>LMString</span> <span class='hs-conid'>LlvmType</span>       <span class='hs-comment'>-- ^ Defines a static 'LMString'</span>
<a name="line-144"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMStaticArray</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmStatic</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>LlvmType</span> <span class='hs-comment'>-- ^ A static array</span>
<a name="line-145"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMStaticStruc</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmStatic</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>LlvmType</span> <span class='hs-comment'>-- ^ A static structure type</span>
<a name="line-146"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMStaticPointer</span> <span class='hs-conid'>LlvmVar</span>             <span class='hs-comment'>-- ^ A pointer to other data</span>
<a name="line-147"></a>
<a name="line-148"></a>  <span class='hs-comment'>-- static expressions, could split out but leave</span>
<a name="line-149"></a>  <span class='hs-comment'>-- for moment for ease of use. Not many of them.</span>
<a name="line-150"></a>
<a name="line-151"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMTrunc</span> <span class='hs-conid'>LlvmStatic</span> <span class='hs-conid'>LlvmType</span>        <span class='hs-comment'>-- ^ Truncate</span>
<a name="line-152"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMBitc</span> <span class='hs-conid'>LlvmStatic</span> <span class='hs-conid'>LlvmType</span>         <span class='hs-comment'>-- ^ Pointer to Pointer conversion</span>
<a name="line-153"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMPtoI</span> <span class='hs-conid'>LlvmStatic</span> <span class='hs-conid'>LlvmType</span>         <span class='hs-comment'>-- ^ Pointer to Integer conversion</span>
<a name="line-154"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMAdd</span> <span class='hs-conid'>LlvmStatic</span> <span class='hs-conid'>LlvmStatic</span>        <span class='hs-comment'>-- ^ Constant addition operation</span>
<a name="line-155"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LMSub</span> <span class='hs-conid'>LlvmStatic</span> <span class='hs-conid'>LlvmStatic</span>        <span class='hs-comment'>-- ^ Constant subtraction operation</span>
<a name="line-156"></a>
<a name="line-157"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-158"></a><span class='hs-comment'>-- ** Operations on LLVM Basic Types and Variables</span>
<a name="line-159"></a><span class='hs-comment'>--</span>
<a name="line-160"></a>
<a name="line-161"></a><a name="LlvmOpts"></a><span class='hs-comment'>-- | LLVM code generator options</span>
<a name="line-162"></a><a name="LlvmOpts"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmOpts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LlvmOpts</span>
<a name="line-163"></a>   <span class='hs-layout'>{</span> <span class='hs-varid'>llvmOptsPlatform</span>             <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Platform</span> <span class='hs-comment'>-- ^ Target platform</span>
<a name="line-164"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>llvmOptsFillUndefWithGarbage</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Bool</span>     <span class='hs-comment'>-- ^ Fill undefined literals with garbage values</span>
<a name="line-165"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>llvmOptsSplitSections</span>        <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Bool</span>     <span class='hs-comment'>-- ^ Split sections</span>
<a name="line-166"></a>   <span class='hs-layout'>}</span>
<a name="line-167"></a>
<a name="line-168"></a><a name="initLlvmOpts"></a><span class='hs-comment'>-- | Get LlvmOptions from DynFlags</span>
<a name="line-169"></a><span class='hs-definition'>initLlvmOpts</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmOpts</span>
<a name="line-170"></a><span class='hs-definition'>initLlvmOpts</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LlvmOpts</span>
<a name="line-171"></a>   <span class='hs-layout'>{</span> <span class='hs-varid'>llvmOptsPlatform</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>targetPlatform</span> <span class='hs-varid'>dflags</span>
<a name="line-172"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>llvmOptsFillUndefWithGarbage</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_LlvmFillUndefWithGarbage</span> <span class='hs-varid'>dflags</span>
<a name="line-173"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>llvmOptsSplitSections</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_SplitSections</span> <span class='hs-varid'>dflags</span>
<a name="line-174"></a>   <span class='hs-layout'>}</span>
<a name="line-175"></a>
<a name="line-176"></a><a name="garbageLit"></a><span class='hs-definition'>garbageLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>LlvmLit</span>
<a name="line-177"></a><span class='hs-definition'>garbageLit</span> <span class='hs-varid'>t</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>LMInt</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMIntLit</span> <span class='hs-layout'>(</span><span class='hs-num'>0xbbbbbbbbbbbbbbb0</span> <span class='hs-varop'>`mod`</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>^</span><span class='hs-varid'>w</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-178"></a>  <span class='hs-comment'>-- Use a value that looks like an untagged pointer, so we are more</span>
<a name="line-179"></a>  <span class='hs-comment'>-- likely to try to enter it</span>
<a name="line-180"></a><span class='hs-definition'>garbageLit</span> <span class='hs-varid'>t</span>
<a name="line-181"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isFloat</span> <span class='hs-varid'>t</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMFloatLit</span> <span class='hs-num'>12345678.9</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-182"></a><span class='hs-definition'>garbageLit</span> <span class='hs-varid'>t</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>LMPointer</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMNullLit</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-183"></a>  <span class='hs-comment'>-- Using null isn't totally ideal, since some functions may check for null.</span>
<a name="line-184"></a>  <span class='hs-comment'>-- But producing another value is inconvenient since it needs a cast,</span>
<a name="line-185"></a>  <span class='hs-comment'>-- and the knowledge for how to format casts is in PpLlvm.</span>
<a name="line-186"></a><span class='hs-definition'>garbageLit</span> <span class='hs-keyword'>_</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-187"></a>  <span class='hs-comment'>-- More cases could be added, but this should do for now.</span>
<a name="line-188"></a>
<a name="line-189"></a><a name="getVarType"></a><span class='hs-comment'>-- | Return the 'LlvmType' of the 'LlvmVar'</span>
<a name="line-190"></a><span class='hs-definition'>getVarType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmType</span>
<a name="line-191"></a><span class='hs-definition'>getVarType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMGlobalVar</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>y</span>
<a name="line-192"></a><span class='hs-definition'>getVarType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMLocalVar</span>  <span class='hs-keyword'>_</span> <span class='hs-varid'>y</span>        <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>y</span>
<a name="line-193"></a><span class='hs-definition'>getVarType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMNLocalVar</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>y</span>        <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>y</span>
<a name="line-194"></a><span class='hs-definition'>getVarType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMLitVar</span>    <span class='hs-varid'>l</span>          <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getLitType</span> <span class='hs-varid'>l</span>
<a name="line-195"></a>
<a name="line-196"></a><a name="getLitType"></a><span class='hs-comment'>-- | Return the 'LlvmType' of a 'LlvmLit'</span>
<a name="line-197"></a><span class='hs-definition'>getLitType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmLit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmType</span>
<a name="line-198"></a><span class='hs-definition'>getLitType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMIntLit</span>   <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-199"></a><span class='hs-definition'>getLitType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMFloatLit</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-200"></a><span class='hs-definition'>getLitType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMVectorLit</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"getLitType"</span>
<a name="line-201"></a><span class='hs-definition'>getLitType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMVectorLit</span> <span class='hs-varid'>ls</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMVector</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>ls</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLitType</span> <span class='hs-layout'>(</span><span class='hs-varid'>head</span> <span class='hs-varid'>ls</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-202"></a><span class='hs-definition'>getLitType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMNullLit</span>    <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-203"></a><span class='hs-definition'>getLitType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMUndefLit</span>   <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-204"></a>
<a name="line-205"></a><a name="getStatType"></a><span class='hs-comment'>-- | Return the 'LlvmType' of the 'LlvmStatic'</span>
<a name="line-206"></a><span class='hs-definition'>getStatType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmStatic</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmType</span>
<a name="line-207"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMStaticLit</span>   <span class='hs-varid'>l</span>  <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getLitType</span> <span class='hs-varid'>l</span>
<a name="line-208"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMUninitType</span>    <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-209"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMStaticStr</span>   <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-210"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMStaticArray</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-211"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMStaticStruc</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-212"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMStaticPointer</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getVarType</span> <span class='hs-varid'>v</span>
<a name="line-213"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMTrunc</span>       <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-214"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMBitc</span>        <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-215"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMPtoI</span>        <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-216"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMAdd</span>         <span class='hs-varid'>t</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getStatType</span> <span class='hs-varid'>t</span>
<a name="line-217"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMSub</span>         <span class='hs-varid'>t</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getStatType</span> <span class='hs-varid'>t</span>
<a name="line-218"></a><span class='hs-definition'>getStatType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMComment</span>       <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Can't call getStatType on LMComment!"</span>
<a name="line-219"></a>
<a name="line-220"></a><a name="getLink"></a><span class='hs-comment'>-- | Return the 'LlvmLinkageType' for a 'LlvmVar'</span>
<a name="line-221"></a><span class='hs-definition'>getLink</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmLinkageType</span>
<a name="line-222"></a><span class='hs-definition'>getLink</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMGlobalVar</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-223"></a><span class='hs-definition'>getLink</span> <span class='hs-keyword'>_</span>                         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Internal</span>
<a name="line-224"></a>
<a name="line-225"></a><a name="pLift"></a><span class='hs-comment'>-- | Add a pointer indirection to the supplied type. 'LMLabel' and 'LMVoid'</span>
<a name="line-226"></a><span class='hs-comment'>-- cannot be lifted.</span>
<a name="line-227"></a><span class='hs-definition'>pLift</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmType</span>
<a name="line-228"></a><span class='hs-definition'>pLift</span> <span class='hs-conid'>LMLabel</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Labels are unliftable"</span>
<a name="line-229"></a><span class='hs-definition'>pLift</span> <span class='hs-conid'>LMVoid</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Voids are unliftable"</span>
<a name="line-230"></a><span class='hs-definition'>pLift</span> <span class='hs-conid'>LMMetadata</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Metadatas are unliftable"</span>
<a name="line-231"></a><span class='hs-definition'>pLift</span> <span class='hs-varid'>x</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMPointer</span> <span class='hs-varid'>x</span>
<a name="line-232"></a>
<a name="line-233"></a><a name="pVarLift"></a><span class='hs-comment'>-- | Lift a variable to 'LMPointer' type.</span>
<a name="line-234"></a><span class='hs-definition'>pVarLift</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmVar</span>
<a name="line-235"></a><span class='hs-definition'>pVarLift</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMGlobalVar</span> <span class='hs-varid'>s</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l</span> <span class='hs-varid'>x</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMGlobalVar</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>pLift</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-varid'>x</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span>
<a name="line-236"></a><span class='hs-definition'>pVarLift</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMLocalVar</span>  <span class='hs-varid'>s</span> <span class='hs-varid'>t</span>        <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMLocalVar</span>  <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>pLift</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-237"></a><span class='hs-definition'>pVarLift</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMNLocalVar</span> <span class='hs-varid'>s</span> <span class='hs-varid'>t</span>        <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMNLocalVar</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>pLift</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-238"></a><span class='hs-definition'>pVarLift</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMLitVar</span>    <span class='hs-keyword'>_</span>          <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Can't lower a literal type!"</span>
<a name="line-239"></a>
<a name="line-240"></a><a name="pLower"></a><span class='hs-comment'>-- | Remove the pointer indirection of the supplied type. Only 'LMPointer'</span>
<a name="line-241"></a><span class='hs-comment'>-- constructors can be lowered.</span>
<a name="line-242"></a><span class='hs-definition'>pLower</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmType</span>
<a name="line-243"></a><span class='hs-definition'>pLower</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMPointer</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-244"></a><span class='hs-definition'>pLower</span> <span class='hs-varid'>x</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"llvmGen(pLower)"</span>
<a name="line-245"></a>            <span class='hs-varop'>$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>" is a unlowerable type, need a pointer"</span>
<a name="line-246"></a>
<a name="line-247"></a><a name="pVarLower"></a><span class='hs-comment'>-- | Lower a variable of 'LMPointer' type.</span>
<a name="line-248"></a><span class='hs-definition'>pVarLower</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmVar</span>
<a name="line-249"></a><span class='hs-definition'>pVarLower</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMGlobalVar</span> <span class='hs-varid'>s</span> <span class='hs-varid'>t</span> <span class='hs-varid'>l</span> <span class='hs-varid'>x</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMGlobalVar</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>pLower</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-varid'>x</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span>
<a name="line-250"></a><span class='hs-definition'>pVarLower</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMLocalVar</span>  <span class='hs-varid'>s</span> <span class='hs-varid'>t</span>        <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMLocalVar</span>  <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>pLower</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-251"></a><span class='hs-definition'>pVarLower</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMNLocalVar</span> <span class='hs-varid'>s</span> <span class='hs-varid'>t</span>        <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMNLocalVar</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>pLower</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-252"></a><span class='hs-definition'>pVarLower</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMLitVar</span>    <span class='hs-keyword'>_</span>          <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Can't lower a literal type!"</span>
<a name="line-253"></a>
<a name="line-254"></a><a name="isInt"></a><span class='hs-comment'>-- | Test if the given 'LlvmType' is an integer</span>
<a name="line-255"></a><span class='hs-definition'>isInt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-256"></a><span class='hs-definition'>isInt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMInt</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-257"></a><span class='hs-definition'>isInt</span> <span class='hs-keyword'>_</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-258"></a>
<a name="line-259"></a><a name="isFloat"></a><span class='hs-comment'>-- | Test if the given 'LlvmType' is a floating point type</span>
<a name="line-260"></a><span class='hs-definition'>isFloat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-261"></a><span class='hs-definition'>isFloat</span> <span class='hs-conid'>LMFloat</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-262"></a><span class='hs-definition'>isFloat</span> <span class='hs-conid'>LMDouble</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-263"></a><span class='hs-definition'>isFloat</span> <span class='hs-conid'>LMFloat80</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-264"></a><span class='hs-definition'>isFloat</span> <span class='hs-conid'>LMFloat128</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-265"></a><span class='hs-definition'>isFloat</span> <span class='hs-keyword'>_</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-266"></a>
<a name="line-267"></a><a name="isPointer"></a><span class='hs-comment'>-- | Test if the given 'LlvmType' is an 'LMPointer' construct</span>
<a name="line-268"></a><span class='hs-definition'>isPointer</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-269"></a><span class='hs-definition'>isPointer</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMPointer</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-270"></a><span class='hs-definition'>isPointer</span> <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-271"></a>
<a name="line-272"></a><a name="isVector"></a><span class='hs-comment'>-- | Test if the given 'LlvmType' is an 'LMVector' construct</span>
<a name="line-273"></a><span class='hs-definition'>isVector</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-274"></a><span class='hs-definition'>isVector</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMVector</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-275"></a><span class='hs-definition'>isVector</span> <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-276"></a>
<a name="line-277"></a><a name="isGlobal"></a><span class='hs-comment'>-- | Test if a 'LlvmVar' is global.</span>
<a name="line-278"></a><span class='hs-definition'>isGlobal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-279"></a><span class='hs-definition'>isGlobal</span> <span class='hs-layout'>(</span><span class='hs-conid'>LMGlobalVar</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-280"></a><span class='hs-definition'>isGlobal</span> <span class='hs-keyword'>_</span>                         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-281"></a>
<a name="line-282"></a><a name="llvmWidthInBits"></a><span class='hs-comment'>-- | Width in bits of an 'LlvmType', returns 0 if not applicable</span>
<a name="line-283"></a><span class='hs-definition'>llvmWidthInBits</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-284"></a><span class='hs-definition'>llvmWidthInBits</span> <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<a name="line-285"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMInt</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-286"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMFloat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>32</span>
<a name="line-287"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMDouble</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>64</span>
<a name="line-288"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMFloat80</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>80</span>
<a name="line-289"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMFloat128</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>128</span>
<a name="line-290"></a>   <span class='hs-comment'>-- Could return either a pointer width here or the width of what</span>
<a name="line-291"></a>   <span class='hs-comment'>-- it points to. We will go with the former for now.</span>
<a name="line-292"></a>   <span class='hs-comment'>-- PMW: At least judging by the way LLVM outputs constants, pointers</span>
<a name="line-293"></a>   <span class='hs-comment'>--      should use the former, but arrays the latter.</span>
<a name="line-294"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMPointer</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>llvmWidthInBits</span> <span class='hs-varid'>platform</span> <span class='hs-layout'>(</span><span class='hs-varid'>llvmWord</span> <span class='hs-varid'>platform</span><span class='hs-layout'>)</span>
<a name="line-295"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMArray</span> <span class='hs-varid'>n</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span> <span class='hs-varop'>*</span> <span class='hs-varid'>llvmWidthInBits</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>t</span>
<a name="line-296"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMVector</span> <span class='hs-varid'>n</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span> <span class='hs-varop'>*</span> <span class='hs-varid'>llvmWidthInBits</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>ty</span>
<a name="line-297"></a>   <span class='hs-conid'>LMLabel</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>0</span>
<a name="line-298"></a>   <span class='hs-conid'>LMVoid</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>0</span>
<a name="line-299"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMStruct</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sum</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>llvmWidthInBits</span> <span class='hs-varid'>platform</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span>
<a name="line-300"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMStructU</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>-&gt;</span>
<a name="line-301"></a>    <span class='hs-comment'>-- It's not trivial to calculate the bit width of the unpacked structs,</span>
<a name="line-302"></a>    <span class='hs-comment'>-- since they will be aligned depending on the specified datalayout (</span>
<a name="line-303"></a>    <span class='hs-comment'>-- <a href="http://llvm.org/docs/LangRef.html#data-layout">http://llvm.org/docs/LangRef.html#data-layout</a> ). One way we could support</span>
<a name="line-304"></a>    <span class='hs-comment'>-- this could be to make the GHC.CmmToLlvm.Ppr.moduleLayout be a data type</span>
<a name="line-305"></a>    <span class='hs-comment'>-- that exposes the alignment information. However, currently the only place</span>
<a name="line-306"></a>    <span class='hs-comment'>-- we use unpacked structs is LLVM intrinsics that return them (e.g.,</span>
<a name="line-307"></a>    <span class='hs-comment'>-- llvm.sadd.with.overflow.*), so we don't actually need to compute their</span>
<a name="line-308"></a>    <span class='hs-comment'>-- bit width.</span>
<a name="line-309"></a>    <span class='hs-varid'>panic</span> <span class='hs-str'>"llvmWidthInBits: not implemented for LMStructU"</span>
<a name="line-310"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMFunction</span>  <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>0</span>
<a name="line-311"></a>   <span class='hs-layout'>(</span><span class='hs-conid'>LMAlias</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>llvmWidthInBits</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>t</span>
<a name="line-312"></a>   <span class='hs-conid'>LMMetadata</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"llvmWidthInBits: Meta-data has no runtime representation!"</span>
<a name="line-313"></a>
<a name="line-314"></a>
<a name="line-315"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-316"></a><span class='hs-comment'>-- ** Shortcut for Common Types</span>
<a name="line-317"></a><span class='hs-comment'>--</span>
<a name="line-318"></a>
<a name="line-319"></a><a name="i128"></a><span class='hs-definition'>i128</span><span class='hs-layout'>,</span> <span class='hs-varid'>i64</span><span class='hs-layout'>,</span> <span class='hs-varid'>i32</span><span class='hs-layout'>,</span> <span class='hs-varid'>i16</span><span class='hs-layout'>,</span> <span class='hs-varid'>i8</span><span class='hs-layout'>,</span> <span class='hs-varid'>i1</span><span class='hs-layout'>,</span> <span class='hs-varid'>i8Ptr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span>
<a name="line-320"></a><span class='hs-definition'>i128</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span> <span class='hs-num'>128</span>
<a name="line-321"></a><a name="i64"></a><span class='hs-definition'>i64</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span>  <span class='hs-num'>64</span>
<a name="line-322"></a><a name="i32"></a><span class='hs-definition'>i32</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span>  <span class='hs-num'>32</span>
<a name="line-323"></a><a name="i16"></a><span class='hs-definition'>i16</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span>  <span class='hs-num'>16</span>
<a name="line-324"></a><a name="i8"></a><span class='hs-definition'>i8</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span>   <span class='hs-num'>8</span>
<a name="line-325"></a><a name="i1"></a><span class='hs-definition'>i1</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span>   <span class='hs-num'>1</span>
<a name="line-326"></a><a name="i8Ptr"></a><span class='hs-definition'>i8Ptr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pLift</span> <span class='hs-varid'>i8</span>
<a name="line-327"></a>
<a name="line-328"></a><a name="llvmWord"></a><span class='hs-comment'>-- | The target architectures word size</span>
<a name="line-329"></a><span class='hs-definition'>llvmWord</span><span class='hs-layout'>,</span> <span class='hs-varid'>llvmWordPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LlvmType</span>
<a name="line-330"></a><span class='hs-definition'>llvmWord</span>    <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LMInt</span> <span class='hs-layout'>(</span><span class='hs-varid'>platformWordSizeInBytes</span> <span class='hs-varid'>platform</span> <span class='hs-varop'>*</span> <span class='hs-num'>8</span><span class='hs-layout'>)</span>
<a name="line-331"></a><a name="llvmWordPtr"></a><span class='hs-definition'>llvmWordPtr</span> <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pLift</span> <span class='hs-layout'>(</span><span class='hs-varid'>llvmWord</span> <span class='hs-varid'>platform</span><span class='hs-layout'>)</span>
<a name="line-332"></a>
<a name="line-333"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-334"></a><span class='hs-comment'>-- * LLVM Function Types</span>
<a name="line-335"></a><span class='hs-comment'>--</span>
<a name="line-336"></a>
<a name="line-337"></a><a name="LlvmFunctionDecl"></a><span class='hs-comment'>-- | An LLVM Function</span>
<a name="line-338"></a><a name="LlvmFunctionDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmFunctionDecl</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LlvmFunctionDecl</span> <span class='hs-layout'>{</span>
<a name="line-339"></a>        <span class='hs-comment'>-- | Unique identifier of the function</span>
<a name="line-340"></a>        <span class='hs-varid'>decName</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LMString</span><span class='hs-layout'>,</span>
<a name="line-341"></a>        <span class='hs-comment'>-- | LinkageType of the function</span>
<a name="line-342"></a>        <span class='hs-varid'>funcLinkage</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmLinkageType</span><span class='hs-layout'>,</span>
<a name="line-343"></a>        <span class='hs-comment'>-- | The calling convention of the function</span>
<a name="line-344"></a>        <span class='hs-varid'>funcCc</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmCallConvention</span><span class='hs-layout'>,</span>
<a name="line-345"></a>        <span class='hs-comment'>-- | Type of the returned value</span>
<a name="line-346"></a>        <span class='hs-varid'>decReturnType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmType</span><span class='hs-layout'>,</span>
<a name="line-347"></a>        <span class='hs-comment'>-- | Indicates if this function uses varargs</span>
<a name="line-348"></a>        <span class='hs-varid'>decVarargs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LlvmParameterListType</span><span class='hs-layout'>,</span>
<a name="line-349"></a>        <span class='hs-comment'>-- | Parameter types and attributes</span>
<a name="line-350"></a>        <span class='hs-varid'>decParams</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmParameter</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-351"></a>        <span class='hs-comment'>-- | Function align value, must be power of 2</span>
<a name="line-352"></a>        <span class='hs-varid'>funcAlign</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LMAlign</span>
<a name="line-353"></a>  <span class='hs-layout'>}</span>
<a name="line-354"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-355"></a>
<a name="line-356"></a><a name="instance%20Outputable%20LlvmFunctionDecl"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmFunctionDecl</span> <span class='hs-keyword'>where</span>
<a name="line-357"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LlvmFunctionDecl</span> <span class='hs-varid'>n</span> <span class='hs-varid'>l</span> <span class='hs-varid'>c</span> <span class='hs-varid'>r</span> <span class='hs-varid'>varg</span> <span class='hs-varid'>p</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-358"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>align</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-359"></a>                       <span class='hs-conid'>Just</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>" align "</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a'</span>
<a name="line-360"></a>                       <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-361"></a>      <span class='hs-keyword'>in</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'@'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;&gt;</span>
<a name="line-362"></a>             <span class='hs-varid'>lparen</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppParams</span> <span class='hs-varid'>varg</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>rparen</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>align</span>
<a name="line-363"></a>
<a name="line-364"></a><a name="LlvmFunctionDecls"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LlvmFunctionDecls</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmFunctionDecl</span><span class='hs-keyglyph'>]</span>
<a name="line-365"></a>
<a name="line-366"></a><a name="LlvmParameter"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LlvmParameter</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>LlvmType</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LlvmParamAttr</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-367"></a>
<a name="line-368"></a><a name="LlvmParamAttr"></a><span class='hs-comment'>-- | LLVM Parameter Attributes.</span>
<a name="line-369"></a><a name="LlvmParamAttr"></a><span class='hs-comment'>--</span>
<a name="line-370"></a><a name="LlvmParamAttr"></a><span class='hs-comment'>-- Parameter attributes are used to communicate additional information about</span>
<a name="line-371"></a><a name="LlvmParamAttr"></a><span class='hs-comment'>-- the result or parameters of a function</span>
<a name="line-372"></a><a name="LlvmParamAttr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmParamAttr</span>
<a name="line-373"></a>  <span class='hs-comment'>-- | This indicates to the code generator that the parameter or return value</span>
<a name="line-374"></a>  <span class='hs-comment'>-- should be zero-extended to a 32-bit value by the caller (for a parameter)</span>
<a name="line-375"></a>  <span class='hs-comment'>-- or the callee (for a return value).</span>
<a name="line-376"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ZeroExt</span>
<a name="line-377"></a>  <span class='hs-comment'>-- | This indicates to the code generator that the parameter or return value</span>
<a name="line-378"></a>  <span class='hs-comment'>-- should be sign-extended to a 32-bit value by the caller (for a parameter)</span>
<a name="line-379"></a>  <span class='hs-comment'>-- or the callee (for a return value).</span>
<a name="line-380"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SignExt</span>
<a name="line-381"></a>  <span class='hs-comment'>-- | This indicates that this parameter or return value should be treated in</span>
<a name="line-382"></a>  <span class='hs-comment'>-- a special target-dependent fashion during while emitting code for a</span>
<a name="line-383"></a>  <span class='hs-comment'>-- function call or return (usually, by putting it in a register as opposed</span>
<a name="line-384"></a>  <span class='hs-comment'>-- to memory).</span>
<a name="line-385"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>InReg</span>
<a name="line-386"></a>  <span class='hs-comment'>-- | This indicates that the pointer parameter should really be passed by</span>
<a name="line-387"></a>  <span class='hs-comment'>-- value to the function.</span>
<a name="line-388"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ByVal</span>
<a name="line-389"></a>  <span class='hs-comment'>-- | This indicates that the pointer parameter specifies the address of a</span>
<a name="line-390"></a>  <span class='hs-comment'>-- structure that is the return value of the function in the source program.</span>
<a name="line-391"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SRet</span>
<a name="line-392"></a>  <span class='hs-comment'>-- | This indicates that the pointer does not alias any global or any other</span>
<a name="line-393"></a>  <span class='hs-comment'>-- parameter.</span>
<a name="line-394"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoAlias</span>
<a name="line-395"></a>  <span class='hs-comment'>-- | This indicates that the callee does not make any copies of the pointer</span>
<a name="line-396"></a>  <span class='hs-comment'>-- that outlive the callee itself</span>
<a name="line-397"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoCapture</span>
<a name="line-398"></a>  <span class='hs-comment'>-- | This indicates that the pointer parameter can be excised using the</span>
<a name="line-399"></a>  <span class='hs-comment'>-- trampoline intrinsics.</span>
<a name="line-400"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Nest</span>
<a name="line-401"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-402"></a>
<a name="line-403"></a><a name="instance%20Outputable%20LlvmParamAttr"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmParamAttr</span> <span class='hs-keyword'>where</span>
<a name="line-404"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ZeroExt</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"zeroext"</span>
<a name="line-405"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>SignExt</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"signext"</span>
<a name="line-406"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>InReg</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"inreg"</span>
<a name="line-407"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ByVal</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"byval"</span>
<a name="line-408"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>SRet</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sret"</span>
<a name="line-409"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoAlias</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"noalias"</span>
<a name="line-410"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoCapture</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"nocapture"</span>
<a name="line-411"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>Nest</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"nest"</span>
<a name="line-412"></a>
<a name="line-413"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>-- | Llvm Function Attributes.</span>
<a name="line-414"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>--</span>
<a name="line-415"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>-- Function attributes are set to communicate additional information about a</span>
<a name="line-416"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>-- function. Function attributes are considered to be part of the function,</span>
<a name="line-417"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>-- not of the function type, so functions with different parameter attributes</span>
<a name="line-418"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>-- can have the same function type. Functions can have multiple attributes.</span>
<a name="line-419"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>--</span>
<a name="line-420"></a><a name="LlvmFuncAttr"></a><span class='hs-comment'>-- Descriptions taken from &lt;<a href="http://llvm.org/docs/LangRef.html#fnattrs">http://llvm.org/docs/LangRef.html#fnattrs</a>&gt;</span>
<a name="line-421"></a><a name="LlvmFuncAttr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmFuncAttr</span>
<a name="line-422"></a>  <span class='hs-comment'>-- | This attribute indicates that the inliner should attempt to inline this</span>
<a name="line-423"></a>  <span class='hs-comment'>-- function into callers whenever possible, ignoring any active inlining</span>
<a name="line-424"></a>  <span class='hs-comment'>-- size threshold for this caller.</span>
<a name="line-425"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlwaysInline</span>
<a name="line-426"></a>  <span class='hs-comment'>-- | This attribute indicates that the source code contained a hint that</span>
<a name="line-427"></a>  <span class='hs-comment'>-- inlining this function is desirable (such as the \"inline\" keyword in</span>
<a name="line-428"></a>  <span class='hs-comment'>-- C/C++). It is just a hint; it imposes no requirements on the inliner.</span>
<a name="line-429"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>InlineHint</span>
<a name="line-430"></a>  <span class='hs-comment'>-- | This attribute indicates that the inliner should never inline this</span>
<a name="line-431"></a>  <span class='hs-comment'>-- function in any situation. This attribute may not be used together</span>
<a name="line-432"></a>  <span class='hs-comment'>-- with the alwaysinline attribute.</span>
<a name="line-433"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoInline</span>
<a name="line-434"></a>  <span class='hs-comment'>-- | This attribute suggests that optimization passes and code generator</span>
<a name="line-435"></a>  <span class='hs-comment'>-- passes make choices that keep the code size of this function low, and</span>
<a name="line-436"></a>  <span class='hs-comment'>-- otherwise do optimizations specifically to reduce code size.</span>
<a name="line-437"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>OptSize</span>
<a name="line-438"></a>  <span class='hs-comment'>-- | This function attribute indicates that the function never returns</span>
<a name="line-439"></a>  <span class='hs-comment'>-- normally. This produces undefined behavior at runtime if the function</span>
<a name="line-440"></a>  <span class='hs-comment'>-- ever does dynamically return.</span>
<a name="line-441"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoReturn</span>
<a name="line-442"></a>  <span class='hs-comment'>-- | This function attribute indicates that the function never returns with</span>
<a name="line-443"></a>  <span class='hs-comment'>-- an unwind or exceptional control flow. If the function does unwind, its</span>
<a name="line-444"></a>  <span class='hs-comment'>-- runtime behavior is undefined.</span>
<a name="line-445"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoUnwind</span>
<a name="line-446"></a>  <span class='hs-comment'>-- | This attribute indicates that the function computes its result (or</span>
<a name="line-447"></a>  <span class='hs-comment'>-- decides to unwind an exception) based strictly on its arguments, without</span>
<a name="line-448"></a>  <span class='hs-comment'>-- dereferencing any pointer arguments or otherwise accessing any mutable</span>
<a name="line-449"></a>  <span class='hs-comment'>-- state (e.g. memory, control registers, etc) visible to caller functions.</span>
<a name="line-450"></a>  <span class='hs-comment'>-- It does not write through any pointer arguments (including byval</span>
<a name="line-451"></a>  <span class='hs-comment'>-- arguments) and never changes any state visible to callers. This means</span>
<a name="line-452"></a>  <span class='hs-comment'>-- that it cannot unwind exceptions by calling the C++ exception throwing</span>
<a name="line-453"></a>  <span class='hs-comment'>-- methods, but could use the unwind instruction.</span>
<a name="line-454"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ReadNone</span>
<a name="line-455"></a>  <span class='hs-comment'>-- | This attribute indicates that the function does not write through any</span>
<a name="line-456"></a>  <span class='hs-comment'>-- pointer arguments (including byval arguments) or otherwise modify any</span>
<a name="line-457"></a>  <span class='hs-comment'>-- state (e.g. memory, control registers, etc) visible to caller functions.</span>
<a name="line-458"></a>  <span class='hs-comment'>-- It may dereference pointer arguments and read state that may be set in</span>
<a name="line-459"></a>  <span class='hs-comment'>-- the caller. A readonly function always returns the same value (or unwinds</span>
<a name="line-460"></a>  <span class='hs-comment'>-- an exception identically) when called with the same set of arguments and</span>
<a name="line-461"></a>  <span class='hs-comment'>-- global state. It cannot unwind an exception by calling the C++ exception</span>
<a name="line-462"></a>  <span class='hs-comment'>-- throwing methods, but may use the unwind instruction.</span>
<a name="line-463"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ReadOnly</span>
<a name="line-464"></a>  <span class='hs-comment'>-- | This attribute indicates that the function should emit a stack smashing</span>
<a name="line-465"></a>  <span class='hs-comment'>-- protector. It is in the form of a \"canary\"a random value placed on the</span>
<a name="line-466"></a>  <span class='hs-comment'>-- stack before the local variables that's checked upon return from the</span>
<a name="line-467"></a>  <span class='hs-comment'>-- function to see if it has been overwritten. A heuristic is used to</span>
<a name="line-468"></a>  <span class='hs-comment'>-- determine if a function needs stack protectors or not.</span>
<a name="line-469"></a>  <span class='hs-comment'>--</span>
<a name="line-470"></a>  <span class='hs-comment'>-- If a function that has an ssp attribute is inlined into a function that</span>
<a name="line-471"></a>  <span class='hs-comment'>-- doesn't have an ssp attribute, then the resulting function will have an</span>
<a name="line-472"></a>  <span class='hs-comment'>-- ssp attribute.</span>
<a name="line-473"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Ssp</span>
<a name="line-474"></a>  <span class='hs-comment'>-- | This attribute indicates that the function should always emit a stack</span>
<a name="line-475"></a>  <span class='hs-comment'>-- smashing protector. This overrides the ssp function attribute.</span>
<a name="line-476"></a>  <span class='hs-comment'>--</span>
<a name="line-477"></a>  <span class='hs-comment'>-- If a function that has an sspreq attribute is inlined into a function</span>
<a name="line-478"></a>  <span class='hs-comment'>-- that doesn't have an sspreq attribute or which has an ssp attribute,</span>
<a name="line-479"></a>  <span class='hs-comment'>-- then the resulting function will have an sspreq attribute.</span>
<a name="line-480"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SspReq</span>
<a name="line-481"></a>  <span class='hs-comment'>-- | This attribute indicates that the code generator should not use a red</span>
<a name="line-482"></a>  <span class='hs-comment'>-- zone, even if the target-specific ABI normally permits it.</span>
<a name="line-483"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoRedZone</span>
<a name="line-484"></a>  <span class='hs-comment'>-- | This attributes disables implicit floating point instructions.</span>
<a name="line-485"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoImplicitFloat</span>
<a name="line-486"></a>  <span class='hs-comment'>-- | This attribute disables prologue / epilogue emission for the function.</span>
<a name="line-487"></a>  <span class='hs-comment'>-- This can have very system-specific consequences.</span>
<a name="line-488"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Naked</span>
<a name="line-489"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-490"></a>
<a name="line-491"></a><a name="instance%20Outputable%20LlvmFuncAttr"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmFuncAttr</span> <span class='hs-keyword'>where</span>
<a name="line-492"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>AlwaysInline</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"alwaysinline"</span>
<a name="line-493"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>InlineHint</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"inlinehint"</span>
<a name="line-494"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoInline</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"noinline"</span>
<a name="line-495"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>OptSize</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"optsize"</span>
<a name="line-496"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoReturn</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"noreturn"</span>
<a name="line-497"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoUnwind</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"nounwind"</span>
<a name="line-498"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ReadNone</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"readnone"</span>
<a name="line-499"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ReadOnly</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"readonly"</span>
<a name="line-500"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>Ssp</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ssp"</span>
<a name="line-501"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>SspReq</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ssqreq"</span>
<a name="line-502"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoRedZone</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"noredzone"</span>
<a name="line-503"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoImplicitFloat</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"noimplicitfloat"</span>
<a name="line-504"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>Naked</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"naked"</span>
<a name="line-505"></a>
<a name="line-506"></a>
<a name="line-507"></a><a name="LlvmCallType"></a><span class='hs-comment'>-- | Different types to call a function.</span>
<a name="line-508"></a><a name="LlvmCallType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmCallType</span>
<a name="line-509"></a>  <span class='hs-comment'>-- | Normal call, allocate a new stack frame.</span>
<a name="line-510"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StdCall</span>
<a name="line-511"></a>  <span class='hs-comment'>-- | Tail call, perform the call in the current stack frame.</span>
<a name="line-512"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TailCall</span>
<a name="line-513"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-514"></a>
<a name="line-515"></a><a name="LlvmCallConvention"></a><span class='hs-comment'>-- | Different calling conventions a function can use.</span>
<a name="line-516"></a><a name="LlvmCallConvention"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmCallConvention</span>
<a name="line-517"></a>  <span class='hs-comment'>-- | The C calling convention.</span>
<a name="line-518"></a>  <span class='hs-comment'>-- This calling convention (the default if no other calling convention is</span>
<a name="line-519"></a>  <span class='hs-comment'>-- specified) matches the target C calling conventions. This calling</span>
<a name="line-520"></a>  <span class='hs-comment'>-- convention supports varargs function calls and tolerates some mismatch in</span>
<a name="line-521"></a>  <span class='hs-comment'>-- the declared prototype and implemented declaration of the function (as</span>
<a name="line-522"></a>  <span class='hs-comment'>-- does normal C).</span>
<a name="line-523"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CC_Ccc</span>
<a name="line-524"></a>  <span class='hs-comment'>-- | This calling convention attempts to make calls as fast as possible</span>
<a name="line-525"></a>  <span class='hs-comment'>-- (e.g. by passing things in registers). This calling convention allows</span>
<a name="line-526"></a>  <span class='hs-comment'>-- the target to use whatever tricks it wants to produce fast code for the</span>
<a name="line-527"></a>  <span class='hs-comment'>-- target, without having to conform to an externally specified ABI</span>
<a name="line-528"></a>  <span class='hs-comment'>-- (Application Binary Interface). Implementations of this convention should</span>
<a name="line-529"></a>  <span class='hs-comment'>-- allow arbitrary tail call optimization to be supported. This calling</span>
<a name="line-530"></a>  <span class='hs-comment'>-- convention does not support varargs and requires the prototype of al</span>
<a name="line-531"></a>  <span class='hs-comment'>-- callees to exactly match the prototype of the function definition.</span>
<a name="line-532"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CC_Fastcc</span>
<a name="line-533"></a>  <span class='hs-comment'>-- | This calling convention attempts to make code in the caller as efficient</span>
<a name="line-534"></a>  <span class='hs-comment'>-- as possible under the assumption that the call is not commonly executed.</span>
<a name="line-535"></a>  <span class='hs-comment'>-- As such, these calls often preserve all registers so that the call does</span>
<a name="line-536"></a>  <span class='hs-comment'>-- not break any live ranges in the caller side. This calling convention</span>
<a name="line-537"></a>  <span class='hs-comment'>-- does not support varargs and requires the prototype of all callees to</span>
<a name="line-538"></a>  <span class='hs-comment'>-- exactly match the prototype of the function definition.</span>
<a name="line-539"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CC_Coldcc</span>
<a name="line-540"></a>  <span class='hs-comment'>-- | The GHC-specific 'registerised' calling convention.</span>
<a name="line-541"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CC_Ghc</span>
<a name="line-542"></a>  <span class='hs-comment'>-- | Any calling convention may be specified by number, allowing</span>
<a name="line-543"></a>  <span class='hs-comment'>-- target-specific calling conventions to be used. Target specific calling</span>
<a name="line-544"></a>  <span class='hs-comment'>-- conventions start at 64.</span>
<a name="line-545"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CC_Ncc</span> <span class='hs-conid'>Int</span>
<a name="line-546"></a>  <span class='hs-comment'>-- | X86 Specific 'StdCall' convention. LLVM includes a specific alias for it</span>
<a name="line-547"></a>  <span class='hs-comment'>-- rather than just using CC_Ncc.</span>
<a name="line-548"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CC_X86_Stdcc</span>
<a name="line-549"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-550"></a>
<a name="line-551"></a><a name="instance%20Outputable%20LlvmCallConvention"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmCallConvention</span> <span class='hs-keyword'>where</span>
<a name="line-552"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>CC_Ccc</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ccc"</span>
<a name="line-553"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>CC_Fastcc</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fastcc"</span>
<a name="line-554"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>CC_Coldcc</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"coldcc"</span>
<a name="line-555"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>CC_Ghc</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ghccc"</span>
<a name="line-556"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>CC_Ncc</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"cc "</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>i</span>
<a name="line-557"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>CC_X86_Stdcc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"x86_stdcallcc"</span>
<a name="line-558"></a>
<a name="line-559"></a>
<a name="line-560"></a><a name="LlvmParameterListType"></a><span class='hs-comment'>-- | Functions can have a fixed amount of parameters, or a variable amount.</span>
<a name="line-561"></a><a name="LlvmParameterListType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmParameterListType</span>
<a name="line-562"></a>  <span class='hs-comment'>-- Fixed amount of arguments.</span>
<a name="line-563"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FixedArgs</span>
<a name="line-564"></a>  <span class='hs-comment'>-- Variable amount of arguments.</span>
<a name="line-565"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>VarArgs</span>
<a name="line-566"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-567"></a>
<a name="line-568"></a>
<a name="line-569"></a><a name="LlvmLinkageType"></a><span class='hs-comment'>-- | Linkage type of a symbol.</span>
<a name="line-570"></a><a name="LlvmLinkageType"></a><span class='hs-comment'>--</span>
<a name="line-571"></a><a name="LlvmLinkageType"></a><span class='hs-comment'>-- The description of the constructors is copied from the Llvm Assembly Language</span>
<a name="line-572"></a><a name="LlvmLinkageType"></a><span class='hs-comment'>-- Reference Manual &lt;<a href="http://www.llvm.org/docs/LangRef.html#linkage">http://www.llvm.org/docs/LangRef.html#linkage</a>&gt;, because</span>
<a name="line-573"></a><a name="LlvmLinkageType"></a><span class='hs-comment'>-- they correspond to the Llvm linkage types.</span>
<a name="line-574"></a><a name="LlvmLinkageType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmLinkageType</span>
<a name="line-575"></a>  <span class='hs-comment'>-- | Global values with internal linkage are only directly accessible by</span>
<a name="line-576"></a>  <span class='hs-comment'>-- objects in the current module. In particular, linking code into a module</span>
<a name="line-577"></a>  <span class='hs-comment'>-- with an internal global value may cause the internal to be renamed as</span>
<a name="line-578"></a>  <span class='hs-comment'>-- necessary to avoid collisions. Because the symbol is internal to the</span>
<a name="line-579"></a>  <span class='hs-comment'>-- module, all references can be updated. This corresponds to the notion</span>
<a name="line-580"></a>  <span class='hs-comment'>-- of the @static@ keyword in C.</span>
<a name="line-581"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Internal</span>
<a name="line-582"></a>  <span class='hs-comment'>-- | Globals with @linkonce@ linkage are merged with other globals of the</span>
<a name="line-583"></a>  <span class='hs-comment'>-- same name when linkage occurs. This is typically used to implement</span>
<a name="line-584"></a>  <span class='hs-comment'>-- inline functions, templates, or other code which must be generated</span>
<a name="line-585"></a>  <span class='hs-comment'>-- in each translation unit that uses it. Unreferenced linkonce globals are</span>
<a name="line-586"></a>  <span class='hs-comment'>-- allowed to be discarded.</span>
<a name="line-587"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LinkOnce</span>
<a name="line-588"></a>  <span class='hs-comment'>-- | @weak@ linkage is exactly the same as linkonce linkage, except that</span>
<a name="line-589"></a>  <span class='hs-comment'>-- unreferenced weak globals may not be discarded. This is used for globals</span>
<a name="line-590"></a>  <span class='hs-comment'>-- that may be emitted in multiple translation units, but that are not</span>
<a name="line-591"></a>  <span class='hs-comment'>-- guaranteed to be emitted into every translation unit that uses them. One</span>
<a name="line-592"></a>  <span class='hs-comment'>-- example of this are common globals in C, such as @int X;@ at global</span>
<a name="line-593"></a>  <span class='hs-comment'>-- scope.</span>
<a name="line-594"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Weak</span>
<a name="line-595"></a>  <span class='hs-comment'>-- | @appending@ linkage may only be applied to global variables of pointer</span>
<a name="line-596"></a>  <span class='hs-comment'>-- to array type. When two global variables with appending linkage are</span>
<a name="line-597"></a>  <span class='hs-comment'>-- linked together, the two global arrays are appended together. This is</span>
<a name="line-598"></a>  <span class='hs-comment'>-- the Llvm, typesafe, equivalent of having the system linker append</span>
<a name="line-599"></a>  <span class='hs-comment'>-- together @sections@ with identical names when .o files are linked.</span>
<a name="line-600"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Appending</span>
<a name="line-601"></a>  <span class='hs-comment'>-- | The semantics of this linkage follow the ELF model: the symbol is weak</span>
<a name="line-602"></a>  <span class='hs-comment'>-- until linked, if not linked, the symbol becomes null instead of being an</span>
<a name="line-603"></a>  <span class='hs-comment'>-- undefined reference.</span>
<a name="line-604"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExternWeak</span>
<a name="line-605"></a>  <span class='hs-comment'>-- | The symbol participates in linkage and can be used to resolve external</span>
<a name="line-606"></a>  <span class='hs-comment'>--  symbol references.</span>
<a name="line-607"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExternallyVisible</span>
<a name="line-608"></a>  <span class='hs-comment'>-- | Alias for 'ExternallyVisible' but with explicit textual form in LLVM</span>
<a name="line-609"></a>  <span class='hs-comment'>--  assembly.</span>
<a name="line-610"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>External</span>
<a name="line-611"></a>  <span class='hs-comment'>-- | Symbol is private to the module and should not appear in the symbol table</span>
<a name="line-612"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Private</span>
<a name="line-613"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-614"></a>
<a name="line-615"></a><a name="instance%20Outputable%20LlvmLinkageType"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmLinkageType</span> <span class='hs-keyword'>where</span>
<a name="line-616"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>Internal</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"internal"</span>
<a name="line-617"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LinkOnce</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"linkonce"</span>
<a name="line-618"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>Weak</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"weak"</span>
<a name="line-619"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>Appending</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"appending"</span>
<a name="line-620"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ExternWeak</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"extern_weak"</span>
<a name="line-621"></a>  <span class='hs-comment'>-- ExternallyVisible does not have a textual representation, it is</span>
<a name="line-622"></a>  <span class='hs-comment'>-- the linkage type a function resolves to if no other is specified</span>
<a name="line-623"></a>  <span class='hs-comment'>-- in Llvm.</span>
<a name="line-624"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ExternallyVisible</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-625"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>External</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"external"</span>
<a name="line-626"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>Private</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"private"</span>
<a name="line-627"></a>
<a name="line-628"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-629"></a><span class='hs-comment'>-- * LLVM Operations</span>
<a name="line-630"></a><span class='hs-comment'>--</span>
<a name="line-631"></a>
<a name="line-632"></a><a name="LlvmMachOp"></a><span class='hs-comment'>-- | Llvm binary operators machine operations.</span>
<a name="line-633"></a><a name="LlvmMachOp"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmMachOp</span>
<a name="line-634"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LM_MO_Add</span>  <span class='hs-comment'>-- ^ add two integer, floating point or vector values.</span>
<a name="line-635"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_Sub</span>  <span class='hs-comment'>-- ^ subtract two ...</span>
<a name="line-636"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_Mul</span>  <span class='hs-comment'>-- ^ multiply ..</span>
<a name="line-637"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_UDiv</span> <span class='hs-comment'>-- ^ unsigned integer or vector division.</span>
<a name="line-638"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_SDiv</span> <span class='hs-comment'>-- ^ signed integer ..</span>
<a name="line-639"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_URem</span> <span class='hs-comment'>-- ^ unsigned integer or vector remainder (mod)</span>
<a name="line-640"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_SRem</span> <span class='hs-comment'>-- ^ signed ...</span>
<a name="line-641"></a>
<a name="line-642"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_FAdd</span> <span class='hs-comment'>-- ^ add two floating point or vector values.</span>
<a name="line-643"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_FSub</span> <span class='hs-comment'>-- ^ subtract two ...</span>
<a name="line-644"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_FMul</span> <span class='hs-comment'>-- ^ multiply ...</span>
<a name="line-645"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_FDiv</span> <span class='hs-comment'>-- ^ divide ...</span>
<a name="line-646"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_FRem</span> <span class='hs-comment'>-- ^ remainder ...</span>
<a name="line-647"></a>
<a name="line-648"></a>  <span class='hs-comment'>-- | Left shift</span>
<a name="line-649"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_Shl</span>
<a name="line-650"></a>  <span class='hs-comment'>-- | Logical shift right</span>
<a name="line-651"></a>  <span class='hs-comment'>-- Shift right, filling with zero</span>
<a name="line-652"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_LShr</span>
<a name="line-653"></a>  <span class='hs-comment'>-- | Arithmetic shift right</span>
<a name="line-654"></a>  <span class='hs-comment'>-- The most significant bits of the result will be equal to the sign bit of</span>
<a name="line-655"></a>  <span class='hs-comment'>-- the left operand.</span>
<a name="line-656"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_AShr</span>
<a name="line-657"></a>
<a name="line-658"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_And</span> <span class='hs-comment'>-- ^ AND bitwise logical operation.</span>
<a name="line-659"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_Or</span>  <span class='hs-comment'>-- ^ OR bitwise logical operation.</span>
<a name="line-660"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_MO_Xor</span> <span class='hs-comment'>-- ^ XOR bitwise logical operation.</span>
<a name="line-661"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-662"></a>
<a name="line-663"></a><a name="instance%20Outputable%20LlvmMachOp"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmMachOp</span> <span class='hs-keyword'>where</span>
<a name="line-664"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_Add</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"add"</span>
<a name="line-665"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_Sub</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sub"</span>
<a name="line-666"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_Mul</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"mul"</span>
<a name="line-667"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_UDiv</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"udiv"</span>
<a name="line-668"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_SDiv</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sdiv"</span>
<a name="line-669"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_URem</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"urem"</span>
<a name="line-670"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_SRem</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"srem"</span>
<a name="line-671"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_FAdd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fadd"</span>
<a name="line-672"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_FSub</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fsub"</span>
<a name="line-673"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_FMul</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fmul"</span>
<a name="line-674"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_FDiv</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fdiv"</span>
<a name="line-675"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_FRem</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"frem"</span>
<a name="line-676"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_Shl</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"shl"</span>
<a name="line-677"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_LShr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"lshr"</span>
<a name="line-678"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_AShr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ashr"</span>
<a name="line-679"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_And</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"and"</span>
<a name="line-680"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_Or</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"or"</span>
<a name="line-681"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_MO_Xor</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"xor"</span>
<a name="line-682"></a>
<a name="line-683"></a>
<a name="line-684"></a><a name="LlvmCmpOp"></a><span class='hs-comment'>-- | Llvm compare operations.</span>
<a name="line-685"></a><a name="LlvmCmpOp"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmCmpOp</span>
<a name="line-686"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LM_CMP_Eq</span>  <span class='hs-comment'>-- ^ Equal (Signed and Unsigned)</span>
<a name="line-687"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Ne</span>  <span class='hs-comment'>-- ^ Not equal (Signed and Unsigned)</span>
<a name="line-688"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Ugt</span> <span class='hs-comment'>-- ^ Unsigned greater than</span>
<a name="line-689"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Uge</span> <span class='hs-comment'>-- ^ Unsigned greater than or equal</span>
<a name="line-690"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Ult</span> <span class='hs-comment'>-- ^ Unsigned less than</span>
<a name="line-691"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Ule</span> <span class='hs-comment'>-- ^ Unsigned less than or equal</span>
<a name="line-692"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Sgt</span> <span class='hs-comment'>-- ^ Signed greater than</span>
<a name="line-693"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Sge</span> <span class='hs-comment'>-- ^ Signed greater than or equal</span>
<a name="line-694"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Slt</span> <span class='hs-comment'>-- ^ Signed less than</span>
<a name="line-695"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Sle</span> <span class='hs-comment'>-- ^ Signed less than or equal</span>
<a name="line-696"></a>
<a name="line-697"></a>  <span class='hs-comment'>-- Float comparisons. GHC uses a mix of ordered and unordered float</span>
<a name="line-698"></a>  <span class='hs-comment'>-- comparisons.</span>
<a name="line-699"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Feq</span> <span class='hs-comment'>-- ^ Float equal</span>
<a name="line-700"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Fne</span> <span class='hs-comment'>-- ^ Float not equal</span>
<a name="line-701"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Fgt</span> <span class='hs-comment'>-- ^ Float greater than</span>
<a name="line-702"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Fge</span> <span class='hs-comment'>-- ^ Float greater than or equal</span>
<a name="line-703"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Flt</span> <span class='hs-comment'>-- ^ Float less than</span>
<a name="line-704"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_CMP_Fle</span> <span class='hs-comment'>-- ^ Float less than or equal</span>
<a name="line-705"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-706"></a>
<a name="line-707"></a><a name="instance%20Outputable%20LlvmCmpOp"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmCmpOp</span> <span class='hs-keyword'>where</span>
<a name="line-708"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Eq</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"eq"</span>
<a name="line-709"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Ne</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ne"</span>
<a name="line-710"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Ugt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ugt"</span>
<a name="line-711"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Uge</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"uge"</span>
<a name="line-712"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Ult</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ult"</span>
<a name="line-713"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Ule</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ule"</span>
<a name="line-714"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Sgt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sgt"</span>
<a name="line-715"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Sge</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sge"</span>
<a name="line-716"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Slt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"slt"</span>
<a name="line-717"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Sle</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sle"</span>
<a name="line-718"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Feq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"oeq"</span>
<a name="line-719"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Fne</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"une"</span>
<a name="line-720"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Fgt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ogt"</span>
<a name="line-721"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Fge</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"oge"</span>
<a name="line-722"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Flt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"olt"</span>
<a name="line-723"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_CMP_Fle</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ole"</span>
<a name="line-724"></a>
<a name="line-725"></a>
<a name="line-726"></a><a name="LlvmCastOp"></a><span class='hs-comment'>-- | Llvm cast operations.</span>
<a name="line-727"></a><a name="LlvmCastOp"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LlvmCastOp</span>
<a name="line-728"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LM_Trunc</span>    <span class='hs-comment'>-- ^ Integer truncate</span>
<a name="line-729"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Zext</span>     <span class='hs-comment'>-- ^ Integer extend (zero fill)</span>
<a name="line-730"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Sext</span>     <span class='hs-comment'>-- ^ Integer extend (sign fill)</span>
<a name="line-731"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Fptrunc</span>  <span class='hs-comment'>-- ^ Float truncate</span>
<a name="line-732"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Fpext</span>    <span class='hs-comment'>-- ^ Float extend</span>
<a name="line-733"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Fptoui</span>   <span class='hs-comment'>-- ^ Float to unsigned Integer</span>
<a name="line-734"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Fptosi</span>   <span class='hs-comment'>-- ^ Float to signed Integer</span>
<a name="line-735"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Uitofp</span>   <span class='hs-comment'>-- ^ Unsigned Integer to Float</span>
<a name="line-736"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Sitofp</span>   <span class='hs-comment'>-- ^ Signed Int to Float</span>
<a name="line-737"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Ptrtoint</span> <span class='hs-comment'>-- ^ Pointer to Integer</span>
<a name="line-738"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Inttoptr</span> <span class='hs-comment'>-- ^ Integer to Pointer</span>
<a name="line-739"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LM_Bitcast</span>  <span class='hs-comment'>-- ^ Cast between types where no bit manipulation is needed</span>
<a name="line-740"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-741"></a>
<a name="line-742"></a><a name="instance%20Outputable%20LlvmCastOp"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>LlvmCastOp</span> <span class='hs-keyword'>where</span>
<a name="line-743"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Trunc</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"trunc"</span>
<a name="line-744"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Zext</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"zext"</span>
<a name="line-745"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Sext</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sext"</span>
<a name="line-746"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Fptrunc</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fptrunc"</span>
<a name="line-747"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Fpext</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fpext"</span>
<a name="line-748"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Fptoui</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fptoui"</span>
<a name="line-749"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Fptosi</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"fptosi"</span>
<a name="line-750"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Uitofp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"uitofp"</span>
<a name="line-751"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Sitofp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"sitofp"</span>
<a name="line-752"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Ptrtoint</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ptrtoint"</span>
<a name="line-753"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Inttoptr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"inttoptr"</span>
<a name="line-754"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LM_Bitcast</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"bitcast"</span>
<a name="line-755"></a>
<a name="line-756"></a>
<a name="line-757"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-758"></a><span class='hs-comment'>-- * Floating point conversion</span>
<a name="line-759"></a><span class='hs-comment'>--</span>
<a name="line-760"></a>
<a name="line-761"></a><a name="ppDouble"></a><span class='hs-comment'>-- | Convert a Haskell Double to an LLVM hex encoded floating point form. In</span>
<a name="line-762"></a><span class='hs-comment'>-- Llvm float literals can be printed in a big-endian hexadecimal format,</span>
<a name="line-763"></a><span class='hs-comment'>-- regardless of underlying architecture.</span>
<a name="line-764"></a><span class='hs-comment'>--</span>
<a name="line-765"></a><span class='hs-comment'>-- See Note [LLVM Float Types].</span>
<a name="line-766"></a><span class='hs-definition'>ppDouble</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-767"></a><span class='hs-definition'>ppDouble</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>d</span>
<a name="line-768"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>bs</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>doubleToBytes</span> <span class='hs-varid'>d</span>
<a name="line-769"></a>        <span class='hs-varid'>hex</span> <span class='hs-varid'>d'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>showHex</span> <span class='hs-varid'>d'</span> <span class='hs-str'>""</span> <span class='hs-keyword'>of</span>
<a name="line-770"></a>            <span class='hs-conid'>[]</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>error</span> <span class='hs-str'>"ppDouble: too few hex digits for float"</span>
<a name="line-771"></a>            <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'0'</span><span class='hs-layout'>,</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span>
<a name="line-772"></a>            <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-keyglyph'>]</span>
<a name="line-773"></a>            <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>error</span> <span class='hs-str'>"ppDouble: too many hex digits for float"</span>
<a name="line-774"></a>
<a name="line-775"></a>        <span class='hs-varid'>fixEndian</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>platformByteOrder</span> <span class='hs-varid'>platform</span> <span class='hs-keyword'>of</span>
<a name="line-776"></a>            <span class='hs-conid'>BigEndian</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>id</span>
<a name="line-777"></a>            <span class='hs-conid'>LittleEndian</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>reverse</span>
<a name="line-778"></a>        <span class='hs-varid'>str</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toUpper</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fixEndian</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>hex</span> <span class='hs-varid'>bs</span>
<a name="line-779"></a>    <span class='hs-keyword'>in</span> <span class='hs-varid'>text</span> <span class='hs-str'>"0x"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-varid'>str</span>
<a name="line-780"></a>
<a name="line-781"></a><span class='hs-comment'>-- Note [LLVM Float Types]</span>
<a name="line-782"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-783"></a><span class='hs-comment'>-- We use 'ppDouble' for both printing Float and Double floating point types. This is</span>
<a name="line-784"></a><span class='hs-comment'>-- as LLVM expects all floating point constants (single &amp; double) to be in IEEE</span>
<a name="line-785"></a><span class='hs-comment'>-- 754 Double precision format. However, for single precision numbers (Float)</span>
<a name="line-786"></a><span class='hs-comment'>-- they should be *representable* in IEEE 754 Single precision format. So the</span>
<a name="line-787"></a><span class='hs-comment'>-- easiest way to do this is to narrow and widen again.</span>
<a name="line-788"></a><span class='hs-comment'>-- (i.e., Double -&gt; Float -&gt; Double). We must be careful doing this that GHC</span>
<a name="line-789"></a><span class='hs-comment'>-- doesn't optimize that away.</span>
<a name="line-790"></a>
<a name="line-791"></a><span class='hs-comment'>-- Note [narrowFp &amp; widenFp]</span>
<a name="line-792"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-793"></a><span class='hs-comment'>-- NOTE: we use float2Double &amp; co directly as GHC likes to optimize away</span>
<a name="line-794"></a><span class='hs-comment'>-- successive calls of 'realToFrac', defeating the narrowing. (Bug #7600).</span>
<a name="line-795"></a><span class='hs-comment'>-- 'realToFrac' has inconsistent behaviour with optimisation as well that can</span>
<a name="line-796"></a><span class='hs-comment'>-- also cause issues, these methods don't.</span>
<a name="line-797"></a>
<a name="line-798"></a><a name="narrowFp"></a><span class='hs-definition'>narrowFp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span>
<a name="line-799"></a><span class='hs-comment'>{-# NOINLINE narrowFp #-}</span>
<a name="line-800"></a><span class='hs-definition'>narrowFp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>double2Float</span>
<a name="line-801"></a>
<a name="line-802"></a><a name="widenFp"></a><span class='hs-definition'>widenFp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Double</span>
<a name="line-803"></a><span class='hs-comment'>{-# NOINLINE widenFp #-}</span>
<a name="line-804"></a><span class='hs-definition'>widenFp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>float2Double</span>
<a name="line-805"></a>
<a name="line-806"></a><a name="ppFloat"></a><span class='hs-definition'>ppFloat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-807"></a><span class='hs-definition'>ppFloat</span> <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppDouble</span> <span class='hs-varid'>platform</span> <span class='hs-varop'>.</span> <span class='hs-varid'>widenFp</span>
<a name="line-808"></a>
<a name="line-809"></a>
<a name="line-810"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-811"></a><span class='hs-comment'>-- * Misc functions</span>
<a name="line-812"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-813"></a>
<a name="line-814"></a><a name="ppCommaJoin"></a><span class='hs-definition'>ppCommaJoin</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-815"></a><span class='hs-definition'>ppCommaJoin</span> <span class='hs-varid'>strs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-varop'>$</span> <span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>strs</span><span class='hs-layout'>)</span>
<a name="line-816"></a>
<a name="line-817"></a><a name="ppSpaceJoin"></a><span class='hs-definition'>ppSpaceJoin</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-818"></a><span class='hs-definition'>ppSpaceJoin</span> <span class='hs-varid'>strs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>strs</span><span class='hs-layout'>)</span>
</pre></body>
</html>

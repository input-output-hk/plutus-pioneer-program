<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="local-6989586621680966496"><span id="local-6989586621680966497"><span id="local-6989586621680966498"><span id="local-6989586621680966499"></span></span></span></span><span class="hs-comment">-- (c) The University of Glasgow, 1997-2006</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE UnboxedTuples #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE UnliftedFFITypes #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -O2 -funbox-strict-fields #-}</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- We always optimise this, otherwise performance of a non-optimised</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- compiler is severely affected</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- There are two principal string types used internally by GHC:</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- ['FastString']</span><span>
</span><span id="line-19"></span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span class="hs-comment">--   * A compact, hash-consed, representation of character strings.</span><span>
</span><span id="line-21"></span><span class="hs-comment">--   * Generated by 'fsLit'.</span><span>
</span><span id="line-22"></span><span class="hs-comment">--   * You can get a 'GHC.Types.Unique.Unique' from them.</span><span>
</span><span id="line-23"></span><span class="hs-comment">--   * Equality test is O(1) (it uses the Unique).</span><span>
</span><span id="line-24"></span><span class="hs-comment">--   * Comparison is O(1) or O(n):</span><span>
</span><span id="line-25"></span><span class="hs-comment">--       * O(n) but deterministic with lexical comparison (`lexicalCompareFS`)</span><span>
</span><span id="line-26"></span><span class="hs-comment">--       * O(1) but non-deterministic with Unique comparison (`uniqCompareFS`)</span><span>
</span><span id="line-27"></span><span class="hs-comment">--   * Turn into 'GHC.Utils.Outputable.SDoc' with 'GHC.Utils.Outputable.ftext'.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- ['PtrString']</span><span>
</span><span id="line-30"></span><span class="hs-comment">--</span><span>
</span><span id="line-31"></span><span class="hs-comment">--   * Pointer and size of a Latin-1 encoded string.</span><span>
</span><span id="line-32"></span><span class="hs-comment">--   * Practically no operations.</span><span>
</span><span id="line-33"></span><span class="hs-comment">--   * Outputting them is fast.</span><span>
</span><span id="line-34"></span><span class="hs-comment">--   * Generated by 'sLit'.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--   * Turn into 'GHC.Utils.Outputable.SDoc' with 'GHC.Utils.Outputable.ptext'</span><span>
</span><span id="line-36"></span><span class="hs-comment">--   * Requires manual memory management.</span><span>
</span><span id="line-37"></span><span class="hs-comment">--     Improper use may lead to memory leaks or dangling pointers.</span><span>
</span><span id="line-38"></span><span class="hs-comment">--   * It assumes Latin-1 as the encoding, therefore it cannot represent</span><span>
</span><span id="line-39"></span><span class="hs-comment">--     arbitrary Unicode strings.</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- Use 'PtrString' unless you want the facilities of 'FastString'.</span><span>
</span><span id="line-42"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Data.FastString</span><span>
</span><span id="line-43"></span><span>       </span><span class="hs-special">(</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><span class="hs-comment">-- * ByteString</span></span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier">bytesFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToByteString"><span class="hs-identifier">fastStringToByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteString"><span class="hs-identifier">mkFastStringByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fastZStringToByteString"><span class="hs-identifier">fastZStringToByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unsafeMkByteString"><span class="hs-identifier">unsafeMkByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><span class="hs-comment">-- * ShortByteString</span></span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToShortByteString"><span class="hs-identifier">fastStringToShortByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier">mkFastStringShortByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><span class="hs-comment">-- * FastZString</span></span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier">FastZString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#hPutFZS"><span class="hs-identifier">hPutFZS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#zString"><span class="hs-identifier">zString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lengthFZS"><span class="hs-identifier">lengthFZS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><span class="hs-comment">-- * FastStrings</span></span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier">FastString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- not abstract, for now.</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier">NonDetFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier">LexicalFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Construction</span></span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier">fsLit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier">mkFastString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier">mkFastStringBytes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteList"><span class="hs-identifier">mkFastStringByteList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-identifier">mkFastString#</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Deconstruction</span></span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier">unpackFS</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- :: FastString -&gt; String</span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unconsFS"><span class="hs-identifier">unconsFS</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- :: FastString -&gt; Maybe (Char, FastString)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Encoding</span></span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#zEncodeFS"><span class="hs-identifier">zEncodeFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Operations</span></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#uniqueOfFS"><span class="hs-identifier">uniqueOfFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier">lengthFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#nullFS"><span class="hs-identifier">nullFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier">appendFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#headFS"><span class="hs-identifier">headFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier">concatFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#consFS"><span class="hs-identifier">consFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier">nilFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#isUnderscoreFS"><span class="hs-identifier">isUnderscoreFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier">lexicalCompareFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier">uniqCompareFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Outputting</span></span><span>
</span><span id="line-94"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#hPutFS"><span class="hs-identifier">hPutFS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Internal</span></span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringTable"><span class="hs-identifier">getFastStringTable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringZEncCounter"><span class="hs-identifier">getFastStringZEncCounter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="hs-comment">-- * PtrStrings</span></span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier">PtrString</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Construction</span></span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier">sLit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-identifier">mkPtrString#</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString"><span class="hs-identifier">mkPtrString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Deconstruction</span></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#unpackPtrString"><span class="hs-identifier">unpackPtrString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Operations</span></span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><a href="GHC.Data.FastString.html#lengthPS"><span class="hs-identifier">lengthPS</span></a></span><span>
</span><span id="line-113"></span><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Prelude.html#"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.2.4/src/GHC-Utils-Encoding.html#"><span class="hs-identifier">GHC.Utils.Encoding</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.IO.Unsafe.html"><span class="hs-identifier">GHC.Utils.IO.Unsafe</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html"><span class="hs-identifier">GHC.Data.FastMutInt</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Concurrent-MVar.html#"><span class="hs-identifier">Control.Concurrent.MVar</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../deepseq-1.4.6.1/src/Control-DeepSeq.html#"><span class="hs-identifier">Control.DeepSeq</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString.html#"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short.html#"><span class="hs-identifier">Data.ByteString.Short</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier">ShortByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString.html#"><span class="hs-identifier">Data.ByteString</span></a></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Char8.html#"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSC</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Unsafe.html#"><span class="hs-identifier">Data.ByteString.Unsafe</span></a></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short.html#"><span class="hs-identifier">Data.ByteString.Short</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span class="hs-cpp">
#if !MIN_VERSION_bytestring(0,11,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Short.Internal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">SBS</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Foreign-C.html#"><span class="hs-identifier">Foreign.C</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/System-IO.html#"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Data.html#"><span class="hs-identifier">Data.Data</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-IORef.html#"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Char.html#"><span class="hs-identifier">Data.Char</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Semigroup.html#"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Semi</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Foreign.html#"><span class="hs-identifier">Foreign</span></a></span><span class="hs-cpp">

#if GHC_STAGE &gt;= 2
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Conc-Sync.html#"><span class="hs-identifier">GHC.Conc.Sync</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Conc-Sync.html#sharedCAF"><span class="hs-identifier">sharedCAF</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 811
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Base</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unpackCString#</span><span class="hs-special">,</span><span class="hs-identifier">unpackNBytes#</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Exts.html#"><span class="hs-identifier">GHC.Exts</span></a></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#"><span class="hs-identifier">GHC.IO</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | Gives the Modified UTF-8 encoded bytes corresponding to a 'FastString'</span><span>
</span><span id="line-157"></span><span class="annot"><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-type">bytesFS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToByteString"><span class="hs-identifier hs-type">fastStringToByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-158"></span><span id="bytesFS"><span class="annot"><span class="annottext">bytesFS :: FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-var hs-var">bytesFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#fastStringToByteString"><span class="hs-identifier hs-var">fastStringToByteString</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">fastStringToByteString</span><span> </span><span class="hs-pragma">&quot;Use `bytesFS` instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-161"></span><span id="fastStringToByteString"><span class="annot"><span class="annottext">fastStringToByteString :: FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#fastStringToByteString"><span class="hs-identifier hs-var hs-var">fastStringToByteString</span></a></span></span><span> </span><span id="local-6989586621680966375"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966375"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#fromShort"><span class="hs-identifier hs-var">SBS.fromShort</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966375"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="GHC.Data.FastString.html#fastStringToShortByteString"><span class="hs-identifier hs-type">fastStringToShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span>
</span><span id="line-164"></span><span id="fastStringToShortByteString"><span class="annot"><span class="annottext">fastStringToShortByteString :: FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fastStringToShortByteString"><span class="hs-identifier hs-var hs-var">fastStringToShortByteString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="GHC.Data.FastString.html#fastZStringToByteString"><span class="hs-identifier hs-type">fastZStringToByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-167"></span><span id="fastZStringToByteString"><span class="annot"><span class="annottext">fastZStringToByteString :: FastZString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#fastZStringToByteString"><span class="hs-identifier hs-var hs-var">fastZStringToByteString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621680966371"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966371"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966371"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- This will drop information if any character &gt; '\xFF'</span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.Data.FastString.html#unsafeMkByteString"><span class="hs-identifier hs-type">unsafeMkByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-171"></span><span id="unsafeMkByteString"><span class="annot"><span class="annottext">unsafeMkByteString :: String -&gt; ByteString
</span><a href="GHC.Data.FastString.html#unsafeMkByteString"><span class="hs-identifier hs-var hs-var">unsafeMkByteString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Char8.html#pack"><span class="hs-identifier hs-var">BSC.pack</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.Data.FastString.html#hashFastString"><span class="hs-identifier hs-type">hashFastString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-174"></span><span id="hashFastString"><span class="annot"><span class="annottext">hashFastString :: FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashFastString"><span class="hs-identifier hs-var hs-var">hashFastString</span></a></span></span><span> </span><span id="local-6989586621680966368"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966368"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-var">hashStr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966368"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">newtype</span><span> </span><span id="FastZString"><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-var">FastZString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastZString"><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-var">FastZString</span></a></span></span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680966365"><span class="annot"><span class="annottext">FastZString -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: FastZString -&gt; ()
$crnf :: FastZString -&gt; ()
</span><a href="../../deepseq-1.4.6.1/src/Control-DeepSeq.html#C%3ANFData"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="GHC.Data.FastString.html#hPutFZS"><span class="hs-identifier hs-type">hPutFZS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO-Handle-Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span id="hPutFZS"><span class="annot"><span class="annottext">hPutFZS :: Handle -&gt; FastZString -&gt; IO ()
</span><a href="GHC.Data.FastString.html#hPutFZS"><span class="hs-identifier hs-var hs-var">hPutFZS</span></a></span></span><span> </span><span id="local-6989586621680966359"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621680966359"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621680966358"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966358"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString.html#hPut"><span class="hs-identifier hs-var">BS.hPut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621680966359"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966358"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><a href="GHC.Data.FastString.html#zString"><span class="hs-identifier hs-type">zString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-185"></span><span id="zString"><span class="annot"><span class="annottext">zString :: FastZString -&gt; String
</span><a href="GHC.Data.FastString.html#zString"><span class="hs-identifier hs-var hs-var">zString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621680966356"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966356"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. ByteString -&gt; (CStringLen -&gt; IO a) -&gt; IO a
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Unsafe.html#unsafeUseAsCStringLen"><span class="hs-identifier hs-var">BS.unsafeUseAsCStringLen</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966356"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">CStringLen -&gt; IO String
</span><a href="../../base-4.16.3.0/src/Foreign-C-String.html#peekCAStringLen"><span class="hs-identifier hs-var">peekCAStringLen</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="GHC.Data.FastString.html#lengthFZS"><span class="hs-identifier hs-type">lengthFZS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-189"></span><span id="lengthFZS"><span class="annot"><span class="annottext">lengthFZS :: FastZString -&gt; Int
</span><a href="GHC.Data.FastString.html#lengthFZS"><span class="hs-identifier hs-var hs-var">lengthFZS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span> </span><span id="local-6989586621680966352"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966352"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString.html#length"><span class="hs-identifier hs-var">BS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680966352"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastZStringString"><span class="hs-identifier hs-type">mkFastZStringString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-192"></span><span id="mkFastZStringString"><span class="annot"><span class="annottext">mkFastZStringString :: String -&gt; FastZString
</span><a href="GHC.Data.FastString.html#mkFastZStringString"><span class="hs-identifier hs-var hs-var">mkFastZStringString</span></a></span></span><span> </span><span id="local-6989586621680966349"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680966349"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-var">FastZString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Char8.html#pack"><span class="hs-identifier hs-var">BSC.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680966349"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">{-| A 'FastString' is a UTF-8 encoded string together with a unique ID. All
'FastString's are stored in a global hashtable to support fast O(1)
comparison.

It is also associated with a lazy reference to the Z-encoding
of this string which is used by the compiler internally.
-}</span><span>
</span><span id="line-203"></span><span class="hs-keyword">data</span><span> </span><span id="FastString"><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-var">FastString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastString"><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-var">FastString</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-204"></span><span>      </span><span id="uniq"><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var hs-var">uniq</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- unique id</span><span>
</span><span id="line-205"></span><span>      </span><span id="n_chars"><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#n_chars"><span class="hs-identifier hs-var hs-var">n_chars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- number of chars</span><span>
</span><span id="line-206"></span><span>      </span><span id="fs_sbs"><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var hs-var">fs_sbs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>      </span><span id="fs_zenc"><span class="annot"><span class="annottext">FastString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#fs_zenc"><span class="hs-identifier hs-var hs-var">fs_zenc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-208"></span><span>      </span><span class="hs-comment">-- ^ Lazily computed Z-encoding of this string. See Note [Z-Encoding] in</span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-comment">-- GHC.Utils.Encoding.</span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span>      </span><span class="hs-comment">-- Since 'FastString's are globally memoized this is computed at most</span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-comment">-- once for any given string.</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966342"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621680966339"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966339"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621680966338"><span class="annot"><span class="annottext">== :: FastString -&gt; FastString -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621680966337"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966337"><span class="hs-identifier hs-var">f2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966339"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966337"><span class="hs-identifier hs-var">f2</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- We don't provide any &quot;Ord FastString&quot; instance to force you to think about</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- which ordering you want:</span><span>
</span><span id="line-220"></span><span class="hs-comment">--    * lexical:   deterministic,     O(n). Cf lexicalCompareFS and LexicalFastString.</span><span>
</span><span id="line-221"></span><span class="hs-comment">--    * by unique: non-deterministic, O(1). Cf uniqCompareFS    and NonDetFastString.</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-String.html#IsString"><span class="hs-identifier hs-type">IsString</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621680966333"><span class="annot"><span class="annottext">fromString :: String -&gt; FastString
</span><a href="../../base-4.16.3.0/src/Data-String.html#fromString"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966328"><span id="local-6989586621680966330"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Semigroup"><span class="hs-identifier hs-type">Semi.Semigroup</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621680966326"><span class="annot"><span class="annottext">&lt;&gt; :: FastString -&gt; FastString -&gt; FastString
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier hs-var">appendFS</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621680966318"><span class="annot"><span class="annottext">mempty :: FastString
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mempty"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier hs-var">nilFS</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621680966316"><span class="annot"><span class="annottext">mappend :: FastString -&gt; FastString -&gt; FastString
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mappend"><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%3E"><span class="hs-operator hs-var">(Semi.&lt;&gt;)</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621680966315"><span class="annot"><span class="annottext">mconcat :: [FastString] -&gt; FastString
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mconcat"><span class="hs-identifier hs-var hs-var hs-var hs-var">mconcat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; FastString
</span><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier hs-var">concatFS</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966310"><span id="local-6989586621680966313"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>   </span><span id="local-6989586621680966304"><span class="annot"><span class="annottext">show :: FastString -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span id="local-6989586621680966302"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966302"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966302"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966275"><span id="local-6989586621680966277"><span id="local-6989586621680966279"><span id="local-6989586621680966281"><span id="local-6989586621680966283"><span id="local-6989586621680966285"><span id="local-6989586621680966287"><span id="local-6989586621680966289"><span id="local-6989586621680966291"><span id="local-6989586621680966293"><span id="local-6989586621680966298"><span class="annot"><a href="../../base-4.16.3.0/src/Data-Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-comment">-- don't traverse?</span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621680966273"><span class="annot"><span class="annottext">toConstr :: FastString -&gt; Constr
</span><a href="../../base-4.16.3.0/src/Data-Data.html#toConstr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toConstr</span></a></span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Constr
</span><a href="GHC.Utils.Misc.html#abstractConstr"><span class="hs-identifier hs-var">abstractConstr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FastString&quot;</span></span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621680966268"><span class="annot"><span class="annottext">gunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c FastString
</span><a href="../../base-4.16.3.0/src/Data-Data.html#gunfold"><span class="hs-identifier hs-var hs-var hs-var hs-var">gunfold</span></a></span></span><span> </span><span class="annot"><span class="annottext">forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">forall r. r -&gt; c r
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;gunfold&quot;</span></span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621680966265"><span class="annot"><span class="annottext">dataTypeOf :: FastString -&gt; DataType
</span><a href="../../base-4.16.3.0/src/Data-Data.html#dataTypeOf"><span class="hs-identifier hs-var hs-var hs-var hs-var">dataTypeOf</span></a></span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DataType
</span><a href="../../base-4.16.3.0/src/Data-Data.html#mkNoRepType"><span class="hs-identifier hs-var">mkNoRepType</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FastString&quot;</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../deepseq-1.4.6.1/src/Control-DeepSeq.html#NFData"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>  </span><span id="local-6989586621680966260"><span class="annot"><span class="annottext">rnf :: FastString -&gt; ()
</span><a href="../../deepseq-1.4.6.1/src/Control-DeepSeq.html#rnf"><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span id="local-6989586621680966258"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966258"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-type">seq</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966258"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-comment">-- | Compare FastString lexically</span><span>
</span><span id="line-247"></span><span class="hs-comment">--</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- If you don't care about the lexical ordering, use `uniqCompareFS` instead.</span><span>
</span><span id="line-249"></span><span class="annot"><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier hs-type">lexicalCompareFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-250"></span><span id="lexicalCompareFS"><span class="annot"><span class="annottext">lexicalCompareFS :: FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier hs-var hs-var">lexicalCompareFS</span></a></span></span><span> </span><span id="local-6989586621680966257"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966257"><span class="hs-identifier hs-var">fs1</span></a></span></span><span> </span><span id="local-6989586621680966256"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966256"><span class="hs-identifier hs-var">fs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966257"><span class="hs-identifier hs-var">fs1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966256"><span class="hs-identifier hs-var">fs2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">ShortByteString -&gt; ShortByteString -&gt; Ordering
</span><a href="../../ghc-boot-9.2.4/src/GHC-Utils-Encoding.html#utf8CompareShortByteString"><span class="hs-identifier hs-var">utf8CompareShortByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966257"><span class="hs-identifier hs-var">fs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966256"><span class="hs-identifier hs-var">fs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-comment">-- perform a lexical comparison taking into account the Modified UTF-8</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-comment">-- encoding we use (cf #18562)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | Compare FastString by their Unique (not lexically).</span><span>
</span><span id="line-257"></span><span class="hs-comment">--</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- Much cheaper than `lexicalCompareFS` but non-deterministic!</span><span>
</span><span id="line-259"></span><span class="annot"><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier hs-type">uniqCompareFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-260"></span><span id="uniqCompareFS"><span class="annot"><span class="annottext">uniqCompareFS :: FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier hs-var hs-var">uniqCompareFS</span></a></span></span><span> </span><span id="local-6989586621680966254"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966254"><span class="hs-identifier hs-var">fs1</span></a></span></span><span> </span><span id="local-6989586621680966253"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966253"><span class="hs-identifier hs-var">fs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966254"><span class="hs-identifier hs-var">fs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966253"><span class="hs-identifier hs-var">fs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Non-deterministic FastString</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- This is a simple FastString wrapper with an Ord instance using</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- `uniqCompareFS` (i.e. which compares FastStrings on their Uniques). Hence it</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- is not deterministic from one run to the other.</span><span>
</span><span id="line-267"></span><span class="hs-keyword">newtype</span><span> </span><span id="NonDetFastString"><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-var">NonDetFastString</span></a></span></span><span>
</span><span id="line-268"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="NonDetFastString"><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-var">NonDetFastString</span></a></span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-269"></span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680966245"><span id="local-6989586621680966249"><span class="annot"><span class="annottext">NonDetFastString -&gt; NonDetFastString -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
$c/= :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
== :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
$c== :: NonDetFastString -&gt; NonDetFastString -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680966210"><span id="local-6989586621680966212"><span id="local-6989586621680966214"><span id="local-6989586621680966216"><span id="local-6989586621680966218"><span id="local-6989586621680966220"><span id="local-6989586621680966222"><span id="local-6989586621680966224"><span id="local-6989586621680966226"><span id="local-6989586621680966228"><span id="local-6989586621680966230"><span id="local-6989586621680966232"><span id="local-6989586621680966235"><span id="local-6989586621680966238"><span class="annot"><span class="annottext">Typeable NonDetFastString
NonDetFastString -&gt; DataType
NonDetFastString -&gt; Constr
(forall b. Data b =&gt; b -&gt; b)
-&gt; NonDetFastString -&gt; NonDetFastString
forall a.
Typeable a
-&gt; (forall (c :: * -&gt; *).
    (forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
    -&gt; (forall g. g -&gt; c g) -&gt; a -&gt; c a)
-&gt; (forall (c :: * -&gt; *).
    (forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
    -&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c a)
-&gt; (a -&gt; Constr)
-&gt; (a -&gt; DataType)
-&gt; (forall (t :: * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d. Data d =&gt; c (t d)) -&gt; Maybe (c a))
-&gt; (forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d e. (Data d, Data e) =&gt; c (t d e)) -&gt; Maybe (c a))
-&gt; ((forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a)
-&gt; (forall r r'.
    (r -&gt; r' -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall r r'.
    (r' -&gt; r -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; [u])
-&gt; (forall u. Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; u)
-&gt; (forall (m :: * -&gt; *).
    Monad m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; Data a
forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; u
forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; [u]
forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c NonDetFastString
forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; NonDetFastString -&gt; c NonDetFastString
forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c NonDetFastString)
forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c NonDetFastString)
gmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
$cgmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
gmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
$cgmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
gmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
$cgmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; NonDetFastString -&gt; m NonDetFastString
gmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; u
$cgmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; u
gmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; [u]
$cgmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; NonDetFastString -&gt; [u]
gmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
$cgmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
gmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
$cgmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; NonDetFastString -&gt; r
gmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; NonDetFastString -&gt; NonDetFastString
$cgmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; NonDetFastString -&gt; NonDetFastString
dataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c NonDetFastString)
$cdataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c NonDetFastString)
dataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c NonDetFastString)
$cdataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c NonDetFastString)
dataTypeOf :: NonDetFastString -&gt; DataType
$cdataTypeOf :: NonDetFastString -&gt; DataType
toConstr :: NonDetFastString -&gt; Constr
$ctoConstr :: NonDetFastString -&gt; Constr
gunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c NonDetFastString
$cgunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c NonDetFastString
gfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; NonDetFastString -&gt; c NonDetFastString
$cgfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; NonDetFastString -&gt; c NonDetFastString
</span><a href="../../base-4.16.3.0/src/Data-Data.html#Data"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Data</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966195"><span id="local-6989586621680966197"><span id="local-6989586621680966199"><span id="local-6989586621680966201"><span id="local-6989586621680966203"><span id="local-6989586621680966205"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>   </span><span id="local-6989586621680966193"><span class="annot"><span class="annottext">compare :: NonDetFastString -&gt; NonDetFastString -&gt; Ordering
</span><a href="#local-6989586621680966193"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span><span> </span><span id="local-6989586621680966192"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966192"><span class="hs-identifier hs-var">fs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span><span> </span><span id="local-6989586621680966191"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966191"><span class="hs-identifier hs-var">fs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#uniqCompareFS"><span class="hs-identifier hs-var">uniqCompareFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966192"><span class="hs-identifier hs-var">fs1</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966191"><span class="hs-identifier hs-var">fs2</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966186"><span id="local-6989586621680966189"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>   </span><span id="local-6989586621680966184"><span class="annot"><span class="annottext">show :: NonDetFastString -&gt; String
</span><a href="#local-6989586621680966184"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#NonDetFastString"><span class="hs-identifier hs-type">NonDetFastString</span></a></span><span> </span><span id="local-6989586621680966183"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966183"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966183"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-comment">-- | Lexical FastString</span><span>
</span><span id="line-278"></span><span class="hs-comment">--</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- This is a simple FastString wrapper with an Ord instance using</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- `lexicalCompareFS` (i.e. which compares FastStrings on their String</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- representation). Hence it is deterministic from one run to the other.</span><span>
</span><span id="line-282"></span><span class="hs-keyword">newtype</span><span> </span><span id="LexicalFastString"><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-var">LexicalFastString</span></a></span></span><span>
</span><span id="line-283"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="LexicalFastString"><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-var">LexicalFastString</span></a></span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-284"></span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680966176"><span id="local-6989586621680966180"><span class="annot"><span class="annottext">LexicalFastString -&gt; LexicalFastString -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
$c/= :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
== :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
$c== :: LexicalFastString -&gt; LexicalFastString -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680966141"><span id="local-6989586621680966143"><span id="local-6989586621680966145"><span id="local-6989586621680966147"><span id="local-6989586621680966149"><span id="local-6989586621680966151"><span id="local-6989586621680966153"><span id="local-6989586621680966155"><span id="local-6989586621680966157"><span id="local-6989586621680966159"><span id="local-6989586621680966161"><span id="local-6989586621680966163"><span id="local-6989586621680966166"><span id="local-6989586621680966169"><span class="annot"><span class="annottext">Typeable LexicalFastString
LexicalFastString -&gt; DataType
LexicalFastString -&gt; Constr
(forall b. Data b =&gt; b -&gt; b)
-&gt; LexicalFastString -&gt; LexicalFastString
forall a.
Typeable a
-&gt; (forall (c :: * -&gt; *).
    (forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
    -&gt; (forall g. g -&gt; c g) -&gt; a -&gt; c a)
-&gt; (forall (c :: * -&gt; *).
    (forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
    -&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c a)
-&gt; (a -&gt; Constr)
-&gt; (a -&gt; DataType)
-&gt; (forall (t :: * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d. Data d =&gt; c (t d)) -&gt; Maybe (c a))
-&gt; (forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
    Typeable t =&gt;
    (forall d e. (Data d, Data e) =&gt; c (t d e)) -&gt; Maybe (c a))
-&gt; ((forall b. Data b =&gt; b -&gt; b) -&gt; a -&gt; a)
-&gt; (forall r r'.
    (r -&gt; r' -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall r r'.
    (r' -&gt; r -&gt; r) -&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; a -&gt; r)
-&gt; (forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; [u])
-&gt; (forall u. Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; a -&gt; u)
-&gt; (forall (m :: * -&gt; *).
    Monad m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; (forall (m :: * -&gt; *).
    MonadPlus m =&gt;
    (forall d. Data d =&gt; d -&gt; m d) -&gt; a -&gt; m a)
-&gt; Data a
forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; u
forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; [u]
forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c LexicalFastString
forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; LexicalFastString -&gt; c LexicalFastString
forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c LexicalFastString)
forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c LexicalFastString)
gmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
$cgmapMo :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
gmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
$cgmapMp :: forall (m :: * -&gt; *).
MonadPlus m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
gmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
$cgmapM :: forall (m :: * -&gt; *).
Monad m =&gt;
(forall d. Data d =&gt; d -&gt; m d)
-&gt; LexicalFastString -&gt; m LexicalFastString
gmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; u
$cgmapQi :: forall u.
Int -&gt; (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; u
gmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; [u]
$cgmapQ :: forall u. (forall d. Data d =&gt; d -&gt; u) -&gt; LexicalFastString -&gt; [u]
gmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
$cgmapQr :: forall r r'.
(r' -&gt; r -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
gmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
$cgmapQl :: forall r r'.
(r -&gt; r' -&gt; r)
-&gt; r -&gt; (forall d. Data d =&gt; d -&gt; r') -&gt; LexicalFastString -&gt; r
gmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; LexicalFastString -&gt; LexicalFastString
$cgmapT :: (forall b. Data b =&gt; b -&gt; b)
-&gt; LexicalFastString -&gt; LexicalFastString
dataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c LexicalFastString)
$cdataCast2 :: forall (t :: * -&gt; * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d e. (Data d, Data e) =&gt; c (t d e))
-&gt; Maybe (c LexicalFastString)
dataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c LexicalFastString)
$cdataCast1 :: forall (t :: * -&gt; *) (c :: * -&gt; *).
Typeable t =&gt;
(forall d. Data d =&gt; c (t d)) -&gt; Maybe (c LexicalFastString)
dataTypeOf :: LexicalFastString -&gt; DataType
$cdataTypeOf :: LexicalFastString -&gt; DataType
toConstr :: LexicalFastString -&gt; Constr
$ctoConstr :: LexicalFastString -&gt; Constr
gunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c LexicalFastString
$cgunfold :: forall (c :: * -&gt; *).
(forall b r. Data b =&gt; c (b -&gt; r) -&gt; c r)
-&gt; (forall r. r -&gt; c r) -&gt; Constr -&gt; c LexicalFastString
gfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; LexicalFastString -&gt; c LexicalFastString
$cgfoldl :: forall (c :: * -&gt; *).
(forall d b. Data d =&gt; c (d -&gt; b) -&gt; d -&gt; c b)
-&gt; (forall g. g -&gt; c g) -&gt; LexicalFastString -&gt; c LexicalFastString
</span><a href="../../base-4.16.3.0/src/Data-Data.html#Data"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Data</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966126"><span id="local-6989586621680966128"><span id="local-6989586621680966130"><span id="local-6989586621680966132"><span id="local-6989586621680966134"><span id="local-6989586621680966136"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>   </span><span id="local-6989586621680966125"><span class="annot"><span class="annottext">compare :: LexicalFastString -&gt; LexicalFastString -&gt; Ordering
</span><a href="#local-6989586621680966125"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span id="local-6989586621680966124"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966124"><span class="hs-identifier hs-var">fs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span id="local-6989586621680966123"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966123"><span class="hs-identifier hs-var">fs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastString -&gt; Ordering
</span><a href="GHC.Data.FastString.html#lexicalCompareFS"><span class="hs-identifier hs-var">lexicalCompareFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966124"><span class="hs-identifier hs-var">fs1</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966123"><span class="hs-identifier hs-var">fs2</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680966118"><span id="local-6989586621680966121"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>   </span><span id="local-6989586621680966116"><span class="annot"><span class="annottext">show :: LexicalFastString -&gt; String
</span><a href="#local-6989586621680966116"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#LexicalFastString"><span class="hs-identifier hs-type">LexicalFastString</span></a></span><span> </span><span id="local-6989586621680966115"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966115"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966115"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- Construction</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">{-
Internally, the compiler will maintain a fast string symbol table, providing
sharing and fast comparison. Creation of new @FastString@s then covertly does a
lookup, re-using the @FastString@ if there was a hit.

The design of the FastString hash table allows for lockless concurrent reads
and updates to multiple buckets with low synchronization overhead.

See Note [Updating the FastString table] on how it's updated.
-}</span><span>
</span><span id="line-305"></span><span class="hs-keyword">data</span><span> </span><span id="FastStringTable"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-var">FastStringTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastStringTable"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-var">FastStringTable</span></a></span></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-comment">-- the unique ID counter shared with all buckets</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-comment">-- number of computed z-encodings for all buckets</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Array#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- concurrent segments</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-keyword">data</span><span> </span><span id="FastStringTableSegment"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FastStringTableSegment"><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- the lock for write in each segment</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-comment">-- the number of elements</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- buckets in this segment</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">{-
Following parameters are determined based on:

* Benchmark based on testsuite/tests/utils/should_run/T14854.hs
* Stats of @echo :browse | ghc --interactive -dfaststring-stats &gt;/dev/null@:
  on 2018-10-24, we have 13920 entries.
-}</span><span>
</span><span id="line-322"></span><span class="annot"><a href="GHC.Data.FastString.html#segmentBits"><span class="hs-identifier hs-type">segmentBits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-type">numSegments</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#segmentMask"><span class="hs-identifier hs-type">segmentMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#initialNumBuckets"><span class="hs-identifier hs-type">initialNumBuckets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-323"></span><span id="segmentBits"><span class="annot"><span class="annottext">segmentBits :: Int
</span><a href="GHC.Data.FastString.html#segmentBits"><span class="hs-identifier hs-var hs-var">segmentBits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-324"></span><span id="numSegments"><span class="annot"><span class="annottext">numSegments :: Int
</span><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-var hs-var">numSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">256</span></span><span>   </span><span class="hs-comment">-- bit segmentBits</span><span>
</span><span id="line-325"></span><span id="segmentMask"><span class="annot"><span class="annottext">segmentMask :: Int
</span><a href="GHC.Data.FastString.html#segmentMask"><span class="hs-identifier hs-var hs-var">segmentMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0xff</span></span><span>  </span><span class="hs-comment">-- bit segmentBits - 1</span><span>
</span><span id="line-326"></span><span id="initialNumBuckets"><span class="annot"><span class="annottext">initialNumBuckets :: Int
</span><a href="GHC.Data.FastString.html#initialNumBuckets"><span class="hs-identifier hs-var hs-var">initialNumBuckets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">64</span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="annot"><a href="GHC.Data.FastString.html#hashToSegment%23"><span class="hs-identifier hs-type">hashToSegment#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span>
</span><span id="line-329"></span><span id="hashToSegment%23"><span class="annot"><span class="annottext">hashToSegment# :: Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToSegment%23"><span class="hs-identifier hs-var hs-var">hashToSegment#</span></a></span></span><span> </span><span id="local-6989586621680966107"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966107"><span class="hs-identifier hs-var">hash#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966107"><span class="hs-identifier hs-var">hash#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`andI#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966106"><span class="hs-identifier hs-var">segmentMask#</span></a></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966106"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966106"><span class="hs-identifier hs-var">segmentMask#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#segmentMask"><span class="hs-identifier hs-var">segmentMask</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="annot"><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-type">hashToIndex#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span>
</span><span id="line-334"></span><span id="hashToIndex%23"><span class="annot"><span class="annottext">hashToIndex# :: MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var hs-var">hashToIndex#</span></a></span></span><span> </span><span id="local-6989586621680966104"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966104"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span id="local-6989586621680966103"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966103"><span class="hs-identifier hs-var">hash#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966103"><span class="hs-identifier hs-var">hash#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`uncheckedIShiftRL#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966102"><span class="hs-identifier hs-var">segmentBits#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`remInt#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966101"><span class="hs-identifier hs-var">size#</span></a></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966102"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966102"><span class="hs-identifier hs-var">segmentBits#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#segmentBits"><span class="hs-identifier hs-var">segmentBits</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621680966101"><span class="annot"><span class="annottext">size# :: Int#
</span><a href="#local-6989586621680966101"><span class="hs-identifier hs-var hs-var">size#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall d a. MutableArray# d a -&gt; Int#
</span><span class="hs-identifier hs-var">sizeofMutableArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966104"><span class="hs-identifier hs-var">buckets#</span></a></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="annot"><a href="GHC.Data.FastString.html#maybeResizeSegment"><span class="hs-identifier hs-type">maybeResizeSegment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span>
</span><span id="line-341"></span><span id="maybeResizeSegment"><span class="annot"><span class="annottext">maybeResizeSegment :: IORef FastStringTableSegment -&gt; IO FastStringTableSegment
</span><a href="GHC.Data.FastString.html#maybeResizeSegment"><span class="hs-identifier hs-var hs-var">maybeResizeSegment</span></a></span></span><span> </span><span id="local-6989586621680966099"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966099"><span class="hs-identifier hs-var">segmentRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621680966098"><span class="annot"><span class="annottext">segment :: FastStringTableSegment
</span><a href="#local-6989586621680966098"><span class="hs-identifier hs-var">segment</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span id="local-6989586621680966097"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680966097"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span id="local-6989586621680966096"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966096"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span id="local-6989586621680966095"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966095"><span class="hs-identifier hs-var">old#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966099"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680966093"><span class="annot"><span class="annottext">oldSize# :: Int#
</span><a href="#local-6989586621680966093"><span class="hs-identifier hs-var hs-var">oldSize#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall d a. MutableArray# d a -&gt; Int#
</span><span class="hs-identifier hs-var">sizeofMutableArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966095"><span class="hs-identifier hs-var">old#</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span id="local-6989586621680966092"><span class="annot"><span class="annottext">newSize# :: Int#
</span><a href="#local-6989586621680966092"><span class="hs-identifier hs-var hs-var">newSize#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966093"><span class="hs-identifier hs-var">oldSize#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">*#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">2#</span></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966091"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966091"><span class="hs-identifier hs-var">n#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#readFastMutInt"><span class="hs-identifier hs-var">readFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966096"><span class="hs-identifier hs-var">counter</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Bool
</span><span class="hs-identifier hs-var">isTrue#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966091"><span class="hs-identifier hs-var">n#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">&lt;#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966092"><span class="hs-identifier hs-var">newSize#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- maximum load of 1</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FastStringTableSegment
</span><a href="#local-6989586621680966098"><span class="hs-identifier hs-var">segment</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621680966088"><span class="annot"><span class="annottext">resizedSegment :: FastStringTableSegment
</span><a href="#local-6989586621680966088"><span class="hs-identifier hs-var">resizedSegment</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680966087"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966087"><span class="hs-identifier hs-var">new#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680966086"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966086"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a d.
Int# -&gt; a -&gt; State# d -&gt; (# State# d, MutableArray# d a #)
</span><span class="hs-identifier hs-var">newArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966092"><span class="hs-identifier hs-var">newSize#</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966086"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-351"></span><span>        </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966085"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966085"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966084"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966084"><span class="hs-identifier hs-var">arr#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966085"><span class="hs-identifier hs-var">s2#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MVar ()
-&gt; FastMutInt
-&gt; MutableArray# RealWorld [FastString]
-&gt; FastStringTableSegment
</span><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680966097"><span class="hs-identifier hs-var">lock</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966096"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966084"><span class="hs-identifier hs-var">arr#</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966093"><span class="hs-identifier hs-var">oldSize#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966082"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966082"><span class="hs-identifier hs-var">i#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>      </span><span id="local-6989586621680966081"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966081"><span class="hs-identifier hs-var">fsList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966095"><span class="hs-identifier hs-var">old#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966082"><span class="hs-identifier hs-var">i#</span></a></span><span>
</span><span id="line-354"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966081"><span class="hs-identifier hs-var">fsList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680966080"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966080"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Shall we store in hash value in FastString instead?</span><span>
</span><span id="line-356"></span><span>            </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966079"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966079"><span class="hs-identifier hs-var">hash#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashFastString"><span class="hs-identifier hs-var">hashFastString</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966080"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-357"></span><span>            </span><span id="local-6989586621680966078"><span class="annot"><span class="annottext">idx# :: Int#
</span><a href="#local-6989586621680966078"><span class="hs-identifier hs-var hs-var">idx#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var">hashToIndex#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966087"><span class="hs-identifier hs-var">new#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966079"><span class="hs-identifier hs-var">hash#</span></a></span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680966077"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966077"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966087"><span class="hs-identifier hs-var">new#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966078"><span class="hs-identifier hs-var">idx#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966077"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>            </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966076"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966076"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966075"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966075"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d a. MutableArray# d a -&gt; Int# -&gt; a -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">writeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966087"><span class="hs-identifier hs-var">new#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966078"><span class="hs-identifier hs-var">idx#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966080"><span class="hs-identifier hs-var">fs</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966075"><span class="hs-identifier hs-var">bucket</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966076"><span class="hs-identifier hs-var">s2#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>              </span><span id="local-6989586621680966074"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966074"><span class="hs-identifier hs-var">s3#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966074"><span class="hs-identifier hs-var">s3#</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; a -&gt; IO ()
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966099"><span class="hs-identifier hs-var">segmentRef</span></a></span><span> </span><span class="annot"><span class="annottext">FastStringTableSegment
</span><a href="#local-6989586621680966088"><span class="hs-identifier hs-var">resizedSegment</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FastStringTableSegment
</span><a href="#local-6989586621680966088"><span class="hs-identifier hs-var">resizedSegment</span></a></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#stringTable"><span class="hs-pragma hs-type">stringTable</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-366"></span><span class="annot"><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-type">stringTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span>
</span><span id="line-367"></span><span id="stringTable"><span class="annot"><span class="annottext">stringTable :: FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var hs-var">stringTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-IO-Unsafe.html#unsafePerformIO"><span class="hs-identifier hs-var">unsafePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966070"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966070"><span class="hs-identifier hs-var">numSegments#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-var">numSegments</span></a></span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966069"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966069"><span class="hs-identifier hs-var">initialNumBuckets#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#initialNumBuckets"><span class="hs-identifier hs-var">initialNumBuckets</span></a></span><span>
</span><span id="line-370"></span><span>      </span><span id="local-6989586621680966068"><span class="annot"><span class="annottext">loop :: MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; Int# -&gt; State# RealWorld -&gt; State# RealWorld
</span><a href="#local-6989586621680966068"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621680966067"><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966067"><span class="hs-identifier hs-var">a#</span></a></span></span><span> </span><span id="local-6989586621680966066"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966066"><span class="hs-identifier hs-var">i#</span></a></span></span><span> </span><span id="local-6989586621680966065"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966065"><span class="hs-identifier hs-var">s1#</span></a></span></span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Bool
</span><span class="hs-identifier hs-var">isTrue#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966066"><span class="hs-identifier hs-var">i#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">==#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966070"><span class="hs-identifier hs-var">numSegments#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966065"><span class="hs-identifier hs-var">s1#</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (MVar a)
</span><a href="../../base-4.16.3.0/src/GHC-MVar.html#newMVar"><span class="hs-identifier hs-var">newMVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#unIO"><span class="hs-operator hs-var">`unIO`</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966065"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966062"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966062"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966061"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680966061"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO FastMutInt
</span><a href="GHC.Data.FastMutInt.html#newFastMutInt"><span class="hs-identifier hs-var">newFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#unIO"><span class="hs-operator hs-var">`unIO`</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966062"><span class="hs-identifier hs-var">s2#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>              </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966059"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966059"><span class="hs-identifier hs-var">s3#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966058"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966058"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a d.
Int# -&gt; a -&gt; State# d -&gt; (# State# d, MutableArray# d a #)
</span><span class="hs-identifier hs-var">newArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966069"><span class="hs-identifier hs-var">initialNumBuckets#</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966059"><span class="hs-identifier hs-var">s3#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-375"></span><span>                </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966057"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966057"><span class="hs-identifier hs-var">s4#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966056"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966056"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span>
</span><span id="line-376"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar ()
-&gt; FastMutInt
-&gt; MutableArray# RealWorld [FastString]
-&gt; FastStringTableSegment
</span><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-var">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680966061"><span class="hs-identifier hs-var">lock</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966058"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966056"><span class="hs-identifier hs-var">buckets#</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#unIO"><span class="hs-operator hs-var">`unIO`</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966057"><span class="hs-identifier hs-var">s4#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-377"></span><span>                  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966054"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966054"><span class="hs-identifier hs-var">s5#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966053"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966053"><span class="hs-identifier hs-var">segment</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d a. MutableArray# d a -&gt; Int# -&gt; a -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">writeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966067"><span class="hs-identifier hs-var">a#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966066"><span class="hs-identifier hs-var">i#</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966053"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966054"><span class="hs-identifier hs-var">s5#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-378"></span><span>                    </span><span id="local-6989586621680966052"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966052"><span class="hs-identifier hs-var">s6#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; Int# -&gt; State# RealWorld -&gt; State# RealWorld
</span><a href="#local-6989586621680966068"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966067"><span class="hs-identifier hs-var">a#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966066"><span class="hs-identifier hs-var">i#</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">+#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966052"><span class="hs-identifier hs-var">s6#</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621680966051"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966051"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO FastMutInt
</span><a href="GHC.Data.FastMutInt.html#newFastMutInt"><span class="hs-identifier hs-var">newFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">603979776</span></span><span> </span><span class="hs-comment">-- ord '$' * 0x01000000</span><span>
</span><span id="line-380"></span><span>  </span><span id="local-6989586621680966050"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966050"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO FastMutInt
</span><a href="GHC.Data.FastMutInt.html#newFastMutInt"><span class="hs-identifier hs-var">newFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-381"></span><span>  </span><span id="local-6989586621680966049"><span class="annot"><span class="annottext">FastStringTable
</span><a href="#local-6989586621680966049"><span class="hs-identifier hs-var">tab</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680966048"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966048"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a d.
Int# -&gt; a -&gt; State# d -&gt; (# State# d, MutableArray# d a #)
</span><span class="hs-identifier hs-var">newArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966070"><span class="hs-identifier hs-var">numSegments#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;string_table&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966048"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-383"></span><span>      </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966046"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966046"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966045"><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966045"><span class="hs-identifier hs-var">arr#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
-&gt; Int# -&gt; State# RealWorld -&gt; State# RealWorld
</span><a href="#local-6989586621680966068"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966045"><span class="hs-identifier hs-var">arr#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966046"><span class="hs-identifier hs-var">s2#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-384"></span><span>        </span><span id="local-6989586621680966044"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966044"><span class="hs-identifier hs-var">s3#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d a.
MutableArray# d a -&gt; State# d -&gt; (# State# d, Array# a #)
</span><span class="hs-identifier hs-var">unsafeFreezeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966045"><span class="hs-identifier hs-var">arr#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966044"><span class="hs-identifier hs-var">s3#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-385"></span><span>          </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966043"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966043"><span class="hs-identifier hs-var">s4#</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680966042"><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966042"><span class="hs-identifier hs-var">segments#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-386"></span><span>            </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966043"><span class="hs-identifier hs-var">s4#</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FastMutInt
-&gt; FastMutInt
-&gt; Array# (IORef FastStringTableSegment)
-&gt; FastStringTable
</span><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-var">FastStringTable</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966051"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966050"><span class="hs-identifier hs-var">n_zencs</span></a></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966042"><span class="hs-identifier hs-var">segments#</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-comment">-- use the support wired into the RTS to share this CAF among all images of</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-comment">-- libHSghc</span><span class="hs-cpp">
#if GHC_STAGE &lt; 2
</span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">tab</span><span class="hs-cpp">
#else
</span><span>  </span><span class="annot"><span class="annottext">forall a. a -&gt; (Ptr a -&gt; IO (Ptr a)) -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-Conc-Sync.html#sharedCAF"><span class="hs-identifier hs-var">sharedCAF</span></a></span><span> </span><span class="annot"><span class="annottext">FastStringTable
</span><a href="#local-6989586621680966049"><span class="hs-identifier hs-var">tab</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; IO (Ptr a)
</span><a href="GHC.Data.FastString.html#getOrSetLibHSghcFastStringTable"><span class="hs-identifier hs-var">getOrSetLibHSghcFastStringTable</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="hs-comment">-- from the RTS; thus we cannot use this mechanism when GHC_STAGE&lt;2; the previous</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- RTS might not have this symbol</span><span>
</span><span id="line-397"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;getOrSetLibHSghcFastStringTable&quot;</span></span><span>
</span><span id="line-398"></span><span>  </span><span id="getOrSetLibHSghcFastStringTable"><span class="annot"><a href="GHC.Data.FastString.html#getOrSetLibHSghcFastStringTable"><span class="hs-identifier hs-var">getOrSetLibHSghcFastStringTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621680966685"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966685"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966685"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-401"></span><span class="hs-comment">{-

We include the FastString table in the `sharedCAF` mechanism because we'd like
FastStrings created by a Core plugin to have the same uniques as corresponding
strings created by the host compiler itself.  For example, this allows plugins
to lookup known names (eg `mkTcOcc &quot;MySpecialType&quot;`) in the GlobalRdrEnv or
even re-invoke the parser.

In particular, the following little sanity test was failing in a plugin
prototyping safe newtype-coercions: GHC.NT.Type.NT was imported, but could not
be looked up /by the plugin/.

   let rdrName = mkModuleName &quot;GHC.NT.Type&quot; `mkRdrQual` mkTcOcc &quot;NT&quot;
   putMsgS $ showSDoc dflags $ ppr $ lookupGRE_RdrName rdrName $ mg_rdr_env guts

`mkTcOcc` involves the lookup (or creation) of a FastString.  Since the
plugin's FastString.string_table is empty, constructing the RdrName also
allocates new uniques for the FastStrings &quot;GHC.NT.Type&quot; and &quot;NT&quot;.  These
uniques are almost certainly unequal to the ones that the host compiler
originally assigned to those FastStrings.  Thus the lookup fails since the
domain of the GlobalRdrEnv is affected by the RdrName's OccName's FastString's
unique.

Maintaining synchronization of the two instances of this global is rather
difficult because of the uses of `unsafePerformIO` in this module.  Not
synchronizing them risks breaking the rather major invariant that two
FastStrings with the same unique have the same string. Thus we use the
lower-level `sharedCAF` mechanism that relies on Globals.c.

-}</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-identifier hs-type">mkFastString#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Addr#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-433"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-pragma hs-type">mkFastString#</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-434"></span><span id="mkFastString%23"><span class="annot"><span class="annottext">mkFastString# :: Addr# -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-identifier hs-var hs-var">mkFastString#</span></a></span></span><span> </span><span id="local-6989586621680966040"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680966040"><span class="hs-identifier hs-var">a#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier hs-var">mkFastStringBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621680966039"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int
</span><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-var">ptrStrLength</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621680966039"><span class="hs-identifier hs-var">ptr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680966039"><span class="annot"><span class="annottext">ptr :: Ptr Word8
</span><a href="#local-6989586621680966039"><span class="hs-identifier hs-var hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Addr# -&gt; Ptr a
</span><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-var">Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680966040"><span class="hs-identifier hs-var">a#</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="hs-comment">{- Note [Updating the FastString table]

We use a concurrent hashtable which contains multiple segments, each hash value
always maps to the same segment. Read is lock-free, write to the a segment
should acquire a lock for that segment to avoid race condition, writes to
different segments are independent.

The procedure goes like this:

1. Find out which segment to operate on based on the hash value
2. Read the relevant bucket and perform a look up of the string.
3. If it exists, return it.
4. Otherwise grab a unique ID, create a new FastString and atomically attempt
   to update the relevant segment with this FastString:

   * Resize the segment by doubling the number of buckets when the number of
     FastStrings in this segment grows beyond the threshold.
   * Double check that the string is not in the bucket. Another thread may have
     inserted it while we were creating our string.
   * Return the existing FastString if it exists. The one we preemptively
     created will get GCed.
   * Otherwise, insert and return the string we created.
-}</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-type">mkFastStringWith</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-463"></span><span id="mkFastStringWith"><span class="annot"><span class="annottext">mkFastStringWith :: (Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var hs-var">mkFastStringWith</span></a></span></span><span> </span><span id="local-6989586621680966035"><span class="annot"><span class="annottext">Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="#local-6989586621680966035"><span class="hs-identifier hs-var">mk_fs</span></a></span></span><span> </span><span id="local-6989586621680966034"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966034"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span id="local-6989586621680966033"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680966033"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680966032"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966032"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966031"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680966030"><span class="annot"><span class="annottext">idx# :: Int#
</span><a href="#local-6989586621680966030"><span class="hs-identifier hs-var hs-var">idx#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var">hashToIndex#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966032"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966029"><span class="hs-identifier hs-var">hash#</span></a></span><span>
</span><span id="line-466"></span><span>  </span><span id="local-6989586621680966028"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966028"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966032"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966030"><span class="hs-identifier hs-var">idx#</span></a></span><span>
</span><span id="line-467"></span><span>  </span><span id="local-6989586621680966027"><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621680966027"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; ShortByteString -&gt; IO (Maybe FastString)
</span><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-var">bucket_match</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966028"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966034"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621680966027"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680966025"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966025"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966025"><span class="hs-identifier hs-var">found</span></a></span><span>
</span><span id="line-470"></span><span>    </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-471"></span><span>      </span><span class="hs-comment">-- The withMVar below is not dupable. It can lead to deadlock if it is</span><span>
</span><span id="line-472"></span><span>      </span><span class="hs-comment">-- only run partially and putMVar is not called after takeMVar.</span><span>
</span><span id="line-473"></span><span>      </span><span class="annot"><span class="annottext">IO ()
</span><a href="../../base-4.16.3.0/src/GHC-IO-Unsafe.html#noDuplicate"><span class="hs-identifier hs-var">noDuplicate</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span id="local-6989586621680966023"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680966023"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621680966022"><span class="hs-identifier hs-var">get_uid</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span id="local-6989586621680966021"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966021"><span class="hs-identifier hs-var">new_fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="#local-6989586621680966035"><span class="hs-identifier hs-var">mk_fs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680966023"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966020"><span class="hs-identifier hs-var">n_zencs</span></a></span><span>
</span><span id="line-476"></span><span>      </span><span class="annot"><span class="annottext">forall a b. MVar a -&gt; (a -&gt; IO b) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/Control-Concurrent-MVar.html#withMVar"><span class="hs-identifier hs-var">withMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621680966033"><span class="hs-identifier hs-var">lock</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; IO FastString
</span><a href="#local-6989586621680966018"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966021"><span class="hs-identifier hs-var">new_fs</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span> </span><span id="local-6989586621680966017"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966017"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621680966020"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966020"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span id="local-6989586621680966016"><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966016"><span class="hs-identifier hs-var">segments#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var">stringTable</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span id="local-6989586621680966022"><span class="annot"><span class="annottext">get_uid :: IO Int
</span><a href="#local-6989586621680966022"><span class="hs-identifier hs-var hs-var">get_uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; Int -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#atomicFetchAddFastMut"><span class="hs-identifier hs-var">atomicFetchAddFastMut</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966017"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680966029"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966029"><span class="hs-identifier hs-var">hash#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-var">hashStr</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966034"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680966031"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966031"><span class="hs-identifier hs-var">segmentRef</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Array# a -&gt; Int# -&gt; (# a #)
</span><span class="hs-identifier hs-var">indexArray#</span></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621680966016"><span class="hs-identifier hs-var">segments#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToSegment%23"><span class="hs-identifier hs-var">hashToSegment#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966029"><span class="hs-identifier hs-var">hash#</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>    </span><span id="local-6989586621680966018"><span class="annot"><span class="annottext">insert :: FastString -&gt; IO FastString
</span><a href="#local-6989586621680966018"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span id="local-6989586621680966014"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966014"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-484"></span><span>      </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680966013"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966013"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span id="local-6989586621680966012"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966012"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment -&gt; IO FastStringTableSegment
</span><a href="GHC.Data.FastString.html#maybeResizeSegment"><span class="hs-identifier hs-var">maybeResizeSegment</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680966031"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680966011"><span class="annot"><span class="annottext">idx# :: Int#
</span><a href="#local-6989586621680966011"><span class="hs-identifier hs-var hs-var">idx#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString] -&gt; Int# -&gt; Int#
</span><a href="GHC.Data.FastString.html#hashToIndex%23"><span class="hs-identifier hs-var">hashToIndex#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966012"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966029"><span class="hs-identifier hs-var">hash#</span></a></span><span>
</span><span id="line-486"></span><span>      </span><span id="local-6989586621680966010"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966010"><span class="hs-identifier hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966012"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966011"><span class="hs-identifier hs-var">idx#</span></a></span><span>
</span><span id="line-487"></span><span>      </span><span id="local-6989586621680966009"><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621680966009"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FastString] -&gt; ShortByteString -&gt; IO (Maybe FastString)
</span><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-var">bucket_match</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966010"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966034"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-488"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621680966009"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-489"></span><span>        </span><span class="hs-comment">-- The FastString was added by another thread after previous read and</span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-comment">-- before we acquired the write lock.</span><span>
</span><span id="line-491"></span><span>        </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680966008"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966008"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966008"><span class="hs-identifier hs-var">found</span></a></span><span>
</span><span id="line-492"></span><span>        </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>          </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680966007"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966007"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-494"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d a. MutableArray# d a -&gt; Int# -&gt; a -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">writeArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680966012"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680966011"><span class="hs-identifier hs-var">idx#</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966014"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966010"><span class="hs-identifier hs-var">bucket</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966007"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-495"></span><span>              </span><span id="local-6989586621680966006"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966006"><span class="hs-identifier hs-var">s2#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680966006"><span class="hs-identifier hs-var">s2#</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-496"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; Int -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#atomicFetchAddFastMut"><span class="hs-identifier hs-var">atomicFetchAddFastMut</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680966013"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-497"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966014"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span class="annot"><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-type">bucket_match</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span id="bucket_match"><span class="annot"><span class="annottext">bucket_match :: [FastString] -&gt; ShortByteString -&gt; IO (Maybe FastString)
</span><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-var hs-var">bucket_match</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-501"></span><span class="annot"><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-var">bucket_match</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680966005"><span class="annot"><span class="annottext">fs :: FastString
</span><a href="#local-6989586621680966005"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">fs_sbs :: FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680966004"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966004"><span class="hs-identifier hs-var">fs_sbs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680966003"><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966003"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680966002"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966002"><span class="hs-identifier hs-var">sbs</span></a></span></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966004"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966002"><span class="hs-identifier hs-var">sbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680966005"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[FastString] -&gt; ShortByteString -&gt; IO (Maybe FastString)
</span><a href="GHC.Data.FastString.html#bucket_match"><span class="hs-identifier hs-var">bucket_match</span></a></span><span> </span><span class="annot"><span class="annottext">[FastString]
</span><a href="#local-6989586621680966003"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680966002"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier hs-type">mkFastStringBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-506"></span><span id="mkFastStringBytes"><span class="annot"><span class="annottext">mkFastStringBytes :: Ptr Word8 -&gt; Int -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringBytes"><span class="hs-identifier hs-var hs-var">mkFastStringBytes</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680966001"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621680966001"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680966000"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680966000"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-comment">-- NB: Might as well use unsafeDupablePerformIO, since mkFastStringWith is</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-comment">-- idempotent.</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-IO-Unsafe.html#unsafeDupablePerformIO"><span class="hs-identifier hs-var">unsafeDupablePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-510"></span><span>        </span><span id="local-6989586621680965998"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965998"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; Int -&gt; IO ShortByteString
</span><a href="GHC.Data.FastString.html#newSBSFromPtr"><span class="hs-identifier hs-var">newSBSFromPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621680966001"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680966000"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-511"></span><span>        </span><span class="annot"><span class="annottext">(Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965998"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965998"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span id="local-6989586621680966681"><span class="annot"><a href="GHC.Data.FastString.html#newSBSFromPtr"><span class="hs-identifier hs-type">newSBSFromPtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680966681"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span></span><span>
</span><span id="line-514"></span><span id="newSBSFromPtr"><span class="annot"><span class="annottext">newSBSFromPtr :: forall a. Ptr a -&gt; Int -&gt; IO ShortByteString
</span><a href="GHC.Data.FastString.html#newSBSFromPtr"><span class="hs-identifier hs-var hs-var">newSBSFromPtr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span id="local-6989586621680965995"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965995"><span class="hs-identifier hs-var">src#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680965994"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965994"><span class="hs-identifier hs-var">len#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-515"></span><span>  </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680965993"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965993"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d. Int# -&gt; State# d -&gt; (# State# d, MutableByteArray# d #)
</span><span class="hs-identifier hs-var">newByteArray#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965994"><span class="hs-identifier hs-var">len#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965993"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680965992"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965992"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680965991"><span class="annot"><span class="annottext">MutableByteArray# RealWorld
</span><a href="#local-6989586621680965991"><span class="hs-identifier hs-var">dst#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d.
Addr#
-&gt; MutableByteArray# d -&gt; Int# -&gt; Int# -&gt; State# d -&gt; State# d
</span><span class="hs-identifier hs-var">copyAddrToByteArray#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965995"><span class="hs-identifier hs-var">src#</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld
</span><a href="#local-6989586621680965991"><span class="hs-identifier hs-var">dst#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965994"><span class="hs-identifier hs-var">len#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965992"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680965990"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965990"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall d.
MutableByteArray# d -&gt; State# d -&gt; (# State# d, ByteArray# #)
</span><span class="hs-identifier hs-var">unsafeFreezeByteArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld
</span><a href="#local-6989586621680965991"><span class="hs-identifier hs-var">dst#</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965990"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680965989"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965989"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680965988"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621680965988"><span class="hs-identifier hs-var">ba#</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680965989"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; ShortByteString
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#SBS"><span class="hs-identifier hs-var">SBS.SBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621680965988"><span class="hs-identifier hs-var">ba#</span></a></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-comment">-- | Create a 'FastString' by copying an existing 'ByteString'</span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteString"><span class="hs-identifier hs-type">mkFastStringByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-523"></span><span id="mkFastStringByteString"><span class="annot"><span class="annottext">mkFastStringByteString :: ByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringByteString"><span class="hs-identifier hs-var hs-var">mkFastStringByteString</span></a></span></span><span> </span><span id="local-6989586621680965986"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680965986"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965985"><span class="annot"><span class="annottext">sbs :: ShortByteString
</span><a href="#local-6989586621680965985"><span class="hs-identifier hs-var hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ShortByteString
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#toShort"><span class="hs-identifier hs-var">SBS.toShort</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680965986"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="annottext">(Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965985"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965985"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-comment">-- | Create a 'FastString' from an existing 'ShortByteString' without</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- copying.</span><span>
</span><span id="line-530"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-type">mkFastStringShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-531"></span><span id="mkFastStringShortByteString"><span class="annot"><span class="annottext">mkFastStringShortByteString :: ShortByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-var hs-var">mkFastStringShortByteString</span></a></span></span><span> </span><span id="local-6989586621680965983"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965983"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-532"></span><span>  </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965983"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965983"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-comment">-- | Creates a UTF-8 encoded 'FastString' from a 'String'</span><span>
</span><span id="line-535"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-type">mkFastString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-536"></span><span id="mkFastString"><span class="annot"><span class="annottext">mkFastString :: String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var hs-var">mkFastString</span></a></span></span><span> </span><span id="local-6989586621680965982"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965982"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-537"></span><span>  </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="GHC.Utils.IO.Unsafe.html#inlinePerformIO"><span class="hs-identifier hs-var">inlinePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-538"></span><span>    </span><span id="local-6989586621680965981"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965981"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ShortByteString
</span><a href="../../ghc-boot-9.2.4/src/GHC-Utils-Encoding.html#utf8EncodeShortByteString"><span class="hs-identifier hs-var">utf8EncodeShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965982"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><span class="annottext">(Int -&gt; FastMutInt -&gt; IO FastString)
-&gt; ShortByteString -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkFastStringWith"><span class="hs-identifier hs-var">mkFastStringWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var">mkNewFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965981"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965981"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-comment">-- | Creates a 'FastString' from a UTF-8 encoded @[Word8]@</span><span>
</span><span id="line-542"></span><span class="annot"><a href="GHC.Data.FastString.html#mkFastStringByteList"><span class="hs-identifier hs-type">mkFastStringByteList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-543"></span><span id="mkFastStringByteList"><span class="annot"><span class="annottext">mkFastStringByteList :: [Word8] -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringByteList"><span class="hs-identifier hs-var hs-var">mkFastStringByteList</span></a></span></span><span> </span><span id="local-6989586621680965979"><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621680965979"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-var">mkFastStringShortByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Word8] -&gt; ShortByteString
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#pack"><span class="hs-identifier hs-var">SBS.pack</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621680965979"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="hs-comment">-- | Creates a (lazy) Z-encoded 'FastString' from a 'ShortByteString' and</span><span>
</span><span id="line-546"></span><span class="hs-comment">-- account the number of forced z-strings into the passed 'FastMutInt'.</span><span>
</span><span id="line-547"></span><span class="annot"><a href="GHC.Data.FastString.html#mkZFastString"><span class="hs-identifier hs-type">mkZFastString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-548"></span><span id="mkZFastString"><span class="annot"><span class="annottext">mkZFastString :: FastMutInt -&gt; ShortByteString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#mkZFastString"><span class="hs-identifier hs-var hs-var">mkZFastString</span></a></span></span><span> </span><span id="local-6989586621680965976"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680965976"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span id="local-6989586621680965975"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965975"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-IO-Unsafe.html#unsafePerformIO"><span class="hs-identifier hs-var">unsafePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; Int -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#atomicFetchAddFastMut"><span class="hs-identifier hs-var">atomicFetchAddFastMut</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680965976"><span class="hs-identifier hs-var">n_zencs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; FastZString
</span><a href="GHC.Data.FastString.html#mkFastZStringString"><span class="hs-identifier hs-var">mkFastZStringString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShowS
</span><a href="../../ghc-boot-9.2.4/src/GHC-Utils-Encoding.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; String
</span><a href="../../ghc-boot-9.2.4/src/GHC-Utils-Encoding.html#utf8DecodeShortByteString"><span class="hs-identifier hs-var">utf8DecodeShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965975"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-type">mkNewFastStringShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-553"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastMutInt.html#FastMutInt"><span class="hs-identifier hs-type">FastMutInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-554"></span><span id="mkNewFastStringShortByteString"><span class="annot"><span class="annottext">mkNewFastStringShortByteString :: ShortByteString -&gt; Int -&gt; FastMutInt -&gt; IO FastString
</span><a href="GHC.Data.FastString.html#mkNewFastStringShortByteString"><span class="hs-identifier hs-var hs-var">mkNewFastStringShortByteString</span></a></span></span><span> </span><span id="local-6989586621680965972"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965972"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span id="local-6989586621680965971"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965971"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621680965970"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680965970"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965969"><span class="annot"><span class="annottext">zstr :: FastZString
</span><a href="#local-6989586621680965969"><span class="hs-identifier hs-var hs-var">zstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; ShortByteString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#mkZFastString"><span class="hs-identifier hs-var">mkZFastString</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680965970"><span class="hs-identifier hs-var">n_zencs</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965972"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-556"></span><span>  </span><span id="local-6989586621680965968"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965968"><span class="hs-identifier hs-var">chars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; IO Int
</span><a href="../../ghc-boot-9.2.4/src/GHC-Utils-Encoding.html#countUTF8Chars"><span class="hs-identifier hs-var">countUTF8Chars</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965972"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-557"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ShortByteString -&gt; FastZString -&gt; FastString
</span><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-var">FastString</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965971"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965968"><span class="hs-identifier hs-var">chars</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965972"><span class="hs-identifier hs-var">sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastZString
</span><a href="#local-6989586621680965969"><span class="hs-identifier hs-var">zstr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span class="annot"><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-type">hashStr</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#ShortByteString"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-560"></span><span> </span><span class="hs-comment">-- produce a hash value between 0 &amp; m (inclusive)</span><span>
</span><span id="line-561"></span><span id="hashStr"><span class="annot"><span class="annottext">hashStr :: ShortByteString -&gt; Int
</span><a href="GHC.Data.FastString.html#hashStr"><span class="hs-identifier hs-var hs-var">hashStr</span></a></span></span><span> </span><span id="local-6989586621680965966"><span class="annot"><span class="annottext">sbs :: ShortByteString
</span><a href="#local-6989586621680965966"><span class="hs-identifier hs-var">sbs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#SBS"><span class="hs-identifier hs-type">SBS.SBS</span></a></span><span> </span><span id="local-6989586621680965965"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621680965965"><span class="hs-identifier hs-var">ba#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int
</span><a href="#local-6989586621680965964"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">0#</span></span><span>
</span><span id="line-562"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680965963"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965963"><span class="hs-identifier hs-var">len#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#length"><span class="hs-identifier hs-var">SBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621680965966"><span class="hs-identifier hs-var">sbs</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span id="local-6989586621680965964"><span class="annot"><span class="annottext">loop :: Int# -&gt; Int# -&gt; Int
</span><a href="#local-6989586621680965964"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621680965961"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965961"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680965960"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965960"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-565"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Bool
</span><span class="hs-identifier hs-var">isTrue#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965960"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">==#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965963"><span class="hs-identifier hs-var">len#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-566"></span><span>        </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965961"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-567"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-569"></span><span>          </span><span class="hs-comment">-- DO NOT move this let binding! indexCharOffAddr# reads from the</span><span>
</span><span id="line-570"></span><span>          </span><span class="hs-comment">-- pointer so we need to evaluate this based on the length check</span><span>
</span><span id="line-571"></span><span>          </span><span class="hs-comment">-- above. Not doing this right caused #17909.</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 901
</span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621680965959"><span class="annot"><span class="annottext">c :: Int#
</span><a href="#local-6989586621680965959"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int8# -&gt; Int#
</span><span class="hs-identifier hs-var">int8ToInt#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray# -&gt; Int# -&gt; Int8#
</span><span class="hs-identifier hs-var">indexInt8Array#</span></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621680965965"><span class="hs-identifier hs-var">ba#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965960"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>          </span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indexInt8Array#</span><span> </span><span class="hs-identifier">ba#</span><span> </span><span class="hs-identifier">n</span><span class="hs-cpp">
#endif
</span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621680965958"><span class="annot"><span class="annottext">h2 :: Int#
</span><a href="#local-6989586621680965958"><span class="hs-identifier hs-var hs-var">h2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965961"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">*#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">16777619#</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">`xorI#`</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965959"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-579"></span><span>          </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int
</span><a href="#local-6989586621680965964"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965958"><span class="hs-identifier hs-var">h2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965960"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int# -&gt; Int#
</span><span class="hs-operator hs-var">+#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><span class="hs-number">1#</span></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-582"></span><span class="hs-comment">-- Operations</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span class="hs-comment">-- | Returns the length of the 'FastString' in characters</span><span>
</span><span id="line-585"></span><span class="annot"><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier hs-type">lengthFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-586"></span><span id="lengthFS"><span class="annot"><span class="annottext">lengthFS :: FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#lengthFS"><span class="hs-identifier hs-var hs-var">lengthFS</span></a></span></span><span> </span><span id="local-6989586621680965957"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965957"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#n_chars"><span class="hs-identifier hs-var">n_chars</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965957"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">-- | Returns @True@ if the 'FastString' is empty</span><span>
</span><span id="line-589"></span><span class="annot"><a href="GHC.Data.FastString.html#nullFS"><span class="hs-identifier hs-type">nullFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-590"></span><span id="nullFS"><span class="annot"><span class="annottext">nullFS :: FastString -&gt; Bool
</span><a href="GHC.Data.FastString.html#nullFS"><span class="hs-identifier hs-var hs-var">nullFS</span></a></span></span><span> </span><span id="local-6989586621680965956"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965956"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Bool
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#null"><span class="hs-identifier hs-var">SBS.null</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965956"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="hs-comment">-- | Unpacks and decodes the FastString</span><span>
</span><span id="line-593"></span><span class="annot"><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-type">unpackFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-594"></span><span id="unpackFS"><span class="annot"><span class="annottext">unpackFS :: FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var hs-var">unpackFS</span></a></span></span><span> </span><span id="local-6989586621680965954"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965954"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; String
</span><a href="../../ghc-boot-9.2.4/src/GHC-Utils-Encoding.html#utf8DecodeShortByteString"><span class="hs-identifier hs-var">utf8DecodeShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965954"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="hs-comment">-- | Returns a Z-encoded version of a 'FastString'.  This might be the</span><span>
</span><span id="line-597"></span><span class="hs-comment">-- original, if it was already Z-encoded.  The first time this</span><span>
</span><span id="line-598"></span><span class="hs-comment">-- function is applied to a particular 'FastString', the results are</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- memoized.</span><span>
</span><span id="line-600"></span><span class="hs-comment">--</span><span>
</span><span id="line-601"></span><span class="annot"><a href="GHC.Data.FastString.html#zEncodeFS"><span class="hs-identifier hs-type">zEncodeFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a></span><span>
</span><span id="line-602"></span><span id="zEncodeFS"><span class="annot"><span class="annottext">zEncodeFS :: FastString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#zEncodeFS"><span class="hs-identifier hs-var hs-var">zEncodeFS</span></a></span></span><span> </span><span id="local-6989586621680965953"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965953"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; FastZString
</span><a href="GHC.Data.FastString.html#fs_zenc"><span class="hs-identifier hs-var">fs_zenc</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965953"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="annot"><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier hs-type">appendFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-605"></span><span id="appendFS"><span class="annot"><span class="annottext">appendFS :: FastString -&gt; FastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#appendFS"><span class="hs-identifier hs-var hs-var">appendFS</span></a></span></span><span> </span><span id="local-6989586621680965952"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965952"><span class="hs-identifier hs-var">fs1</span></a></span></span><span> </span><span id="local-6989586621680965951"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965951"><span class="hs-identifier hs-var">fs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringByteString"><span class="hs-identifier hs-var">mkFastStringByteString</span></a></span><span>
</span><span id="line-606"></span><span>                 </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString.html#append"><span class="hs-identifier hs-var">BS.append</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-var">bytesFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965952"><span class="hs-identifier hs-var">fs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-var">bytesFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965951"><span class="hs-identifier hs-var">fs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="annot"><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier hs-type">concatFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-609"></span><span id="concatFS"><span class="annot"><span class="annottext">concatFS :: [FastString] -&gt; FastString
</span><a href="GHC.Data.FastString.html#concatFS"><span class="hs-identifier hs-var hs-var">concatFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastStringShortByteString"><span class="hs-identifier hs-var">mkFastStringShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span class="annot"><a href="GHC.Data.FastString.html#headFS"><span class="hs-identifier hs-type">headFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-612"></span><span id="headFS"><span class="annot"><span class="annottext">headFS :: FastString -&gt; Char
</span><a href="GHC.Data.FastString.html#headFS"><span class="hs-identifier hs-var hs-var">headFS</span></a></span></span><span> </span><span id="local-6989586621680965948"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965948"><span class="hs-identifier hs-var">fs</span></a></span></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Bool
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Short-Internal.html#null"><span class="hs-identifier hs-var">SBS.null</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ShortByteString
</span><a href="GHC.Data.FastString.html#fs_sbs"><span class="hs-identifier hs-var">fs_sbs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965948"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;headFS: Empty FastString&quot;</span></span><span>
</span><span id="line-614"></span><span class="annot"><a href="GHC.Data.FastString.html#headFS"><span class="hs-identifier hs-var">headFS</span></a></span><span> </span><span id="local-6989586621680965947"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965947"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965947"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="annot"><a href="GHC.Data.FastString.html#consFS"><span class="hs-identifier hs-type">consFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-617"></span><span id="consFS"><span class="annot"><span class="annottext">consFS :: Char -&gt; FastString -&gt; FastString
</span><a href="GHC.Data.FastString.html#consFS"><span class="hs-identifier hs-var hs-var">consFS</span></a></span></span><span> </span><span id="local-6989586621680965945"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680965945"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680965944"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965944"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680965945"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965944"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="annot"><a href="GHC.Data.FastString.html#unconsFS"><span class="hs-identifier hs-type">unconsFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span id="unconsFS"><span class="annot"><span class="annottext">unconsFS :: FastString -&gt; Maybe (Char, FastString)
</span><a href="GHC.Data.FastString.html#unconsFS"><span class="hs-identifier hs-var hs-var">unconsFS</span></a></span></span><span> </span><span id="local-6989586621680965943"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965943"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965943"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-622"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-623"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680965942"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680965942"><span class="hs-identifier hs-var">chr</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680965941"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965941"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680965942"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965941"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="annot"><a href="GHC.Data.FastString.html#uniqueOfFS"><span class="hs-identifier hs-type">uniqueOfFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-626"></span><span id="uniqueOfFS"><span class="annot"><span class="annottext">uniqueOfFS :: FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniqueOfFS"><span class="hs-identifier hs-var hs-var">uniqueOfFS</span></a></span></span><span> </span><span id="local-6989586621680965940"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965940"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int
</span><a href="GHC.Data.FastString.html#uniq"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965940"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier hs-type">nilFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-629"></span><span id="nilFS"><span class="annot"><span class="annottext">nilFS :: FastString
</span><a href="GHC.Data.FastString.html#nilFS"><span class="hs-identifier hs-var hs-var">nilFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span class="annot"><a href="GHC.Data.FastString.html#isUnderscoreFS"><span class="hs-identifier hs-type">isUnderscoreFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-632"></span><span id="isUnderscoreFS"><span class="annot"><span class="annottext">isUnderscoreFS :: FastString -&gt; Bool
</span><a href="GHC.Data.FastString.html#isUnderscoreFS"><span class="hs-identifier hs-var hs-var">isUnderscoreFS</span></a></span></span><span> </span><span id="local-6989586621680965939"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965939"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965939"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-635"></span><span class="hs-comment">-- Stats</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringTable"><span class="hs-identifier hs-type">getFastStringTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-638"></span><span id="getFastStringTable"><span class="annot"><span class="annottext">getFastStringTable :: IO [[[FastString]]]
</span><a href="GHC.Data.FastString.html#getFastStringTable"><span class="hs-identifier hs-var hs-var">getFastStringTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-639"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Data.FastString.html#numSegments"><span class="hs-identifier hs-var">numSegments</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680965937"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965937"><span class="hs-identifier hs-var">i#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680965936"><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680965936"><span class="hs-identifier hs-var">segmentRef</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Array# a -&gt; Int# -&gt; (# a #)
</span><span class="hs-identifier hs-var">indexArray#</span></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621680965935"><span class="hs-identifier hs-var">segments#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965937"><span class="hs-identifier hs-var">i#</span></a></span><span>
</span><span id="line-641"></span><span>    </span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTableSegment"><span class="hs-identifier hs-type">FastStringTableSegment</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680965934"><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680965934"><span class="hs-identifier hs-var">buckets#</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FastStringTableSegment
</span><a href="#local-6989586621680965936"><span class="hs-identifier hs-var">segmentRef</span></a></span><span>
</span><span id="line-642"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965933"><span class="annot"><span class="annottext">bucketSize :: Int
</span><a href="#local-6989586621680965933"><span class="hs-identifier hs-var hs-var">bucketSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall d a. MutableArray# d a -&gt; Int#
</span><span class="hs-identifier hs-var">sizeofMutableArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680965934"><span class="hs-identifier hs-var">buckets#</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965933"><span class="hs-identifier hs-var">bucketSize</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680965932"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965932"><span class="hs-identifier hs-var">j#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-644"></span><span>      </span><span class="annot"><span class="annottext">forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall d a.
MutableArray# d a -&gt; Int# -&gt; State# d -&gt; (# State# d, a #)
</span><span class="hs-identifier hs-var">readArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld [FastString]
</span><a href="#local-6989586621680965934"><span class="hs-identifier hs-var">buckets#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965932"><span class="hs-identifier hs-var">j#</span></a></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680965935"><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><a href="#local-6989586621680965935"><span class="hs-identifier hs-var">segments#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var">stringTable</span></a></span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span class="annot"><a href="GHC.Data.FastString.html#getFastStringZEncCounter"><span class="hs-identifier hs-type">getFastStringZEncCounter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-649"></span><span id="getFastStringZEncCounter"><span class="annot"><span class="annottext">getFastStringZEncCounter :: IO Int
</span><a href="GHC.Data.FastString.html#getFastStringZEncCounter"><span class="hs-identifier hs-var hs-var">getFastStringZEncCounter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastMutInt -&gt; IO Int
</span><a href="GHC.Data.FastMutInt.html#readFastMutInt"><span class="hs-identifier hs-var">readFastMutInt</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680965931"><span class="hs-identifier hs-var">n_zencs</span></a></span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-651"></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#FastStringTable"><span class="hs-identifier hs-type">FastStringTable</span></a></span><span> </span><span class="annot"><span class="annottext">FastMutInt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680965931"><span class="annot"><span class="annottext">FastMutInt
</span><a href="#local-6989586621680965931"><span class="hs-identifier hs-var">n_zencs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Array# (IORef FastStringTableSegment)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringTable
</span><a href="GHC.Data.FastString.html#stringTable"><span class="hs-identifier hs-var">stringTable</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-654"></span><span class="hs-comment">-- Outputting 'FastString's</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-comment">-- |Outputs a 'FastString' with /no decoding at all/, that is, you</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- get the actual bytes in the 'FastString' written to the 'Handle'.</span><span>
</span><span id="line-658"></span><span class="annot"><a href="GHC.Data.FastString.html#hPutFS"><span class="hs-identifier hs-type">hPutFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO-Handle-Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span id="hPutFS"><span class="annot"><span class="annottext">hPutFS :: Handle -&gt; FastString -&gt; IO ()
</span><a href="GHC.Data.FastString.html#hPutFS"><span class="hs-identifier hs-var hs-var">hPutFS</span></a></span></span><span> </span><span id="local-6989586621680965930"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621680965930"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621680965929"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965929"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><a href="../../bytestring-0.11.3.1/src/Data-ByteString.html#hPut"><span class="hs-identifier hs-var">BS.hPut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621680965930"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; ByteString
</span><a href="GHC.Data.FastString.html#bytesFS"><span class="hs-identifier hs-var">bytesFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621680965929"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-comment">-- ToDo: we'll probably want an hPutFSLocal, or something, to output</span><span>
</span><span id="line-662"></span><span class="hs-comment">-- in the current locale's encoding (for error messages and suchlike).</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-665"></span><span class="hs-comment">-- PtrStrings, here for convenience only.</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span class="hs-comment">-- | A 'PtrString' is a pointer to some array of Latin-1 encoded chars.</span><span>
</span><span id="line-668"></span><span class="hs-keyword">data</span><span> </span><span id="PtrString"><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-var">PtrString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PtrString"><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-var">PtrString</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span class="hs-comment">-- | Wrap an unboxed address into a 'PtrString'.</span><span>
</span><span id="line-671"></span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-identifier hs-type">mkPtrString#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Addr#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span>
</span><span id="line-672"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-pragma hs-type">mkPtrString#</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-673"></span><span id="mkPtrString%23"><span class="annot"><span class="annottext">mkPtrString# :: Addr# -&gt; PtrString
</span><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-identifier hs-var hs-var">mkPtrString#</span></a></span></span><span> </span><span id="local-6989586621680965927"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965927"><span class="hs-identifier hs-var">a#</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; PtrString
</span><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-var">PtrString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Addr# -&gt; Ptr a
</span><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-var">Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965927"><span class="hs-identifier hs-var">a#</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int
</span><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-var">ptrStrLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Addr# -&gt; Ptr a
</span><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-var">Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965927"><span class="hs-identifier hs-var">a#</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="hs-comment">-- | Encode a 'String' into a newly allocated 'PtrString' using Latin-1</span><span>
</span><span id="line-676"></span><span class="hs-comment">-- encoding.  The original string must not contain non-Latin-1 characters</span><span>
</span><span id="line-677"></span><span class="hs-comment">-- (above codepoint @0xff@).</span><span>
</span><span id="line-678"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString"><span class="hs-pragma hs-type">mkPtrString</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-679"></span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString"><span class="hs-identifier hs-type">mkPtrString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span>
</span><span id="line-680"></span><span id="mkPtrString"><span class="annot"><span class="annottext">mkPtrString :: String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#mkPtrString"><span class="hs-identifier hs-var hs-var">mkPtrString</span></a></span></span><span> </span><span id="local-6989586621680965926"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965926"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-681"></span><span> </span><span class="hs-comment">-- we don't use `unsafeDupablePerformIO` here to avoid potential memory leaks</span><span>
</span><span id="line-682"></span><span> </span><span class="hs-comment">-- and because someone might be using `eqAddr#` to check for string equality.</span><span>
</span><span id="line-683"></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-IO-Unsafe.html#unsafePerformIO"><span class="hs-identifier hs-var">unsafePerformIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><span id="line-684"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680965925"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621680965925"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965926"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-685"></span><span>   </span><span id="local-6989586621680965923"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621680965923"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; IO (Ptr a)
</span><a href="../../base-4.16.3.0/src/Foreign-Marshal-Alloc.html#mallocBytes"><span class="hs-identifier hs-var">mallocBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965925"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-686"></span><span>   </span><span class="hs-keyword">let</span><span>
</span><span id="line-687"></span><span>     </span><span class="annot"><a href="#local-6989586621680965921"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>     </span><span id="local-6989586621680965921"><span class="annot"><span class="annottext">loop :: Int -&gt; String -&gt; IO ()
</span><a href="#local-6989586621680965921"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>     </span><span class="annot"><a href="#local-6989586621680965921"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621680965920"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965920"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680965919"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680965919"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680965918"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965918"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-690"></span><span>        </span><span class="annot"><span class="annottext">forall a b. Storable a =&gt; Ptr b -&gt; Int -&gt; a -&gt; IO ()
</span><a href="../../base-4.16.3.0/src/Foreign-Storable.html#pokeByteOff"><span class="hs-identifier hs-var">pokeByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621680965923"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965920"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#ord"><span class="hs-identifier hs-var">ord</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680965919"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; IO ()
</span><a href="#local-6989586621680965921"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965920"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965918"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-692"></span><span>   </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; IO ()
</span><a href="#local-6989586621680965921"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965926"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-693"></span><span>   </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word8 -&gt; Int -&gt; PtrString
</span><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-var">PtrString</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621680965923"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965925"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="hs-comment">-- | Decode a 'PtrString' back into a 'String' using Latin-1 encoding.</span><span>
</span><span id="line-697"></span><span class="hs-comment">-- This does not free the memory associated with 'PtrString'.</span><span>
</span><span id="line-698"></span><span class="annot"><a href="GHC.Data.FastString.html#unpackPtrString"><span class="hs-identifier hs-type">unpackPtrString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-699"></span><span id="unpackPtrString"><span class="annot"><span class="annottext">unpackPtrString :: PtrString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackPtrString"><span class="hs-identifier hs-var hs-var">unpackPtrString</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span id="local-6989586621680965914"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965914"><span class="hs-identifier hs-var">p#</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680965913"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965913"><span class="hs-identifier hs-var">n#</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Int# -&gt; String
</span><span class="hs-identifier hs-var">unpackNBytes#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965914"><span class="hs-identifier hs-var">p#</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680965913"><span class="hs-identifier hs-var">n#</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span class="hs-comment">-- | Return the length of a 'PtrString'</span><span>
</span><span id="line-702"></span><span class="annot"><a href="GHC.Data.FastString.html#lengthPS"><span class="hs-identifier hs-type">lengthPS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-703"></span><span id="lengthPS"><span class="annot"><span class="annottext">lengthPS :: PtrString -&gt; Int
</span><a href="GHC.Data.FastString.html#lengthPS"><span class="hs-identifier hs-var hs-var">lengthPS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680965911"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965911"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680965911"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-706"></span><span class="hs-comment">-- under the carpet</span><span class="hs-cpp">

#if !MIN_VERSION_GLASGOW_HASKELL(9,0,0,0)
</span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;strlen&quot;</span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-identifier">cstringLength#</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Addr#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int#</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-713"></span><span class="annot"><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-type">ptrStrLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-714"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-pragma hs-type">ptrStrLength</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-715"></span><span id="ptrStrLength"><span class="annot"><span class="annottext">ptrStrLength :: Ptr Word8 -&gt; Int
</span><a href="GHC.Data.FastString.html#ptrStrLength"><span class="hs-identifier hs-var hs-var">ptrStrLength</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span id="local-6989586621680965910"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965910"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr# -&gt; Int#
</span><span class="hs-identifier hs-var">cstringLength#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621680965910"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#sLit"><span class="hs-pragma hs-type">sLit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-718"></span><span class="annot"><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-type">sLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span>
</span><span id="line-719"></span><span id="sLit"><span class="annot"><span class="annottext">sLit :: String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var hs-var">sLit</span></a></span></span><span> </span><span id="local-6989586621680965909"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965909"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#mkPtrString"><span class="hs-identifier hs-var">mkPtrString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965909"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-pragma hs-type">fsLit</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-722"></span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-type">fsLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-723"></span><span id="fsLit"><span class="annot"><span class="annottext">fsLit :: String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var hs-var">fsLit</span></a></span></span><span> </span><span id="local-6989586621680965908"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965908"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680965908"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;slit&quot;</span></span><span>
</span><span id="line-726"></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621680965907"><span class="annot"><a href="#local-6989586621680965907"><span class="hs-pragma hs-var">x</span></a></span></span><span> </span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#sLit"><span class="hs-pragma hs-type">sLit</span></a></span><span>  </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">unpackCString#</span></span><span> </span><span class="annot"><a href="#local-6989586621680965907"><span class="hs-pragma hs-type">x</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkPtrString%23"><span class="hs-pragma hs-type">mkPtrString#</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621680965907"><span class="hs-pragma hs-type">x</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-727"></span><span class="hs-pragma">{-# RULES</span><span> </span><span class="annot"><span class="hs-pragma">&quot;fslit&quot;</span></span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-pragma">forall</span><span> </span><span id="local-6989586621680965906"><span class="annot"><a href="#local-6989586621680965906"><span class="hs-pragma hs-var">x</span></a></span></span><span> </span><span class="hs-pragma">.</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#fsLit"><span class="hs-pragma hs-type">fsLit</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">unpackCString#</span></span><span> </span><span class="annot"><a href="#local-6989586621680965906"><span class="hs-pragma hs-type">x</span></a></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString%23"><span class="hs-pragma hs-type">mkFastString#</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680965906"><span class="hs-pragma hs-type">x</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-729"></span></pre></body></html>
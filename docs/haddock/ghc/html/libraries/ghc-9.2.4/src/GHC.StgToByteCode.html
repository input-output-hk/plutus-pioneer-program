<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                        #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor              #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards            #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -fprof-auto-top #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">--  (c) The University of Glasgow 2002-2006</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-comment">-- | GHC.StgToByteCode: Generate bytecode from STG</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.StgToByteCode</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#UnlinkedBCO"><span class="hs-identifier">UnlinkedBCO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier">byteCodeGen</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html"><span class="hs-identifier">GHC.ByteCode.Instr</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Asm.html"><span class="hs-identifier">GHC.ByteCode.Asm</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html"><span class="hs-identifier">GHC.ByteCode.Types</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html"><span class="hs-identifier">GHC.Cmm.CallConv</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html"><span class="hs-identifier">GHC.Cmm.Expr</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Node.html"><span class="hs-identifier">GHC.Cmm.Node</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html"><span class="hs-identifier">GHC.Platform.Profile</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-FFI.html#"><span class="hs-identifier">GHCi.FFI</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html"><span class="hs-identifier">GHC.Types.ForeignCall</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#unboxedUnitTy"><span class="hs-identifier">unboxedUnitTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprType"><span class="hs-identifier">pprType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Uniques.html"><span class="hs-identifier">GHC.Builtin.Uniques</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html"><span class="hs-identifier">GHC.Builtin.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html#primOpId"><span class="hs-identifier">primOpId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html"><span class="hs-identifier">GHC.StgToCmm.Closure</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier">NonVoid</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier">fromNonVoid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#nonVoidIds"><span class="hs-identifier">nonVoidIds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html"><span class="hs-identifier">GHC.StgToCmm.Layout</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html"><span class="hs-identifier">GHC.Runtime.Heap.Layout</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#WordOff"><span class="hs-identifier">WordOff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#ByteOff"><span class="hs-identifier">ByteOff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#wordsToBytes"><span class="hs-identifier">wordsToBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bitmap.html"><span class="hs-identifier">GHC.Data.Bitmap</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List.html#"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#genericReplicate"><span class="hs-identifier">genericReplicate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#genericLength"><span class="hs-identifier">genericLength</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#intersperse"><span class="hs-identifier">intersperse</span></a></span><span>
</span><span id="line-73"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-List.html#scanl%27"><span class="hs-identifier">scanl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#sortBy"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#zip4"><span class="hs-identifier">zip4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#zip6"><span class="hs-identifier">zip6</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Foreign.html#"><span class="hs-identifier">Foreign</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Bits.html#shiftL"><span class="hs-identifier">shiftL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Bits.html#shiftR"><span class="hs-identifier">shiftR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Char.html#"><span class="hs-identifier">Data.Char</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Exception.html#"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../array-0.5.4.0/src/Data-Array.html#"><span class="hs-identifier">Data.Array</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Coerce.html#"><span class="hs-identifier">Data.Coerce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">coerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString.html#"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-IntMap.html#"><span class="hs-identifier">Data.IntMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-IntMap-Internal.html#IntMap"><span class="hs-identifier">IntMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-IntMap.html#"><span class="hs-identifier">Data.IntMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.FiniteMap.html"><span class="hs-identifier">GHC.Data.FiniteMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Ord.html#"><span class="hs-identifier">Data.Ord</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Stack-CCS.html#"><span class="hs-identifier">GHC.Stack.CCS</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#partitionEithers"><span class="hs-identifier">partitionEithers</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.FVs.html"><span class="hs-identifier">GHC.Stg.FVs</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-IntSet.html#"><span class="hs-identifier">Data.IntSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntSet</span></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- Generating byte code for a complete module</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier hs-type">byteCodeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span>
</span><span id="line-107"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a></span><span>
</span><span id="line-108"></span><span id="byteCodeGen"><span class="annot"><span class="annottext">byteCodeGen :: HscEnv
-&gt; Module
-&gt; [StgTopBinding]
-&gt; [TyCon]
-&gt; Maybe ModBreaks
-&gt; IO CompiledByteCode
</span><a href="GHC.StgToByteCode.html#byteCodeGen"><span class="hs-identifier hs-var hs-var">byteCodeGen</span></a></span></span><span> </span><span id="local-6989586621681284175"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681284175"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681284174"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681284174"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681284173"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681284173"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621681284172"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681284172"><span class="hs-identifier hs-var">tycs</span></a></span></span><span> </span><span id="local-6989586621681284171"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681284171"><span class="hs-identifier hs-var">mb_modBreaks</span></a></span></span><span>
</span><span id="line-109"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; DynFlags -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681284169"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681284168"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-110"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681284174"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-comment">-- Split top-level binds into strings and others.</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-comment">-- See Note [generating code for top-level string literal bindings].</span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681284162"><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621681284162"><span class="hs-identifier hs-var">strings</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681284161"><span class="annot"><span class="annottext">[GenStgBinding 'Vanilla]
</span><a href="#local-6989586621681284161"><span class="hs-identifier hs-var">lifted_binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base-4.16.3.0/src/Data-Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- list monad</span><span>
</span><span id="line-115"></span><span>                </span><span id="local-6989586621681284160"><span class="annot"><span class="annottext">StgTopBinding
</span><a href="#local-6989586621681284160"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681284173"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-116"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StgTopBinding
</span><a href="#local-6989586621681284160"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>                  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span id="local-6989586621681284158"><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284158"><span class="hs-identifier hs-var">bnd</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284158"><span class="hs-identifier hs-var">bnd</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-118"></span><span>                  </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621681284156"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284156"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681284155"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681284155"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284156"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681284155"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-119"></span><span>            </span><span id="local-6989586621681284154"><span class="annot"><span class="annottext">flattenBind :: GenStgBinding pass -&gt; [(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621681284154"><span class="hs-identifier hs-var hs-var">flattenBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681284152"><span class="annot"><span class="annottext">BinderP pass
</span><a href="#local-6989586621681284152"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681284151"><span class="annot"><span class="annottext">GenStgRhs pass
</span><a href="#local-6989586621681284151"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinderP pass
</span><a href="#local-6989586621681284152"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GenStgRhs pass
</span><a href="#local-6989586621681284151"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><a href="#local-6989586621681284154"><span class="hs-identifier hs-var">flattenBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681284149"><span class="annot"><span class="annottext">[(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621681284149"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621681284149"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621681284148"><span class="annot"><span class="annottext">[(Id, RemotePtr ())]
</span><a href="#local-6989586621681284148"><span class="hs-identifier hs-var">stringPtrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; [(Id, ByteString)] -&gt; IO [(Id, RemotePtr ())]
</span><a href="GHC.StgToByteCode.html#allocateTopStrings"><span class="hs-identifier hs-var">allocateTopStrings</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681284146"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621681284162"><span class="hs-identifier hs-var">strings</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>        </span><span id="local-6989586621681284145"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681284145"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; IO UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier hs-var">mkSplitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'y'</span></span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span class="hs-special">{</span><span id="local-6989586621681284135"><span id="local-6989586621681284136"><span id="local-6989586621681284137"><span id="local-6989586621681284138"><span id="local-6989586621681284139"><span id="local-6989586621681284140"><span id="local-6989586621681284141"><span id="local-6989586621681284142"><span class="annot"><span class="annottext">[FFIInfo]
Maybe ModBreaks
Word32
IntMap CgBreakInfo
Module
UniqSupply
IdEnv (RemotePtr ())
HscEnv
topStrings :: BcM_State -&gt; IdEnv (RemotePtr ())
breakInfo :: BcM_State -&gt; IntMap CgBreakInfo
modBreaks :: BcM_State -&gt; Maybe ModBreaks
ffis :: BcM_State -&gt; [FFIInfo]
nextlabel :: BcM_State -&gt; Word32
thisModule :: BcM_State -&gt; Module
uniqSupply :: BcM_State -&gt; UniqSupply
bcm_hsc_env :: BcM_State -&gt; HscEnv
topStrings :: IdEnv (RemotePtr ())
breakInfo :: IntMap CgBreakInfo
modBreaks :: Maybe ModBreaks
ffis :: [FFIInfo]
nextlabel :: Word32
thisModule :: Module
uniqSupply :: UniqSupply
bcm_hsc_env :: HscEnv
</span><a href="GHC.StgToByteCode.html#topStrings"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681284126"><span class="annot"><span class="annottext">[ProtoBCO Name]
</span><a href="#local-6989586621681284126"><span class="hs-identifier hs-var">proto_bcos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-125"></span><span>           </span><span class="annot"><span class="annottext">forall r.
HscEnv
-&gt; UniqSupply
-&gt; Module
-&gt; Maybe ModBreaks
-&gt; IdEnv (RemotePtr ())
-&gt; BcM r
-&gt; IO (BcM_State, r)
</span><a href="GHC.StgToByteCode.html#runBc"><span class="hs-identifier hs-var">runBc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681284175"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681284145"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681284174"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681284171"><span class="hs-identifier hs-var">mb_modBreaks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [(Id, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, RemotePtr ())]
</span><a href="#local-6989586621681284148"><span class="hs-identifier hs-var">stringPtrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>             </span><span id="local-6989586621681284123"><span class="annot"><span class="annottext">[GenStgBinding 'Vanilla]
</span><a href="#local-6989586621681284123"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla -&gt; BcM (GenStgBinding 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepBind"><span class="hs-identifier hs-var">bcPrepBind</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgBinding 'Vanilla]
</span><a href="#local-6989586621681284161"><span class="hs-identifier hs-var">lifted_binds</span></a></span><span>
</span><span id="line-127"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681284120"><span class="annot"><span class="annottext">flattened_binds :: [(Id, CgStgRhs)]
</span><a href="#local-6989586621681284120"><span class="hs-identifier hs-var hs-var">flattened_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>                   </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {pass :: StgPass}.
GenStgBinding pass -&gt; [(BinderP pass, GenStgRhs pass)]
</span><a href="#local-6989586621681284154"><span class="hs-identifier hs-var">flattenBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla -&gt; CgStgBinding
</span><a href="GHC.Stg.FVs.html#annBindingFreeVars"><span class="hs-identifier hs-var">annBindingFreeVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgBinding 'Vanilla]
</span><a href="#local-6989586621681284123"><span class="hs-identifier hs-var">prepd_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>             </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeTopBind"><span class="hs-identifier hs-var">schemeTopBind</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CgStgRhs)]
</span><a href="#local-6989586621681284120"><span class="hs-identifier hs-var">flattened_binds</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[FFIInfo]
</span><a href="#local-6989586621681284138"><span class="hs-identifier hs-var">ffis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.byteCodeGen: missing final emitBc?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">Logger
-&gt; DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681284169"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681284168"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_BCOs"><span class="hs-identifier hs-var">Opt_D_dump_BCOs</span></a></span><span>
</span><span id="line-135"></span><span>           </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Proto-BCOs&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatByteCode"><span class="hs-identifier hs-var">FormatByteCode</span></a></span><span>
</span><span id="line-136"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#intersperse"><span class="hs-identifier hs-var">intersperse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ProtoBCO Name]
</span><a href="#local-6989586621681284126"><span class="hs-identifier hs-var">proto_bcos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>        </span><span id="local-6989586621681284106"><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681284106"><span class="hs-identifier hs-var">cbc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp
-&gt; Profile
-&gt; [ProtoBCO Name]
-&gt; [TyCon]
-&gt; [RemotePtr ()]
-&gt; Maybe ModBreaks
-&gt; IO CompiledByteCode
</span><a href="GHC.ByteCode.Asm.html#assembleBCOs"><span class="hs-identifier hs-var">assembleBCOs</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681284146"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681284104"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">[ProtoBCO Name]
</span><a href="#local-6989586621681284126"><span class="hs-identifier hs-var">proto_bcos</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681284172"><span class="hs-identifier hs-var">tycs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, RemotePtr ())]
</span><a href="#local-6989586621681284148"><span class="hs-identifier hs-var">stringPtrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681284137"><span class="hs-identifier hs-var">modBreaks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-140"></span><span>             </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-141"></span><span>             </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681284103"><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621681284103"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621681284103"><span class="hs-identifier hs-var">mb</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">modBreaks_breakInfo :: IntMap CgBreakInfo
</span><a href="GHC.ByteCode.Types.html#modBreaks_breakInfo"><span class="hs-identifier hs-var">modBreaks_breakInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap CgBreakInfo
</span><a href="#local-6989586621681284136"><span class="hs-identifier hs-var">breakInfo</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">-- Squash space leaks in the CompiledByteCode.  This is really</span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-comment">-- important, because when loading a set of modules into GHCi</span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-comment">-- we don't touch the CompiledByteCode until the end when we</span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-comment">-- do linking.  Forcing out the thunks here reduces space</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-comment">-- usage by more than 50% when loading a large number of</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-comment">-- modules.</span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><span class="annottext">forall a. a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IO.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompiledByteCode -&gt; ()
</span><a href="GHC.ByteCode.Types.html#seqCompiledByteCode"><span class="hs-identifier hs-var">seqCompiledByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681284106"><span class="hs-identifier hs-var">cbc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681284106"><span class="hs-identifier hs-var">cbc</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681284168"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681284168"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681284175"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span id="local-6989586621681284169"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621681284169"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681284175"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span id="local-6989586621681284146"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621681284146"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Runtime.Interpreter.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681284175"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span id="local-6989586621681284104"><span class="annot"><span class="annottext">profile :: Profile
</span><a href="#local-6989586621681284104"><span class="hs-identifier hs-var hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Profile
</span><a href="GHC.Driver.Session.html#targetProfile"><span class="hs-identifier hs-var">targetProfile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681284168"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="GHC.StgToByteCode.html#allocateTopStrings"><span class="hs-identifier hs-type">allocateTopStrings</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../bytestring-0.11.3.1/src/Data-ByteString-Internal.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span id="allocateTopStrings"><span class="annot"><span class="annottext">allocateTopStrings :: Interp -&gt; [(Id, ByteString)] -&gt; IO [(Id, RemotePtr ())]
</span><a href="GHC.StgToByteCode.html#allocateTopStrings"><span class="hs-identifier hs-var hs-var">allocateTopStrings</span></a></span></span><span> </span><span id="local-6989586621681284094"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681284094"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621681284093"><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621681284093"><span class="hs-identifier hs-var">topStrings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span id="local-6989586621681284092"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681284092"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681284091"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621681284091"><span class="hs-identifier hs-var">strings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, ByteString)]
</span><a href="#local-6989586621681284093"><span class="hs-identifier hs-var">topStrings</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621681284089"><span class="annot"><span class="annottext">[RemotePtr ()]
</span><a href="#local-6989586621681284089"><span class="hs-identifier hs-var">ptrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681284094"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; Message [RemotePtr ()]
</span><a href="../../ghci-9.2.4/src/GHCi-Message.html#MallocStrings"><span class="hs-identifier hs-var">MallocStrings</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621681284091"><span class="hs-identifier hs-var">strings</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681284092"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[RemotePtr ()]
</span><a href="#local-6989586621681284089"><span class="hs-identifier hs-var">ptrs</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">{-
Note [generating code for top-level string literal bindings]

Here is a summary on how the byte code generator deals with top-level string
literals:

1. Top-level string literal bindings are separated from the rest of the module.

2. The strings are allocated via interpCmd, in allocateTopStrings

3. The mapping from binders to allocated strings (topStrings) are maintained in
   BcM and used when generating code for variable references.
-}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">{-
  Prepare the STG for bytecode generation:

   - Ensure that all breakpoints are directly under
        a let-binding, introducing a new binding for
        those that aren't already.

   - Protect Not-necessarily lifted join points, see
        Note [Not-necessarily-lifted join points]

 -}</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepRHS"><span class="hs-identifier hs-type">bcPrepRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- explicitly match all constructors so we get a warning if we miss any</span><span>
</span><span id="line-195"></span><span id="bcPrepRHS"><span class="annot"><span class="annottext">bcPrepRHS :: StgRhs -&gt; BcM StgRhs
</span><a href="GHC.StgToByteCode.html#bcPrepRHS"><span class="hs-identifier hs-var hs-var">bcPrepRHS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621681284084"><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
</span><a href="#local-6989586621681284084"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681284083"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681284083"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621681284082"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681284082"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621681284081"><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681284081"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span id="local-6989586621681284079"><span class="annot"><span class="annottext">bp :: StgTickish
</span><a href="#local-6989586621681284079"><span class="hs-identifier hs-var">bp</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621681284077"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284077"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-comment">{- If we have a breakpoint directly under an StgRhsClosure we don't
     need to introduce a new binding for it.
   -}</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621681284076"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284076"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284077"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
</span><a href="#local-6989586621681284084"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681284083"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681284082"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681284081"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681284079"><span class="hs-identifier hs-var">bp</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284076"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepRHS"><span class="hs-identifier hs-var">bcPrepRHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621681284074"><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
</span><a href="#local-6989586621681284074"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681284073"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681284073"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621681284072"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681284072"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621681284071"><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681284071"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681284070"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284070"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
</span><a href="#local-6989586621681284074"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681284073"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681284072"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681284071"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284070"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-203"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepRHS"><span class="hs-identifier hs-var">bcPrepRHS</span></a></span><span> </span><span id="local-6989586621681284068"><span class="annot"><span class="annottext">con :: StgRhs
</span><a href="#local-6989586621681284068"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681284068"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-type">bcPrepExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a></span><span>
</span><span id="line-206"></span><span class="hs-comment">-- explicitly match all constructors so we get a warning if we miss any</span><span>
</span><span id="line-207"></span><span id="bcPrepExpr"><span class="annot"><span class="annottext">bcPrepExpr :: GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var hs-var">bcPrepExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span id="local-6989586621681284065"><span class="annot"><span class="annottext">bp :: StgTickish
</span><a href="#local-6989586621681284065"><span class="hs-identifier hs-var">bp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span id="local-6989586621681284064"><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621681284064"><span class="hs-identifier hs-var">tick_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[XTickishId 'TickishPassStg]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681284063"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284063"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isLiftedTypeKind"><span class="hs-identifier hs-var">isLiftedTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; Kind
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621681284064"><span class="hs-identifier hs-var">tick_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>      </span><span id="local-6989586621681284060"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284060"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; BcM Id
</span><a href="GHC.StgToByteCode.html#newId"><span class="hs-identifier hs-var">newId</span></a></span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621681284064"><span class="hs-identifier hs-var">tick_ty</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span id="local-6989586621681284058"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284058"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284063"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-211"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681284057"><span class="annot"><span class="annottext">expr' :: GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284057"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681284065"><span class="hs-identifier hs-var">bp</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284058"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-212"></span><span>          </span><span id="local-6989586621681284056"><span class="annot"><span class="annottext">bnd :: GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284056"><span class="hs-identifier hs-var hs-var">bnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
BinderP pass -&gt; GenStgRhs pass -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284060"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-213"></span><span>                                            </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#dontCareCCS"><span class="hs-identifier hs-var">CC.dontCareCCS</span></a></span><span>
</span><span id="line-214"></span><span>                                            </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a></span><span>
</span><span id="line-215"></span><span>                                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>                                            </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284057"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-217"></span><span>                             </span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>          </span><span id="local-6989586621681284052"><span class="annot"><span class="annottext">letExp :: GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284052"><span class="hs-identifier hs-var hs-var">letExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284056"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284060"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284052"><span class="hs-identifier hs-var">letExp</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>      </span><span id="local-6989586621681284049"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284049"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; BcM Id
</span><a href="GHC.StgToByteCode.html#newId"><span class="hs-identifier hs-var">newId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-var">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-var">realWorldStatePrimTy</span></a></span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621681284064"><span class="hs-identifier hs-var">tick_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>      </span><span id="local-6989586621681284046"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284046"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; BcM Id
</span><a href="GHC.StgToByteCode.html#newId"><span class="hs-identifier hs-var">newId</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.Prim.html#realWorldStatePrimTy"><span class="hs-identifier hs-var">realWorldStatePrimTy</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span id="local-6989586621681284045"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284045"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284063"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681284044"><span class="annot"><span class="annottext">expr' :: GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284044"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681284065"><span class="hs-identifier hs-var">bp</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284045"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-225"></span><span>          </span><span id="local-6989586621681284043"><span class="annot"><span class="annottext">bnd :: GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284043"><span class="hs-identifier hs-var hs-var">bnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
BinderP pass -&gt; GenStgRhs pass -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284049"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-226"></span><span>                                            </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#dontCareCCS"><span class="hs-identifier hs-var">CC.dontCareCCS</span></a></span><span>
</span><span id="line-227"></span><span>                                            </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a></span><span>
</span><span id="line-228"></span><span>                                            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Types.Id.Make.html#voidArgId"><span class="hs-identifier hs-var">voidArgId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>                                            </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284044"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-230"></span><span>                             </span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284043"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284049"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284046"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span id="local-6989586621681284040"><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681284040"><span class="hs-identifier hs-var">tick</span></a></span></span><span> </span><span id="local-6989586621681284039"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284039"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681284040"><span class="hs-identifier hs-var">tick</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284039"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span id="local-6989586621681284038"><span class="annot"><span class="annottext">XLet 'Vanilla
</span><a href="#local-6989586621681284038"><span class="hs-identifier hs-var">xlet</span></a></span></span><span> </span><span id="local-6989586621681284037"><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284037"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span id="local-6989586621681284036"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284036"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet 'Vanilla
</span><a href="#local-6989586621681284038"><span class="hs-identifier hs-var">xlet</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla -&gt; BcM (GenStgBinding 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepBind"><span class="hs-identifier hs-var">bcPrepBind</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284037"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-236"></span><span>              </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284036"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-237"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-type">StgLetNoEscape</span></a></span><span> </span><span id="local-6989586621681284034"><span class="annot"><span class="annottext">XLetNoEscape 'Vanilla
</span><a href="#local-6989586621681284034"><span class="hs-identifier hs-var">xlne</span></a></span></span><span> </span><span id="local-6989586621681284033"><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284033"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span id="local-6989586621681284032"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284032"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLetNoEscape 'Vanilla
</span><a href="#local-6989586621681284034"><span class="hs-identifier hs-var">xlne</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla -&gt; BcM (GenStgBinding 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepBind"><span class="hs-identifier hs-var">bcPrepBind</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681284033"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-239"></span><span>              </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284032"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-240"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span id="local-6989586621681284030"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284030"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681284029"><span class="annot"><span class="annottext">BinderP 'Vanilla
</span><a href="#local-6989586621681284029"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681284028"><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681284028"><span class="hs-identifier hs-var">alt_type</span></a></span></span><span> </span><span id="local-6989586621681284027"><span class="annot"><span class="annottext">[GenStgAlt 'Vanilla]
</span><a href="#local-6989586621681284027"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
GenStgExpr pass
-&gt; BinderP pass -&gt; AltType -&gt; [GenStgAlt pass] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284030"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-242"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP 'Vanilla
</span><a href="#local-6989586621681284029"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681284028"><span class="hs-identifier hs-var">alt_type</span></a></span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgAlt 'Vanilla -&gt; BcM (GenStgAlt 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepAlt"><span class="hs-identifier hs-var">bcPrepAlt</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgAlt 'Vanilla]
</span><a href="#local-6989586621681284027"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-245"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span id="local-6989586621681284025"><span class="annot"><span class="annottext">lit :: GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284025"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-type">StgLit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284025"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-246"></span><span class="hs-comment">-- See Note [Not-necessarily-lifted join points], step 3.</span><span>
</span><span id="line-247"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621681284023"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284023"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isNNLJoinPoint"><span class="hs-identifier hs-var">isNNLJoinPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284023"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-249"></span><span>      </span><span class="annot"><span class="annottext">forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id
</span><a href="GHC.StgToByteCode.html#protectNNLJoinPointId"><span class="hs-identifier hs-var">protectNNLJoinPointId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284023"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Types.Id.Make.html#voidPrimId"><span class="hs-identifier hs-var">voidPrimId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-250"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span id="local-6989586621681284019"><span class="annot"><span class="annottext">app :: GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284019"><span class="hs-identifier hs-var">app</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284019"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-251"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span id="local-6989586621681284018"><span class="annot"><span class="annottext">app :: GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284018"><span class="hs-identifier hs-var">app</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284018"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-252"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span id="local-6989586621681284016"><span class="annot"><span class="annottext">app :: GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284016"><span class="hs-identifier hs-var">app</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284016"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepAlt"><span class="hs-identifier hs-type">bcPrepAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgAlt"><span class="hs-identifier hs-type">StgAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgAlt"><span class="hs-identifier hs-type">StgAlt</span></a></span><span>
</span><span id="line-255"></span><span id="bcPrepAlt"><span class="annot"><span class="annottext">bcPrepAlt :: GenStgAlt 'Vanilla -&gt; BcM (GenStgAlt 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepAlt"><span class="hs-identifier hs-var hs-var">bcPrepAlt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681284013"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621681284013"><span class="hs-identifier hs-var">ac</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681284012"><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681284012"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681284011"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284011"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621681284013"><span class="hs-identifier hs-var">ac</span></a></span><span> </span><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681284012"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla -&gt; BcM (GenStgExpr 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepExpr"><span class="hs-identifier hs-var">bcPrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681284011"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepBind"><span class="hs-identifier hs-type">bcPrepBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- explicitly match all constructors so we get a warning if we miss any</span><span>
</span><span id="line-259"></span><span id="bcPrepBind"><span class="annot"><span class="annottext">bcPrepBind :: GenStgBinding 'Vanilla -&gt; BcM (GenStgBinding 'Vanilla)
</span><a href="GHC.StgToByteCode.html#bcPrepBind"><span class="hs-identifier hs-var hs-var">bcPrepBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681284009"><span class="annot"><span class="annottext">BinderP 'Vanilla
</span><a href="#local-6989586621681284009"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681284008"><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681284008"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681284007"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284007"><span class="hs-identifier hs-var">bndr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681284006"><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681284006"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id, StgRhs) -&gt; (Id, StgRhs)
</span><a href="GHC.StgToByteCode.html#bcPrepSingleBind"><span class="hs-identifier hs-var">bcPrepSingleBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinderP 'Vanilla
</span><a href="#local-6989586621681284009"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681284008"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
BinderP pass -&gt; GenStgRhs pass -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284007"><span class="hs-identifier hs-var">bndr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs -&gt; BcM StgRhs
</span><a href="GHC.StgToByteCode.html#bcPrepRHS"><span class="hs-identifier hs-var">bcPrepRHS</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681284006"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-262"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepBind"><span class="hs-identifier hs-var">bcPrepBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681284004"><span class="annot"><span class="annottext">[(BinderP 'Vanilla, StgRhs)]
</span><a href="#local-6989586621681284004"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
[(BinderP pass, GenStgRhs pass)] -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681284003"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284003"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681284002"><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681284002"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284003"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs -&gt; BcM StgRhs
</span><a href="GHC.StgToByteCode.html#bcPrepRHS"><span class="hs-identifier hs-var">bcPrepRHS</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681284002"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, StgRhs) -&gt; (Id, StgRhs)
</span><a href="GHC.StgToByteCode.html#bcPrepSingleBind"><span class="hs-identifier hs-var">bcPrepSingleBind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>                  </span><span class="annot"><span class="annottext">[(BinderP 'Vanilla, StgRhs)]
</span><a href="#local-6989586621681284004"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepSingleBind"><span class="hs-identifier hs-type">bcPrepSingleBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- If necessary, modify this Id and body to protect not-necessarily-lifted join points.</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- See Note [Not-necessarily-lifted join points], step 2.</span><span>
</span><span id="line-269"></span><span id="bcPrepSingleBind"><span class="annot"><span class="annottext">bcPrepSingleBind :: (Id, StgRhs) -&gt; (Id, StgRhs)
</span><a href="GHC.StgToByteCode.html#bcPrepSingleBind"><span class="hs-identifier hs-var hs-var">bcPrepSingleBind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681284001"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284001"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621681284000"><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
</span><a href="#local-6989586621681284000"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span id="local-6989586621681283999"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681283999"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621681283998"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681283998"><span class="hs-identifier hs-var">upd_flag</span></a></span></span><span> </span><span id="local-6989586621681283997"><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681283997"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681283996"><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681283996"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isNNLJoinPoint"><span class="hs-identifier hs-var">isNNLJoinPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284001"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id
</span><a href="GHC.StgToByteCode.html#protectNNLJoinPointId"><span class="hs-identifier hs-var">protectNNLJoinPointId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681284001"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
</span><a href="#local-6989586621681284000"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681283999"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681283998"><span class="hs-identifier hs-var">upd_flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BinderP 'Vanilla]
</span><a href="#local-6989586621681283997"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Types.Id.Make.html#voidArgId"><span class="hs-identifier hs-var">voidArgId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'Vanilla
</span><a href="#local-6989586621681283996"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcPrepSingleBind"><span class="hs-identifier hs-var">bcPrepSingleBind</span></a></span><span> </span><span id="local-6989586621681283995"><span class="annot"><span class="annottext">(Id, StgRhs)
</span><a href="#local-6989586621681283995"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id, StgRhs)
</span><a href="#local-6989586621681283995"><span class="hs-identifier hs-var">bnd</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- Compilation schema for the bytecode generator</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-keyword">type</span><span> </span><span id="BCInstrList"><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-var">BCInstrList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-type">wordsToBytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-281"></span><span id="wordsToBytes"><span class="annot"><span class="annottext">wordsToBytes :: Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var hs-var">wordsToBytes</span></a></span></span><span> </span><span id="local-6989586621681283992"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283992"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283992"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- Used when we know we have a whole number of words</span><span>
</span><span id="line-284"></span><span class="annot"><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-type">bytesToWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-285"></span><span id="bytesToWords"><span class="annot"><span class="annottext">bytesToWords :: Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var hs-var">bytesToWords</span></a></span></span><span> </span><span id="local-6989586621681283988"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283988"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span id="local-6989586621681283986"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283986"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283985"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283985"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283984"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283984"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283986"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; a -&gt; (a, a)
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#quotRem"><span class="hs-operator hs-var">`quotRem`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283988"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283984"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-288"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283985"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-289"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.bytesToWords&quot;</span></span><span>
</span><span id="line-290"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bytes=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283986"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-type">wordSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-293"></span><span id="wordSize"><span class="annot"><span class="annottext">wordSize :: Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var hs-var">wordSize</span></a></span></span><span> </span><span id="local-6989586621681283979"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283979"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283979"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-keyword">type</span><span> </span><span id="Sequel"><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-var">Sequel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-comment">-- back off to this depth before ENTER</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-keyword">type</span><span> </span><span id="StackDepth"><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-var">StackDepth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Maps Ids to their stack depth. This allows us to avoid having to mess with</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- it after each push/pop.</span><span>
</span><span id="line-301"></span><span class="hs-keyword">type</span><span> </span><span id="BCEnv"><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-var">BCEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-comment">-- To find vars on the stack</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">{-
ppBCEnv :: BCEnv -&gt; SDoc
ppBCEnv p
   = text &quot;begin-env&quot;
     $$ nest 4 (vcat (map pp_one (sortBy cmp_snd (Map.toList p))))
     $$ text &quot;end-env&quot;
     where
        pp_one (var, ByteOff offset) = int offset &lt;&gt; colon &lt;+&gt; ppr var &lt;+&gt; ppr (bcIdArgReps var)
        cmp_snd x y = compare (snd x) (snd y)
-}</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- Create a BCO and do a spot of peephole optimisation on the insns</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- at the same time.</span><span>
</span><span id="line-316"></span><span id="local-6989586621681284995"><span class="annot"><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-type">mkProtoBCO</span></a></span><span>
</span><span id="line-317"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-318"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681284995"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-319"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-320"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgAlt"><span class="hs-identifier hs-type">CgStgAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-comment">-- ^ original expression; for debugging only</span><span>
</span><span id="line-322"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-323"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-324"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Heap.Layout.html#StgWord"><span class="hs-identifier hs-type">StgWord</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True &lt;=&gt; is a return point, rather than a function</span><span>
</span><span id="line-326"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-327"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284995"><span class="hs-identifier hs-type">name</span></a></span></span><span>
</span><span id="line-328"></span><span id="mkProtoBCO"><span class="annot"><span class="annottext">mkProtoBCO :: forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; Word16
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var hs-var">mkProtoBCO</span></a></span></span><span> </span><span id="local-6989586621681283964"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283964"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681283963"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681283963"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621681283962"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283962"><span class="hs-identifier hs-var">instrs_ordlist</span></a></span></span><span> </span><span id="local-6989586621681283961"><span class="annot"><span class="annottext">Either [CgStgAlt] CgStgRhs
</span><a href="#local-6989586621681283961"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621681283960"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283960"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621681283959"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283959"><span class="hs-identifier hs-var">bitmap_size</span></a></span></span><span> </span><span id="local-6989586621681283958"><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621681283958"><span class="hs-identifier hs-var">bitmap</span></a></span></span><span> </span><span id="local-6989586621681283957"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283957"><span class="hs-identifier hs-var">is_ret</span></a></span></span><span> </span><span id="local-6989586621681283956"><span class="annot"><span class="annottext">[FFIInfo]
</span><a href="#local-6989586621681283956"><span class="hs-identifier hs-var">ffis</span></a></span></span><span>
</span><span id="line-329"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="annottext">protoBCOName :: name
</span><a href="GHC.ByteCode.Instr.html#protoBCOName"><span class="hs-identifier hs-var">protoBCOName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681283963"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">protoBCOInstrs :: [BCInstr]
</span><a href="GHC.ByteCode.Instr.html#protoBCOInstrs"><span class="hs-identifier hs-var">protoBCOInstrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283952"><span class="hs-identifier hs-var">maybe_with_stack_check</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">protoBCOBitmap :: [StgWord]
</span><a href="GHC.ByteCode.Instr.html#protoBCOBitmap"><span class="hs-identifier hs-var">protoBCOBitmap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621681283958"><span class="hs-identifier hs-var">bitmap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-333"></span><span>        </span><span class="annot"><span class="annottext">protoBCOBitmapSize :: Word16
</span><a href="GHC.ByteCode.Instr.html#protoBCOBitmapSize"><span class="hs-identifier hs-var">protoBCOBitmapSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283959"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><span class="annottext">protoBCOArity :: Int
</span><a href="GHC.ByteCode.Instr.html#protoBCOArity"><span class="hs-identifier hs-var">protoBCOArity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283960"><span class="hs-identifier hs-var">arity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-335"></span><span>        </span><span class="annot"><span class="annottext">protoBCOExpr :: Either [CgStgAlt] CgStgRhs
</span><a href="GHC.ByteCode.Instr.html#protoBCOExpr"><span class="hs-identifier hs-var">protoBCOExpr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either [CgStgAlt] CgStgRhs
</span><a href="#local-6989586621681283961"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="annottext">protoBCOFFIs :: [FFIInfo]
</span><a href="GHC.ByteCode.Instr.html#protoBCOFFIs"><span class="hs-identifier hs-var">protoBCOFFIs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FFIInfo]
</span><a href="#local-6989586621681283956"><span class="hs-identifier hs-var">ffis</span></a></span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-338"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-comment">-- Overestimate the stack usage (in words) of this BCO,</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-comment">-- and if &gt;= iNTERP_STACK_CHECK_THRESH, add an explicit</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-comment">-- stack check.  (The interpreter always does a stack check</span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-comment">-- for iNTERP_STACK_CHECK_THRESH words at the start of each</span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-comment">-- BCO anyway, so we only need to add an explicit one in the</span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-comment">-- (hopefully rare) cases when the (overestimated) stack use</span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-comment">-- exceeds iNTERP_STACK_CHECK_THRESH.</span><span>
</span><span id="line-346"></span><span>        </span><span id="local-6989586621681283952"><span class="annot"><span class="annottext">maybe_with_stack_check :: [BCInstr]
</span><a href="#local-6989586621681283952"><span class="hs-identifier hs-var hs-var">maybe_with_stack_check</span></a></span></span><span>
</span><span id="line-347"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283957"><span class="hs-identifier hs-var">is_ret</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681283945"><span class="hs-identifier hs-var">stack_usage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlatformConstants -&gt; Int
</span><a href="GHC.Platform.Constants.html#pc_AP_STACK_SPLIM"><span class="hs-identifier hs-var">pc_AP_STACK_SPLIM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PlatformConstants
</span><a href="GHC.Platform.html#platformConstants"><span class="hs-identifier hs-var">platformConstants</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283964"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283941"><span class="hs-identifier hs-var">peep_d</span></a></span><span>
</span><span id="line-348"></span><span>                </span><span class="hs-comment">-- don't do stack checks at return points,</span><span>
</span><span id="line-349"></span><span>                </span><span class="hs-comment">-- everything is aggregated up to the top BCO</span><span>
</span><span id="line-350"></span><span>                </span><span class="hs-comment">-- (which must be a function).</span><span>
</span><span id="line-351"></span><span>                </span><span class="hs-comment">-- That is, unless the stack usage is &gt;= AP_STACK_SPLIM,</span><span>
</span><span id="line-352"></span><span>                </span><span class="hs-comment">-- see bug #1466.</span><span>
</span><span id="line-353"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681283945"><span class="hs-identifier hs-var">stack_usage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.ByteCode.Asm.html#iNTERP_STACK_CHECK_THRESH"><span class="hs-identifier hs-var">iNTERP_STACK_CHECK_THRESH</span></a></span><span>
</span><span id="line-354"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#STKCHECK"><span class="hs-identifier hs-var">STKCHECK</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681283945"><span class="hs-identifier hs-var">stack_usage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283941"><span class="hs-identifier hs-var">peep_d</span></a></span><span>
</span><span id="line-355"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-356"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283941"><span class="hs-identifier hs-var">peep_d</span></a></span><span>     </span><span class="hs-comment">-- the supposedly common case</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-comment">-- We assume that this sum doesn't wrap</span><span>
</span><span id="line-359"></span><span>        </span><span id="local-6989586621681283945"><span class="annot"><span class="annottext">stack_usage :: Word
</span><a href="#local-6989586621681283945"><span class="hs-identifier hs-var hs-var">stack_usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr -&gt; Word
</span><a href="GHC.ByteCode.Instr.html#bciStackUse"><span class="hs-identifier hs-var">bciStackUse</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283941"><span class="hs-identifier hs-var">peep_d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-comment">-- Merge local pushes</span><span>
</span><span id="line-362"></span><span>        </span><span id="local-6989586621681283941"><span class="annot"><span class="annottext">peep_d :: [BCInstr]
</span><a href="#local-6989586621681283941"><span class="hs-identifier hs-var hs-var">peep_d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621681283936"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; [a]
</span><a href="GHC.Data.OrdList.html#fromOL"><span class="hs-identifier hs-var">fromOL</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283962"><span class="hs-identifier hs-var">instrs_ordlist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>        </span><span id="local-6989586621681283936"><span class="annot"><span class="annottext">peep :: [BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621681283936"><span class="hs-identifier hs-var hs-var">peep</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621681283927"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283927"><span class="hs-identifier hs-var">off1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621681283926"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283926"><span class="hs-identifier hs-var">off2</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621681283925"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283925"><span class="hs-identifier hs-var">off3</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283924"><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283924"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_LLL"><span class="hs-identifier hs-var">PUSH_LLL</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283927"><span class="hs-identifier hs-var">off1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283926"><span class="hs-identifier hs-var">off2</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283925"><span class="hs-identifier hs-var">off3</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621681283936"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283924"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span class="annot"><a href="#local-6989586621681283936"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621681283922"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283922"><span class="hs-identifier hs-var">off1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-type">PUSH_L</span></a></span><span> </span><span id="local-6989586621681283921"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283921"><span class="hs-identifier hs-var">off2</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283920"><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283920"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_LL"><span class="hs-identifier hs-var">PUSH_LL</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283922"><span class="hs-identifier hs-var">off1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283921"><span class="hs-identifier hs-var">off2</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621681283936"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283920"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><a href="#local-6989586621681283936"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283918"><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283918"><span class="hs-identifier hs-var">i</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681283917"><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283917"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283918"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[BCInstr] -&gt; [BCInstr]
</span><a href="#local-6989586621681283936"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="annot"><span class="annottext">[BCInstr]
</span><a href="#local-6989586621681283917"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><a href="#local-6989586621681283936"><span class="hs-identifier hs-var">peep</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-371"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="annot"><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-type">argBits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span>
</span><span id="line-374"></span><span id="argBits"><span class="annot"><span class="annottext">argBits :: Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var hs-var">argBits</span></a></span></span><span> </span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-375"></span><span class="annot"><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span id="local-6989586621681283915"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283915"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283914"><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621681283914"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283913"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283913"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621681283914"><span class="hs-identifier hs-var">rep</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283915"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283913"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-377"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283915"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621681283914"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283915"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283913"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.StgToByteCode.html#non_void"><span class="hs-identifier hs-type">non_void</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-380"></span><span id="non_void"><span class="annot"><span class="annottext">non_void :: [ArgRep] -&gt; [ArgRep]
</span><a href="GHC.StgToByteCode.html#non_void"><span class="hs-identifier hs-var hs-var">non_void</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="#local-6989586621681283907"><span class="hs-identifier hs-var">nv</span></a></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681283907"><span class="annot"><span class="annottext">nv :: ArgRep -&gt; Bool
</span><a href="#local-6989586621681283907"><span class="hs-identifier hs-var hs-var">nv</span></a></span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V"><span class="hs-identifier hs-var">V</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-382"></span><span>        </span><span class="annot"><a href="#local-6989586621681283907"><span class="hs-identifier hs-var">nv</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- schemeTopBind</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Compile code for the right-hand side of a top-level binding</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeTopBind"><span class="hs-identifier hs-type">schemeTopBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span id="schemeTopBind"><span class="annot"><span class="annottext">schemeTopBind :: (Id, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeTopBind"><span class="hs-identifier hs-var hs-var">schemeTopBind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283905"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283905"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283904"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283904"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283903"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283903"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConWorkId_maybe"><span class="hs-identifier hs-var">isDataConWorkId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283905"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNullaryRepDataCon"><span class="hs-identifier hs-var">isNullaryRepDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283903"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621681283900"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283900"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-comment">-- Special case for the worker of a nullary data con.</span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-comment">-- It'll look like this:        Nil = /\a -&gt; Nil a</span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-comment">-- If we feed it into schemeR, we'll get</span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-comment">--      Nil = Nil</span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-comment">-- because mkConAppCode treats nullary constructor applications</span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-comment">-- by just re-using the single top-level definition.  So</span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-comment">-- for the worker itself, we must allocate it directly.</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-comment">-- ioToBc (putStrLn $ &quot;top level BCO&quot;)</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283897"><span class="annot"><span class="annottext">enter :: BCInstr
</span><a href="#local-6989586621681283897"><span class="hs-identifier hs-var hs-var">enter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedTypeKind"><span class="hs-identifier hs-var">isUnliftedTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Kind
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283903"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_UNLIFTED"><span class="hs-identifier hs-var">RETURN_UNLIFTED</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span>
</span><span id="line-404"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#ENTER"><span class="hs-identifier hs-var">ENTER</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; Word16
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var">mkProtoBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283900"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283905"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PACK"><span class="hs-identifier hs-var">PACK</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283903"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283897"><span class="hs-identifier hs-var">enter</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283904"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-comment">{-no bitmap-}</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-comment">{-not alts-}</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; (Name, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-var">schemeR</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-comment">{- No free variables -}</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283905"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283904"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- schemeR</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="hs-comment">-- Compile code for a right-hand side, to give a BCO that,</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- when executed with the free variables and arguments on top of the stack,</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- will return with a pointer to the result on top of the stack, after</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- removing the free variables and arguments.</span><span>
</span><span id="line-419"></span><span class="hs-comment">--</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- Park the resulting BCO in the monad.  Also requires the</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- name of the variable to which this value was bound,</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- so as to give the resulting BCO a name.</span><span>
</span><span id="line-423"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-type">schemeR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Free vars of the RHS, ordered as they</span><span>
</span><span id="line-424"></span><span>                                </span><span class="hs-comment">-- will appear in the thunk.  Empty for</span><span>
</span><span id="line-425"></span><span>                                </span><span class="hs-comment">-- top-level things, which have no free vars.</span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span id="schemeR"><span class="annot"><span class="annottext">schemeR :: [Id] -&gt; (Name, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-var hs-var">schemeR</span></a></span></span><span> </span><span id="local-6989586621681283885"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283885"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283884"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681283884"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283883"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283883"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
-&gt; Name -&gt; CgStgRhs -&gt; ([Id], CgStgExpr) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR_wrk"><span class="hs-identifier hs-var">schemeR_wrk</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283885"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681283884"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283883"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgStgRhs -&gt; ([Id], CgStgExpr)
</span><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283883"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- If an expression is a lambda, return the</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- list of arguments to the lambda (in R-to-L order) and the</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- underlying expression</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="annot"><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-type">collect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span id="collect"><span class="annot"><span class="annottext">collect :: CgStgRhs -&gt; ([Id], CgStgExpr)
</span><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681283880"><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621681283880"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681283879"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283879"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621681283880"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283879"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span class="annot"><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621681283878"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681283878"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621681283877"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283877"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621681283876"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681283876"><span class="hs-identifier hs-var">cnum</span></a></span></span><span> </span><span id="local-6989586621681283875"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681283875"><span class="hs-identifier hs-var">_ticks</span></a></span></span><span> </span><span id="local-6989586621681283874"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283874"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
DataCon -&gt; XConApp pass -&gt; [StgArg] -&gt; [Kind] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283877"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681283876"><span class="hs-identifier hs-var">cnum</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283874"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeR_wrk"><span class="hs-identifier hs-type">schemeR_wrk</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span>            </span><span class="hs-comment">-- expression e, for debugging only</span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- result of collect on e</span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span id="schemeR_wrk"><span class="annot"><span class="annottext">schemeR_wrk :: [Id]
-&gt; Name -&gt; CgStgRhs -&gt; ([Id], CgStgExpr) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR_wrk"><span class="hs-identifier hs-var hs-var">schemeR_wrk</span></a></span></span><span> </span><span id="local-6989586621681283873"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283873"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681283872"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681283872"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621681283871"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283871"><span class="hs-identifier hs-var">original_body</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283870"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283870"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283869"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283869"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-447"></span><span>     </span><span id="local-6989586621681283868"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283868"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-448"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-449"></span><span>         </span><span id="local-6989586621681283867"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681283867"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283868"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-450"></span><span>         </span><span id="local-6989586621681283866"><span class="annot"><span class="annottext">all_args :: [Id]
</span><a href="#local-6989586621681283866"><span class="hs-identifier hs-var hs-var">all_args</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283870"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283873"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-451"></span><span>         </span><span id="local-6989586621681283865"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621681283865"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283866"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-452"></span><span>         </span><span class="hs-comment">-- all_args are the args in reverse order.  We're compiling a function</span><span>
</span><span id="line-453"></span><span>         </span><span class="hs-comment">-- \fv1..fvn x1..xn -&gt; e</span><span>
</span><span id="line-454"></span><span>         </span><span class="hs-comment">-- i.e. the fvs come first</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span>         </span><span class="hs-comment">-- Stack arguments always take a whole number of words, we never pack</span><span>
</span><span id="line-457"></span><span>         </span><span class="hs-comment">-- them unlike constructor fields.</span><span>
</span><span id="line-458"></span><span>         </span><span id="local-6989586621681283863"><span class="annot"><span class="annottext">szsb_args :: [ByteOff]
</span><a href="#local-6989586621681283863"><span class="hs-identifier hs-var hs-var">szsb_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283867"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-var">idSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283867"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283866"><span class="hs-identifier hs-var">all_args</span></a></span><span>
</span><span id="line-459"></span><span>         </span><span id="local-6989586621681283861"><span class="annot"><span class="annottext">sum_szsb_args :: ByteOff
</span><a href="#local-6989586621681283861"><span class="hs-identifier hs-var hs-var">sum_szsb_args</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621681283863"><span class="hs-identifier hs-var">szsb_args</span></a></span><span>
</span><span id="line-460"></span><span>         </span><span id="local-6989586621681283860"><span class="annot"><span class="annottext">p_init :: Map Id ByteOff
</span><a href="#local-6989586621681283860"><span class="hs-identifier hs-var hs-var">p_init</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283866"><span class="hs-identifier hs-var">all_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff -&gt; [ByteOff] -&gt; [ByteOff]
</span><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-var">mkStackOffsets</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621681283863"><span class="hs-identifier hs-var">szsb_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span>         </span><span class="hs-comment">-- make the arg bitmap</span><span>
</span><span id="line-463"></span><span>         </span><span id="local-6989586621681283857"><span class="annot"><span class="annottext">bits :: [Bool]
</span><a href="#local-6989586621681283857"><span class="hs-identifier hs-var hs-var">bits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [ArgRep] -&gt; [Bool]
</span><a href="GHC.StgToByteCode.html#argBits"><span class="hs-identifier hs-var">argBits</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283867"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ArgRep
</span><a href="GHC.StgToByteCode.html#bcIdArgRep"><span class="hs-identifier hs-var">bcIdArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283867"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283866"><span class="hs-identifier hs-var">all_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>         </span><span id="local-6989586621681283855"><span class="annot"><span class="annottext">bitmap_size :: Word16
</span><a href="#local-6989586621681283855"><span class="hs-identifier hs-var hs-var">bitmap_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall i a. Num i =&gt; [a] -&gt; i
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#genericLength"><span class="hs-identifier hs-var">genericLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681283857"><span class="hs-identifier hs-var">bits</span></a></span><span>
</span><span id="line-465"></span><span>         </span><span id="local-6989586621681283854"><span class="annot"><span class="annottext">bitmap :: [StgWord]
</span><a href="#local-6989586621681283854"><span class="hs-identifier hs-var hs-var">bitmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; [Bool] -&gt; [StgWord]
</span><a href="GHC.Data.Bitmap.html#mkBitmap"><span class="hs-identifier hs-var">mkBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283867"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681283857"><span class="hs-identifier hs-var">bits</span></a></span><span>
</span><span id="line-466"></span><span>     </span><span id="local-6989586621681283852"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283852"><span class="hs-identifier hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-var">schemeER_wrk</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283861"><span class="hs-identifier hs-var">sum_szsb_args</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283860"><span class="hs-identifier hs-var">p_init</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283869"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>     </span><span class="annot"><span class="annottext">([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; Word16
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var">mkProtoBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283867"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681283872"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283852"><span class="hs-identifier hs-var">body_code</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283871"><span class="hs-identifier hs-var">original_body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>                 </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283865"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283855"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621681283854"><span class="hs-identifier hs-var">bitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-comment">{-not alts-}</span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="hs-comment">-- introduce break instructions for ticked expressions</span><span>
</span><span id="line-472"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-type">schemeER_wrk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-473"></span><span id="schemeER_wrk"><span class="annot"><span class="annottext">schemeER_wrk :: ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-var hs-var">schemeER_wrk</span></a></span></span><span> </span><span id="local-6989586621681283850"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283850"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283849"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283849"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span id="local-6989586621681283848"><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621681283848"><span class="hs-identifier hs-var">tick_ty</span></a></span></span><span> </span><span id="local-6989586621681283847"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283847"><span class="hs-identifier hs-var">tick_no</span></a></span></span><span> </span><span id="local-6989586621681283846"><span class="annot"><span class="annottext">[XTickishId 'TickishPassStg]
</span><a href="#local-6989586621681283846"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283845"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283845"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span id="local-6989586621681283844"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283844"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283850"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283849"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283845"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span id="local-6989586621681283842"><span class="annot"><span class="annottext">Array Int (RemotePtr CostCentre)
</span><a href="#local-6989586621681283842"><span class="hs-identifier hs-var">cc_arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM (Array Int (RemotePtr CostCentre))
</span><a href="GHC.StgToByteCode.html#getCCArray"><span class="hs-identifier hs-var">getCCArray</span></a></span><span>
</span><span id="line-476"></span><span>        </span><span id="local-6989586621681283840"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681283840"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM Module
</span><a href="GHC.StgToByteCode.html#getCurrentModule"><span class="hs-identifier hs-var">getCurrentModule</span></a></span><span>
</span><span id="line-477"></span><span>        </span><span id="local-6989586621681283837"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283837"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-478"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283836"><span class="annot"><span class="annottext">idOffSets :: [Maybe (Id, Word16)]
</span><a href="#local-6989586621681283836"><span class="hs-identifier hs-var hs-var">idOffSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [Id] -&gt; [Maybe (Id, Word16)]
</span><a href="GHC.StgToByteCode.html#getVarOffSets"><span class="hs-identifier hs-var">getVarOffSets</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283837"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283850"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283849"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[XTickishId 'TickishPassStg]
</span><a href="#local-6989586621681283846"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-479"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283834"><span class="annot"><span class="annottext">breakInfo :: CgBreakInfo
</span><a href="#local-6989586621681283834"><span class="hs-identifier hs-var hs-var">breakInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CgBreakInfo"><span class="hs-identifier hs-type">CgBreakInfo</span></a></span><span>
</span><span id="line-480"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cgb_vars :: [Maybe (Id, Word16)]
</span><a href="GHC.ByteCode.Types.html#cgb_vars"><span class="hs-identifier hs-var">cgb_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe (Id, Word16)]
</span><a href="#local-6989586621681283836"><span class="hs-identifier hs-var">idOffSets</span></a></span><span>
</span><span id="line-481"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgb_resty :: Kind
</span><a href="GHC.ByteCode.Types.html#cgb_resty"><span class="hs-identifier hs-var">cgb_resty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621681283848"><span class="hs-identifier hs-var">tick_ty</span></a></span><span>
</span><span id="line-482"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; CgBreakInfo -&gt; BcM ()
</span><a href="GHC.StgToByteCode.html#newBreakInfo"><span class="hs-identifier hs-var">newBreakInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283847"><span class="hs-identifier hs-var">tick_no</span></a></span><span> </span><span class="annot"><span class="annottext">CgBreakInfo
</span><a href="#local-6989586621681283834"><span class="hs-identifier hs-var">breakInfo</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span id="local-6989586621681283829"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681283829"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM HscEnv
</span><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283827"><span class="annot"><span class="annottext">cc :: RemotePtr CostCentre
</span><a href="#local-6989586621681283827"><span class="hs-identifier hs-var hs-var">cc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283826"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681283826"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681283829"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-486"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier hs-var">interpreterProfiled</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681283826"><span class="hs-identifier hs-var">interp</span></a></span><span>
</span><span id="line-487"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array Int (RemotePtr CostCentre)
</span><a href="#local-6989586621681283842"><span class="hs-identifier hs-var">cc_arr</span></a></span><span> </span><span class="annot"><span class="annottext">forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><a href="../../base-4.16.3.0/src/GHC-Arr.html#%21"><span class="hs-operator hs-var">!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283847"><span class="hs-identifier hs-var">tick_no</span></a></span><span>
</span><span id="line-488"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; RemotePtr a
</span><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#toRemotePtr"><span class="hs-identifier hs-var">toRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a
</span><a href="../../base-4.16.3.0/src/GHC-Ptr.html#nullPtr"><span class="hs-identifier hs-var">nullPtr</span></a></span><span>
</span><span id="line-489"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283820"><span class="annot"><span class="annottext">breakInstr :: BCInstr
</span><a href="#local-6989586621681283820"><span class="hs-identifier hs-var hs-var">breakInstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Unique -&gt; RemotePtr CostCentre -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#BRK_FUN"><span class="hs-identifier hs-var">BRK_FUN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283847"><span class="hs-identifier hs-var">tick_no</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681283840"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RemotePtr CostCentre
</span><a href="#local-6989586621681283827"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-490"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283820"><span class="hs-identifier hs-var">breakInstr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283844"><span class="hs-identifier hs-var">code</span></a></span><span>
</span><span id="line-491"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeER_wrk"><span class="hs-identifier hs-var">schemeER_wrk</span></a></span><span> </span><span id="local-6989586621681283816"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283816"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283815"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283815"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283814"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283814"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283816"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283815"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283814"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><a href="GHC.StgToByteCode.html#getVarOffSets"><span class="hs-identifier hs-type">getVarOffSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-494"></span><span id="getVarOffSets"><span class="annot"><span class="annottext">getVarOffSets :: Platform
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [Id] -&gt; [Maybe (Id, Word16)]
</span><a href="GHC.StgToByteCode.html#getVarOffSets"><span class="hs-identifier hs-var hs-var">getVarOffSets</span></a></span></span><span> </span><span id="local-6989586621681283813"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283813"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681283812"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283812"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span id="local-6989586621681283811"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283811"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe (Id, Word16)
</span><a href="#local-6989586621681283810"><span class="hs-identifier hs-var">getOffSet</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-496"></span><span>    </span><span id="local-6989586621681283810"><span class="annot"><span class="annottext">getOffSet :: Id -&gt; Maybe (Id, Word16)
</span><a href="#local-6989586621681283810"><span class="hs-identifier hs-var hs-var">getOffSet</span></a></span></span><span> </span><span id="local-6989586621681283809"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283809"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var">lookupBCEnv_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283809"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283811"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><span class="annottext">Maybe ByteOff
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-498"></span><span>        </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283807"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283807"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-499"></span><span>            </span><span class="hs-comment">-- michalt: I'm not entirely sure why we need the stack</span><span>
</span><span id="line-500"></span><span>            </span><span class="hs-comment">-- adjustment by 2 here. I initially thought that there's</span><span>
</span><span id="line-501"></span><span>            </span><span class="hs-comment">-- something off with getIdValFromApStack (the only user of this</span><span>
</span><span id="line-502"></span><span>            </span><span class="hs-comment">-- value), but it looks ok to me. My current hypothesis is that</span><span>
</span><span id="line-503"></span><span>            </span><span class="hs-comment">-- this &quot;adjustment&quot; is needed due to stack manipulation for</span><span>
</span><span id="line-504"></span><span>            </span><span class="hs-comment">-- BRK_FUN in Interpreter.c In any case, this is used only when</span><span>
</span><span id="line-505"></span><span>            </span><span class="hs-comment">-- we trigger a breakpoint.</span><span>
</span><span id="line-506"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283806"><span class="annot"><span class="annottext">var_depth_ws :: Word16
</span><a href="#local-6989586621681283806"><span class="hs-identifier hs-var hs-var">var_depth_ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-507"></span><span>                    </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283813"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283812"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283807"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">2</span></span><span>
</span><span id="line-508"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283809"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283806"><span class="hs-identifier hs-var">var_depth_ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span id="local-6989586621681284960"><span class="annot"><a href="GHC.StgToByteCode.html#truncIntegral16"><span class="hs-identifier hs-type">truncIntegral16</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Real.html#Integral"><span class="hs-identifier hs-type">Integral</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284960"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681284960"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span></span><span>
</span><span id="line-511"></span><span id="truncIntegral16"><span class="annot"><span class="annottext">truncIntegral16 :: forall a. Integral a =&gt; a -&gt; Word16
</span><a href="GHC.StgToByteCode.html#truncIntegral16"><span class="hs-identifier hs-var hs-var">truncIntegral16</span></a></span></span><span> </span><span id="local-6989586621681283789"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283789"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283789"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;stack depth overflow&quot;</span></span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283789"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="annot"><a href="GHC.StgToByteCode.html#trunc16B"><span class="hs-identifier hs-type">trunc16B</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-518"></span><span id="trunc16B"><span class="annot"><span class="annottext">trunc16B :: ByteOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16B"><span class="hs-identifier hs-var hs-var">trunc16B</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; Word16
</span><a href="GHC.StgToByteCode.html#truncIntegral16"><span class="hs-identifier hs-var">truncIntegral16</span></a></span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span class="annot"><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-type">trunc16W</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-521"></span><span id="trunc16W"><span class="annot"><span class="annottext">trunc16W :: WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var hs-var">trunc16W</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; Word16
</span><a href="GHC.StgToByteCode.html#truncIntegral16"><span class="hs-identifier hs-var">truncIntegral16</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="annot"><a href="GHC.StgToByteCode.html#fvsToEnv"><span class="hs-identifier hs-type">fvsToEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-524"></span><span class="hs-comment">-- Takes the free variables of a right-hand side, and</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- delivers an ordered list of the local variables that will</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- be captured in the thunk for the RHS</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- The BCEnv argument tells which variables are in the local</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- environment: these are the ones that should be captured</span><span>
</span><span id="line-529"></span><span class="hs-comment">--</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- The code that constructs the thunk, and the code that executes</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- it, have to agree about this layout</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span id="fvsToEnv"><span class="annot"><span class="annottext">fvsToEnv :: Map Id ByteOff -&gt; CgStgRhs -&gt; [Id]
</span><a href="GHC.StgToByteCode.html#fvsToEnv"><span class="hs-identifier hs-var hs-var">fvsToEnv</span></a></span></span><span> </span><span id="local-6989586621681283784"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283784"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283783"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283783"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283782"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681283782"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283782"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; [Id]
</span><a href="GHC.Types.Var.Set.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (pass :: StgPass).
(XRhsClosure pass ~ DIdSet) =&gt;
GenStgRhs pass -&gt; DIdSet
</span><a href="GHC.Stg.Syntax.html#freeVarsOfRhs"><span class="hs-identifier hs-var">freeVarsOfRhs</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283783"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-534"></span><span>                       </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283782"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#member"><span class="hs-operator hs-var">`Map.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283784"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- schemeE</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-comment">-- Returning an unlifted value.</span><span>
</span><span id="line-540"></span><span class="hs-comment">-- Heave it on the stack, SLIDE, and RETURN.</span><span>
</span><span id="line-541"></span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-type">returnUnliftedAtom</span></a></span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-547"></span><span id="returnUnliftedAtom"><span class="annot"><span class="annottext">returnUnliftedAtom :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-var hs-var">returnUnliftedAtom</span></a></span></span><span> </span><span id="local-6989586621681283777"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283777"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283776"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283776"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283775"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283775"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283774"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283774"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283773"><span class="annot"><span class="annottext">reps :: [PrimRep]
</span><a href="#local-6989586621681283773"><span class="hs-identifier hs-var hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283774"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-549"></span><span>                 </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621681283771"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283771"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRepArgs"><span class="hs-identifier hs-var">typePrimRepArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Kind
</span><a href="GHC.Types.Literal.html#literalType"><span class="hs-identifier hs-var">literalType</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283771"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>                 </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681283768"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283768"><span class="hs-identifier hs-var">i</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [PrimRep]
</span><a href="GHC.StgToByteCode.html#bcIdPrimReps"><span class="hs-identifier hs-var">bcIdPrimReps</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283768"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681283766"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283766"><span class="hs-identifier hs-var">push</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283765"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283765"><span class="hs-identifier hs-var">szb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283777"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283775"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283774"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span id="local-6989586621681283763"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283763"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff -&gt; [PrimRep] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-var">returnUnliftedReps</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283777"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283776"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283765"><span class="hs-identifier hs-var">szb</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283773"><span class="hs-identifier hs-var">reps</span></a></span><span>
</span><span id="line-553"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283766"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283763"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="hs-comment">-- return an unlifted value from the top of the stack</span><span>
</span><span id="line-556"></span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-type">returnUnliftedReps</span></a></span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>    </span><span class="hs-comment">-- size of the thing we're returning</span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- representations</span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-562"></span><span id="returnUnliftedReps"><span class="annot"><span class="annottext">returnUnliftedReps :: ByteOff -&gt; ByteOff -&gt; ByteOff -&gt; [PrimRep] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-var hs-var">returnUnliftedReps</span></a></span></span><span> </span><span id="local-6989586621681283760"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283760"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283759"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283759"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283758"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283758"><span class="hs-identifier hs-var">szb</span></a></span></span><span> </span><span id="local-6989586621681283757"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283757"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-563"></span><span>    </span><span id="local-6989586621681283756"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283756"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283755"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681283755"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283756"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-565"></span><span>        </span><span id="local-6989586621681283754"><span class="annot"><span class="annottext">non_void :: PrimRep -&gt; Bool
</span><a href="#local-6989586621681283754"><span class="hs-identifier hs-var hs-var">non_void</span></a></span></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-566"></span><span>        </span><span class="annot"><a href="#local-6989586621681283754"><span class="hs-identifier hs-var">non_void</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-567"></span><span>    </span><span id="local-6989586621681283752"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283752"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="#local-6989586621681283754"><span class="hs-identifier hs-var">non_void</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283757"><span class="hs-identifier hs-var">reps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-568"></span><span>             </span><span class="hs-comment">-- use RETURN_UBX for unary representations</span><span>
</span><span id="line-569"></span><span>             </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_UNLIFTED"><span class="hs-identifier hs-var">RETURN_UNLIFTED</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V"><span class="hs-identifier hs-var">V</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>             </span><span class="hs-special">[</span><span id="local-6989586621681283750"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283750"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_UNLIFTED"><span class="hs-identifier hs-var">RETURN_UNLIFTED</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283750"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>             </span><span class="hs-comment">-- otherwise use RETURN_TUPLE with a tuple descriptor</span><span>
</span><span id="line-572"></span><span>             </span><span id="local-6989586621681283748"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283748"><span class="hs-identifier hs-var">nv_reps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-573"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283747"><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283747"><span class="hs-identifier hs-var">tuple_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283746"><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621681283746"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
Profile
-&gt; ByteOff -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (TupleInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutTuple"><span class="hs-identifier hs-var">layoutTuple</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283756"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#primRepCmmType"><span class="hs-identifier hs-var">primRepCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283755"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283748"><span class="hs-identifier hs-var">nv_reps</span></a></span><span>
</span><span id="line-574"></span><span>                   </span><span id="local-6989586621681283743"><span class="annot"><span class="annottext">args_ptrs :: [(Bool, ByteOff)]
</span><a href="#local-6989586621681283743"><span class="hs-identifier hs-var hs-var">args_ptrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681283742"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283742"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283741"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283741"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283742"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283741"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621681283746"><span class="hs-identifier hs-var">args_offsets</span></a></span><span>
</span><span id="line-575"></span><span>               </span><span id="local-6989586621681283740"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283740"><span class="hs-identifier hs-var">tuple_bco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform
-&gt; TupleInfo -&gt; [(Bool, ByteOff)] -&gt; [FFIInfo] -&gt; ProtoBCO Name
</span><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-var">tupleBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283747"><span class="hs-identifier hs-var">tuple_info</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, ByteOff)]
</span><a href="#local-6989586621681283743"><span class="hs-identifier hs-var">args_ptrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>               </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; TupleInfo -&gt; Literal
</span><a href="GHC.ByteCode.Asm.html#mkTupleInfoLit"><span class="hs-identifier hs-var">mkTupleInfoLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283747"><span class="hs-identifier hs-var">tuple_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span>
</span><span id="line-577"></span><span>                        </span><span class="annot"><span class="annottext">ProtoBCO Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_BCO"><span class="hs-identifier hs-var">PUSH_BCO</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283740"><span class="hs-identifier hs-var">tuple_bco</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span>
</span><span id="line-578"></span><span>                        </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_TUPLE"><span class="hs-identifier hs-var">RETURN_TUPLE</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; ByteOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-var">mkSlideB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283755"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283758"><span class="hs-identifier hs-var">szb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283760"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283759"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- clear to sequel</span><span>
</span><span id="line-580"></span><span>             </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>  </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283752"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- go</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="hs-comment">-- construct and return an unboxed tuple</span><span>
</span><span id="line-583"></span><span class="annot"><a href="GHC.StgToByteCode.html#returnUnboxedTuple"><span class="hs-identifier hs-type">returnUnboxedTuple</span></a></span><span>
</span><span id="line-584"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-587"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-589"></span><span id="returnUnboxedTuple"><span class="annot"><span class="annottext">returnUnboxedTuple :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [StgArg] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnboxedTuple"><span class="hs-identifier hs-var hs-var">returnUnboxedTuple</span></a></span></span><span> </span><span id="local-6989586621681283732"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283732"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283731"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283731"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283730"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283730"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283729"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283729"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>    </span><span id="local-6989586621681283728"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283728"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283727"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681283727"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283728"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-592"></span><span>        </span><span id="local-6989586621681283726"><span class="annot"><span class="annottext">arg_ty :: StgArg -&gt; CmmType
</span><a href="#local-6989586621681283726"><span class="hs-identifier hs-var hs-var">arg_ty</span></a></span></span><span> </span><span id="local-6989586621681283725"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283725"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#primRepCmmType"><span class="hs-identifier hs-var">primRepCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283727"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgArg -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-var">atomPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283725"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681283723"><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283723"><span class="hs-identifier hs-var">tuple_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283722"><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621681283722"><span class="hs-identifier hs-var">tuple_components</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
Profile
-&gt; ByteOff -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (TupleInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutTuple"><span class="hs-identifier hs-var">layoutTuple</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283728"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283732"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; CmmType
</span><a href="#local-6989586621681283726"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283729"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-594"></span><span>        </span><span id="local-6989586621681283721"><span class="annot"><span class="annottext">go :: ByteOff
-&gt; [OrdList BCInstr]
-&gt; [(StgArg, ByteOff)]
-&gt; BcM [OrdList BCInstr]
</span><a href="#local-6989586621681283721"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621681283720"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283720"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283720"><span class="hs-identifier hs-var">pushes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>        </span><span class="annot"><a href="#local-6989586621681283721"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283719"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283719"><span class="hs-identifier hs-var">dd</span></a></span></span><span> </span><span id="local-6989586621681283718"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283718"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681283717"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283717"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283716"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283716"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681283715"><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621681283715"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283714"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283714"><span class="hs-identifier hs-var">push</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283713"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283713"><span class="hs-identifier hs-var">szb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283719"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283730"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283717"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-596"></span><span>                                         </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span class="hs-identifier">off</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">dd</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">szb</span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>                                         </span><span class="annot"><span class="annottext">ByteOff
-&gt; [OrdList BCInstr]
-&gt; [(StgArg, ByteOff)]
-&gt; BcM [OrdList BCInstr]
</span><a href="#local-6989586621681283721"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283719"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283713"><span class="hs-identifier hs-var">szb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283714"><span class="hs-identifier hs-var">push</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283718"><span class="hs-identifier hs-var">pushes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621681283715"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span id="local-6989586621681283709"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283709"><span class="hs-identifier hs-var">pushes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; [OrdList BCInstr]
-&gt; [(StgArg, ByteOff)]
-&gt; BcM [OrdList BCInstr]
</span><a href="#local-6989586621681283721"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283732"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(StgArg, ByteOff)]
</span><a href="#local-6989586621681283722"><span class="hs-identifier hs-var">tuple_components</span></a></span><span>
</span><span id="line-599"></span><span>    </span><span id="local-6989586621681283708"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283708"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff -&gt; ByteOff -&gt; [PrimRep] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedReps"><span class="hs-identifier hs-var">returnUnliftedReps</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283732"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-600"></span><span>                              </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283731"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-601"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283727"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#tupleSize"><span class="hs-identifier hs-var">tupleSize</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283723"><span class="hs-identifier hs-var">tuple_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-var">atomPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283729"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283709"><span class="hs-identifier hs-var">pushes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283708"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="hs-comment">-- Compile code to apply the given expression to the remaining args</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- on the stack, returning a HNF.</span><span>
</span><span id="line-607"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-type">schemeE</span></a></span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-609"></span><span id="schemeE"><span class="annot"><span class="annottext">schemeE :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var hs-var">schemeE</span></a></span></span><span> </span><span id="local-6989586621681283706"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283706"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283705"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283705"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283704"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283704"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-type">StgLit</span></a></span><span> </span><span id="local-6989586621681283703"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283703"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-var">returnUnliftedAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283706"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283705"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283704"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283703"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283702"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283702"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283701"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283701"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283700"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283700"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621681283699"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283699"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283699"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnliftedAtom"><span class="hs-identifier hs-var">returnUnliftedAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283702"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283701"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283700"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283699"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span class="hs-comment">-- Delegate tail-calls to schemeT.</span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283696"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283696"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283695"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283695"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283694"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283694"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283693"><span class="annot"><span class="annottext">e :: CgStgExpr
</span><a href="#local-6989586621681283693"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283696"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283695"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283694"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283693"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-614"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283691"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283691"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283690"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283690"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283689"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283689"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283688"><span class="annot"><span class="annottext">e :: CgStgExpr
</span><a href="#local-6989586621681283688"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283691"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283690"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283689"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283688"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-615"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283687"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283687"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283686"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283686"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283685"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283685"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283684"><span class="annot"><span class="annottext">e :: CgStgExpr
</span><a href="#local-6989586621681283684"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283687"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283686"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283685"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283684"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-616"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283683"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283683"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283682"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283682"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283681"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283681"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-type">StgLetNoEscape</span></a></span><span> </span><span id="local-6989586621681283680"><span class="annot"><span class="annottext">XLetNoEscape 'CodeGen
</span><a href="#local-6989586621681283680"><span class="hs-identifier hs-var">xlet</span></a></span></span><span> </span><span id="local-6989586621681283679"><span class="annot"><span class="annottext">CgStgBinding
</span><a href="#local-6989586621681283679"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span id="local-6989586621681283678"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283678"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283683"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283682"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283681"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLetNoEscape 'CodeGen
</span><a href="#local-6989586621681283680"><span class="hs-identifier hs-var">xlet</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgBinding
</span><a href="#local-6989586621681283679"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283678"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283677"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283677"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283676"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283676"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283675"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283675"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span id="local-6989586621681283674"><span class="annot"><span class="annottext">XLet 'CodeGen
</span><a href="#local-6989586621681283674"><span class="hs-identifier hs-var">_xlet</span></a></span></span><span>
</span><span id="line-619"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681283673"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283673"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621681283672"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681283672"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621681283671"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283671"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621681283670"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681283670"><span class="hs-identifier hs-var">_cnum</span></a></span></span><span> </span><span id="local-6989586621681283669"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681283669"><span class="hs-identifier hs-var">_ticks</span></a></span></span><span> </span><span id="local-6989586621681283668"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283668"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>                      </span><span id="local-6989586621681283667"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283667"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Special case for a non-recursive let whose RHS is a</span><span>
</span><span id="line-622"></span><span>        </span><span class="hs-comment">-- saturated constructor application.</span><span>
</span><span id="line-623"></span><span>        </span><span class="hs-comment">-- Just allocate the constructor and carry on</span><span>
</span><span id="line-624"></span><span>        </span><span id="local-6989586621681283666"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283666"><span class="hs-identifier hs-var">alloc_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; DataCon
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-var">mkConAppCode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283677"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283676"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283675"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283671"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283668"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-625"></span><span>        </span><span id="local-6989586621681283664"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283664"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-626"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283661"><span class="annot"><span class="annottext">d2 :: ByteOff
</span><a href="#local-6989586621681283661"><span class="hs-identifier hs-var hs-var">d2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283677"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283664"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-627"></span><span>        </span><span id="local-6989586621681283660"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283660"><span class="hs-identifier hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283661"><span class="hs-identifier hs-var">d2</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283676"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283673"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283661"><span class="hs-identifier hs-var">d2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283675"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283667"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283666"><span class="hs-identifier hs-var">alloc_code</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283660"><span class="hs-identifier hs-var">body_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span class="hs-comment">-- General case for let.  Generates correct, if inefficient, code in</span><span>
</span><span id="line-630"></span><span class="hs-comment">-- all situations.</span><span>
</span><span id="line-631"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283658"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283658"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283657"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283657"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283656"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283656"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span id="local-6989586621681283655"><span class="annot"><span class="annottext">XLet 'CodeGen
</span><a href="#local-6989586621681283655"><span class="hs-identifier hs-var">_ext</span></a></span></span><span> </span><span id="local-6989586621681283654"><span class="annot"><span class="annottext">CgStgBinding
</span><a href="#local-6989586621681283654"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621681283653"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283653"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-632"></span><span>     </span><span id="local-6989586621681283652"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283652"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-633"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283651"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283651"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681283650"><span class="annot"><span class="annottext">[CgStgRhs]
</span><a href="#local-6989586621681283650"><span class="hs-identifier hs-var">rhss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CgStgBinding
</span><a href="#local-6989586621681283654"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681283649"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283649"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681283648"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283648"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283649"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283648"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>                                   </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681283647"><span class="annot"><span class="annottext">[(BinderP 'CodeGen, CgStgRhs)]
</span><a href="#local-6989586621681283647"><span class="hs-identifier hs-var">xs_n_rhss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(BinderP 'CodeGen, CgStgRhs)]
</span><a href="#local-6989586621681283647"><span class="hs-identifier hs-var">xs_n_rhss</span></a></span><span>
</span><span id="line-635"></span><span>         </span><span id="local-6989586621681283646"><span class="annot"><span class="annottext">n_binds :: WordOff
</span><a href="#local-6989586621681283646"><span class="hs-identifier hs-var hs-var">n_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall i a. Num i =&gt; [a] -&gt; i
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#genericLength"><span class="hs-identifier hs-var">genericLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283651"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span>         </span><span id="local-6989586621681283645"><span class="annot"><span class="annottext">fvss :: [[Id]]
</span><a href="#local-6989586621681283645"><span class="hs-identifier hs-var hs-var">fvss</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Id ByteOff -&gt; CgStgRhs -&gt; [Id]
</span><a href="GHC.StgToByteCode.html#fvsToEnv"><span class="hs-identifier hs-var">fvsToEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283644"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgRhs]
</span><a href="#local-6989586621681283650"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>         </span><span class="hs-comment">-- Sizes of free vars</span><span>
</span><span id="line-640"></span><span>         </span><span id="local-6989586621681283643"><span class="annot"><span class="annottext">size_w :: Id -&gt; Word16
</span><a href="#local-6989586621681283643"><span class="hs-identifier hs-var hs-var">size_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-var">idSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283652"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-641"></span><span>         </span><span id="local-6989586621681283642"><span class="annot"><span class="annottext">sizes :: [Word16]
</span><a href="#local-6989586621681283642"><span class="hs-identifier hs-var hs-var">sizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681283641"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283641"><span class="hs-identifier hs-var">rhs_fvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Word16
</span><a href="#local-6989586621681283643"><span class="hs-identifier hs-var">size_w</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283641"><span class="hs-identifier hs-var">rhs_fvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Id]]
</span><a href="#local-6989586621681283645"><span class="hs-identifier hs-var">fvss</span></a></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>         </span><span class="hs-comment">-- the arity of each rhs</span><span>
</span><span id="line-644"></span><span>         </span><span id="local-6989586621681283640"><span class="annot"><span class="annottext">arities :: [Word16]
</span><a href="#local-6989586621681283640"><span class="hs-identifier hs-var hs-var">arities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i a. Num i =&gt; [a] -&gt; i
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#genericLength"><span class="hs-identifier hs-var">genericLength</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs -&gt; ([Id], CgStgExpr)
</span><a href="GHC.StgToByteCode.html#collect"><span class="hs-identifier hs-var">collect</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgRhs]
</span><a href="#local-6989586621681283650"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>         </span><span class="hs-comment">-- This p', d' defn is safe because all the items being pushed</span><span>
</span><span id="line-647"></span><span>         </span><span class="hs-comment">-- are ptrs, so all have size 1 word.  d' and p' reflect the stack</span><span>
</span><span id="line-648"></span><span>         </span><span class="hs-comment">-- after the closures have been allocated in the heap (but not</span><span>
</span><span id="line-649"></span><span>         </span><span class="hs-comment">-- filled in), and pointers to them parked on the stack.</span><span>
</span><span id="line-650"></span><span>         </span><span id="local-6989586621681283639"><span class="annot"><span class="annottext">offsets :: [ByteOff]
</span><a href="#local-6989586621681283639"><span class="hs-identifier hs-var hs-var">offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [ByteOff] -&gt; [ByteOff]
</span><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-var">mkStackOffsets</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283658"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i a. Integral i =&gt; i -&gt; a -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#genericReplicate"><span class="hs-identifier hs-var">genericReplicate</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283646"><span class="hs-identifier hs-var">n_binds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283652"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>         </span><span id="local-6989586621681283644"><span class="annot"><span class="annottext">p' :: Map Id ByteOff
</span><a href="#local-6989586621681283644"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key elt.
Ord key =&gt;
[(key, elt)] -&gt; Map key elt -&gt; Map key elt
</span><a href="GHC.Data.FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map.insertList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="#local-6989586621681283637"><span class="hs-identifier hs-var">zipE</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283651"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621681283639"><span class="hs-identifier hs-var">offsets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283656"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-652"></span><span>         </span><span id="local-6989586621681283636"><span class="annot"><span class="annottext">d' :: ByteOff
</span><a href="#local-6989586621681283636"><span class="hs-identifier hs-var hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283658"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283652"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283646"><span class="hs-identifier hs-var">n_binds</span></a></span><span>
</span><span id="line-653"></span><span>         </span><span id="local-6989586621681283637"><span class="annot"><span class="annottext">zipE :: [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="#local-6989586621681283637"><span class="hs-identifier hs-var hs-var">zipE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE&quot;</span></span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span>         </span><span class="hs-comment">-- ToDo: don't build thunks for things with no free variables</span><span>
</span><span id="line-656"></span><span>         </span><span class="annot"><a href="#local-6989586621681283634"><span class="hs-identifier hs-type">build_thunk</span></a></span><span>
</span><span id="line-657"></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-658"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-659"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-660"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-661"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-662"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-663"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-664"></span><span>         </span><span id="local-6989586621681283634"><span class="annot"><span class="annottext">build_thunk :: ByteOff
-&gt; [Id]
-&gt; Word16
-&gt; ProtoBCO Name
-&gt; Word16
-&gt; Word16
-&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283634"><span class="hs-identifier hs-var hs-var">build_thunk</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681283633"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283633"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621681283632"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283632"><span class="hs-identifier hs-var">bco</span></a></span></span><span> </span><span id="local-6989586621681283631"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283631"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621681283630"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283630"><span class="hs-identifier hs-var">arity</span></a></span></span><span>
</span><span id="line-665"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtoBCO Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_BCO"><span class="hs-identifier hs-var">PUSH_BCO</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283632"><span class="hs-identifier hs-var">bco</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="#local-6989586621681283629"><span class="hs-identifier hs-var">mkap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283631"><span class="hs-identifier hs-var">off</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283633"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283633"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-667"></span><span>                </span><span id="local-6989586621681283629"><span class="annot"><span class="annottext">mkap :: Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="#local-6989586621681283629"><span class="hs-identifier hs-var hs-var">mkap</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283630"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#MKAP"><span class="hs-identifier hs-var">MKAP</span></a></span><span>
</span><span id="line-668"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#MKPAP"><span class="hs-identifier hs-var">MKPAP</span></a></span><span>
</span><span id="line-669"></span><span>         </span><span class="annot"><a href="#local-6989586621681283634"><span class="hs-identifier hs-var">build_thunk</span></a></span><span> </span><span id="local-6989586621681283626"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283626"><span class="hs-identifier hs-var">dd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283625"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283625"><span class="hs-identifier hs-var">fv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681283624"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283624"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283623"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283623"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621681283622"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283622"><span class="hs-identifier hs-var">bco</span></a></span></span><span> </span><span id="local-6989586621681283621"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283621"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span id="local-6989586621681283620"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283620"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-670"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621681283619"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283619"><span class="hs-identifier hs-var">push_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283618"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283618"><span class="hs-identifier hs-var">pushed_szb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283626"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283644"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283625"><span class="hs-identifier hs-var">fv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>              </span><span id="local-6989586621681283617"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283617"><span class="hs-identifier hs-var">more_push_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-672"></span><span>                  </span><span class="annot"><span class="annottext">ByteOff
-&gt; [Id]
-&gt; Word16
-&gt; ProtoBCO Name
-&gt; Word16
-&gt; Word16
-&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283634"><span class="hs-identifier hs-var">build_thunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283626"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283618"><span class="hs-identifier hs-var">pushed_szb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283624"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283623"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283622"><span class="hs-identifier hs-var">bco</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283621"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283620"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-673"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283619"><span class="hs-identifier hs-var">push_code</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283617"><span class="hs-identifier hs-var">more_push_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>         </span><span id="local-6989586621681283616"><span class="annot"><span class="annottext">alloc_code :: OrdList BCInstr
</span><a href="#local-6989586621681283616"><span class="hs-identifier hs-var hs-var">alloc_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="#local-6989586621681283614"><span class="hs-identifier hs-var">mkAlloc</span></a></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621681283642"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621681283640"><span class="hs-identifier hs-var">arities</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>           </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681283614"><span class="annot"><span class="annottext">mkAlloc :: Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="#local-6989586621681283614"><span class="hs-identifier hs-var hs-var">mkAlloc</span></a></span></span><span> </span><span id="local-6989586621681283613"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283613"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span>
</span><span id="line-677"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283612"><span class="hs-identifier hs-var">is_tick</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#ALLOC_AP_NOUPD"><span class="hs-identifier hs-var">ALLOC_AP_NOUPD</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283613"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-678"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#ALLOC_AP"><span class="hs-identifier hs-var">ALLOC_AP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283613"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-679"></span><span>                 </span><span class="annot"><a href="#local-6989586621681283614"><span class="hs-identifier hs-var">mkAlloc</span></a></span><span> </span><span id="local-6989586621681283609"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283609"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621681283608"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283608"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#ALLOC_PAP"><span class="hs-identifier hs-var">ALLOC_PAP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283608"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283609"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>         </span><span id="local-6989586621681283612"><span class="annot"><span class="annottext">is_tick :: Bool
</span><a href="#local-6989586621681283612"><span class="hs-identifier hs-var hs-var">is_tick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CgStgBinding
</span><a href="#local-6989586621681283654"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-682"></span><span>                     </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681283606"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283606"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283606"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToByteCode.html#tickFS"><span class="hs-identifier hs-var">tickFS</span></a></span><span>
</span><span id="line-683"></span><span>                     </span><span id="local-6989586621681283602"><span class="annot"><span class="annottext">CgStgBinding
</span><a href="#local-6989586621681283602"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>         </span><span id="local-6989586621681283598"><span class="annot"><span class="annottext">compile_bind :: ByteOff
-&gt; [Id]
-&gt; a
-&gt; CgStgRhs
-&gt; Word16
-&gt; Word16
-&gt; Word16
-&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283598"><span class="hs-identifier hs-var hs-var">compile_bind</span></a></span></span><span> </span><span id="local-6989586621681283597"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283597"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span id="local-6989586621681283596"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283596"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681283595"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283595"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283594"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283594"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">::</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283593"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283593"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span id="local-6989586621681283592"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283592"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621681283591"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283591"><span class="hs-identifier hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-686"></span><span>                </span><span id="local-6989586621681283590"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283590"><span class="hs-identifier hs-var">bco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; (Name, CgStgRhs) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#schemeR"><span class="hs-identifier hs-var">schemeR</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283596"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283595"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283594"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
-&gt; [Id]
-&gt; Word16
-&gt; ProtoBCO Name
-&gt; Word16
-&gt; Word16
-&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283634"><span class="hs-identifier hs-var">build_thunk</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283597"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283596"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283593"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283590"><span class="hs-identifier hs-var">bco</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283591"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283592"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>         </span><span id="local-6989586621681283589"><span class="annot"><span class="annottext">compile_binds :: [BcM (OrdList BCInstr)]
</span><a href="#local-6989586621681283589"><span class="hs-identifier hs-var hs-var">compile_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-690"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall {a}.
NamedThing a =&gt;
ByteOff
-&gt; [Id]
-&gt; a
-&gt; CgStgRhs
-&gt; Word16
-&gt; Word16
-&gt; Word16
-&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283598"><span class="hs-identifier hs-var">compile_bind</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283636"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283588"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283587"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283586"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283585"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283584"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283583"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283588"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283588"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283587"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283587"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283586"><span class="annot"><span class="annottext">CgStgRhs
</span><a href="#local-6989586621681283586"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283585"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283585"><span class="hs-identifier hs-var">size</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283584"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283584"><span class="hs-identifier hs-var">arity</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283583"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283583"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-692"></span><span>                </span><span class="annot"><span class="annottext">forall a b c d e f.
[a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [e] -&gt; [f] -&gt; [(a, b, c, d, e, f)]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#zip6"><span class="hs-identifier hs-var">zip6</span></a></span><span> </span><span class="annot"><span class="annottext">[[Id]]
</span><a href="#local-6989586621681283645"><span class="hs-identifier hs-var">fvss</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283651"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgRhs]
</span><a href="#local-6989586621681283650"><span class="hs-identifier hs-var">rhss</span></a></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621681283642"><span class="hs-identifier hs-var">sizes</span></a></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621681283640"><span class="hs-identifier hs-var">arities</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283646"><span class="hs-identifier hs-var">n_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283646"><span class="hs-identifier hs-var">n_binds</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-693"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-694"></span><span>     </span><span id="local-6989586621681283582"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283582"><span class="hs-identifier hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283636"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283657"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283644"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283653"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-695"></span><span>     </span><span id="local-6989586621681283581"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283581"><span class="hs-identifier hs-var">thunk_codes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="annot"><span class="annottext">[BcM (OrdList BCInstr)]
</span><a href="#local-6989586621681283589"><span class="hs-identifier hs-var">compile_binds</span></a></span><span>
</span><span id="line-696"></span><span>     </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283616"><span class="hs-identifier hs-var">alloc_code</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [OrdList a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-var">concatOL</span></a></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283581"><span class="hs-identifier hs-var">thunk_codes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283582"><span class="hs-identifier hs-var">body_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283578"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283578"><span class="hs-identifier hs-var">_d</span></a></span></span><span> </span><span id="local-6989586621681283577"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283577"><span class="hs-identifier hs-var">_s</span></a></span></span><span> </span><span id="local-6989586621681283576"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283576"><span class="hs-identifier hs-var">_p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681283575"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283575"><span class="hs-identifier hs-var">bp_id</span></a></span></span><span> </span><span class="annot"><span class="annottext">[XTickishId 'TickishPassStg]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283574"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283574"><span class="hs-identifier hs-var">_rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE: Breakpoint without let binding: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-700"></span><span>            </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283575"><span class="hs-identifier hs-var">bp_id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-701"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; forgot to run bcPrep?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="hs-comment">-- ignore other kinds of tick</span><span>
</span><span id="line-704"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283572"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283572"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283571"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283571"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283570"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283570"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681283569"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283569"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283572"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283571"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283570"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283569"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="hs-comment">-- no alts: scrut is guaranteed to diverge</span><span>
</span><span id="line-707"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283568"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283568"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283567"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283567"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283566"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283566"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span id="local-6989586621681283565"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283565"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AltType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283568"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283567"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283566"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283565"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span id="local-6989586621681283564"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283564"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283563"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283563"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283562"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283562"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span id="local-6989586621681283561"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283561"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621681283560"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283560"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">AltType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681283559"><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621681283559"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CgStgExpr
-&gt; Id
-&gt; [CgStgAlt]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doCase"><span class="hs-identifier hs-var">doCase</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283564"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283563"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283562"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283561"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681283560"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621681283559"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="hs-comment">-- Is this Id a not-necessarily-lifted join point?</span><span>
</span><span id="line-713"></span><span class="hs-comment">-- See Note [Not-necessarily-lifted join points], step 1</span><span>
</span><span id="line-714"></span><span class="annot"><a href="GHC.StgToByteCode.html#isNNLJoinPoint"><span class="hs-identifier hs-type">isNNLJoinPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-715"></span><span id="isNNLJoinPoint"><span class="annot"><span class="annottext">isNNLJoinPoint :: Id -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isNNLJoinPoint"><span class="hs-identifier hs-var hs-var">isNNLJoinPoint</span></a></span></span><span> </span><span id="local-6989586621681283557"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283557"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283557"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-716"></span><span>                   </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; Maybe Bool
</span><a href="GHC.Core.Type.html#isLiftedType_maybe"><span class="hs-identifier hs-var">isLiftedType_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283557"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span class="hs-comment">-- Update an Id's type to take a Void# argument.</span><span>
</span><span id="line-719"></span><span class="hs-comment">-- Precondition: the Id is a not-necessarily-lifted join point.</span><span>
</span><span id="line-720"></span><span class="hs-comment">-- See Note [Not-necessarily-lifted join points]</span><span>
</span><span id="line-721"></span><span class="annot"><a href="GHC.StgToByteCode.html#protectNNLJoinPointId"><span class="hs-identifier hs-type">protectNNLJoinPointId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-722"></span><span id="protectNNLJoinPointId"><span class="annot"><span class="annottext">protectNNLJoinPointId :: Id -&gt; Id
</span><a href="GHC.StgToByteCode.html#protectNNLJoinPointId"><span class="hs-identifier hs-var hs-var">protectNNLJoinPointId</span></a></span></span><span> </span><span id="local-6989586621681283553"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283553"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNNLJoinPoint</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>    </span><span class="annot"><span class="annottext">(Kind -&gt; Kind) -&gt; Id -&gt; Id
</span><a href="GHC.Types.Var.html#updateIdTypeButNotMult"><span class="hs-identifier hs-var">updateIdTypeButNotMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Builtin.Types.html#unboxedUnitTy"><span class="hs-identifier hs-var">unboxedUnitTy</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283553"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span class="hs-comment">{-
   Ticked Expressions
   ------------------

  The idea is that the &quot;breakpoint&lt;n,fvs&gt; E&quot; is really just an annotation on
  the code. When we find such a thing, we pull out the useful information,
  and then compile the code as if it was just the expression E.

Note [Not-necessarily-lifted join points]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A join point variable is essentially a goto-label: it is, for example,
never used as an argument to another function, and it is called only
in tail position. See Note [Join points] and Note [Invariants on join points],
both in GHC.Core. Because join points do not compile to true, red-blooded
variables (with, e.g., registers allocated to them), they are allowed
to be levity-polymorphic. (See invariant #6 in Note [Invariants on join points]
in GHC.Core.)

However, in this byte-code generator, join points *are* treated just as
ordinary variables. There is no check whether a binding is for a join point
or not; they are all treated uniformly. (Perhaps there is a missed optimization
opportunity here, but that is beyond the scope of my (Richard E's) Thursday.)

We thus must have *some* strategy for dealing with levity-polymorphic and
unlifted join points. Levity-polymorphic variables are generally not allowed
(though levity-polymorphic join points *are*; see Note [Invariants on join points]
in GHC.Core, point 6), and we don't wish to evaluate unlifted join points eagerly.
The questionable join points are *not-necessarily-lifted join points*
(NNLJPs). (Not having such a strategy led to #16509, which panicked in the
isUnliftedType check in the AnnVar case of schemeE.) Here is the strategy:

1. Detect NNLJPs. This is done in isNNLJoinPoint.

2. When binding an NNLJP, add a `\ (_ :: (# #)) -&gt;` to its RHS, and modify the
   type to tack on a `(# #) -&gt;`.
   Note that functions are never levity-polymorphic, so this transformation
   changes an NNLJP to a non-levity-polymorphic join point. This is done
   in bcPrepSingleBind.

3. At an occurrence of an NNLJP, add an application to void# (called voidPrimId),
   being careful to note the new type of the NNLJP. This is done in the AnnVar
   case of schemeE, with help from protectNNLJoinPointId.

Here is an example. Suppose we have

  f = \(r :: RuntimeRep) (a :: TYPE r) (x :: T).
      join j :: a
           j = error @r @a &quot;bloop&quot;
      in case x of
           A -&gt; j
           B -&gt; j
           C -&gt; error @r @a &quot;blurp&quot;

Our plan is to behave is if the code was

  f = \(r :: RuntimeRep) (a :: TYPE r) (x :: T).
      let j :: (Void# -&gt; a)
          j = \ _ -&gt; error @r @a &quot;bloop&quot;
      in case x of
           A -&gt; j void#
           B -&gt; j void#
           C -&gt; error @r @a &quot;blurp&quot;

It's a bit hacky, but it works well in practice and is local. I suspect the
Right Fix is to take advantage of join points as goto-labels.

-}</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span class="hs-comment">-- Compile code to do a tail call.  Specifically, push the fn,</span><span>
</span><span id="line-795"></span><span class="hs-comment">-- slide the on-stack app back down to the sequel depth,</span><span>
</span><span id="line-796"></span><span class="hs-comment">-- and enter.  Four cases:</span><span>
</span><span id="line-797"></span><span class="hs-comment">--</span><span>
</span><span id="line-798"></span><span class="hs-comment">-- 0.  (Nasty hack).</span><span>
</span><span id="line-799"></span><span class="hs-comment">--     An application &quot;GHC.Prim.tagToEnum# &lt;type&gt; unboxed-int&quot;.</span><span>
</span><span id="line-800"></span><span class="hs-comment">--     The int will be on the stack.  Generate a code sequence</span><span>
</span><span id="line-801"></span><span class="hs-comment">--     to convert it to the relevant constructor, SLIDE and ENTER.</span><span>
</span><span id="line-802"></span><span class="hs-comment">--</span><span>
</span><span id="line-803"></span><span class="hs-comment">-- 1.  The fn denotes a ccall.  Defer to generateCCall.</span><span>
</span><span id="line-804"></span><span class="hs-comment">--</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- 2.  An unboxed tuple: push the components on the top of</span><span>
</span><span id="line-806"></span><span class="hs-comment">--     the stack and return.</span><span>
</span><span id="line-807"></span><span class="hs-comment">--</span><span>
</span><span id="line-808"></span><span class="hs-comment">-- 3.  Application of a constructor, by defn saturated.</span><span>
</span><span id="line-809"></span><span class="hs-comment">--     Split the args into ptrs and non-ptrs, and push the nonptrs,</span><span>
</span><span id="line-810"></span><span class="hs-comment">--     then the ptrs, and then do PACK and RETURN.</span><span>
</span><span id="line-811"></span><span class="hs-comment">--</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- 4.  Otherwise, it must be a function call.  Push the args</span><span>
</span><span id="line-813"></span><span class="hs-comment">--     right to left, SLIDE and ENTER.</span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-type">schemeT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>   </span><span class="hs-comment">-- Stack depth</span><span>
</span><span id="line-816"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>       </span><span class="hs-comment">-- Sequel depth</span><span>
</span><span id="line-817"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>        </span><span class="hs-comment">-- stack env</span><span>
</span><span id="line-818"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span>
</span><span id="line-819"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>   </span><span class="hs-comment">-- Case 0</span><span>
</span><span id="line-822"></span><span id="schemeT"><span class="annot"><span class="annottext">schemeT :: ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var hs-var">schemeT</span></a></span></span><span> </span><span id="local-6989586621681283551"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283551"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283550"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283550"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283549"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283549"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283548"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283548"><span class="hs-identifier hs-var">app</span></a></span></span><span>
</span><span id="line-823"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283547"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283547"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283546"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681283546"><span class="hs-identifier hs-var">constr_names</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CgStgExpr -&gt; Maybe (Id, [Name])
</span><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-var">maybe_is_tagToEnum_call</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283548"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-824"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [Name]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#implement_tagToId"><span class="hs-identifier hs-var">implement_tagToId</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283551"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283550"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283549"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283547"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681283546"><span class="hs-identifier hs-var">constr_names</span></a></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>   </span><span class="hs-comment">-- Case 1</span><span>
</span><span id="line-827"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621681283543"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283543"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283542"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283542"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283541"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283541"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgFCallOp"><span class="hs-identifier hs-type">StgFCallOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-type">CCall</span></a></span><span> </span><span id="local-6989586621681283538"><span class="annot"><span class="annottext">CCallSpec
</span><a href="#local-6989586621681283538"><span class="hs-identifier hs-var">ccall_spec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283537"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283537"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283536"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283536"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681283535"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283535"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CCallSpec -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isSupportedCConv"><span class="hs-identifier hs-var">isSupportedCConv</span></a></span><span> </span><span class="annot"><span class="annottext">CCallSpec
</span><a href="#local-6989586621681283538"><span class="hs-identifier hs-var">ccall_spec</span></a></span><span>
</span><span id="line-829"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CCallSpec
-&gt; Kind
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#generateCCall"><span class="hs-identifier hs-var">generateCCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283543"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283542"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283541"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CCallSpec
</span><a href="#local-6989586621681283538"><span class="hs-identifier hs-var">ccall_spec</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283535"><span class="hs-identifier hs-var">result_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283536"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a
</span><a href="GHC.StgToByteCode.html#unsupportedCConvException"><span class="hs-identifier hs-var">unsupportedCConvException</span></a></span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621681283531"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283531"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283530"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283530"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283529"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283529"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPrimOp"><span class="hs-identifier hs-type">StgPrimOp</span></a></span><span> </span><span id="local-6989586621681283527"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621681283527"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283526"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283526"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681283525"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283525"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-var">doTailCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283531"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283530"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283529"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp -&gt; Id
</span><a href="GHC.Builtin.Utils.html#primOpId"><span class="hs-identifier hs-var">primOpId</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621681283527"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283526"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621681283523"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283523"><span class="hs-identifier hs-var">_d</span></a></span></span><span> </span><span id="local-6989586621681283522"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283522"><span class="hs-identifier hs-var">_s</span></a></span></span><span> </span><span id="local-6989586621681283521"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283521"><span class="hs-identifier hs-var">_p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPrimCallOp"><span class="hs-identifier hs-type">StgPrimCallOp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621681283519"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283519"><span class="hs-identifier hs-var">_args</span></a></span></span><span> </span><span id="local-6989586621681283518"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283518"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a
</span><a href="GHC.StgToByteCode.html#unsupportedCConvException"><span class="hs-identifier hs-var">unsupportedCConvException</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>   </span><span class="hs-comment">-- Case 2: Unboxed tuple</span><span>
</span><span id="line-839"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621681283517"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283517"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283516"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283516"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283515"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283515"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621681283514"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283514"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681283513"><span class="annot"><span class="annottext">XConApp 'CodeGen
</span><a href="#local-6989586621681283513"><span class="hs-identifier hs-var">_ext</span></a></span></span><span> </span><span id="local-6989586621681283512"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283512"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681283511"><span class="annot"><span class="annottext">[Kind]
</span><a href="#local-6989586621681283511"><span class="hs-identifier hs-var">_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283514"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283514"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-841"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; [StgArg] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#returnUnboxedTuple"><span class="hs-identifier hs-var">returnUnboxedTuple</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283517"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283516"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283515"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283512"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>   </span><span class="hs-comment">-- Case 3: Ordinary data constructor</span><span>
</span><span id="line-844"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-845"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681283507"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283507"><span class="hs-identifier hs-var">alloc_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; DataCon
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-var">mkConAppCode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283517"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283516"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283515"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283514"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283512"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-846"></span><span>        </span><span id="local-6989586621681283506"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283506"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-847"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283507"><span class="hs-identifier hs-var">alloc_con</span></a></span><span>         </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-848"></span><span>                </span><span class="annot"><span class="annottext">Word16 -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283506"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283517"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283516"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span>
</span><span id="line-849"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedTypeKind"><span class="hs-identifier hs-var">isUnliftedTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Kind
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var">tyConResKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283514"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_UNLIFTED"><span class="hs-identifier hs-var">RETURN_UNLIFTED</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span>
</span><span id="line-851"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#ENTER"><span class="hs-identifier hs-var">ENTER</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span>   </span><span class="hs-comment">-- Case 4: Tail call of function</span><span>
</span><span id="line-854"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span id="local-6989586621681283503"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283503"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283502"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283502"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283501"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283501"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621681283500"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283500"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621681283499"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283499"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-var">doTailCall</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283503"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283502"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283501"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283500"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283499"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span class="annot"><a href="GHC.StgToByteCode.html#schemeT"><span class="hs-identifier hs-var">schemeT</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681283498"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283498"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.schemeT&quot;</span></span><span>
</span><span id="line-858"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; GenStgExpr pass -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">StgPprOpts
</span><a href="GHC.Stg.Syntax.html#shortStgPprOpts"><span class="hs-identifier hs-var">shortStgPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283498"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-861"></span><span class="hs-comment">-- Generate code to build a constructor application,</span><span>
</span><span id="line-862"></span><span class="hs-comment">-- leaving it on top of the stack</span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-type">mkConAppCode</span></a></span><span>
</span><span id="line-865"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-866"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>                  </span><span class="hs-comment">-- The data constructor</span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Args, in *reverse* order</span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-871"></span><span id="mkConAppCode"><span class="annot"><span class="annottext">mkConAppCode :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; DataCon
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkConAppCode"><span class="hs-identifier hs-var hs-var">mkConAppCode</span></a></span></span><span> </span><span id="local-6989586621681283495"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283495"><span class="hs-identifier hs-var">orig_d</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681283494"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283494"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283493"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283493"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681283492"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283492"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283491"><span class="hs-identifier hs-var">app_code</span></a></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-873"></span><span>    </span><span id="local-6989586621681283491"><span class="annot"><span class="annottext">app_code :: BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283491"><span class="hs-identifier hs-var hs-var">app_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-874"></span><span>        </span><span id="local-6989586621681283490"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283490"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-875"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283489"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681283489"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283490"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span>            </span><span id="local-6989586621681283488"><span class="annot"><span class="annottext">non_voids :: [NonVoid (PrimRep, StgArg)]
</span><a href="#local-6989586621681283488"><span class="hs-identifier hs-var hs-var">non_voids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-878"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; NonVoid a
</span><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283486"><span class="hs-identifier hs-var">prim_rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283485"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681283485"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283485"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283492"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-880"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283486"><span class="annot"><span class="annottext">prim_rep :: PrimRep
</span><a href="#local-6989586621681283486"><span class="hs-identifier hs-var hs-var">prim_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-var">atomPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283485"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-881"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVoidRep"><span class="hs-identifier hs-var">isVoidRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283486"><span class="hs-identifier hs-var">prim_rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-883"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283483"><span class="annot"><span class="annottext">[FieldOffOrPadding StgArg]
</span><a href="#local-6989586621681283483"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-884"></span><span>                </span><span class="annot"><span class="annottext">forall a.
Profile
-&gt; ClosureHeader
-&gt; [NonVoid (PrimRep, a)]
-&gt; (Int, Int, [FieldOffOrPadding a])
</span><a href="GHC.StgToCmm.Layout.html#mkVirtHeapOffsetsWithPadding"><span class="hs-identifier hs-var">mkVirtHeapOffsetsWithPadding</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283490"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureHeader
</span><a href="GHC.StgToCmm.Layout.html#StdHeader"><span class="hs-identifier hs-var">StdHeader</span></a></span><span> </span><span class="annot"><span class="annottext">[NonVoid (PrimRep, StgArg)]
</span><a href="#local-6989586621681283488"><span class="hs-identifier hs-var">non_voids</span></a></span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span>            </span><span id="local-6989586621681283480"><span class="annot"><span class="annottext">do_pushery :: ByteOff -&gt; [FieldOffOrPadding StgArg] -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283480"><span class="hs-identifier hs-var hs-var">do_pushery</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283479"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283479"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283478"><span class="annot"><span class="annottext">FieldOffOrPadding StgArg
</span><a href="#local-6989586621681283478"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283477"><span class="annot"><span class="annottext">[FieldOffOrPadding StgArg]
</span><a href="#local-6989586621681283477"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-887"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681283476"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283476"><span class="hs-identifier hs-var">push</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283475"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283475"><span class="hs-identifier hs-var">arg_bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldOffOrPadding StgArg
</span><a href="#local-6989586621681283478"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-888"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Layout.html#Padding"><span class="hs-identifier hs-type">Padding</span></a></span><span> </span><span id="local-6989586621681283473"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283473"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-var">pushPadding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283473"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Layout.html#FieldOff"><span class="hs-identifier hs-type">FieldOff</span></a></span><span> </span><span id="local-6989586621681283469"><span class="annot"><span class="annottext">NonVoid StgArg
</span><a href="#local-6989586621681283469"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var">pushConstrAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283479"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283494"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NonVoid a -&gt; a
</span><a href="GHC.StgToCmm.Closure.html#fromNonVoid"><span class="hs-identifier hs-var">fromNonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">NonVoid StgArg
</span><a href="#local-6989586621681283469"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span>                </span><span id="local-6989586621681283467"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283467"><span class="hs-identifier hs-var">more_push_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [FieldOffOrPadding StgArg] -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283480"><span class="hs-identifier hs-var">do_pushery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283479"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283475"><span class="hs-identifier hs-var">arg_bytes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldOffOrPadding StgArg]
</span><a href="#local-6989586621681283477"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-891"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283476"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283467"><span class="hs-identifier hs-var">more_push_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-892"></span><span>            </span><span class="annot"><a href="#local-6989586621681283480"><span class="hs-identifier hs-var">do_pushery</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283466"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283466"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-893"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283465"><span class="annot"><span class="annottext">n_arg_words :: Word16
</span><a href="#local-6989586621681283465"><span class="hs-identifier hs-var hs-var">n_arg_words</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283489"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283466"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283495"><span class="hs-identifier hs-var">orig_d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-894"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PACK"><span class="hs-identifier hs-var">PACK</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283493"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283465"><span class="hs-identifier hs-var">n_arg_words</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>
</span><span id="line-896"></span><span>        </span><span class="hs-comment">-- Push on the stack in the reverse order.</span><span>
</span><span id="line-897"></span><span>        </span><span class="annot"><span class="annottext">ByteOff -&gt; [FieldOffOrPadding StgArg] -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283480"><span class="hs-identifier hs-var">do_pushery</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283495"><span class="hs-identifier hs-var">orig_d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldOffOrPadding StgArg]
</span><a href="#local-6989586621681283483"><span class="hs-identifier hs-var">args_offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>
</span><span id="line-899"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-900"></span><span class="hs-comment">-- Generate code for a tail-call</span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span class="annot"><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-type">doTailCall</span></a></span><span>
</span><span id="line-903"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-904"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-905"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-906"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-907"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-909"></span><span id="doTailCall"><span class="annot"><span class="annottext">doTailCall :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doTailCall"><span class="hs-identifier hs-var hs-var">doTailCall</span></a></span></span><span> </span><span id="local-6989586621681283464"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283464"><span class="hs-identifier hs-var">init_d</span></a></span></span><span> </span><span id="local-6989586621681283463"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283463"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283462"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283462"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283461"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283461"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621681283460"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283460"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>   </span><span id="local-6989586621681283459"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283459"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-911"></span><span>   </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; [ArgRep] -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283458"><span class="hs-identifier hs-var">do_pushes</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283464"><span class="hs-identifier hs-var">init_d</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283460"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; StgArg -&gt; ArgRep
</span><a href="GHC.StgToByteCode.html#atomRep"><span class="hs-identifier hs-var">atomRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283459"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283460"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-913"></span><span>  </span><span id="local-6989586621681283458"><span class="annot"><span class="annottext">do_pushes :: ByteOff -&gt; [StgArg] -&gt; [ArgRep] -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283458"><span class="hs-identifier hs-var hs-var">do_pushes</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283456"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283456"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681283455"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283455"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-914"></span><span>        </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">reps</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681283453"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283453"><span class="hs-identifier hs-var">push_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283452"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283452"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283456"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283462"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283461"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>        </span><span id="local-6989586621681283451"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283451"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-917"></span><span>        </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">sz</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">wordSize</span><span> </span><span class="hs-identifier">platform</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283450"><span class="annot"><span class="annottext">slide :: OrdList BCInstr
</span><a href="#local-6989586621681283450"><span class="hs-identifier hs-var hs-var">slide</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; ByteOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-var">mkSlideB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283451"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283456"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283464"><span class="hs-identifier hs-var">init_d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283451"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283464"><span class="hs-identifier hs-var">init_d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283463"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>            </span><span id="local-6989586621681283449"><span class="annot"><span class="annottext">enter :: BCInstr
</span><a href="#local-6989586621681283449"><span class="hs-identifier hs-var hs-var">enter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283461"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_UNLIFTED"><span class="hs-identifier hs-var">RETURN_UNLIFTED</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span>
</span><span id="line-921"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#ENTER"><span class="hs-identifier hs-var">ENTER</span></a></span><span>
</span><span id="line-922"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283453"><span class="hs-identifier hs-var">push_fn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283450"><span class="hs-identifier hs-var">slide</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283449"><span class="hs-identifier hs-var">enter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span>  </span><span class="annot"><a href="#local-6989586621681283458"><span class="hs-identifier hs-var">do_pushes</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681283448"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283448"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283447"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283447"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681283446"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283446"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-924"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283445"><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283445"><span class="hs-identifier hs-var">push_apply</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283444"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283444"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283443"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283443"><span class="hs-identifier hs-var">rest_of_reps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ArgRep] -&gt; (BCInstr, Int, [ArgRep])
</span><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283446"><span class="hs-identifier hs-var">reps</span></a></span><span>
</span><span id="line-925"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681283441"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283441"><span class="hs-identifier hs-var">these_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283440"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283440"><span class="hs-identifier hs-var">rest_of_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283444"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283447"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-926"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681283438"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283438"><span class="hs-identifier hs-var">next_d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283437"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283437"><span class="hs-identifier hs-var">push_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; BcM (ByteOff, OrdList BCInstr)
</span><a href="#local-6989586621681283436"><span class="hs-identifier hs-var">push_seq</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283448"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283441"><span class="hs-identifier hs-var">these_args</span></a></span><span>
</span><span id="line-927"></span><span>      </span><span id="local-6989586621681283435"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283435"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span id="local-6989586621681283434"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283434"><span class="hs-identifier hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; [ArgRep] -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681283458"><span class="hs-identifier hs-var">do_pushes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283438"><span class="hs-identifier hs-var">next_d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283435"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283440"><span class="hs-identifier hs-var">rest_of_args</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283443"><span class="hs-identifier hs-var">rest_of_reps</span></a></span><span>
</span><span id="line-929"></span><span>      </span><span class="hs-comment">--                          ^^^ for the PUSH_APPLY_ instruction</span><span>
</span><span id="line-930"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283437"><span class="hs-identifier hs-var">push_code</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283445"><span class="hs-identifier hs-var">push_apply</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283434"><span class="hs-identifier hs-var">instrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span>  </span><span id="local-6989586621681283436"><span class="annot"><span class="annottext">push_seq :: ByteOff -&gt; [StgArg] -&gt; BcM (ByteOff, OrdList BCInstr)
</span><a href="#local-6989586621681283436"><span class="hs-identifier hs-var hs-var">push_seq</span></a></span></span><span> </span><span id="local-6989586621681283433"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283433"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283433"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>  </span><span class="annot"><a href="#local-6989586621681283436"><span class="hs-identifier hs-var">push_seq</span></a></span><span> </span><span id="local-6989586621681283431"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283431"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283430"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283430"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681283429"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283429"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-934"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681283428"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283428"><span class="hs-identifier hs-var">push_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283427"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283427"><span class="hs-identifier hs-var">sz</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283431"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283462"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283430"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681283426"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283426"><span class="hs-identifier hs-var">final_d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283425"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283425"><span class="hs-identifier hs-var">more_push_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; BcM (ByteOff, OrdList BCInstr)
</span><a href="#local-6989586621681283436"><span class="hs-identifier hs-var">push_seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283431"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283427"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283429"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-936"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283426"><span class="hs-identifier hs-var">final_d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283428"><span class="hs-identifier hs-var">push_code</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283425"><span class="hs-identifier hs-var">more_push_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="hs-comment">-- v. similar to CgStackery.findMatch, ToDo: merge</span><span>
</span><span id="line-939"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-type">findPushSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-940"></span><span id="findPushSeq"><span class="annot"><span class="annottext">findPushSeq :: [ArgRep] -&gt; (BCInstr, Int, [ArgRep])
</span><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var hs-var">findPushSeq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283424"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283424"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPPPPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPPPPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283424"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283422"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283422"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPPPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPPPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283422"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283420"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283420"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283420"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283418"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283418"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PPP"><span class="hs-identifier hs-var">PUSH_APPLY_PPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283418"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283416"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283416"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_PP"><span class="hs-identifier hs-var">PUSH_APPLY_PP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283416"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283414"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283414"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_P"><span class="hs-identifier hs-var">PUSH_APPLY_P</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283414"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V"><span class="hs-identifier hs-var">V</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283412"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283412"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_V"><span class="hs-identifier hs-var">PUSH_APPLY_V</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283412"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#N"><span class="hs-identifier hs-var">N</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283409"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283409"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_N"><span class="hs-identifier hs-var">PUSH_APPLY_N</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283409"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#F"><span class="hs-identifier hs-var">F</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283406"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283406"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_F"><span class="hs-identifier hs-var">PUSH_APPLY_F</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283406"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#D"><span class="hs-identifier hs-var">D</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283403"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283403"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_D"><span class="hs-identifier hs-var">PUSH_APPLY_D</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283403"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#L"><span class="hs-identifier hs-var">L</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681283400"><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283400"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_APPLY_L"><span class="hs-identifier hs-var">PUSH_APPLY_L</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283400"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span class="annot"><a href="GHC.StgToByteCode.html#findPushSeq"><span class="hs-identifier hs-var">findPushSeq</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.findPushSeq&quot;</span></span><span>
</span><span id="line-964"></span><span>
</span><span id="line-965"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-966"></span><span class="hs-comment">-- Case expressions</span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span class="annot"><a href="GHC.StgToByteCode.html#doCase"><span class="hs-identifier hs-type">doCase</span></a></span><span>
</span><span id="line-969"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-970"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-972"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span>
</span><span id="line-973"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-974"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgAlt"><span class="hs-identifier hs-type">CgStgAlt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-976"></span><span id="doCase"><span class="annot"><span class="annottext">doCase :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CgStgExpr
-&gt; Id
-&gt; [CgStgAlt]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#doCase"><span class="hs-identifier hs-var hs-var">doCase</span></a></span></span><span> </span><span id="local-6989586621681283398"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283398"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283397"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283397"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283396"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283396"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283395"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283395"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621681283394"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283394"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681283393"><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621681283393"><span class="hs-identifier hs-var">alts</span></a></span></span><span>
</span><span id="line-977"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-978"></span><span>     </span><span id="local-6989586621681283392"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283392"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-979"></span><span>     </span><span id="local-6989586621681283391"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681283391"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM HscEnv
</span><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-980"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-981"></span><span>        </span><span id="local-6989586621681283390"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283392"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span>        </span><span class="hs-comment">-- Are we dealing with an unboxed tuple with a tuple return frame?</span><span>
</span><span id="line-984"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-comment">-- 'Simple' tuples with at most one non-void component,</span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-comment">-- like (# Word# #) or (# Int#, State# RealWorld# #) do not have a</span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-comment">-- tuple return frame. This is because (# foo #) and (# foo, Void# #)</span><span>
</span><span id="line-988"></span><span>        </span><span class="hs-comment">-- have the same runtime rep. We have more efficient specialized</span><span>
</span><span id="line-989"></span><span>        </span><span class="hs-comment">-- return frames for the situations with one non-void element.</span><span>
</span><span id="line-990"></span><span>
</span><span id="line-991"></span><span>        </span><span id="local-6989586621681283389"><span class="annot"><span class="annottext">ubx_tuple_frame :: Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var hs-var">ubx_tuple_frame</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-992"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-993"></span><span>          </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283385"><span class="hs-identifier hs-var">non_void_arg_reps</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span>        </span><span id="local-6989586621681283385"><span class="annot"><span class="annottext">non_void_arg_reps :: [ArgRep]
</span><a href="#local-6989586621681283385"><span class="hs-identifier hs-var hs-var">non_void_arg_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ArgRep] -&gt; [ArgRep]
</span><a href="GHC.StgToByteCode.html#non_void"><span class="hs-identifier hs-var">non_void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Kind -&gt; [ArgRep]
</span><a href="GHC.StgToByteCode.html#typeArgReps"><span class="hs-identifier hs-var">typeArgReps</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>        </span><span id="local-6989586621681283383"><span class="annot"><span class="annottext">profiling :: Bool
</span><a href="#local-6989586621681283383"><span class="hs-identifier hs-var hs-var">profiling</span></a></span></span><span>
</span><span id="line-998"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283382"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681283382"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Env.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681283391"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-999"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; Bool
</span><a href="GHC.Runtime.Interpreter.html#interpreterProfiled"><span class="hs-identifier hs-var">interpreterProfiled</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681283382"><span class="hs-identifier hs-var">interp</span></a></span><span>
</span><span id="line-1000"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>        </span><span class="hs-comment">-- Top of stack is the return itbl, as usual.</span><span>
</span><span id="line-1003"></span><span>        </span><span class="hs-comment">-- underneath it is the pointer to the alt_code BCO.</span><span>
</span><span id="line-1004"></span><span>        </span><span class="hs-comment">-- When an alt is entered, it assumes the returned value is</span><span>
</span><span id="line-1005"></span><span>        </span><span class="hs-comment">-- on top of the itbl.</span><span>
</span><span id="line-1006"></span><span>        </span><span class="annot"><a href="#local-6989586621681283381"><span class="hs-identifier hs-type">ret_frame_size_b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-1007"></span><span>        </span><span id="local-6989586621681283381"><span class="annot"><span class="annottext">ret_frame_size_b :: ByteOff
</span><a href="#local-6989586621681283381"><span class="hs-identifier hs-var hs-var">ret_frame_size_b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1008"></span><span>                             </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283383"><span class="hs-identifier hs-var">profiling</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">5</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1009"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1010"></span><span>
</span><span id="line-1011"></span><span>        </span><span class="hs-comment">-- The stack space used to save/restore the CCCS when profiling</span><span>
</span><span id="line-1012"></span><span>        </span><span id="local-6989586621681283380"><span class="annot"><span class="annottext">save_ccs_size_b :: ByteOff
</span><a href="#local-6989586621681283380"><span class="hs-identifier hs-var hs-var">save_ccs_size_b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283383"><span class="hs-identifier hs-var">profiling</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1013"></span><span>                          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1014"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span>        </span><span class="hs-comment">-- An unlifted value gets an extra info table pushed on top</span><span>
</span><span id="line-1017"></span><span>        </span><span class="hs-comment">-- when it is returned.</span><span>
</span><span id="line-1018"></span><span>        </span><span class="annot"><a href="#local-6989586621681283379"><span class="hs-identifier hs-type">unlifted_itbl_size_b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-1019"></span><span>        </span><span id="local-6989586621681283379"><span class="annot"><span class="annottext">unlifted_itbl_size_b :: ByteOff
</span><a href="#local-6989586621681283379"><span class="hs-identifier hs-var hs-var">unlifted_itbl_size_b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1020"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1021"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681283378"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283378"><span class="hs-identifier hs-var">bndr_size</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283377"><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283377"><span class="hs-identifier hs-var">tuple_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283376"><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621681283376"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1025"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283375"><span class="annot"><span class="annottext">bndr_ty :: PrimRep -&gt; CmmType
</span><a href="#local-6989586621681283375"><span class="hs-identifier hs-var hs-var">bndr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#primRepCmmType"><span class="hs-identifier hs-var">primRepCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1026"></span><span>                   </span><span id="local-6989586621681283374"><span class="annot"><span class="annottext">bndr_reps :: [PrimRep]
</span><a href="#local-6989586621681283374"><span class="hs-identifier hs-var hs-var">bndr_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVoidRep"><span class="hs-identifier hs-var">isVoidRep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [PrimRep]
</span><a href="GHC.StgToByteCode.html#bcIdPrimReps"><span class="hs-identifier hs-var">bcIdPrimReps</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283394"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1027"></span><span>                   </span><span class="hs-special">(</span><span id="local-6989586621681283373"><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283373"><span class="hs-identifier hs-var">tuple_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283372"><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621681283372"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1028"></span><span>                       </span><span class="annot"><span class="annottext">forall a.
Profile
-&gt; ByteOff -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (TupleInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutTuple"><span class="hs-identifier hs-var">layoutTuple</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283392"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; CmmType
</span><a href="#local-6989586621681283375"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283374"><span class="hs-identifier hs-var">bndr_reps</span></a></span><span>
</span><span id="line-1029"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TupleInfo -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#tupleSize"><span class="hs-identifier hs-var">tupleSize</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283373"><span class="hs-identifier hs-var">tuple_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283373"><span class="hs-identifier hs-var">tuple_info</span></a></span><span>
</span><span id="line-1031"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621681283372"><span class="hs-identifier hs-var">args_offsets</span></a></span><span>
</span><span id="line-1032"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-1033"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-var">idSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283394"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1034"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="GHC.ByteCode.Types.html#voidTupleInfo"><span class="hs-identifier hs-var">voidTupleInfo</span></a></span><span>
</span><span id="line-1035"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1036"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span>        </span><span class="hs-comment">-- depth of stack after the return value has been pushed</span><span>
</span><span id="line-1039"></span><span>        </span><span id="local-6989586621681283370"><span class="annot"><span class="annottext">d_bndr :: ByteOff
</span><a href="#local-6989586621681283370"><span class="hs-identifier hs-var hs-var">d_bndr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1040"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283398"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283381"><span class="hs-identifier hs-var">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283378"><span class="hs-identifier hs-var">bndr_size</span></a></span><span>
</span><span id="line-1041"></span><span>
</span><span id="line-1042"></span><span>        </span><span class="hs-comment">-- depth of stack after the extra info table for an unlifted return</span><span>
</span><span id="line-1043"></span><span>        </span><span class="hs-comment">-- has been pushed, if any.  This is the stack depth at the</span><span>
</span><span id="line-1044"></span><span>        </span><span class="hs-comment">-- continuation.</span><span>
</span><span id="line-1045"></span><span>        </span><span id="local-6989586621681283369"><span class="annot"><span class="annottext">d_alts :: ByteOff
</span><a href="#local-6989586621681283369"><span class="hs-identifier hs-var hs-var">d_alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283398"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283381"><span class="hs-identifier hs-var">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283378"><span class="hs-identifier hs-var">bndr_size</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283379"><span class="hs-identifier hs-var">unlifted_itbl_size_b</span></a></span><span>
</span><span id="line-1046"></span><span>
</span><span id="line-1047"></span><span>        </span><span class="hs-comment">-- Env in which to compile the alts, not including</span><span>
</span><span id="line-1048"></span><span>        </span><span class="hs-comment">-- any vars bound by the alts themselves</span><span>
</span><span id="line-1049"></span><span>        </span><span id="local-6989586621681283368"><span class="annot"><span class="annottext">p_alts :: Map Id ByteOff
</span><a href="#local-6989586621681283368"><span class="hs-identifier hs-var hs-var">p_alts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283394"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283370"><span class="hs-identifier hs-var">d_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283396"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span>        </span><span id="local-6989586621681283387"><span class="annot"><span class="annottext">bndr_ty :: Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var hs-var">bndr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283394"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-1052"></span><span>        </span><span id="local-6989586621681283367"><span class="annot"><span class="annottext">isAlgCase :: Bool
</span><a href="#local-6989586621681283367"><span class="hs-identifier hs-var hs-var">isAlgCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isAlgType"><span class="hs-identifier hs-var">isAlgType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span>        </span><span class="hs-comment">-- given an alt, return a discr and code for it.</span><span>
</span><span id="line-1055"></span><span>        </span><span id="local-6989586621681283365"><span class="annot"><span class="annottext">codeAlt :: (AltCon, [Id], CgStgExpr) -&gt; BcM (Discr, OrdList BCInstr)
</span><a href="#local-6989586621681283365"><span class="hs-identifier hs-var hs-var">codeAlt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283363"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283363"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681283362"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283362"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283369"><span class="hs-identifier hs-var">d_alts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283397"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283368"><span class="hs-identifier hs-var">p_alts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283363"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1057"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283362"><span class="hs-identifier hs-var">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1058"></span><span>
</span><span id="line-1059"></span><span>        </span><span class="annot"><a href="#local-6989586621681283365"><span class="hs-identifier hs-var">codeAlt</span></a></span><span> </span><span id="local-6989586621681283360"><span class="annot"><span class="annottext">alt :: (AltCon, [Id], CgStgExpr)
</span><a href="#local-6989586621681283360"><span class="hs-identifier hs-var">alt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283359"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283359"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283358"><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283358"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>           </span><span class="hs-comment">-- primitive or nullary constructor alt: no need to UNPACK</span><span>
</span><span id="line-1061"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283357"><span class="hs-identifier hs-var">real_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1062"></span><span>                </span><span id="local-6989586621681283356"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283356"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283369"><span class="hs-identifier hs-var">d_alts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283397"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283368"><span class="hs-identifier hs-var">p_alts</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283358"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1063"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {b} {c}. (AltCon, b, c) -&gt; Discr
</span><a href="#local-6989586621681283355"><span class="hs-identifier hs-var">my_discr</span></a></span><span> </span><span class="annot"><span class="annottext">(AltCon, [Id], CgStgExpr)
</span><a href="#local-6989586621681283360"><span class="hs-identifier hs-var">alt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283356"><span class="hs-identifier hs-var">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1064"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1065"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283354"><span class="annot"><span class="annottext">bndr_ty :: Id -&gt; CmmType
</span><a href="#local-6989586621681283354"><span class="hs-identifier hs-var hs-var">bndr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#primRepCmmType"><span class="hs-identifier hs-var">primRepCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-var">bcIdPrimRep</span></a></span><span>
</span><span id="line-1066"></span><span>                 </span><span id="local-6989586621681283352"><span class="annot"><span class="annottext">tuple_start :: ByteOff
</span><a href="#local-6989586621681283352"><span class="hs-identifier hs-var hs-var">tuple_start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283370"><span class="hs-identifier hs-var">d_bndr</span></a></span><span>
</span><span id="line-1067"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621681283351"><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283351"><span class="hs-identifier hs-var">tuple_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283350"><span class="annot"><span class="annottext">[(Id, ByteOff)]
</span><a href="#local-6989586621681283350"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1068"></span><span>                   </span><span class="annot"><span class="annottext">forall a.
Profile
-&gt; ByteOff -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (TupleInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutTuple"><span class="hs-identifier hs-var">layoutTuple</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283392"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1069"></span><span>                               </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1070"></span><span>                               </span><span class="annot"><span class="annottext">Id -&gt; CmmType
</span><a href="#local-6989586621681283354"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-1071"></span><span>                               </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283359"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span>                 </span><span id="local-6989586621681283349"><span class="annot"><span class="annottext">stack_bot :: ByteOff
</span><a href="#local-6989586621681283349"><span class="hs-identifier hs-var hs-var">stack_bot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283369"><span class="hs-identifier hs-var">d_alts</span></a></span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span>                 </span><span id="local-6989586621681283348"><span class="annot"><span class="annottext">p' :: Map Id ByteOff
</span><a href="#local-6989586621681283348"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key elt.
Ord key =&gt;
[(key, elt)] -&gt; Map key elt -&gt; Map key elt
</span><a href="GHC.Data.FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map.insertList</span></a></span><span>
</span><span id="line-1076"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283347"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283352"><span class="hs-identifier hs-var">tuple_start</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span>
</span><span id="line-1077"></span><span>                                </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TupleInfo -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#tupleSize"><span class="hs-identifier hs-var">tupleSize</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283351"><span class="hs-identifier hs-var">tuple_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span>
</span><span id="line-1078"></span><span>                                </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283346"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283347"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283347"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283346"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283346"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Id, ByteOff)]
</span><a href="#local-6989586621681283350"><span class="hs-identifier hs-var">args_offsets</span></a></span><span>
</span><span id="line-1080"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVoidRep"><span class="hs-identifier hs-var">isVoidRep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-var">bcIdPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283347"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1081"></span><span>                        </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283368"><span class="hs-identifier hs-var">p_alts</span></a></span><span>
</span><span id="line-1082"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1083"></span><span>               </span><span id="local-6989586621681283345"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283345"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283349"><span class="hs-identifier hs-var">stack_bot</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283397"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283348"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283358"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1084"></span><span>               </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283345"><span class="hs-identifier hs-var">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1085"></span><span>           </span><span class="hs-comment">-- algebraic alt with some binders</span><span>
</span><span id="line-1086"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1087"></span><span>             </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283344"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283344"><span class="hs-identifier hs-var">tot_wds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283343"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283343"><span class="hs-identifier hs-var">_ptrs_wds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283342"><span class="annot"><span class="annottext">[(NonVoid Id, Int)]
</span><a href="#local-6989586621681283342"><span class="hs-identifier hs-var">args_offsets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1088"></span><span>                     </span><span class="annot"><span class="annottext">forall a.
Profile
-&gt; ClosureHeader
-&gt; [NonVoid (PrimRep, a)]
-&gt; (Int, Int, [(NonVoid a, Int)])
</span><a href="GHC.StgToCmm.Layout.html#mkVirtHeapOffsets"><span class="hs-identifier hs-var">mkVirtHeapOffsets</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283392"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">ClosureHeader
</span><a href="GHC.StgToCmm.Layout.html#NoHeader"><span class="hs-identifier hs-var">NoHeader</span></a></span><span>
</span><span id="line-1089"></span><span>                         </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; NonVoid a
</span><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-var">bcIdPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283339"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283339"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1090"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span id="local-6989586621681283339"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283339"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [NonVoid Id]
</span><a href="GHC.StgToCmm.Closure.html#nonVoidIds"><span class="hs-identifier hs-var">nonVoidIds</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283357"><span class="hs-identifier hs-var">real_bndrs</span></a></span><span>
</span><span id="line-1091"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1092"></span><span>                 </span><span id="local-6989586621681283338"><span class="annot"><span class="annottext">size :: WordOff
</span><a href="#local-6989586621681283338"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283344"><span class="hs-identifier hs-var">tot_wds</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>                 </span><span id="local-6989586621681283336"><span class="annot"><span class="annottext">stack_bot :: ByteOff
</span><a href="#local-6989586621681283336"><span class="hs-identifier hs-var hs-var">stack_bot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283369"><span class="hs-identifier hs-var">d_alts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283338"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>                 </span><span class="hs-comment">-- convert offsets from Sp into offsets into the virtual stack</span><span>
</span><span id="line-1097"></span><span>                 </span><span id="local-6989586621681283335"><span class="annot"><span class="annottext">p' :: Map Id ByteOff
</span><a href="#local-6989586621681283335"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key elt.
Ord key =&gt;
[(key, elt)] -&gt; Map key elt -&gt; Map key elt
</span><a href="GHC.Data.FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map.insertList</span></a></span><span>
</span><span id="line-1098"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283334"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283336"><span class="hs-identifier hs-var">stack_bot</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283333"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span id="local-6989586621681283334"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283334"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283333"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283333"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(NonVoid Id, Int)]
</span><a href="#local-6989586621681283342"><span class="hs-identifier hs-var">args_offsets</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1100"></span><span>                        </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283368"><span class="hs-identifier hs-var">p_alts</span></a></span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span>                 </span><span class="hs-comment">-- unlifted datatypes have an infotable word on top</span><span>
</span><span id="line-1103"></span><span>                 </span><span id="local-6989586621681283332"><span class="annot"><span class="annottext">unpack :: OrdList BCInstr
</span><a href="#local-6989586621681283332"><span class="hs-identifier hs-var hs-var">unpack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-1104"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-var">PUSH_L</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span>
</span><span id="line-1105"></span><span>                               </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#UNPACK"><span class="hs-identifier hs-var">UNPACK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283338"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span>
</span><span id="line-1106"></span><span>                               </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SLIDE"><span class="hs-identifier hs-var">SLIDE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283338"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#UNPACK"><span class="hs-identifier hs-var">UNPACK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283338"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1108"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1109"></span><span>             </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span class="hs-identifier">isAlgCase</span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>             </span><span id="local-6989586621681283329"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283329"><span class="hs-identifier hs-var">rhs_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283336"><span class="hs-identifier hs-var">stack_bot</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283397"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283335"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283358"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1111"></span><span>             </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {b} {c}. (AltCon, b, c) -&gt; Discr
</span><a href="#local-6989586621681283355"><span class="hs-identifier hs-var">my_discr</span></a></span><span> </span><span class="annot"><span class="annottext">(AltCon, [Id], CgStgExpr)
</span><a href="#local-6989586621681283360"><span class="hs-identifier hs-var">alt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283332"><span class="hs-identifier hs-var">unpack</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283329"><span class="hs-identifier hs-var">rhs_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-1113"></span><span>             </span><span id="local-6989586621681283357"><span class="annot"><span class="annottext">real_bndrs :: [Id]
</span><a href="#local-6989586621681283357"><span class="hs-identifier hs-var hs-var">real_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681283359"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-1114"></span><span>
</span><span id="line-1115"></span><span>        </span><span id="local-6989586621681283355"><span class="annot"><span class="annottext">my_discr :: (AltCon, b, c) -&gt; Discr
</span><a href="#local-6989586621681283355"><span class="hs-identifier hs-var hs-var">my_discr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span> </span><span class="hs-comment">{-shouldn't really happen-}</span><span>
</span><span id="line-1116"></span><span>        </span><span class="annot"><a href="#local-6989586621681283355"><span class="hs-identifier hs-var">my_discr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621681283314"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283314"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283314"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283314"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1118"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>
</span><span id="line-1119"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1120"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Int
</span><a href="GHC.Core.DataCon.html#dataConTag"><span class="hs-identifier hs-var">dataConTag</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283314"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Types.Basic.html#fIRST_TAG"><span class="hs-identifier hs-var">fIRST_TAG</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>        </span><span class="annot"><a href="#local-6989586621681283355"><span class="hs-identifier hs-var">my_discr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span id="local-6989586621681283309"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283309"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283309"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a></span><span> </span><span id="local-6989586621681283306"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681283306"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; Integer -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#fromInteger"><span class="hs-identifier hs-var">fromInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681283306"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>                       </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a></span><span> </span><span id="local-6989586621681283303"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681283303"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; Integer -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#fromInteger"><span class="hs-identifier hs-var">fromInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681283303"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>                       </span><span class="annot"><a href="GHC.Types.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span id="local-6989586621681283300"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621681283300"><span class="hs-identifier hs-var">r</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromRational"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621681283300"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>                       </span><span class="annot"><a href="GHC.Types.Literal.html#LitDouble"><span class="hs-identifier hs-type">LitDouble</span></a></span><span> </span><span id="local-6989586621681283297"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621681283297"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; Rational -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromRational"><span class="hs-identifier hs-var">fromRational</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621681283297"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span>                       </span><span class="annot"><a href="GHC.Types.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span id="local-6989586621681283294"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681283294"><span class="hs-identifier hs-var">i</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#ord"><span class="hs-identifier hs-var">ord</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681283294"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1127"></span><span>                       </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE(StgCase).my_discr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283309"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>        </span><span id="local-6989586621681283292"><span class="annot"><span class="annottext">maybe_ncons :: Maybe Int
</span><a href="#local-6989586621681283292"><span class="hs-identifier hs-var hs-var">maybe_ncons</span></a></span></span><span>
</span><span id="line-1130"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283367"><span class="hs-identifier hs-var">isAlgCase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1131"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1132"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283291"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621681283291"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283291"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621681283393"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1133"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1134"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681283290"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283290"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[DataCon]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConFamilySize"><span class="hs-identifier hs-var">tyConFamilySize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681283290"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span>        </span><span class="hs-comment">-- the bitmap is relative to stack depth d, i.e. before the</span><span>
</span><span id="line-1137"></span><span>        </span><span class="hs-comment">-- BCO, info table and return value are pushed on.</span><span>
</span><span id="line-1138"></span><span>        </span><span class="hs-comment">-- This bit of code is v. similar to buildLivenessMask in CgBindery,</span><span>
</span><span id="line-1139"></span><span>        </span><span class="hs-comment">-- except that here we build the bitmap from the known bindings of</span><span>
</span><span id="line-1140"></span><span>        </span><span class="hs-comment">-- things that are pointers, whereas in CgBindery the code builds the</span><span>
</span><span id="line-1141"></span><span>        </span><span class="hs-comment">-- bitmap from the free slots and unboxed bindings.</span><span>
</span><span id="line-1142"></span><span>        </span><span class="hs-comment">-- (ToDo: merge?)</span><span>
</span><span id="line-1143"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1144"></span><span>        </span><span class="hs-comment">-- NOTE [7/12/2006] bug #1013, testcase ghci/should_run/ghci002.</span><span>
</span><span id="line-1145"></span><span>        </span><span class="hs-comment">-- The bitmap must cover the portion of the stack up to the sequel only.</span><span>
</span><span id="line-1146"></span><span>        </span><span class="hs-comment">-- Previously we were building a bitmap for the whole depth (d), but we</span><span>
</span><span id="line-1147"></span><span>        </span><span class="hs-comment">-- really want a bitmap up to depth (d-s).  This affects compilation of</span><span>
</span><span id="line-1148"></span><span>        </span><span class="hs-comment">-- case-of-case expressions, which is the only time we can be compiling a</span><span>
</span><span id="line-1149"></span><span>        </span><span class="hs-comment">-- case expression with s /= 0.</span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span>        </span><span class="hs-comment">-- unboxed tuples get two more words, the second is a pointer (tuple_bco)</span><span>
</span><span id="line-1152"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681283288"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681283288"><span class="hs-identifier hs-var">extra_pointers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283287"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283287"><span class="hs-identifier hs-var">extra_slots</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283383"><span class="hs-identifier hs-var">profiling</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- tuple_info, tuple_BCO, CCCS</span><span>
</span><span id="line-1154"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- tuple_info, tuple_BCO</span><span>
</span><span id="line-1155"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span>        </span><span id="local-6989586621681283286"><span class="annot"><span class="annottext">bitmap_size :: Word16
</span><a href="#local-6989586621681283286"><span class="hs-identifier hs-var hs-var">bitmap_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283287"><span class="hs-identifier hs-var">extra_slots</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span>
</span><span id="line-1158"></span><span>                                 </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283398"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283397"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span>        </span><span class="annot"><a href="#local-6989586621681283285"><span class="hs-identifier hs-type">bitmap_size'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1161"></span><span>        </span><span id="local-6989586621681283285"><span class="annot"><span class="annottext">bitmap_size' :: Int
</span><a href="#local-6989586621681283285"><span class="hs-identifier hs-var hs-var">bitmap_size'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283286"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span>
</span><span id="line-1162"></span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span>        </span><span id="local-6989586621681283284"><span class="annot"><span class="annottext">pointers :: [Int]
</span><a href="#local-6989586621681283284"><span class="hs-identifier hs-var hs-var">pointers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1165"></span><span>          </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681283288"><span class="hs-identifier hs-var">extra_pointers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1166"></span><span>          </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283285"><span class="hs-identifier hs-var">bitmap_size'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283287"><span class="hs-identifier hs-var">extra_slots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681283283"><span class="hs-identifier hs-var">rel_slots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1167"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1168"></span><span>          </span><span class="hs-comment">-- NB: unboxed tuple cases bind the scrut binder to the same offset</span><span>
</span><span id="line-1169"></span><span>          </span><span class="hs-comment">-- as one of the alt binders, so we have to remove any duplicates here:</span><span>
</span><span id="line-1170"></span><span>          </span><span class="hs-comment">-- 'toAscList' takes care of sorting the result, which was previously done after the application of 'filter'.</span><span>
</span><span id="line-1171"></span><span>          </span><span id="local-6989586621681283283"><span class="annot"><span class="annottext">rel_slots :: [Int]
</span><a href="#local-6989586621681283283"><span class="hs-identifier hs-var hs-var">rel_slots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; [Int]
</span><a href="../../containers-0.6.5.1/src/Data-IntSet-Internal.html#toAscList"><span class="hs-identifier hs-var">IntSet.toAscList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; IntSet
</span><a href="../../containers-0.6.5.1/src/Data-IntSet-Internal.html#fromList"><span class="hs-identifier hs-var">IntSet.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a b. (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#mapMaybeWithKey"><span class="hs-identifier hs-var">Map.mapMaybeWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; ByteOff -&gt; Maybe Int
</span><a href="#local-6989586621681283278"><span class="hs-identifier hs-var">spread</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283396"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1172"></span><span>          </span><span id="local-6989586621681283278"><span class="annot"><span class="annottext">spread :: Id -&gt; ByteOff -&gt; Maybe Int
</span><a href="#local-6989586621681283278"><span class="hs-identifier hs-var hs-var">spread</span></a></span></span><span> </span><span id="local-6989586621681283277"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283277"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681283276"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283276"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283277"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-1173"></span><span>                             </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283277"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1174"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ArgRep
</span><a href="GHC.StgToByteCode.html#bcIdArgRep"><span class="hs-identifier hs-var">bcIdArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283277"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283275"><span class="hs-identifier hs-var">rel_offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1176"></span><span>                </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681283275"><span class="annot"><span class="annottext">rel_offset :: Word16
</span><a href="#local-6989586621681283275"><span class="hs-identifier hs-var hs-var">rel_offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283398"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283276"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span>        </span><span id="local-6989586621681283274"><span class="annot"><span class="annottext">bitmap :: [StgWord]
</span><a href="#local-6989586621681283274"><span class="hs-identifier hs-var hs-var">bitmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; [Int] -&gt; [StgWord]
</span><a href="GHC.Data.Bitmap.html#intsToReverseBitmap"><span class="hs-identifier hs-var">intsToReverseBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283285"><span class="hs-identifier hs-var">bitmap_size'</span></a></span><span class="hs-comment">{-size-}</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621681283284"><span class="hs-identifier hs-var">pointers</span></a></span><span>
</span><span id="line-1179"></span><span>
</span><span id="line-1180"></span><span>     </span><span id="local-6989586621681283272"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681283272"><span class="hs-identifier hs-var">alt_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(AltCon, [Id], CgStgExpr) -&gt; BcM (Discr, OrdList BCInstr)
</span><a href="#local-6989586621681283365"><span class="hs-identifier hs-var">codeAlt</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621681283393"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-1181"></span><span>     </span><span id="local-6989586621681283271"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283271"><span class="hs-identifier hs-var">alt_final</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; [(Discr, OrdList BCInstr)] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkMultiBranch"><span class="hs-identifier hs-var">mkMultiBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621681283292"><span class="hs-identifier hs-var">maybe_ncons</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681283272"><span class="hs-identifier hs-var">alt_stuff</span></a></span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1184"></span><span>         </span><span id="local-6989586621681283269"><span class="annot"><span class="annottext">alt_bco_name :: Name
</span><a href="#local-6989586621681283269"><span class="hs-identifier hs-var hs-var">alt_bco_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283394"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-1185"></span><span>         </span><span id="local-6989586621681283268"><span class="annot"><span class="annottext">alt_bco :: [FFIInfo] -&gt; ProtoBCO Name
</span><a href="#local-6989586621681283268"><span class="hs-identifier hs-var hs-var">alt_bco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; Word16
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var">mkProtoBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681283269"><span class="hs-identifier hs-var">alt_bco_name</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283271"><span class="hs-identifier hs-var">alt_final</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgAlt]
</span><a href="#local-6989586621681283393"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span>                       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-comment">{-no arity-}</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283286"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621681283274"><span class="hs-identifier hs-var">bitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-comment">{-is alts-}</span><span>
</span><span id="line-1187"></span><span>     </span><span id="local-6989586621681283267"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283267"><span class="hs-identifier hs-var">scrut_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; ByteOff -&gt; Map Id ByteOff -&gt; CgStgExpr -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#schemeE"><span class="hs-identifier hs-var">schemeE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283398"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283381"><span class="hs-identifier hs-var">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283380"><span class="hs-identifier hs-var">save_ccs_size_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1188"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283398"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283381"><span class="hs-identifier hs-var">ret_frame_size_b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283380"><span class="hs-identifier hs-var">save_ccs_size_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1189"></span><span>                           </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283396"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><a href="#local-6989586621681283395"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-1190"></span><span>     </span><span id="local-6989586621681283266"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283266"><span class="hs-identifier hs-var">alt_bco'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var">emitBc</span></a></span><span> </span><span class="annot"><span class="annottext">[FFIInfo] -&gt; ProtoBCO Name
</span><a href="#local-6989586621681283268"><span class="hs-identifier hs-var">alt_bco</span></a></span><span>
</span><span id="line-1191"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283389"><span class="hs-identifier hs-var">ubx_tuple_frame</span></a></span><span>
</span><span id="line-1192"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1193"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283265"><span class="annot"><span class="annottext">args_ptrs :: [(Bool, ByteOff)]
</span><a href="#local-6989586621681283265"><span class="hs-identifier hs-var hs-var">args_ptrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1194"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681283264"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283264"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283263"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283263"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283264"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283263"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>                        </span><span class="annot"><span class="annottext">[(PrimRep, ByteOff)]
</span><a href="#local-6989586621681283376"><span class="hs-identifier hs-var">args_offsets</span></a></span><span>
</span><span id="line-1196"></span><span>              </span><span id="local-6989586621681283262"><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283262"><span class="hs-identifier hs-var">tuple_bco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var">emitBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform
-&gt; TupleInfo -&gt; [(Bool, ByteOff)] -&gt; [FFIInfo] -&gt; ProtoBCO Name
</span><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-var">tupleBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283390"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283377"><span class="hs-identifier hs-var">tuple_info</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, ByteOff)]
</span><a href="#local-6989586621681283265"><span class="hs-identifier hs-var">args_ptrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtoBCO Name -&gt; TupleInfo -&gt; ProtoBCO Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_ALTS_TUPLE"><span class="hs-identifier hs-var">PUSH_ALTS_TUPLE</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283266"><span class="hs-identifier hs-var">alt_bco'</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283377"><span class="hs-identifier hs-var">tuple_info</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283262"><span class="hs-identifier hs-var">tuple_bco</span></a></span><span>
</span><span id="line-1198"></span><span>                      </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283267"><span class="hs-identifier hs-var">scrut_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1199"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283260"><span class="annot"><span class="annottext">push_alts :: BCInstr
</span><a href="#local-6989586621681283260"><span class="hs-identifier hs-var hs-var">push_alts</span></a></span></span><span>
</span><span id="line-1200"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283387"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_ALTS"><span class="hs-identifier hs-var">PUSH_ALTS</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283266"><span class="hs-identifier hs-var">alt_bco'</span></a></span><span>
</span><span id="line-1202"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1203"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283258"><span class="annot"><span class="annottext">unlifted_rep :: ArgRep
</span><a href="#local-6989586621681283258"><span class="hs-identifier hs-var hs-var">unlifted_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1204"></span><span>                          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ArgRep]
</span><a href="#local-6989586621681283385"><span class="hs-identifier hs-var">non_void_arg_reps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1205"></span><span>                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#V"><span class="hs-identifier hs-var">V</span></a></span><span>
</span><span id="line-1206"></span><span>                            </span><span class="hs-special">[</span><span id="local-6989586621681283257"><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621681283257"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621681283257"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1207"></span><span>                            </span><span class="annot"><span class="annottext">[ArgRep]
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;schemeE(StgCase).push_alts&quot;</span></span><span>
</span><span id="line-1208"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name -&gt; ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_ALTS_UNLIFTED"><span class="hs-identifier hs-var">PUSH_ALTS_UNLIFTED</span></a></span><span> </span><span class="annot"><span class="annottext">ProtoBCO Name
</span><a href="#local-6989586621681283266"><span class="hs-identifier hs-var">alt_bco'</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="#local-6989586621681283258"><span class="hs-identifier hs-var">unlifted_rep</span></a></span><span>
</span><span id="line-1209"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681283260"><span class="hs-identifier hs-var">push_alts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283267"><span class="hs-identifier hs-var">scrut_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span>
</span><span id="line-1212"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1213"></span><span class="hs-comment">-- Deal with tuples</span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span class="hs-comment">-- The native calling convention uses registers for tuples, but in the</span><span>
</span><span id="line-1216"></span><span class="hs-comment">-- bytecode interpreter, all values live on the stack.</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span id="local-6989586621681284949"><span class="annot"><a href="GHC.StgToByteCode.html#layoutTuple"><span class="hs-identifier hs-type">layoutTuple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-1219"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-1220"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681284949"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681284949"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1222"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#TupleInfo"><span class="hs-identifier hs-type">TupleInfo</span></a></span><span>      </span><span class="hs-comment">-- See Note [GHCi TupleInfo]</span><span>
</span><span id="line-1223"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681284949"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- argument, offset on stack</span><span>
</span><span id="line-1224"></span><span>               </span><span class="hs-special">)</span></span><span>
</span><span id="line-1225"></span><span id="layoutTuple"><span class="annot"><span class="annottext">layoutTuple :: forall a.
Profile
-&gt; ByteOff -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (TupleInfo, [(a, ByteOff)])
</span><a href="GHC.StgToByteCode.html#layoutTuple"><span class="hs-identifier hs-var hs-var">layoutTuple</span></a></span></span><span> </span><span id="local-6989586621681283241"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283241"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span id="local-6989586621681283240"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283240"><span class="hs-identifier hs-var">start_off</span></a></span></span><span> </span><span id="local-6989586621681283239"><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621681283239"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span id="local-6989586621681283238"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681283238"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1226"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283237"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681283237"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283241"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1227"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681283236"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283236"><span class="hs-identifier hs-var">orig_stk_bytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283235"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621681283235"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
Profile
-&gt; Int
-&gt; Convention
-&gt; (a -&gt; CmmType)
-&gt; [a]
-&gt; (Int, [(a, ParamLocation)])
</span><a href="GHC.Cmm.CallConv.html#assignArgumentsPos"><span class="hs-identifier hs-var">assignArgumentsPos</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283241"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1228"></span><span>                                                 </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1229"></span><span>                                                 </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#NativeReturn"><span class="hs-identifier hs-var">NativeReturn</span></a></span><span>
</span><span id="line-1230"></span><span>                                                 </span><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621681283239"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1231"></span><span>                                                 </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681283238"><span class="hs-identifier hs-var">reps</span></a></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>      </span><span class="hs-comment">-- keep the stack parameters in the same place</span><span>
</span><span id="line-1234"></span><span>      </span><span id="local-6989586621681283232"><span class="annot"><span class="annottext">orig_stk_params :: [(a, ByteOff)]
</span><a href="#local-6989586621681283232"><span class="hs-identifier hs-var hs-var">orig_stk_params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283231"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283230"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283231"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283231"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#StackParam"><span class="hs-identifier hs-type">StackParam</span></a></span><span> </span><span id="local-6989586621681283230"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283230"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621681283235"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span>      </span><span class="hs-comment">-- sort the register parameters by register and add them to the stack</span><span>
</span><span id="line-1237"></span><span>      </span><span class="annot"><a href="#local-6989586621681283228"><span class="hs-identifier hs-type">regs_order</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1238"></span><span>      </span><span id="local-6989586621681283228"><span class="annot"><span class="annottext">regs_order :: Map GlobalReg Int
</span><a href="#local-6989586621681283228"><span class="hs-identifier hs-var hs-var">regs_order</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [GlobalReg]
</span><a href="GHC.Cmm.CallConv.html#tupleRegsCover"><span class="hs-identifier hs-var">tupleRegsCover</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283237"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>      </span><span class="annot"><a href="#local-6989586621681283226"><span class="hs-identifier hs-type">reg_order</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>      </span><span id="local-6989586621681283226"><span class="annot"><span class="annottext">reg_order :: GlobalReg -&gt; (Int, GlobalReg)
</span><a href="#local-6989586621681283226"><span class="hs-identifier hs-var hs-var">reg_order</span></a></span></span><span> </span><span id="local-6989586621681283225"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621681283225"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283224"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283224"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621681283225"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Map GlobalReg Int
</span><a href="#local-6989586621681283228"><span class="hs-identifier hs-var">regs_order</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283224"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621681283225"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>      </span><span class="hs-comment">-- a VanillaReg goes to the same place regardless of whether it</span><span>
</span><span id="line-1243"></span><span>      </span><span class="hs-comment">-- contains a pointer</span><span>
</span><span id="line-1244"></span><span>      </span><span class="annot"><a href="#local-6989586621681283226"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#VanillaReg"><span class="hs-identifier hs-type">VanillaReg</span></a></span><span> </span><span id="local-6989586621681283221"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283221"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">VGcPtr
</span><a href="GHC.Cmm.Expr.html#VNonGcPtr"><span class="hs-identifier hs-var">VNonGcPtr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; (Int, GlobalReg)
</span><a href="#local-6989586621681283226"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; VGcPtr -&gt; GlobalReg
</span><a href="GHC.Cmm.Expr.html#VanillaReg"><span class="hs-identifier hs-var">VanillaReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283221"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">VGcPtr
</span><a href="GHC.Cmm.Expr.html#VGcPtr"><span class="hs-identifier hs-var">VGcPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>      </span><span class="hs-comment">-- if we don't have a position for a FloatReg then they must be passed</span><span>
</span><span id="line-1246"></span><span>      </span><span class="hs-comment">-- in the equivalent DoubleReg</span><span>
</span><span id="line-1247"></span><span>      </span><span class="annot"><a href="#local-6989586621681283226"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Expr.html#FloatReg"><span class="hs-identifier hs-type">FloatReg</span></a></span><span> </span><span id="local-6989586621681283217"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283217"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalReg -&gt; (Int, GlobalReg)
</span><a href="#local-6989586621681283226"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; GlobalReg
</span><a href="GHC.Cmm.Expr.html#DoubleReg"><span class="hs-identifier hs-var">DoubleReg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283217"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1248"></span><span>      </span><span class="hs-comment">-- one-tuples can be passed in other registers, but then we don't need</span><span>
</span><span id="line-1249"></span><span>      </span><span class="hs-comment">-- to care about the order</span><span>
</span><span id="line-1250"></span><span>      </span><span class="annot"><a href="#local-6989586621681283226"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span id="local-6989586621681283215"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621681283215"><span class="hs-identifier hs-var">reg</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621681283215"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>
</span><span id="line-1252"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681283214"><span class="annot"><span class="annottext">[(Int, GlobalReg)]
</span><a href="#local-6989586621681283214"><span class="hs-identifier hs-var">regs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283213"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681283213"><span class="hs-identifier hs-var">reg_params</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1253"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><a href="../../base-4.16.3.0/src/Data-Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>                           </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; (Int, GlobalReg)
</span><a href="#local-6989586621681283226"><span class="hs-identifier hs-var">reg_order</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621681283211"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283210"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283210"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283210"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#RegisterParam"><span class="hs-identifier hs-type">RegisterParam</span></a></span><span> </span><span id="local-6989586621681283211"><span class="annot"><span class="annottext">GlobalReg
</span><a href="#local-6989586621681283211"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621681283235"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1255"></span><span>
</span><span id="line-1256"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681283208"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283208"><span class="hs-identifier hs-var">new_stk_bytes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283207"><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621681283207"><span class="hs-identifier hs-var">new_stk_params</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
Platform
-&gt; Int -&gt; (a -&gt; CmmType) -&gt; [a] -&gt; (Int, [(a, ParamLocation)])
</span><a href="GHC.Cmm.CallConv.html#assignStack"><span class="hs-identifier hs-var">assignStack</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283237"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1257"></span><span>                                                    </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283236"><span class="hs-identifier hs-var">orig_stk_bytes</span></a></span><span>
</span><span id="line-1258"></span><span>                                                    </span><span class="annot"><span class="annottext">a -&gt; CmmType
</span><a href="#local-6989586621681283239"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1259"></span><span>                                                    </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681283213"><span class="hs-identifier hs-var">reg_params</span></a></span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span>      </span><span id="local-6989586621681283205"><span class="annot"><span class="annottext">regs_set :: RegSet GlobalReg
</span><a href="#local-6989586621681283205"><span class="hs-identifier hs-var hs-var">regs_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. Ord r =&gt; [r] -&gt; RegSet r
</span><a href="GHC.Cmm.Expr.html#mkRegSet"><span class="hs-identifier hs-var">mkRegSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, GlobalReg)]
</span><a href="#local-6989586621681283214"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1262"></span><span>
</span><span id="line-1263"></span><span>      </span><span id="local-6989586621681283200"><span class="annot"><span class="annottext">get_byte_off :: (a, ParamLocation) -&gt; (a, b)
</span><a href="#local-6989586621681283200"><span class="hs-identifier hs-var hs-var">get_byte_off</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283199"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283199"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.CallConv.html#StackParam"><span class="hs-identifier hs-type">StackParam</span></a></span><span> </span><span id="local-6989586621681283198"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283198"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283199"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283198"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span>      </span><span class="annot"><a href="#local-6989586621681283200"><span class="hs-identifier hs-var">get_byte_off</span></a></span><span> </span><span class="annot"><span class="annottext">(a, ParamLocation)
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span>
</span><span id="line-1265"></span><span>          </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.layoutTuple get_byte_off&quot;</span></span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#TupleInfo"><span class="hs-identifier hs-type">TupleInfo</span></a></span><span>
</span><span id="line-1268"></span><span>         </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tupleSize :: WordOff
</span><a href="GHC.ByteCode.Types.html#tupleSize"><span class="hs-identifier hs-var">tupleSize</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283237"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283208"><span class="hs-identifier hs-var">new_stk_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tupleRegs :: RegSet GlobalReg
</span><a href="GHC.ByteCode.Types.html#tupleRegs"><span class="hs-identifier hs-var">tupleRegs</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RegSet GlobalReg
</span><a href="#local-6989586621681283205"><span class="hs-identifier hs-var">regs_set</span></a></span><span>
</span><span id="line-1270"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tupleNativeStackSize :: WordOff
</span><a href="GHC.ByteCode.Types.html#tupleNativeStackSize"><span class="hs-identifier hs-var">tupleNativeStackSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283237"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1271"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283236"><span class="hs-identifier hs-var">orig_stk_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span>         </span><span class="hs-special">}</span><span>
</span><span id="line-1273"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><a href="../../base-4.16.3.0/src/Data-Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1274"></span><span>              </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681283194"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283194"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283193"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283193"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681283194"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283193"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283240"><span class="hs-identifier hs-var">start_off</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, ByteOff)]
</span><a href="#local-6989586621681283232"><span class="hs-identifier hs-var">orig_stk_params</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b} {a}. Num b =&gt; (a, ParamLocation) -&gt; (a, b)
</span><a href="#local-6989586621681283200"><span class="hs-identifier hs-var">get_byte_off</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, ParamLocation)]
</span><a href="#local-6989586621681283207"><span class="hs-identifier hs-var">new_stk_params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1276"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span class="hs-comment">{- Note [unboxed tuple bytecodes and tuple_BCO]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  We have the bytecode instructions RETURN_TUPLE and PUSH_ALTS_TUPLE to
  return and receive arbitrary unboxed tuples, respectively. These
  instructions use the helper data tuple_BCO and tuple_info.

  The helper data is used to convert tuples between GHCs native calling
  convention (object code), which uses stack and registers, and the bytecode
  calling convention, which only uses the stack. See Note [GHCi TupleInfo]
  for more details.


  Returning a tuple
  =================

  Bytecode that returns a tuple first pushes all the tuple fields followed
  by the appropriate tuple_info and tuple_BCO onto the stack. It then
  executes the RETURN_TUPLE instruction, which causes the interpreter
  to push stg_ret_t_info to the top of the stack. The stack (growing down)
  then looks as follows:

      ...
      next_frame
      tuple_field_1
      tuple_field_2
      ...
      tuple_field_n
      tuple_info
      tuple_BCO
      stg_ret_t_info &lt;- Sp

  If next_frame is bytecode, the interpreter will start executing it. If
  it's object code, the interpreter jumps back to the scheduler, which in
  turn jumps to stg_ret_t. stg_ret_t converts the tuple to the native
  calling convention using the description in tuple_info, and then jumps
  to next_frame.


  Receiving a tuple
  =================

  Bytecode that receives a tuple uses the PUSH_ALTS_TUPLE instruction to
  push a continuation, followed by jumping to the code that produces the
  tuple. The PUSH_ALTS_TUPLE instuction contains three pieces of data:

     * cont_BCO: the continuation that receives the tuple
     * tuple_info: see below
     * tuple_BCO: see below

  The interpreter pushes these onto the stack when the PUSH_ALTS_TUPLE
  instruction is executed, followed by stg_ctoi_tN_info, with N depending
  on the number of stack words used by the tuple in the GHC native calling
  convention. N is derived from tuple_info.

  For example if we expect a tuple with three words on the stack, the stack
  looks as follows after PUSH_ALTS_TUPLE:

      ...
      next_frame
      cont_free_var_1
      cont_free_var_2
      ...
      cont_free_var_n
      tuple_info
      tuple_BCO
      cont_BCO
      stg_ctoi_t3_info &lt;- Sp

  If the tuple is returned by object code, stg_ctoi_t3 will deal with
  adjusting the stack pointer and converting the tuple to the bytecode
  calling convention. See Note [GHCi unboxed tuples stack spills] for more
  details.


  The tuple_BCO
  =============

  The tuple_BCO is a helper bytecode object. Its main purpose is describing
  the contents of the stack frame containing the tuple for the storage
  manager. It contains only instructions to immediately return the tuple
  that is already on the stack.


  The tuple_info word
  ===================

  The tuple_info word describes the stack and STG register (e.g. R1..R6,
  D1..D6) usage for the tuple. tuple_info contains enough information to
  convert the tuple between the stack-only bytecode and stack+registers
  GHC native calling conventions.

  See Note [GHCi tuple layout] for more details of how the data is packed
  in a single word.

 -}</span><span>
</span><span id="line-1374"></span><span>
</span><span id="line-1375"></span><span class="annot"><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-type">tupleBCO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#TupleInfo"><span class="hs-identifier hs-type">TupleInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1376"></span><span id="tupleBCO"><span class="annot"><span class="annottext">tupleBCO :: Platform
-&gt; TupleInfo -&gt; [(Bool, ByteOff)] -&gt; [FFIInfo] -&gt; ProtoBCO Name
</span><a href="GHC.StgToByteCode.html#tupleBCO"><span class="hs-identifier hs-var hs-var">tupleBCO</span></a></span></span><span> </span><span id="local-6989586621681283192"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283192"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681283191"><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283191"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621681283190"><span class="annot"><span class="annottext">[(Bool, ByteOff)]
</span><a href="#local-6989586621681283190"><span class="hs-identifier hs-var">pointers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1377"></span><span>  </span><span class="annot"><span class="annottext">forall name.
Platform
-&gt; name
-&gt; OrdList BCInstr
-&gt; Either [CgStgAlt] CgStgRhs
-&gt; Int
-&gt; Word16
-&gt; [StgWord]
-&gt; Bool
-&gt; [FFIInfo]
-&gt; ProtoBCO name
</span><a href="GHC.StgToByteCode.html#mkProtoBCO"><span class="hs-identifier hs-var">mkProtoBCO</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283192"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681283189"><span class="hs-identifier hs-var">invented_name</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283188"><span class="hs-identifier hs-var">body_code</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1378"></span><span>             </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-comment">{-no arity-}</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283187"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span> </span><span class="annot"><span class="annottext">[StgWord]
</span><a href="#local-6989586621681283186"><span class="hs-identifier hs-var">bitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-comment">{-is alts-}</span><span>
</span><span id="line-1379"></span><span>
</span><span id="line-1380"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1381"></span><span>    </span><span class="hs-comment">{-
      The tuple BCO is never referred to by name, so we can get away
      with using a fake name here. We will need to change this if we want
      to save some memory by sharing the BCO between places that have
      the same tuple shape
    -}</span><span>
</span><span id="line-1387"></span><span>    </span><span id="local-6989586621681283189"><span class="annot"><span class="annottext">invented_name :: Name
</span><a href="#local-6989586621681283189"><span class="hs-identifier hs-var hs-var">invented_name</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; FastString -&gt; Name
</span><a href="GHC.Types.Name.html#mkSystemVarName"><span class="hs-identifier hs-var">mkSystemVarName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Unique
</span><a href="GHC.Builtin.Uniques.html#mkPseudoUniqueE"><span class="hs-identifier hs-var">mkPseudoUniqueE</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tuple&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>
</span><span id="line-1389"></span><span>    </span><span class="hs-comment">-- the first word in the frame is the tuple_info word,</span><span>
</span><span id="line-1390"></span><span>    </span><span class="hs-comment">-- which is not a pointer</span><span>
</span><span id="line-1391"></span><span>    </span><span id="local-6989586621681283187"><span class="annot"><span class="annottext">bitmap_size :: Word16
</span><a href="#local-6989586621681283187"><span class="hs-identifier hs-var hs-var">bitmap_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#tupleSize"><span class="hs-identifier hs-var">tupleSize</span></a></span><span> </span><span class="annot"><span class="annottext">TupleInfo
</span><a href="#local-6989586621681283191"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1392"></span><span>    </span><span id="local-6989586621681283186"><span class="annot"><span class="annottext">bitmap :: [StgWord]
</span><a href="#local-6989586621681283186"><span class="hs-identifier hs-var hs-var">bitmap</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; [Int] -&gt; [StgWord]
</span><a href="GHC.Data.Bitmap.html#intsToReverseBitmap"><span class="hs-identifier hs-var">intsToReverseBitmap</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283192"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283187"><span class="hs-identifier hs-var">bitmap_size</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1393"></span><span>                  </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283192"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, ByteOff)]
</span><a href="#local-6989586621681283190"><span class="hs-identifier hs-var">pointers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1395"></span><span>    </span><span id="local-6989586621681283188"><span class="annot"><span class="annottext">body_code :: OrdList BCInstr
</span><a href="#local-6989586621681283188"><span class="hs-identifier hs-var hs-var">body_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span>          </span><span class="hs-comment">-- pop frame header</span><span>
</span><span id="line-1396"></span><span>                </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_TUPLE"><span class="hs-identifier hs-var">RETURN_TUPLE</span></a></span><span> </span><span class="hs-comment">-- and add it again</span><span>
</span><span id="line-1397"></span><span>
</span><span id="line-1398"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1399"></span><span class="hs-comment">-- Deal with a CCall.</span><span>
</span><span id="line-1400"></span><span>
</span><span id="line-1401"></span><span class="hs-comment">-- Taggedly push the args onto the stack R-&gt;L,</span><span>
</span><span id="line-1402"></span><span class="hs-comment">-- deferencing ForeignObj#s and adjusting addrs to point to</span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- payloads in Ptr/Byte arrays.  Then, generate the marshalling</span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- (machine) code for the ccall, and create bytecodes to call that and</span><span>
</span><span id="line-1405"></span><span class="hs-comment">-- then return in the right way.</span><span>
</span><span id="line-1406"></span><span>
</span><span id="line-1407"></span><span class="annot"><a href="GHC.StgToByteCode.html#generateCCall"><span class="hs-identifier hs-type">generateCCall</span></a></span><span>
</span><span id="line-1408"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-1409"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-1410"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-1411"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span>               </span><span class="hs-comment">-- where to call</span><span>
</span><span id="line-1412"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1413"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- args (atoms)</span><span>
</span><span id="line-1414"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-1415"></span><span id="generateCCall"><span class="annot"><span class="annottext">generateCCall :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; CCallSpec
-&gt; Kind
-&gt; [StgArg]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#generateCCall"><span class="hs-identifier hs-var hs-var">generateCCall</span></a></span></span><span> </span><span id="local-6989586621681283179"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283179"><span class="hs-identifier hs-var">d0</span></a></span></span><span> </span><span id="local-6989586621681283178"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283178"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283177"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283177"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span id="local-6989586621681283175"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621681283175"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621681283174"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621681283174"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span id="local-6989586621681283173"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621681283173"><span class="hs-identifier hs-var">safety</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681283172"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283172"><span class="hs-identifier hs-var">result_ty</span></a></span></span><span> </span><span id="local-6989586621681283171"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283171"><span class="hs-identifier hs-var">args_r_to_l</span></a></span></span><span>
</span><span id="line-1416"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1417"></span><span>     </span><span id="local-6989586621681283170"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283170"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-1418"></span><span>
</span><span id="line-1419"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1420"></span><span>         </span><span id="local-6989586621681283169"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; Platform
</span><a href="GHC.Platform.Profile.html#profilePlatform"><span class="hs-identifier hs-var">profilePlatform</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283170"><span class="hs-identifier hs-var">profile</span></a></span><span>
</span><span id="line-1421"></span><span>         </span><span class="hs-comment">-- useful constants</span><span>
</span><span id="line-1422"></span><span>         </span><span class="annot"><a href="#local-6989586621681283168"><span class="hs-identifier hs-type">addr_size_b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-1423"></span><span>         </span><span id="local-6989586621681283168"><span class="annot"><span class="annottext">addr_size_b :: ByteOff
</span><a href="#local-6989586621681283168"><span class="hs-identifier hs-var hs-var">addr_size_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1424"></span><span>
</span><span id="line-1425"></span><span>         </span><span class="annot"><a href="#local-6989586621681283167"><span class="hs-identifier hs-type">arrayish_rep_hdr_size</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1426"></span><span>         </span><span id="local-6989586621681283167"><span class="annot"><span class="annottext">arrayish_rep_hdr_size :: TyCon -&gt; Maybe Int
</span><a href="#local-6989586621681283167"><span class="hs-identifier hs-var hs-var">arrayish_rep_hdr_size</span></a></span></span><span> </span><span id="local-6989586621681283166"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283166"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-1427"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283166"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#arrayPrimTyCon"><span class="hs-identifier hs-var">arrayPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283166"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#mutableArrayPrimTyCon"><span class="hs-identifier hs-var">mutableArrayPrimTyCon</span></a></span><span>
</span><span id="line-1428"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#arrPtrsHdrSize"><span class="hs-identifier hs-var">arrPtrsHdrSize</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283170"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1429"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283166"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#smallArrayPrimTyCon"><span class="hs-identifier hs-var">smallArrayPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283166"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#smallMutableArrayPrimTyCon"><span class="hs-identifier hs-var">smallMutableArrayPrimTyCon</span></a></span><span>
</span><span id="line-1430"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#smallArrPtrsHdrSize"><span class="hs-identifier hs-var">smallArrPtrsHdrSize</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283170"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1431"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283166"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#byteArrayPrimTyCon"><span class="hs-identifier hs-var">byteArrayPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283166"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#mutableByteArrayPrimTyCon"><span class="hs-identifier hs-var">mutableByteArrayPrimTyCon</span></a></span><span>
</span><span id="line-1432"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Profile -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#arrWordsHdrSize"><span class="hs-identifier hs-var">arrWordsHdrSize</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681283170"><span class="hs-identifier hs-var">profile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1433"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1434"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1435"></span><span>
</span><span id="line-1436"></span><span>         </span><span class="hs-comment">-- Get the args on the stack, with tags and suitably</span><span>
</span><span id="line-1437"></span><span>         </span><span class="hs-comment">-- dereferenced for the CCall.  For each arg, return the</span><span>
</span><span id="line-1438"></span><span>         </span><span class="hs-comment">-- depth to the first word of the bits for that arg, and the</span><span>
</span><span id="line-1439"></span><span>         </span><span class="hs-comment">-- ArgRep of what was actually pushed.</span><span>
</span><span id="line-1440"></span><span>
</span><span id="line-1441"></span><span>         </span><span class="annot"><a href="#local-6989586621681283156"><span class="hs-identifier hs-type">pargs</span></a></span><span>
</span><span id="line-1442"></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1443"></span><span>         </span><span id="local-6989586621681283156"><span class="annot"><span class="annottext">pargs :: ByteOff -&gt; [StgArg] -&gt; BcM [(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283156"><span class="hs-identifier hs-var hs-var">pargs</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1444"></span><span>         </span><span class="annot"><a href="#local-6989586621681283156"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span id="local-6989586621681283155"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283155"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283154"><span class="annot"><span class="annottext">aa :: StgArg
</span><a href="#local-6989586621681283154"><span class="hs-identifier hs-var">aa</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681283153"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283153"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681283152"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283152"><span class="hs-identifier hs-var">az</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1445"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283151"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283151"><span class="hs-identifier hs-var">t</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283153"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1446"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283149"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283149"><span class="hs-identifier hs-var">hdr_sz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Int
</span><a href="#local-6989586621681283167"><span class="hs-identifier hs-var">arrayish_rep_hdr_size</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283151"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1447"></span><span>            </span><span class="hs-comment">-- Do magic for Ptr/Byte arrays.  Push a ptr to the array on</span><span>
</span><span id="line-1448"></span><span>            </span><span class="hs-comment">-- the stack but then advance it over the headers, so as to</span><span>
</span><span id="line-1449"></span><span>            </span><span class="hs-comment">-- point to the payload.</span><span>
</span><span id="line-1450"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681283148"><span class="annot"><span class="annottext">[(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283148"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; BcM [(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283156"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283155"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283168"><span class="hs-identifier hs-var">addr_size_b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283152"><span class="hs-identifier hs-var">az</span></a></span><span>
</span><span id="line-1451"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621681283147"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283147"><span class="hs-identifier hs-var">push_fo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283155"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283177"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283154"><span class="hs-identifier hs-var">aa</span></a></span><span>
</span><span id="line-1452"></span><span>                 </span><span class="hs-comment">-- The ptr points at the header.  Advance it over the</span><span>
</span><span id="line-1453"></span><span>                 </span><span class="hs-comment">-- header and then pretend this is an Addr#.</span><span>
</span><span id="line-1454"></span><span>                 </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283146"><span class="annot"><span class="annottext">code :: OrdList BCInstr
</span><a href="#local-6989586621681283146"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283147"><span class="hs-identifier hs-var">push_fo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SWIZZLE"><span class="hs-identifier hs-var">SWIZZLE</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681283149"><span class="hs-identifier hs-var">hdr_sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1455"></span><span>                 </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283146"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283148"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1456"></span><span>         </span><span class="annot"><a href="#local-6989586621681283156"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span id="local-6989586621681283143"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283143"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283142"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283142"><span class="hs-identifier hs-var">aa</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681283141"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283141"><span class="hs-identifier hs-var">az</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283140"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283140"><span class="hs-identifier hs-var">code_a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283139"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283139"><span class="hs-identifier hs-var">sz_a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283143"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283177"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283142"><span class="hs-identifier hs-var">aa</span></a></span><span>
</span><span id="line-1457"></span><span>                               </span><span id="local-6989586621681283138"><span class="annot"><span class="annottext">[(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283138"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; BcM [(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283156"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283143"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283139"><span class="hs-identifier hs-var">sz_a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283141"><span class="hs-identifier hs-var">az</span></a></span><span>
</span><span id="line-1458"></span><span>                               </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283140"><span class="hs-identifier hs-var">code_a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-var">atomPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681283142"><span class="hs-identifier hs-var">aa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283138"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span>     </span><span id="local-6989586621681283137"><span class="annot"><span class="annottext">[(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283137"><span class="hs-identifier hs-var">code_n_reps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; [StgArg] -&gt; BcM [(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283156"><span class="hs-identifier hs-var">pargs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283179"><span class="hs-identifier hs-var">d0</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681283171"><span class="hs-identifier hs-var">args_r_to_l</span></a></span><span>
</span><span id="line-1461"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1462"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681283136"><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283136"><span class="hs-identifier hs-var">pushs_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283135"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283135"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(OrdList BCInstr, PrimRep)]
</span><a href="#local-6989586621681283137"><span class="hs-identifier hs-var">code_n_reps</span></a></span><span>
</span><span id="line-1463"></span><span>         </span><span id="local-6989586621681283134"><span class="annot"><span class="annottext">a_reps_sizeW :: WordOff
</span><a href="#local-6989586621681283134"><span class="hs-identifier hs-var hs-var">a_reps_sizeW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-var">repSizeWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283135"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span>         </span><span id="local-6989586621681283132"><span class="annot"><span class="annottext">push_args :: OrdList BCInstr
</span><a href="#local-6989586621681283132"><span class="hs-identifier hs-var hs-var">push_args</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [OrdList a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-var">concatOL</span></a></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681283136"><span class="hs-identifier hs-var">pushs_arg</span></a></span><span>
</span><span id="line-1466"></span><span>         </span><span class="hs-glyph">!</span><span id="local-6989586621681283131"><span class="annot"><span class="annottext">d_after_args :: ByteOff
</span><a href="#local-6989586621681283131"><span class="hs-identifier hs-var hs-var">d_after_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283179"><span class="hs-identifier hs-var">d0</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283134"><span class="hs-identifier hs-var">a_reps_sizeW</span></a></span><span>
</span><span id="line-1467"></span><span>         </span><span id="local-6989586621681283130"><span class="annot"><span class="annottext">a_reps_pushed_RAW :: [PrimRep]
</span><a href="#local-6989586621681283130"><span class="hs-identifier hs-var hs-var">a_reps_pushed_RAW</span></a></span></span><span>
</span><span id="line-1468"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283135"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVoidRep"><span class="hs-identifier hs-var">isVoidRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283135"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1469"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.generateCCall: missing or invalid World token?&quot;</span></span><span>
</span><span id="line-1470"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1471"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283135"><span class="hs-identifier hs-var">a_reps_pushed_r_to_l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1472"></span><span>
</span><span id="line-1473"></span><span>         </span><span class="hs-comment">-- Now: a_reps_pushed_RAW are the reps which are actually on the stack.</span><span>
</span><span id="line-1474"></span><span>         </span><span class="hs-comment">-- push_args is the code to do that.</span><span>
</span><span id="line-1475"></span><span>         </span><span class="hs-comment">-- d_after_args is the stack depth once the args are on.</span><span>
</span><span id="line-1476"></span><span>
</span><span id="line-1477"></span><span>         </span><span class="hs-comment">-- Get the result rep.</span><span>
</span><span id="line-1478"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681283127"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283127"><span class="hs-identifier hs-var">returns_void</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283126"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283126"><span class="hs-identifier hs-var">r_rep</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1479"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Maybe PrimRep
</span><a href="GHC.StgToByteCode.html#maybe_getCCallReturnRep"><span class="hs-identifier hs-var">maybe_getCCallReturnRep</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283172"><span class="hs-identifier hs-var">result_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1480"></span><span>                 </span><span class="annot"><span class="annottext">Maybe PrimRep
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1481"></span><span>                 </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283124"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283124"><span class="hs-identifier hs-var">rr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283124"><span class="hs-identifier hs-var">rr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1482"></span><span>         </span><span class="hs-comment">{-
         Because the Haskell stack grows down, the a_reps refer to
         lowest to highest addresses in that order.  The args for the call
         are on the stack.  Now push an unboxed Addr# indicating
         the C function to call.  Then push a dummy placeholder for the
         result.  Finally, emit a CCALL insn with an offset pointing to the
         Addr# just pushed, and a literal field holding the mallocville
         address of the piece of marshalling code we generate.
         So, just prior to the CCALL insn, the stack looks like this
         (growing down, as usual):

            &lt;arg_n&gt;
            ...
            &lt;arg_1&gt;
            Addr# address_of_C_fn
            &lt;placeholder-for-result#&gt; (must be an unboxed type)

         The interpreter then calls the marshall code mentioned
         in the CCALL insn, passing it (&amp; &lt;placeholder-for-result#&gt;),
         that is, the addr of the topmost word in the stack.
         When this returns, the placeholder will have been
         filled in.  The placeholder is slid down to the sequel
         depth, and we RETURN.

         This arrangement makes it simple to do f-i-dynamic since the Addr#
         value is the first arg anyway.

         The marshalling code is generated specifically for this
         call site, and so knows exactly the (Haskell) stack
         offsets of the args, fn address and placeholder.  It
         copies the args to the C stack, calls the stacked addr,
         and parks the result back in the placeholder.  The interpreter
         calls it as a normal C call, assuming it has a signature
            void marshall_code ( StgWord* ptr_to_top_of_stack )
         -}</span><span>
</span><span id="line-1517"></span><span>         </span><span class="hs-comment">-- resolve static address</span><span>
</span><span id="line-1518"></span><span>         </span><span class="annot"><a href="#local-6989586621681283123"><span class="hs-identifier hs-type">maybe_static_target</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span>
</span><span id="line-1519"></span><span>         </span><span id="local-6989586621681283123"><span class="annot"><span class="annottext">maybe_static_target :: Maybe Literal
</span><a href="#local-6989586621681283123"><span class="hs-identifier hs-var hs-var">maybe_static_target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1520"></span><span>             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621681283175"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1521"></span><span>                 </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="GHC.Types.ForeignCall.html#DynamicTarget"><span class="hs-identifier hs-var">DynamicTarget</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1522"></span><span>                 </span><span class="annot"><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-type">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FastString
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1523"></span><span>                   </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generateCCall: unexpected FFI value import&quot;</span></span><span>
</span><span id="line-1524"></span><span>                 </span><span class="annot"><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-type">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681283120"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681283120"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1525"></span><span>                   </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Maybe Int -&gt; FunctionOrData -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-var">LitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681283120"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621681283118"><span class="hs-identifier hs-var">mb_size</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>                   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1527"></span><span>                      </span><span id="local-6989586621681283118"><span class="annot"><span class="annottext">mb_size :: Maybe Int
</span><a href="#local-6989586621681283118"><span class="hs-identifier hs-var hs-var">mb_size</span></a></span></span><span>
</span><span id="line-1528"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.2.4/src/GHC-Platform-ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1529"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#StdCallConv"><span class="hs-identifier hs-var">StdCallConv</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621681283174"><span class="hs-identifier hs-var">cconv</span></a></span><span>
</span><span id="line-1530"></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283134"><span class="hs-identifier hs-var">a_reps_sizeW</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Int
</span><a href="GHC.Platform.html#platformWordSizeInBytes"><span class="hs-identifier hs-var">platformWordSizeInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1531"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1532"></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1533"></span><span>
</span><span id="line-1534"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1535"></span><span>         </span><span id="local-6989586621681283113"><span class="annot"><span class="annottext">is_static :: Bool
</span><a href="#local-6989586621681283113"><span class="hs-identifier hs-var hs-var">is_static</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Literal
</span><a href="#local-6989586621681283123"><span class="hs-identifier hs-var">maybe_static_target</span></a></span><span>
</span><span id="line-1536"></span><span>
</span><span id="line-1537"></span><span>         </span><span class="hs-comment">-- Get the arg reps, zapping the leading Addr# in the dynamic case</span><span>
</span><span id="line-1538"></span><span>         </span><span id="local-6989586621681283111"><span class="annot"><span class="annottext">a_reps :: [PrimRep]
</span><a href="#local-6989586621681283111"><span class="hs-identifier hs-var hs-var">a_reps</span></a></span></span><span> </span><span class="hs-comment">--  | trace (showSDoc (ppr a_reps_pushed_RAW)) False = error &quot;???&quot;</span><span>
</span><span id="line-1539"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283113"><span class="hs-identifier hs-var">is_static</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283130"><span class="hs-identifier hs-var">a_reps_pushed_RAW</span></a></span><span>
</span><span id="line-1540"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283130"><span class="hs-identifier hs-var">a_reps_pushed_RAW</span></a></span><span>
</span><span id="line-1541"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.generateCCall: dyn with no args&quot;</span></span><span>
</span><span id="line-1542"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283130"><span class="hs-identifier hs-var">a_reps_pushed_RAW</span></a></span><span>
</span><span id="line-1543"></span><span>
</span><span id="line-1544"></span><span>         </span><span class="hs-comment">-- push the Addr#</span><span>
</span><span id="line-1545"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681283110"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283110"><span class="hs-identifier hs-var">push_Addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283109"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283109"><span class="hs-identifier hs-var">d_after_Addr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1546"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283108"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283108"><span class="hs-identifier hs-var">machlabel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Literal
</span><a href="#local-6989586621681283123"><span class="hs-identifier hs-var">maybe_static_target</span></a></span><span>
</span><span id="line-1547"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Literal -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681283108"><span class="hs-identifier hs-var">machlabel</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283131"><span class="hs-identifier hs-var">d_after_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283168"><span class="hs-identifier hs-var">addr_size_b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1548"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-comment">-- is already on the stack</span><span>
</span><span id="line-1549"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283131"><span class="hs-identifier hs-var">d_after_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span>
</span><span id="line-1551"></span><span>         </span><span class="hs-comment">-- Push the return placeholder.  For a call returning nothing,</span><span>
</span><span id="line-1552"></span><span>         </span><span class="hs-comment">-- this is a V (tag).</span><span>
</span><span id="line-1553"></span><span>         </span><span id="local-6989586621681283107"><span class="annot"><span class="annottext">r_sizeW :: WordOff
</span><a href="#local-6989586621681283107"><span class="hs-identifier hs-var hs-var">r_sizeW</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-var">repSizeWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283126"><span class="hs-identifier hs-var">r_rep</span></a></span><span>
</span><span id="line-1554"></span><span>         </span><span id="local-6989586621681283106"><span class="annot"><span class="annottext">d_after_r :: ByteOff
</span><a href="#local-6989586621681283106"><span class="hs-identifier hs-var hs-var">d_after_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283109"><span class="hs-identifier hs-var">d_after_Addr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283107"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span>
</span><span id="line-1555"></span><span>         </span><span id="local-6989586621681283105"><span class="annot"><span class="annottext">push_r :: OrdList BCInstr
</span><a href="#local-6989586621681283105"><span class="hs-identifier hs-var hs-var">push_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1556"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681283127"><span class="hs-identifier hs-var">returns_void</span></a></span><span>
</span><span id="line-1557"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-1558"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; Literal
</span><a href="GHC.StgToByteCode.html#mkDummyLiteral"><span class="hs-identifier hs-var">mkDummyLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283126"><span class="hs-identifier hs-var">r_rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283107"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>
</span><span id="line-1560"></span><span>         </span><span class="hs-comment">-- generate the marshalling code we're going to call</span><span>
</span><span id="line-1561"></span><span>
</span><span id="line-1562"></span><span>         </span><span class="hs-comment">-- Offset of the next stack frame down the stack.  The CCALL</span><span>
</span><span id="line-1563"></span><span>         </span><span class="hs-comment">-- instruction needs to describe the chunk of stack containing</span><span>
</span><span id="line-1564"></span><span>         </span><span class="hs-comment">-- the ccall args to the GC, so it needs to know how large it</span><span>
</span><span id="line-1565"></span><span>         </span><span class="hs-comment">-- is.  See comment in Interpreter.c with the CCALL instruction.</span><span>
</span><span id="line-1566"></span><span>         </span><span id="local-6989586621681283103"><span class="annot"><span class="annottext">stk_offset :: Word16
</span><a href="#local-6989586621681283103"><span class="hs-identifier hs-var hs-var">stk_offset</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283106"><span class="hs-identifier hs-var">d_after_r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283178"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span>         </span><span id="local-6989586621681283102"><span class="annot"><span class="annottext">conv :: FFIConv
</span><a href="#local-6989586621681283102"><span class="hs-identifier hs-var hs-var">conv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621681283174"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1569"></span><span>           </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-var">CCallConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIConv
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFICCall"><span class="hs-identifier hs-var">FFICCall</span></a></span><span>
</span><span id="line-1570"></span><span>           </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CApiConv"><span class="hs-identifier hs-var">CApiConv</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIConv
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFICCall"><span class="hs-identifier hs-var">FFICCall</span></a></span><span>
</span><span id="line-1571"></span><span>           </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#StdCallConv"><span class="hs-identifier hs-var">StdCallConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIConv
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIStdCall"><span class="hs-identifier hs-var">FFIStdCall</span></a></span><span>
</span><span id="line-1572"></span><span>           </span><span class="annot"><span class="annottext">CCallConv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode: unexpected calling convention&quot;</span></span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span>     </span><span class="hs-comment">-- the only difference in libffi mode is that we prepare a cif</span><span>
</span><span id="line-1575"></span><span>     </span><span class="hs-comment">-- describing the call type by calling libffi, and we attach the</span><span>
</span><span id="line-1576"></span><span>     </span><span class="hs-comment">-- address of this to the CCALL instruction.</span><span>
</span><span id="line-1577"></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681283097"><span class="annot"><span class="annottext">ffires :: FFIType
</span><a href="#local-6989586621681283097"><span class="hs-identifier hs-var hs-var">ffires</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; FFIType
</span><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-var">primRepToFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283126"><span class="hs-identifier hs-var">r_rep</span></a></span><span>
</span><span id="line-1580"></span><span>         </span><span id="local-6989586621681283095"><span class="annot"><span class="annottext">ffiargs :: [FFIType]
</span><a href="#local-6989586621681283095"><span class="hs-identifier hs-var hs-var">ffiargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; FFIType
</span><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-var">primRepToFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283111"><span class="hs-identifier hs-var">a_reps</span></a></span><span>
</span><span id="line-1581"></span><span>     </span><span id="local-6989586621681283094"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681283094"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Runtime.Interpreter.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BcM HscEnv
</span><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1582"></span><span>     </span><span id="local-6989586621681283093"><span class="annot"><span class="annottext">RemotePtr C_ffi_cif
</span><a href="#local-6989586621681283093"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; BcM a
</span><a href="GHC.StgToByteCode.html#ioToBc"><span class="hs-identifier hs-var">ioToBc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; Interp -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#interpCmd"><span class="hs-identifier hs-var">interpCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681283094"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FFIConv -&gt; [FFIType] -&gt; FFIType -&gt; Message (RemotePtr C_ffi_cif)
</span><a href="../../ghci-9.2.4/src/GHCi-Message.html#PrepFFI"><span class="hs-identifier hs-var">PrepFFI</span></a></span><span> </span><span class="annot"><span class="annottext">FFIConv
</span><a href="#local-6989586621681283102"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">[FFIType]
</span><a href="#local-6989586621681283095"><span class="hs-identifier hs-var">ffiargs</span></a></span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621681283097"><span class="hs-identifier hs-var">ffires</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1583"></span><span>     </span><span class="annot"><span class="annottext">RemotePtr C_ffi_cif -&gt; BcM ()
</span><a href="GHC.StgToByteCode.html#recordFFIBc"><span class="hs-identifier hs-var">recordFFIBc</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr C_ffi_cif
</span><a href="#local-6989586621681283093"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1586"></span><span>         </span><span class="hs-comment">-- do the call</span><span>
</span><span id="line-1587"></span><span>         </span><span id="local-6989586621681283089"><span class="annot"><span class="annottext">do_call :: OrdList BCInstr
</span><a href="#local-6989586621681283089"><span class="hs-identifier hs-var hs-var">do_call</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; RemotePtr C_ffi_cif -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#CCALL"><span class="hs-identifier hs-var">CCALL</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283103"><span class="hs-identifier hs-var">stk_offset</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr C_ffi_cif
</span><a href="#local-6989586621681283093"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681283087"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>           </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681283087"><span class="annot"><span class="annottext">flags :: Word16
</span><a href="#local-6989586621681283087"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621681283173"><span class="hs-identifier hs-var">safety</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1589"></span><span>                           </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlaySafe"><span class="hs-identifier hs-var">PlaySafe</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0x0</span></span><span>
</span><span id="line-1590"></span><span>                           </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlayInterruptible"><span class="hs-identifier hs-var">PlayInterruptible</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0x1</span></span><span>
</span><span id="line-1591"></span><span>                           </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlayRisky"><span class="hs-identifier hs-var">PlayRisky</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0x2</span></span><span>
</span><span id="line-1592"></span><span>
</span><span id="line-1593"></span><span>         </span><span class="hs-comment">-- slide and return</span><span>
</span><span id="line-1594"></span><span>         </span><span id="local-6989586621681283083"><span class="annot"><span class="annottext">d_after_r_min_s :: WordOff
</span><a href="#local-6989586621681283083"><span class="hs-identifier hs-var hs-var">d_after_r_min_s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283106"><span class="hs-identifier hs-var">d_after_r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283178"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1595"></span><span>         </span><span id="local-6989586621681283082"><span class="annot"><span class="annottext">wrapup :: OrdList BCInstr
</span><a href="#local-6989586621681283082"><span class="hs-identifier hs-var hs-var">wrapup</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283107"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283083"><span class="hs-identifier hs-var">d_after_r_min_s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681283107"><span class="hs-identifier hs-var">r_sizeW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span>                        </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#RETURN_UNLIFTED"><span class="hs-identifier hs-var">RETURN_UNLIFTED</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283169"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283126"><span class="hs-identifier hs-var">r_rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1597"></span><span>         </span><span class="hs-comment">--trace (show (arg1_offW, args_offW  ,  (map argRepSizeW a_reps) )) $</span><span>
</span><span id="line-1598"></span><span>     </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1599"></span><span>         </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283132"><span class="hs-identifier hs-var">push_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>
</span><span id="line-1600"></span><span>         </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283110"><span class="hs-identifier hs-var">push_Addr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283105"><span class="hs-identifier hs-var">push_r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283089"><span class="hs-identifier hs-var">do_call</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283082"><span class="hs-identifier hs-var">wrapup</span></a></span><span>
</span><span id="line-1601"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-1602"></span><span>
</span><span id="line-1603"></span><span class="annot"><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-type">primRepToFFIType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIType"><span class="hs-identifier hs-type">FFIType</span></a></span><span>
</span><span id="line-1604"></span><span id="primRepToFFIType"><span class="annot"><span class="annottext">primRepToFFIType :: Platform -&gt; PrimRep -&gt; FFIType
</span><a href="GHC.StgToByteCode.html#primRepToFFIType"><span class="hs-identifier hs-var hs-var">primRepToFFIType</span></a></span></span><span> </span><span id="local-6989586621681283081"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283081"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681283080"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283080"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-1605"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283080"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1606"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIVoid"><span class="hs-identifier hs-var">FFIVoid</span></a></span><span>
</span><span id="line-1607"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#IntRep"><span class="hs-identifier hs-var">IntRep</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621681283077"><span class="hs-identifier hs-var">signed_word</span></a></span><span>
</span><span id="line-1608"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621681283075"><span class="hs-identifier hs-var">unsigned_word</span></a></span><span>
</span><span id="line-1609"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int8Rep"><span class="hs-identifier hs-var">Int8Rep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFISInt8"><span class="hs-identifier hs-var">FFISInt8</span></a></span><span>
</span><span id="line-1610"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word8Rep"><span class="hs-identifier hs-var">Word8Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIUInt8"><span class="hs-identifier hs-var">FFIUInt8</span></a></span><span>
</span><span id="line-1611"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int16Rep"><span class="hs-identifier hs-var">Int16Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFISInt16"><span class="hs-identifier hs-var">FFISInt16</span></a></span><span>
</span><span id="line-1612"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word16Rep"><span class="hs-identifier hs-var">Word16Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIUInt16"><span class="hs-identifier hs-var">FFIUInt16</span></a></span><span>
</span><span id="line-1613"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int32Rep"><span class="hs-identifier hs-var">Int32Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFISInt32"><span class="hs-identifier hs-var">FFISInt32</span></a></span><span>
</span><span id="line-1614"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word32Rep"><span class="hs-identifier hs-var">Word32Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIUInt32"><span class="hs-identifier hs-var">FFIUInt32</span></a></span><span>
</span><span id="line-1615"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int64Rep"><span class="hs-identifier hs-var">Int64Rep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFISInt64"><span class="hs-identifier hs-var">FFISInt64</span></a></span><span>
</span><span id="line-1616"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word64Rep"><span class="hs-identifier hs-var">Word64Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIUInt64"><span class="hs-identifier hs-var">FFIUInt64</span></a></span><span>
</span><span id="line-1617"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIPointer"><span class="hs-identifier hs-var">FFIPointer</span></a></span><span>
</span><span id="line-1618"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#FloatRep"><span class="hs-identifier hs-var">FloatRep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIFloat"><span class="hs-identifier hs-var">FFIFloat</span></a></span><span>
</span><span id="line-1619"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#DoubleRep"><span class="hs-identifier hs-var">DoubleRep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIDouble"><span class="hs-identifier hs-var">FFIDouble</span></a></span><span>
</span><span id="line-1620"></span><span>     </span><span class="annot"><span class="annottext">PrimRep
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;primRepToFFIType&quot;</span></span><span>
</span><span id="line-1621"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1622"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681283077"><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621681283077"><span class="hs-identifier hs-var">signed_word</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283075"><span class="annot"><span class="annottext">FFIType
</span><a href="#local-6989586621681283075"><span class="hs-identifier hs-var">unsigned_word</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PlatformWordSize
</span><a href="GHC.Platform.html#platformWordSize"><span class="hs-identifier hs-var">platformWordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283081"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1623"></span><span>       </span><span class="annot"><span class="annottext">PlatformWordSize
</span><a href="GHC.Platform.html#PW4"><span class="hs-identifier hs-var">PW4</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFISInt32"><span class="hs-identifier hs-var">FFISInt32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIUInt32"><span class="hs-identifier hs-var">FFIUInt32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1624"></span><span>       </span><span class="annot"><span class="annottext">PlatformWordSize
</span><a href="GHC.Platform.html#PW8"><span class="hs-identifier hs-var">PW8</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFISInt64"><span class="hs-identifier hs-var">FFISInt64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FFIType
</span><a href="../../ghci-9.2.4/src/GHCi-FFI.html#FFIUInt64"><span class="hs-identifier hs-var">FFIUInt64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span class="hs-comment">-- Make a dummy literal, to be used as a placeholder for FFI return</span><span>
</span><span id="line-1627"></span><span class="hs-comment">-- values on the stack.</span><span>
</span><span id="line-1628"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkDummyLiteral"><span class="hs-identifier hs-type">mkDummyLiteral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span>
</span><span id="line-1629"></span><span id="mkDummyLiteral"><span class="annot"><span class="annottext">mkDummyLiteral :: Platform -&gt; PrimRep -&gt; Literal
</span><a href="GHC.StgToByteCode.html#mkDummyLiteral"><span class="hs-identifier hs-var hs-var">mkDummyLiteral</span></a></span></span><span> </span><span id="local-6989586621681283050"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283050"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681283049"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283049"><span class="hs-identifier hs-var">pr</span></a></span></span><span>
</span><span id="line-1630"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283049"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1631"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#IntRep"><span class="hs-identifier hs-var">IntRep</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt"><span class="hs-identifier hs-var">mkLitInt</span></a></span><span>  </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283050"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1632"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord"><span class="hs-identifier hs-var">mkLitWord</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681283050"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1633"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int8Rep"><span class="hs-identifier hs-var">Int8Rep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt8"><span class="hs-identifier hs-var">mkLitInt8</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1634"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word8Rep"><span class="hs-identifier hs-var">Word8Rep</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord8"><span class="hs-identifier hs-var">mkLitWord8</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1635"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int16Rep"><span class="hs-identifier hs-var">Int16Rep</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt16"><span class="hs-identifier hs-var">mkLitInt16</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1636"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word16Rep"><span class="hs-identifier hs-var">Word16Rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord16"><span class="hs-identifier hs-var">mkLitWord16</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1637"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int32Rep"><span class="hs-identifier hs-var">Int32Rep</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt32"><span class="hs-identifier hs-var">mkLitInt32</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1638"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word32Rep"><span class="hs-identifier hs-var">Word32Rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord32"><span class="hs-identifier hs-var">mkLitWord32</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1639"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int64Rep"><span class="hs-identifier hs-var">Int64Rep</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitInt64"><span class="hs-identifier hs-var">mkLitInt64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1640"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word64Rep"><span class="hs-identifier hs-var">Word64Rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord64"><span class="hs-identifier hs-var">mkLitWord64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1641"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="GHC.Types.Literal.html#LitNullAddr"><span class="hs-identifier hs-var">LitNullAddr</span></a></span><span>
</span><span id="line-1642"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#DoubleRep"><span class="hs-identifier hs-var">DoubleRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1643"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#FloatRep"><span class="hs-identifier hs-var">FloatRep</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1644"></span><span>        </span><span class="annot"><span class="annottext">PrimRep
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkDummyLiteral&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283049"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span class="hs-comment">-- Convert (eg)</span><span>
</span><span id="line-1648"></span><span class="hs-comment">--     GHC.Prim.Char# -&gt; GHC.Prim.State# GHC.Prim.RealWorld</span><span>
</span><span id="line-1649"></span><span class="hs-comment">--                   -&gt; (# GHC.Prim.State# GHC.Prim.RealWorld, GHC.Prim.Int# #)</span><span>
</span><span id="line-1650"></span><span class="hs-comment">--</span><span>
</span><span id="line-1651"></span><span class="hs-comment">-- to  Just IntRep</span><span>
</span><span id="line-1652"></span><span class="hs-comment">-- and check that an unboxed pair is returned wherein the first arg is V'd.</span><span>
</span><span id="line-1653"></span><span class="hs-comment">--</span><span>
</span><span id="line-1654"></span><span class="hs-comment">-- Alternatively, for call-targets returning nothing, convert</span><span>
</span><span id="line-1655"></span><span class="hs-comment">--</span><span>
</span><span id="line-1656"></span><span class="hs-comment">--     GHC.Prim.Char# -&gt; GHC.Prim.State# GHC.Prim.RealWorld</span><span>
</span><span id="line-1657"></span><span class="hs-comment">--                   -&gt; (# GHC.Prim.State# GHC.Prim.RealWorld #)</span><span>
</span><span id="line-1658"></span><span class="hs-comment">--</span><span>
</span><span id="line-1659"></span><span class="hs-comment">-- to  Nothing</span><span>
</span><span id="line-1660"></span><span>
</span><span id="line-1661"></span><span class="annot"><a href="GHC.StgToByteCode.html#maybe_getCCallReturnRep"><span class="hs-identifier hs-type">maybe_getCCallReturnRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span>
</span><span id="line-1662"></span><span id="maybe_getCCallReturnRep"><span class="annot"><span class="annottext">maybe_getCCallReturnRep :: Kind -&gt; Maybe PrimRep
</span><a href="GHC.StgToByteCode.html#maybe_getCCallReturnRep"><span class="hs-identifier hs-var hs-var">maybe_getCCallReturnRep</span></a></span></span><span> </span><span id="local-6989586621681283037"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283037"><span class="hs-identifier hs-var">fn_ty</span></a></span></span><span>
</span><span id="line-1663"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1664"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621681283036"><span class="annot"><span class="annottext">[Scaled Kind]
</span><a href="#local-6989586621681283036"><span class="hs-identifier hs-var">_a_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283035"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283035"><span class="hs-identifier hs-var">r_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; ([Scaled Kind], Kind)
</span><a href="GHC.Core.Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="GHC.Core.Type.html#dropForAlls"><span class="hs-identifier hs-var">dropForAlls</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283037"><span class="hs-identifier hs-var">fn_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1665"></span><span>       </span><span id="local-6989586621681283032"><span class="annot"><span class="annottext">r_reps :: [PrimRep]
</span><a href="#local-6989586621681283032"><span class="hs-identifier hs-var hs-var">r_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRepArgs"><span class="hs-identifier hs-var">typePrimRepArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283035"><span class="hs-identifier hs-var">r_ty</span></a></span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span>       </span><span id="local-6989586621681283031"><span class="annot"><a href="#local-6989586621681283030"><span class="hs-identifier hs-type">blargh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681283031"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-comment">-- Used at more than one type</span><span>
</span><span id="line-1668"></span><span>       </span><span id="local-6989586621681283030"><span class="annot"><span class="annottext">blargh :: forall a. a
</span><a href="#local-6989586621681283030"><span class="hs-identifier hs-var hs-var">blargh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;maybe_getCCallReturn: can't handle:&quot;</span></span><span>
</span><span id="line-1669"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprType"><span class="hs-identifier hs-var">pprType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283037"><span class="hs-identifier hs-var">fn_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span>     </span><span class="hs-keyword">in</span><span>
</span><span id="line-1671"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681283032"><span class="hs-identifier hs-var">r_reps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1672"></span><span>         </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;empty typePrimRepArgs&quot;</span></span><span>
</span><span id="line-1673"></span><span>         </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#VoidRep"><span class="hs-identifier hs-var">VoidRep</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1674"></span><span>         </span><span class="hs-special">[</span><span id="local-6989586621681283027"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283027"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-1675"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGcPtrRep"><span class="hs-identifier hs-var">isGcPtrRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283027"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a
</span><a href="#local-6989586621681283030"><span class="hs-identifier hs-var">blargh</span></a></span><span>
</span><span id="line-1676"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681283027"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1677"></span><span>
</span><span id="line-1678"></span><span>                 </span><span class="hs-comment">-- if it was, it would be impossible to create a</span><span>
</span><span id="line-1679"></span><span>                 </span><span class="hs-comment">-- valid return value placeholder on the stack</span><span>
</span><span id="line-1680"></span><span>         </span><span class="annot"><span class="annottext">[PrimRep]
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a
</span><a href="#local-6989586621681283030"><span class="hs-identifier hs-var">blargh</span></a></span><span>
</span><span id="line-1681"></span><span>
</span><span id="line-1682"></span><span class="annot"><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-type">maybe_is_tagToEnum_call</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1683"></span><span class="hs-comment">-- Detect and extract relevant info for the tagToEnum kludge.</span><span>
</span><span id="line-1684"></span><span id="maybe_is_tagToEnum_call"><span class="annot"><span class="annottext">maybe_is_tagToEnum_call :: CgStgExpr -&gt; Maybe (Id, [Name])
</span><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-var hs-var">maybe_is_tagToEnum_call</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPrimOp"><span class="hs-identifier hs-type">StgPrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="GHC.Builtin.PrimOps.html#TagToEnumOp"><span class="hs-identifier hs-var">TagToEnumOp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681283024"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283024"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621681283023"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283023"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1685"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283024"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; [Name]
</span><a href="#local-6989586621681283022"><span class="hs-identifier hs-var">extract_constr_Names</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283023"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1686"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1687"></span><span>    </span><span id="local-6989586621681283022"><span class="annot"><span class="annottext">extract_constr_Names :: Kind -&gt; [Name]
</span><a href="#local-6989586621681283022"><span class="hs-identifier hs-var hs-var">extract_constr_Names</span></a></span></span><span> </span><span id="local-6989586621681283017"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283017"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1688"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681283016"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283016"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283017"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1689"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681283014"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283014"><span class="hs-identifier hs-var">tyc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283016"><span class="hs-identifier hs-var">rep_ty</span></a></span><span>
</span><span id="line-1690"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataTyCon"><span class="hs-identifier hs-var">isDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283014"><span class="hs-identifier hs-var">tyc</span></a></span><span>
</span><span id="line-1691"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681283014"><span class="hs-identifier hs-var">tyc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1692"></span><span>           </span><span class="hs-comment">-- NOTE: use the worker name, not the source name of</span><span>
</span><span id="line-1693"></span><span>           </span><span class="hs-comment">-- the DataCon.  See &quot;GHC.Core.DataCon&quot; for details.</span><span>
</span><span id="line-1694"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1695"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;maybe_is_tagToEnum_call.extract_constr_Ids&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681283017"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1696"></span><span class="annot"><a href="GHC.StgToByteCode.html#maybe_is_tagToEnum_call"><span class="hs-identifier hs-var">maybe_is_tagToEnum_call</span></a></span><span> </span><span class="annot"><span class="annottext">CgStgExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1697"></span><span>
</span><span id="line-1698"></span><span class="hs-comment">{- -----------------------------------------------------------------------------
Note [Implementing tagToEnum#]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(implement_tagToId arg names) compiles code which takes an argument
'arg', (call it i), and enters the i'th closure in the supplied list
as a consequence.  The [Name] is a list of the constructors of this
(enumeration) type.

The code we generate is this:
                push arg
                push bogus-word

                TESTEQ_I 0 L1
                  PUSH_G &lt;lbl for first data con&gt;
                  JMP L_Exit

        L1:     TESTEQ_I 1 L2
                  PUSH_G &lt;lbl for second data con&gt;
                  JMP L_Exit
        ...etc...
        Ln:     TESTEQ_I n L_fail
                  PUSH_G &lt;lbl for last data con&gt;
                  JMP L_Exit

        L_fail: CASEFAIL

        L_exit: SLIDE 1 n
                ENTER

The 'bogus-word' push is because TESTEQ_I expects the top of the stack
to have an info-table, and the next word to have the value to be
tested.  This is very weird, but it's the way it is right now.  See
Interpreter.c.  We don't actually need an info-table here; we just
need to have the argument to be one-from-top on the stack, hence pushing
a 1-word null. See #8383.
-}</span><span>
</span><span id="line-1734"></span><span>
</span><span id="line-1735"></span><span>
</span><span id="line-1736"></span><span class="annot"><a href="GHC.StgToByteCode.html#implement_tagToId"><span class="hs-identifier hs-type">implement_tagToId</span></a></span><span>
</span><span id="line-1737"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span>
</span><span id="line-1738"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Sequel"><span class="hs-identifier hs-type">Sequel</span></a></span><span>
</span><span id="line-1739"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span>
</span><span id="line-1740"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-1741"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1742"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-1743"></span><span class="hs-comment">-- See Note [Implementing tagToEnum#]</span><span>
</span><span id="line-1744"></span><span id="implement_tagToId"><span class="annot"><span class="annottext">implement_tagToId :: ByteOff
-&gt; ByteOff
-&gt; Map Id ByteOff
-&gt; Id
-&gt; [Name]
-&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#implement_tagToId"><span class="hs-identifier hs-var hs-var">implement_tagToId</span></a></span></span><span> </span><span id="local-6989586621681283010"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283010"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681283009"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283009"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681283008"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283008"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681283007"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283007"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681283006"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681283006"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-1745"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">names</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1746"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681283005"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283005"><span class="hs-identifier hs-var">push_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681283004"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283004"><span class="hs-identifier hs-var">arg_bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283010"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681283008"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681283007"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1747"></span><span>       </span><span id="local-6989586621681283003"><span class="annot"><span class="annottext">[LocalLabel]
</span><a href="#local-6989586621681283003"><span class="hs-identifier hs-var">labels</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; BcM [LocalLabel]
</span><a href="GHC.StgToByteCode.html#getLabelsBc"><span class="hs-identifier hs-var">getLabelsBc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i a. Num i =&gt; [a] -&gt; i
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#genericLength"><span class="hs-identifier hs-var">genericLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681283006"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1748"></span><span>       </span><span id="local-6989586621681283001"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681283001"><span class="hs-identifier hs-var">label_fail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-1749"></span><span>       </span><span id="local-6989586621681282999"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282999"><span class="hs-identifier hs-var">label_exit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-1750"></span><span>       </span><span id="local-6989586621681282998"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681282998"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1751"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681282997"><span class="annot"><span class="annottext">infos :: [(LocalLabel, LocalLabel, Int, Name)]
</span><a href="#local-6989586621681282997"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c d. [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [(a, b, c, d)]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#zip4"><span class="hs-identifier hs-var">zip4</span></a></span><span> </span><span class="annot"><span class="annottext">[LocalLabel]
</span><a href="#local-6989586621681283003"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[LocalLabel]
</span><a href="#local-6989586621681283003"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681283001"><span class="hs-identifier hs-var">label_fail</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1752"></span><span>                               </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681283006"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1753"></span><span>           </span><span id="local-6989586621681282996"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681282996"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681282998"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1754"></span><span>           </span><span id="local-6989586621681282995"><span class="annot"><span class="annottext">steps :: [OrdList BCInstr]
</span><a href="#local-6989586621681282995"><span class="hs-identifier hs-var hs-var">steps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalLabel
-&gt; (LocalLabel, LocalLabel, Int, Name) -&gt; OrdList BCInstr
</span><a href="#local-6989586621681282994"><span class="hs-identifier hs-var">mkStep</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282999"><span class="hs-identifier hs-var">label_exit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LocalLabel, LocalLabel, Int, Name)]
</span><a href="#local-6989586621681282997"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-1755"></span><span>           </span><span id="local-6989586621681282993"><span class="annot"><span class="annottext">slide_ws :: WordOff
</span><a href="#local-6989586621681282993"><span class="hs-identifier hs-var hs-var">slide_ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282996"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283010"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283009"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681283004"><span class="hs-identifier hs-var">arg_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1756"></span><span>
</span><span id="line-1757"></span><span>       </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681283005"><span class="hs-identifier hs-var">push_arg</span></a></span><span>
</span><span id="line-1758"></span><span>               </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="GHC.Types.Literal.html#LitNullAddr"><span class="hs-identifier hs-var">LitNullAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1759"></span><span>                   </span><span class="hs-comment">-- Push bogus word (see Note [Implementing tagToEnum#])</span><span>
</span><span id="line-1760"></span><span>               </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [OrdList a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#concatOL"><span class="hs-identifier hs-var">concatOL</span></a></span><span> </span><span class="annot"><span class="annottext">[OrdList BCInstr]
</span><a href="#local-6989586621681282995"><span class="hs-identifier hs-var">steps</span></a></span><span>
</span><span id="line-1761"></span><span>               </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681283001"><span class="hs-identifier hs-var">label_fail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#CASEFAIL"><span class="hs-identifier hs-var">CASEFAIL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1762"></span><span>                              </span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282999"><span class="hs-identifier hs-var">label_exit</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1763"></span><span>               </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282993"><span class="hs-identifier hs-var">slide_ws</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1764"></span><span>                   </span><span class="hs-comment">-- &quot;+1&quot; to account for bogus word</span><span>
</span><span id="line-1765"></span><span>                   </span><span class="hs-comment">--      (see Note [Implementing tagToEnum#])</span><span>
</span><span id="line-1766"></span><span>               </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#ENTER"><span class="hs-identifier hs-var">ENTER</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1767"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1768"></span><span>        </span><span id="local-6989586621681282994"><span class="annot"><span class="annottext">mkStep :: LocalLabel
-&gt; (LocalLabel, LocalLabel, Int, Name) -&gt; OrdList BCInstr
</span><a href="#local-6989586621681282994"><span class="hs-identifier hs-var hs-var">mkStep</span></a></span></span><span> </span><span id="local-6989586621681282990"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282990"><span class="hs-identifier hs-var">l_exit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681282989"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282989"><span class="hs-identifier hs-var">my_label</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282988"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282988"><span class="hs-identifier hs-var">next_label</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282987"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282987"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282986"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681282986"><span class="hs-identifier hs-var">name_for_n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1769"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282989"><span class="hs-identifier hs-var">my_label</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1770"></span><span>                   </span><span class="annot"><span class="annottext">Int -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I"><span class="hs-identifier hs-var">TESTEQ_I</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282987"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282988"><span class="hs-identifier hs-var">next_label</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1771"></span><span>                   </span><span class="annot"><span class="annottext">Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_G"><span class="hs-identifier hs-var">PUSH_G</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681282986"><span class="hs-identifier hs-var">name_for_n</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1772"></span><span>                   </span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282990"><span class="hs-identifier hs-var">l_exit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1773"></span><span>
</span><span id="line-1774"></span><span>
</span><span id="line-1775"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1776"></span><span class="hs-comment">-- pushAtom</span><span>
</span><span id="line-1777"></span><span>
</span><span id="line-1778"></span><span class="hs-comment">-- Push an atom onto the stack, returning suitable code &amp; number of</span><span>
</span><span id="line-1779"></span><span class="hs-comment">-- stack words used.</span><span>
</span><span id="line-1780"></span><span class="hs-comment">--</span><span>
</span><span id="line-1781"></span><span class="hs-comment">-- The env p must map each variable to the highest- numbered stack</span><span>
</span><span id="line-1782"></span><span class="hs-comment">-- slot for it.  For example, if the stack has depth 4 and we</span><span>
</span><span id="line-1783"></span><span class="hs-comment">-- tagged-ly push (v :: Int#) on it, the value will be in stack[4],</span><span>
</span><span id="line-1784"></span><span class="hs-comment">-- the tag in stack[5], the stack will have depth 6, and p must map v</span><span>
</span><span id="line-1785"></span><span class="hs-comment">-- to 5 and not to 4.  Stack locations are numbered from zero, so a</span><span>
</span><span id="line-1786"></span><span class="hs-comment">-- depth 6 stack has valid words 0 .. 5.</span><span>
</span><span id="line-1787"></span><span>
</span><span id="line-1788"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-type">pushAtom</span></a></span><span>
</span><span id="line-1789"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1790"></span><span>
</span><span id="line-1791"></span><span class="hs-comment">-- See Note [Empty case alternatives] in GHC.Core</span><span>
</span><span id="line-1792"></span><span class="hs-comment">-- and Note [Bottoming expressions] in GHC.Core.Utils:</span><span>
</span><span id="line-1793"></span><span class="hs-comment">-- The scrutinee of an empty case evaluates to bottom</span><span>
</span><span id="line-1794"></span><span id="pushAtom"><span class="annot"><span class="annottext">pushAtom :: ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var hs-var">pushAtom</span></a></span></span><span> </span><span id="local-6989586621681282982"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282982"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681282981"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282981"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681282980"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1795"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1796"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1797"></span><span>
</span><span id="line-1798"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isFCallId"><span class="hs-identifier hs-var">isFCallId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1799"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pushAtom: shouldn't get an FCallId here&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1800"></span><span>
</span><span id="line-1801"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681282977"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621681282977"><span class="hs-identifier hs-var">primop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe PrimOp
</span><a href="GHC.Types.Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1802"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1803"></span><span>       </span><span id="local-6989586621681282975"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282975"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1804"></span><span>       </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_PRIMOP"><span class="hs-identifier hs-var">PUSH_PRIMOP</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621681282977"><span class="hs-identifier hs-var">primop</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282975"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1805"></span><span>
</span><span id="line-1806"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681282973"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282973"><span class="hs-identifier hs-var">d_v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var">lookupBCEnv_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282981"><span class="hs-identifier hs-var">p</span></a></span><span>  </span><span class="hs-comment">-- var is a local variable</span><span>
</span><span id="line-1807"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681282972"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282972"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1808"></span><span>
</span><span id="line-1809"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282971"><span class="annot"><span class="annottext">szb :: ByteOff
</span><a href="#local-6989586621681282971"><span class="hs-identifier hs-var hs-var">szb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var">idSizeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282972"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1810"></span><span>            </span><span id="local-6989586621681282969"><span class="annot"><span class="annottext">with_instr :: (Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282969"><span class="hs-identifier hs-var hs-var">with_instr</span></a></span></span><span> </span><span id="local-6989586621681282968"><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="#local-6989586621681282968"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1811"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282967"><span class="annot"><span class="annottext">off_b :: Word16
</span><a href="#local-6989586621681282967"><span class="hs-identifier hs-var hs-var">off_b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16B"><span class="hs-identifier hs-var">trunc16B</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282982"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282973"><span class="hs-identifier hs-var">d_v</span></a></span><span>
</span><span id="line-1812"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="#local-6989586621681282968"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282967"><span class="hs-identifier hs-var">off_b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordSize"><span class="hs-identifier hs-var">wordSize</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282972"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282971"><span class="hs-identifier hs-var">szb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1815"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282969"><span class="hs-identifier hs-var">with_instr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH8_W"><span class="hs-identifier hs-var">PUSH8_W</span></a></span><span>
</span><span id="line-1816"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282969"><span class="hs-identifier hs-var">with_instr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH16_W"><span class="hs-identifier hs-var">PUSH16_W</span></a></span><span>
</span><span id="line-1817"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282969"><span class="hs-identifier hs-var">with_instr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH32_W"><span class="hs-identifier hs-var">PUSH32_W</span></a></span><span>
</span><span id="line-1818"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1819"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282963"><span class="annot"><span class="annottext">szw :: WordOff
</span><a href="#local-6989586621681282963"><span class="hs-identifier hs-var hs-var">szw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282972"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282971"><span class="hs-identifier hs-var">szb</span></a></span><span>
</span><span id="line-1820"></span><span>                    </span><span class="hs-glyph">!</span><span id="local-6989586621681282962"><span class="annot"><span class="annottext">off_w :: Word16
</span><a href="#local-6989586621681282962"><span class="hs-identifier hs-var hs-var">off_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282972"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282982"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282973"><span class="hs-identifier hs-var">d_v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282963"><span class="hs-identifier hs-var">szw</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1821"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#toOL"><span class="hs-identifier hs-var">toOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall i a. Integral i =&gt; i -&gt; a -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#genericReplicate"><span class="hs-identifier hs-var">genericReplicate</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282963"><span class="hs-identifier hs-var">szw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_L"><span class="hs-identifier hs-var">PUSH_L</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282962"><span class="hs-identifier hs-var">off_w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1822"></span><span>                              </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282972"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282963"><span class="hs-identifier hs-var">szw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1823"></span><span>        </span><span class="hs-comment">-- d - d_v           offset from TOS to the first slot of the object</span><span>
</span><span id="line-1824"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1825"></span><span>        </span><span class="hs-comment">-- d - d_v + sz - 1  offset from the TOS of the last slot of the object</span><span>
</span><span id="line-1826"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1827"></span><span>        </span><span class="hs-comment">-- Having found the last slot, we proceed to copy the right number of</span><span>
</span><span id="line-1828"></span><span>        </span><span class="hs-comment">-- slots on to the top of the stack.</span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-comment">-- var must be a global variable</span><span>
</span><span id="line-1831"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681282961"><span class="annot"><span class="annottext">IdEnv (RemotePtr ())
</span><a href="#local-6989586621681282961"><span class="hs-identifier hs-var">topStrings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM (IdEnv (RemotePtr ()))
</span><a href="GHC.StgToByteCode.html#getTopStrings"><span class="hs-identifier hs-var">getTopStrings</span></a></span><span>
</span><span id="line-1832"></span><span>        </span><span id="local-6989586621681282959"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282959"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1833"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; Id -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv (RemotePtr ())
</span><a href="#local-6989586621681282961"><span class="hs-identifier hs-var">topStrings</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1834"></span><span>            </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681282957"><span class="annot"><span class="annottext">RemotePtr ()
</span><a href="#local-6989586621681282957"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282982"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282981"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitWord"><span class="hs-identifier hs-var">mkLitWord</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282959"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1835"></span><span>              </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; WordPtr
</span><a href="../../base-4.16.3.0/src/Foreign-Ptr.html#ptrToWordPtr"><span class="hs-identifier hs-var">ptrToWordPtr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. RemotePtr a -&gt; Ptr a
</span><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#fromRemotePtr"><span class="hs-identifier hs-var">fromRemotePtr</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr ()
</span><a href="#local-6989586621681282957"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-1836"></span><span>            </span><span class="annot"><span class="annottext">Maybe (RemotePtr ())
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1837"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681282954"><span class="annot"><span class="annottext">sz :: ByteOff
</span><a href="#local-6989586621681282954"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var">idSizeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282959"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-1838"></span><span>                </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">sz</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">wordSize</span><span> </span><span class="hs-identifier">platform</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1839"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_G"><span class="hs-identifier hs-var">PUSH_G</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282980"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282954"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1840"></span><span>
</span><span id="line-1841"></span><span>
</span><span id="line-1842"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621681282953"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282953"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Literal -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-var">pushLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282953"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1843"></span><span>
</span><span id="line-1844"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-type">pushLiteral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1845"></span><span id="pushLiteral"><span class="annot"><span class="annottext">pushLiteral :: Bool -&gt; Literal -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-var hs-var">pushLiteral</span></a></span></span><span> </span><span id="local-6989586621681282951"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681282951"><span class="hs-identifier hs-var">padded</span></a></span></span><span> </span><span id="local-6989586621681282950"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282950"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1846"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1847"></span><span>     </span><span id="local-6989586621681282949"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282949"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1848"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681282948"><span class="hs-identifier hs-type">code</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>         </span><span id="local-6989586621681282948"><span class="annot"><span class="annottext">code :: PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span id="local-6989586621681282947"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681282947"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1850"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282946"><span class="hs-identifier hs-var">padding_instr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#snocOL"><span class="hs-operator hs-var">`snocOL`</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="#local-6989586621681282945"><span class="hs-identifier hs-var">instr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282944"><span class="hs-identifier hs-var">size_bytes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282943"><span class="hs-identifier hs-var">padding_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1851"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1852"></span><span>            </span><span id="local-6989586621681282944"><span class="annot"><span class="annottext">size_bytes :: ByteOff
</span><a href="#local-6989586621681282944"><span class="hs-identifier hs-var hs-var">size_bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; Int
</span><a href="GHC.Core.TyCon.html#primRepSizeB"><span class="hs-identifier hs-var">primRepSizeB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282949"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681282947"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1853"></span><span>
</span><span id="line-1854"></span><span>            </span><span class="hs-comment">-- Here we handle the non-word-width cases specifically since we</span><span>
</span><span id="line-1855"></span><span>            </span><span class="hs-comment">-- must emit different bytecode for them.</span><span>
</span><span id="line-1856"></span><span>
</span><span id="line-1857"></span><span>            </span><span id="local-6989586621681282941"><span class="annot"><span class="annottext">round_to_words :: ByteOff -&gt; ByteOff
</span><a href="#local-6989586621681282941"><span class="hs-identifier hs-var hs-var">round_to_words</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span id="local-6989586621681282940"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282940"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1858"></span><span>              </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Int -&gt; Int
</span><a href="GHC.Runtime.Heap.Layout.html#roundUpToWords"><span class="hs-identifier hs-var">roundUpToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282949"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282940"><span class="hs-identifier hs-var">bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1859"></span><span>
</span><span id="line-1860"></span><span>            </span><span id="local-6989586621681282943"><span class="annot"><span class="annottext">padding_bytes :: ByteOff
</span><a href="#local-6989586621681282943"><span class="hs-identifier hs-var hs-var">padding_bytes</span></a></span></span><span>
</span><span id="line-1861"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681282951"><span class="hs-identifier hs-var">padded</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; ByteOff
</span><a href="#local-6989586621681282941"><span class="hs-identifier hs-var">round_to_words</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282944"><span class="hs-identifier hs-var">size_bytes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282944"><span class="hs-identifier hs-var">size_bytes</span></a></span><span>
</span><span id="line-1862"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1863"></span><span>
</span><span id="line-1864"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681282946"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282946"><span class="hs-identifier hs-var">padding_instr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-var">pushPadding</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282943"><span class="hs-identifier hs-var">padding_bytes</span></a></span><span>
</span><span id="line-1865"></span><span>
</span><span id="line-1866"></span><span>            </span><span id="local-6989586621681282945"><span class="annot"><span class="annottext">instr :: BCInstr
</span><a href="#local-6989586621681282945"><span class="hs-identifier hs-var hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1867"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282944"><span class="hs-identifier hs-var">size_bytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1868"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">1</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX8"><span class="hs-identifier hs-var">PUSH_UBX8</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282950"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1869"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX16"><span class="hs-identifier hs-var">PUSH_UBX16</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282950"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1870"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX32"><span class="hs-identifier hs-var">PUSH_UBX32</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282950"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1871"></span><span>                </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_UBX"><span class="hs-identifier hs-var">PUSH_UBX</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282950"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282949"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282944"><span class="hs-identifier hs-var">size_bytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1872"></span><span>
</span><span id="line-1873"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282950"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1874"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-type">LitLabel</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>
</span><span id="line-1875"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitFloat"><span class="hs-identifier hs-type">LitFloat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#FloatRep"><span class="hs-identifier hs-var">FloatRep</span></a></span><span>
</span><span id="line-1876"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitDouble"><span class="hs-identifier hs-type">LitDouble</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#DoubleRep"><span class="hs-identifier hs-var">DoubleRep</span></a></span><span>
</span><span id="line-1877"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitChar"><span class="hs-identifier hs-type">LitChar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>
</span><span id="line-1878"></span><span>        </span><span class="annot"><span class="annottext">Literal
</span><a href="GHC.Types.Literal.html#LitNullAddr"><span class="hs-identifier hs-var">LitNullAddr</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>
</span><span id="line-1879"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitString"><span class="hs-identifier hs-type">LitString</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#AddrRep"><span class="hs-identifier hs-var">AddrRep</span></a></span><span>
</span><span id="line-1880"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitRubbish"><span class="hs-identifier hs-type">LitRubbish</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>
</span><span id="line-1881"></span><span>        </span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span id="local-6989586621681282933"><span class="annot"><span class="annottext">LitNumType
</span><a href="#local-6989586621681282933"><span class="hs-identifier hs-var">nt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="#local-6989586621681282933"><span class="hs-identifier hs-var">nt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1882"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#IntRep"><span class="hs-identifier hs-var">IntRep</span></a></span><span>
</span><span id="line-1883"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#WordRep"><span class="hs-identifier hs-var">WordRep</span></a></span><span>
</span><span id="line-1884"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt8"><span class="hs-identifier hs-var">LitNumInt8</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int8Rep"><span class="hs-identifier hs-var">Int8Rep</span></a></span><span>
</span><span id="line-1885"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord8"><span class="hs-identifier hs-var">LitNumWord8</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word8Rep"><span class="hs-identifier hs-var">Word8Rep</span></a></span><span>
</span><span id="line-1886"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt16"><span class="hs-identifier hs-var">LitNumInt16</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int16Rep"><span class="hs-identifier hs-var">Int16Rep</span></a></span><span>
</span><span id="line-1887"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord16"><span class="hs-identifier hs-var">LitNumWord16</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word16Rep"><span class="hs-identifier hs-var">Word16Rep</span></a></span><span>
</span><span id="line-1888"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt32"><span class="hs-identifier hs-var">LitNumInt32</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int32Rep"><span class="hs-identifier hs-var">Int32Rep</span></a></span><span>
</span><span id="line-1889"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord32"><span class="hs-identifier hs-var">LitNumWord32</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word32Rep"><span class="hs-identifier hs-var">Word32Rep</span></a></span><span>
</span><span id="line-1890"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInt64"><span class="hs-identifier hs-var">LitNumInt64</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Int64Rep"><span class="hs-identifier hs-var">Int64Rep</span></a></span><span>
</span><span id="line-1891"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumWord64"><span class="hs-identifier hs-var">LitNumWord64</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282948"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="GHC.Core.TyCon.html#Word64Rep"><span class="hs-identifier hs-var">Word64Rep</span></a></span><span>
</span><span id="line-1892"></span><span>          </span><span class="hs-comment">-- No LitInteger's or LitNatural's should be left by the time this is</span><span>
</span><span id="line-1893"></span><span>          </span><span class="hs-comment">-- called. CorePrep should have converted them all to a real core</span><span>
</span><span id="line-1894"></span><span>          </span><span class="hs-comment">-- representation.</span><span>
</span><span id="line-1895"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pushAtom: LitInteger&quot;</span></span><span>
</span><span id="line-1896"></span><span>          </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pushAtom: LitNatural&quot;</span></span><span>
</span><span id="line-1897"></span><span>
</span><span id="line-1898"></span><span class="hs-comment">-- | Push an atom for constructor (i.e., PACK instruction) onto the stack.</span><span>
</span><span id="line-1899"></span><span class="hs-comment">-- This is slightly different to @pushAtom@ due to the fact that we allow</span><span>
</span><span id="line-1900"></span><span class="hs-comment">-- packing constructor fields. See also @mkConAppCode@ and @pushPadding@.</span><span>
</span><span id="line-1901"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-type">pushConstrAtom</span></a></span><span>
</span><span id="line-1902"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#StackDepth"><span class="hs-identifier hs-type">StackDepth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1903"></span><span id="pushConstrAtom"><span class="annot"><span class="annottext">pushConstrAtom :: ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var hs-var">pushConstrAtom</span></a></span></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621681282922"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282922"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Literal -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushLiteral"><span class="hs-identifier hs-var">pushLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282922"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-1904"></span><span>
</span><span id="line-1905"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var">pushConstrAtom</span></a></span><span> </span><span id="local-6989586621681282921"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282921"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681282920"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282920"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681282919"><span class="annot"><span class="annottext">va :: StgArg
</span><a href="#local-6989586621681282919"><span class="hs-identifier hs-var">va</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681282918"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282918"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1906"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681282917"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282917"><span class="hs-identifier hs-var">d_v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var">lookupBCEnv_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282918"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282920"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- v is a local variable</span><span>
</span><span id="line-1907"></span><span>        </span><span id="local-6989586621681282916"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282916"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1908"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282915"><span class="annot"><span class="annottext">szb :: ByteOff
</span><a href="#local-6989586621681282915"><span class="hs-identifier hs-var hs-var">szb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var">idSizeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282916"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282918"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1909"></span><span>            </span><span id="local-6989586621681282914"><span class="annot"><span class="annottext">done :: (Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282914"><span class="hs-identifier hs-var hs-var">done</span></a></span></span><span> </span><span id="local-6989586621681282913"><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="#local-6989586621681282913"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1910"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282912"><span class="annot"><span class="annottext">off :: Word16
</span><a href="#local-6989586621681282912"><span class="hs-identifier hs-var hs-var">off</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16B"><span class="hs-identifier hs-var">trunc16B</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282921"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282917"><span class="hs-identifier hs-var">d_v</span></a></span><span>
</span><span id="line-1911"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="#local-6989586621681282913"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282912"><span class="hs-identifier hs-var">off</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282915"><span class="hs-identifier hs-var">szb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1912"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282915"><span class="hs-identifier hs-var">szb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1913"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282914"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH8"><span class="hs-identifier hs-var">PUSH8</span></a></span><span>
</span><span id="line-1914"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282914"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH16"><span class="hs-identifier hs-var">PUSH16</span></a></span><span>
</span><span id="line-1915"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; BCInstr) -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="#local-6989586621681282914"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH32"><span class="hs-identifier hs-var">PUSH32</span></a></span><span>
</span><span id="line-1916"></span><span>            </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282921"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282920"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681282919"><span class="hs-identifier hs-var">va</span></a></span><span>
</span><span id="line-1917"></span><span>
</span><span id="line-1918"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushConstrAtom"><span class="hs-identifier hs-var">pushConstrAtom</span></a></span><span> </span><span id="local-6989586621681282908"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282908"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681282907"><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282907"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681282906"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681282906"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteOff
-&gt; Map Id ByteOff -&gt; StgArg -&gt; BcM (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushAtom"><span class="hs-identifier hs-var">pushAtom</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282908"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id ByteOff
</span><a href="#local-6989586621681282907"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681282906"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1919"></span><span>
</span><span id="line-1920"></span><span class="annot"><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-type">pushPadding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1921"></span><span id="pushPadding"><span class="annot"><span class="annottext">pushPadding :: ByteOff -&gt; (OrdList BCInstr, ByteOff)
</span><a href="GHC.StgToByteCode.html#pushPadding"><span class="hs-identifier hs-var hs-var">pushPadding</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span id="local-6989586621681282905"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282905"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {t} {b}.
(Eq t, Num t, Num b) =&gt;
t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621681282904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282905"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1922"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1923"></span><span>    </span><span id="local-6989586621681282904"><span class="annot"><span class="annottext">go :: t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621681282904"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681282876"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681282876"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681282875"><span class="annot"><span class="annottext">acc :: (OrdList BCInstr, b)
</span><a href="#local-6989586621681282875"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681282874"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282874"><span class="hs-identifier hs-var">instrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282873"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282873"><span class="hs-identifier hs-var">off</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681282876"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1924"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, b)
</span><a href="#local-6989586621681282875"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1925"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282874"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mappend"><span class="hs-operator hs-var">`mappend`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_PAD8"><span class="hs-identifier hs-var">PUSH_PAD8</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282873"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1926"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282874"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mappend"><span class="hs-operator hs-var">`mappend`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_PAD16"><span class="hs-identifier hs-var">PUSH_PAD16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282873"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-1927"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621681282904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621681282904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, b)
</span><a href="#local-6989586621681282875"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282874"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mappend"><span class="hs-operator hs-var">`mappend`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#PUSH_PAD32"><span class="hs-identifier hs-var">PUSH_PAD32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282873"><span class="hs-identifier hs-var">off</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>
</span><span id="line-1929"></span><span>        </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621681282904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681282876"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; (OrdList BCInstr, b) -&gt; (OrdList BCInstr, b)
</span><a href="#local-6989586621681282904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(OrdList BCInstr, b)
</span><a href="#local-6989586621681282875"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1930"></span><span>
</span><span id="line-1931"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1932"></span><span class="hs-comment">-- Given a bunch of alts code and their discrs, do the donkey work</span><span>
</span><span id="line-1933"></span><span class="hs-comment">-- of making a multiway branch using a switch tree.</span><span>
</span><span id="line-1934"></span><span class="hs-comment">-- What a load of hassle!</span><span>
</span><span id="line-1935"></span><span>
</span><span id="line-1936"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkMultiBranch"><span class="hs-identifier hs-type">mkMultiBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>      </span><span class="hs-comment">-- # datacons in tycon, if alg alt</span><span>
</span><span id="line-1937"></span><span>                                </span><span class="hs-comment">-- a hint; generates better code</span><span>
</span><span id="line-1938"></span><span>                                </span><span class="hs-comment">-- Nothing is always safe</span><span>
</span><span id="line-1939"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1940"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-1941"></span><span id="mkMultiBranch"><span class="annot"><span class="annottext">mkMultiBranch :: Maybe Int -&gt; [(Discr, OrdList BCInstr)] -&gt; BcM (OrdList BCInstr)
</span><a href="GHC.StgToByteCode.html#mkMultiBranch"><span class="hs-identifier hs-var hs-var">mkMultiBranch</span></a></span></span><span> </span><span id="local-6989586621681282869"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621681282869"><span class="hs-identifier hs-var">maybe_ncons</span></a></span></span><span> </span><span id="local-6989586621681282868"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282868"><span class="hs-identifier hs-var">raw_ways</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1942"></span><span>     </span><span id="local-6989586621681282867"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282867"><span class="hs-identifier hs-var">lbl_default</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-1943"></span><span>
</span><span id="line-1944"></span><span>     </span><span class="hs-keyword">let</span><span>
</span><span id="line-1945"></span><span>         </span><span class="annot"><a href="#local-6989586621681282866"><span class="hs-identifier hs-type">mkTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCInstrList"><span class="hs-identifier hs-type">BCInstrList</span></a></span><span>
</span><span id="line-1946"></span><span>         </span><span id="local-6989586621681282866"><span class="annot"><span class="annottext">mkTree :: [(Discr, OrdList BCInstr)]
-&gt; Discr -&gt; Discr -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681282866"><span class="hs-identifier hs-var hs-var">mkTree</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681282865"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282865"><span class="hs-identifier hs-var">_range_lo</span></a></span></span><span> </span><span id="local-6989586621681282864"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282864"><span class="hs-identifier hs-var">_range_hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282867"><span class="hs-identifier hs-var">lbl_default</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1947"></span><span>             </span><span class="hs-comment">-- shouldn't happen?</span><span>
</span><span id="line-1948"></span><span>
</span><span id="line-1949"></span><span>         </span><span class="annot"><a href="#local-6989586621681282866"><span class="hs-identifier hs-var">mkTree</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681282863"><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621681282863"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621681282862"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282862"><span class="hs-identifier hs-var">range_lo</span></a></span></span><span> </span><span id="local-6989586621681282861"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282861"><span class="hs-identifier hs-var">range_hi</span></a></span></span><span>
</span><span id="line-1950"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282862"><span class="hs-identifier hs-var">range_lo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282861"><span class="hs-identifier hs-var">range_hi</span></a></span><span>
</span><span id="line-1951"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621681282863"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1952"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282860"><span class="hs-identifier hs-var">defaults</span></a></span><span> </span><span class="hs-comment">-- Note [CASEFAIL]</span><span>
</span><span id="line-1953"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681282859"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282859"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-1954"></span><span>                 </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621681282858"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621681282863"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282859"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-1955"></span><span>                            </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621681282863"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-1956"></span><span>                            </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282859"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="annot"><span class="annottext">BCInstr
</span><a href="GHC.ByteCode.Instr.html#CASEFAIL"><span class="hs-identifier hs-var">CASEFAIL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1957"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1958"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621681282858"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621681282863"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282867"><span class="hs-identifier hs-var">lbl_default</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(Discr, OrdList BCInstr)
</span><a href="#local-6989586621681282863"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1959"></span><span>
</span><span id="line-1960"></span><span>            </span><span class="hs-comment">-- Note [CASEFAIL] It may be that this case has no default</span><span>
</span><span id="line-1961"></span><span>            </span><span class="hs-comment">-- branch, but the alternatives are not exhaustive - this</span><span>
</span><span id="line-1962"></span><span>            </span><span class="hs-comment">-- happens for GADT cases for example, where the types</span><span>
</span><span id="line-1963"></span><span>            </span><span class="hs-comment">-- prove that certain branches are impossible.  We could</span><span>
</span><span id="line-1964"></span><span>            </span><span class="hs-comment">-- just assume that the other cases won't occur, but if</span><span>
</span><span id="line-1965"></span><span>            </span><span class="hs-comment">-- this assumption was wrong (because of a bug in GHC)</span><span>
</span><span id="line-1966"></span><span>            </span><span class="hs-comment">-- then the result would be a segfault.  So instead we</span><span>
</span><span id="line-1967"></span><span>            </span><span class="hs-comment">-- emit an explicit test and a CASEFAIL instruction that</span><span>
</span><span id="line-1968"></span><span>            </span><span class="hs-comment">-- causes the interpreter to barf() if it is ever</span><span>
</span><span id="line-1969"></span><span>            </span><span class="hs-comment">-- executed.</span><span>
</span><span id="line-1970"></span><span>
</span><span id="line-1971"></span><span>         </span><span class="annot"><a href="#local-6989586621681282866"><span class="hs-identifier hs-var">mkTree</span></a></span><span> </span><span id="local-6989586621681282857"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282857"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span id="local-6989586621681282856"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282856"><span class="hs-identifier hs-var">range_lo</span></a></span></span><span> </span><span id="local-6989586621681282855"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282855"><span class="hs-identifier hs-var">range_hi</span></a></span></span><span>
</span><span id="line-1972"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681282854"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621681282854"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282857"><span class="hs-identifier hs-var">vals</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1973"></span><span>                  </span><span id="local-6989586621681282852"><span class="annot"><span class="annottext">vals_lo :: [(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282852"><span class="hs-identifier hs-var hs-var">vals_lo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282854"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282857"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-1974"></span><span>                  </span><span id="local-6989586621681282851"><span class="annot"><span class="annottext">vals_hi :: [(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282851"><span class="hs-identifier hs-var hs-var">vals_hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282854"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282857"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-1975"></span><span>                  </span><span id="local-6989586621681282849"><span class="annot"><span class="annottext">v_mid :: Discr
</span><a href="#local-6989586621681282849"><span class="hs-identifier hs-var hs-var">v_mid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282851"><span class="hs-identifier hs-var">vals_hi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1976"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1977"></span><span>              </span><span id="local-6989586621681282848"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282848"><span class="hs-identifier hs-var">label_geq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var">getLabelBc</span></a></span><span>
</span><span id="line-1978"></span><span>              </span><span id="local-6989586621681282847"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282847"><span class="hs-identifier hs-var">code_lo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
-&gt; Discr -&gt; Discr -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681282866"><span class="hs-identifier hs-var">mkTree</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282852"><span class="hs-identifier hs-var">vals_lo</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282856"><span class="hs-identifier hs-var">range_lo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr -&gt; Discr
</span><a href="#local-6989586621681282846"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282849"><span class="hs-identifier hs-var">v_mid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1979"></span><span>              </span><span id="local-6989586621681282845"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282845"><span class="hs-identifier hs-var">code_hi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
-&gt; Discr -&gt; Discr -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681282866"><span class="hs-identifier hs-var">mkTree</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282851"><span class="hs-identifier hs-var">vals_hi</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282849"><span class="hs-identifier hs-var">v_mid</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282855"><span class="hs-identifier hs-var">range_hi</span></a></span><span>
</span><span id="line-1980"></span><span>              </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621681282844"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282849"><span class="hs-identifier hs-var">v_mid</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282848"><span class="hs-identifier hs-var">label_geq</span></a></span><span>
</span><span id="line-1981"></span><span>                      </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282847"><span class="hs-identifier hs-var">code_lo</span></a></span><span>
</span><span id="line-1982"></span><span>                      </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>   </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282848"><span class="hs-identifier hs-var">label_geq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1983"></span><span>                      </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span>   </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282845"><span class="hs-identifier hs-var">code_hi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1984"></span><span>
</span><span id="line-1985"></span><span>         </span><span id="local-6989586621681282843"><span class="annot"><span class="annottext">the_default :: OrdList BCInstr
</span><a href="#local-6989586621681282843"><span class="hs-identifier hs-var hs-var">the_default</span></a></span></span><span>
</span><span id="line-1986"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282860"><span class="hs-identifier hs-var">defaults</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1987"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-1988"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282842"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282842"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#LABEL"><span class="hs-identifier hs-var">LABEL</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282867"><span class="hs-identifier hs-var">lbl_default</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282842"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1989"></span><span>                </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch/the_default&quot;</span></span><span>
</span><span id="line-1990"></span><span>     </span><span id="local-6989586621681282841"><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282841"><span class="hs-identifier hs-var">instrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
-&gt; Discr -&gt; Discr -&gt; BcM (OrdList BCInstr)
</span><a href="#local-6989586621681282866"><span class="hs-identifier hs-var">mkTree</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282840"><span class="hs-identifier hs-var">notd_ways</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282839"><span class="hs-identifier hs-var">init_lo</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282838"><span class="hs-identifier hs-var">init_hi</span></a></span><span>
</span><span id="line-1991"></span><span>     </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282841"><span class="hs-identifier hs-var">instrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#appOL"><span class="hs-operator hs-var">`appOL`</span></a></span><span> </span><span class="annot"><span class="annottext">OrdList BCInstr
</span><a href="#local-6989586621681282843"><span class="hs-identifier hs-var">the_default</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1992"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1993"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681282860"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282860"><span class="hs-identifier hs-var">defaults</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282837"><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282837"><span class="hs-identifier hs-var">not_defaults</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Discr -&gt; Bool
</span><a href="#local-6989586621681282836"><span class="hs-identifier hs-var">isNoDiscr</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282868"><span class="hs-identifier hs-var">raw_ways</span></a></span><span>
</span><span id="line-1994"></span><span>         </span><span id="local-6989586621681282840"><span class="annot"><span class="annottext">notd_ways :: [(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282840"><span class="hs-identifier hs-var hs-var">notd_ways</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><a href="../../base-4.16.3.0/src/Data-Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282837"><span class="hs-identifier hs-var">not_defaults</span></a></span><span>
</span><span id="line-1995"></span><span>
</span><span id="line-1996"></span><span>         </span><span id="local-6989586621681282844"><span class="annot"><span class="annottext">testLT :: Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621681282844"><span class="hs-identifier hs-var hs-var">testLT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621681282835"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282835"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282834"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282834"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_I"><span class="hs-identifier hs-var">TESTLT_I</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282835"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282834"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-1997"></span><span>         </span><span class="annot"><a href="#local-6989586621681282844"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621681282832"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282832"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282831"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282831"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_W"><span class="hs-identifier hs-var">TESTLT_W</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282832"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282831"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-1998"></span><span>         </span><span class="annot"><a href="#local-6989586621681282844"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span id="local-6989586621681282829"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282829"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282828"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282828"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_F"><span class="hs-identifier hs-var">TESTLT_F</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282829"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282828"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-1999"></span><span>         </span><span class="annot"><a href="#local-6989586621681282844"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span id="local-6989586621681282826"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282826"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282825"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282825"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_D"><span class="hs-identifier hs-var">TESTLT_D</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282826"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282825"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2000"></span><span>         </span><span class="annot"><a href="#local-6989586621681282844"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621681282823"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282823"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282822"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282822"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTLT_P"><span class="hs-identifier hs-var">TESTLT_P</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282823"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282822"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2001"></span><span>         </span><span class="annot"><a href="#local-6989586621681282844"><span class="hs-identifier hs-var">testLT</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>    </span><span class="annot"><span class="annottext">LocalLabel
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch NoDiscr&quot;</span></span><span>
</span><span id="line-2002"></span><span>
</span><span id="line-2003"></span><span>         </span><span id="local-6989586621681282858"><span class="annot"><span class="annottext">testEQ :: Discr -&gt; LocalLabel -&gt; BCInstr
</span><a href="#local-6989586621681282858"><span class="hs-identifier hs-var hs-var">testEQ</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621681282820"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282820"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282819"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282819"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_I"><span class="hs-identifier hs-var">TESTEQ_I</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282820"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282819"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2004"></span><span>         </span><span class="annot"><a href="#local-6989586621681282858"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621681282818"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282818"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282817"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282817"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_W"><span class="hs-identifier hs-var">TESTEQ_W</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282818"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282817"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2005"></span><span>         </span><span class="annot"><a href="#local-6989586621681282858"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span id="local-6989586621681282815"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282815"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282814"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282814"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_F"><span class="hs-identifier hs-var">TESTEQ_F</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282815"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282814"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2006"></span><span>         </span><span class="annot"><a href="#local-6989586621681282858"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span id="local-6989586621681282812"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282812"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282811"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282811"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_D"><span class="hs-identifier hs-var">TESTEQ_D</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282812"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282811"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2007"></span><span>         </span><span class="annot"><a href="#local-6989586621681282858"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621681282809"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282809"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282808"><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282808"><span class="hs-identifier hs-var">fail_label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; LocalLabel -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#TESTEQ_P"><span class="hs-identifier hs-var">TESTEQ_P</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282809"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LocalLabel
</span><a href="#local-6989586621681282808"><span class="hs-identifier hs-var">fail_label</span></a></span><span>
</span><span id="line-2008"></span><span>         </span><span class="annot"><a href="#local-6989586621681282858"><span class="hs-identifier hs-var">testEQ</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>    </span><span class="annot"><span class="annottext">LocalLabel
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch NoDiscr&quot;</span></span><span>
</span><span id="line-2009"></span><span>
</span><span id="line-2010"></span><span>         </span><span class="hs-comment">-- None of these will be needed if there are no non-default alts</span><span>
</span><span id="line-2011"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681282839"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282839"><span class="hs-identifier hs-var">init_lo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282838"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282838"><span class="hs-identifier hs-var">init_hi</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2012"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282840"><span class="hs-identifier hs-var">notd_ways</span></a></span><span>
</span><span id="line-2013"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch: awesome foursome&quot;</span></span><span>
</span><span id="line-2014"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2015"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(Discr, OrdList BCInstr)]
</span><a href="#local-6989586621681282840"><span class="hs-identifier hs-var">notd_ways</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2016"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#minBound"><span class="hs-identifier hs-var">minBound</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2017"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#minBound"><span class="hs-identifier hs-var">minBound</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2018"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282805"><span class="hs-identifier hs-var">minF</span></a></span><span class="hs-special">,</span><span>      </span><span class="annot"><span class="annottext">Float -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282804"><span class="hs-identifier hs-var">maxF</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2019"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282803"><span class="hs-identifier hs-var">minD</span></a></span><span class="hs-special">,</span><span>      </span><span class="annot"><span class="annottext">Double -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282802"><span class="hs-identifier hs-var">maxD</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2020"></span><span>                </span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282801"><span class="hs-identifier hs-var">algMinBound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282800"><span class="hs-identifier hs-var">algMaxBound</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2021"></span><span>                </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkMultiBranch NoDiscr&quot;</span></span><span>
</span><span id="line-2022"></span><span>
</span><span id="line-2023"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681282801"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282801"><span class="hs-identifier hs-var">algMinBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282800"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282800"><span class="hs-identifier hs-var">algMaxBound</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2024"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621681282869"><span class="hs-identifier hs-var">maybe_ncons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2025"></span><span>                 </span><span class="hs-comment">-- XXX What happens when n == 0?</span><span>
</span><span id="line-2026"></span><span>                 </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681282799"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282799"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282799"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2027"></span><span>                 </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#minBound"><span class="hs-identifier hs-var">minBound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2028"></span><span>
</span><span id="line-2029"></span><span>         </span><span id="local-6989586621681282836"><span class="annot"><span class="annottext">isNoDiscr :: Discr -&gt; Bool
</span><a href="#local-6989586621681282836"><span class="hs-identifier hs-var hs-var">isNoDiscr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2030"></span><span>         </span><span class="annot"><a href="#local-6989586621681282836"><span class="hs-identifier hs-var">isNoDiscr</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2031"></span><span>
</span><span id="line-2032"></span><span>         </span><span id="local-6989586621681282846"><span class="annot"><span class="annottext">dec :: Discr -&gt; Discr
</span><a href="#local-6989586621681282846"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621681282792"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282792"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282792"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2033"></span><span>         </span><span class="annot"><a href="#local-6989586621681282846"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621681282791"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282791"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282791"><span class="hs-identifier hs-var">w</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2034"></span><span>         </span><span class="annot"><a href="#local-6989586621681282846"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621681282790"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282790"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Discr
</span><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282790"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2035"></span><span>         </span><span class="annot"><a href="#local-6989586621681282846"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span id="local-6989586621681282789"><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282789"><span class="hs-identifier hs-var">other</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="#local-6989586621681282789"><span class="hs-identifier hs-var">other</span></a></span><span>         </span><span class="hs-comment">-- not really right, but if you</span><span>
</span><span id="line-2036"></span><span>                </span><span class="hs-comment">-- do cases on floating values, you'll get what you deserve</span><span>
</span><span id="line-2037"></span><span>
</span><span id="line-2038"></span><span>         </span><span class="hs-comment">-- same snotty comment applies to the following</span><span>
</span><span id="line-2039"></span><span>         </span><span class="annot"><a href="#local-6989586621681282805"><span class="hs-identifier hs-type">minF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681282804"><span class="hs-identifier hs-type">maxF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-2040"></span><span>         </span><span class="annot"><a href="#local-6989586621681282803"><span class="hs-identifier hs-type">minD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681282802"><span class="hs-identifier hs-type">maxD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-2041"></span><span>         </span><span id="local-6989586621681282805"><span class="annot"><span class="annottext">minF :: Float
</span><a href="#local-6989586621681282805"><span class="hs-identifier hs-var hs-var">minF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1.0e37</span></span><span>
</span><span id="line-2042"></span><span>         </span><span id="local-6989586621681282804"><span class="annot"><span class="annottext">maxF :: Float
</span><a href="#local-6989586621681282804"><span class="hs-identifier hs-var hs-var">maxF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1.0e37</span></span><span>
</span><span id="line-2043"></span><span>         </span><span id="local-6989586621681282803"><span class="annot"><span class="annottext">minD :: Double
</span><a href="#local-6989586621681282803"><span class="hs-identifier hs-var hs-var">minD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0e308</span></span><span>
</span><span id="line-2044"></span><span>         </span><span id="local-6989586621681282802"><span class="annot"><span class="annottext">maxD :: Double
</span><a href="#local-6989586621681282802"><span class="hs-identifier hs-var hs-var">maxD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1.0e308</span></span><span>
</span><span id="line-2045"></span><span>
</span><span id="line-2046"></span><span>
</span><span id="line-2047"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2048"></span><span class="hs-comment">-- Supporting junk for the compilation schemes</span><span>
</span><span id="line-2049"></span><span>
</span><span id="line-2050"></span><span class="hs-comment">-- Describes case alts</span><span>
</span><span id="line-2051"></span><span class="hs-keyword">data</span><span> </span><span id="Discr"><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-var">Discr</span></a></span></span><span>
</span><span id="line-2052"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="DiscrI"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-var">DiscrI</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2053"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrW"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-var">DiscrW</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-2054"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrF"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-var">DiscrF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-2055"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrD"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-var">DiscrD</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-2056"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="DiscrP"><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-var">DiscrP</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-2057"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="NoDiscr"><span class="annot"><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span></span><span>
</span><span id="line-2058"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681282777"><span id="local-6989586621681282787"><span class="annot"><span class="annottext">Discr -&gt; Discr -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Discr -&gt; Discr -&gt; Bool
$c/= :: Discr -&gt; Discr -&gt; Bool
== :: Discr -&gt; Discr -&gt; Bool
$c== :: Discr -&gt; Discr -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282752"><span id="local-6989586621681282754"><span id="local-6989586621681282756"><span id="local-6989586621681282758"><span id="local-6989586621681282760"><span id="local-6989586621681282762"><span id="local-6989586621681282772"><span class="annot"><span class="annottext">Eq Discr
Discr -&gt; Discr -&gt; Bool
Discr -&gt; Discr -&gt; Ordering
Discr -&gt; Discr -&gt; Discr
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Discr -&gt; Discr -&gt; Discr
$cmin :: Discr -&gt; Discr -&gt; Discr
max :: Discr -&gt; Discr -&gt; Discr
$cmax :: Discr -&gt; Discr -&gt; Discr
&gt;= :: Discr -&gt; Discr -&gt; Bool
$c&gt;= :: Discr -&gt; Discr -&gt; Bool
&gt; :: Discr -&gt; Discr -&gt; Bool
$c&gt; :: Discr -&gt; Discr -&gt; Bool
&lt;= :: Discr -&gt; Discr -&gt; Bool
$c&lt;= :: Discr -&gt; Discr -&gt; Bool
&lt; :: Discr -&gt; Discr -&gt; Bool
$c&lt; :: Discr -&gt; Discr -&gt; Bool
compare :: Discr -&gt; Discr -&gt; Ordering
$ccompare :: Discr -&gt; Discr -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-2059"></span><span>
</span><span id="line-2060"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#Discr"><span class="hs-identifier hs-type">Discr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2061"></span><span>   </span><span id="local-6989586621681282739"><span class="annot"><span class="annottext">ppr :: Discr -&gt; SDoc
</span><a href="#local-6989586621681282739"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrI"><span class="hs-identifier hs-type">DiscrI</span></a></span><span> </span><span id="local-6989586621681282738"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282738"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282738"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2062"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrW"><span class="hs-identifier hs-type">DiscrW</span></a></span><span> </span><span id="local-6989586621681282736"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282736"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681282736"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2063"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrF"><span class="hs-identifier hs-type">DiscrF</span></a></span><span> </span><span id="local-6989586621681282735"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282735"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621681282735"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2064"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrD"><span class="hs-identifier hs-type">DiscrD</span></a></span><span> </span><span id="local-6989586621681282734"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282734"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621681282734"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2065"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#DiscrP"><span class="hs-identifier hs-type">DiscrP</span></a></span><span> </span><span id="local-6989586621681282733"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282733"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282733"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2066"></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Discr
</span><a href="GHC.StgToByteCode.html#NoDiscr"><span class="hs-identifier hs-var">NoDiscr</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DEF&quot;</span></span><span>
</span><span id="line-2067"></span><span>
</span><span id="line-2068"></span><span>
</span><span id="line-2069"></span><span class="annot"><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-type">lookupBCEnv_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BCEnv"><span class="hs-identifier hs-type">BCEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-2070"></span><span id="lookupBCEnv_maybe"><span class="annot"><span class="annottext">lookupBCEnv_maybe :: Id -&gt; Map Id ByteOff -&gt; Maybe ByteOff
</span><a href="GHC.StgToByteCode.html#lookupBCEnv_maybe"><span class="hs-identifier hs-var hs-var">lookupBCEnv_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span>
</span><span id="line-2071"></span><span>
</span><span id="line-2072"></span><span class="annot"><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-type">idSizeW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-2073"></span><span id="idSizeW"><span class="annot"><span class="annottext">idSizeW :: Platform -&gt; Id -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#idSizeW"><span class="hs-identifier hs-var hs-var">idSizeW</span></a></span></span><span> </span><span id="local-6989586621681282732"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282732"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282732"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Id -&gt; ArgRep
</span><a href="GHC.StgToByteCode.html#bcIdArgRep"><span class="hs-identifier hs-var">bcIdArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282732"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-2074"></span><span>
</span><span id="line-2075"></span><span class="annot"><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-type">idSizeCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span>
</span><span id="line-2076"></span><span id="idSizeCon"><span class="annot"><span class="annottext">idSizeCon :: Platform -&gt; Id -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#idSizeCon"><span class="hs-identifier hs-var hs-var">idSizeCon</span></a></span></span><span> </span><span id="local-6989586621681282731"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282731"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681282730"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282730"><span class="hs-identifier hs-var">var</span></a></span></span><span>
</span><span id="line-2077"></span><span>  </span><span class="hs-comment">-- unboxed tuple components are padded to word size</span><span>
</span><span id="line-2078"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282730"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-2079"></span><span>    </span><span class="annot"><span class="annottext">Kind -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282730"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2080"></span><span>    </span><span class="annot"><span class="annottext">Platform -&gt; WordOff -&gt; ByteOff
</span><a href="GHC.StgToByteCode.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282731"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-2081"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282731"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282731"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-2082"></span><span>    </span><span class="annot"><span class="annottext">Id -&gt; [PrimRep]
</span><a href="GHC.StgToByteCode.html#bcIdPrimReps"><span class="hs-identifier hs-var">bcIdPrimReps</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282730"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-2083"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteOff
</span><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-var">ByteOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; Int
</span><a href="GHC.Core.TyCon.html#primRepSizeB"><span class="hs-identifier hs-var">primRepSizeB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282731"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-var">bcIdPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282730"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2084"></span><span>
</span><span id="line-2085"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcIdArgRep"><span class="hs-identifier hs-type">bcIdArgRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span>
</span><span id="line-2086"></span><span id="bcIdArgRep"><span class="annot"><span class="annottext">bcIdArgRep :: Platform -&gt; Id -&gt; ArgRep
</span><a href="GHC.StgToByteCode.html#bcIdArgRep"><span class="hs-identifier hs-var hs-var">bcIdArgRep</span></a></span></span><span> </span><span id="local-6989586621681282729"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282729"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282729"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-var">bcIdPrimRep</span></a></span><span>
</span><span id="line-2087"></span><span>
</span><span id="line-2088"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-type">bcIdPrimRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span>
</span><span id="line-2089"></span><span id="bcIdPrimRep"><span class="annot"><span class="annottext">bcIdPrimRep :: Id -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-var hs-var">bcIdPrimRep</span></a></span></span><span> </span><span id="local-6989586621681282728"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282728"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-2090"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681282727"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681282727"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRepArgs"><span class="hs-identifier hs-var">typePrimRepArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282728"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2091"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681282727"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-2092"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2093"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bcIdPrimRep&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282728"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282728"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2094"></span><span>
</span><span id="line-2095"></span><span>
</span><span id="line-2096"></span><span class="annot"><a href="GHC.StgToByteCode.html#bcIdPrimReps"><span class="hs-identifier hs-type">bcIdPrimReps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2097"></span><span id="bcIdPrimReps"><span class="annot"><span class="annottext">bcIdPrimReps :: Id -&gt; [PrimRep]
</span><a href="GHC.StgToByteCode.html#bcIdPrimReps"><span class="hs-identifier hs-var hs-var">bcIdPrimReps</span></a></span></span><span> </span><span id="local-6989586621681282725"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282725"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRepArgs"><span class="hs-identifier hs-var">typePrimRepArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Kind
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282725"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2098"></span><span>
</span><span id="line-2099"></span><span class="annot"><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-type">repSizeWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span>
</span><span id="line-2100"></span><span id="repSizeWords"><span class="annot"><span class="annottext">repSizeWords :: Platform -&gt; PrimRep -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#repSizeWords"><span class="hs-identifier hs-var hs-var">repSizeWords</span></a></span></span><span> </span><span id="local-6989586621681282724"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282724"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681282723"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681282723"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WordOff
</span><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-var">WordOff</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ArgRep -&gt; Int
</span><a href="GHC.StgToCmm.ArgRep.html#argRepSizeW"><span class="hs-identifier hs-var">argRepSizeW</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282724"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282724"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681282723"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2101"></span><span>
</span><span id="line-2102"></span><span class="annot"><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-type">isFollowableArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2103"></span><span id="isFollowableArg"><span class="annot"><span class="annottext">isFollowableArg :: ArgRep -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var hs-var">isFollowableArg</span></a></span></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2104"></span><span class="annot"><a href="GHC.StgToByteCode.html#isFollowableArg"><span class="hs-identifier hs-var">isFollowableArg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgRep
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2105"></span><span>
</span><span id="line-2106"></span><span class="hs-comment">-- | Indicate if the calling convention is supported</span><span>
</span><span id="line-2107"></span><span class="annot"><a href="GHC.StgToByteCode.html#isSupportedCConv"><span class="hs-identifier hs-type">isSupportedCConv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2108"></span><span id="isSupportedCConv"><span class="annot"><span class="annottext">isSupportedCConv :: CCallSpec -&gt; Bool
</span><a href="GHC.StgToByteCode.html#isSupportedCConv"><span class="hs-identifier hs-var hs-var">isSupportedCConv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681282722"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621681282722"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621681282722"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2109"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-var">CCallConv</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>     </span><span class="hs-comment">-- we explicitly pattern match on every</span><span>
</span><span id="line-2110"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#StdCallConv"><span class="hs-identifier hs-var">StdCallConv</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>     </span><span class="hs-comment">-- convention to ensure that a warning</span><span>
</span><span id="line-2111"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#PrimCallConv"><span class="hs-identifier hs-var">PrimCallConv</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>    </span><span class="hs-comment">-- is triggered when a new one is added</span><span>
</span><span id="line-2112"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#JavaScriptCallConv"><span class="hs-identifier hs-var">JavaScriptCallConv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2113"></span><span>   </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CApiConv"><span class="hs-identifier hs-var">CApiConv</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2114"></span><span>
</span><span id="line-2115"></span><span class="hs-comment">-- See bug #10462</span><span>
</span><span id="line-2116"></span><span id="local-6989586621681284914"><span class="annot"><a href="GHC.StgToByteCode.html#unsupportedCConvException"><span class="hs-identifier hs-type">unsupportedCConvException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681284914"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2117"></span><span id="unsupportedCConvException"><span class="annot"><span class="annottext">unsupportedCConvException :: forall a. a
</span><a href="GHC.StgToByteCode.html#unsupportedCConvException"><span class="hs-identifier hs-var hs-var">unsupportedCConvException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span>
</span><span id="line-2118"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: bytecode compiler can't handle some foreign calling conventions\n&quot;</span></span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2119"></span><span>   </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Workaround: use -fobject-code, or compile this module to .o separately.&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2120"></span><span>
</span><span id="line-2121"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-type">mkSlideB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span>
</span><span id="line-2122"></span><span id="mkSlideB"><span class="annot"><span class="annottext">mkSlideB :: Platform -&gt; ByteOff -&gt; ByteOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideB"><span class="hs-identifier hs-var hs-var">mkSlideB</span></a></span></span><span> </span><span id="local-6989586621681282717"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282717"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282716"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282716"><span class="hs-identifier hs-var">nb</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282715"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282715"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282714"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282713"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2123"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2124"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681282714"><span class="annot"><span class="annottext">n :: Word16
</span><a href="#local-6989586621681282714"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word16
</span><a href="GHC.StgToByteCode.html#trunc16W"><span class="hs-identifier hs-var">trunc16W</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282717"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282716"><span class="hs-identifier hs-var">nb</span></a></span><span>
</span><span id="line-2125"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681282713"><span class="annot"><span class="annottext">d :: WordOff
</span><a href="#local-6989586621681282713"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ByteOff -&gt; WordOff
</span><a href="GHC.StgToByteCode.html#bytesToWords"><span class="hs-identifier hs-var">bytesToWords</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282717"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282715"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-2126"></span><span>
</span><span id="line-2127"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-type">mkSlideW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#OrdList"><span class="hs-identifier hs-type">OrdList</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#BCInstr"><span class="hs-identifier hs-type">BCInstr</span></a></span><span>
</span><span id="line-2128"></span><span id="mkSlideW"><span class="annot"><span class="annottext">mkSlideW :: Word16 -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var hs-var">mkSlideW</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282712"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282712"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681282711"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282711"><span class="hs-identifier hs-var">ws</span></a></span></span><span>
</span><span id="line-2129"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282711"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282710"><span class="hs-identifier hs-var">limit</span></a></span><span>
</span><span id="line-2130"></span><span>    </span><span class="hs-comment">-- If the amount to slide doesn't fit in a Word16, generate multiple slide</span><span>
</span><span id="line-2131"></span><span>    </span><span class="hs-comment">-- instructions</span><span>
</span><span id="line-2132"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SLIDE"><span class="hs-identifier hs-var">SLIDE</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282712"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282710"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#consOL"><span class="hs-operator hs-var">`consOL`</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; WordOff -&gt; OrdList BCInstr
</span><a href="GHC.StgToByteCode.html#mkSlideW"><span class="hs-identifier hs-var">mkSlideW</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282712"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282711"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282710"><span class="hs-identifier hs-var">limit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2133"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282711"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2134"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. OrdList a
</span><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-var">nilOL</span></a></span><span>
</span><span id="line-2135"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2136"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; OrdList a
</span><a href="GHC.Data.OrdList.html#unitOL"><span class="hs-identifier hs-var">unitOL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; BCInstr
</span><a href="GHC.ByteCode.Instr.html#SLIDE"><span class="hs-identifier hs-var">SLIDE</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621681282712"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681282711"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2138"></span><span>    </span><span class="annot"><a href="#local-6989586621681282710"><span class="hs-identifier hs-type">limit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word16"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-2139"></span><span>    </span><span id="local-6989586621681282710"><span class="annot"><span class="annottext">limit :: Word16
</span><a href="#local-6989586621681282710"><span class="hs-identifier hs-var hs-var">limit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span>
</span><span id="line-2140"></span><span>
</span><span id="line-2141"></span><span class="annot"><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-type">atomPrimRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span>
</span><span id="line-2142"></span><span id="atomPrimRep"><span class="annot"><span class="annottext">atomPrimRep :: StgArg -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-var hs-var">atomPrimRep</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681282709"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282709"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#bcIdPrimRep"><span class="hs-identifier hs-var">bcIdPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681282709"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2143"></span><span class="annot"><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-var">atomPrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span id="local-6989586621681282708"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282708"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; PrimRep
</span><a href="GHC.Types.RepType.html#typePrimRep1"><span class="hs-identifier hs-var">typePrimRep1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Kind
</span><a href="GHC.Types.Literal.html#literalType"><span class="hs-identifier hs-var">literalType</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681282708"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2144"></span><span>
</span><span id="line-2145"></span><span class="annot"><a href="GHC.StgToByteCode.html#atomRep"><span class="hs-identifier hs-type">atomRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span>
</span><span id="line-2146"></span><span id="atomRep"><span class="annot"><span class="annottext">atomRep :: Platform -&gt; StgArg -&gt; ArgRep
</span><a href="GHC.StgToByteCode.html#atomRep"><span class="hs-identifier hs-var hs-var">atomRep</span></a></span></span><span> </span><span id="local-6989586621681282706"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282706"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681282705"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681282705"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282706"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgArg -&gt; PrimRep
</span><a href="GHC.StgToByteCode.html#atomPrimRep"><span class="hs-identifier hs-var">atomPrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681282705"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2147"></span><span>
</span><span id="line-2148"></span><span class="hs-comment">-- | Let szsw be the sizes in bytes of some items pushed onto the stack, which</span><span>
</span><span id="line-2149"></span><span class="hs-comment">-- has initial depth @original_depth@.  Return the values which the stack</span><span>
</span><span id="line-2150"></span><span class="hs-comment">-- environment should map these items to.</span><span>
</span><span id="line-2151"></span><span class="annot"><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-type">mkStackOffsets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2152"></span><span id="mkStackOffsets"><span class="annot"><span class="annottext">mkStackOffsets :: ByteOff -&gt; [ByteOff] -&gt; [ByteOff]
</span><a href="GHC.StgToByteCode.html#mkStackOffsets"><span class="hs-identifier hs-var hs-var">mkStackOffsets</span></a></span></span><span> </span><span id="local-6989586621681282704"><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282704"><span class="hs-identifier hs-var">original_depth</span></a></span></span><span> </span><span id="local-6989586621681282703"><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621681282703"><span class="hs-identifier hs-var">szsb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#scanl%27"><span class="hs-identifier hs-var">scanl'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">(+)</span></a></span><span> </span><span class="annot"><span class="annottext">ByteOff
</span><a href="#local-6989586621681282704"><span class="hs-identifier hs-var">original_depth</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteOff]
</span><a href="#local-6989586621681282703"><span class="hs-identifier hs-var">szsb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2153"></span><span>
</span><span id="line-2154"></span><span class="annot"><a href="GHC.StgToByteCode.html#typeArgReps"><span class="hs-identifier hs-type">typeArgReps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.ArgRep.html#ArgRep"><span class="hs-identifier hs-type">ArgRep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2155"></span><span id="typeArgReps"><span class="annot"><span class="annottext">typeArgReps :: Platform -&gt; Kind -&gt; [ArgRep]
</span><a href="GHC.StgToByteCode.html#typeArgReps"><span class="hs-identifier hs-var hs-var">typeArgReps</span></a></span></span><span> </span><span id="local-6989586621681282702"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282702"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; PrimRep -&gt; ArgRep
</span><a href="GHC.StgToCmm.ArgRep.html#toArgRep"><span class="hs-identifier hs-var">toArgRep</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681282702"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Kind -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRepArgs"><span class="hs-identifier hs-var">typePrimRepArgs</span></a></span><span>
</span><span id="line-2156"></span><span>
</span><span id="line-2157"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2158"></span><span class="hs-comment">-- The bytecode generator's monad</span><span>
</span><span id="line-2159"></span><span>
</span><span id="line-2160"></span><span class="hs-keyword">data</span><span> </span><span id="BcM_State"><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-var">BcM_State</span></a></span></span><span>
</span><span id="line-2161"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="BcM_State"><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-var">BcM_State</span></a></span></span><span>
</span><span id="line-2162"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="bcm_hsc_env"><span class="annot"><span class="annottext">BcM_State -&gt; HscEnv
</span><a href="GHC.StgToByteCode.html#bcm_hsc_env"><span class="hs-identifier hs-var hs-var">bcm_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2163"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="uniqSupply"><span class="annot"><span class="annottext">BcM_State -&gt; UniqSupply
</span><a href="GHC.StgToByteCode.html#uniqSupply"><span class="hs-identifier hs-var hs-var">uniqSupply</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span>      </span><span class="hs-comment">-- for generating fresh variable names</span><span>
</span><span id="line-2164"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="thisModule"><span class="annot"><span class="annottext">BcM_State -&gt; Module
</span><a href="GHC.StgToByteCode.html#thisModule"><span class="hs-identifier hs-var hs-var">thisModule</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>          </span><span class="hs-comment">-- current module (for breakpoints)</span><span>
</span><span id="line-2165"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="nextlabel"><span class="annot"><span class="annottext">BcM_State -&gt; Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var hs-var">nextlabel</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word32"><span class="hs-identifier hs-type">Word32</span></a></span><span>          </span><span class="hs-comment">-- for generating local labels</span><span>
</span><span id="line-2166"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="ffis"><span class="annot"><span class="annottext">BcM_State -&gt; [FFIInfo]
</span><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var hs-var">ffis</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- ffi info blocks, to free later</span><span>
</span><span id="line-2167"></span><span>                                         </span><span class="hs-comment">-- Should be free()d when it is GCd</span><span>
</span><span id="line-2168"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="modBreaks"><span class="annot"><span class="annottext">BcM_State -&gt; Maybe ModBreaks
</span><a href="GHC.StgToByteCode.html#modBreaks"><span class="hs-identifier hs-var hs-var">modBreaks</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span> </span><span class="hs-comment">-- info about breakpoints</span><span>
</span><span id="line-2169"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="breakInfo"><span class="annot"><span class="annottext">BcM_State -&gt; IntMap CgBreakInfo
</span><a href="GHC.StgToByteCode.html#breakInfo"><span class="hs-identifier hs-var hs-var">breakInfo</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-IntMap-Internal.html#IntMap"><span class="hs-identifier hs-type">IntMap</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CgBreakInfo"><span class="hs-identifier hs-type">CgBreakInfo</span></a></span><span>
</span><span id="line-2170"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="topStrings"><span class="annot"><span class="annottext">BcM_State -&gt; IdEnv (RemotePtr ())
</span><a href="GHC.StgToByteCode.html#topStrings"><span class="hs-identifier hs-var hs-var">topStrings</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- top-level string literals</span><span>
</span><span id="line-2171"></span><span>          </span><span class="hs-comment">-- See Note [generating code for top-level string literal bindings].</span><span>
</span><span id="line-2172"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2173"></span><span>
</span><span id="line-2174"></span><span class="hs-keyword">newtype</span><span> </span><span id="BcM"><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span></span><span> </span><span id="local-6989586621681284837"><span class="annot"><a href="#local-6989586621681284837"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BcM"><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681284837"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681282695"><span id="local-6989586621681282699"><span class="annot"><span class="annottext">forall a b. a -&gt; BcM b -&gt; BcM a
forall a b. (a -&gt; b) -&gt; BcM a -&gt; BcM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; BcM b -&gt; BcM a
$c&lt;$ :: forall a b. a -&gt; BcM b -&gt; BcM a
fmap :: forall a b. (a -&gt; b) -&gt; BcM a -&gt; BcM b
$cfmap :: forall a b. (a -&gt; b) -&gt; BcM a -&gt; BcM b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-2175"></span><span>
</span><span id="line-2176"></span><span id="local-6989586621681284860"><span class="annot"><a href="GHC.StgToByteCode.html#ioToBc"><span class="hs-identifier hs-type">ioToBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681284860"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284860"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2177"></span><span id="ioToBc"><span class="annot"><span class="annottext">ioToBc :: forall a. IO a -&gt; BcM a
</span><a href="GHC.StgToByteCode.html#ioToBc"><span class="hs-identifier hs-var hs-var">ioToBc</span></a></span></span><span> </span><span id="local-6989586621681282690"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621681282690"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282689"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282689"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2178"></span><span>  </span><span id="local-6989586621681282688"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681282688"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621681282690"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-2179"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282689"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681282688"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2180"></span><span>
</span><span id="line-2181"></span><span id="local-6989586621681285068"><span class="annot"><a href="GHC.StgToByteCode.html#runBc"><span class="hs-identifier hs-type">runBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a></span><span>
</span><span id="line-2182"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2183"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681285068"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-2184"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-type">BcM_State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681285068"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2185"></span><span id="runBc"><span class="annot"><span class="annottext">runBc :: forall r.
HscEnv
-&gt; UniqSupply
-&gt; Module
-&gt; Maybe ModBreaks
-&gt; IdEnv (RemotePtr ())
-&gt; BcM r
-&gt; IO (BcM_State, r)
</span><a href="GHC.StgToByteCode.html#runBc"><span class="hs-identifier hs-var hs-var">runBc</span></a></span></span><span> </span><span id="local-6989586621681282686"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681282686"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681282685"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681282685"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621681282684"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681282684"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681282683"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681282683"><span class="hs-identifier hs-var">modBreaks</span></a></span></span><span> </span><span id="local-6989586621681282682"><span class="annot"><span class="annottext">IdEnv (RemotePtr ())
</span><a href="#local-6989586621681282682"><span class="hs-identifier hs-var">topStrings</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621681282681"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, r)
</span><a href="#local-6989586621681282681"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2186"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, r)
</span><a href="#local-6989586621681282681"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
-&gt; UniqSupply
-&gt; Module
-&gt; Word32
-&gt; [FFIInfo]
-&gt; Maybe ModBreaks
-&gt; IntMap CgBreakInfo
-&gt; IdEnv (RemotePtr ())
-&gt; BcM_State
</span><a href="GHC.StgToByteCode.html#BcM_State"><span class="hs-identifier hs-var">BcM_State</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681282686"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681282685"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681282684"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681282683"><span class="hs-identifier hs-var">modBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IntMap a
</span><a href="../../containers-0.6.5.1/src/Data-IntMap-Internal.html#empty"><span class="hs-identifier hs-var">IntMap.empty</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv (RemotePtr ())
</span><a href="#local-6989586621681282682"><span class="hs-identifier hs-var">topStrings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2187"></span><span>
</span><span id="line-2188"></span><span id="local-6989586621681284833"><span id="local-6989586621681284834"><span class="annot"><a href="GHC.StgToByteCode.html#thenBc"><span class="hs-identifier hs-type">thenBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284834"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681284834"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284833"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284833"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-2189"></span><span id="thenBc"><span class="annot"><span class="annottext">thenBc :: forall a b. BcM a -&gt; (a -&gt; BcM b) -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc"><span class="hs-identifier hs-var hs-var">thenBc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621681282675"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621681282675"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681282674"><span class="annot"><span class="annottext">a -&gt; BcM b
</span><a href="#local-6989586621681282674"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282673"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282673"><span class="hs-identifier hs-var">st0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2190"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681282672"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282672"><span class="hs-identifier hs-var">st1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282671"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681282671"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621681282675"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282673"><span class="hs-identifier hs-var">st0</span></a></span><span>
</span><span id="line-2191"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621681282670"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, b)
</span><a href="#local-6989586621681282670"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; BcM b
</span><a href="#local-6989586621681282674"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681282671"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-2192"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681282669"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282669"><span class="hs-identifier hs-var">st2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282668"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282668"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, b)
</span><a href="#local-6989586621681282670"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282672"><span class="hs-identifier hs-var">st1</span></a></span><span>
</span><span id="line-2193"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282669"><span class="hs-identifier hs-var">st2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282668"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2194"></span><span>
</span><span id="line-2195"></span><span id="local-6989586621681284829"><span id="local-6989586621681284830"><span class="annot"><a href="GHC.StgToByteCode.html#thenBc_"><span class="hs-identifier hs-type">thenBc_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284830"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284829"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284829"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-2196"></span><span id="thenBc_"><span class="annot"><span class="annottext">thenBc_ :: forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc_"><span class="hs-identifier hs-var hs-var">thenBc_</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621681282663"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621681282663"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span id="local-6989586621681282662"><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, b)
</span><a href="#local-6989586621681282662"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282661"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282661"><span class="hs-identifier hs-var">st0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2197"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681282660"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282660"><span class="hs-identifier hs-var">st1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, a)
</span><a href="#local-6989586621681282663"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282661"><span class="hs-identifier hs-var">st0</span></a></span><span>
</span><span id="line-2198"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681282659"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282659"><span class="hs-identifier hs-var">st2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282658"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282658"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IO (BcM_State, b)
</span><a href="#local-6989586621681282662"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282660"><span class="hs-identifier hs-var">st1</span></a></span><span>
</span><span id="line-2199"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282659"><span class="hs-identifier hs-var">st2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681282658"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2200"></span><span>
</span><span id="line-2201"></span><span id="local-6989586621681284826"><span class="annot"><a href="GHC.StgToByteCode.html#returnBc"><span class="hs-identifier hs-type">returnBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681284826"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681284826"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2202"></span><span id="returnBc"><span class="annot"><span class="annottext">returnBc :: forall a. a -&gt; BcM a
</span><a href="GHC.StgToByteCode.html#returnBc"><span class="hs-identifier hs-var hs-var">returnBc</span></a></span></span><span> </span><span id="local-6989586621681282655"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681282655"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282654"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282654"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282654"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681282655"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2203"></span><span>
</span><span id="line-2204"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681282645"><span id="local-6989586621681282648"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2205"></span><span>    </span><span id="local-6989586621681282643"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; BcM a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; BcM a
</span><a href="GHC.StgToByteCode.html#returnBc"><span class="hs-identifier hs-var">returnBc</span></a></span><span>
</span><span id="line-2206"></span><span>    </span><span id="local-6989586621681282641"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. BcM (a -&gt; b) -&gt; BcM a -&gt; BcM b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#ap"><span class="hs-identifier hs-var">ap</span></a></span><span>
</span><span id="line-2207"></span><span>    </span><span id="local-6989586621681282639"><span class="annot"><span class="annottext">*&gt; :: forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">(*&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc_"><span class="hs-identifier hs-var">thenBc_</span></a></span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681282633"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2210"></span><span>  </span><span id="local-6989586621681282631"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. BcM a -&gt; (a -&gt; BcM b) -&gt; BcM b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var hs-var hs-var hs-var">(&gt;&gt;=)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. BcM a -&gt; (a -&gt; BcM b) -&gt; BcM b
</span><a href="GHC.StgToByteCode.html#thenBc"><span class="hs-identifier hs-var">thenBc</span></a></span><span>
</span><span id="line-2211"></span><span>  </span><span id="local-6989586621681282629"><span class="annot"><span class="annottext">&gt;&gt; :: forall a b. BcM a -&gt; BcM b -&gt; BcM b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">(&gt;&gt;)</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var">(*&gt;)</span></a></span><span>
</span><span id="line-2212"></span><span>
</span><span id="line-2213"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a></span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2214"></span><span>    </span><span id="local-6989586621681282625"><span class="annot"><span class="annottext">getDynFlags :: BcM DynFlags
</span><a href="#local-6989586621681282625"><span class="hs-identifier hs-var hs-var hs-var hs-var">getDynFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282624"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282624"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282624"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State -&gt; HscEnv
</span><a href="GHC.StgToByteCode.html#bcm_hsc_env"><span class="hs-identifier hs-var">bcm_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282624"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2215"></span><span>
</span><span id="line-2216"></span><span class="annot"><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2217"></span><span id="getHscEnv"><span class="annot"><span class="annottext">getHscEnv :: BcM HscEnv
</span><a href="GHC.StgToByteCode.html#getHscEnv"><span class="hs-identifier hs-var hs-var">getHscEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282623"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282623"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282623"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; HscEnv
</span><a href="GHC.StgToByteCode.html#bcm_hsc_env"><span class="hs-identifier hs-var">bcm_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282623"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2218"></span><span>
</span><span id="line-2219"></span><span class="annot"><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-type">getProfile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Profile.html#Profile"><span class="hs-identifier hs-type">Profile</span></a></span><span>
</span><span id="line-2220"></span><span id="getProfile"><span class="annot"><span class="annottext">getProfile :: BcM Profile
</span><a href="GHC.StgToByteCode.html#getProfile"><span class="hs-identifier hs-var hs-var">getProfile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Profile
</span><a href="GHC.Driver.Session.html#targetProfile"><span class="hs-identifier hs-var">targetProfile</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2221"></span><span>
</span><span id="line-2222"></span><span class="annot"><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-type">emitBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-type">FFIInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.ByteCode.Instr.html#ProtoBCO"><span class="hs-identifier hs-type">ProtoBCO</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2223"></span><span id="emitBc"><span class="annot"><span class="annottext">emitBc :: ([FFIInfo] -&gt; ProtoBCO Name) -&gt; BcM (ProtoBCO Name)
</span><a href="GHC.StgToByteCode.html#emitBc"><span class="hs-identifier hs-var hs-var">emitBc</span></a></span></span><span> </span><span id="local-6989586621681282622"><span class="annot"><span class="annottext">[FFIInfo] -&gt; ProtoBCO Name
</span><a href="#local-6989586621681282622"><span class="hs-identifier hs-var">bco</span></a></span></span><span>
</span><span id="line-2224"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282621"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282621"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282621"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ffis :: [FFIInfo]
</span><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FFIInfo] -&gt; ProtoBCO Name
</span><a href="#local-6989586621681282622"><span class="hs-identifier hs-var">bco</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State -&gt; [FFIInfo]
</span><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282621"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2225"></span><span>
</span><span id="line-2226"></span><span class="annot"><a href="GHC.StgToByteCode.html#recordFFIBc"><span class="hs-identifier hs-type">recordFFIBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-FFI.html#C_ffi_cif"><span class="hs-identifier hs-type">C_ffi_cif</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span id="recordFFIBc"><span class="annot"><span class="annottext">recordFFIBc :: RemotePtr C_ffi_cif -&gt; BcM ()
</span><a href="GHC.StgToByteCode.html#recordFFIBc"><span class="hs-identifier hs-var hs-var">recordFFIBc</span></a></span></span><span> </span><span id="local-6989586621681282620"><span class="annot"><span class="annottext">RemotePtr C_ffi_cif
</span><a href="#local-6989586621681282620"><span class="hs-identifier hs-var">a</span></a></span></span><span>
</span><span id="line-2228"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282619"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282619"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282619"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ffis :: [FFIInfo]
</span><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RemotePtr C_ffi_cif -&gt; FFIInfo
</span><a href="GHC.ByteCode.Types.html#FFIInfo"><span class="hs-identifier hs-var">FFIInfo</span></a></span><span> </span><span class="annot"><span class="annottext">RemotePtr C_ffi_cif
</span><a href="#local-6989586621681282620"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; [FFIInfo]
</span><a href="GHC.StgToByteCode.html#ffis"><span class="hs-identifier hs-var">ffis</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282619"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2229"></span><span>
</span><span id="line-2230"></span><span class="annot"><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-type">getLabelBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Instr.html#LocalLabel"><span class="hs-identifier hs-type">LocalLabel</span></a></span><span>
</span><span id="line-2231"></span><span id="getLabelBc"><span class="annot"><span class="annottext">getLabelBc :: BcM LocalLabel
</span><a href="GHC.StgToByteCode.html#getLabelBc"><span class="hs-identifier hs-var hs-var">getLabelBc</span></a></span></span><span>
</span><span id="line-2232"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282617"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282617"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681282616"><span class="annot"><span class="annottext">nl :: Word32
</span><a href="#local-6989586621681282616"><span class="hs-identifier hs-var hs-var">nl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282617"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-2233"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282616"><span class="hs-identifier hs-var">nl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall a. Bounded a =&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Enum.html#maxBound"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2234"></span><span>                        </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getLabelBc: Ran out of labels&quot;</span></span><span>
</span><span id="line-2235"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282617"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nextlabel :: Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282616"><span class="hs-identifier hs-var">nl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; LocalLabel
</span><a href="GHC.ByteCode.Instr.html#LocalLabel"><span class="hs-identifier hs-var">LocalLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282616"><span class="hs-identifier hs-var">nl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2236"></span><span>
</span><span id="line-2237"></span><span class="annot"><a href="GHC.StgToByteCode.html#getLabelsBc"><span class="hs-identifier hs-type">getLabelsBc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Word.html#Word32"><span class="hs-identifier hs-type">Word32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.ByteCode.Instr.html#LocalLabel"><span class="hs-identifier hs-type">LocalLabel</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2238"></span><span id="getLabelsBc"><span class="annot"><span class="annottext">getLabelsBc :: Word32 -&gt; BcM [LocalLabel]
</span><a href="GHC.StgToByteCode.html#getLabelsBc"><span class="hs-identifier hs-var hs-var">getLabelsBc</span></a></span></span><span> </span><span id="local-6989586621681282614"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282614"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-2239"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282613"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282613"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681282612"><span class="annot"><span class="annottext">ctr :: Word32
</span><a href="#local-6989586621681282612"><span class="hs-identifier hs-var hs-var">ctr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282613"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-2240"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282613"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nextlabel :: Word32
</span><a href="GHC.StgToByteCode.html#nextlabel"><span class="hs-identifier hs-var">nextlabel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282612"><span class="hs-identifier hs-var">ctr</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282614"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">coerce :: forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-type">coerce</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282612"><span class="hs-identifier hs-var">ctr</span></a></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282612"><span class="hs-identifier hs-var">ctr</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621681282614"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2241"></span><span>
</span><span id="line-2242"></span><span class="annot"><a href="GHC.StgToByteCode.html#getCCArray"><span class="hs-identifier hs-type">getCCArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Arr.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#BreakIndex"><span class="hs-identifier hs-type">BreakIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Stack-CCS.html#CostCentre"><span class="hs-identifier hs-type">CostCentre</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2243"></span><span id="getCCArray"><span class="annot"><span class="annottext">getCCArray :: BcM (Array Int (RemotePtr CostCentre))
</span><a href="GHC.StgToByteCode.html#getCCArray"><span class="hs-identifier hs-var hs-var">getCCArray</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282610"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282610"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2244"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681282609"><span class="annot"><span class="annottext">breaks :: ModBreaks
</span><a href="#local-6989586621681282609"><span class="hs-identifier hs-var hs-var">breaks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.StgToByteCode.getCCArray&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Maybe ModBreaks
</span><a href="GHC.StgToByteCode.html#modBreaks"><span class="hs-identifier hs-var">modBreaks</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282610"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2245"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282610"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModBreaks -&gt; Array Int (RemotePtr CostCentre)
</span><a href="GHC.ByteCode.Types.html#modBreaks_ccs"><span class="hs-identifier hs-var">modBreaks_ccs</span></a></span><span> </span><span class="annot"><span class="annottext">ModBreaks
</span><a href="#local-6989586621681282609"><span class="hs-identifier hs-var">breaks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2246"></span><span>
</span><span id="line-2247"></span><span>
</span><span id="line-2248"></span><span class="annot"><a href="GHC.StgToByteCode.html#newBreakInfo"><span class="hs-identifier hs-type">newBreakInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#BreakIndex"><span class="hs-identifier hs-type">BreakIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CgBreakInfo"><span class="hs-identifier hs-type">CgBreakInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2249"></span><span id="newBreakInfo"><span class="annot"><span class="annottext">newBreakInfo :: Int -&gt; CgBreakInfo -&gt; BcM ()
</span><a href="GHC.StgToByteCode.html#newBreakInfo"><span class="hs-identifier hs-var hs-var">newBreakInfo</span></a></span></span><span> </span><span id="local-6989586621681282606"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282606"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span id="local-6989586621681282605"><span class="annot"><span class="annottext">CgBreakInfo
</span><a href="#local-6989586621681282605"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282604"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282604"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2250"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282604"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">breakInfo :: IntMap CgBreakInfo
</span><a href="GHC.StgToByteCode.html#breakInfo"><span class="hs-identifier hs-var">breakInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><a href="../../containers-0.6.5.1/src/Data-IntMap-Internal.html#insert"><span class="hs-identifier hs-var">IntMap.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681282606"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">CgBreakInfo
</span><a href="#local-6989586621681282605"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State -&gt; IntMap CgBreakInfo
</span><a href="GHC.StgToByteCode.html#breakInfo"><span class="hs-identifier hs-var">breakInfo</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282604"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2251"></span><span>
</span><span id="line-2252"></span><span class="annot"><a href="GHC.StgToByteCode.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span>
</span><span id="line-2253"></span><span id="newUnique"><span class="annot"><span class="annottext">newUnique :: BcM Unique
</span><a href="GHC.StgToByteCode.html#newUnique"><span class="hs-identifier hs-var hs-var">newUnique</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2254"></span><span>   </span><span class="hs-glyph">\</span><span id="local-6989586621681282601"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282601"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; (Unique, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#takeUniqFromSupply"><span class="hs-identifier hs-var">takeUniqFromSupply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State -&gt; UniqSupply
</span><a href="GHC.StgToByteCode.html#uniqSupply"><span class="hs-identifier hs-var">uniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282601"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2255"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621681282599"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681282599"><span class="hs-identifier hs-var">uniq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681282598"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681282598"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681282597"><span class="annot"><span class="annottext">newState :: BcM_State
</span><a href="#local-6989586621681282597"><span class="hs-identifier hs-var hs-var">newState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282601"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uniqSupply :: UniqSupply
</span><a href="GHC.StgToByteCode.html#uniqSupply"><span class="hs-identifier hs-var">uniqSupply</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681282598"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2256"></span><span>                           </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282597"><span class="hs-identifier hs-var">newState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681282599"><span class="hs-identifier hs-var">uniq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2257"></span><span>
</span><span id="line-2258"></span><span class="annot"><a href="GHC.StgToByteCode.html#getCurrentModule"><span class="hs-identifier hs-type">getCurrentModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2259"></span><span id="getCurrentModule"><span class="annot"><span class="annottext">getCurrentModule :: BcM Module
</span><a href="GHC.StgToByteCode.html#getCurrentModule"><span class="hs-identifier hs-var hs-var">getCurrentModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282596"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282596"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282596"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; Module
</span><a href="GHC.StgToByteCode.html#thisModule"><span class="hs-identifier hs-var">thisModule</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282596"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2260"></span><span>
</span><span id="line-2261"></span><span class="annot"><a href="GHC.StgToByteCode.html#getTopStrings"><span class="hs-identifier hs-type">getTopStrings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci-9.2.4/src/GHCi-RemoteTypes.html#RemotePtr"><span class="hs-identifier hs-type">RemotePtr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2262"></span><span id="getTopStrings"><span class="annot"><span class="annottext">getTopStrings :: BcM (IdEnv (RemotePtr ()))
</span><a href="GHC.StgToByteCode.html#getTopStrings"><span class="hs-identifier hs-var hs-var">getTopStrings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. (BcM_State -&gt; IO (BcM_State, r)) -&gt; BcM r
</span><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-var">BcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681282595"><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282595"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282595"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BcM_State -&gt; IdEnv (RemotePtr ())
</span><a href="GHC.StgToByteCode.html#topStrings"><span class="hs-identifier hs-var">topStrings</span></a></span><span> </span><span class="annot"><span class="annottext">BcM_State
</span><a href="#local-6989586621681282595"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2263"></span><span>
</span><span id="line-2264"></span><span class="annot"><a href="GHC.StgToByteCode.html#newId"><span class="hs-identifier hs-type">newId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToByteCode.html#BcM"><span class="hs-identifier hs-type">BcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-2265"></span><span id="newId"><span class="annot"><span class="annottext">newId :: Kind -&gt; BcM Id
</span><a href="GHC.StgToByteCode.html#newId"><span class="hs-identifier hs-var hs-var">newId</span></a></span></span><span> </span><span id="local-6989586621681282594"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681282594"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2266"></span><span>    </span><span id="local-6989586621681282593"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681282593"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BcM Unique
</span><a href="GHC.StgToByteCode.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-2267"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Unique -&gt; Kind -&gt; Kind -&gt; Id
</span><a href="GHC.Types.Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="GHC.StgToByteCode.html#tickFS"><span class="hs-identifier hs-var">tickFS</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681282593"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621681282594"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2268"></span><span>
</span><span id="line-2269"></span><span class="annot"><a href="GHC.StgToByteCode.html#tickFS"><span class="hs-identifier hs-type">tickFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-2270"></span><span id="tickFS"><span class="annot"><span class="annottext">tickFS :: FastString
</span><a href="GHC.StgToByteCode.html#tickFS"><span class="hs-identifier hs-var hs-var">tickFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ticked&quot;</span></span><span>
</span><span id="line-2271"></span></pre></body></html>
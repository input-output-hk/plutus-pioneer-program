<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                 #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span> </span><span class="hs-comment">-- Wrinkle in Note [Trees That Grow]</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">{-
%
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Gen.App</span><span>
</span><span id="line-18"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier">tcApp</span></a></span><span>
</span><span id="line-19"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier">tcInferSigma</span></a></span><span>
</span><span id="line-20"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier">tcExprPrag</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier">tcPolyExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier">multiplicityTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html"><span class="hs-identifier">GHC.Tc.Gen.Head</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier">tcGetFamInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst_maybe"><span class="hs-identifier">tcLookupDataFamInst_maybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier">substTyWithInScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html"><span class="hs-identifier">GHC.Core.TyCo.FVs</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#shallowTyCoVarsOfType"><span class="hs-identifier">shallowTyCoVarsOfType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html#tagToEnumKey"><span class="hs-identifier">tagToEnumKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier">emptyTidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier">mkInScopeSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.2.4/src/GHC-LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Function.html#"><span class="hs-identifier">Data.Function</span></a></span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Quick Look overview
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">{- Note [Quick Look]
~~~~~~~~~~~~~~~~~~~~
The implementation of Quick Look closely follows the QL paper
   A quick look at impredicativity, Serrano et al, ICFP 2020
   https://www.microsoft.com/en-us/research/publication/a-quick-look-at-impredicativity/

All the moving parts are in this module, GHC.Tc.Gen.App, so named
because it deal with n-ary application.  The main workhorse is tcApp.

Some notes relative to the paper

* The &quot;instantiation variables&quot; of the paper are ordinary unification
  variables.  We keep track of which variables are instantiation variables
  by keeping a set Delta of instantiation variables.

* When we learn what an instantiation variable must be, we simply unify
  it with that type; this is done in qlUnify, which is the function mgu_ql(t1,t2)
  of the paper.  This may fill in a (mutable) instantiation variable with
  a polytype.

* When QL is done, we don't need to turn the un-filled-in
  instantiation variables into unification variables -- they
  already /are/ unification varibles!  See also
  Note [Instantiation variables are short lived].

* We cleverly avoid the quadratic cost of QL, alluded to in the paper.
  See Note [Quick Look at value arguments]

Note [Instantiation variables are short lived]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
By the time QL is done, all filled-in occurrences of instantiation
variables have been zonked away (see &quot;Crucial step&quot; in tcValArgs),
and so the constraint /generator/ never subsequently sees a meta-type
variable filled in with a polytype -- a meta type variable stands
(only) for a monotype.  See Section 4.3 &quot;Applications and instantiation&quot;
of the paper.

However, the constraint /solver/ can see a meta-type-variable filled
in with a polytype (#18987). Suppose
  f :: forall a. Dict a =&gt; [a] -&gt; [a]
  xs :: [forall b. b-&gt;b]
and consider the call (f xs).  QL will
* Instantiate f, with a := kappa, where kappa is an instantiation variable
* Emit a constraint (Dict kappa), via instantiateSigma, called from tcInstFun
* Do QL on the argument, to discover kappa := forall b. b-&gt;b

But by the time the third step has happened, the constraint has been
emitted into the monad.  The constraint solver will later find it, and
rewrite it to (Dict (forall b. b-&gt;b)). That's fine -- the constraint
solver does no implicit instantiation (which is what makes it so
tricky to have foralls hiding inside unification variables), so there
is no difficulty with allowing those filled-in kappa's to persist.
(We could find them and zonk them away, but that would cost code and
execution time, for no purpose.)

Since the constraint solver does not do implicit instantiation (as the
constraint generator does), the fact that a unification variable might
stand for a polytype does not matter.
-}</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
              tcInferSigma
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier hs-type">tcInferSigma</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- Used only to implement :type; see GHC.Tc.Module.tcRnExpr</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- True  &lt;=&gt; instantiate -- return a rho-type</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- False &lt;=&gt; don't instantiate -- return a sigma-type</span><span>
</span><span id="line-138"></span><span id="tcInferSigma"><span class="annot"><span class="annottext">tcInferSigma :: Bool -&gt; LHsExpr GhcRn -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.App.html#tcInferSigma"><span class="hs-identifier hs-var hs-var">tcInferSigma</span></a></span></span><span> </span><span id="local-6989586621681394514"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394514"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681394512"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394512"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681394511"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394511"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394510"><span class="annot"><span class="annottext">fun :: (HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394510"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681394509"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394509"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">AppCtxt
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394508"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394508"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ((HsExpr GhcRn, AppCtxt), [HsExprArg 'TcpRn])
</span><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-var">splitHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394511"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394511"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394512"><span class="hs-identifier hs-var">loc</span></a></span><span>     </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394504"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394504"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM Bool
</span><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var">wantQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394509"><span class="hs-identifier hs-var">rn_fun</span></a></span><span>
</span><span id="line-143"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394502"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394502"><span class="hs-identifier hs-var">_tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394501"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394501"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
-&gt; [HsExprArg 'TcpRn] -&gt; Maybe TcType -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-var">tcInferAppHead</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394510"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394508"><span class="hs-identifier hs-var">rn_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-144"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394499"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394499"><span class="hs-identifier hs-var">_delta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394498"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394498"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394497"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394497"><span class="hs-identifier hs-var">app_res_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Bool
-&gt; (HsExpr GhcRn, AppCtxt)
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-var">tcInstFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394504"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394514"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394510"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394501"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394508"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-145"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394495"><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681394495"><span class="hs-identifier hs-var">_tc_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
</span><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-var">tcValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394504"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394498"><span class="hs-identifier hs-var">inst_args</span></a></span><span>
</span><span id="line-146"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394497"><span class="hs-identifier hs-var">app_res_sigma</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Typechecking n-ary applications
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">{- Note [Application chains and heads]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Quick Look treats application chains specially.  What is an
&quot;application chain&quot;?  See Fig 2, of the QL paper: &quot;A quick look at
impredicativity&quot; (ICFP'20). Here's the syntax:

app ::= head
     |  app expr            -- HsApp: ordinary application
     |  app @type           -- HsTypeApp: VTA
     |  expr `head` expr    -- OpApp: infix applications
     |  ( app )             -- HsPar: parens
     |  {-# PRAGMA #-} app  -- HsPragE: pragmas

head ::= f             -- HsVar:    variables
      |  fld           -- HsRecFld: record field selectors
      |  (expr :: ty)  -- ExprWithTySig: expr with user type sig
      |  lit           -- HsOverLit: overloaded literals
      |  $([| head |])    -- HsSpliceE+HsSpliced+HsSplicedExpr: untyped TH expression splices
      |  other_expr    -- Other expressions

When tcExpr sees something that starts an application chain (namely,
any of the constructors in 'app' or 'head'), it invokes tcApp to
typecheck it: see Note [tcApp: typechecking applications].  However,
for HsPar and HsPragE, there is no tcWrapResult (which would
instantiate types, bypassing Quick Look), so nothing is gained by
using the application chain route, and we can just recurse to tcExpr.

A &quot;head&quot; has three special cases (for which we can infer a polytype
using tcInferAppHead_maybe); otherwise is just any old expression (for
which we can infer a rho-type (via tcInfer).

There is no special treatment for HsUnboundVar, HsOverLit etc, because
we can't get a polytype from them.

Left and right sections (e.g. (x +) and (+ x)) are not yet supported.
Probably left sections (x +) would be easy to add, since x is the
first arg of (+); but right sections are not so easy.  For symmetry
reasons I've left both unchanged, in GHC.Tc.Gen.Expr.

It may not be immediately obvious why ExprWithTySig (e::ty) should be
dealt with by tcApp, even when it is not applied to anything. Consider
   f :: [forall a. a-&gt;a] -&gt; Int
   ...(f (undefined :: forall b. b))...
Clearly this should work!  But it will /only/ work because if we
instantiate that (forall b. b) impredicatively!  And that only happens
in tcApp.

We also wish to typecheck application chains with untyped Template Haskell
splices in the head, such as this example from #21038:
    data Foo = MkFoo (forall a. a -&gt; a)
    f = $([| MkFoo |]) $ \x -&gt; x
This should typecheck just as if the TH splice was never in the way&#8212;that is,
just as if the user had written `MkFoo $ \x -&gt; x`. We could conceivably have
a case for typed TH expression splices too, but it wouldn't be useful in
practice, since the types of typed TH expressions aren't allowed to have
polymorphic types, such as the type of MkFoo.

Note [tcApp: typechecking applications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tcApp implements the APP-Downarrow/Uparrow rule of
Fig 3, plus the modification in Fig 5, of the QL paper:
&quot;A quick look at impredicativity&quot; (ICFP'20).

It treats application chains (f e1 @ty e2) specially:

* So we can report errors like &quot;in the third arument of a call of f&quot;

* So we can do Visible Type Application (VTA), for which we must not
  eagerly instantiate the function part of the application.

* So that we can do Quick Look impredicativity.

tcApp works like this:

1. Use splitHsApps, which peels off
     HsApp, HsTypeApp, HsPrag, HsPar
   returning the function in the corner and the arguments

   splitHsApps can deal with infix as well as prefix application,
   and returns a Rebuilder to re-assemble the the application after
   typechecking.

   The &quot;list of arguments&quot; is [HsExprArg], described in Note [HsExprArg].
   in GHC.Tc.Gen.Head

2. Use tcInferAppHead to infer the type of the function,
     as an (uninstantiated) TcSigmaType
   There are special cases for
     HsVar, HsRecFld, and ExprWithTySig
   Otherwise, delegate back to tcExpr, which
     infers an (instantiated) TcRhoType

3. Use tcInstFun to instantiate the function, Quick-Looking as we go.
   This implements the |-inst judgement in Fig 4, plus the
   modification in Fig 5, of the QL paper:
   &quot;A quick look at impredicativity&quot; (ICFP'20).

   In tcInstFun we take a quick look at value arguments, using
   quickLookArg.  See Note [Quick Look at value arguments].

4. Use quickLookResultType to take a quick look at the result type,
   when in checking mode.  This is the shaded part of APP-Downarrow
   in Fig 5.

5. Use unifyResultType to match up the result type of the call
   with that expected by the context.  See Note [Unify with
   expected type before typechecking arguments]

6. Use tcValArgs to typecheck the value arguments

7. After a gruesome special case for tagToEnum, rebuild the result.


Some cases that /won't/ work:

1. Consider this (which uses visible type application):

    (let { f :: forall a. a -&gt; a; f x = x } in f) @Int

   Since 'let' is not among the special cases for tcInferAppHead,
   we'll delegate back to tcExpr, which will instantiate f's type
   and the type application to @Int will fail.  Too bad!

Note [Quick Look for particular Ids]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We switch on Quick Look (regardless of -XImpredicativeTypes) for certain
particular Ids:

* ($): For a long time GHC has had a special typing rule for ($), that
  allows it to type (runST $ foo), which requires impredicative instantiation
  of ($), without language flags.  It's a bit ad-hoc, but it's been that
  way for ages.  Using quickLookIds is the only special treatment ($) needs
  now, which is a lot better.

* leftSection, rightSection: these are introduced by the expansion step in
  the renamer (Note [Handling overloaded and rebindable constructs] in
  GHC.Rename.Expr), and we want them to be instantiated impredicatively
  so that (f `op`), say, will work OK even if `f` is higher rank.
  See Note [Left and right sections] in GHC.Rename.Expr.

Note [Unify with expected type before typechecking arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this (#19364)
  data Pair a b = Pair a b
  baz :: MkPair Int Bool
  baz = MkPair &quot;yes&quot; &quot;no&quot;

We instantiate MkPair with `alpha`, `beta`, and push its argument
types (`alpha` and `beta`) into the arguments (&quot;yes&quot; and &quot;no&quot;).
But if we first unify the result type (Pair alpha beta) with the expected
type (Pair Int Bool) we will push the much more informative types
`Int` and `Bool` into the arguments.   This makes a difference:

Unify result type /after/ typechecking the args
    &#8226; Couldn't match type &#8216;[Char]&#8217; with &#8216;Bool&#8217;
      Expected type: Pair Foo Bar
        Actual type: Pair [Char] [Char]
    &#8226; In the expression: Pair &quot;yes&quot; &quot;no&quot;

Unify result type /before/ typechecking the args
    &#8226; Couldn't match type &#8216;[Char]&#8217; with &#8216;Bool&#8217;
      Expected: Foo
        Actual: String
    &#8226; In the first argument of &#8216;Pair&#8217;, namely &#8216;&quot;yes&quot;&#8217;

The latter is much better. That is why we call unifyExpectedType
before tcValArgs.
-}</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-type">tcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- See Note [tcApp: typechecking applications]</span><span>
</span><span id="line-325"></span><span id="tcApp"><span class="annot"><span class="annottext">tcApp :: HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var hs-var">tcApp</span></a></span></span><span> </span><span id="local-6989586621681394493"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394493"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621681394492"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681394492"><span class="hs-identifier hs-var">exp_res_ty</span></a></span></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394491"><span class="annot"><span class="annottext">fun :: (HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394491"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681394490"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394490"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394489"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394489"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394488"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394488"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ((HsExpr GhcRn, AppCtxt), [HsExprArg 'TcpRn])
</span><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-var">splitHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394493"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394487"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394487"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394486"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394486"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
-&gt; [HsExprArg 'TcpRn] -&gt; Maybe TcType -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-var">tcInferAppHead</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394491"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394488"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-328"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; Maybe TcType
</span><a href="GHC.Tc.Utils.TcMType.html#checkingExpType_maybe"><span class="hs-identifier hs-var">checkingExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681394492"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-comment">-- Instantiate</span><span>
</span><span id="line-331"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394484"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394484"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM Bool
</span><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var">wantQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394490"><span class="hs-identifier hs-var">rn_fun</span></a></span><span>
</span><span id="line-332"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394483"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394483"><span class="hs-identifier hs-var">delta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394482"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394482"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394481"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394481"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Bool
-&gt; (HsExpr GhcRn, AppCtxt)
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-var">tcInstFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394484"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394491"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394486"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394488"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>       </span><span class="hs-comment">-- Quick look at result</span><span>
</span><span id="line-335"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394480"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394480"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394484"><span class="hs-identifier hs-var">do_ql</span></a></span><span>
</span><span id="line-336"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-var">quickLookResultType</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394483"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394481"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681394492"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span>
</span><span id="line-337"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394481"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>       </span><span class="hs-comment">-- Unify with expected type from the context</span><span>
</span><span id="line-340"></span><span>       </span><span class="hs-comment">-- See Note [Unify with expected type before typechecking arguments]</span><span>
</span><span id="line-341"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-comment">-- perhaps_add_res_ty_ctxt: Inside an expansion, the addFunResCtxt stuff is</span><span>
</span><span id="line-343"></span><span>       </span><span class="hs-comment">--    more confusing than helpful because the function at the head isn't in</span><span>
</span><span id="line-344"></span><span>       </span><span class="hs-comment">--    the source program; it was added by the renamer.  See</span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-comment">--    Note [Handling overloaded and rebindable constructs] in GHC.Rename.Expr</span><span>
</span><span id="line-346"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621681394478"><span class="annot"><span class="annottext">perhaps_add_res_ty_ctxt :: TcM HsWrapper -&gt; TcM HsWrapper
</span><a href="#local-6989586621681394478"><span class="hs-identifier hs-var hs-var">perhaps_add_res_ty_ctxt</span></a></span></span><span> </span><span id="local-6989586621681394477"><span class="annot"><span class="annottext">TcM HsWrapper
</span><a href="#local-6989586621681394477"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-347"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#insideExpansion"><span class="hs-identifier hs-var">insideExpansion</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394489"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span>
</span><span id="line-348"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM HsWrapper
</span><a href="#local-6989586621681394477"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-349"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-350"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
HsExpr GhcRn
-&gt; [HsExprArg 'TcpRn] -&gt; TcType -&gt; ExpRhoType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Head.html#addFunResCtxt"><span class="hs-identifier hs-var">addFunResCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394490"><span class="hs-identifier hs-var">rn_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394488"><span class="hs-identifier hs-var">rn_args</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394480"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681394492"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-351"></span><span>                   </span><span class="annot"><span class="annottext">TcM HsWrapper
</span><a href="#local-6989586621681394477"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>       </span><span class="hs-comment">-- Match up app_res_rho: the result type of rn_expr</span><span>
</span><span id="line-354"></span><span>       </span><span class="hs-comment">--     with exp_res_ty:  the expected result type</span><span>
</span><span id="line-355"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394474"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394474"><span class="hs-identifier hs-var">do_ds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeepSubsumption</span></span><span>
</span><span id="line-356"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394471"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681394471"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM HsWrapper -&gt; TcM HsWrapper
</span><a href="#local-6989586621681394478"><span class="hs-identifier hs-var">perhaps_add_res_ty_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-357"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394474"><span class="hs-identifier hs-var">do_ds</span></a></span><span>
</span><span id="line-358"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- No deep subsumption</span><span>
</span><span id="line-359"></span><span>                 </span><span class="hs-comment">-- app_res_rho and exp_res_ty are both rho-types,</span><span>
</span><span id="line-360"></span><span>                 </span><span class="hs-comment">-- so with simple subsumption we can just unify them</span><span>
</span><span id="line-361"></span><span>                 </span><span class="hs-comment">-- No need to zonk; the unifier does that</span><span>
</span><span id="line-362"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394469"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394469"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcType -&gt; ExpRhoType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyExpectedType"><span class="hs-identifier hs-var">unifyExpectedType</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394493"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394480"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681394492"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span>
</span><span id="line-363"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394469"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- Deep subsumption</span><span>
</span><span id="line-366"></span><span>                 </span><span class="hs-comment">-- Even though both app_res_rho and exp_res_ty are rho-types,</span><span>
</span><span id="line-367"></span><span>                 </span><span class="hs-comment">-- they may have nested polymorphism, so if deep subsumption</span><span>
</span><span id="line-368"></span><span>                 </span><span class="hs-comment">-- is on we must call tcSubType.</span><span>
</span><span id="line-369"></span><span>                 </span><span class="hs-comment">-- Zonk app_res_rho first, becuase QL may have instantiated some</span><span>
</span><span id="line-370"></span><span>                 </span><span class="hs-comment">-- delta variables to polytypes, and tcSubType doesn't expect that</span><span>
</span><span id="line-371"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394466"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394466"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.App.html#zonkQuickLook"><span class="hs-identifier hs-var">zonkQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394484"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394480"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-372"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcType -&gt; ExpRhoType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypeDS"><span class="hs-identifier hs-var">tcSubTypeDS</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394493"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394466"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681394492"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-var">Opt_D_dump_tc_trace</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-375"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394461"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394461"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; TcM (HsExprArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#zonkArg"><span class="hs-identifier hs-var">zonkArg</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394482"><span class="hs-identifier hs-var">inst_args</span></a></span><span>  </span><span class="hs-comment">-- Only when tracing</span><span>
</span><span id="line-376"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcApp&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_fun&quot;</span></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394490"><span class="hs-identifier hs-var">rn_fun</span></a></span><span>
</span><span id="line-377"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inst_args&quot;</span></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#pprHsExprArgTc"><span class="hs-identifier hs-var">pprHsExprArgTc</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394461"><span class="hs-identifier hs-var">inst_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;do_ql:  &quot;</span></span><span>     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394484"><span class="hs-identifier hs-var">do_ql</span></a></span><span>
</span><span id="line-379"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fun_sigma:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394486"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span>
</span><span id="line-380"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;delta:      &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394483"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-381"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;app_res_rho:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394480"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-382"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;exp_res_ty:&quot;</span></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681394492"><span class="hs-identifier hs-var">exp_res_ty</span></a></span><span>
</span><span id="line-383"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_expr:&quot;</span></span><span>     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394493"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>       </span><span class="hs-comment">-- Typecheck the value arguments</span><span>
</span><span id="line-386"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394450"><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681394450"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
</span><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-var">tcValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394484"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394482"><span class="hs-identifier hs-var">inst_args</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>       </span><span class="hs-comment">-- Reconstruct, with special case for tagToEnum#</span><span>
</span><span id="line-389"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394449"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394449"><span class="hs-identifier hs-var">tc_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-var">isTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394490"><span class="hs-identifier hs-var">rn_fun</span></a></span><span>
</span><span id="line-390"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
-&gt; AppCtxt -&gt; [HsExprArg 'TcpTc] -&gt; TcType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcTagToEnum"><span class="hs-identifier hs-var">tcTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394487"><span class="hs-identifier hs-var">tc_fun</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394489"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681394450"><span class="hs-identifier hs-var">tc_args</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394480"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-391"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; AppCtxt -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394487"><span class="hs-identifier hs-var">tc_fun</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394489"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681394450"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>       </span><span class="hs-comment">-- Wrap the result</span><span>
</span><span id="line-394"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681394471"><span class="hs-identifier hs-var">res_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394449"><span class="hs-identifier hs-var">tc_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-397"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-type">wantQuickLook</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-398"></span><span id="wantQuickLook"><span class="annot"><span class="annottext">wantQuickLook :: HsExpr GhcRn -&gt; TcM Bool
</span><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var hs-var">wantQuickLook</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681394443"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681394443"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681394443"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[Unique]
</span><a href="GHC.Tc.Gen.App.html#quickLookKeys"><span class="hs-identifier hs-var">quickLookKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-400"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var">wantQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ImpredicativeTypes</span></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookKeys"><span class="hs-identifier hs-type">quickLookKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-403"></span><span class="hs-comment">-- See Note [Quick Look for particular Ids]</span><span>
</span><span id="line-404"></span><span id="quickLookKeys"><span class="annot"><span class="annottext">quickLookKeys :: [Unique]
</span><a href="GHC.Tc.Gen.App.html#quickLookKeys"><span class="hs-identifier hs-var hs-var">quickLookKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#dollarIdKey"><span class="hs-identifier hs-var">dollarIdKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#leftSectionKey"><span class="hs-identifier hs-var">leftSectionKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#rightSectionKey"><span class="hs-identifier hs-var">rightSectionKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#zonkQuickLook"><span class="hs-identifier hs-type">zonkQuickLook</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-407"></span><span class="hs-comment">-- After all Quick Look unifications are done, zonk to ensure that all</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- instantiation variables are substituted away</span><span>
</span><span id="line-409"></span><span class="hs-comment">--</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- So far as the paper is concerned, this step applies</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- the poly-substitution Theta, learned by QL, so that we</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- &quot;see&quot; the polymorphism in that type</span><span>
</span><span id="line-413"></span><span class="hs-comment">--</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- In implementation terms this ensures that no unification variable</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- linger on that have been filled in with a polytype</span><span>
</span><span id="line-416"></span><span id="zonkQuickLook"><span class="annot"><span class="annottext">zonkQuickLook :: Bool -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.App.html#zonkQuickLook"><span class="hs-identifier hs-var hs-var">zonkQuickLook</span></a></span></span><span> </span><span id="local-6989586621681394435"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394435"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span id="local-6989586621681394434"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394434"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394435"><span class="hs-identifier hs-var">do_ql</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394434"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394434"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">-- zonkArg is used *only* during debug-tracing, to make it easier to</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- see what is going on.  For that reason, it is not a full zonk: add</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- more if you need it.</span><span>
</span><span id="line-423"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#zonkArg"><span class="hs-identifier hs-type">zonkArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span id="zonkArg"><span class="annot"><span class="annottext">zonkArg :: HsExprArg 'TcpInst -&gt; TcM (HsExprArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#zonkArg"><span class="hs-identifier hs-var hs-var">zonkArg</span></a></span></span><span> </span><span id="local-6989586621681394432"><span class="annot"><span class="annottext">eva :: HsExprArg 'TcpInst
</span><a href="#local-6989586621681394432"><span class="hs-identifier hs-var">eva</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_arg_ty :: forall (p :: TcPass). HsExprArg p -&gt; XEVAType p
</span><a href="GHC.Tc.Gen.Head.html#eva_arg_ty"><span class="hs-identifier hs-var">eva_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681394428"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394428"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681394427"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394427"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394426"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394426"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394427"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-426"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExprArg 'TcpInst
</span><a href="#local-6989586621681394432"><span class="hs-identifier hs-var">eva</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_arg_ty :: XEVAType 'TcpInst
</span><a href="GHC.Tc.Gen.Head.html#eva_arg_ty"><span class="hs-identifier hs-var">eva_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394428"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394426"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-427"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#zonkArg"><span class="hs-identifier hs-var">zonkArg</span></a></span><span> </span><span id="local-6989586621681394425"><span class="annot"><span class="annottext">HsExprArg 'TcpInst
</span><a href="#local-6989586621681394425"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst
</span><a href="#local-6989586621681394425"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-type">tcValArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                    </span><span class="hs-comment">-- Quick-look on?</span><span>
</span><span id="line-433"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Actual argument</span><span>
</span><span id="line-434"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Resulting argument</span><span>
</span><span id="line-435"></span><span id="tcValArgs"><span class="annot"><span class="annottext">tcValArgs :: Bool -&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
</span><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-var hs-var">tcValArgs</span></a></span></span><span> </span><span id="local-6989586621681394424"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394424"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span id="local-6989586621681394423"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394423"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpInst -&gt; TcM (HsExprArg 'TcpTc)
</span><a href="#local-6989586621681394422"><span class="hs-identifier hs-var">tc_arg</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394423"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><a href="#local-6989586621681394422"><span class="hs-identifier hs-type">tc_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621681394422"><span class="annot"><span class="annottext">tc_arg :: HsExprArg 'TcpInst -&gt; TcM (HsExprArg 'TcpTc)
</span><a href="#local-6989586621681394422"><span class="hs-identifier hs-var hs-var">tc_arg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span id="local-6989586621681394420"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394420"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681394419"><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621681394419"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: TcPass).
AppCtxt -&gt; HsPragE (GhcPass (XPass p)) -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-var">EPrag</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394420"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsPragE GhcRn -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-var">tcExprPrag</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621681394419"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="#local-6989586621681394422"><span class="hs-identifier hs-var">tc_arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span id="local-6989586621681394417"><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621681394417"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621681394417"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><a href="#local-6989586621681394422"><span class="hs-identifier hs-var">tc_arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span id="local-6989586621681394415"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394415"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681394414"><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394414"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621681394413"><span class="annot"><span class="annottext">XETAType 'TcpInst
</span><a href="#local-6989586621681394413"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: TcPass).
AppCtxt -&gt; LHsWcType GhcRn -&gt; XETAType p -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-var">ETypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394415"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394414"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">XETAType 'TcpInst
</span><a href="#local-6989586621681394413"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="#local-6989586621681394422"><span class="hs-identifier hs-var">tc_arg</span></a></span><span> </span><span id="local-6989586621681394412"><span class="annot"><span class="annottext">eva :: HsExprArg 'TcpInst
</span><a href="#local-6989586621681394412"><span class="hs-identifier hs-var">eva</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_arg :: forall (p :: TcPass). HsExprArg p -&gt; EValArg p
</span><a href="GHC.Tc.Gen.Head.html#eva_arg"><span class="hs-identifier hs-var">eva_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394410"><span class="annot"><span class="annottext">EValArg 'TcpInst
</span><a href="#local-6989586621681394410"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_arg_ty :: forall (p :: TcPass). HsExprArg p -&gt; XEVAType p
</span><a href="GHC.Tc.Gen.Head.html#eva_arg_ty"><span class="hs-identifier hs-var">eva_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681394409"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394409"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681394408"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394408"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span>
</span><span id="line-444"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#eva_ctxt"><span class="hs-identifier hs-var">eva_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394406"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394406"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Crucial step: expose QL results before checking arg_ty</span><span>
</span><span id="line-446"></span><span>             </span><span class="hs-comment">-- So far as the paper is concerned, this step applies</span><span>
</span><span id="line-447"></span><span>             </span><span class="hs-comment">-- the poly-substitution Theta, learned by QL, so that we</span><span>
</span><span id="line-448"></span><span>             </span><span class="hs-comment">-- &quot;see&quot; the polymorphism in that argument type. E.g.</span><span>
</span><span id="line-449"></span><span>             </span><span class="hs-comment">--    (:) e ids, where ids :: [forall a. a-&gt;a]</span><span>
</span><span id="line-450"></span><span>             </span><span class="hs-comment">--                     (:) :: forall p. p-&gt;[p]-&gt;[p]</span><span>
</span><span id="line-451"></span><span>             </span><span class="hs-comment">-- Then Theta = [p :-&gt; forall a. a-&gt;a], and we want</span><span>
</span><span id="line-452"></span><span>             </span><span class="hs-comment">-- to check 'e' with expected type (forall a. a-&gt;a)</span><span>
</span><span id="line-453"></span><span>             </span><span class="hs-comment">-- See Note [Instantiation variables are short lived]</span><span>
</span><span id="line-454"></span><span>             </span><span id="local-6989586621681394405"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394405"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.App.html#zonkQuickLook"><span class="hs-identifier hs-var">zonkQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394424"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394408"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span>             </span><span class="hs-comment">-- Now check the argument</span><span>
</span><span id="line-457"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394404"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681394404"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394409"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-458"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcEValArg&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-459"></span><span>                          </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394406"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-460"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394405"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-461"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EValArg 'TcpInst
</span><a href="#local-6989586621681394410"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-462"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; EValArg 'TcpInst -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcEValArg"><span class="hs-identifier hs-var">tcEValArg</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394406"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">EValArg 'TcpInst
</span><a href="#local-6989586621681394410"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394405"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExprArg 'TcpInst
</span><a href="#local-6989586621681394412"><span class="hs-identifier hs-var">eva</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_arg :: EValArg 'TcpTc
</span><a href="GHC.Tc.Gen.Head.html#eva_arg"><span class="hs-identifier hs-var">eva_arg</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: TcPass). LHsExpr (GhcPass (XPass p)) -&gt; EValArg p
</span><a href="GHC.Tc.Gen.Head.html#ValArg"><span class="hs-identifier hs-var">ValArg</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681394404"><span class="hs-identifier hs-var">arg'</span></a></span><span>
</span><span id="line-465"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_arg_ty :: XEVAType 'TcpTc
</span><a href="GHC.Tc.Gen.Head.html#eva_arg_ty"><span class="hs-identifier hs-var">eva_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394409"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394405"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcEValArg"><span class="hs-identifier hs-type">tcEValArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span class="hs-comment">-- Typecheck one value argument of a function call</span><span>
</span><span id="line-469"></span><span id="tcEValArg"><span class="annot"><span class="annottext">tcEValArg :: AppCtxt -&gt; EValArg 'TcpInst -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcEValArg"><span class="hs-identifier hs-var hs-var">tcEValArg</span></a></span></span><span> </span><span id="local-6989586621681394400"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394400"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ValArg"><span class="hs-identifier hs-type">ValArg</span></a></span><span> </span><span id="local-6989586621681394399"><span class="annot"><span class="annottext">larg :: LHsExpr (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621681394399"><span class="hs-identifier hs-var">larg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681394398"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394398"><span class="hs-identifier hs-var">arg_loc</span></a></span></span><span> </span><span id="local-6989586621681394397"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394397"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394396"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394396"><span class="hs-identifier hs-var">exp_arg_sigma</span></a></span></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. AppCtxt -&gt; LHsExpr GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var">addArgCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394400"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpInst))
</span><a href="#local-6989586621681394399"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394394"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394394"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394397"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394396"><span class="hs-identifier hs-var">exp_arg_sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394398"><span class="hs-identifier hs-var">arg_loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394394"><span class="hs-identifier hs-var">arg'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcEValArg"><span class="hs-identifier hs-var">tcEValArg</span></a></span><span> </span><span id="local-6989586621681394392"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394392"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ValArgQL"><span class="hs-identifier hs-type">ValArgQL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">va_expr :: EValArg 'TcpInst -&gt; LHsExpr GhcRn
</span><a href="GHC.Tc.Gen.Head.html#va_expr"><span class="hs-identifier hs-var">va_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394379"><span class="annot"><span class="annottext">larg :: LHsExpr GhcRn
</span><a href="#local-6989586621681394379"><span class="hs-identifier hs-var">larg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681394378"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394378"><span class="hs-identifier hs-var">arg_loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">va_fun :: EValArg 'TcpInst -&gt; (HsExpr GhcTc, AppCtxt)
</span><a href="GHC.Tc.Gen.Head.html#va_fun"><span class="hs-identifier hs-var">va_fun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394376"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394376"><span class="hs-identifier hs-var">inner_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394375"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394375"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">va_args :: EValArg 'TcpInst -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#va_args"><span class="hs-identifier hs-var">va_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394373"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394373"><span class="hs-identifier hs-var">inner_args</span></a></span></span><span>
</span><span id="line-477"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">va_ty :: EValArg 'TcpInst -&gt; TcType
</span><a href="GHC.Tc.Gen.Head.html#va_ty"><span class="hs-identifier hs-var">va_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394371"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394371"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394370"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394370"><span class="hs-identifier hs-var">exp_arg_sigma</span></a></span></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. AppCtxt -&gt; LHsExpr GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var">addArgCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394392"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394379"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcEValArgQL {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394376"><span class="hs-identifier hs-var">inner_fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394373"><span class="hs-identifier hs-var">inner_args</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394369"><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681394369"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [HsExprArg 'TcpInst] -&gt; TcM [HsExprArg 'TcpTc]
</span><a href="GHC.Tc.Gen.App.html#tcValArgs"><span class="hs-identifier hs-var">tcValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394373"><span class="hs-identifier hs-var">inner_args</span></a></span><span>
</span><span id="line-481"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394368"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394368"><span class="hs-identifier hs-var">co</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394371"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394370"><span class="hs-identifier hs-var">exp_arg_sigma</span></a></span><span>
</span><span id="line-482"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcEValArg }&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-483"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394378"><span class="hs-identifier hs-var">arg_loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394368"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-484"></span><span>                 </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; AppCtxt -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394376"><span class="hs-identifier hs-var">inner_fun</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394375"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681394369"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Instantiating the call
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span class="hs-keyword">type</span><span> </span><span id="Delta"><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-var">Delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span>   </span><span class="hs-comment">-- Set of instantiation variables,</span><span>
</span><span id="line-493"></span><span>                          </span><span class="hs-comment">--   written \kappa in the QL paper</span><span>
</span><span id="line-494"></span><span>                          </span><span class="hs-comment">-- Just a set of ordinary unification variables,</span><span>
</span><span id="line-495"></span><span>                          </span><span class="hs-comment">--   but ones that QL may fill in with polytypes</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-type">tcInstFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- True  &lt;=&gt; Do quick-look</span><span>
</span><span id="line-498"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- False &lt;=&gt; Instantiate only /inferred/ variables at the end</span><span>
</span><span id="line-499"></span><span>                    </span><span class="hs-comment">--           so may return a sigma-typex</span><span>
</span><span id="line-500"></span><span>                    </span><span class="hs-comment">-- True  &lt;=&gt; Instantiate all type variables at the end:</span><span>
</span><span id="line-501"></span><span>                    </span><span class="hs-comment">--           return a rho-type</span><span>
</span><span id="line-502"></span><span>                    </span><span class="hs-comment">-- The /only/ call site that passes in False is the one</span><span>
</span><span id="line-503"></span><span>                    </span><span class="hs-comment">--    in tcInferSigma, which is used only to implement :type</span><span>
</span><span id="line-504"></span><span>                    </span><span class="hs-comment">-- Otherwise we do eager instantiation; in Fig 5 of the paper</span><span>
</span><span id="line-505"></span><span>                    </span><span class="hs-comment">--    |-inst returns a rho-type</span><span>
</span><span id="line-506"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- Error messages only</span><span>
</span><span id="line-507"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-508"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span>
</span><span id="line-509"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-510"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- This function implements the |-inst judgement in Fig 4, plus the</span><span>
</span><span id="line-512"></span><span class="hs-comment">-- modification in Fig 5, of the QL paper:</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- &quot;A quick look at impredicativity&quot; (ICFP'20).</span><span>
</span><span id="line-514"></span><span id="tcInstFun"><span class="annot"><span class="annottext">tcInstFun :: Bool
-&gt; Bool
-&gt; (HsExpr GhcRn, AppCtxt)
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-var hs-var">tcInstFun</span></a></span></span><span> </span><span id="local-6989586621681394363"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394363"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span id="local-6989586621681394362"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394362"><span class="hs-identifier hs-var">inst_final</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394361"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394361"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394360"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394360"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394359"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394359"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span> </span><span id="local-6989586621681394358"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394358"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInstFun&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394361"><span class="hs-identifier hs-var">rn_fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394359"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span>
</span><span id="line-516"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;args:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394358"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-517"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;do_ql&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394363"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394359"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394358"><span class="hs-identifier hs-var">rn_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-520"></span><span>    </span><span id="local-6989586621681394355"><span class="annot"><span class="annottext">fun_loc :: SrcSpan
</span><a href="#local-6989586621681394355"><span class="hs-identifier hs-var hs-var">fun_loc</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt -&gt; SrcSpan
</span><a href="GHC.Tc.Gen.Head.html#appCtxtLoc"><span class="hs-identifier hs-var">appCtxtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394360"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span>
</span><span id="line-521"></span><span>    </span><span id="local-6989586621681394353"><span class="annot"><span class="annottext">fun_orig :: CtOrigin
</span><a href="#local-6989586621681394353"><span class="hs-identifier hs-var hs-var">fun_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394360"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-522"></span><span>                               </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span id="local-6989586621681394350"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394350"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394350"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-523"></span><span>                               </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span id="local-6989586621681394348"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394348"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394348"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>    </span><span id="local-6989586621681394347"><span class="annot"><span class="annottext">set_fun_ctxt :: TcRn ([TcTyVar], HsWrapper, TcType)
-&gt; TcRn ([TcTyVar], HsWrapper, TcType)
</span><a href="#local-6989586621681394347"><span class="hs-identifier hs-var hs-var">set_fun_ctxt</span></a></span></span><span> </span><span id="local-6989586621681394346"><span class="annot"><span class="annottext">TcRn ([TcTyVar], HsWrapper, TcType)
</span><a href="#local-6989586621681394346"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681394355"><span class="hs-identifier hs-var">fun_loc</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- noSrcSpan =&gt; no arguments</span><span>
</span><span id="line-526"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn ([TcTyVar], HsWrapper, TcType)
</span><a href="#local-6989586621681394346"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>                  </span><span class="hs-comment">-- =&gt; context is already set</span><span>
</span><span id="line-527"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-528"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681394355"><span class="hs-identifier hs-var">fun_loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394360"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-530"></span><span>          </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span id="local-6989586621681394343"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394343"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394343"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn ([TcTyVar], HsWrapper, TcType)
</span><a href="#local-6989586621681394346"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-531"></span><span>          </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn ([TcTyVar], HsWrapper, TcType)
</span><a href="#local-6989586621681394346"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>    </span><span id="local-6989586621681394342"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681394342"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The function&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394361"><span class="hs-identifier hs-var">rn_fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is applied to&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-comment">-- Count value args only when complaining about a function</span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-comment">-- applied to too many value args</span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-comment">-- See Note [Herald for matchExpectedFunTys] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-539"></span><span>    </span><span id="local-6989586621681394339"><span class="annot"><span class="annottext">n_val_args :: Int
</span><a href="#local-6989586621681394339"><span class="hs-identifier hs-var hs-var">n_val_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; Int
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394358"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621681394336"><span class="annot"><span class="annottext">fun_is_out_of_scope :: Bool
</span><a href="#local-6989586621681394336"><span class="hs-identifier hs-var hs-var">fun_is_out_of_scope</span></a></span></span><span>  </span><span class="hs-comment">-- See Note [VTA for out-of-scope functions]</span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394361"><span class="hs-identifier hs-var">rn_fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-543"></span><span>          </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-544"></span><span>          </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>    </span><span class="annot"><a href="#local-6989586621681394334"><span class="hs-identifier hs-type">inst_all</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621681394334"><span class="annot"><span class="annottext">inst_all :: ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394334"><span class="hs-identifier hs-var hs-var">inst_all</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Invisible"><span class="hs-identifier hs-type">Invisible</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><a href="#local-6989586621681394334"><span class="hs-identifier hs-var">inst_all</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Required"><span class="hs-identifier hs-var">Required</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><a href="#local-6989586621681394331"><span class="hs-identifier hs-type">inst_inferred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-551"></span><span>    </span><span id="local-6989586621681394331"><span class="annot"><span class="annottext">inst_inferred :: ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394331"><span class="hs-identifier hs-var hs-var">inst_inferred</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Invisible"><span class="hs-identifier hs-type">Invisible</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#InferredSpec"><span class="hs-identifier hs-var">InferredSpec</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><a href="#local-6989586621681394331"><span class="hs-identifier hs-var">inst_inferred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Invisible"><span class="hs-identifier hs-type">Invisible</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-553"></span><span>    </span><span class="annot"><a href="#local-6989586621681394331"><span class="hs-identifier hs-var">inst_inferred</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Required"><span class="hs-identifier hs-var">Required</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>    </span><span class="annot"><a href="#local-6989586621681394328"><span class="hs-identifier hs-type">inst_fun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-556"></span><span>    </span><span id="local-6989586621681394328"><span class="annot"><span class="annottext">inst_fun :: [HsExprArg 'TcpRn] -&gt; ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394328"><span class="hs-identifier hs-var hs-var">inst_fun</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394362"><span class="hs-identifier hs-var">inst_final</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394334"><span class="hs-identifier hs-var">inst_all</span></a></span><span>
</span><span id="line-557"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394331"><span class="hs-identifier hs-var">inst_inferred</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><a href="#local-6989586621681394328"><span class="hs-identifier hs-var">inst_fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394334"><span class="hs-identifier hs-var">inst_all</span></a></span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><a href="#local-6989586621681394328"><span class="hs-identifier hs-var">inst_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394331"><span class="hs-identifier hs-var">inst_inferred</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-comment">-----------</span><span>
</span><span id="line-562"></span><span>    </span><span class="annot"><a href="#local-6989586621681394357"><span class="hs-identifier hs-type">go</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681394327"><span class="hs-identifier hs-type">go1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span>
</span><span id="line-563"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Accumulator, reversed</span><span>
</span><span id="line-564"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Value args to which applied so far</span><span>
</span><span id="line-565"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-566"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-comment">-- go: If fun_ty=kappa, look it up in Theta</span><span>
</span><span id="line-569"></span><span>    </span><span id="local-6989586621681394357"><span class="annot"><span class="annottext">go :: Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681394326"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394326"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394325"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394325"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681394324"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394324"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681394323"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394323"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681394322"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394322"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-570"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681394321"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394321"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcTyVar
</span><a href="GHC.Tc.Utils.TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394323"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-571"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394321"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394326"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-572"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394318"><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621681394318"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394321"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-573"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621681394318"><span class="hs-identifier hs-var">cts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-574"></span><span>                </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621681394315"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394315"><span class="hs-identifier hs-var">fun_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var">go</span></a></span><span>  </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394326"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394325"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394324"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394315"><span class="hs-identifier hs-var">fun_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394322"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-575"></span><span>                </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394326"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394325"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394324"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394323"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394322"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-576"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-577"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394326"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394325"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394324"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394323"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394322"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-comment">-- go1: fun_ty is not filled-in instantiation variable</span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-comment">--      ('go' dealt with that case)</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span>    </span><span class="hs-comment">-- Rule IALL from Fig 4 of the QL paper</span><span>
</span><span id="line-583"></span><span>    </span><span class="hs-comment">-- c.f. GHC.Tc.Utils.Instantiate.topInstantiate</span><span>
</span><span id="line-584"></span><span>    </span><span id="local-6989586621681394327"><span class="annot"><span class="annottext">go1 :: Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394327"><span class="hs-identifier hs-var hs-var">go1</span></a></span></span><span> </span><span id="local-6989586621681394313"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394313"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394312"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394312"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681394311"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394311"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681394310"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394310"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681394309"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394309"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394308"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394308"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621681394307"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394307"><span class="hs-identifier hs-var">body1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ArgFlag -&gt; Bool) -&gt; TcType -&gt; ([TcTyVar], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSomeForAllTyVars"><span class="hs-identifier hs-var">tcSplitSomeForAllTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn] -&gt; ArgFlag -&gt; Bool
</span><a href="#local-6989586621681394328"><span class="hs-identifier hs-var">inst_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394309"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394310"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-586"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394305"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394305"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394304"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394304"><span class="hs-identifier hs-var">body2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; (ThetaType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394307"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-587"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394308"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394305"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394300"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394300"><span class="hs-identifier hs-var">inst_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394299"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681394299"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394298"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394298"><span class="hs-identifier hs-var">fun_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn ([TcTyVar], HsWrapper, TcType)
-&gt; TcRn ([TcTyVar], HsWrapper, TcType)
</span><a href="#local-6989586621681394347"><span class="hs-identifier hs-var">set_fun_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-589"></span><span>                                          </span><span class="annot"><span class="annottext">CtOrigin
-&gt; [TcTyVar]
-&gt; ThetaType
-&gt; TcType
-&gt; TcRn ([TcTyVar], HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#instantiateSigma"><span class="hs-identifier hs-var">instantiateSigma</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681394353"><span class="hs-identifier hs-var">fun_orig</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394308"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394305"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394304"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-590"></span><span>                 </span><span class="hs-comment">-- set_fun_ctxt: important for the class constraints</span><span>
</span><span id="line-591"></span><span>                 </span><span class="hs-comment">-- that may be emitted from instantiating fun_sigma</span><span>
</span><span id="line-592"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394313"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; [TcTyVar] -&gt; Delta
</span><a href="GHC.Types.Var.Set.html#extendVarSetList"><span class="hs-operator hs-var">`extendVarSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394300"><span class="hs-identifier hs-var">inst_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-var">addArgWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681394299"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394312"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394311"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394298"><span class="hs-identifier hs-var">fun_rho</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394309"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-594"></span><span>                </span><span class="hs-comment">-- Going around again means we deal easily with</span><span>
</span><span id="line-595"></span><span>                </span><span class="hs-comment">-- nested  forall a. Eq a =&gt; forall b. Show b =&gt; blah</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>    </span><span class="hs-comment">-- Rule IRESULT from Fig 4 of the QL paper</span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621681394294"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394294"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394293"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394293"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681394292"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394292"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-599"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInstFun:ret&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394292"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394294"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394293"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394292"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>    </span><span class="annot"><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621681394290"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394290"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394289"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394289"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681394288"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394288"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681394287"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394287"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span id="local-6989586621681394286"><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621681394286"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681394285"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394285"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394290"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: TcPass). EWrap -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-var">EWrap</span></a></span><span> </span><span class="annot"><span class="annottext">EWrap
</span><a href="#local-6989586621681394286"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394289"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394288"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394287"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394285"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621681394284"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394284"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394283"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394283"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681394282"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394282"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681394281"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394281"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span id="local-6989586621681394280"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394280"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621681394279"><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621681394279"><span class="hs-identifier hs-var">prag</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681394278"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394278"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394284"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: TcPass).
AppCtxt -&gt; HsPragE (GhcPass (XPass p)) -&gt; HsExprArg p
</span><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-var">EPrag</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394280"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621681394279"><span class="hs-identifier hs-var">prag</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394283"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394282"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394281"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394278"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-comment">-- Rule ITYARG from Fig 4 of the QL paper</span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621681394277"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394277"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394276"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394276"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681394275"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394275"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681394274"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394274"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#eva_ctxt"><span class="hs-identifier hs-var">eva_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394273"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394273"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_hs_ty :: forall (p :: TcPass). HsExprArg p -&gt; LHsWcType GhcRn
</span><a href="GHC.Tc.Gen.Head.html#eva_hs_ty"><span class="hs-identifier hs-var">eva_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394271"><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394271"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-610"></span><span>                                </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681394270"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394270"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394336"><span class="hs-identifier hs-var">fun_is_out_of_scope</span></a></span><span>   </span><span class="hs-comment">-- See Note [VTA for out-of-scope functions]</span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394277"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394276"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394275"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394274"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394270"><span class="hs-identifier hs-var">rest_args</span></a></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-615"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394269"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394269"><span class="hs-identifier hs-var">ty_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394268"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394268"><span class="hs-identifier hs-var">inst_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; LHsWcType GhcRn -&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tcVTA"><span class="hs-identifier hs-var">tcVTA</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394274"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394271"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-616"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394266"><span class="annot"><span class="annottext">arg' :: HsExprArg 'TcpInst
</span><a href="#local-6989586621681394266"><span class="hs-identifier hs-var hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_ctxt :: AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#eva_ctxt"><span class="hs-identifier hs-var">eva_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394273"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_hs_ty :: LHsWcType GhcRn
</span><a href="GHC.Tc.Gen.Head.html#eva_hs_ty"><span class="hs-identifier hs-var">eva_hs_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394271"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_ty :: XETAType 'TcpInst
</span><a href="GHC.Tc.Gen.Head.html#eva_ty"><span class="hs-identifier hs-var">eva_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394269"><span class="hs-identifier hs-var">ty_arg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-617"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394277"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExprArg 'TcpInst
</span><a href="#local-6989586621681394266"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394276"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394275"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394268"><span class="hs-identifier hs-var">inst_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394270"><span class="hs-identifier hs-var">rest_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>    </span><span class="hs-comment">-- Rule IVAR from Fig 4 of the QL paper:</span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621681394264"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394264"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394263"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394263"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681394262"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394262"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681394261"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394261"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681394260"><span class="annot"><span class="annottext">args :: [HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394260"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681394259"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394259"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcTyVar
</span><a href="GHC.Tc.Utils.TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394261"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-622"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394259"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394264"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-623"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Function type was of form   f :: forall a b. t1 -&gt; t2 -&gt; b</span><span>
</span><span id="line-624"></span><span>        </span><span class="hs-comment">-- with 'b', one of the quantified type variables, in the corner</span><span>
</span><span id="line-625"></span><span>        </span><span class="hs-comment">-- but the call applies it to three or more value args.</span><span>
</span><span id="line-626"></span><span>        </span><span class="hs-comment">-- Suppose b is instantiated by kappa.  Then we want to make fresh</span><span>
</span><span id="line-627"></span><span>        </span><span class="hs-comment">-- instantiation variables nu1, nu2, and set kappa := nu1 -&gt; nu2</span><span>
</span><span id="line-628"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-629"></span><span>        </span><span class="hs-comment">-- In principle what is happening here is not unlike matchActualFunTysRho</span><span>
</span><span id="line-630"></span><span>        </span><span class="hs-comment">-- but there are many small differences:</span><span>
</span><span id="line-631"></span><span>        </span><span class="hs-comment">--   - We know that the function type in unfilled meta-tyvar</span><span>
</span><span id="line-632"></span><span>        </span><span class="hs-comment">--     matchActualFunTysRho is much more general, has a loop, etc.</span><span>
</span><span id="line-633"></span><span>        </span><span class="hs-comment">--   - We must be sure to actually update the variable right now,</span><span>
</span><span id="line-634"></span><span>        </span><span class="hs-comment">--     not defer in any way, because this is a QL instantiation variable.</span><span>
</span><span id="line-635"></span><span>        </span><span class="hs-comment">--   - We need the freshly allocated unification variables, to extend</span><span>
</span><span id="line-636"></span><span>        </span><span class="hs-comment">--     delta with.</span><span>
</span><span id="line-637"></span><span>        </span><span class="hs-comment">-- It's easier just to do the job directly here.</span><span>
</span><span id="line-638"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394258"><span class="annot"><span class="annottext">valArgsCount :: Int
</span><a href="#local-6989586621681394258"><span class="hs-identifier hs-var hs-var">valArgsCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (id :: TcPass). [HsExprArg id] -&gt; Int
</span><a href="GHC.Tc.Gen.Head.html#countLeadingValArgs"><span class="hs-identifier hs-var">countLeadingValArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394260"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-639"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394256"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394256"><span class="hs-identifier hs-var">arg_nus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681394258"><span class="hs-identifier hs-var">valArgsCount</span></a></span><span> </span><span class="annot"><span class="annottext">TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVar"><span class="hs-identifier hs-var">newOpenFlexiTyVar</span></a></span><span>
</span><span id="line-640"></span><span>             </span><span class="hs-comment">-- We need variables for multiplicity (#18731)</span><span>
</span><span id="line-641"></span><span>             </span><span class="hs-comment">-- Otherwise, 'undefined x' wouldn't be linear in x</span><span>
</span><span id="line-642"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394253"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394253"><span class="hs-identifier hs-var">mults</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681394258"><span class="hs-identifier hs-var">valArgsCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394251"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394251"><span class="hs-identifier hs-var">res_nu</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVar"><span class="hs-identifier hs-var">newOpenFlexiTyVar</span></a></span><span>
</span><span id="line-644"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394250"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394250"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394259"><span class="hs-identifier hs-var">kappa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394246"><span class="annot"><span class="annottext">delta' :: Delta
</span><a href="#local-6989586621681394246"><span class="hs-identifier hs-var hs-var">delta'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394264"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; [TcTyVar] -&gt; Delta
</span><a href="GHC.Types.Var.Set.html#extendVarSetList"><span class="hs-operator hs-var">`extendVarSetList`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394251"><span class="hs-identifier hs-var">res_nu</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394256"><span class="hs-identifier hs-var">arg_nus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>                 </span><span id="local-6989586621681394245"><span class="annot"><span class="annottext">arg_tys :: ThetaType
</span><a href="#local-6989586621681394245"><span class="hs-identifier hs-var hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394256"><span class="hs-identifier hs-var">arg_nus</span></a></span><span>
</span><span id="line-647"></span><span>                 </span><span id="local-6989586621681394243"><span class="annot"><span class="annottext">res_ty :: TcType
</span><a href="#local-6989586621681394243"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394251"><span class="hs-identifier hs-var">res_nu</span></a></span><span>
</span><span id="line-648"></span><span>                 </span><span id="local-6989586621681394241"><span class="annot"><span class="annottext">fun_ty' :: TcType
</span><a href="#local-6989586621681394241"><span class="hs-identifier hs-var hs-var">fun_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. String -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInstFun&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#mkScaled"><span class="hs-identifier hs-var">mkScaled</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394253"><span class="hs-identifier hs-var">mults</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394245"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394243"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-649"></span><span>                 </span><span id="local-6989586621681394237"><span class="annot"><span class="annottext">co_wrap :: HsWrapper
</span><a href="#local-6989586621681394237"><span class="hs-identifier hs-var hs-var">co_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TcType -&gt; TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcGReflLeftCo"><span class="hs-identifier hs-var">mkTcGReflLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394241"><span class="hs-identifier hs-var">fun_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394250"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>                 </span><span id="local-6989586621681394234"><span class="annot"><span class="annottext">acc' :: [HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394234"><span class="hs-identifier hs-var hs-var">acc'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-var">addArgWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681394237"><span class="hs-identifier hs-var">co_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394263"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-651"></span><span>                 </span><span class="hs-comment">-- Suppose kappa :: kk</span><span>
</span><span id="line-652"></span><span>                 </span><span class="hs-comment">-- Then fun_ty :: kk, fun_ty' :: Type, kind_co :: Type ~ kk</span><span>
</span><span id="line-653"></span><span>                 </span><span class="hs-comment">--      co_wrap :: (fun_ty' |&gt; kind_co) ~ fun_ty'</span><span>
</span><span id="line-654"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394259"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcCoercionN -&gt; TcType
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394241"><span class="hs-identifier hs-var">fun_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394250"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>                 </span><span class="hs-comment">-- kappa is uninstantiated ('go' already checked that)</span><span>
</span><span id="line-656"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394246"><span class="hs-identifier hs-var">delta'</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394234"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394262"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394241"><span class="hs-identifier hs-var">fun_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394260"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-comment">-- Rule IARG from Fig 4 of the QL paper:</span><span>
</span><span id="line-659"></span><span>    </span><span class="annot"><a href="#local-6989586621681394327"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span id="local-6989586621681394231"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394231"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394230"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394230"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681394229"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394229"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681394228"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394228"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span>
</span><span id="line-660"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681394227"><span class="annot"><span class="annottext">eva :: HsExprArg 'TcpRn
</span><a href="#local-6989586621681394227"><span class="hs-identifier hs-var">eva</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_arg :: forall (p :: TcPass). HsExprArg p -&gt; EValArg p
</span><a href="GHC.Tc.Gen.Head.html#eva_arg"><span class="hs-identifier hs-var">eva_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ValArg"><span class="hs-identifier hs-type">ValArg</span></a></span><span> </span><span id="local-6989586621681394226"><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621681394226"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_ctxt :: forall (p :: TcPass). HsExprArg p -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#eva_ctxt"><span class="hs-identifier hs-var">eva_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394225"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394225"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681394224"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394224"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394223"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681394223"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394222"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681394222"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394221"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394221"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; Maybe SDoc
-&gt; (Int, [Scaled TcType])
-&gt; TcType
-&gt; TcM (HsWrapper, Scaled TcType, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTySigma"><span class="hs-identifier hs-var">matchActualFunTySigma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681394342"><span class="hs-identifier hs-var">herald</span></a></span><span>
</span><span id="line-662"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394361"><span class="hs-identifier hs-var">rn_fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681394339"><span class="hs-identifier hs-var">n_val_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394229"><span class="hs-identifier hs-var">so_far</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394228"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-664"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394219"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394219"><span class="hs-identifier hs-var">delta'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394218"><span class="annot"><span class="annottext">EValArg 'TcpInst
</span><a href="#local-6989586621681394218"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394363"><span class="hs-identifier hs-var">do_ql</span></a></span><span>
</span><span id="line-665"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. AppCtxt -&gt; LHsExpr GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var">addArgCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394225"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621681394226"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-666"></span><span>                                   </span><span class="hs-comment">-- Context needed for constraints</span><span>
</span><span id="line-667"></span><span>                                   </span><span class="hs-comment">-- generated by calls in arg</span><span>
</span><span id="line-668"></span><span>                                   </span><span class="annot"><span class="annottext">Delta
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#quickLookArg"><span class="hs-identifier hs-var">quickLookArg</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394231"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621681394226"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681394222"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-669"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394231"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (p :: TcPass). LHsExpr (GhcPass (XPass p)) -&gt; EValArg p
</span><a href="GHC.Tc.Gen.Head.html#ValArg"><span class="hs-identifier hs-var">ValArg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass (XPass 'TcpRn))
</span><a href="#local-6989586621681394226"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394216"><span class="annot"><span class="annottext">acc' :: [HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394216"><span class="hs-identifier hs-var hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExprArg 'TcpRn
</span><a href="#local-6989586621681394227"><span class="hs-identifier hs-var">eva</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eva_arg :: EValArg 'TcpInst
</span><a href="GHC.Tc.Gen.Head.html#eva_arg"><span class="hs-identifier hs-var">eva_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EValArg 'TcpInst
</span><a href="#local-6989586621681394218"><span class="hs-identifier hs-var">arg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eva_arg_ty :: XEVAType 'TcpInst
</span><a href="GHC.Tc.Gen.Head.html#eva_arg_ty"><span class="hs-identifier hs-var">eva_arg_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681394222"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-671"></span><span>                       </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [HsExprArg 'TcpInst] -&gt; [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#addArgWrap"><span class="hs-identifier hs-var">addArgWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681394223"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394230"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-672"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Delta
-&gt; [HsExprArg 'TcpInst]
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="#local-6989586621681394357"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394219"><span class="hs-identifier hs-var">delta'</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394216"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681394222"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681394229"><span class="hs-identifier hs-var">so_far</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394221"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394224"><span class="hs-identifier hs-var">rest_args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span id="local-6989586621681394791"><span class="annot"><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-type">addArgCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-676"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681394791"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681394791"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-677"></span><span class="hs-comment">-- Adds a &quot;In the third argument of f, namely blah&quot;</span><span>
</span><span id="line-678"></span><span class="hs-comment">-- context, unless we are in generated code, in which case</span><span>
</span><span id="line-679"></span><span class="hs-comment">-- use &quot;In the expression: arg&quot;</span><span>
</span><span id="line-680"></span><span class="hs-comment">---See Note [Rebindable syntax and HsExpansion] in GHC.Hs.Expr</span><span>
</span><span id="line-681"></span><span id="addArgCtxt"><span class="annot"><span class="annottext">addArgCtxt :: forall a. AppCtxt -&gt; LHsExpr GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var hs-var">addArgCtxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-type">VACall</span></a></span><span> </span><span id="local-6989586621681394213"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394213"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681394212"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681394212"><span class="hs-identifier hs-var">arg_no</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681394211"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394211"><span class="hs-identifier hs-var">arg_loc</span></a></span></span><span> </span><span id="local-6989586621681394210"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394210"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394209"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681394209"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394211"><span class="hs-identifier hs-var">arg_loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-683"></span><span>    </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall fun arg.
(Outputable fun, Outputable arg) =&gt;
fun -&gt; arg -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394213"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394210"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681394212"><span class="hs-identifier hs-var">arg_no</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-684"></span><span>    </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681394209"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#addArgCtxt"><span class="hs-identifier hs-var">addArgCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#VAExpansion"><span class="hs-identifier hs-type">VAExpansion</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681394206"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394206"><span class="hs-identifier hs-var">arg_loc</span></a></span></span><span> </span><span id="local-6989586621681394205"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394205"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394204"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681394204"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681394206"><span class="hs-identifier hs-var">arg_loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-688"></span><span>    </span><span class="annot"><span class="annottext">forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394205"><span class="hs-identifier hs-var">arg</span></a></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Auto-suppressed if arg_loc is generated</span><span>
</span><span id="line-689"></span><span>    </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681394204"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Visible type application
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcVTA"><span class="hs-identifier hs-type">tcVTA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>            </span><span class="hs-comment">-- Function type</span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="hs-comment">-- Argument type</span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span class="hs-comment">-- Deal with a visible type application</span><span>
</span><span id="line-701"></span><span class="hs-comment">-- The function type has already had its Inferred binders instantiated</span><span>
</span><span id="line-702"></span><span id="tcVTA"><span class="annot"><span class="annottext">tcVTA :: TcType -&gt; LHsWcType GhcRn -&gt; TcM (TcType, TcType)
</span><a href="GHC.Tc.Gen.App.html#tcVTA"><span class="hs-identifier hs-var hs-var">tcVTA</span></a></span></span><span> </span><span id="local-6989586621681394203"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394203"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681394202"><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394202"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394201"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681394201"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394200"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394200"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TyVarBinder, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinder_maybe"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinder_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394203"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderArgFlag"><span class="hs-identifier hs-var">binderArgFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681394201"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Specified"><span class="hs-identifier hs-var">Specified</span></a></span><span>
</span><span id="line-705"></span><span>    </span><span class="hs-comment">-- It really can't be Inferred, because we've just</span><span>
</span><span id="line-706"></span><span>    </span><span class="hs-comment">-- instantiated those. But, oddly, it might just be Required.</span><span>
</span><span id="line-707"></span><span>    </span><span class="hs-comment">-- See Note [Required quantifiers in the type of a term]</span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394196"><span class="annot"><span class="annottext">tv :: TcTyVar
</span><a href="#local-6989586621681394196"><span class="hs-identifier hs-var hs-var">tv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681394201"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-709"></span><span>             </span><span id="local-6989586621681394194"><span class="annot"><span class="annottext">kind :: TcType
</span><a href="#local-6989586621681394194"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394196"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-710"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394193"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394193"><span class="hs-identifier hs-var">ty_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTypeApp"><span class="hs-identifier hs-var">tcHsTypeApp</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394202"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394194"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394191"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394191"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394200"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-713"></span><span>             </span><span class="hs-comment">-- See Note [Visible type application zonk]</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394190"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621681394190"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThetaType -&gt; Delta
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394203"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394193"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>             </span><span id="local-6989586621681394188"><span class="annot"><span class="annottext">insted_ty :: TcType
</span><a href="#local-6989586621681394188"><span class="hs-identifier hs-var hs-var">insted_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; [TcTyVar] -&gt; ThetaType -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier hs-var">substTyWithInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681394190"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394196"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394193"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394191"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-717"></span><span>                         </span><span class="hs-comment">-- NB: tv and ty_arg have the same kind, so this</span><span>
</span><span id="line-718"></span><span>                         </span><span class="hs-comment">--     substitution is kind-respecting</span><span>
</span><span id="line-719"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VTA&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394196"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394194"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-720"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394193"><span class="hs-identifier hs-var">ty_arg</span></a></span><span>
</span><span id="line-721"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394193"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394191"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-723"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394188"><span class="hs-identifier hs-var">insted_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394193"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394188"><span class="hs-identifier hs-var">insted_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394185"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394185"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcType -&gt; TcM (TidyEnv, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394203"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-728"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-729"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot apply expression of type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394185"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-730"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;to a visible type argument&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
</span><a href="#local-6989586621681394202"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-comment">{- Note [Required quantifiers in the type of a term]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#15859)

  data A k :: k -&gt; Type      -- A      :: forall k -&gt; k -&gt; Type
  type KindOf (a :: k) = k   -- KindOf :: forall k. k -&gt; Type
  a = (undefined :: KindOf A) @Int

With ImpredicativeTypes (thin ice, I know), we instantiate
KindOf at type (forall k -&gt; k -&gt; Type), so
  KindOf A = forall k -&gt; k -&gt; Type
whose first argument is Required

We want to reject this type application to Int, but in earlier
GHCs we had an ASSERT that Required could not occur here.

The ice is thin; c.f. Note [No Required TyCoBinder in terms]
in GHC.Core.TyCo.Rep.

Note [VTA for out-of-scope functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose 'wurble' is not in scope, and we have
   (wurble @Int @Bool True 'x')

Then the renamer will make (HsUnboundVar &quot;wurble) for 'wurble',
and the typechecker will typecheck it with tcUnboundId, giving it
a type 'alpha', and emitting a deferred Hole constraint, to
be reported later.

But then comes the visible type application. If we do nothing, we'll
generate an immediate failure (in tc_app_err), saying that a function
of type 'alpha' can't be applied to Bool.  That's insane!  And indeed
users complain bitterly (#13834, #17150.)

The right error is the Hole, which has /already/ been emitted by
tcUnboundId.  It later reports 'wurble' as out of scope, and tries to
give its type.

Fortunately in tcInstFun we still have access to the function, so we
can check if it is a HsUnboundVar.  We use this info to simply skip
over any visible type arguments.  We've already inferred the type of
the function (in tcInferAppHead), so we'll /already/ have emitted a
Hole constraint; failing preserves that constraint.

We do /not/ want to fail altogether in this case (via failM) because
that may abandon an entire instance decl, which (in the presence of
-fdefer-type-errors) leads to leading to #17792.

Downside; the typechecked term has lost its visible type arguments; we
don't even kind-check them.  But let's jump that bridge if we come to
it.  Meanwhile, let's not crash!


Note [Visible type application zonk]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Substitutions should be kind-preserving, so we need kind(tv) = kind(ty_arg).

* tcHsTypeApp only guarantees that
    - ty_arg is zonked
    - kind(zonk(tv)) = kind(ty_arg)
  (checkExpectedKind zonks as it goes).

So we must zonk inner_ty as well, to guarantee consistency between zonk(tv)
and inner_ty. Otherwise we can build an ill-kinded type. An example was #14158,
where we had:
   id :: forall k. forall (cat :: k -&gt; k -&gt; *). forall (a :: k). cat a a
and we had the visible type application
  id @(-&gt;)

* We instantiated k := kappa, yielding
    forall (cat :: kappa -&gt; kappa -&gt; *). forall (a :: kappa). cat a a
* Then we called tcHsTypeApp (-&gt;) with expected kind (kappa -&gt; kappa -&gt; *).
* That instantiated (-&gt;) as ((-&gt;) q1 q1), and unified kappa := q1,
  Here q1 :: RuntimeRep
* Now we substitute
     cat  :-&gt;  (-&gt;) q1 q1 :: TYPE q1 -&gt; TYPE q1 -&gt; *
  but we must first zonk the inner_ty to get
      forall (a :: TYPE q1). cat a a
  so that the result of substitution is well-kinded
  Failing to do so led to #14158.

-}</span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Quick Look
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span class="hs-comment">{- Note [Quick Look at value arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The function quickLookArg implements the &quot;QL argument&quot; judgement of
the QL paper, in Fig 5 of &quot;A quick look at impredicativity&quot; (ICFP 2020),
rather directly.

Wrinkles:

* We avoid zonking, so quickLookArg thereby sees the argument type /before/
  the QL substitution Theta is applied to it. So we achieve argument-order
  independence for free (see 5.7 in the paper).

* When we quick-look at an argument, we save the work done, by returning
  an EValArg with a ValArgQL inside it.  (It started life with a ValArg
  inside.)  The ValArgQL remembers all the work that QL did (notably,
  decomposing the argument and instantiating) so that tcValArgs does
  not need to repeat it.  Rather neat, and remarkably easy.
-}</span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-841"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookArg"><span class="hs-identifier hs-type">quickLookArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span>
</span><span id="line-842"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>       </span><span class="hs-comment">-- Argument</span><span>
</span><span id="line-843"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>  </span><span class="hs-comment">-- Type expected by the function</span><span>
</span><span id="line-844"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span class="hs-comment">-- See Note [Quick Look at value arguments]</span><span>
</span><span id="line-846"></span><span class="hs-comment">--</span><span>
</span><span id="line-847"></span><span class="hs-comment">-- The returned Delta is a superset of the one passed in</span><span>
</span><span id="line-848"></span><span class="hs-comment">-- with added instantiation variables from</span><span>
</span><span id="line-849"></span><span class="hs-comment">--   (a) the call itself</span><span>
</span><span id="line-850"></span><span class="hs-comment">--   (b) the arguments of the call</span><span>
</span><span id="line-851"></span><span id="quickLookArg"><span class="annot"><span class="annottext">quickLookArg :: Delta
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#quickLookArg"><span class="hs-identifier hs-var hs-var">quickLookArg</span></a></span></span><span> </span><span id="local-6989586621681394181"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394181"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394180"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394180"><span class="hs-identifier hs-var">larg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681394179"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394179"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394181"><span class="hs-identifier hs-var">delta</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; LHsExpr GhcRn -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var">skipQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394181"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394180"><span class="hs-identifier hs-var">larg</span></a></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="#local-6989586621681394176"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394179"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-855"></span><span>    </span><span id="local-6989586621681394175"><span class="annot"><span class="annottext">guarded :: Bool
</span><a href="#local-6989586621681394175"><span class="hs-identifier hs-var hs-var">guarded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#isGuardedTy"><span class="hs-identifier hs-var">isGuardedTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394179"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-856"></span><span>      </span><span class="hs-comment">-- NB: guardedness is computed based on the original,</span><span>
</span><span id="line-857"></span><span>      </span><span class="hs-comment">-- unzonked arg_ty, so we deliberately do not exploit</span><span>
</span><span id="line-858"></span><span>      </span><span class="hs-comment">-- guardedness that emerges a result of QL on earlier args</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span>    </span><span id="local-6989586621681394176"><span class="annot"><span class="annottext">go :: TcType -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="#local-6989586621681394176"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681394173"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394173"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isRhoTy"><span class="hs-identifier hs-var">isRhoTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394173"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; LHsExpr GhcRn -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var">skipQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394181"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394180"><span class="hs-identifier hs-var">larg</span></a></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>              </span><span class="hs-comment">-- This top-level zonk step, which is the reason</span><span>
</span><span id="line-864"></span><span>              </span><span class="hs-comment">-- we need a local 'go' loop, is subtle</span><span>
</span><span id="line-865"></span><span>              </span><span class="hs-comment">-- See Section 9 of the QL paper</span><span>
</span><span id="line-866"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681394171"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394171"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcTyVar
</span><a href="GHC.Tc.Utils.TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394173"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-867"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394171"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394181"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-868"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394170"><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621681394170"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394171"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-869"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621681394170"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-870"></span><span>                       </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621681394169"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394169"><span class="hs-identifier hs-var">arg_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="#local-6989586621681394176"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394169"><span class="hs-identifier hs-var">arg_ty'</span></a></span><span>
</span><span id="line-871"></span><span>                       </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Delta
-&gt; LHsExpr GhcRn
-&gt; TcType
-&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#quickLookArg1"><span class="hs-identifier hs-var">quickLookArg1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394175"><span class="hs-identifier hs-var">guarded</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394181"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394180"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394173"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-874"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Delta
-&gt; LHsExpr GhcRn
-&gt; TcType
-&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#quickLookArg1"><span class="hs-identifier hs-var">quickLookArg1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394175"><span class="hs-identifier hs-var">guarded</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394181"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394180"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394173"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#isGuardedTy"><span class="hs-identifier hs-type">isGuardedTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-877"></span><span id="isGuardedTy"><span class="annot"><span class="annottext">isGuardedTy :: TcType -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#isGuardedTy"><span class="hs-identifier hs-var hs-var">isGuardedTy</span></a></span></span><span> </span><span id="local-6989586621681394167"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394167"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-878"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394166"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394166"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ThetaType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TcType -&gt; Maybe (TyCon, ThetaType)
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394167"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394166"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-879"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394167"><span class="hs-identifier hs-var">ty</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-881"></span><span>
</span><span id="line-882"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookArg1"><span class="hs-identifier hs-type">quickLookArg1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-883"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span id="quickLookArg1"><span class="annot"><span class="annottext">quickLookArg1 :: Bool
-&gt; Delta
-&gt; LHsExpr GhcRn
-&gt; TcType
-&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#quickLookArg1"><span class="hs-identifier hs-var hs-var">quickLookArg1</span></a></span></span><span> </span><span id="local-6989586621681394162"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394162"><span class="hs-identifier hs-var">guarded</span></a></span></span><span> </span><span id="local-6989586621681394161"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394161"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394160"><span class="annot"><span class="annottext">larg :: LHsExpr GhcRn
</span><a href="#local-6989586621681394160"><span class="hs-identifier hs-var">larg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681394159"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394159"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394158"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394158"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span>
</span><span id="line-885"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394157"><span class="annot"><span class="annottext">fun :: (HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394157"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681394156"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394156"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394155"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394155"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394154"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394154"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ((HsExpr GhcRn, AppCtxt), [HsExprArg 'TcpRn])
</span><a href="GHC.Tc.Gen.Head.html#splitHsApps"><span class="hs-identifier hs-var">splitHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394159"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-886"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394153"><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681394153"><span class="hs-identifier hs-var">mb_fun_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; [HsExprArg 'TcpRn]
-&gt; Maybe TcType
-&gt; TcM (Maybe (HsExpr GhcTc, TcType))
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead_maybe"><span class="hs-identifier hs-var">tcInferAppHead_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394156"><span class="hs-identifier hs-var">rn_fun</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394154"><span class="hs-identifier hs-var">rn_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394158"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;quickLookArg 1&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-888"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394159"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-889"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;head:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394156"><span class="hs-identifier hs-var">rn_fun</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681394153"><span class="hs-identifier hs-var">mb_fun_ty</span></a></span><span>
</span><span id="line-890"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;args:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394154"><span class="hs-identifier hs-var">rn_args</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681394153"><span class="hs-identifier hs-var">mb_fun_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-893"></span><span>           </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcTc, TcType)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- fun is too complicated</span><span>
</span><span id="line-894"></span><span>                          </span><span class="annot"><span class="annottext">Delta -&gt; LHsExpr GhcRn -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var">skipQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394161"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394160"><span class="hs-identifier hs-var">larg</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-895"></span><span>           </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394150"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394150"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394149"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394149"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394148"><span class="annot"><span class="annottext">no_free_kappas :: Bool
</span><a href="#local-6989586621681394148"><span class="hs-identifier hs-var hs-var">no_free_kappas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#findNoQuantVars"><span class="hs-identifier hs-var">findNoQuantVars</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394149"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394154"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-898"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;quickLookArg 2&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-899"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no_free_kappas:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394148"><span class="hs-identifier hs-var">no_free_kappas</span></a></span><span>
</span><span id="line-900"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;guarded:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394162"><span class="hs-identifier hs-var">guarded</span></a></span><span>
</span><span id="line-901"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_fun:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394150"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-902"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fun_sigma:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394149"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-903"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394162"><span class="hs-identifier hs-var">guarded</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394148"><span class="hs-identifier hs-var">no_free_kappas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; LHsExpr GhcRn -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var">skipQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394161"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394160"><span class="hs-identifier hs-var">larg</span></a></span><span>
</span><span id="line-905"></span><span>         </span><span class="hs-keyword">else</span><span>
</span><span id="line-906"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394145"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394145"><span class="hs-identifier hs-var">do_ql</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM Bool
</span><a href="GHC.Tc.Gen.App.html#wantQuickLook"><span class="hs-identifier hs-var">wantQuickLook</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394156"><span class="hs-identifier hs-var">rn_fun</span></a></span><span>
</span><span id="line-907"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394144"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394144"><span class="hs-identifier hs-var">delta_app</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394143"><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394143"><span class="hs-identifier hs-var">inst_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394142"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394142"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Bool
-&gt; (HsExpr GhcRn, AppCtxt)
-&gt; TcType
-&gt; [HsExprArg 'TcpRn]
-&gt; TcM (Delta, [HsExprArg 'TcpInst], TcType)
</span><a href="GHC.Tc.Gen.App.html#tcInstFun"><span class="hs-identifier hs-var">tcInstFun</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681394145"><span class="hs-identifier hs-var">do_ql</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
</span><a href="#local-6989586621681394157"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394149"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394154"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;quickLookArg 3&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-909"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681394159"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-910"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;delta:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394161"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-911"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;delta_app:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394144"><span class="hs-identifier hs-var">delta_app</span></a></span><span>
</span><span id="line-912"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg_ty:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394158"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-913"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;app_res_rho:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394142"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>       </span><span class="hs-comment">-- Do quick-look unification</span><span>
</span><span id="line-916"></span><span>       </span><span class="hs-comment">-- NB: arg_ty may not be zonked, but that's ok</span><span>
</span><span id="line-917"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394141"><span class="annot"><span class="annottext">delta' :: Delta
</span><a href="#local-6989586621681394141"><span class="hs-identifier hs-var hs-var">delta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394161"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; Delta -&gt; Delta
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394144"><span class="hs-identifier hs-var">delta_app</span></a></span><span>
</span><span id="line-918"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-var">qlUnify</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394141"><span class="hs-identifier hs-var">delta'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394158"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394142"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394138"><span class="annot"><span class="annottext">ql_arg :: EValArg 'TcpInst
</span><a href="#local-6989586621681394138"><span class="hs-identifier hs-var hs-var">ql_arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ValArgQL"><span class="hs-identifier hs-type">ValArgQL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">va_expr :: LHsExpr GhcRn
</span><a href="GHC.Tc.Gen.Head.html#va_expr"><span class="hs-identifier hs-var">va_expr</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394160"><span class="hs-identifier hs-var">larg</span></a></span><span>
</span><span id="line-921"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">va_fun :: (HsExpr GhcTc, AppCtxt)
</span><a href="GHC.Tc.Gen.Head.html#va_fun"><span class="hs-identifier hs-var">va_fun</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681394150"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681394155"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">va_args :: [HsExprArg 'TcpInst]
</span><a href="GHC.Tc.Gen.Head.html#va_args"><span class="hs-identifier hs-var">va_args</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpInst]
</span><a href="#local-6989586621681394143"><span class="hs-identifier hs-var">inst_args</span></a></span><span>
</span><span id="line-923"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">va_ty :: TcType
</span><a href="GHC.Tc.Gen.Head.html#va_ty"><span class="hs-identifier hs-var">va_ty</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394142"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-924"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394141"><span class="hs-identifier hs-var">delta'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EValArg 'TcpInst
</span><a href="#local-6989586621681394138"><span class="hs-identifier hs-var">ql_arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-type">skipQuickLook</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpInst"><span class="hs-identifier hs-type">TcpInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span id="skipQuickLook"><span class="annot"><span class="annottext">skipQuickLook :: Delta -&gt; LHsExpr GhcRn -&gt; TcM (Delta, EValArg 'TcpInst)
</span><a href="GHC.Tc.Gen.App.html#skipQuickLook"><span class="hs-identifier hs-var hs-var">skipQuickLook</span></a></span></span><span> </span><span id="local-6989586621681394137"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394137"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394136"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394136"><span class="hs-identifier hs-var">larg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394137"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (p :: TcPass). LHsExpr (GhcPass (XPass p)) -&gt; EValArg p
</span><a href="GHC.Tc.Gen.Head.html#ValArg"><span class="hs-identifier hs-var">ValArg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681394136"><span class="hs-identifier hs-var">larg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-930"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-type">quickLookResultType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-931"></span><span class="hs-comment">-- This function implements the shaded bit of rule APP-Downarrow in</span><span>
</span><span id="line-932"></span><span class="hs-comment">-- Fig 5 of the QL paper: &quot;A quick look at impredicativity&quot; (ICFP'20).</span><span>
</span><span id="line-933"></span><span class="hs-comment">-- It returns its second argument, but with any variables in Delta</span><span>
</span><span id="line-934"></span><span class="hs-comment">-- substituted out, so no variables in Delta escape</span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span id="quickLookResultType"><span class="annot"><span class="annottext">quickLookResultType :: Delta -&gt; TcType -&gt; ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-var hs-var">quickLookResultType</span></a></span></span><span> </span><span id="local-6989586621681394134"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394134"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394133"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394133"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621681394131"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394131"><span class="hs-identifier hs-var">exp_rho</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- In checking mode only, do qlUnify with the expected result type</span><span>
</span><span id="line-938"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394134"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- Optimisation only</span><span>
</span><span id="line-939"></span><span>         </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-var">qlUnify</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394134"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394133"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394131"><span class="hs-identifier hs-var">exp_rho</span></a></span><span>
</span><span id="line-940"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394133"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#quickLookResultType"><span class="hs-identifier hs-var">quickLookResultType</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681394129"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394129"><span class="hs-identifier hs-var">app_res_rho</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394129"><span class="hs-identifier hs-var">app_res_rho</span></a></span><span>
</span><span id="line-944"></span><span>    </span><span class="hs-comment">-- Zonk the result type, to ensure that we substitute out any</span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-comment">-- filled-in instantiation variable before calling</span><span>
</span><span id="line-946"></span><span>    </span><span class="hs-comment">-- unifyExpectedType. In the Check case, this isn't necessary,</span><span>
</span><span id="line-947"></span><span>    </span><span class="hs-comment">-- because unifyExpectedType just drops to tcUnify; but in the</span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-comment">-- Infer case a filled-in instantiation variable (filled in by</span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-comment">-- tcInstFun) might perhaps escape into the constraint</span><span>
</span><span id="line-950"></span><span>    </span><span class="hs-comment">-- generator. The safe thing to do is to zonk any instantiation</span><span>
</span><span id="line-951"></span><span>    </span><span class="hs-comment">-- variables away.  See Note [Instantiation variables are short lived]</span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-954"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-type">qlUnify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span class="hs-comment">-- Unify ty1 with ty2, unifying only variables in delta</span><span>
</span><span id="line-956"></span><span id="qlUnify"><span class="annot"><span class="annottext">qlUnify :: Delta -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Gen.App.html#qlUnify"><span class="hs-identifier hs-var hs-var">qlUnify</span></a></span></span><span> </span><span id="local-6989586621681394127"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394127"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621681394126"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394126"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681394125"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394125"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qlUnify&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394127"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394126"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394125"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Delta
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394126"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394125"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-960"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Set.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-962"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>    </span><span class="hs-comment">-- The TyVarSets give the variables bound by enclosing foralls</span><span>
</span><span id="line-964"></span><span>    </span><span class="hs-comment">-- for the corresponding type. Don't unify with these.</span><span>
</span><span id="line-965"></span><span>    </span><span id="local-6989586621681394124"><span class="annot"><span class="annottext">go :: (Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681394122"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394122"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621681394120"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394120"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394119"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394119"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-966"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394120"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394127"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcTyVar -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394118"><span class="hs-identifier hs-var">go_kappa</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394122"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394120"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394119"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394117"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394117"><span class="hs-identifier hs-var">bvs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394116"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394116"><span class="hs-identifier hs-var">bvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394115"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394115"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621681394114"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394114"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394114"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394127"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcTyVar -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394118"><span class="hs-identifier hs-var">go_kappa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394116"><span class="hs-identifier hs-var">bvs2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394117"><span class="hs-identifier hs-var">bvs1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394114"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394115"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394113"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394113"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621681394111"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394111"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394110"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394110"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394113"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394111"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394110"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-972"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394109"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394109"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681394108"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394108"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621681394107"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394107"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394109"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394108"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394107"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681394105"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394105"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681394104"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394104"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394105"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394104"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="hs-comment">-- See GHC.Tc.Utils.Unify</span><span>
</span><span id="line-976"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Note [Expanding synonyms during unification]</span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span>    </span><span class="hs-comment">-- Now, and only now, expand synonyms</span><span>
</span><span id="line-979"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394103"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394103"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681394102"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394102"><span class="hs-identifier hs-var">rho1</span></a></span></span><span> </span><span id="local-6989586621681394101"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394101"><span class="hs-identifier hs-var">rho2</span></a></span></span><span>
</span><span id="line-980"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681394100"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394100"><span class="hs-identifier hs-var">rho1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcType
</span><a href="GHC.Core.Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394102"><span class="hs-identifier hs-var">rho1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394103"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394100"><span class="hs-identifier hs-var">rho1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394101"><span class="hs-identifier hs-var">rho2</span></a></span><span>
</span><span id="line-981"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681394098"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394098"><span class="hs-identifier hs-var">rho2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe TcType
</span><a href="GHC.Core.Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394101"><span class="hs-identifier hs-var">rho2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394103"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394102"><span class="hs-identifier hs-var">rho1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394098"><span class="hs-identifier hs-var">rho2</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394097"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394097"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681394096"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394096"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621681394095"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394095"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681394094"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394094"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621681394093"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394093"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394096"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394094"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-985"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681394096"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394095"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394093"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-987"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#zipWithM_"><span class="hs-identifier hs-var">zipWithM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394097"><span class="hs-identifier hs-var">bvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394095"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394093"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span>    </span><span class="hs-comment">-- Decompose (arg1 -&gt; res1) ~ (arg2 -&gt; res2)</span><span>
</span><span id="line-990"></span><span>    </span><span class="hs-comment">-- and         (c1 =&gt; res1) ~   (c2 =&gt; res2)</span><span>
</span><span id="line-991"></span><span>    </span><span class="hs-comment">-- But for the latter we only learn instantiation info from t1~t2</span><span>
</span><span id="line-992"></span><span>    </span><span class="hs-comment">-- We look at the multiplicity too, although the chances of getting</span><span>
</span><span id="line-993"></span><span>    </span><span class="hs-comment">-- impredicative instantiation info from there seems...remote.</span><span>
</span><span id="line-994"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394089"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394089"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: TcType -&gt; AnonArgFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394086"><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681394086"><span class="hs-identifier hs-var">af1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394084"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394084"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394082"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394082"><span class="hs-identifier hs-var">res1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394080"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394080"><span class="hs-identifier hs-var">mult1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: TcType -&gt; AnonArgFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394079"><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681394079"><span class="hs-identifier hs-var">af2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394078"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394078"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394077"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394077"><span class="hs-identifier hs-var">res2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681394076"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394076"><span class="hs-identifier hs-var">mult2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681394086"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681394079"><span class="hs-identifier hs-var">af2</span></a></span><span>
</span><span id="line-997"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681394086"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="GHC.Types.Var.html#VisArg"><span class="hs-identifier hs-var">VisArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-998"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394089"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394084"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394078"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394089"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394080"><span class="hs-identifier hs-var">mult1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394076"><span class="hs-identifier hs-var">mult2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-999"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394089"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394082"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394077"><span class="hs-identifier hs-var">res2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span>    </span><span class="hs-comment">-- ToDo: c.f. Tc.Utils.unify.uType,</span><span>
</span><span id="line-1002"></span><span>    </span><span class="hs-comment">-- which does not split FunTy here</span><span>
</span><span id="line-1003"></span><span>    </span><span class="hs-comment">-- Also NB tcRepSplitAppTy here, which does not split (c =&gt; t)</span><span>
</span><span id="line-1004"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394073"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394073"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621681394071"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394071"><span class="hs-identifier hs-var">t1a</span></a></span></span><span> </span><span id="local-6989586621681394070"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394070"><span class="hs-identifier hs-var">t1b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394069"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394069"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1005"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394068"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394068"><span class="hs-identifier hs-var">t2a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394067"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394067"><span class="hs-identifier hs-var">t2b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, TcType)
</span><a href="GHC.Core.Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394069"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1006"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394073"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394071"><span class="hs-identifier hs-var">t1a</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394068"><span class="hs-identifier hs-var">t2a</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394073"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394070"><span class="hs-identifier hs-var">t1b</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394067"><span class="hs-identifier hs-var">t2b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394065"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394065"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681394064"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394064"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621681394063"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394063"><span class="hs-identifier hs-var">t2a</span></a></span></span><span> </span><span id="local-6989586621681394062"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394062"><span class="hs-identifier hs-var">t2b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394061"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394061"><span class="hs-identifier hs-var">t1a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394060"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394060"><span class="hs-identifier hs-var">t1b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, TcType)
</span><a href="GHC.Core.Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394064"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1010"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394065"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394061"><span class="hs-identifier hs-var">t1a</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394063"><span class="hs-identifier hs-var">t2a</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394065"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394060"><span class="hs-identifier hs-var">t1b</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394062"><span class="hs-identifier hs-var">t2b</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394059"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394059"><span class="hs-identifier hs-var">bvs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394058"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394058"><span class="hs-identifier hs-var">bvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span id="local-6989586621681394056"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681394056"><span class="hs-identifier hs-var">bv1</span></a></span></span><span> </span><span id="local-6989586621681394055"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394055"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span id="local-6989586621681394054"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681394054"><span class="hs-identifier hs-var">bv2</span></a></span></span><span> </span><span id="local-6989586621681394053"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394053"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394052"><span class="hs-identifier hs-var">bvs1'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394051"><span class="hs-identifier hs-var">bvs2'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394055"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394053"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1014"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1015"></span><span>       </span><span id="local-6989586621681394052"><span class="annot"><span class="annottext">bvs1' :: Delta
</span><a href="#local-6989586621681394052"><span class="hs-identifier hs-var hs-var">bvs1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394059"><span class="hs-identifier hs-var">bvs1</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcTyVar -&gt; Delta
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-operator hs-var">`extendVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681394056"><span class="hs-identifier hs-var">bv1</span></a></span><span>
</span><span id="line-1016"></span><span>       </span><span id="local-6989586621681394051"><span class="annot"><span class="annottext">bvs2' :: Delta
</span><a href="#local-6989586621681394051"><span class="hs-identifier hs-var hs-var">bvs2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394058"><span class="hs-identifier hs-var">bvs2</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcTyVar -&gt; Delta
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-operator hs-var">`extendVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681394054"><span class="hs-identifier hs-var">bv2</span></a></span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span>    </span><span class="annot"><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-comment">----------------</span><span>
</span><span id="line-1022"></span><span>    </span><span id="local-6989586621681394118"><span class="annot"><span class="annottext">go_kappa :: (Delta, Delta) -&gt; TcTyVar -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394118"><span class="hs-identifier hs-var hs-var">go_kappa</span></a></span></span><span> </span><span id="local-6989586621681394049"><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394049"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681394048"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394048"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span id="local-6989586621681394047"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394047"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1023"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isMetaTyVar</span><span> </span><span class="hs-identifier">kappa</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">kappa</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394043"><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621681394043"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM MetaDetails
</span><a href="GHC.Tc.Utils.TcMType.html#readMetaTyVar"><span class="hs-identifier hs-var">readMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394048"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-1025"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621681394043"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1026"></span><span>               </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621681394042"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394042"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Delta, Delta) -&gt; TcType -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394124"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394049"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394042"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394047"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1027"></span><span>               </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681394041"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394041"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394047"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1028"></span><span>                                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall {a}.
(a, Delta) -&gt; TcTyVar -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394040"><span class="hs-identifier hs-var">go_flexi</span></a></span><span> </span><span class="annot"><span class="annottext">(Delta, Delta)
</span><a href="#local-6989586621681394049"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394048"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394041"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>    </span><span class="hs-comment">----------------</span><span>
</span><span id="line-1031"></span><span>    </span><span id="local-6989586621681394040"><span class="annot"><span class="annottext">go_flexi :: (a, Delta) -&gt; TcTyVar -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681394040"><span class="hs-identifier hs-var hs-var">go_flexi</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681394028"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394028"><span class="hs-identifier hs-var">bvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681394027"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394027"><span class="hs-identifier hs-var">kappa</span></a></span></span><span> </span><span id="local-6989586621681394026"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394026"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>  </span><span class="hs-comment">-- ty2 is zonked</span><span>
</span><span id="line-1032"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- See Note [Actual unification in qlUnify]</span><span>
</span><span id="line-1033"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394025"><span class="annot"><span class="annottext">ty2_tvs :: Delta
</span><a href="#local-6989586621681394025"><span class="hs-identifier hs-var hs-var">ty2_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Delta
</span><a href="GHC.Core.TyCo.FVs.html#shallowTyCoVarsOfType"><span class="hs-identifier hs-var">shallowTyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394026"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1034"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394025"><span class="hs-identifier hs-var">ty2_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#intersectsVarSet"><span class="hs-operator hs-var">`intersectsVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394028"><span class="hs-identifier hs-var">bvs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1035"></span><span>          </span><span class="hs-comment">-- Can't instantiate a delta-varto a forall-bound variable</span><span>
</span><span id="line-1036"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681394023"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394023"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; TcType -&gt; Maybe TcType
</span><a href="GHC.Core.Type.html#occCheckExpand"><span class="hs-identifier hs-var">occCheckExpand</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394027"><span class="hs-identifier hs-var">kappa</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394026"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1037"></span><span>          </span><span class="hs-comment">-- Passes the occurs check</span><span>
</span><span id="line-1038"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681394021"><span class="annot"><span class="annottext">ty2_kind :: TcType
</span><a href="#local-6989586621681394021"><span class="hs-identifier hs-var hs-var">ty2_kind</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394023"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1039"></span><span>                 </span><span id="local-6989586621681394019"><span class="annot"><span class="annottext">kappa_kind :: TcType
</span><a href="#local-6989586621681394019"><span class="hs-identifier hs-var hs-var">kappa_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394027"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-1040"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681394018"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394018"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394023"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394021"><span class="hs-identifier hs-var">ty2_kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394019"><span class="hs-identifier hs-var">kappa_kind</span></a></span><span>
</span><span id="line-1041"></span><span>                   </span><span class="hs-comment">-- unifyKind: see Note [Actual unification in qlUnify]</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qlUnify:update&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1044"></span><span>             </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394027"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394019"><span class="hs-identifier hs-var">kappa_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>                       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394023"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394021"><span class="hs-identifier hs-var">ty2_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1046"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;co:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394018"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1047"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcType -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681394027"><span class="hs-identifier hs-var">kappa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcCoercionN -&gt; TcType
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394023"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681394018"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1050"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Occurs-check or forall-bound varialbe</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span class="hs-comment">{- Note [Actual unification in qlUnify]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In qlUnify, if we find (kappa ~ ty), we are going to update kappa := ty.
That is the entire point of qlUnify!   Wrinkles:

* We must not unify with anything bound by an enclosing forall; e.g.
    (forall a. kappa -&gt; Int) ~ forall a. a -&gt; Int)
  That's tracked by the 'bvs' arg of 'go'.

* We must not make an occurs-check; we use occCheckExpand for that.

* checkTypeEq also checks for various other things, including
  - foralls, and predicate types (which we want to allow here)
  - type families (relates to a very specific and exotic performance
    question, that is unlikely to bite here)
  - blocking coercion holes
  After some thought we believe that none of these are relevant
  here

* What if kappa and ty have different kinds?  We solve that problem by
  calling unifyKind, producing a coercion perhaps emitting some deferred
  equality constraints.  That is /different/ from the approach we use in
  the main constraint solver for herterogeneous equalities; see Note
  [Equalities with incompatible kinds] in Solver.Canonical

  Why different? Because:
  - We can't use qlUnify to solve the kind constraint because qlUnify
    won't unify ordinary (non-instantiation) unification variables.
    (It would have to worry about lots of things like untouchability
    if it did.)
  - qlUnify can't give up if the kinds look un-equal because that would
    mean that it might succeed some times (when the eager unifier
    has already unified those kinds) but not others -- order
    dependence.
  - We can't use the ordinary unifier/constraint solver instead,
    because it doesn't unify polykinds, and has all kinds of other
    magic.  qlUnify is very focused.

  TL;DR Calling unifyKind seems like the lesser evil.
  -}</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
              Guardedness
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1099"></span><span>
</span><span id="line-1100"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#findNoQuantVars"><span class="hs-identifier hs-type">findNoQuantVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1101"></span><span class="hs-comment">-- True &lt;=&gt; there are no free quantified variables</span><span>
</span><span id="line-1102"></span><span class="hs-comment">--          in the result of the call</span><span>
</span><span id="line-1103"></span><span class="hs-comment">-- E.g. in the call (f e1 e2), if</span><span>
</span><span id="line-1104"></span><span class="hs-comment">--   f :: forall a b. a -&gt; b -&gt; Int   return True</span><span>
</span><span id="line-1105"></span><span class="hs-comment">--   f :: forall a b. a -&gt; b -&gt; b     return False (b is free)</span><span>
</span><span id="line-1106"></span><span id="findNoQuantVars"><span class="annot"><span class="annottext">findNoQuantVars :: TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#findNoQuantVars"><span class="hs-identifier hs-var hs-var">findNoQuantVars</span></a></span></span><span> </span><span id="local-6989586621681394016"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394016"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681394015"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394015"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1107"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394016"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394015"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1108"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1109"></span><span>    </span><span id="local-6989586621681394013"><span class="annot"><span class="annottext">need_instantiation :: [HsExprArg p] -&gt; Bool
</span><a href="#local-6989586621681394013"><span class="hs-identifier hs-var hs-var">need_instantiation</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1110"></span><span>    </span><span class="annot"><a href="#local-6989586621681394013"><span class="hs-identifier hs-var">need_instantiation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg p]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1111"></span><span>    </span><span class="annot"><a href="#local-6989586621681394013"><span class="hs-identifier hs-var">need_instantiation</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg p]
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span>    </span><span class="annot"><a href="#local-6989586621681394014"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpRn"><span class="hs-identifier hs-type">TcpRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1114"></span><span>    </span><span id="local-6989586621681394014"><span class="annot"><span class="annottext">go :: Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681394012"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394012"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681394011"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394011"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681394010"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394010"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1115"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall {p :: TcPass}. [HsExprArg p] -&gt; Bool
</span><a href="#local-6989586621681394013"><span class="hs-identifier hs-var">need_instantiation</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394010"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1116"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681394009"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394009"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394008"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394008"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681394007"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394007"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ([TcTyVar], ThetaType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394011"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1117"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394009"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681394008"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394012"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; [TcTyVar] -&gt; Delta
</span><a href="GHC.Types.Var.Set.html#extendVarSetList"><span class="hs-operator hs-var">`extendVarSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681394009"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394007"><span class="hs-identifier hs-var">rho</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681394010"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1119"></span><span>
</span><span id="line-1120"></span><span>    </span><span class="annot"><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394005"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394005"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681394004"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394004"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">TcType -&gt; Delta
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394004"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; Delta -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#disjointVarSet"><span class="hs-operator hs-var">`disjointVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394005"><span class="hs-identifier hs-var">bvs</span></a></span><span>
</span><span id="line-1121"></span><span>
</span><span id="line-1122"></span><span>    </span><span class="annot"><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681394001"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394001"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681394000"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394000"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EWrap"><span class="hs-identifier hs-type">EWrap</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681393999"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393999"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681394001"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681394000"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393999"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1123"></span><span>    </span><span class="annot"><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681393998"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681393998"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681393997"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393997"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EPrag"><span class="hs-identifier hs-type">EPrag</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681393996"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393996"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681393998"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393997"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393996"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1124"></span><span>
</span><span id="line-1125"></span><span>    </span><span class="annot"><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681393995"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681393995"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681393994"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393994"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681393993"><span class="annot"><span class="annottext">args :: [HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393993"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#ETypeArg"><span class="hs-identifier hs-type">ETypeArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681393992"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393992"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681393991"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681393991"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span>  </span><span id="local-6989586621681393990"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393990"><span class="hs-identifier hs-var">body1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ArgFlag -&gt; Bool) -&gt; TcType -&gt; ([TcTyVar], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSomeForAllTyVars"><span class="hs-identifier hs-var">tcSplitSomeForAllTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393994"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1127"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681393988"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681393988"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681393987"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393987"><span class="hs-identifier hs-var">body2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; (ThetaType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393990"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-1128"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681393991"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681393988"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681393995"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">Delta -&gt; [TcTyVar] -&gt; Delta
</span><a href="GHC.Types.Var.Set.html#extendVarSetList"><span class="hs-operator hs-var">`extendVarSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681393991"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393987"><span class="hs-identifier hs-var">body2</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393993"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1130"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681393986"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681393986"><span class="hs-identifier hs-var">_tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681393985"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393985"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TyVarBinder, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinder_maybe"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinder_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393994"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1131"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681393995"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393985"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393992"><span class="hs-identifier hs-var">rest_args</span></a></span><span>
</span><span id="line-1132"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1133"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- E.g. head ids @Int</span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span>    </span><span class="annot"><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681393984"><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681393984"><span class="hs-identifier hs-var">bvs</span></a></span></span><span> </span><span id="local-6989586621681393983"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393983"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#EValArg"><span class="hs-identifier hs-type">EValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681393982"><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393982"><span class="hs-identifier hs-var">rest_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1136"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681393981"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393981"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (Scaled TcType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393983"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Delta -&gt; TcType -&gt; [HsExprArg 'TcpRn] -&gt; Bool
</span><a href="#local-6989586621681394014"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Delta
</span><a href="#local-6989586621681393984"><span class="hs-identifier hs-var">bvs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393981"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpRn]
</span><a href="#local-6989586621681393982"><span class="hs-identifier hs-var">rest_args</span></a></span><span>
</span><span id="line-1138"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1139"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- E.g. head id 'x'</span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>
</span><span id="line-1142"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 tagToEnum#
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1147"></span><span>
</span><span id="line-1148"></span><span class="hs-comment">{- Note [tagToEnum#]
~~~~~~~~~~~~~~~~~~~~
Nasty check to ensure that tagToEnum# is applied to a type that is an
enumeration TyCon.  It's crude, because it relies on our
knowing *now* that the type is ok, which in turn relies on the
eager-unification part of the type checker pushing enough information
here.  In theory the Right Thing to do is to have a new form of
constraint but I definitely cannot face that!  And it works ok as-is.

Here's are two cases that should fail
        f :: forall a. a
        f = tagToEnum# 0        -- Can't do tagToEnum# at a type variable

        g :: Int
        g = tagToEnum# 0        -- Int is not an enumeration

When data type families are involved it's a bit more complicated.
     data family F a
     data instance F [Int] = A | B | C
Then we want to generate something like
     tagToEnum# R:FListInt 3# |&gt; co :: R:FListInt ~ F [Int]
Usually that coercion is hidden inside the wrappers for
constructors of F [Int] but here we have to do it explicitly.

It's all grotesquely complicated.
-}</span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-type">isTagToEnum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1176"></span><span id="isTagToEnum"><span class="annot"><span class="annottext">isTagToEnum :: HsExpr GhcRn -&gt; Bool
</span><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-var hs-var">isTagToEnum</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681393979"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681393979"><span class="hs-identifier hs-var">fun_id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681393979"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.PrimOps.html#tagToEnumKey"><span class="hs-identifier hs-var">tagToEnumKey</span></a></span><span>
</span><span id="line-1177"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#isTagToEnum"><span class="hs-identifier hs-var">isTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcTagToEnum"><span class="hs-identifier hs-type">tcTagToEnum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#AppCtxt"><span class="hs-identifier hs-type">AppCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Tc.Gen.Head.html#TcpTc"><span class="hs-identifier hs-type">TcpTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1180"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-1181"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1182"></span><span class="hs-comment">-- tagToEnum# :: forall a. Int# -&gt; a</span><span>
</span><span id="line-1183"></span><span class="hs-comment">-- See Note [tagToEnum#]   Urgh!</span><span>
</span><span id="line-1184"></span><span id="tcTagToEnum"><span class="annot"><span class="annottext">tcTagToEnum :: HsExpr GhcTc
-&gt; AppCtxt -&gt; [HsExprArg 'TcpTc] -&gt; TcType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcTagToEnum"><span class="hs-identifier hs-var hs-var">tcTagToEnum</span></a></span></span><span> </span><span id="local-6989586621681393977"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681393977"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span> </span><span id="local-6989586621681393976"><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681393976"><span class="hs-identifier hs-var">fun_ctxt</span></a></span></span><span> </span><span id="local-6989586621681393975"><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681393975"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span> </span><span id="local-6989586621681393974"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393974"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1185"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681393973"><span class="annot"><span class="annottext">HsExprArg 'TcpTc
</span><a href="#local-6989586621681393973"><span class="hs-identifier hs-var">val_arg</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#dropWhile"><span class="hs-identifier hs-var">dropWhile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (id :: TcPass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Head.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681393975"><span class="hs-identifier hs-var">tc_args</span></a></span><span>
</span><span id="line-1186"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681393970"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393970"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393974"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span>       </span><span class="hs-comment">-- Check that the type is algebraic</span><span>
</span><span id="line-1189"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TcType -&gt; Maybe (TyCon, ThetaType)
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393970"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1190"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TyCon, ThetaType)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681393968"><span class="hs-identifier hs-var">mk_error</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393970"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681393967"><span class="hs-identifier hs-var">doc1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1191"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc)
</span><a href="#local-6989586621681393966"><span class="hs-identifier hs-var">vanilla_result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1192"></span><span>           </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681393965"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393965"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681393964"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681393964"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Look through any type family</span><span>
</span><span id="line-1195"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681393963"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681393963"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1196"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; TyCon -&gt; ThetaType -&gt; Maybe (TyCon, ThetaType, TcCoercionN)
</span><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst_maybe"><span class="hs-identifier hs-var">tcLookupDataFamInst_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681393963"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393965"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681393964"><span class="hs-identifier hs-var">tc_args</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1197"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TyCon, ThetaType, TcCoercionN)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TyCon -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681393962"><span class="hs-identifier hs-var">check_enumeration</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393970"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393965"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1198"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc)
</span><a href="#local-6989586621681393966"><span class="hs-identifier hs-var">vanilla_result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1199"></span><span>           </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681393961"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393961"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681393960"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681393960"><span class="hs-identifier hs-var">rep_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681393959"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681393959"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1200"></span><span>
</span><span id="line-1201"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- coi :: tc tc_args ~R rep_tc rep_args</span><span>
</span><span id="line-1202"></span><span>         </span><span class="annot"><span class="annottext">TcType -&gt; TyCon -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681393962"><span class="hs-identifier hs-var">check_enumeration</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393970"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393961"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1203"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681393958"><span class="annot"><span class="annottext">rep_ty :: TcType
</span><a href="#local-6989586621681393958"><span class="hs-identifier hs-var hs-var">rep_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ThetaType -&gt; TcType
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393961"><span class="hs-identifier hs-var">rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681393960"><span class="hs-identifier hs-var">rep_args</span></a></span><span>
</span><span id="line-1204"></span><span>             </span><span id="local-6989586621681393956"><span class="annot"><span class="annottext">tc_fun' :: HsExpr GhcTc
</span><a href="#local-6989586621681393956"><span class="hs-identifier hs-var hs-var">tc_fun'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpTyApp"><span class="hs-identifier hs-var">WpTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393958"><span class="hs-identifier hs-var">rep_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681393977"><span class="hs-identifier hs-var">tc_fun</span></a></span><span>
</span><span id="line-1205"></span><span>             </span><span id="local-6989586621681393954"><span class="annot"><span class="annottext">tc_expr :: HsExpr GhcTc
</span><a href="#local-6989586621681393954"><span class="hs-identifier hs-var hs-var">tc_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; AppCtxt -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681393956"><span class="hs-identifier hs-var">tc_fun'</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681393976"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HsExprArg 'TcpTc
</span><a href="#local-6989586621681393973"><span class="hs-identifier hs-var">val_arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1206"></span><span>             </span><span id="local-6989586621681393953"><span class="annot"><span class="annottext">df_wrap :: HsWrapper
</span><a href="#local-6989586621681393953"><span class="hs-identifier hs-var hs-var">df_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681393959"><span class="hs-identifier hs-var">coi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681393953"><span class="hs-identifier hs-var">df_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681393954"><span class="hs-identifier hs-var">tc_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1208"></span><span>
</span><span id="line-1209"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1210"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tagToEnum# must appear applied to one value argument&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span>
</span><span id="line-1212"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1213"></span><span>    </span><span id="local-6989586621681393966"><span class="annot"><span class="annottext">vanilla_result :: TcM (HsExpr GhcTc)
</span><a href="#local-6989586621681393966"><span class="hs-identifier hs-var hs-var">vanilla_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; AppCtxt -&gt; [HsExprArg 'TcpTc] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Head.html#rebuildHsApps"><span class="hs-identifier hs-var">rebuildHsApps</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681393977"><span class="hs-identifier hs-var">tc_fun</span></a></span><span> </span><span class="annot"><span class="annottext">AppCtxt
</span><a href="#local-6989586621681393976"><span class="hs-identifier hs-var">fun_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExprArg 'TcpTc]
</span><a href="#local-6989586621681393975"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span>    </span><span id="local-6989586621681393962"><span class="annot"><span class="annottext">check_enumeration :: TcType -&gt; TyCon -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="#local-6989586621681393962"><span class="hs-identifier hs-var hs-var">check_enumeration</span></a></span></span><span> </span><span id="local-6989586621681393948"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393948"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621681393947"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393947"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-1216"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681393947"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRnIf TcGblEnv TcLclEnv ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681393968"><span class="hs-identifier hs-var">mk_error</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393948"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681393945"><span class="hs-identifier hs-var">doc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>
</span><span id="line-1219"></span><span>    </span><span id="local-6989586621681393967"><span class="annot"><span class="annottext">doc1 :: SDoc
</span><a href="#local-6989586621681393967"><span class="hs-identifier hs-var hs-var">doc1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Specify the type by giving a type signature&quot;</span></span><span>
</span><span id="line-1220"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;e.g. (tagToEnum# x) :: Bool&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1221"></span><span>    </span><span id="local-6989586621681393945"><span class="annot"><span class="annottext">doc2 :: SDoc
</span><a href="#local-6989586621681393945"><span class="hs-identifier hs-var hs-var">doc2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Result type must be an enumeration type&quot;</span></span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span>    </span><span class="annot"><a href="#local-6989586621681393968"><span class="hs-identifier hs-type">mk_error</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1224"></span><span>    </span><span id="local-6989586621681393968"><span class="annot"><span class="annottext">mk_error :: TcType -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681393968"><span class="hs-identifier hs-var hs-var">mk_error</span></a></span></span><span> </span><span id="local-6989586621681393944"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393944"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681393943"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681393943"><span class="hs-identifier hs-var">what</span></a></span></span><span>
</span><span id="line-1225"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Bad call to tagToEnum#&quot;</span></span><span>
</span><span id="line-1226"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;at type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681393944"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1227"></span><span>           </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681393943"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-1228"></span><span>
</span><span id="line-1229"></span><span>
</span><span id="line-1230"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Pragmas on expressions
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span class="annot"><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-type">tcExprPrag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-1237"></span><span id="tcExprPrag"><span class="annot"><span class="annottext">tcExprPrag :: HsPragE GhcRn -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-var hs-var">tcExprPrag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragSCC"><span class="hs-identifier hs-type">HsPragSCC</span></a></span><span> </span><span id="local-6989586621681393941"><span class="annot"><span class="annottext">XSCC GhcRn
</span><a href="#local-6989586621681393941"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621681393940"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621681393940"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621681393939"><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621681393939"><span class="hs-identifier hs-var">ann</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. XSCC p -&gt; SourceText -&gt; StringLiteral -&gt; HsPragE p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPragSCC"><span class="hs-identifier hs-var">HsPragSCC</span></a></span><span> </span><span class="annot"><span class="annottext">XSCC GhcRn
</span><a href="#local-6989586621681393941"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621681393940"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621681393939"><span class="hs-identifier hs-var">ann</span></a></span><span>
</span><span id="line-1238"></span></pre></body></html>
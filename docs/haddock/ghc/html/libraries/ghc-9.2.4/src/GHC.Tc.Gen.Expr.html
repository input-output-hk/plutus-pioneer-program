<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                 #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections       #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span> </span><span class="hs-comment">-- Wrinkle in Note [Trees That Grow]</span><span>
</span><span id="line-8"></span><span>                                      </span><span class="hs-comment">-- in module Language.Haskell.Syntax.Extension</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">{-
%
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Gen.Expr</span><span>
</span><span id="line-19"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier">tcCheckPolyExprNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier">tcCheckMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier">tcCheckMonoExprNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier">tcMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier">tcMonoExprNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier">tcInferRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier">tcInferRhoNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier">tcPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier">tcExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier">tcSyntaxOp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier">tcSyntaxOpGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier">SyntaxOpType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier">synKnownType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcCheckId"><span class="hs-identifier">tcCheckId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#addAmbiguousNameErr"><span class="hs-identifier">addAmbiguousNameErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier">getFixedTyVars</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html"><span class="hs-identifier">GHC.Tc.Gen.Splice</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier">tcSpliceExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier">tcTypedBracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier">tcUntypedBracket</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.App.html"><span class="hs-identifier">GHC.Tc.Gen.App</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html"><span class="hs-identifier">GHC.Tc.Gen.Head</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html"><span class="hs-identifier">GHC.Tc.Gen.Bind</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier">tcLocalBinds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier">tcGetFamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier">FamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier">addUsedGRE</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Arrow.html"><span class="hs-identifier">GHC.Tc.Gen.Arrow</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html"><span class="hs-identifier">GHC.Tc.Gen.Match</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html"><span class="hs-identifier">GHC.Tc.Gen.Pat</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier">classTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier">UniqSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier">mkUniqSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-identifier">elementOfUniqSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier">nonDetEltsUniqSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Function.html#"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List.html#"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#sortBy"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#groupBy"><span class="hs-identifier">groupBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#intersect"><span class="hs-identifier">intersect</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Main wrappers}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-type">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-type">tcCheckPolyExprNC</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>         </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>           </span><span class="hs-comment">-- Expected type (could be a polytype)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Generalised expr with expected type</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- tcCheckPolyExpr is a convenient place (frequent but not too frequent)</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- place to add context information.</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- The NC version does not do so, usually because the caller wants</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- to do so themselves.</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span id="tcCheckPolyExpr"><span class="annot"><span class="annottext">tcCheckPolyExpr :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var hs-var">tcCheckPolyExpr</span></a></span></span><span>   </span><span id="local-6989586621681324608"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324608"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681324607"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324607"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier hs-var">tcPolyLExpr</span></a></span><span>   </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324608"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324607"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span id="tcCheckPolyExprNC"><span class="annot"><span class="annottext">tcCheckPolyExprNC :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var hs-var">tcCheckPolyExprNC</span></a></span></span><span> </span><span id="local-6989586621681324604"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324604"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681324603"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324603"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprNC"><span class="hs-identifier hs-var">tcPolyLExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324604"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324603"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- These versions take an ExpType</span><span>
</span><span id="line-111"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier hs-type">tcPolyLExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprNC"><span class="hs-identifier hs-type">tcPolyLExprNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-112"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span id="tcPolyLExpr"><span class="annot"><span class="annottext">tcPolyLExpr :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier hs-var hs-var">tcPolyLExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324599"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324599"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324598"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324598"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324597"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324597"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324599"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Set location /first/; see GHC.Tc.Utils.Monad</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324598"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Note [Error contexts in generated code]</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324594"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324594"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324598"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324597"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-118"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324599"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324594"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="tcPolyLExprNC"><span class="annot"><span class="annottext">tcPolyLExprNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExprNC"><span class="hs-identifier hs-var hs-var">tcPolyLExprNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324593"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324593"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324592"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324592"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324591"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324591"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324593"><span class="hs-identifier hs-var">loc</span></a></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324590"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324590"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324592"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324591"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-123"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324593"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324590"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-126"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-type">tcCheckMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-type">tcCheckMonoExprNC</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>     </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>         </span><span class="hs-comment">-- Expected type</span><span>
</span><span id="line-129"></span><span>                         </span><span class="hs-comment">-- Definitely no foralls at the top</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span id="tcCheckMonoExpr"><span class="annot"><span class="annottext">tcCheckMonoExpr :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var hs-var">tcCheckMonoExpr</span></a></span></span><span>   </span><span id="local-6989586621681324588"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324588"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681324587"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324587"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span>   </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324588"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324587"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span id="tcCheckMonoExprNC"><span class="annot"><span class="annottext">tcCheckMonoExprNC :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var hs-var">tcCheckMonoExprNC</span></a></span></span><span> </span><span id="local-6989586621681324586"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324586"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681324585"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324585"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324586"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324585"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-type">tcMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-type">tcMonoExprNC</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>     </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>        </span><span class="hs-comment">-- Expected type</span><span>
</span><span id="line-137"></span><span>                         </span><span class="hs-comment">-- Definitely no foralls at the top</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span id="tcMonoExpr"><span class="annot"><span class="annottext">tcMonoExpr :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var hs-var">tcMonoExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324584"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324584"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324583"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324583"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324582"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324582"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324584"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Set location /first/; see GHC.Tc.Utils.Monad</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324583"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Note [Error contexts in generated code]</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324581"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324581"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324583"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324582"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324584"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324581"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span id="tcMonoExprNC"><span class="annot"><span class="annottext">tcMonoExprNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var hs-var">tcMonoExprNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324580"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324580"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324579"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324579"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324578"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324578"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324580"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324577"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324577"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324579"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324578"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324580"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324577"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-152"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-type">tcInferRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-type">tcInferRhoNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- Infer a *rho*-type. The return type is always instantiated.</span><span>
</span><span id="line-154"></span><span id="tcInferRho"><span class="annot"><span class="annottext">tcInferRho :: LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var hs-var">tcInferRho</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324576"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324576"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324575"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324575"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324576"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Set location /first/; see GHC.Tc.Utils.Monad</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">forall a. HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Head.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324575"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Note [Error contexts in generated code]</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324574"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324574"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324573"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324573"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (ExpRhoType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324575"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324576"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324574"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324573"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span id="tcInferRhoNC"><span class="annot"><span class="annottext">tcInferRhoNC :: LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var hs-var">tcInferRhoNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324571"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324571"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324570"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324570"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324571"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324569"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324569"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324568"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324568"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (ExpRhoType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324570"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681324571"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324569"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324568"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
        tcExpr: the main expression typechecker
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-type">tcPolyExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span id="tcPolyExpr"><span class="annot"><span class="annottext">tcPolyExpr :: HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var hs-var">tcPolyExpr</span></a></span></span><span> </span><span id="local-6989586621681324567"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324567"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681324566"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324566"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPolyExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324566"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324563"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324563"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324562"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324562"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall result.
UserTypeCtxt
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM result)
-&gt; TcM (HsWrapper, result)
</span><a href="GHC.Tc.Utils.Unify.html#tcSkolemiseExpType"><span class="hs-identifier hs-var">tcSkolemiseExpType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324566"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681324559"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324559"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>                          </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324567"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324559"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324563"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324562"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-type">tcExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- Use tcApp to typecheck appplications, which are treated specially</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- by Quick Look.  Specifically:</span><span>
</span><span id="line-183"></span><span class="hs-comment">--   - HsVar         lone variables, to ensure that they can get an</span><span>
</span><span id="line-184"></span><span class="hs-comment">--                     impredicative instantiation (via Quick Look</span><span>
</span><span id="line-185"></span><span class="hs-comment">--                     driven by res_ty (in checking mode)).</span><span>
</span><span id="line-186"></span><span class="hs-comment">--   - HsApp         value applications</span><span>
</span><span id="line-187"></span><span class="hs-comment">--   - HsAppType     type applications</span><span>
</span><span id="line-188"></span><span class="hs-comment">--   - ExprWithTySig (e :: type)</span><span>
</span><span id="line-189"></span><span class="hs-comment">--   - HsRecFld      overloaded record fields</span><span>
</span><span id="line-190"></span><span class="hs-comment">--   - HsExpanded    renamer expansions</span><span>
</span><span id="line-191"></span><span class="hs-comment">--   - HsOpApp       operator applications</span><span>
</span><span id="line-192"></span><span class="hs-comment">--   - HsOverLit     overloaded literals</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- These constructors are the union of</span><span>
</span><span id="line-194"></span><span class="hs-comment">--   - ones taken apart by GHC.Tc.Gen.Head.splitHsApps</span><span>
</span><span id="line-195"></span><span class="hs-comment">--   - ones understood by GHC.Tc.Gen.Head.tcInferAppHead_maybe</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- See Note [Application chains and heads] in GHC.Tc.Gen.App</span><span>
</span><span id="line-197"></span><span id="tcExpr"><span class="annot"><span class="annottext">tcExpr :: HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var hs-var">tcExpr</span></a></span></span><span> </span><span id="local-6989586621681324557"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324557"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span id="local-6989586621681324555"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324555"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324557"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324555"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-198"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324553"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324553"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span id="local-6989586621681324551"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324551"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324553"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324551"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-199"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324550"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324550"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#OpApp"><span class="hs-identifier hs-type">OpApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>              </span><span id="local-6989586621681324548"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324548"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324550"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324548"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-200"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324547"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324547"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span id="local-6989586621681324545"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324545"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324547"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324545"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-201"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324544"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324544"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span id="local-6989586621681324542"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324542"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324544"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324542"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324541"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324541"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecFld"><span class="hs-identifier hs-type">HsRecFld</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span id="local-6989586621681324539"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324539"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324541"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324539"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-203"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324538"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324538"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpanded"><span class="hs-identifier hs-type">HsExpanded</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324535"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324535"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324538"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324535"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324534"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324534"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324532"><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681324532"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324531"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324531"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324530"><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
</span><a href="#local-6989586621681324530"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpRhoType -&gt; TcM (Maybe (HsOverLit GhcTc))
</span><a href="GHC.Tc.Utils.Zonk.html#tcShortCutLit"><span class="hs-identifier hs-var">tcShortCutLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681324532"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324531"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-207"></span><span>         </span><span class="hs-comment">-- See Note [Short cut for overloaded literals] in GHC.Tc.Utils.Zonk</span><span>
</span><span id="line-208"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
</span><a href="#local-6989586621681324530"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-209"></span><span>           </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681324528"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681324528"><span class="hs-identifier hs-var">lit'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XOverLitE p -&gt; HsOverLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsOverLit"><span class="hs-identifier hs-var">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681324528"><span class="hs-identifier hs-var">lit'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>           </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.App.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324534"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324531"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- Typecheck an occurrence of an unbound Id</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- Some of these started life as a true expression hole &quot;_&quot;.</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- Others might simply be variables that accidentally have no binding site</span><span>
</span><span id="line-216"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">XUnboundVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324525"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681324525"><span class="hs-identifier hs-var">occ</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324524"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324524"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324523"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324523"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324524"><span class="hs-identifier hs-var">res_ty</span></a></span><span>    </span><span class="hs-comment">-- Allow Int# etc (#12531)</span><span>
</span><span id="line-218"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324521"><span class="annot"><span class="annottext">HoleExprRef
</span><a href="#local-6989586621681324521"><span class="hs-identifier hs-var">her</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcType -&gt; TcM HoleExprRef
</span><a href="GHC.Tc.Utils.TcMType.html#emitNewExprHole"><span class="hs-identifier hs-var">emitNewExprHole</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681324525"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324523"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-219"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="GHC.Core.UsageEnv.html#bottomUE"><span class="hs-identifier hs-var">bottomUE</span></a></span><span>   </span><span class="hs-comment">-- Holes fit any usage environment</span><span>
</span><span id="line-220"></span><span>                                       </span><span class="hs-comment">-- (#18491)</span><span>
</span><span id="line-221"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XUnboundVar p -&gt; OccName -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsUnboundVar"><span class="hs-identifier hs-var">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">HoleExprRef
</span><a href="#local-6989586621681324521"><span class="hs-identifier hs-var">her</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681324525"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324517"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324517"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span id="local-6989586621681324515"><span class="annot"><span class="annottext">XLitE GhcRn
</span><a href="#local-6989586621681324515"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324514"><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681324514"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324513"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324513"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324512"><span class="annot"><span class="annottext">lit_ty :: TcType
</span><a href="#local-6989586621681324512"><span class="hs-identifier hs-var hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). HsLit (GhcPass p) -&gt; TcType
</span><a href="GHC.Tc.Utils.Zonk.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681324514"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324517"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcRn
</span><a href="#local-6989586621681324515"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p1 :: Pass) (p2 :: Pass).
HsLit (GhcPass p1) -&gt; HsLit (GhcPass p2)
</span><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-var">convertLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681324514"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324512"><span class="hs-identifier hs-var">lit_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324513"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span id="local-6989586621681324507"><span class="annot"><span class="annottext">XPar GhcRn
</span><a href="#local-6989586621681324507"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324506"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324506"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324505"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324505"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324504"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324504"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324506"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324505"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-229"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XPar p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-var">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcRn
</span><a href="#local-6989586621681324507"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324504"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span id="local-6989586621681324502"><span class="annot"><span class="annottext">XPragE GhcRn
</span><a href="#local-6989586621681324502"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324501"><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621681324501"><span class="hs-identifier hs-var">prag</span></a></span></span><span> </span><span id="local-6989586621681324500"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324500"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324499"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324499"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324498"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324498"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324500"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324499"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-233"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XPragE p -&gt; HsPragE p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPragE"><span class="hs-identifier hs-var">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE GhcRn
</span><a href="#local-6989586621681324502"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsPragE GhcRn -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.App.html#tcExprPrag"><span class="hs-identifier hs-var">tcExprPrag</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621681324501"><span class="hs-identifier hs-var">prag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324498"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#NegApp"><span class="hs-identifier hs-type">NegApp</span></a></span><span> </span><span id="local-6989586621681324495"><span class="annot"><span class="annottext">XNegApp GhcRn
</span><a href="#local-6989586621681324495"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324494"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324494"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681324493"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681324493"><span class="hs-identifier hs-var">neg_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324492"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324492"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324491"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324491"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324490"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681324490"><span class="hs-identifier hs-var">neg_expr'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#NegateOrigin"><span class="hs-identifier hs-var">NegateOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681324493"><span class="hs-identifier hs-var">neg_expr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324492"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-238"></span><span>               </span><span class="hs-glyph">\</span><span class="hs-special">[</span><span id="local-6989586621681324487"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324487"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681324486"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324486"><span class="hs-identifier hs-var">arg_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>               </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324486"><span class="hs-identifier hs-var">arg_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324494"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324487"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XNegApp p -&gt; LHsExpr p -&gt; SyntaxExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#NegApp"><span class="hs-identifier hs-var">NegApp</span></a></span><span> </span><span class="annot"><span class="annottext">XNegApp GhcRn
</span><a href="#local-6989586621681324495"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324491"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681324490"><span class="hs-identifier hs-var">neg_expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324484"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324484"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsIPVar"><span class="hs-identifier hs-type">HsIPVar</span></a></span><span> </span><span class="annot"><span class="annottext">XIPVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324482"><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621681324482"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324481"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324481"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">{- Implicit parameters must have a *tau-type* not a
              type scheme.  We enforce this by creating a fresh
              type variable as its type.  (Because res_ty may not
              be a tau-type.) -}</span><span>
</span><span id="line-247"></span><span>         </span><span id="local-6989586621681324480"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324480"><span class="hs-identifier hs-var">ip_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span>
</span><span id="line-248"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324478"><span class="annot"><span class="annottext">ip_name :: TcType
</span><a href="#local-6989586621681324478"><span class="hs-identifier hs-var hs-var">ip_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; TcType
</span><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsIPName -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Type.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621681324482"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324475"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681324475"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a></span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324472"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324472"><span class="hs-identifier hs-var">ip_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM Var
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681324470"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681324475"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324478"><span class="hs-identifier hs-var">ip_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324480"><span class="hs-identifier hs-var">ip_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324484"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-252"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TcType -&gt; TcType -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681324468"><span class="hs-identifier hs-var">fromDict</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681324475"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324478"><span class="hs-identifier hs-var">ip_name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324480"><span class="hs-identifier hs-var">ip_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324472"><span class="hs-identifier hs-var">ip_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>                   </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324480"><span class="hs-identifier hs-var">ip_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324481"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">-- Coerces a dictionary for `IP &quot;x&quot; t` into `t`.</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621681324468"><span class="annot"><span class="annottext">fromDict :: Class -&gt; TcType -&gt; TcType -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681324468"><span class="hs-identifier hs-var hs-var">fromDict</span></a></span></span><span> </span><span id="local-6989586621681324465"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681324465"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span id="local-6989586621681324464"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324464"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324463"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324463"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-257"></span><span>                          </span><span class="annot"><span class="annottext">TcType -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#unwrapIP"><span class="hs-identifier hs-var">unwrapIP</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681324465"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324464"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324463"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621681324470"><span class="annot"><span class="annottext">origin :: CtOrigin
</span><a href="#local-6989586621681324470"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsIPName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#IPOccOrigin"><span class="hs-identifier hs-var">IPOccOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621681324482"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLam"><span class="hs-identifier hs-type">HsLam</span></a></span><span> </span><span class="annot"><span class="annottext">XLam GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324458"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681324458"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324457"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324457"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324456"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324456"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324455"><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324455"><span class="hs-identifier hs-var">match'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcMatchCtxt HsExpr
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchLambda"><span class="hs-identifier hs-var">tcMatchLambda</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681324453"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324452"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681324458"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324457"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324456"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XLam p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLam"><span class="hs-identifier hs-var">HsLam</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324455"><span class="hs-identifier hs-var">match'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621681324452"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324452"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#LambdaExpr"><span class="hs-identifier hs-var">LambdaExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; ExpRhoType -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621681324453"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681324453"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The lambda expression&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-266"></span><span>                   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Depth -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprSetDepth"><span class="hs-identifier hs-var">pprSetDepth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Depth
</span><a href="GHC.Utils.Outputable.html#PartWay"><span class="hs-identifier hs-var">PartWay</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-267"></span><span>                           </span><span class="annot"><span class="annottext">forall (idR :: Pass) body.
(OutputableBndrId idR, Outputable body) =&gt;
MatchGroup (GhcPass idR) body -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprMatches"><span class="hs-identifier hs-var">pprMatches</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681324458"><span class="hs-identifier hs-var">match</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>                        </span><span class="hs-comment">-- The pprSetDepth makes the abstraction print briefly</span><span>
</span><span id="line-269"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324439"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324439"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLamCase"><span class="hs-identifier hs-type">HsLamCase</span></a></span><span> </span><span id="local-6989586621681324437"><span class="annot"><span class="annottext">XLamCase GhcRn
</span><a href="#local-6989586621681324437"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324436"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681324436"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324435"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324435"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324434"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324434"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324433"><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324433"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcMatchCtxt HsExpr
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchLambda"><span class="hs-identifier hs-var">tcMatchLambda</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681324432"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324431"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681324436"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324435"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-274"></span><span>           </span><span class="hs-comment">-- The laziness annotation is because we don't want to fail here</span><span>
</span><span id="line-275"></span><span>           </span><span class="hs-comment">-- if there are multiple arguments</span><span>
</span><span id="line-276"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324434"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XLamCase p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLamCase"><span class="hs-identifier hs-var">HsLamCase</span></a></span><span> </span><span class="annot"><span class="annottext">XLamCase GhcRn
</span><a href="#local-6989586621681324437"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324433"><span class="hs-identifier hs-var">matches'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>    </span><span id="local-6989586621681324432"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681324432"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The function&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324439"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;requires&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621681324431"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324431"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; ExpRhoType -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Explicit lists
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- Explict lists [e1,e2,e3] have been expanded already in the renamer</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- The expansion includes an ExplicitList, but it is always the built-in</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- list type, so that's all we need concern ourselves with here.  See</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- GHC.Rename.Expr. Note [Handling overloaded and rebindable constructs]</span><span>
</span><span id="line-296"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-type">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324428"><span class="annot"><span class="annottext">[LHsExpr GhcRn]
</span><a href="#local-6989586621681324428"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324427"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324427"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324426"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324426"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324427"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324425"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324425"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324424"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324424"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324426"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324422"><span class="annot"><span class="annottext">tc_elt :: GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621681324422"><span class="hs-identifier hs-var hs-var">tc_elt</span></a></span></span><span> </span><span id="local-6989586621681324421"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621681324421"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621681324421"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324424"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324420"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcTc)]
</span><a href="#local-6989586621681324420"><span class="hs-identifier hs-var">exprs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621681324422"><span class="hs-identifier hs-var">tc_elt</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcRn]
</span><a href="#local-6989586621681324428"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324425"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XExplicitList p -&gt; [LHsExpr p] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324424"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsExpr GhcTc)]
</span><a href="#local-6989586621681324420"><span class="hs-identifier hs-var">exprs'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324417"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681324417"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-type">ExplicitTuple</span></a></span><span> </span><span id="local-6989586621681324415"><span class="annot"><span class="annottext">XExplicitTuple GhcRn
</span><a href="#local-6989586621681324415"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324414"><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681324414"><span class="hs-identifier hs-var">tup_args</span></a></span></span><span> </span><span id="local-6989586621681324413"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681324413"><span class="hs-identifier hs-var">boxity</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324412"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324412"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). HsTupArg (GhcPass p) -&gt; Bool
</span><a href="GHC.Hs.Expr.html#tupArgPresent"><span class="hs-identifier hs-var">tupArgPresent</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681324414"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324409"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621681324409"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681324414"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-306"></span><span>             </span><span id="local-6989586621681324407"><span class="annot"><span class="annottext">tup_tc :: TyCon
</span><a href="#local-6989586621681324407"><span class="hs-identifier hs-var hs-var">tup_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681324413"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324409"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-307"></span><span>               </span><span class="hs-comment">-- NB: tupleTyCon doesn't flatten 1-tuples</span><span>
</span><span id="line-308"></span><span>               </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324405"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324405"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324412"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-310"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324404"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324404"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324403"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324403"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcType -&gt; TcM (TcCoercionR, [TcType])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324407"><span class="hs-identifier hs-var">tup_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324405"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-311"></span><span>                           </span><span class="hs-comment">-- Unboxed tuples have RuntimeRep vars, which we</span><span>
</span><span id="line-312"></span><span>                           </span><span class="hs-comment">-- don't care about here</span><span>
</span><span id="line-313"></span><span>                           </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-314"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324401"><span class="annot"><span class="annottext">arg_tys' :: [TcType]
</span><a href="#local-6989586621681324401"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681324413"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324409"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324403"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-315"></span><span>                                       </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324403"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-316"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324397"><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621681324397"><span class="hs-identifier hs-var">tup_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; [TcType] -&gt; TcM [HsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var">tcTupArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681324414"><span class="hs-identifier hs-var">tup_args</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324401"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-317"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324404"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XExplicitTuple p -&gt; [HsTupArg p] -&gt; Boxity -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-var">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcRn
</span><a href="#local-6989586621681324415"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621681324397"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681324413"><span class="hs-identifier hs-var">boxity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The tup_args are a mixture of Present and Missing (for tuple sections)</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324395"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621681324395"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681324414"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324394"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324394"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681324413"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TcType]
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var">newFlexiTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324395"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-325"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324395"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>       </span><span class="hs-comment">-- Handle tuple sections where</span><span>
</span><span id="line-328"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324390"><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621681324390"><span class="hs-identifier hs-var">tup_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn] -&gt; [TcType] -&gt; TcM [HsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var">tcTupArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681324414"><span class="hs-identifier hs-var">tup_args</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324394"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324389"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681324389"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. XExplicitTuple p -&gt; [HsTupArg p] -&gt; Boxity -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitTuple"><span class="hs-identifier hs-var">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcRn
</span><a href="#local-6989586621681324415"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621681324390"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681324413"><span class="hs-identifier hs-var">boxity</span></a></span><span>
</span><span id="line-331"></span><span>             </span><span id="local-6989586621681324388"><span class="annot"><span class="annottext">missing_tys :: [Scaled TcType]
</span><a href="#local-6989586621681324388"><span class="hs-identifier hs-var hs-var">missing_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324386"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324385"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681324386"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324386"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324385"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324385"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcTc]
</span><a href="#local-6989586621681324390"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324394"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>             </span><span class="hs-comment">-- See Note [Linear fields generalization] in GHC.Tc.Gen.App</span><span>
</span><span id="line-334"></span><span>             </span><span id="local-6989586621681324383"><span class="annot"><span class="annottext">act_res_ty :: TcType
</span><a href="#local-6989586621681324383"><span class="hs-identifier hs-var hs-var">act_res_ty</span></a></span></span><span>
</span><span id="line-335"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681324388"><span class="hs-identifier hs-var">missing_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Builtin.Types.html#mkTupleTy1"><span class="hs-identifier hs-var">mkTupleTy1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681324413"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324394"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>                   </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ExplicitTuple&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324383"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324412"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324417"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324389"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324383"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324412"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExplicitSum"><span class="hs-identifier hs-type">ExplicitSum</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitSum GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324377"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324377"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621681324376"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324376"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621681324375"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324375"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324374"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324374"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324373"><span class="annot"><span class="annottext">sum_tc :: TyCon
</span><a href="#local-6989586621681324373"><span class="hs-identifier hs-var hs-var">sum_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#sumTyCon"><span class="hs-identifier hs-var">sumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324376"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-344"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324371"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324371"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324374"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324370"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324370"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324369"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324369"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcType -&gt; TcM (TcCoercionR, [TcType])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324373"><span class="hs-identifier hs-var">sum_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324371"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-346"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Drop levity vars, we don't care about them here</span><span>
</span><span id="line-347"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324368"><span class="annot"><span class="annottext">arg_tys' :: [TcType]
</span><a href="#local-6989586621681324368"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324376"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324369"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-348"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324367"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324367"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324375"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324368"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; Int -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324377"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324370"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XExplicitSum p -&gt; Int -&gt; Int -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ExplicitSum"><span class="hs-identifier hs-var">ExplicitSum</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324368"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324377"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324376"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324367"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Let, case, if, do
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLet"><span class="hs-identifier hs-type">HsLet</span></a></span><span> </span><span id="local-6989586621681324364"><span class="annot"><span class="annottext">XLet GhcRn
</span><a href="#local-6989586621681324364"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324363"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621681324363"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span id="local-6989586621681324362"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324362"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324361"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324361"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324360"><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621681324360"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324359"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324359"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall thing.
HsLocalBinds GhcRn -&gt; TcM thing -&gt; TcM (HsLocalBinds GhcTc, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621681324363"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-362"></span><span>                             </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324362"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324361"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XLet p -&gt; HsLocalBinds p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLet"><span class="hs-identifier hs-var">HsLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet GhcRn
</span><a href="#local-6989586621681324364"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621681324360"><span class="hs-identifier hs-var">binds'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324359"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-type">HsCase</span></a></span><span> </span><span id="local-6989586621681324357"><span class="annot"><span class="annottext">XCase GhcRn
</span><a href="#local-6989586621681324357"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324356"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324356"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621681324355"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681324355"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324354"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324354"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- We used to typecheck the case alternatives first.</span><span>
</span><span id="line-367"></span><span>           </span><span class="hs-comment">-- The case patterns tend to give good type info to use</span><span>
</span><span id="line-368"></span><span>           </span><span class="hs-comment">-- when typechecking the scrutinee.  For example</span><span>
</span><span id="line-369"></span><span>           </span><span class="hs-comment">--   case (map f) of</span><span>
</span><span id="line-370"></span><span>           </span><span class="hs-comment">--     (x:xs) -&gt; ...</span><span>
</span><span id="line-371"></span><span>           </span><span class="hs-comment">-- will report that map is applied to too few arguments</span><span>
</span><span id="line-372"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-373"></span><span>           </span><span class="hs-comment">-- But now, in the GADT world, we need to typecheck the scrutinee</span><span>
</span><span id="line-374"></span><span>           </span><span class="hs-comment">-- first, to get type info that may be refined in the case alternatives</span><span>
</span><span id="line-375"></span><span>          </span><span id="local-6989586621681324353"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324353"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>          </span><span class="hs-comment">-- Typecheck the scrutinee.  We use tcInferRho but tcInferSigma</span><span>
</span><span id="line-378"></span><span>          </span><span class="hs-comment">-- would also be possible (tcMatchesCase accepts sigma-types)</span><span>
</span><span id="line-379"></span><span>          </span><span class="hs-comment">-- Interesting litmus test: do these two behave the same?</span><span>
</span><span id="line-380"></span><span>          </span><span class="hs-comment">--     case id        of {..}</span><span>
</span><span id="line-381"></span><span>          </span><span class="hs-comment">--     case (\v -&gt; v) of {..}</span><span>
</span><span id="line-382"></span><span>          </span><span class="hs-comment">-- This design choice is discussed in #17790</span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324350"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324350"><span class="hs-identifier hs-var">scrut'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324349"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324349"><span class="hs-identifier hs-var">scrut_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324353"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324356"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HsCase&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324349"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324348"><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324348"><span class="hs-identifier hs-var">matches'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (body :: * -&gt; *).
AnnoBody body =&gt;
TcMatchCtxt body
-&gt; Scaled TcType
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (MatchGroup GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchesCase"><span class="hs-identifier hs-var">tcMatchesCase</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324346"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324353"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324349"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681324355"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324354"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p.
XCase p -&gt; LHsExpr p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-var">HsCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCase GhcRn
</span><a href="#local-6989586621681324357"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324350"><span class="hs-identifier hs-var">scrut'</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324348"><span class="hs-identifier hs-var">matches'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-388"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621681324346"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324346"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-390"></span><span>                      </span><span class="annot"><span class="annottext">mc_body :: GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; ExpRhoType -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsIf"><span class="hs-identifier hs-type">HsIf</span></a></span><span> </span><span id="local-6989586621681324344"><span class="annot"><span class="annottext">XIf GhcRn
</span><a href="#local-6989586621681324344"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324343"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324343"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621681324342"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324342"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681324341"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324341"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324340"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324340"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324339"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324339"><span class="hs-identifier hs-var">pred'</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324343"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span>
</span><span id="line-394"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324337"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681324337"><span class="hs-identifier hs-var">u1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681324336"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324336"><span class="hs-identifier hs-var">b1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324342"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324340"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-395"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324334"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681324334"><span class="hs-identifier hs-var">u2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681324333"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324333"><span class="hs-identifier hs-var">b2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324341"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324340"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-396"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UsageEnv -&gt; UsageEnv -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#supUE"><span class="hs-identifier hs-var">supUE</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681324337"><span class="hs-identifier hs-var">u1</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681324334"><span class="hs-identifier hs-var">u2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XIf p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsIf"><span class="hs-identifier hs-var">HsIf</span></a></span><span> </span><span class="annot"><span class="annottext">XIf GhcRn
</span><a href="#local-6989586621681324344"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324339"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324336"><span class="hs-identifier hs-var">b1'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324333"><span class="hs-identifier hs-var">b2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMultiIf"><span class="hs-identifier hs-type">HsMultiIf</span></a></span><span> </span><span class="annot"><span class="annottext">XMultiIf GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324330"><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681324330"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324329"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324329"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324328"><span class="annot"><span class="annottext">[Located (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621681324328"><span class="hs-identifier hs-var">alts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM (Located b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (body :: * -&gt; *).
TcMatchCtxt body
-&gt; ExpRhoType
-&gt; GRHS GhcRn (LocatedA (body GhcRn))
-&gt; TcM (GRHS GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHS"><span class="hs-identifier hs-var">tcGRHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324325"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324329"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681324330"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-401"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324324"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324324"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324329"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-402"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XMultiIf p -&gt; [LGRHS p (LHsExpr p)] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsMultiIf"><span class="hs-identifier hs-var">HsMultiIf</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324324"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (GRHS GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621681324328"><span class="hs-identifier hs-var">alts'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681324325"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681324325"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#IfAlt"><span class="hs-identifier hs-var">IfAlt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; ExpRhoType -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><span class="annottext">XDo GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324320"><span class="annot"><span class="annottext">HsStmtContext (HsDoRn GhcRn)
</span><a href="#local-6989586621681324320"><span class="hs-identifier hs-var">do_or_lc</span></a></span></span><span> </span><span id="local-6989586621681324319"><span class="annot"><span class="annottext">XRec GhcRn [ExprLStmt GhcRn]
</span><a href="#local-6989586621681324319"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324318"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324318"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsStmtContext GhcRn
-&gt; LocatedL [ExprLStmt GhcRn] -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var">tcDoStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext (HsDoRn GhcRn)
</span><a href="#local-6989586621681324320"><span class="hs-identifier hs-var">do_or_lc</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn [ExprLStmt GhcRn]
</span><a href="#local-6989586621681324319"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324318"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProc"><span class="hs-identifier hs-type">HsProc</span></a></span><span> </span><span id="local-6989586621681324315"><span class="annot"><span class="annottext">XProc GhcRn
</span><a href="#local-6989586621681324315"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681324314"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681324314"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681324313"><span class="annot"><span class="annottext">LHsCmdTop GhcRn
</span><a href="#local-6989586621681324313"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324312"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324312"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324311"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621681324311"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324310"><span class="annot"><span class="annottext">GenLocated SrcSpan (HsCmdTop GhcTc)
</span><a href="#local-6989586621681324310"><span class="hs-identifier hs-var">cmd'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324309"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324309"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
-&gt; LHsCmdTop GhcRn
-&gt; ExpRhoType
-&gt; TcM (LPat GhcTc, LHsCmdTop GhcTc, TcCoercionR)
</span><a href="GHC.Tc.Gen.Arrow.html#tcProc"><span class="hs-identifier hs-var">tcProc</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681324314"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcRn
</span><a href="#local-6989586621681324313"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324312"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324309"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XProc p -&gt; LPat p -&gt; LHsCmdTop p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsProc"><span class="hs-identifier hs-var">HsProc</span></a></span><span> </span><span class="annot"><span class="annottext">XProc GhcRn
</span><a href="#local-6989586621681324315"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621681324311"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsCmdTop GhcTc)
</span><a href="#local-6989586621681324310"><span class="hs-identifier hs-var">cmd'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">-- Typechecks the static form and wraps it with a call to 'fromStaticPtr'.</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- See Note [Grand plan for static forms] in GHC.Iface.Tidy.StaticPtrTable for an overview.</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- To type check</span><span>
</span><span id="line-415"></span><span class="hs-comment">--      (static e) :: p a</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- we want to check (e :: a),</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- and wrap (static e) in a call to</span><span>
</span><span id="line-418"></span><span class="hs-comment">--    fromStaticPtr :: IsStatic p =&gt; StaticPtr a -&gt; p a</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsStatic"><span class="hs-identifier hs-type">HsStatic</span></a></span><span> </span><span id="local-6989586621681324306"><span class="annot"><span class="annottext">XStatic GhcRn
</span><a href="#local-6989586621681324306"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681324305"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324305"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324304"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324304"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324303"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324303"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324304"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324302"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324302"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324301"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324301"><span class="hs-identifier hs-var">p_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324300"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324300"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, (TcType, TcType))
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedAppTy"><span class="hs-identifier hs-var">matchExpectedAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324303"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324298"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324298"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324297"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681324297"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-424"></span><span>            </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the body of a static form:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>                             </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324305"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>                       </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-427"></span><span>            </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324305"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324300"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-comment">-- Check that the free variables of the static form are closed.</span><span>
</span><span id="line-430"></span><span>        </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here as the only side effects of</span><span>
</span><span id="line-431"></span><span>        </span><span class="hs-comment">-- checkClosedInStaticForm are error messages.</span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-var">checkClosedInStaticForm</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">XStatic GhcRn
</span><a href="#local-6989586621681324306"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-comment">-- Require the type of the argument to be Typeable.</span><span>
</span><span id="line-435"></span><span>        </span><span class="hs-comment">-- The evidence is not used, but asking the constraint ensures that</span><span>
</span><span id="line-436"></span><span>        </span><span class="hs-comment">-- the current implementation is as restrictive as future versions</span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-comment">-- of the StaticPointers extension.</span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324291"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681324291"><span class="hs-identifier hs-var">typeableClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeableClassName"><span class="hs-identifier hs-var">typeableClassName</span></a></span><span>
</span><span id="line-439"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM Var
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#StaticOrigin"><span class="hs-identifier hs-var">StaticOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-440"></span><span>                  </span><span class="annot"><span class="annottext">TyCon -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681324291"><span class="hs-identifier hs-var">typeableClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324300"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-comment">-- Insert the constraints of the static form in a global list for later</span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-comment">-- validation.</span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier hs-var">emitStaticConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681324297"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-comment">-- Wrap the static form with the 'fromStaticPtr' call.</span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324286"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324286"><span class="hs-identifier hs-var">fromStaticPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#StaticOrigin"><span class="hs-identifier hs-var">StaticOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fromStaticPtrName"><span class="hs-identifier hs-var">fromStaticPtrName</span></a></span><span>
</span><span id="line-449"></span><span>                                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324301"><span class="hs-identifier hs-var">p_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-450"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324283"><span class="annot"><span class="annottext">wrap :: HsWrapper
</span><a href="#local-6989586621681324283"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324300"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324281"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681324281"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324302"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span>
</span><span id="line-453"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681324281"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324283"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324286"><span class="hs-identifier hs-var">fromStaticPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681324281"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XStatic p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsStatic"><span class="hs-identifier hs-var">HsStatic</span></a></span><span> </span><span class="annot"><span class="annottext">XStatic GhcRn
</span><a href="#local-6989586621681324306"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324298"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Record construction and update
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324277"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681324277"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_con :: forall p. HsExpr p -&gt; XRec p (ConLikeP p)
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_con"><span class="hs-identifier hs-var">rcon_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324274"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681324274"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324273"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681324273"><span class="hs-identifier hs-var">con_name</span></a></span></span><span>
</span><span id="line-466"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_flds :: forall p. HsExpr p -&gt; HsRecordBinds p
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681324271"><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681324271"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324270"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324270"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681324269"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324269"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM ConLike
</span><a href="GHC.Tc.Utils.Env.html#tcLookupConLike"><span class="hs-identifier hs-var">tcLookupConLike</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681324273"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324267"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324267"><span class="hs-identifier hs-var">con_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324266"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324266"><span class="hs-identifier hs-var">con_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferId"><span class="hs-identifier hs-var">tcInferId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681324273"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324264"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324264"><span class="hs-identifier hs-var">con_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324263"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324263"><span class="hs-identifier hs-var">con_tau</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681324261"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324266"><span class="hs-identifier hs-var">con_sigma</span></a></span><span>
</span><span id="line-471"></span><span>              </span><span class="hs-comment">-- a shallow instantiation should really be enough for</span><span>
</span><span id="line-472"></span><span>              </span><span class="hs-comment">-- a data constructor.</span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324260"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621681324260"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Int
</span><a href="GHC.Core.ConLike.html#conLikeArity"><span class="hs-identifier hs-var">conLikeArity</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324269"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-474"></span><span>              </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324258"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681324258"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324257"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324257"><span class="hs-identifier hs-var">actual_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcType -&gt; Either Int ([Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTysN"><span class="hs-identifier hs-var">tcSplitFunTysN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681324260"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324263"><span class="hs-identifier hs-var">con_tau</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Bool
</span><a href="GHC.Core.ConLike.html#conLikeHasBuilder"><span class="hs-identifier hs-var">conLikeHasBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324269"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-477"></span><span>          </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#nonBidirectionalErr"><span class="hs-identifier hs-var">nonBidirectionalErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Name
</span><a href="GHC.Core.ConLike.html#conLikeName"><span class="hs-identifier hs-var">conLikeName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324269"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324251"><span class="annot"><span class="annottext">HsRecFields GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324251"><span class="hs-identifier hs-var">rbinds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [TcType] -&gt; HsRecordBinds GhcRn -&gt; TcM (HsRecordBinds GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-var">tcRecordBinds</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324269"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681324258"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681324271"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-480"></span><span>                   </span><span class="hs-comment">-- It is currently not possible for a record to have</span><span>
</span><span id="line-481"></span><span>                   </span><span class="hs-comment">-- multiplicities. When they do, `tcRecordBinds` will take</span><span>
</span><span id="line-482"></span><span>                   </span><span class="hs-comment">-- scaled types instead. Meanwhile, it's safe to take</span><span>
</span><span id="line-483"></span><span>                   </span><span class="hs-comment">-- `scaledThing` above, as we know all the multiplicities are</span><span>
</span><span id="line-484"></span><span>                   </span><span class="hs-comment">-- Many.</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324248"><span class="annot"><span class="annottext">rcon_tc :: HsExpr GhcTc
</span><a href="#local-6989586621681324248"><span class="hs-identifier hs-var hs-var">rcon_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324264"><span class="hs-identifier hs-var">con_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324267"><span class="hs-identifier hs-var">con_expr</span></a></span><span>
</span><span id="line-487"></span><span>              </span><span id="local-6989586621681324247"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681324247"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_ext :: XRecordCon GhcTc
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_ext"><span class="hs-identifier hs-var">rcon_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324248"><span class="hs-identifier hs-var">rcon_tc</span></a></span><span>
</span><span id="line-488"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_con"><span class="hs-identifier hs-var">rcon_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681324274"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324269"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-489"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_flds :: HsRecordBinds GhcTc
</span><a href="Language.Haskell.Syntax.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecFields GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681324251"><span class="hs-identifier hs-var">rbinds'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324245"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324245"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324277"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324247"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324257"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324270"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-comment">-- Check for missing fields.  We do this after type-checking to get</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-comment">-- better types in error messages (cf #18869).  For example:</span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-comment">--     data T a = MkT { x :: a, y :: a }</span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-comment">--     r = MkT { y = True }</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-comment">-- Then we'd like to warn about a missing field `x :: True`, rather than `x :: a0`.</span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-comment">-- NB: to do this really properly we should delay reporting until typechecking is complete,</span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-comment">-- via a new `HoleSort`.  But that seems too much work.</span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; HsRecordBinds GhcRn -&gt; [Scaled TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-var">checkMissingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324269"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681324271"><span class="hs-identifier hs-var">rbinds</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681324258"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324245"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-505"></span><span>    </span><span id="local-6989586621681324261"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621681324261"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681324273"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">{-
Note [Type of a record update]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The main complication with RecordUpd is that we need to explicitly
handle the *non-updated* fields.  Consider:

        data T a b c = MkT1 { fa :: a, fb :: (b,c) }
                     | MkT2 { fa :: a, fb :: (b,c), fc :: c -&gt; c }
                     | MkT3 { fd :: a }

        upd :: T a b c -&gt; (b',c) -&gt; T a b' c
        upd t x = t { fb = x}

The result type should be (T a b' c)
not (T a b c),   because 'b' *is not* mentioned in a non-updated field
not (T a b' c'), because 'c' *is*     mentioned in a non-updated field
NB that it's not good enough to look at just one constructor; we must
look at them all; cf #3219

After all, upd should be equivalent to:
        upd t x = case t of
                        MkT1 p q -&gt; MkT1 p x
                        MkT2 a b -&gt; MkT2 p b
                        MkT3 d   -&gt; error ...

So we need to give a completely fresh type to the result record,
and then constrain it by the fields that are *not* updated (&quot;p&quot; above).
We call these the &quot;fixed&quot; type variables, and compute them in getFixedTyVars.

Note that because MkT3 doesn't contain all the fields being updated,
its RHS is simply an error, so it doesn't impose any type constraints.
Hence the use of 'relevant_cont'.

Note [Implicit type sharing]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
We also take into account any &quot;implicit&quot; non-update fields.  For example
        data T a b where { MkT { f::a } :: T a a; ... }
So the &quot;real&quot; type of MkT is: forall ab. (a~b) =&gt; a -&gt; T a b

Then consider
        upd t x = t { f=x }
We infer the type
        upd :: T a b -&gt; a -&gt; T a b
        upd (t::T a b) (x::a)
           = case t of { MkT (co:a~b) (_:a) -&gt; MkT co x }
We can't give it the more general type
        upd :: T a b -&gt; c -&gt; T c b

Note [Criteria for update]
~~~~~~~~~~~~~~~~~~~~~~~~~~
We want to allow update for existentials etc, provided the updated
field isn't part of the existential. For example, this should be ok.
  data T a where { MkT { f1::a, f2::b-&gt;b } :: T a }
  f :: T a -&gt; b -&gt; T b
  f t b = t { f1=b }

The criterion we use is this:

  The types of the updated fields
  mention only the universally-quantified type variables
  of the data constructor

NB: this is not (quite) the same as being a &quot;naughty&quot; record selector
(See Note [Naughty record selectors]) in GHC.Tc.TyCl), at least
in the case of GADTs. Consider
   data T a where { MkT :: { f :: a } :: T [a] }
Then f is not &quot;naughty&quot; because it has a well-typed record selector.
But we don't allow updates for 'f'.  (One could consider trying to
allow this, but it makes my head hurt.  Badly.  And no one has asked
for it.)

In principle one could go further, and allow
  g :: T a -&gt; T a
  g t = t { f2 = \x -&gt; x }
because the expression is polymorphic...but that seems a bridge too far.

Note [Data family example]
~~~~~~~~~~~~~~~~~~~~~~~~~~
    data instance T (a,b) = MkT { x::a, y::b }
  ---&gt;
    data :TP a b = MkT { a::a, y::b }
    coTP a b :: T (a,b) ~ :TP a b

Suppose r :: T (t1,t2), e :: t3
Then  r { x=e } :: T (t3,t1)
  ---&gt;
      case r |&gt; co1 of
        MkT x y -&gt; MkT e y |&gt; co2
      where co1 :: T (t1,t2) ~ :TP t1 t2
            co2 :: :TP t3 t2 ~ T (t3,t2)
The wrapping with co2 is done by the constructor wrapper for MkT

Outgoing invariants
~~~~~~~~~~~~~~~~~~~
In the outgoing (HsRecordUpd scrut binds cons in_inst_tys out_inst_tys):

  * cons are the data constructors to be updated

  * in_inst_tys, out_inst_tys have same length, and instantiate the
        *representation* tycon of the data cons.  In Note [Data
        family example], in_inst_tys = [t1,t2], out_inst_tys = [t3,t2]

Note [Mixed Record Field Updates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the following pattern synonym.

  data MyRec = MyRec { foo :: Int, qux :: String }

  pattern HisRec{f1, f2} = MyRec{foo = f1, qux=f2}

This allows updates such as the following

  updater :: MyRec -&gt; MyRec
  updater a = a {f1 = 1 }

It would also make sense to allow the following update (which we reject).

  updater a = a {f1 = 1, qux = &quot;two&quot; } ==? MyRec 1 &quot;two&quot;

This leads to confusing behaviour when the selectors in fact refer the same
field.

  updater a = a {f1 = 1, foo = 2} ==? ???

For this reason, we reject a mixture of pattern synonym and normal record
selectors in the same update block. Although of course we still allow the
following.

  updater a = (a {f1 = 1}) {foo = 2}

  &gt; updater (MyRec 0 &quot;str&quot;)
  MyRec 2 &quot;str&quot;

-}</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-comment">-- Record updates via dot syntax are replaced by desugared expressions</span><span>
</span><span id="line-643"></span><span class="hs-comment">-- in the renamer. See Note [Overview of record dot syntax] in</span><span>
</span><span id="line-644"></span><span class="hs-comment">-- GHC.Hs.Expr. This is why we match on 'rupd_flds = Left rbnds' here</span><span>
</span><span id="line-645"></span><span class="hs-comment">-- and panic otherwise.</span><span>
</span><span id="line-646"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324242"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681324242"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: forall p. HsExpr p -&gt; LHsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681324239"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324239"><span class="hs-identifier hs-var">record_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: forall p. HsExpr p -&gt; Either [LHsRecUpdField p] [LHsRecUpdProj p]
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681324237"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681324237"><span class="hs-identifier hs-var">rbnds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324236"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324236"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">rbnds</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- STEP -2: typecheck the record_expr, the record to be updated</span><span>
</span><span id="line-649"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681324230"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324230"><span class="hs-identifier hs-var">record_expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324229"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324229"><span class="hs-identifier hs-var">record_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324239"><span class="hs-identifier hs-var">record_expr</span></a></span><span>
</span><span id="line-650"></span><span>            </span><span class="hs-comment">-- Record update drops some of the content of the record (namely the</span><span>
</span><span id="line-651"></span><span>            </span><span class="hs-comment">-- content of the field being updated). As a consequence, unless the</span><span>
</span><span id="line-652"></span><span>            </span><span class="hs-comment">-- field being updated is unrestricted in the record, or we need an</span><span>
</span><span id="line-653"></span><span>            </span><span class="hs-comment">-- unrestricted record. Currently, we simply always require an</span><span>
</span><span id="line-654"></span><span>            </span><span class="hs-comment">-- unrestricted record.</span><span>
</span><span id="line-655"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-656"></span><span>            </span><span class="hs-comment">-- Consider the following example:</span><span>
</span><span id="line-657"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-658"></span><span>            </span><span class="hs-comment">-- data R a = R { self :: a }</span><span>
</span><span id="line-659"></span><span>            </span><span class="hs-comment">-- bad :: a &#8888; ()</span><span>
</span><span id="line-660"></span><span>            </span><span class="hs-comment">-- bad x = let r = R x in case r { self = () } of { R x' -&gt; x' }</span><span>
</span><span id="line-661"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-662"></span><span>            </span><span class="hs-comment">-- This should definitely *not* typecheck.</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-comment">-- STEP -1  See Note [Disambiguating record fields] in GHC.Tc.Gen.Head</span><span>
</span><span id="line-665"></span><span>        </span><span class="hs-comment">-- After this we know that rbinds is unambiguous</span><span>
</span><span id="line-666"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324227"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsRecField'
      (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621681324227"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; TcType
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM
     [LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-var">disambiguateRecordBinds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324239"><span class="hs-identifier hs-var">record_expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324229"><span class="hs-identifier hs-var">record_rho</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681324237"><span class="hs-identifier hs-var">rbnds</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324236"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-667"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324225"><span class="annot"><span class="annottext">upd_flds :: [AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621681324225"><span class="hs-identifier hs-var hs-var">upd_flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsRecField'
      (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621681324227"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-668"></span><span>              </span><span id="local-6989586621681324221"><span class="annot"><span class="annottext">upd_fld_occs :: [FieldLabelString]
</span><a href="#local-6989586621681324221"><span class="hs-identifier hs-var hs-var">upd_fld_occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FieldLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621681324225"><span class="hs-identifier hs-var">upd_flds</span></a></span><span>
</span><span id="line-669"></span><span>              </span><span id="local-6989586621681324217"><span class="annot"><span class="annottext">sel_ids :: [Var]
</span><a href="#local-6989586621681324217"><span class="hs-identifier hs-var hs-var">sel_ids</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; Var
</span><a href="GHC.Hs.Type.html#selectorAmbiguousFieldOcc"><span class="hs-identifier hs-var">selectorAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">[AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621681324225"><span class="hs-identifier hs-var">upd_flds</span></a></span><span>
</span><span id="line-670"></span><span>        </span><span class="hs-comment">-- STEP 0</span><span>
</span><span id="line-671"></span><span>        </span><span class="hs-comment">-- Check that the field names are really field names</span><span>
</span><span id="line-672"></span><span>        </span><span class="hs-comment">-- and they are all field names for proper records or</span><span>
</span><span id="line-673"></span><span>        </span><span class="hs-comment">-- all field names for pattern synonyms.</span><span>
</span><span id="line-674"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324215"><span class="annot"><span class="annottext">bad_guys :: [TcRn ()]
</span><a href="#local-6989586621681324215"><span class="hs-identifier hs-var hs-var">bad_guys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681324213"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#notSelector"><span class="hs-identifier hs-var">notSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681324210"><span class="hs-identifier hs-var">fld_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681324209"><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsRecField'
     (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621681324209"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsRecField'
      (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621681324227"><span class="hs-identifier hs-var">rbinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-676"></span><span>                           </span><span class="hs-comment">-- Excludes class ops</span><span>
</span><span id="line-677"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681324213"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681324213"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681324208"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324208"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall arg.
HsRecField' (AmbiguousFieldOcc GhcTc) arg -&gt; GenLocated SrcSpan Var
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldId"><span class="hs-identifier hs-var">hsRecUpdFieldId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (HsRecField'
     (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
</span><a href="#local-6989586621681324209"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-678"></span><span>                           </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="GHC.Types.Id.html#isRecordSelector"><span class="hs-identifier hs-var">isRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324208"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-679"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324210"><span class="annot"><span class="annottext">fld_name :: Name
</span><a href="#local-6989586621681324210"><span class="hs-identifier hs-var hs-var">fld_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324208"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-680"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcRn ()]
</span><a href="#local-6989586621681324215"><span class="hs-identifier hs-var">bad_guys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="annot"><span class="annottext">[TcRn ()]
</span><a href="#local-6989586621681324215"><span class="hs-identifier hs-var">bad_guys</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>        </span><span class="hs-comment">-- See note [Mixed Record Selectors]</span><span>
</span><span id="line-682"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324200"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324200"><span class="hs-identifier hs-var">data_sels</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324199"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324199"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-683"></span><span>                </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="GHC.Types.Id.html#isDataConRecordSelector"><span class="hs-identifier hs-var">isDataConRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324217"><span class="hs-identifier hs-var">sel_ids</span></a></span><span>
</span><span id="line-684"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">isPatSynRecordSelector</span><span> </span><span class="hs-identifier">pat_syn_sels</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324200"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324199"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var">mixedSelectors</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324200"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324199"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-comment">-- STEP 1</span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-comment">-- Figure out the tycon and data cons from the first field name</span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>   </span><span class="hs-comment">-- It's OK to use the non-tc splitters here (for a selector)</span><span>
</span><span id="line-691"></span><span>              </span><span id="local-6989586621681324194"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324194"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324217"><span class="hs-identifier hs-var">sel_ids</span></a></span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>              </span><span class="annot"><a href="#local-6989586621681324193"><span class="hs-identifier hs-type">mtycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-694"></span><span>              </span><span id="local-6989586621681324193"><span class="annot"><span class="annottext">mtycon :: Maybe TyCon
</span><a href="#local-6989586621681324193"><span class="hs-identifier hs-var hs-var">mtycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324194"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-695"></span><span>                          </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621681324189"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324189"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324189"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-696"></span><span>                          </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>              </span><span class="annot"><a href="#local-6989586621681324188"><span class="hs-identifier hs-type">con_likes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-699"></span><span>              </span><span id="local-6989586621681324188"><span class="annot"><span class="annottext">con_likes :: [ConLike]
</span><a href="#local-6989586621681324188"><span class="hs-identifier hs-var hs-var">con_likes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324194"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-700"></span><span>                             </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621681324187"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324187"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-701"></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324187"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>                             </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelPatSyn"><span class="hs-identifier hs-type">RecSelPatSyn</span></a></span><span> </span><span id="local-6989586621681324183"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681324183"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-703"></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681324183"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-704"></span><span>                             </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordUpd&quot;</span></span><span>
</span><span id="line-705"></span><span>                </span><span class="hs-comment">-- NB: for a data type family, the tycon is the instance tycon</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>              </span><span id="local-6989586621681324180"><span class="annot"><span class="annottext">relevant_cons :: [ConLike]
</span><a href="#local-6989586621681324180"><span class="hs-identifier hs-var hs-var">relevant_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConLike] -&gt; [FieldLabelString] -&gt; [ConLike]
</span><a href="GHC.Core.ConLike.html#conLikesWithFields"><span class="hs-identifier hs-var">conLikesWithFields</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681324188"><span class="hs-identifier hs-var">con_likes</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681324221"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span>
</span><span id="line-708"></span><span>                </span><span class="hs-comment">-- A constructor is only relevant to this process if</span><span>
</span><span id="line-709"></span><span>                </span><span class="hs-comment">-- it contains *all* the fields that are being updated</span><span>
</span><span id="line-710"></span><span>                </span><span class="hs-comment">-- Other ones will cause a runtime error if they occur</span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span>        </span><span class="hs-comment">-- Step 2</span><span>
</span><span id="line-713"></span><span>        </span><span class="hs-comment">-- Check that at least one constructor has all the named fields</span><span>
</span><span id="line-714"></span><span>        </span><span class="hs-comment">-- i.e. has an empty set of bad fields returned by badFields</span><span>
</span><span id="line-715"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681324180"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [ConLike] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-var">badFieldsUpd</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsRecField'
      (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621681324227"><span class="hs-identifier hs-var">rbinds</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681324188"><span class="hs-identifier hs-var">con_likes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span>        </span><span class="hs-comment">-- Take apart a representative constructor</span><span>
</span><span id="line-718"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324177"><span class="annot"><span class="annottext">con1 :: ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var hs-var">con1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">relevant_cons</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">head</span><span> </span><span class="hs-identifier">relevant_cons</span><span>
</span><span id="line-719"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621681324175"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324175"><span class="hs-identifier hs-var">con1_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324174"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324174"><span class="hs-identifier hs-var">_prov_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324173"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324173"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324172"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681324172"><span class="hs-identifier hs-var">scaled_con1_arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; ([Var], [Var], [EqSpec], [TcType], [TcType], [Scaled TcType],
    TcType)
</span><a href="GHC.Core.ConLike.html#conLikeFullSig"><span class="hs-identifier hs-var">conLikeFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var">con1</span></a></span><span>
</span><span id="line-721"></span><span>              </span><span id="local-6989586621681324170"><span class="annot"><span class="annottext">con1_arg_tys :: [TcType]
</span><a href="#local-6989586621681324170"><span class="hs-identifier hs-var hs-var">con1_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681324172"><span class="hs-identifier hs-var">scaled_con1_arg_tys</span></a></span><span>
</span><span id="line-722"></span><span>                </span><span class="hs-comment">-- We can safely drop the fields' multiplicities because</span><span>
</span><span id="line-723"></span><span>                </span><span class="hs-comment">-- they are currently always 1: there is no syntax for record</span><span>
</span><span id="line-724"></span><span>                </span><span class="hs-comment">-- fields with other multiplicities yet. This way we don't need</span><span>
</span><span id="line-725"></span><span>                </span><span class="hs-comment">-- to handle it in the rest of the function</span><span>
</span><span id="line-726"></span><span>              </span><span id="local-6989586621681324169"><span class="annot"><span class="annottext">con1_flds :: [FieldLabelString]
</span><a href="#local-6989586621681324169"><span class="hs-identifier hs-var hs-var">con1_flds</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var">con1</span></a></span><span>
</span><span id="line-727"></span><span>              </span><span id="local-6989586621681324166"><span class="annot"><span class="annottext">con1_tv_tys :: [TcType]
</span><a href="#local-6989586621681324166"><span class="hs-identifier hs-var hs-var">con1_tv_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324175"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span>
</span><span id="line-728"></span><span>              </span><span id="local-6989586621681324164"><span class="annot"><span class="annottext">con1_res_ty :: TcType
</span><a href="#local-6989586621681324164"><span class="hs-identifier hs-var hs-var">con1_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681324193"><span class="hs-identifier hs-var">mtycon</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-729"></span><span>                              </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681324163"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324163"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Type.html#mkFamilyTyConApp"><span class="hs-identifier hs-var">mkFamilyTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324163"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324166"><span class="hs-identifier hs-var">con1_tv_tys</span></a></span><span>
</span><span id="line-730"></span><span>                              </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.ConLike.html#conLikeResTy"><span class="hs-identifier hs-var">conLikeResTy</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324166"><span class="hs-identifier hs-var">con1_tv_tys</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span>        </span><span class="hs-comment">-- Check that we're not dealing with a unidirectional pattern</span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-comment">-- synonym</span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Bool
</span><a href="GHC.Core.ConLike.html#conLikeHasBuilder"><span class="hs-identifier hs-var">conLikeHasBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-735"></span><span>          </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#nonBidirectionalErr"><span class="hs-identifier hs-var">nonBidirectionalErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Name
</span><a href="GHC.Core.ConLike.html#conLikeName"><span class="hs-identifier hs-var">conLikeName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span>        </span><span class="hs-comment">-- STEP 3    Note [Criteria for update]</span><span>
</span><span id="line-738"></span><span>        </span><span class="hs-comment">-- Check that each updated field is polymorphic; that is, its type</span><span>
</span><span id="line-739"></span><span>        </span><span class="hs-comment">-- mentions only the universally-quantified variables of the data con</span><span>
</span><span id="line-740"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324160"><span class="annot"><span class="annottext">flds1_w_tys :: [(FieldLabelString, TcType)]
</span><a href="#local-6989586621681324160"><span class="hs-identifier hs-var hs-var">flds1_w_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:RecConUpd&quot;</span></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681324169"><span class="hs-identifier hs-var">con1_flds</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324170"><span class="hs-identifier hs-var">con1_arg_tys</span></a></span><span>
</span><span id="line-741"></span><span>              </span><span id="local-6989586621681324158"><span class="annot"><span class="annottext">bad_upd_flds :: [(FieldLabelString, TcType)]
</span><a href="#local-6989586621681324158"><span class="hs-identifier hs-var hs-var">bad_upd_flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, TcType) -&gt; Bool
</span><a href="#local-6989586621681324157"><span class="hs-identifier hs-var">bad_fld</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681324160"><span class="hs-identifier hs-var">flds1_w_tys</span></a></span><span>
</span><span id="line-742"></span><span>              </span><span id="local-6989586621681324156"><span class="annot"><span class="annottext">con1_tv_set :: VarSet
</span><a href="#local-6989586621681324156"><span class="hs-identifier hs-var hs-var">con1_tv_set</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324175"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span>
</span><span id="line-743"></span><span>              </span><span id="local-6989586621681324157"><span class="annot"><span class="annottext">bad_fld :: (FieldLabelString, TcType) -&gt; Bool
</span><a href="#local-6989586621681324157"><span class="hs-identifier hs-var hs-var">bad_fld</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324154"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681324154"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324153"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324153"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681324154"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681324221"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-744"></span><span>                                      </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324153"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#subVarSet"><span class="hs-operator hs-var">`subVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681324156"><span class="hs-identifier hs-var">con1_tv_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681324158"><span class="hs-identifier hs-var">bad_upd_flds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldTypes"><span class="hs-identifier hs-var">badFieldTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681324158"><span class="hs-identifier hs-var">bad_upd_flds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>        </span><span class="hs-comment">-- STEP 4  Note [Type of a record update]</span><span>
</span><span id="line-748"></span><span>        </span><span class="hs-comment">-- Figure out types for the scrutinee and result</span><span>
</span><span id="line-749"></span><span>        </span><span class="hs-comment">-- Both are of form (T a b c), with fresh type variables, but with</span><span>
</span><span id="line-750"></span><span>        </span><span class="hs-comment">-- common variables where the scrutinee and result must have the same type</span><span>
</span><span id="line-751"></span><span>        </span><span class="hs-comment">-- These are variables that appear in *any* arg of *any* of the</span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-comment">-- relevant constructors *except* in the updated fields</span><span>
</span><span id="line-753"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-754"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324148"><span class="annot"><span class="annottext">fixed_tvs :: VarSet
</span><a href="#local-6989586621681324148"><span class="hs-identifier hs-var hs-var">fixed_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; [Var] -&gt; [ConLike] -&gt; VarSet
</span><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier hs-var">getFixedTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681324221"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324175"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681324180"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span>
</span><span id="line-755"></span><span>              </span><span id="local-6989586621681324147"><span class="annot"><span class="annottext">is_fixed_tv :: Var -&gt; Bool
</span><a href="#local-6989586621681324147"><span class="hs-identifier hs-var hs-var">is_fixed_tv</span></a></span></span><span> </span><span id="local-6989586621681324146"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324146"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324146"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681324148"><span class="hs-identifier hs-var">fixed_tvs</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>              </span><span class="annot"><a href="#local-6989586621681324144"><span class="hs-identifier hs-type">mk_inst_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>              </span><span class="hs-comment">-- Deals with instantiation of kind variables</span><span>
</span><span id="line-759"></span><span>              </span><span class="hs-comment">--   c.f. GHC.Tc.Utils.TcMType.newMetaTyVars</span><span>
</span><span id="line-760"></span><span>              </span><span id="local-6989586621681324144"><span class="annot"><span class="annottext">mk_inst_ty :: TCvSubst -&gt; (Var, TcType) -&gt; TcM (TCvSubst, TcType)
</span><a href="#local-6989586621681324144"><span class="hs-identifier hs-var hs-var">mk_inst_ty</span></a></span></span><span> </span><span id="local-6989586621681324142"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324142"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324141"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324141"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324140"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324140"><span class="hs-identifier hs-var">result_inst_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="#local-6989586621681324147"><span class="hs-identifier hs-var">is_fixed_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324141"><span class="hs-identifier hs-var">tv</span></a></span><span>   </span><span class="hs-comment">-- Same as result type</span><span>
</span><span id="line-762"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Var -&gt; TcType -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324142"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324141"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324140"><span class="hs-identifier hs-var">result_inst_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324140"><span class="hs-identifier hs-var">result_inst_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-comment">-- Fresh type, of correct kind</span><span>
</span><span id="line-764"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324138"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324138"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324137"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324137"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; Var -&gt; TcM (TCvSubst, Var)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324142"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324141"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-765"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324138"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681324137"><span class="hs-identifier hs-var">new_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324134"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324134"><span class="hs-identifier hs-var">result_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324133"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324133"><span class="hs-identifier hs-var">con1_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; TcM (TCvSubst, [Var])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324175"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span>
</span><span id="line-768"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324131"><span class="annot"><span class="annottext">result_inst_tys :: [TcType]
</span><a href="#local-6989586621681324131"><span class="hs-identifier hs-var hs-var">result_inst_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324133"><span class="hs-identifier hs-var">con1_tvs'</span></a></span><span>
</span><span id="line-769"></span><span>              </span><span id="local-6989586621681324130"><span class="annot"><span class="annottext">init_subst :: TCvSubst
</span><a href="#local-6989586621681324130"><span class="hs-identifier hs-var hs-var">init_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324134"><span class="hs-identifier hs-var">result_subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324127"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324127"><span class="hs-identifier hs-var">scrut_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324126"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324126"><span class="hs-identifier hs-var">scrut_inst_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) acc x y.
Monad m =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; [x] -&gt; m (acc, [y])
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; (Var, TcType) -&gt; TcM (TCvSubst, TcType)
</span><a href="#local-6989586621681324144"><span class="hs-identifier hs-var">mk_inst_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324130"><span class="hs-identifier hs-var">init_subst</span></a></span><span>
</span><span id="line-772"></span><span>                                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681324175"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324131"><span class="hs-identifier hs-var">result_inst_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324124"><span class="annot"><span class="annottext">rec_res_ty :: TcType
</span><a href="#local-6989586621681324124"><span class="hs-identifier hs-var hs-var">rec_res_ty</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">TcType.substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324134"><span class="hs-identifier hs-var">result_subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324164"><span class="hs-identifier hs-var">con1_res_ty</span></a></span><span>
</span><span id="line-775"></span><span>              </span><span id="local-6989586621681324122"><span class="annot"><span class="annottext">scrut_ty :: TcType
</span><a href="#local-6989586621681324122"><span class="hs-identifier hs-var hs-var">scrut_ty</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">TcType.substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324127"><span class="hs-identifier hs-var">scrut_subst</span></a></span><span>  </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324164"><span class="hs-identifier hs-var">con1_res_ty</span></a></span><span>
</span><span id="line-776"></span><span>              </span><span id="local-6989586621681324121"><span class="annot"><span class="annottext">con1_arg_tys' :: [TcType]
</span><a href="#local-6989586621681324121"><span class="hs-identifier hs-var hs-var">con1_arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">TcType.substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324134"><span class="hs-identifier hs-var">result_subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324170"><span class="hs-identifier hs-var">con1_arg_tys</span></a></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324120"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324120"><span class="hs-identifier hs-var">co_scrut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionR
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324239"><span class="hs-identifier hs-var">record_expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324229"><span class="hs-identifier hs-var">record_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324122"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span>
</span><span id="line-779"></span><span>                </span><span class="hs-comment">-- NB: normal unification is OK here (as opposed to subsumption),</span><span>
</span><span id="line-780"></span><span>                </span><span class="hs-comment">-- because for this to work out, both record_rho and scrut_ty have</span><span>
</span><span id="line-781"></span><span>                </span><span class="hs-comment">-- to be normal datatypes -- no contravariant stuff can go on</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>        </span><span class="hs-comment">-- STEP 5</span><span>
</span><span id="line-784"></span><span>        </span><span class="hs-comment">-- Typecheck the bindings</span><span>
</span><span id="line-785"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324118"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsRecField'
      (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621681324118"><span class="hs-identifier hs-var">rbinds'</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [TcType]
-&gt; [LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; TcM [LHsRecUpdField GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordUpd"><span class="hs-identifier hs-var">tcRecordUpd</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324121"><span class="hs-identifier hs-var">con1_arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsRecField'
      (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621681324227"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>        </span><span class="hs-comment">-- STEP 6: Deal with the stupid theta</span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324116"><span class="annot"><span class="annottext">theta' :: [TcType]
</span><a href="#local-6989586621681324116"><span class="hs-identifier hs-var hs-var">theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324127"><span class="hs-identifier hs-var">scrut_subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [TcType]
</span><a href="GHC.Core.ConLike.html#conLikeStupidTheta"><span class="hs-identifier hs-var">conLikeStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681324177"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-var">instStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#RecordUpdOrigin"><span class="hs-identifier hs-var">RecordUpdOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324116"><span class="hs-identifier hs-var">theta'</span></a></span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span>        </span><span class="hs-comment">-- Step 7: make a cast for the scrutinee, in the</span><span>
</span><span id="line-792"></span><span>        </span><span class="hs-comment">--         case that it's from a data family</span><span>
</span><span id="line-793"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681324111"><span class="hs-identifier hs-type">fam_co</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>   </span><span class="hs-comment">-- RepT t1 .. tn ~R scrut_ty</span><span>
</span><span id="line-794"></span><span>              </span><span id="local-6989586621681324111"><span class="annot"><span class="annottext">fam_co :: HsWrapper
</span><a href="#local-6989586621681324111"><span class="hs-identifier hs-var hs-var">fam_co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681324110"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324110"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681324193"><span class="hs-identifier hs-var">mtycon</span></a></span><span>
</span><span id="line-795"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681324109"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681324109"><span class="hs-identifier hs-var">co_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (CoAxiom Unbranched)
</span><a href="GHC.Core.TyCon.html#tyConFamilyCoercion_maybe"><span class="hs-identifier hs-var">tyConFamilyCoercion_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681324110"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-796"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; [TcType] -&gt; [TcCoercionR] -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#mkTcUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkTcUnbranchedAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681324109"><span class="hs-identifier hs-var">co_con</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324126"><span class="hs-identifier hs-var">scrut_inst_tys</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-798"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>        </span><span class="hs-comment">-- Step 8: Check that the req constraints are satisfied</span><span>
</span><span id="line-801"></span><span>        </span><span class="hs-comment">-- For normal data constructors req_theta is empty but we must do</span><span>
</span><span id="line-802"></span><span>        </span><span class="hs-comment">-- this check for pattern synonyms.</span><span>
</span><span id="line-803"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324105"><span class="annot"><span class="annottext">req_theta' :: [TcType]
</span><a href="#local-6989586621681324105"><span class="hs-identifier hs-var hs-var">req_theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681324127"><span class="hs-identifier hs-var">scrut_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324173"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-804"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324104"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324104"><span class="hs-identifier hs-var">req_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCallConstraints"><span class="hs-identifier hs-var">instCallConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#RecordUpdOrigin"><span class="hs-identifier hs-var">RecordUpdOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324105"><span class="hs-identifier hs-var">req_theta'</span></a></span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>        </span><span class="hs-comment">-- Phew!</span><span>
</span><span id="line-807"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681324102"><span class="annot"><span class="annottext">upd_tc :: RecordUpdTc
</span><a href="#local-6989586621681324102"><span class="hs-identifier hs-var hs-var">upd_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#RecordUpdTc"><span class="hs-identifier hs-type">RecordUpdTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_cons :: [ConLike]
</span><a href="GHC.Hs.Expr.html#rupd_cons"><span class="hs-identifier hs-var">rupd_cons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681324180"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span>
</span><span id="line-808"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_in_tys :: [TcType]
</span><a href="GHC.Hs.Expr.html#rupd_in_tys"><span class="hs-identifier hs-var">rupd_in_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324126"><span class="hs-identifier hs-var">scrut_inst_tys</span></a></span><span>
</span><span id="line-809"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_out_tys :: [TcType]
</span><a href="GHC.Hs.Expr.html#rupd_out_tys"><span class="hs-identifier hs-var">rupd_out_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681324131"><span class="hs-identifier hs-var">result_inst_tys</span></a></span><span>
</span><span id="line-810"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_wrap :: HsWrapper
</span><a href="GHC.Hs.Expr.html#rupd_wrap"><span class="hs-identifier hs-var">rupd_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324104"><span class="hs-identifier hs-var">req_wrap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-811"></span><span>              </span><span id="local-6989586621681324096"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681324096"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: LHsExpr GhcTc
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324111"><span class="hs-identifier hs-var">fam_co</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-812"></span><span>                                                </span><span class="annot"><span class="annottext">TcCoercionR -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrapCo"><span class="hs-identifier hs-var">mkLHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681324120"><span class="hs-identifier hs-var">co_scrut</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324230"><span class="hs-identifier hs-var">record_expr'</span></a></span><span>
</span><span id="line-813"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: Either [LHsRecUpdField GhcTc] [LHsRecUpdProj GhcTc]
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (HsRecField'
      (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621681324118"><span class="hs-identifier hs-var">rbinds'</span></a></span><span>
</span><span id="line-814"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_ext :: XRecordUpd GhcTc
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_ext"><span class="hs-identifier hs-var">rupd_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordUpdTc
</span><a href="#local-6989586621681324102"><span class="hs-identifier hs-var">upd_tc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324242"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324096"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324124"><span class="hs-identifier hs-var">rec_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324236"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-817"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: tcExpr: The impossible happened!&quot;</span></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Arithmetic sequences                    e.g. [a,b..]
        and their parallel-array counterparts   e.g. [: a,b.. :]

*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-type">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324091"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324091"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681324090"><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324090"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324089"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324089"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ArithSeqInfo GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324091"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324090"><span class="hs-identifier hs-var">seq</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324089"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Record dot syntax
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span class="hs-comment">-- These terms have been replaced by desugaring in the renamer. See</span><span>
</span><span id="line-842"></span><span class="hs-comment">-- Note [Overview of record dot syntax].</span><span>
</span><span id="line-843"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsGetField"><span class="hs-identifier hs-type">HsGetField</span></a></span><span> </span><span class="annot"><span class="annottext">XGetField GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Located (HsFieldLabel GhcRn)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: tcExpr: HsGetField: Not implemented&quot;</span></span><span>
</span><span id="line-844"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsProjection"><span class="hs-identifier hs-type">HsProjection</span></a></span><span> </span><span class="annot"><span class="annottext">XProjection GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Located (HsFieldLabel GhcRn))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: tcExpr: HsProjection: Not implemented&quot;</span></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Template Haskell
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="hs-comment">-- HsSpliced is an annotation produced by 'GHC.Rename.Splice.rnSpliceExpr'.</span><span>
</span><span id="line-855"></span><span class="hs-comment">-- Here we get rid of it and add the finalizers to the global environment.</span><span>
</span><span id="line-856"></span><span class="hs-comment">--</span><span>
</span><span id="line-857"></span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices] in GHC.Rename.Splice.</span><span>
</span><span id="line-858"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliceE"><span class="hs-identifier hs-type">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceE GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliced GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324083"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681324083"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplicedExpr"><span class="hs-identifier hs-type">HsSplicedExpr</span></a></span><span> </span><span id="local-6989586621681324081"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324081"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>       </span><span id="local-6989586621681324080"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324080"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-860"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681324083"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-861"></span><span>       </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324081"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324080"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-862"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliceE"><span class="hs-identifier hs-type">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceE GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324078"><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681324078"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span>          </span><span id="local-6989586621681324077"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324077"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier hs-var">tcSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681324078"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324077"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-863"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324076"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324076"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><span class="annottext">XBracket GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324074"><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681324074"><span class="hs-identifier hs-var">brack</span></a></span></span><span class="hs-special">)</span><span>         </span><span id="local-6989586621681324073"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324073"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsBracket GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-var">tcTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324076"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681324074"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324073"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681324072"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681324072"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRnBracketOut"><span class="hs-identifier hs-type">HsRnBracketOut</span></a></span><span> </span><span class="annot"><span class="annottext">XRnBracketOut GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681324070"><span class="annot"><span class="annottext">HsBracket (HsBracketRn GhcRn)
</span><a href="#local-6989586621681324070"><span class="hs-identifier hs-var">brack</span></a></span></span><span> </span><span id="local-6989586621681324069"><span class="annot"><span class="annottext">[PendingRnSplice' GhcRn]
</span><a href="#local-6989586621681324069"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324068"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324068"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsBracket GhcRn
-&gt; [PendingRnSplice]
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier hs-var">tcUntypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681324072"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket (HsBracketRn GhcRn)
</span><a href="#local-6989586621681324070"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice' GhcRn]
</span><a href="#local-6989586621681324069"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324068"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Catch-all
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsConLikeOut"><span class="hs-identifier hs-type">HsConLikeOut</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span id="local-6989586621681324066"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324066"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:HsConLikeOut&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324066"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsOverLabel"><span class="hs-identifier hs-type">HsOverLabel</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span id="local-6989586621681324063"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324063"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:HsOverLabel&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324063"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-876"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionL"><span class="hs-identifier hs-type">SectionL</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span id="local-6989586621681324061"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324061"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:SectionL&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324061"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-877"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SectionR"><span class="hs-identifier hs-type">SectionR</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span id="local-6989586621681324059"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324059"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:SectionR&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324059"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTcBracketOut"><span class="hs-identifier hs-type">HsTcBracketOut</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324057"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324057"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:HsTcBracketOut&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324057"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTick"><span class="hs-identifier hs-type">HsTick</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span id="local-6989586621681324055"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324055"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:HsTick&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324055"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsBinTick"><span class="hs-identifier hs-type">HsBinTick</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span id="local-6989586621681324053"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324053"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:HsBinTick&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324053"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Arithmetic sequences [a..b] etc
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-type">tcArithSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArithSeqInfo"><span class="hs-identifier hs-type">ArithSeqInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-892"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span id="tcArithSeq"><span class="annot"><span class="annottext">tcArithSeq :: Maybe (SyntaxExpr GhcRn)
-&gt; ArithSeqInfo GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var hs-var">tcArithSeq</span></a></span></span><span> </span><span id="local-6989586621681324052"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324052"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681324051"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324051"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#From"><span class="hs-identifier hs-type">From</span></a></span><span> </span><span id="local-6989586621681324049"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324049"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324048"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324048"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324047"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324047"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324046"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324046"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324045"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324045"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324044"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324044"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324052"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324048"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-896"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324042"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324042"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324046"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324049"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324045"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-897"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324041"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324041"><span class="hs-identifier hs-var">enum_from</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324051"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromName"><span class="hs-identifier hs-var">enumFromName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324045"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-899"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324047"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-900"></span><span>         </span><span class="annot"><span class="annottext">forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324041"><span class="hs-identifier hs-var">enum_from</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324044"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id. LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#From"><span class="hs-identifier hs-var">From</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324042"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621681324038"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324038"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681324037"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324037"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThen"><span class="hs-identifier hs-type">FromThen</span></a></span><span> </span><span id="local-6989586621681324035"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324035"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621681324034"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324034"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324033"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324033"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324032"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324032"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324031"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324031"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324030"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324030"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324029"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324029"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324038"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324033"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-904"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324028"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324028"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324031"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324035"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324030"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-905"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324027"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324027"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324031"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324034"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324030"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-906"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324026"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324026"><span class="hs-identifier hs-var">enum_from_then</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324037"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromThenName"><span class="hs-identifier hs-var">enumFromThenName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324030"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324032"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-909"></span><span>         </span><span class="annot"><span class="annottext">forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324026"><span class="hs-identifier hs-var">enum_from_then</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324029"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id. LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#FromThen"><span class="hs-identifier hs-var">FromThen</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324028"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324027"><span class="hs-identifier hs-var">expr2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621681324024"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324024"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681324023"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324023"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromTo"><span class="hs-identifier hs-type">FromTo</span></a></span><span> </span><span id="local-6989586621681324021"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324021"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621681324020"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324020"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324019"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324019"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324018"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324018"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324017"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324017"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324016"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324016"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324015"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324015"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324024"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324019"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-913"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324014"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324014"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324017"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324021"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324016"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-914"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324013"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324013"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324017"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324020"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324016"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-915"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681324012"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324012"><span class="hs-identifier hs-var">enum_from_to</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324023"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromToName"><span class="hs-identifier hs-var">enumFromToName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324016"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-917"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324018"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-918"></span><span>         </span><span class="annot"><span class="annottext">forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681324012"><span class="hs-identifier hs-var">enum_from_to</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324015"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id. LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#FromTo"><span class="hs-identifier hs-var">FromTo</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324014"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681324013"><span class="hs-identifier hs-var">expr2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621681324010"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324010"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681324009"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324009"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FromThenTo"><span class="hs-identifier hs-type">FromThenTo</span></a></span><span> </span><span id="local-6989586621681324007"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324007"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621681324006"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324006"><span class="hs-identifier hs-var">expr2</span></a></span></span><span> </span><span id="local-6989586621681324005"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324005"><span class="hs-identifier hs-var">expr3</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681324004"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324004"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681324003"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324003"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324002"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324002"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324001"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324001"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681324000"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324000"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681324010"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681324004"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323999"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323999"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324002"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324007"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324001"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-923"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323998"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323998"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324002"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324006"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324001"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323997"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323997"><span class="hs-identifier hs-var">expr3'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324002"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681324005"><span class="hs-identifier hs-var">expr3</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324001"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323996"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681323996"><span class="hs-identifier hs-var">eft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681324009"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromThenToName"><span class="hs-identifier hs-var">enumFromThenToName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681324001"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-927"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681324003"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-928"></span><span>          </span><span class="annot"><span class="annottext">forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681323996"><span class="hs-identifier hs-var">eft</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681324000"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id.
LHsExpr id -&gt; LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="Language.Haskell.Syntax.Expr.html#FromThenTo"><span class="hs-identifier hs-var">FromThenTo</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323999"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323998"><span class="hs-identifier hs-var">expr2'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323997"><span class="hs-identifier hs-var">expr3'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-931"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-type">arithSeqEltType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-932"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span id="arithSeqEltType"><span class="annot"><span class="annottext">arithSeqEltType :: Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var hs-var">arithSeqEltType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621681323993"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323993"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323992"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323992"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323993"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-935"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323991"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681323991"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323990"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323990"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323992"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-936"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681323991"><span class="hs-identifier hs-var">coi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#One"><span class="hs-identifier hs-var">One</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323990"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-937"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323987"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681323987"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681323986"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323986"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681323985"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323985"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323984"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323984"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323983"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681323983"><span class="hs-identifier hs-var">fl'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ListOrigin"><span class="hs-identifier hs-var">ListOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681323987"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323986"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-940"></span><span>              </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681323980"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323980"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681323979"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323979"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323979"><span class="hs-identifier hs-var">elt_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323980"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323985"><span class="hs-identifier hs-var">elt_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323984"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681323983"><span class="hs-identifier hs-var">fl'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-944"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-type">tcTupArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTupArg"><span class="hs-identifier hs-type">HsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTupArg"><span class="hs-identifier hs-type">HsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-945"></span><span id="tcTupArgs"><span class="annot"><span class="annottext">tcTupArgs :: [HsTupArg GhcRn] -&gt; [TcType] -&gt; TcM [HsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var hs-var">tcTupArgs</span></a></span></span><span> </span><span id="local-6989586621681323978"><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681323978"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681323977"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323977"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">equalLength</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span>       </span><span class="annot"><span class="annottext">Int -&gt; TcRn ()
</span><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681323978"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>       </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(HsTupArg GhcRn, TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcTc)
</span><a href="#local-6989586621681323974"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsTupArg GhcRn]
</span><a href="#local-6989586621681323978"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323977"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-950"></span><span>    </span><span id="local-6989586621681323974"><span class="annot"><span class="annottext">go :: (HsTupArg GhcRn, TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsTupArg GhcTc)
</span><a href="#local-6989586621681323974"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span>     </span><span id="local-6989586621681323969"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323969"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323968"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323968"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-951"></span><span>                                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id. XMissing id -&gt; HsTupArg id
</span><a href="Language.Haskell.Syntax.Expr.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323968"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323969"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-952"></span><span>    </span><span class="annot"><a href="#local-6989586621681323974"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Present"><span class="hs-identifier hs-type">Present</span></a></span><span> </span><span id="local-6989586621681323966"><span class="annot"><span class="annottext">XPresent GhcRn
</span><a href="#local-6989586621681323966"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681323965"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681323965"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323964"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323964"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323963"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323963"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681323965"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323964"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-953"></span><span>                                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id. XPresent id -&gt; LHsExpr id -&gt; HsTupArg id
</span><a href="Language.Haskell.Syntax.Expr.html#Present"><span class="hs-identifier hs-var">Present</span></a></span><span> </span><span class="annot"><span class="annottext">XPresent GhcRn
</span><a href="#local-6989586621681323966"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323963"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-956"></span><span class="hs-comment">-- See TcType.SyntaxOpType also for commentary</span><span>
</span><span id="line-957"></span><span id="local-6989586621681325278"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-958"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span>
</span><span id="line-959"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- ^ shape of syntax operator arguments</span><span>
</span><span id="line-960"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>               </span><span class="hs-comment">-- ^ overall result type</span><span>
</span><span id="line-961"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681325278"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Type check any arguments,</span><span>
</span><span id="line-962"></span><span>                                                 </span><span class="hs-comment">-- takes a type per hole and a</span><span>
</span><span id="line-963"></span><span>                                                 </span><span class="hs-comment">-- multiplicity per arrow in</span><span>
</span><span id="line-964"></span><span>                                                 </span><span class="hs-comment">-- the shape.</span><span>
</span><span id="line-965"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681325278"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-966"></span><span class="hs-comment">-- ^ Typecheck a syntax operator</span><span>
</span><span id="line-967"></span><span class="hs-comment">-- The operator is a variable or a lambda at this stage (i.e. renamer</span><span>
</span><span id="line-968"></span><span class="hs-comment">-- output)t</span><span>
</span><span id="line-969"></span><span id="tcSyntaxOp"><span class="annot"><span class="annottext">tcSyntaxOp :: forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var hs-var">tcSyntaxOp</span></a></span></span><span> </span><span id="local-6989586621681323962"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323962"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621681323961"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621681323961"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681323960"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323960"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621681323959"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323959"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-970"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323962"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621681323961"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323960"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323959"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>
</span><span id="line-972"></span><span class="hs-comment">-- | Slightly more general version of 'tcSyntaxOp' that allows the caller</span><span>
</span><span id="line-973"></span><span class="hs-comment">-- to specify the shape of the result of the syntax operator</span><span>
</span><span id="line-974"></span><span id="local-6989586621681325109"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-type">tcSyntaxOpGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-975"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span>
</span><span id="line-976"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-977"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>
</span><span id="line-978"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681325109"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681325109"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-980"></span><span id="tcSyntaxOpGen"><span class="annot"><span class="annottext">tcSyntaxOpGen :: forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var hs-var">tcSyntaxOpGen</span></a></span></span><span> </span><span id="local-6989586621681323939"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323939"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span> </span><span id="local-6989586621681323937"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681323937"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681323936"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323936"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621681323935"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323935"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621681323934"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323934"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-981"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323933"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681323933"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323932"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323932"><span class="hs-identifier hs-var">sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcRn, AppCtxt)
-&gt; [HsExprArg 'TcpRn] -&gt; Maybe TcType -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Head.html#tcInferAppHead"><span class="hs-identifier hs-var">tcInferAppHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681323937"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Int -&gt; SrcSpan -&gt; AppCtxt
</span><a href="GHC.Tc.Gen.Head.html#VACall"><span class="hs-identifier hs-var">VACall</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681323937"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-982"></span><span>             </span><span class="hs-comment">-- Ugh!! But all this code is scheduled for demolition anyway</span><span>
</span><span id="line-983"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681323937"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681323933"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323932"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323928"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323928"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323927"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323927"><span class="hs-identifier hs-var">expr_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323926"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681323926"><span class="hs-identifier hs-var">arg_wraps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323925"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323925"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-985"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var">tcSynArgA</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323939"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323932"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323936"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323935"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-986"></span><span>              </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323934"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-987"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681323937"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681323933"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323932"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-988"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323928"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">syn_expr :: HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#syn_expr"><span class="hs-identifier hs-var">syn_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323927"><span class="hs-identifier hs-var">expr_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681323933"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-989"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_arg_wraps :: [HsWrapper]
</span><a href="GHC.Hs.Expr.html#syn_arg_wraps"><span class="hs-identifier hs-var">syn_arg_wraps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681323926"><span class="hs-identifier hs-var">arg_wraps</span></a></span><span>
</span><span id="line-990"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_res_wrap :: HsWrapper
</span><a href="GHC.Hs.Expr.html#syn_res_wrap"><span class="hs-identifier hs-var">syn_res_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323925"><span class="hs-identifier hs-var">res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-991"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#NoSyntaxExprRn"><span class="hs-identifier hs-var">NoSyntaxExprRn</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span class="hs-comment">{-
Note [tcSynArg]
~~~~~~~~~~~~~~~
Because of the rich structure of SyntaxOpType, we must do the
contra-/covariant thing when working down arrows, to get the
instantiation vs. skolemisation decisions correct (and, more
obviously, the orientation of the HsWrappers). We thus have
two tcSynArgs.
-}</span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span class="hs-comment">-- works on &quot;expected&quot; types, skolemising where necessary</span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- See Note [tcSynArg]</span><span>
</span><span id="line-1005"></span><span id="local-6989586621681325102"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-type">tcSynArgE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-1006"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-1007"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>                </span><span class="hs-comment">-- ^ shape it is expected to have</span><span>
</span><span id="line-1008"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681325102"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ check the arguments</span><span>
</span><span id="line-1009"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681325102"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1010"></span><span>           </span><span class="hs-comment">-- ^ returns a wrapper :: (type of right shape) &quot;-&gt;&quot; (type passed in)</span><span>
</span><span id="line-1011"></span><span id="tcSynArgE"><span class="annot"><span class="annottext">tcSynArgE :: forall a.
CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var hs-var">tcSynArgE</span></a></span></span><span> </span><span id="local-6989586621681323891"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323891"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621681323890"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323890"><span class="hs-identifier hs-var">sigma_ty</span></a></span></span><span> </span><span id="local-6989586621681323889"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323889"><span class="hs-identifier hs-var">syn_ty</span></a></span></span><span> </span><span id="local-6989586621681323888"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323888"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323887"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323887"><span class="hs-identifier hs-var">skol_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323886"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323886"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323885"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323885"><span class="hs-identifier hs-var">ty_wrapper</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall result.
UserTypeCtxt
-&gt; TcType -&gt; (TcType -&gt; TcM result) -&gt; TcM (HsWrapper, result)
</span><a href="GHC.Tc.Utils.Unify.html#tcTopSkolemise"><span class="hs-identifier hs-var">tcTopSkolemise</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323890"><span class="hs-identifier hs-var">sigma_ty</span></a></span><span>
</span><span id="line-1014"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323883"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323883"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SyntaxOpType -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681323882"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323883"><span class="hs-identifier hs-var">rho_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323889"><span class="hs-identifier hs-var">syn_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323886"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323887"><span class="hs-identifier hs-var">skol_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323885"><span class="hs-identifier hs-var">ty_wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1016"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1017"></span><span>    </span><span id="local-6989586621681323882"><span class="annot"><span class="annottext">go :: TcType -&gt; SyntaxOpType -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681323882"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681323880"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323880"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span>
</span><span id="line-1018"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323879"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323879"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323888"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323880"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1019"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323879"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span>    </span><span class="annot"><a href="#local-6989586621681323882"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681323878"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323878"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span>   </span><span class="hs-comment">-- same as SynAny, because we skolemise eagerly</span><span>
</span><span id="line-1022"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323876"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323876"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323888"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323878"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1023"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323876"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span>    </span><span class="annot"><a href="#local-6989586621681323882"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681323875"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323875"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span>
</span><span id="line-1026"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323874"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681323874"><span class="hs-identifier hs-var">list_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323873"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323873"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323875"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-1027"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323872"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323872"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323888"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323873"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1028"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323872"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681323874"><span class="hs-identifier hs-var">list_co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>    </span><span class="annot"><a href="#local-6989586621681323882"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681323871"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323871"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span id="local-6989586621681323869"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323869"><span class="hs-identifier hs-var">arg_shape</span></a></span></span><span> </span><span id="local-6989586621681323868"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323868"><span class="hs-identifier hs-var">res_shape</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621681323867"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323867"><span class="hs-identifier hs-var">match_wrapper</span></a></span></span><span>                         </span><span class="hs-comment">-- :: (arg_ty -&gt; res_ty) &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-1032"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323866"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323866"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323865"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323865"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323864"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323864"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323863"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323863"><span class="hs-identifier hs-var">op_mult</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1033"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323862"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323862"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span> </span><span class="hs-special">)</span><span>                     </span><span class="hs-comment">-- :: res_ty_out &quot;-&gt;&quot; res_ty</span><span>
</span><span id="line-1034"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323861"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323861"><span class="hs-identifier hs-var">arg_wrapper1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323860"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323860"><span class="hs-identifier hs-var">arg_wrapper2</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- :: arg_ty &quot;-&gt;&quot; arg_ty_out</span><span>
</span><span id="line-1035"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
SDoc
-&gt; UserTypeCtxt
-&gt; Int
-&gt; ExpRhoType
-&gt; ([Scaled ExpRhoType] -&gt; ExpRhoType -&gt; TcM a)
-&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedFunTys"><span class="hs-identifier hs-var">matchExpectedFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323858"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323871"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1036"></span><span>                  </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681323857"><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621681323857"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621681323856"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323856"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1037"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323855"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323855"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621681323857"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1038"></span><span>                     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323854"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323854"><span class="hs-identifier hs-var">res_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323856"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span>                         </span><span class="hs-comment">-- another nested arrow is too much for now,</span><span>
</span><span id="line-1041"></span><span>                         </span><span class="hs-comment">-- but I bet we'll never need this</span><span>
</span><span id="line-1042"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">arg_shape</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1043"></span><span>                                   </span><span class="hs-identifier">SynFun</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">;</span><span>
</span><span id="line-1044"></span><span>                                   </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-1045"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Too many nested arrows in SyntaxOpType&quot;</span><span> </span><span class="hs-operator">$$</span><span>
</span><span id="line-1046"></span><span>                                 </span><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-identifier">orig</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681323851"><span class="annot"><span class="annottext">arg_mult :: TcType
</span><a href="#local-6989586621681323851"><span class="hs-identifier hs-var hs-var">arg_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621681323857"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1049"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var">tcSynArgA</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323891"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323855"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323869"><span class="hs-identifier hs-var">arg_shape</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1050"></span><span>                       </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323849"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323849"><span class="hs-identifier hs-var">arg_results</span></a></span></span><span> </span><span id="local-6989586621681323848"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323848"><span class="hs-identifier hs-var">arg_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1051"></span><span>                       </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var">tcSynArgE</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323891"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323854"><span class="hs-identifier hs-var">res_tc_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323868"><span class="hs-identifier hs-var">res_shape</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1052"></span><span>                       </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323847"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323847"><span class="hs-identifier hs-var">res_results</span></a></span></span><span> </span><span id="local-6989586621681323846"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323846"><span class="hs-identifier hs-var">res_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1053"></span><span>                       </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323845"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323845"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323888"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323849"><span class="hs-identifier hs-var">arg_results</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323847"><span class="hs-identifier hs-var">res_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323851"><span class="hs-identifier hs-var">arg_mult</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323848"><span class="hs-identifier hs-var">arg_res_mults</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323846"><span class="hs-identifier hs-var">res_res_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1054"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323845"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323855"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323854"><span class="hs-identifier hs-var">res_tc_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323851"><span class="hs-identifier hs-var">arg_mult</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323866"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-1057"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323867"><span class="hs-identifier hs-var">match_wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span>
</span><span id="line-1058"></span><span>                      </span><span class="annot"><span class="annottext">HsWrapper
-&gt; HsWrapper -&gt; Scaled TcType -&gt; TcType -&gt; SDoc -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpFun"><span class="hs-identifier hs-var">mkWpFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323860"><span class="hs-identifier hs-var">arg_wrapper2</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323861"><span class="hs-identifier hs-var">arg_wrapper1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323862"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span>
</span><span id="line-1059"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323863"><span class="hs-identifier hs-var">op_mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323865"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323864"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323843"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1060"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1061"></span><span>        </span><span id="local-6989586621681323858"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681323858"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This rebindable syntax expects a function with&quot;</span></span><span>
</span><span id="line-1062"></span><span>        </span><span id="local-6989586621681323843"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621681323843"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking a rebindable syntax operator arising from&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323891"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span>    </span><span class="annot"><a href="#local-6989586621681323882"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681323842"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323842"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span id="local-6989586621681323841"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323841"><span class="hs-identifier hs-var">the_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1065"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323840"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323840"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; ExpRhoType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323891"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323841"><span class="hs-identifier hs-var">the_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323842"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-1066"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323838"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323838"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323888"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1067"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323838"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323840"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span class="hs-comment">-- works on &quot;actual&quot; types, instantiating where necessary</span><span>
</span><span id="line-1070"></span><span class="hs-comment">-- See Note [tcSynArg]</span><span>
</span><span id="line-1071"></span><span id="local-6989586621681325103"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-type">tcSynArgA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-1072"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-1073"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- ^ argument shapes</span><span>
</span><span id="line-1074"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>                </span><span class="hs-comment">-- ^ result shape</span><span>
</span><span id="line-1075"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681325103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ check the arguments</span><span>
</span><span id="line-1076"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681325103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1077"></span><span>            </span><span class="hs-comment">-- ^ returns a wrapper to be applied to the original function,</span><span>
</span><span id="line-1078"></span><span>            </span><span class="hs-comment">-- wrappers to be applied to arguments</span><span>
</span><span id="line-1079"></span><span>            </span><span class="hs-comment">-- and a wrapper to be applied to the overall expression</span><span>
</span><span id="line-1080"></span><span id="tcSynArgA"><span class="annot"><span class="annottext">tcSynArgA :: forall a.
CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var hs-var">tcSynArgA</span></a></span></span><span> </span><span id="local-6989586621681323833"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323833"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621681323832"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323832"><span class="hs-identifier hs-var">sigma_ty</span></a></span></span><span> </span><span id="local-6989586621681323831"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323831"><span class="hs-identifier hs-var">arg_shapes</span></a></span></span><span> </span><span id="local-6989586621681323830"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323830"><span class="hs-identifier hs-var">res_shape</span></a></span></span><span> </span><span id="local-6989586621681323829"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323829"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1081"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323828"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323828"><span class="hs-identifier hs-var">match_wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323827"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323827"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323826"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323826"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; CtOrigin
-&gt; Maybe SDoc
-&gt; Int
-&gt; TcType
-&gt; TcM (HsWrapper, [Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTysRho"><span class="hs-identifier hs-var">matchActualFunTysRho</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323824"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323833"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1083"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323831"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323832"><span class="hs-identifier hs-var">sigma_ty</span></a></span><span>
</span><span id="line-1084"></span><span>              </span><span class="hs-comment">-- match_wrapper :: sigma_ty &quot;-&gt;&quot; (arg_tys -&gt; res_ty)</span><span>
</span><span id="line-1085"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681323823"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323823"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323822"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323822"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323821"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681323821"><span class="hs-identifier hs-var">arg_wrappers</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621681323820"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323827"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323831"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323819"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323819"><span class="hs-identifier hs-var">arg_results</span></a></span></span><span> </span><span id="local-6989586621681323818"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323818"><span class="hs-identifier hs-var">arg_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1087"></span><span>              </span><span class="annot"><span class="annottext">forall a.
TcType -&gt; SyntaxOpType -&gt; ([TcType] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681323817"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span>    </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323826"><span class="hs-identifier hs-var">res_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323830"><span class="hs-identifier hs-var">res_shape</span></a></span><span>  </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323816"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323816"><span class="hs-identifier hs-var">res_results</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1088"></span><span>              </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323829"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323819"><span class="hs-identifier hs-var">arg_results</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323816"><span class="hs-identifier hs-var">res_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323827"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323818"><span class="hs-identifier hs-var">arg_res_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323823"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323828"><span class="hs-identifier hs-var">match_wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681323821"><span class="hs-identifier hs-var">arg_wrappers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323822"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1090"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1091"></span><span>    </span><span id="local-6989586621681323824"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681323824"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This rebindable syntax expects a function with&quot;</span></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span>    </span><span id="local-6989586621681325093"><span class="annot"><a href="#local-6989586621681323820"><span class="hs-identifier hs-type">tc_syn_args_e</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1094"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681325093"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681325093"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-1096"></span><span>                    </span><span class="hs-comment">-- the wrappers are for arguments</span><span>
</span><span id="line-1097"></span><span>    </span><span id="local-6989586621681323820"><span class="annot"><span class="annottext">tc_syn_args_e :: forall a.
[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621681323820"><span class="hs-identifier hs-var hs-var">tc_syn_args_e</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323812"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323812"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681323811"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323811"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323810"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323810"><span class="hs-identifier hs-var">arg_shape</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681323809"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323809"><span class="hs-identifier hs-var">arg_shapes</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681323808"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323808"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1098"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681323807"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323807"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323806"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681323806"><span class="hs-identifier hs-var">arg_wraps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323805"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323805"><span class="hs-identifier hs-var">arg_wrap</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var">tcSynArgE</span></a></span><span>     </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323833"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323812"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681323810"><span class="hs-identifier hs-var">arg_shape</span></a></span><span>  </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323804"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323804"><span class="hs-identifier hs-var">arg1_results</span></a></span></span><span> </span><span id="local-6989586621681323803"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323803"><span class="hs-identifier hs-var">arg1_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1100"></span><span>                  </span><span class="annot"><span class="annottext">forall a.
[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621681323820"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span>      </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323811"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681323809"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323802"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323802"><span class="hs-identifier hs-var">args_results</span></a></span></span><span> </span><span id="local-6989586621681323801"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323801"><span class="hs-identifier hs-var">args_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1101"></span><span>                  </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323808"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323804"><span class="hs-identifier hs-var">arg1_results</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323802"><span class="hs-identifier hs-var">args_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323803"><span class="hs-identifier hs-var">arg1_mults</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323801"><span class="hs-identifier hs-var">args_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323807"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323805"><span class="hs-identifier hs-var">arg_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681323806"><span class="hs-identifier hs-var">arg_wraps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1103"></span><span>    </span><span class="annot"><a href="#local-6989586621681323820"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681323800"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323800"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681323800"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span>    </span><span id="local-6989586621681325092"><span class="annot"><a href="#local-6989586621681323817"><span class="hs-identifier hs-type">tc_syn_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>
</span><span id="line-1106"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681325092"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681325092"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1108"></span><span>                  </span><span class="hs-comment">-- the wrapper applies to the overall result</span><span>
</span><span id="line-1109"></span><span>    </span><span id="local-6989586621681323817"><span class="annot"><span class="annottext">tc_syn_arg :: forall a.
TcType -&gt; SyntaxOpType -&gt; ([TcType] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681323817"><span class="hs-identifier hs-var hs-var">tc_syn_arg</span></a></span></span><span> </span><span id="local-6989586621681323783"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323783"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span> </span><span id="local-6989586621681323782"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323782"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1110"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323781"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323781"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323782"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323783"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1111"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323781"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1112"></span><span>    </span><span class="annot"><a href="#local-6989586621681323817"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621681323780"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323780"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span> </span><span id="local-6989586621681323779"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323779"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1113"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323778"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323778"><span class="hs-identifier hs-var">inst_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323777"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323777"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323833"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323780"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1114"></span><span>               </span><span class="hs-comment">-- inst_wrap :: res_ty &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-1115"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323776"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323776"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323779"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323777"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1116"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323776"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323778"><span class="hs-identifier hs-var">inst_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1117"></span><span>    </span><span class="annot"><a href="#local-6989586621681323817"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621681323775"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323775"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span> </span><span id="local-6989586621681323774"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323774"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1118"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323773"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323773"><span class="hs-identifier hs-var">inst_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323772"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323772"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323833"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323775"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1119"></span><span>               </span><span class="hs-comment">-- inst_wrap :: res_ty &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-1120"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323771"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681323771"><span class="hs-identifier hs-var">list_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323770"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323770"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323772"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-1121"></span><span>               </span><span class="hs-comment">-- list_co :: [elt_ty] ~N rho_ty</span><span>
</span><span id="line-1122"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323769"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323769"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323774"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323770"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1123"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323769"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681323771"><span class="hs-identifier hs-var">list_co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323773"><span class="hs-identifier hs-var">inst_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1124"></span><span>    </span><span class="annot"><a href="#local-6989586621681323817"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1125"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSynArgA hits a SynFun&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323833"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span>    </span><span class="annot"><a href="#local-6989586621681323817"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621681323767"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323767"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span id="local-6989586621681323766"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323766"><span class="hs-identifier hs-var">the_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681323765"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323765"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1127"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323764"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323764"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; TcType -&gt; ExpRhoType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubType"><span class="hs-identifier hs-var">tcSubType</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681323833"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323767"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323766"><span class="hs-identifier hs-var">the_ty</span></a></span><span>
</span><span id="line-1128"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323762"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323762"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681323765"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1129"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323762"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681323764"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1130"></span><span>
</span><span id="line-1131"></span><span class="hs-comment">{-
Note [Push result type in]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Unify with expected result before type-checking the args so that the
info from res_ty percolates to args.  This is when we might detect a
too-few args situation.  (One can think of cases when the opposite
order would give a better error message.)
experimenting with putting this first.

Here's an example where it actually makes a real difference

   class C t a b | t a -&gt; b
   instance C Char a Bool

   data P t a = forall b. (C t a b) =&gt; MkP b
   data Q t   = MkQ (forall a. P t a)

   f1, f2 :: Q Char;
   f1 = MkQ (MkP True)
   f2 = MkQ (MkP True :: forall a. P Char a)

With the change, f1 will type-check, because the 'Char' info from
the signature is propagated into MkQ's argument. With the check
in the other order, the extra signature in f2 is reqd.
-}</span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Record bindings
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1162"></span><span>
</span><span id="line-1163"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier hs-type">getFixedTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a></span><span>
</span><span id="line-1164"></span><span class="hs-comment">-- These tyvars must not change across the updates</span><span>
</span><span id="line-1165"></span><span id="getFixedTyVars"><span class="annot"><span class="annottext">getFixedTyVars :: [FieldLabelString] -&gt; [Var] -&gt; [ConLike] -&gt; VarSet
</span><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier hs-var hs-var">getFixedTyVars</span></a></span></span><span> </span><span id="local-6989586621681323760"><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681323760"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span></span><span> </span><span id="local-6989586621681323759"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681323759"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span> </span><span id="local-6989586621681323758"><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681323758"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-1166"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323757"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681323756"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323756"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681323758"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1167"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323755"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681323755"><span class="hs-identifier hs-var">u_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323754"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681323754"><span class="hs-identifier hs-var">eqspec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323753"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323753"><span class="hs-identifier hs-var">prov_theta</span></a></span></span><span>
</span><span id="line-1168"></span><span>                             </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323752"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323752"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323751"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323751"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; ([Var], [Var], [EqSpec], [TcType], [TcType], [Scaled TcType],
    TcType)
</span><a href="GHC.Core.ConLike.html#conLikeFullSig"><span class="hs-identifier hs-var">conLikeFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323756"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1170"></span><span>                            </span><span id="local-6989586621681323750"><span class="annot"><span class="annottext">theta :: [TcType]
</span><a href="#local-6989586621681323750"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EqSpec] -&gt; [TcType]
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681323754"><span class="hs-identifier hs-var">eqspec</span></a></span><span>
</span><span id="line-1171"></span><span>                                     </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323753"><span class="hs-identifier hs-var">prov_theta</span></a></span><span>
</span><span id="line-1172"></span><span>                                     </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323752"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-1173"></span><span>                            </span><span id="local-6989586621681323748"><span class="annot"><span class="annottext">flds :: [FieldLabel]
</span><a href="#local-6989586621681323748"><span class="hs-identifier hs-var hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323756"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1174"></span><span>                            </span><span id="local-6989586621681323747"><span class="annot"><span class="annottext">fixed_tvs :: VarSet
</span><a href="#local-6989586621681323747"><span class="hs-identifier hs-var hs-var">fixed_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; VarSet
</span><a href="GHC.Tc.Utils.TcType.html#exactTyCoVarsOfTypes"><span class="hs-identifier hs-var">exactTyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323745"><span class="hs-identifier hs-var">fixed_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>                                    </span><span class="hs-comment">-- fixed_tys: See Note [Type of a record update]</span><span>
</span><span id="line-1176"></span><span>                                        </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323750"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-1177"></span><span>                                    </span><span class="hs-comment">-- Universally-quantified tyvars that</span><span>
</span><span id="line-1178"></span><span>                                    </span><span class="hs-comment">-- appear in any of the *implicit*</span><span>
</span><span id="line-1179"></span><span>                                    </span><span class="hs-comment">-- arguments to the constructor are fixed</span><span>
</span><span id="line-1180"></span><span>                                    </span><span class="hs-comment">-- See Note [Implicit type sharing]</span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span>                            </span><span id="local-6989586621681323745"><span class="annot"><span class="annottext">fixed_tys :: [Scaled TcType]
</span><a href="#local-6989586621681323745"><span class="hs-identifier hs-var hs-var">fixed_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681323742"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323741"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323741"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323742"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681323742"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681323748"><span class="hs-identifier hs-var">flds</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323751"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1183"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323741"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681323760"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1184"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323757"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323757"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323740"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323740"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681323759"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681323755"><span class="hs-identifier hs-var">u_tvs</span></a></span><span>
</span><span id="line-1185"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323740"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681323747"><span class="hs-identifier hs-var">fixed_tvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span class="hs-comment">-- Disambiguate the fields in a record update.</span><span>
</span><span id="line-1188"></span><span class="hs-comment">-- See Note [Disambiguating record fields] in GHC.Tc.Gen.Head</span><span>
</span><span id="line-1189"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-type">disambiguateRecordBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-1190"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-1191"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1192"></span><span id="disambiguateRecordBinds"><span class="annot"><span class="annottext">disambiguateRecordBinds :: LHsExpr GhcRn
-&gt; TcType
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM
     [LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-var hs-var">disambiguateRecordBinds</span></a></span></span><span> </span><span id="local-6989586621681323739"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681323739"><span class="hs-identifier hs-var">record_expr</span></a></span></span><span> </span><span id="local-6989586621681323738"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323738"><span class="hs-identifier hs-var">record_rho</span></a></span></span><span> </span><span id="local-6989586621681323737"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323737"><span class="hs-identifier hs-var">rbnds</span></a></span></span><span> </span><span id="local-6989586621681323736"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323736"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1193"></span><span>    </span><span class="hs-comment">-- Are all the fields unambiguous?</span><span>
</span><span id="line-1194"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn -&gt; Maybe (LHsRecUpdField GhcRn, Name)
</span><a href="#local-6989586621681323735"><span class="hs-identifier hs-var">isUnambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323737"><span class="hs-identifier hs-var">rbnds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1195"></span><span>                     </span><span class="hs-comment">-- If so, just skip to looking up the Ids</span><span>
</span><span id="line-1196"></span><span>                     </span><span class="hs-comment">-- Always the case if DuplicateRecordFields is off</span><span>
</span><span id="line-1197"></span><span>      </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323734"><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsRecField'
       (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  Name)]
</span><a href="#local-6989586621681323734"><span class="hs-identifier hs-var">rbnds'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsRecField' GhcRn (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681323733"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsRecField'
       (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  Name)]
</span><a href="#local-6989586621681323734"><span class="hs-identifier hs-var">rbnds'</span></a></span><span>
</span><span id="line-1198"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  [(GenLocated
      SrcSpanAnnA
      (HsRecField'
         (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
    Name)]
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- If not, try to identify a single parent</span><span>
</span><span id="line-1199"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323732"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681323732"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1200"></span><span>             </span><span class="hs-comment">-- Look up the possible parents for each field</span><span>
</span><span id="line-1201"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323731"><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsRecField'
       (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681323731"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681323730"><span class="hs-identifier hs-var">getUpdFieldsParents</span></a></span><span>
</span><span id="line-1202"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681323729"><span class="annot"><span class="annottext">possible_parents :: [[RecSelParent]]
</span><a href="#local-6989586621681323729"><span class="hs-identifier hs-var hs-var">possible_parents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsRecField'
       (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681323731"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span><span>
</span><span id="line-1203"></span><span>             </span><span class="hs-comment">-- Identify a single parent</span><span>
</span><span id="line-1204"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323728"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681323728"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; [[RecSelParent]] -&gt; TcM RecSelParent
</span><a href="#local-6989586621681323727"><span class="hs-identifier hs-var">identifyParent</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681323732"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621681323729"><span class="hs-identifier hs-var">possible_parents</span></a></span><span>
</span><span id="line-1205"></span><span>             </span><span class="hs-comment">-- Pick the right selector with that parent for each field</span><span>
</span><span id="line-1206"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent
-&gt; (LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; TcM
     (LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681323725"><span class="hs-identifier hs-var">pickParent</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681323728"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(GenLocated
    SrcSpanAnnA
    (HsRecField'
       (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))),
  [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681323731"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1207"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1208"></span><span>    </span><span class="hs-comment">-- Extract the selector name of a field update if it is unambiguous</span><span>
</span><span id="line-1209"></span><span>    </span><span class="annot"><a href="#local-6989586621681323735"><span class="hs-identifier hs-type">isUnambiguous</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>    </span><span id="local-6989586621681323735"><span class="annot"><span class="annottext">isUnambiguous :: LHsRecUpdField GhcRn -&gt; Maybe (LHsRecUpdField GhcRn, Name)
</span><a href="#local-6989586621681323735"><span class="hs-identifier hs-var hs-var">isUnambiguous</span></a></span></span><span> </span><span id="local-6989586621681323724"><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323724"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323724"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1211"></span><span>                        </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#Unambiguous"><span class="hs-identifier hs-type">Unambiguous</span></a></span><span> </span><span id="local-6989586621681323722"><span class="annot"><span class="annottext">XUnambiguous GhcRn
</span><a href="#local-6989586621681323722"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span class="annot"><span class="annottext">LocatedN RdrName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323724"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XUnambiguous GhcRn
</span><a href="#local-6989586621681323722"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>                        </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#Ambiguous"><span class="hs-identifier hs-type">Ambiguous</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span>    </span><span class="hs-comment">-- Look up the possible parents and selector GREs for each field</span><span>
</span><span id="line-1215"></span><span>    </span><span class="annot"><a href="#local-6989586621681323730"><span class="hs-identifier hs-type">getUpdFieldsParents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1216"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1217"></span><span>    </span><span id="local-6989586621681323730"><span class="annot"><span class="annottext">getUpdFieldsParents :: TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681323730"><span class="hs-identifier hs-var hs-var">getUpdFieldsParents</span></a></span></span><span>
</span><span id="line-1218"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323737"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span>
</span><span id="line-1219"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
-&gt; RdrName
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(RecSelParent, GlobalRdrElt)]
</span><a href="GHC.Tc.Gen.Head.html#lookupParents"><span class="hs-identifier hs-var">lookupParents</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass).
HsRecUpdField (GhcPass p) -&gt; GenLocated SrcSpan RdrName
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldRdr"><span class="hs-identifier hs-var">hsRecUpdFieldRdr</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1220"></span><span>          </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323737"><span class="hs-identifier hs-var">rbnds</span></a></span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span>    </span><span class="hs-comment">-- Given a the lists of possible parents for each field,</span><span>
</span><span id="line-1223"></span><span>    </span><span class="hs-comment">-- identify a single parent</span><span>
</span><span id="line-1224"></span><span>    </span><span class="annot"><a href="#local-6989586621681323727"><span class="hs-identifier hs-type">identifyParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span>
</span><span id="line-1225"></span><span>    </span><span id="local-6989586621681323727"><span class="annot"><span class="annottext">identifyParent :: FamInstEnvs -&gt; [[RecSelParent]] -&gt; TcM RecSelParent
</span><a href="#local-6989586621681323727"><span class="hs-identifier hs-var hs-var">identifyParent</span></a></span></span><span> </span><span id="local-6989586621681323718"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681323718"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span id="local-6989586621681323717"><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621681323717"><span class="hs-identifier hs-var">possible_parents</span></a></span></span><span>
</span><span id="line-1226"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr1"><span class="hs-identifier hs-var">foldr1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#intersect"><span class="hs-identifier hs-var">intersect</span></a></span><span> </span><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621681323717"><span class="hs-identifier hs-var">possible_parents</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1227"></span><span>        </span><span class="hs-comment">-- No parents for all fields: record update is ill-typed</span><span>
</span><span id="line-1228"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#noPossibleParents"><span class="hs-identifier hs-var">noPossibleParents</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323737"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>
</span><span id="line-1230"></span><span>        </span><span class="hs-comment">-- Exactly one datatype with all the fields: use that</span><span>
</span><span id="line-1231"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621681323713"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681323713"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681323713"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>        </span><span class="hs-comment">-- Multiple possible parents: try harder to disambiguate</span><span>
</span><span id="line-1234"></span><span>        </span><span class="hs-comment">-- Can we get a parent TyCon from the pushed-in type?</span><span>
</span><span id="line-1235"></span><span>        </span><span class="annot"><span class="annottext">RecSelParent
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[RecSelParent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323712"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323712"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; ExpRhoType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Head.html#tyConOfET"><span class="hs-identifier hs-var">tyConOfET</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681323718"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681323736"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1236"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn ()
</span><a href="#local-6989586621681323710"><span class="hs-identifier hs-var">reportAmbiguousField</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323712"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1237"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323712"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1238"></span><span>
</span><span id="line-1239"></span><span>        </span><span class="hs-comment">-- Does the expression being updated have a type signature?</span><span>
</span><span id="line-1240"></span><span>        </span><span class="hs-comment">-- If so, try to extract a parent TyCon from it</span><span>
</span><span id="line-1241"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
</span><a href="GHC.Tc.Gen.Head.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681323739"><span class="hs-identifier hs-var">record_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323708"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323708"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TcType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Head.html#tyConOf"><span class="hs-identifier hs-var">tyConOf</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681323718"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323738"><span class="hs-identifier hs-var">record_rho</span></a></span><span>
</span><span id="line-1243"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn ()
</span><a href="#local-6989586621681323710"><span class="hs-identifier hs-var">reportAmbiguousField</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323708"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1244"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323708"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1245"></span><span>
</span><span id="line-1246"></span><span>        </span><span class="hs-comment">-- Nothing else we can try...</span><span>
</span><span id="line-1247"></span><span>        </span><span class="annot"><span class="annottext">[RecSelParent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badOverloadedUpdate"><span class="hs-identifier hs-var">badOverloadedUpdate</span></a></span><span>
</span><span id="line-1248"></span><span>
</span><span id="line-1249"></span><span>    </span><span class="hs-comment">-- Make a field unambiguous by choosing the given parent.</span><span>
</span><span id="line-1250"></span><span>    </span><span class="hs-comment">-- Emits an error if the field cannot have that parent,</span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-comment">-- e.g. if the user writes</span><span>
</span><span id="line-1252"></span><span>    </span><span class="hs-comment">--     r { x = e } :: T</span><span>
</span><span id="line-1253"></span><span>    </span><span class="hs-comment">-- where T does not have field x.</span><span>
</span><span id="line-1254"></span><span>    </span><span class="annot"><a href="#local-6989586621681323725"><span class="hs-identifier hs-type">pickParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span>
</span><span id="line-1255"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>    </span><span id="local-6989586621681323725"><span class="annot"><span class="annottext">pickParent :: RecSelParent
-&gt; (LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; TcM
     (LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681323725"><span class="hs-identifier hs-var hs-var">pickParent</span></a></span></span><span> </span><span id="local-6989586621681323705"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681323705"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323704"><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323704"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323703"><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681323703"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.16.3.0/src/GHC-List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681323705"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681323703"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1259"></span><span>                      </span><span class="hs-comment">-- Phew! The parent is valid for this field.</span><span>
</span><span id="line-1260"></span><span>                      </span><span class="hs-comment">-- Previously ambiguous fields must be marked as</span><span>
</span><span id="line-1261"></span><span>                      </span><span class="hs-comment">-- used now that we know which one is meant, but</span><span>
</span><span id="line-1262"></span><span>                      </span><span class="hs-comment">-- unambiguous ones shouldn't be recorded again</span><span>
</span><span id="line-1263"></span><span>                      </span><span class="hs-comment">-- (giving duplicate deprecation warnings).</span><span>
</span><span id="line-1264"></span><span>          </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323701"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681323701"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681323703"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1265"></span><span>                             </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681323699"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323699"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323704"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>                             </span><span class="annot"><span class="annottext">forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323699"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GlobalRdrElt -&gt; TcRn ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var">addUsedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681323701"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-1267"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsRecField' GhcRn (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681323733"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323704"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greMangledName"><span class="hs-identifier hs-var">greMangledName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681323701"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1268"></span><span>                      </span><span class="hs-comment">-- The field doesn't belong to this parent, so report</span><span>
</span><span id="line-1269"></span><span>                      </span><span class="hs-comment">-- an error but keep going through all the fields</span><span>
</span><span id="line-1270"></span><span>          </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent -&gt; RdrName -&gt; SDoc
</span><a href="GHC.Tc.Gen.Head.html#fieldNotInType"><span class="hs-identifier hs-var">fieldNotInType</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681323705"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1271"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: Pass).
HsRecUpdField (GhcPass p) -&gt; GenLocated SrcSpan RdrName
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldRdr"><span class="hs-identifier hs-var">hsRecUpdFieldRdr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323704"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsRecField' GhcRn (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681323733"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681323704"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greMangledName"><span class="hs-identifier hs-var">greMangledName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681323703"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1273"></span><span>
</span><span id="line-1274"></span><span>    </span><span class="hs-comment">-- Given a (field update, selector name) pair, look up the</span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-comment">-- selector to give a field update with an unambiguous Id</span><span>
</span><span id="line-1276"></span><span>    </span><span class="annot"><a href="#local-6989586621681323733"><span class="hs-identifier hs-type">lookupSelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1277"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1278"></span><span>    </span><span id="local-6989586621681323733"><span class="annot"><span class="annottext">lookupSelector :: (LHsRecUpdField GhcRn, Name)
-&gt; TcM
     (LHsRecField' GhcRn (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681323733"><span class="hs-identifier hs-var hs-var">lookupSelector</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681323696"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681323696"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681323695"><span class="annot"><span class="annottext">HsRecField'
  (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323695"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323694"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323694"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1279"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323693"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323693"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323694"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1280"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681323691"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323691"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681323690"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681323690"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField'
  (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323695"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1281"></span><span>                 </span><span id="local-6989586621681323689"><span class="annot"><span class="annottext">lbl :: RdrName
</span><a href="#local-6989586621681323689"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681323690"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-1282"></span><span>           </span><span class="hs-comment">-- ; return $ L l upd { hsRecFieldLbl</span><span>
</span><span id="line-1283"></span><span>           </span><span class="hs-comment">--                = L loc (Unambiguous i (L (noAnnSrcSpan loc) lbl)) }</span><span>
</span><span id="line-1284"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681323696"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecField"><span class="hs-identifier hs-type">HsRecField</span></a></span><span>
</span><span id="line-1285"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldAnn :: XHsRecField (AmbiguousFieldOcc GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldAnn"><span class="hs-identifier hs-var">hsRecFieldAnn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; XHsRecField id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldAnn"><span class="hs-identifier hs-var">hsRecFieldAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField'
  (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323695"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1286"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span>
</span><span id="line-1287"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323691"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall pass.
XUnambiguous pass -&gt; LocatedN RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323693"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323691"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681323689"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1288"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; arg
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField'
  (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323695"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1289"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecPun :: Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecPun"><span class="hs-identifier hs-var">hsRecPun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecPun"><span class="hs-identifier hs-var">hsRecPun</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField'
  (AmbiguousFieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323695"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1290"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-1291"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span>    </span><span class="hs-comment">-- See Note [Deprecating ambiguous fields] in GHC.Tc.Gen.Head</span><span>
</span><span id="line-1294"></span><span>    </span><span class="annot"><a href="#local-6989586621681323710"><span class="hs-identifier hs-type">reportAmbiguousField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1295"></span><span>    </span><span id="local-6989586621681323710"><span class="annot"><span class="annottext">reportAmbiguousField :: TyCon -&gt; TcRn ()
</span><a href="#local-6989586621681323710"><span class="hs-identifier hs-var hs-var">reportAmbiguousField</span></a></span></span><span> </span><span id="local-6989586621681323684"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323684"><span class="hs-identifier hs-var">parent_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1296"></span><span>        </span><span class="annot"><span class="annottext">forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323683"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#warnIfFlag"><span class="hs-identifier hs-var">warnIfFlag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnAmbiguousFields"><span class="hs-identifier hs-var">Opt_WarnAmbiguousFields</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1297"></span><span>          </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The record update&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681323679"><span class="hs-identifier hs-var">rupd</span></a></span><span>
</span><span id="line-1298"></span><span>                   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;with type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323684"><span class="hs-identifier hs-var">parent_type</span></a></span><span>
</span><span id="line-1299"></span><span>                   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is ambiguous.&quot;</span></span><span>
</span><span id="line-1300"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This will not be supported by -XDuplicateRecordFields in future releases of GHC.&quot;</span></span><span>
</span><span id="line-1301"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-1302"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1303"></span><span>        </span><span id="local-6989586621681323679"><span class="annot"><span class="annottext">rupd :: HsExpr GhcRn
</span><a href="#local-6989586621681323679"><span class="hs-identifier hs-var hs-var">rupd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: LHsExpr GhcRn
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681323739"><span class="hs-identifier hs-var">record_expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: Either [LHsRecUpdField GhcRn] [LHsRecUpdProj GhcRn]
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323737"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_ext :: XRecordUpd GhcRn
</span><a href="Language.Haskell.Syntax.Expr.html#rupd_ext"><span class="hs-identifier hs-var">rupd_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1304"></span><span>        </span><span id="local-6989586621681323683"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621681323683"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a e. GenLocated (SrcSpanAnn' a) e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323737"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1305"></span><span>
</span><span id="line-1306"></span><span class="hs-comment">{-
Game plan for record bindings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Find the TyCon for the bindings, from the first field label.

2. Instantiate its tyvars and unify (T a1 .. an) with expected_ty.

For each binding field = value

3. Instantiate the field type (from the field label) using the type
   envt from step 2.

4  Type check the value using tcCheckPolyExprNC (in tcRecordField),
   passing the field type as the expected argument type.

This extends OK when the field types are universally quantified.
-}</span><span>
</span><span id="line-1323"></span><span>
</span><span id="line-1324"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-type">tcRecordBinds</span></a></span><span>
</span><span id="line-1325"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1326"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Expected type for each field</span><span>
</span><span id="line-1327"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1328"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1329"></span><span>
</span><span id="line-1330"></span><span id="tcRecordBinds"><span class="annot"><span class="annottext">tcRecordBinds :: ConLike
-&gt; [TcType] -&gt; HsRecordBinds GhcRn -&gt; TcM (HsRecordBinds GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-var hs-var">tcRecordBinds</span></a></span></span><span> </span><span id="local-6989586621681323677"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323677"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681323676"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323676"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span id="local-6989586621681323674"><span class="annot"><span class="annottext">[LHsRecField GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681323674"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621681323673"><span class="annot"><span class="annottext">Maybe (Located Int)
</span><a href="#local-6989586621681323673"><span class="hs-identifier hs-var">dd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1331"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323672"><span class="annot"><span class="annottext">[Maybe
   (GenLocated
      SrcSpanAnnA
      (HsRecField'
         (FieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcTc))))]
</span><a href="#local-6989586621681323672"><span class="hs-identifier hs-var">mb_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField GhcRn (LHsExpr GhcRn)
-&gt; TcM (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
</span><a href="#local-6989586621681323671"><span class="hs-identifier hs-var">do_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681323674"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1332"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p arg.
[LHsRecField p arg] -&gt; Maybe (Located Int) -&gt; HsRecFields p arg
</span><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-var">HsRecFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe
   (GenLocated
      SrcSpanAnnA
      (HsRecField'
         (FieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcTc))))]
</span><a href="#local-6989586621681323672"><span class="hs-identifier hs-var">mb_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Located Int)
</span><a href="#local-6989586621681323673"><span class="hs-identifier hs-var">dd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1333"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1334"></span><span>    </span><span id="local-6989586621681323669"><span class="annot"><span class="annottext">fields :: [Name]
</span><a href="#local-6989586621681323669"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323677"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1335"></span><span>    </span><span id="local-6989586621681323667"><span class="annot"><span class="annottext">flds_w_tys :: [(Name, TcType)]
</span><a href="#local-6989586621681323667"><span class="hs-identifier hs-var hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordBinds&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681323669"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323676"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1336"></span><span>
</span><span id="line-1337"></span><span>    </span><span class="annot"><a href="#local-6989586621681323671"><span class="hs-identifier hs-type">do_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1338"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1339"></span><span>    </span><span id="local-6989586621681323671"><span class="annot"><span class="annottext">do_bind :: LHsRecField GhcRn (LHsExpr GhcRn)
-&gt; TcM (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
</span><a href="#local-6989586621681323671"><span class="hs-identifier hs-var hs-var">do_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681323666"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681323666"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681323665"><span class="annot"><span class="annottext">fld :: HsRecField'
  (FieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323665"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecField"><span class="hs-identifier hs-type">HsRecField</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681323664"><span class="annot"><span class="annottext">Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681323664"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-1340"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: forall id arg. HsRecField' id arg -&gt; arg
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681323663"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621681323663"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>
</span><span id="line-1342"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323662"><span class="annot"><span class="annottext">Maybe
  (Located (FieldOcc GhcTc), GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681323662"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [(Name, TcType)]
-&gt; LFieldOcc GhcRn
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var">tcRecordField</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323677"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681323667"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681323664"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621681323663"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1343"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Located (FieldOcc GhcTc), GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681323662"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1344"></span><span>               </span><span class="annot"><span class="annottext">Maybe
  (Located (FieldOcc GhcTc), GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1345"></span><span>               </span><span class="hs-comment">-- Just (f', rhs') -&gt; return (Just (L l (fld { hsRecFieldLbl = f'</span><span>
</span><span id="line-1346"></span><span>               </span><span class="hs-comment">--                                            , hsRecFieldArg = rhs' }))) }</span><span>
</span><span id="line-1347"></span><span>               </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323660"><span class="annot"><span class="annottext">Located (FieldOcc GhcTc)
</span><a href="#local-6989586621681323660"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323659"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323659"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681323666"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecField"><span class="hs-identifier hs-type">HsRecField</span></a></span><span>
</span><span id="line-1348"></span><span>                                                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldAnn :: XHsRecField (FieldOcc GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldAnn"><span class="hs-identifier hs-var">hsRecFieldAnn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; XHsRecField id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldAnn"><span class="hs-identifier hs-var">hsRecFieldAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField'
  (FieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323665"><span class="hs-identifier hs-var">fld</span></a></span><span>
</span><span id="line-1349"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: Located (FieldOcc GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Located (FieldOcc GhcTc)
</span><a href="#local-6989586621681323660"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-1350"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323659"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-1351"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecPun :: Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecPun"><span class="hs-identifier hs-var">hsRecPun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Bool
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecPun"><span class="hs-identifier hs-var">hsRecPun</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField'
  (FieldOcc GhcRn) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323665"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1352"></span><span>
</span><span id="line-1353"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordUpd"><span class="hs-identifier hs-type">tcRecordUpd</span></a></span><span>
</span><span id="line-1354"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1355"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Expected type for each field</span><span>
</span><span id="line-1356"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1357"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1358"></span><span>
</span><span id="line-1359"></span><span id="tcRecordUpd"><span class="annot"><span class="annottext">tcRecordUpd :: ConLike
-&gt; [TcType]
-&gt; [LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; TcM [LHsRecUpdField GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordUpd"><span class="hs-identifier hs-var hs-var">tcRecordUpd</span></a></span></span><span> </span><span id="local-6989586621681323658"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323658"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681323657"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323657"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621681323656"><span class="annot"><span class="annottext">[LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681323656"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; TcM (Maybe (LHsRecUpdField GhcTc))
</span><a href="#local-6989586621681323655"><span class="hs-identifier hs-var">do_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681323656"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1360"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1361"></span><span>    </span><span id="local-6989586621681323654"><span class="annot"><span class="annottext">fields :: [Name]
</span><a href="#local-6989586621681323654"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323658"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1362"></span><span>    </span><span id="local-6989586621681323653"><span class="annot"><span class="annottext">flds_w_tys :: [(Name, TcType)]
</span><a href="#local-6989586621681323653"><span class="hs-identifier hs-var hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordUpd&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681323654"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681323657"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1363"></span><span>
</span><span id="line-1364"></span><span>    </span><span class="annot"><a href="#local-6989586621681323655"><span class="hs-identifier hs-type">do_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1365"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>    </span><span id="local-6989586621681323655"><span class="annot"><span class="annottext">do_bind :: LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; TcM (Maybe (LHsRecUpdField GhcTc))
</span><a href="#local-6989586621681323655"><span class="hs-identifier hs-var hs-var">do_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681323652"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681323652"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681323651"><span class="annot"><span class="annottext">fld :: HsRecField'
  (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323651"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecField"><span class="hs-identifier hs-type">HsRecField</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681323650"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323650"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681323649"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc
</span><a href="#local-6989586621681323649"><span class="hs-identifier hs-var">af</span></a></span></span><span>
</span><span id="line-1367"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: forall id arg. HsRecField' id arg -&gt; arg
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681323648"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621681323648"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1368"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681323647"><span class="annot"><span class="annottext">lbl :: RdrName
</span><a href="#local-6989586621681323647"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc
</span><a href="#local-6989586621681323649"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-1369"></span><span>                 </span><span id="local-6989586621681323646"><span class="annot"><span class="annottext">sel_id :: Var
</span><a href="#local-6989586621681323646"><span class="hs-identifier hs-var hs-var">sel_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; Var
</span><a href="GHC.Hs.Type.html#selectorAmbiguousFieldOcc"><span class="hs-identifier hs-var">selectorAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc
</span><a href="#local-6989586621681323649"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-1370"></span><span>                 </span><span id="local-6989586621681323645"><span class="annot"><span class="annottext">f :: Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681323645"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323650"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall pass. XCFieldOcc pass -&gt; LocatedN RdrName -&gt; FieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323646"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323650"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681323647"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1371"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681323643"><span class="annot"><span class="annottext">Maybe
  (Located (FieldOcc GhcTc), GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681323643"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [(Name, TcType)]
-&gt; LFieldOcc GhcRn
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var">tcRecordField</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323658"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681323653"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681323645"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621681323648"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1372"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Located (FieldOcc GhcTc), GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621681323643"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1373"></span><span>               </span><span class="annot"><span class="annottext">Maybe
  (Located (FieldOcc GhcTc), GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1374"></span><span>               </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323642"><span class="annot"><span class="annottext">Located (FieldOcc GhcTc)
</span><a href="#local-6989586621681323642"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323641"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323641"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1375"></span><span>                 </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span>
</span><span id="line-1376"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681323652"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecField'
  (AmbiguousFieldOcc GhcTc) (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621681323651"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span>
</span><span id="line-1377"></span><span>                                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323650"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall pass.
XUnambiguous pass -&gt; LocatedN RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span>
</span><span id="line-1378"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall pass. FieldOcc pass -&gt; XCFieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#extFieldOcc"><span class="hs-identifier hs-var">extFieldOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Located (FieldOcc GhcTc)
</span><a href="#local-6989586621681323642"><span class="hs-identifier hs-var">f'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1379"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323650"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681323647"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323641"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1381"></span><span>
</span><span id="line-1382"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-type">tcRecordField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#Assoc"><span class="hs-identifier hs-type">Assoc</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1383"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1384"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span id="tcRecordField"><span class="annot"><span class="annottext">tcRecordField :: ConLike
-&gt; [(Name, TcType)]
-&gt; LFieldOcc GhcRn
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var hs-var">tcRecordField</span></a></span></span><span> </span><span id="local-6989586621681323638"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323638"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681323637"><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681323637"><span class="hs-identifier hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681323636"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323636"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span id="local-6989586621681323635"><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681323635"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span id="local-6989586621681323634"><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621681323634"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681323633"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681323633"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323632"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323632"><span class="hs-identifier hs-var">field_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681323637"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681323635"><span class="hs-identifier hs-var">sel_name</span></a></span><span>
</span><span id="line-1387"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-var">fieldCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323629"><span class="hs-identifier hs-var">field_lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1388"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681323628"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323628"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681323633"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323632"><span class="hs-identifier hs-var">field_ty</span></a></span><span>
</span><span id="line-1389"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681323627"><span class="annot"><span class="annottext">field_id :: Var
</span><a href="#local-6989586621681323627"><span class="hs-identifier hs-var hs-var">field_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Unique -&gt; TcType -&gt; TcType -&gt; SrcSpan -&gt; Var
</span><a href="GHC.Types.Id.html#mkUserLocal"><span class="hs-identifier hs-var">mkUserLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681323635"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1390"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
</span><a href="GHC.Types.Name.html#nameUnique"><span class="hs-identifier hs-var">nameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681323635"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1391"></span><span>                                        </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323632"><span class="hs-identifier hs-var">field_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323636"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1392"></span><span>                </span><span class="hs-comment">-- Yuk: the field_id has the *unique* of the selector Id</span><span>
</span><span id="line-1393"></span><span>                </span><span class="hs-comment">--          (so we can find it easily)</span><span>
</span><span id="line-1394"></span><span>                </span><span class="hs-comment">--      but is a LocalId with the appropriate type of the RHS</span><span>
</span><span id="line-1395"></span><span>                </span><span class="hs-comment">--          (so the desugarer knows the type of local binder to make)</span><span>
</span><span id="line-1396"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681323636"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall pass. XCFieldOcc pass -&gt; LocatedN RdrName -&gt; FieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323627"><span class="hs-identifier hs-var">field_id</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621681323634"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681323628"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1397"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1398"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#badFieldCon"><span class="hs-identifier hs-var">badFieldCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323638"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323629"><span class="hs-identifier hs-var">field_lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1400"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1401"></span><span>        </span><span id="local-6989586621681323629"><span class="annot"><span class="annottext">field_lbl :: FieldLabelString
</span><a href="#local-6989586621681323629"><span class="hs-identifier hs-var hs-var">field_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FieldLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedN RdrName
</span><a href="#local-6989586621681323634"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1402"></span><span>
</span><span id="line-1403"></span><span>
</span><span id="line-1404"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-type">checkMissingFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1405"></span><span id="checkMissingFields"><span class="annot"><span class="annottext">checkMissingFields :: ConLike -&gt; HsRecordBinds GhcRn -&gt; [Scaled TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-var hs-var">checkMissingFields</span></a></span></span><span> </span><span id="local-6989586621681323622"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323622"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681323621"><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681323621"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621681323620"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323620"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>
</span><span id="line-1406"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681323619"><span class="hs-identifier hs-var">field_labels</span></a></span><span>   </span><span class="hs-comment">-- Not declared as a record;</span><span>
</span><span id="line-1407"></span><span>                        </span><span class="hs-comment">-- But C{} is still valid if no strict fields</span><span>
</span><span id="line-1408"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621681323616"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1409"></span><span>        </span><span class="hs-comment">-- Illegal if any arg is strict</span><span>
</span><span id="line-1410"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-var">missingStrictFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323622"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1411"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1412"></span><span>        </span><span id="local-6989586621681323614"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681323614"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span>
</span><span id="line-1413"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681323614"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621681323616"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681323619"><span class="hs-identifier hs-var">field_labels</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1414"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarnReason -&gt; Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#warnTc"><span class="hs-identifier hs-var">warnTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1415"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-var">missingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323622"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1416"></span><span>
</span><span id="line-1417"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>              </span><span class="hs-comment">-- A record</span><span>
</span><span id="line-1418"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323607"><span class="hs-identifier hs-var">missing_s_fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1419"></span><span>        </span><span id="local-6989586621681323606"><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323606"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *} {a}.
Traversable t =&gt;
t (a, TcType) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, TcType))
</span><a href="#local-6989586621681323605"><span class="hs-identifier hs-var">zonk_fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323607"><span class="hs-identifier hs-var">missing_s_fields</span></a></span><span>
</span><span id="line-1420"></span><span>        </span><span class="hs-comment">-- It is an error to omit a strict field, because</span><span>
</span><span id="line-1421"></span><span>        </span><span class="hs-comment">-- we can't substitute it with (error &quot;Missing field f&quot;)</span><span>
</span><span id="line-1422"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-var">missingStrictFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323622"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323606"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span>    </span><span id="local-6989586621681323604"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681323604"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span>
</span><span id="line-1425"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681323604"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323603"><span class="hs-identifier hs-var">missing_ns_fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1426"></span><span>        </span><span id="local-6989586621681323602"><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323602"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *} {a}.
Traversable t =&gt;
t (a, TcType) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, TcType))
</span><a href="#local-6989586621681323605"><span class="hs-identifier hs-var">zonk_fields</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323603"><span class="hs-identifier hs-var">missing_ns_fields</span></a></span><span>
</span><span id="line-1427"></span><span>        </span><span class="hs-comment">-- It is not an error (though we may want) to omit a</span><span>
</span><span id="line-1428"></span><span>        </span><span class="hs-comment">-- lazy field, because we can always use</span><span>
</span><span id="line-1429"></span><span>        </span><span class="hs-comment">-- (error &quot;Missing field f&quot;) instead.</span><span>
</span><span id="line-1430"></span><span>        </span><span class="annot"><span class="annottext">WarnReason -&gt; Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#warnTc"><span class="hs-identifier hs-var">warnTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1431"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-var">missingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323622"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323602"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1432"></span><span>
</span><span id="line-1433"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1434"></span><span>    </span><span class="hs-comment">-- we zonk the fields to get better types in error messages (#18869)</span><span>
</span><span id="line-1435"></span><span>    </span><span id="local-6989586621681323605"><span class="annot"><span class="annottext">zonk_fields :: t (a, TcType) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t (a, TcType))
</span><a href="#local-6989586621681323605"><span class="hs-identifier hs-var hs-var">zonk_fields</span></a></span></span><span> </span><span id="local-6989586621681323596"><span class="annot"><span class="annottext">t (a, TcType)
</span><a href="#local-6989586621681323596"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">t (a, TcType)
</span><a href="#local-6989586621681323596"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681323594"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323594"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323593"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323593"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1436"></span><span>        </span><span id="local-6989586621681323592"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323592"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323593"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1437"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323594"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323592"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1438"></span><span>    </span><span id="local-6989586621681323607"><span class="annot"><span class="annottext">missing_s_fields :: [(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323607"><span class="hs-identifier hs-var hs-var">missing_s_fields</span></a></span></span><span>
</span><span id="line-1439"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323590"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681323589"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323590"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323590"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323588"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681323588"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323589"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681323589"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabel, HsImplBang, Scaled TcType)]
</span><a href="#local-6989586621681323587"><span class="hs-identifier hs-var">field_info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1440"></span><span>                 </span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681323588"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1441"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323590"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *}. Foldable t =&gt; FieldLabel -&gt; t Name -&gt; Bool
</span><a href="#local-6989586621681323586"><span class="hs-operator hs-var">`elemField`</span></a></span><span> </span><span class="annot"><span class="annottext">[XCFieldOcc GhcRn]
</span><a href="#local-6989586621681323585"><span class="hs-identifier hs-var">field_names_used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1443"></span><span>    </span><span id="local-6989586621681323603"><span class="annot"><span class="annottext">missing_ns_fields :: [(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323603"><span class="hs-identifier hs-var hs-var">missing_ns_fields</span></a></span></span><span>
</span><span id="line-1444"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323584"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681323583"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323584"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323584"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323582"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681323582"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323583"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681323583"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabel, HsImplBang, Scaled TcType)]
</span><a href="#local-6989586621681323587"><span class="hs-identifier hs-var">field_info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1445"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681323582"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1446"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323584"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">forall {t :: * -&gt; *}. Foldable t =&gt; FieldLabel -&gt; t Name -&gt; Bool
</span><a href="#local-6989586621681323586"><span class="hs-operator hs-var">`elemField`</span></a></span><span> </span><span class="annot"><span class="annottext">[XCFieldOcc GhcRn]
</span><a href="#local-6989586621681323585"><span class="hs-identifier hs-var">field_names_used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span>    </span><span id="local-6989586621681323585"><span class="annot"><span class="annottext">field_names_used :: [XCFieldOcc GhcRn]
</span><a href="#local-6989586621681323585"><span class="hs-identifier hs-var hs-var">field_names_used</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p arg. UnXRec p =&gt; HsRecFields p arg -&gt; [XCFieldOcc p]
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFields"><span class="hs-identifier hs-var">hsRecFields</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681323621"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1450"></span><span>    </span><span id="local-6989586621681323619"><span class="annot"><span class="annottext">field_labels :: [FieldLabel]
</span><a href="#local-6989586621681323619"><span class="hs-identifier hs-var hs-var">field_labels</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323622"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1451"></span><span>
</span><span id="line-1452"></span><span>    </span><span id="local-6989586621681323587"><span class="annot"><span class="annottext">field_info :: [(FieldLabel, HsImplBang, Scaled TcType)]
</span><a href="#local-6989586621681323587"><span class="hs-identifier hs-var hs-var">field_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681323619"><span class="hs-identifier hs-var">field_labels</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621681323616"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681323620"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1453"></span><span>
</span><span id="line-1454"></span><span>    </span><span id="local-6989586621681323616"><span class="annot"><span class="annottext">field_strs :: [HsImplBang]
</span><a href="#local-6989586621681323616"><span class="hs-identifier hs-var hs-var">field_strs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [HsImplBang]
</span><a href="GHC.Core.ConLike.html#conLikeImplBangs"><span class="hs-identifier hs-var">conLikeImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323622"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1455"></span><span>
</span><span id="line-1456"></span><span>    </span><span id="local-6989586621681323575"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323575"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span id="local-6989586621681323586"><span class="annot"><span class="annottext">elemField :: FieldLabel -&gt; t Name -&gt; Bool
</span><a href="#local-6989586621681323586"><span class="hs-operator hs-var hs-var">`elemField`</span></a></span></span><span> </span><span id="local-6989586621681323574"><span class="annot"><span class="annottext">t Name
</span><a href="#local-6989586621681323574"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323573"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323573"><span class="hs-identifier hs-var">fl'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681323575"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323573"><span class="hs-identifier hs-var">fl'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t Name
</span><a href="#local-6989586621681323574"><span class="hs-identifier hs-var">flds</span></a></span><span>
</span><span id="line-1457"></span><span>
</span><span id="line-1458"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Errors and contexts}
*                                                                      *
************************************************************************

Boring and alphabetical:
-}</span><span>
</span><span id="line-1467"></span><span>
</span><span id="line-1468"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-type">fieldCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1469"></span><span id="fieldCtxt"><span class="annot"><span class="annottext">fieldCtxt :: FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-var hs-var">fieldCtxt</span></a></span></span><span> </span><span id="local-6989586621681323572"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323572"><span class="hs-identifier hs-var">field_name</span></a></span></span><span>
</span><span id="line-1470"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323572"><span class="hs-identifier hs-var">field_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;field of a record&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1471"></span><span>
</span><span id="line-1472"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#badFieldTypes"><span class="hs-identifier hs-type">badFieldTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1473"></span><span id="badFieldTypes"><span class="annot"><span class="annottext">badFieldTypes :: [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldTypes"><span class="hs-identifier hs-var hs-var">badFieldTypes</span></a></span></span><span> </span><span id="local-6989586621681323569"><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323569"><span class="hs-identifier hs-var">prs</span></a></span></span><span>
</span><span id="line-1474"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Record update for insufficiently polymorphic field&quot;</span></span><span>
</span><span id="line-1475"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323569"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323565"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323563"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323565"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323565"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323563"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681323563"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323569"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-type">badFieldsUpd</span></a></span><span>
</span><span id="line-1479"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1480"></span><span>               </span><span class="hs-comment">-- Field names that don't belong to a single datacon</span><span>
</span><span id="line-1481"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Data cons of the type which the first field name belongs to</span><span>
</span><span id="line-1482"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1483"></span><span id="badFieldsUpd"><span class="annot"><span class="annottext">badFieldsUpd :: [LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [ConLike] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-var hs-var">badFieldsUpd</span></a></span></span><span> </span><span id="local-6989586621681323562"><span class="annot"><span class="annottext">[LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681323562"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621681323561"><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681323561"><span class="hs-identifier hs-var">data_cons</span></a></span></span><span>
</span><span id="line-1484"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No constructor has all these fields:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1485"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681323559"><span class="hs-identifier hs-var">conflictingFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1486"></span><span>          </span><span class="hs-comment">-- See Note [Finding the conflicting fields]</span><span>
</span><span id="line-1487"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1488"></span><span>    </span><span class="hs-comment">-- A (preferably small) set of fields such that no constructor contains</span><span>
</span><span id="line-1489"></span><span>    </span><span class="hs-comment">-- all of them.  See Note [Finding the conflicting fields]</span><span>
</span><span id="line-1490"></span><span>    </span><span id="local-6989586621681323559"><span class="annot"><span class="annottext">conflictingFields :: [FieldLabelString]
</span><a href="#local-6989586621681323559"><span class="hs-identifier hs-var hs-var">conflictingFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323554"><span class="hs-identifier hs-var">nonMembers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1491"></span><span>        </span><span class="hs-comment">-- nonMember belongs to a different type.</span><span>
</span><span id="line-1492"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681323553"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323553"><span class="hs-identifier hs-var">nonMember</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323552"><span class="hs-identifier hs-var">aMember</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323553"><span class="hs-identifier hs-var">nonMember</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1493"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1494"></span><span>            </span><span class="hs-comment">-- All of rbinds belong to one type. In this case, repeatedly add</span><span>
</span><span id="line-1495"></span><span>            </span><span class="hs-comment">-- a field to the set until no constructor contains the set.</span><span>
</span><span id="line-1496"></span><span>
</span><span id="line-1497"></span><span>            </span><span class="hs-comment">-- Each field, together with a list indicating which constructors</span><span>
</span><span id="line-1498"></span><span>            </span><span class="hs-comment">-- have all the fields so far.</span><span>
</span><span id="line-1499"></span><span>            </span><span class="annot"><a href="#local-6989586621681323551"><span class="hs-identifier hs-type">growingSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1500"></span><span>            </span><span id="local-6989586621681323551"><span class="annot"><span class="annottext">growingSets :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323551"><span class="hs-identifier hs-var hs-var">growingSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#scanl1"><span class="hs-identifier hs-var">scanl1</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621681323549"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323548"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-1501"></span><span>            </span><span id="local-6989586621681323549"><span class="annot"><span class="annottext">combine :: (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621681323549"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323547"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681323547"><span class="hs-identifier hs-var">setMem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323546"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323546"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323545"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681323545"><span class="hs-identifier hs-var">fldMem</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1502"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323546"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(&amp;&amp;)</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681323547"><span class="hs-identifier hs-var">setMem</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681323545"><span class="hs-identifier hs-var">fldMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-1504"></span><span>            </span><span class="hs-comment">-- Fields that don't change the membership status of the set</span><span>
</span><span id="line-1505"></span><span>            </span><span class="hs-comment">-- are redundant and can be dropped.</span><span>
</span><span id="line-1506"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#groupBy"><span class="hs-identifier hs-var">groupBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/Data-Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323551"><span class="hs-identifier hs-var">growingSets</span></a></span><span>
</span><span id="line-1507"></span><span>
</span><span id="line-1508"></span><span>    </span><span id="local-6989586621681323552"><span class="annot"><span class="annottext">aMember :: FieldLabelString
</span><a href="#local-6989586621681323552"><span class="hs-identifier hs-var hs-var">aMember</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">members</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">head</span><span> </span><span class="hs-identifier">members</span><span class="hs-special">)</span><span>
</span><span id="line-1509"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681323541"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323541"><span class="hs-identifier hs-var">members</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323554"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323554"><span class="hs-identifier hs-var">nonMembers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#or"><span class="hs-identifier hs-var">or</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323548"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-1510"></span><span>
</span><span id="line-1511"></span><span>    </span><span class="hs-comment">-- For each field, which constructors contain the field?</span><span>
</span><span id="line-1512"></span><span>    </span><span class="annot"><a href="#local-6989586621681323548"><span class="hs-identifier hs-type">membership</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1513"></span><span>    </span><span id="local-6989586621681323548"><span class="annot"><span class="annottext">membership :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681323548"><span class="hs-identifier hs-var hs-var">membership</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {a}. [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621681323538"><span class="hs-identifier hs-var">sortMembership</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1514"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681323537"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323537"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323537"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681323537"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UniqSet FieldLabelString]
</span><a href="#local-6989586621681323536"><span class="hs-identifier hs-var">fieldLabelSets</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1515"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FieldLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsRecField' GhcTc (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681323562"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span>    </span><span class="annot"><a href="#local-6989586621681323536"><span class="hs-identifier hs-type">fieldLabelSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1518"></span><span>    </span><span id="local-6989586621681323536"><span class="annot"><span class="annottext">fieldLabelSets :: [UniqSet FieldLabelString]
</span><a href="#local-6989586621681323536"><span class="hs-identifier hs-var hs-var">fieldLabelSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681323561"><span class="hs-identifier hs-var">data_cons</span></a></span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span>    </span><span class="hs-comment">-- Sort in order of increasing number of True, so that a smaller</span><span>
</span><span id="line-1521"></span><span>    </span><span class="hs-comment">-- conflicting set can be found.</span><span>
</span><span id="line-1522"></span><span>    </span><span id="local-6989586621681323538"><span class="annot"><span class="annottext">sortMembership :: [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621681323538"><span class="hs-identifier hs-var hs-var">sortMembership</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1523"></span><span>      </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-1524"></span><span>      </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/Data-Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-1525"></span><span>      </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681323532"><span class="annot"><span class="annottext">item :: (a, [Bool])
</span><a href="#local-6989586621681323532"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323531"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681323531"><span class="hs-identifier hs-var">membershipRow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Int
</span><a href="#local-6989586621681323530"><span class="hs-identifier hs-var">countTrue</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681323531"><span class="hs-identifier hs-var">membershipRow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, [Bool])
</span><a href="#local-6989586621681323532"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>
</span><span id="line-1527"></span><span>    </span><span id="local-6989586621681323530"><span class="annot"><span class="annottext">countTrue :: [Bool] -&gt; Int
</span><a href="#local-6989586621681323530"><span class="hs-identifier hs-var hs-var">countTrue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; Int
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span class="hs-comment">{-
Note [Finding the conflicting fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  data A = A {a0, a1 :: Int}
         | B {b0, b1 :: Int}
and we see a record update
  x { a0 = 3, a1 = 2, b0 = 4, b1 = 5 }
Then we'd like to find the smallest subset of fields that no
constructor has all of.  Here, say, {a0,b0}, or {a0,b1}, etc.
We don't really want to report that no constructor has all of
{a0,a1,b0,b1}, because when there are hundreds of fields it's
hard to see what was really wrong.

We may need more than two fields, though; eg
  data T = A { x,y :: Int, v::Int }
          | B { y,z :: Int, v::Int }
          | C { z,x :: Int, v::Int }
with update
   r { x=e1, y=e2, z=e3 }, we

Finding the smallest subset is hard, so the code here makes
a decent stab, no more.  See #7989.
-}</span><span>
</span><span id="line-1553"></span><span>
</span><span id="line-1554"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-type">mixedSelectors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1555"></span><span id="mixedSelectors"><span class="annot"><span class="annottext">mixedSelectors :: [Var] -&gt; [Var] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var hs-var">mixedSelectors</span></a></span></span><span> </span><span id="local-6989586621681323526"><span class="annot"><span class="annottext">data_sels :: [Var]
</span><a href="#local-6989586621681323526"><span class="hs-identifier hs-var">data_sels</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681323525"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323525"><span class="hs-identifier hs-var">dc_rep_id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681323524"><span class="annot"><span class="annottext">pat_syn_sels :: [Var]
</span><a href="#local-6989586621681323524"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681323523"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323523"><span class="hs-identifier hs-var">ps_rep_id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a></span><span>
</span><span id="line-1557"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot use a mixture of pattern synonym and record selectors&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1558"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Record selectors defined by&quot;</span></span><span>
</span><span id="line-1559"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323521"><span class="hs-identifier hs-var">rep_dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1560"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-1561"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681323526"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1562"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pattern synonym selectors defined by&quot;</span></span><span>
</span><span id="line-1563"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn -&gt; Name
</span><a href="GHC.Core.PatSyn.html#patSynName"><span class="hs-identifier hs-var">patSynName</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681323518"><span class="hs-identifier hs-var">rep_ps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1564"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-1565"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681323524"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span>
</span><span id="line-1566"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1567"></span><span>    </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelPatSyn"><span class="hs-identifier hs-type">RecSelPatSyn</span></a></span><span> </span><span id="local-6989586621681323518"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681323518"><span class="hs-identifier hs-var">rep_ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RecSelParent
</span><a href="GHC.Types.Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323523"><span class="hs-identifier hs-var">ps_rep_id</span></a></span><span>
</span><span id="line-1568"></span><span>    </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621681323521"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681323521"><span class="hs-identifier hs-var">rep_dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RecSelParent
</span><a href="GHC.Types.Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323525"><span class="hs-identifier hs-var">dc_rep_id</span></a></span><span>
</span><span id="line-1569"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var">mixedSelectors</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: mixedSelectors emptylists&quot;</span></span><span>
</span><span id="line-1570"></span><span>
</span><span id="line-1571"></span><span>
</span><span id="line-1572"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-type">missingStrictFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1573"></span><span id="missingStrictFields"><span class="annot"><span class="annottext">missingStrictFields :: ConLike -&gt; [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-var hs-var">missingStrictFields</span></a></span></span><span> </span><span id="local-6989586621681323516"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323516"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681323515"><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323515"><span class="hs-identifier hs-var">fields</span></a></span></span><span>
</span><span id="line-1574"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323514"><span class="hs-identifier hs-var">header</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323512"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1575"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1576"></span><span>    </span><span id="local-6989586621681323507"><span class="annot"><span class="annottext">pprField :: (a, a) -&gt; SDoc
</span><a href="#local-6989586621681323507"><span class="hs-identifier hs-var hs-var">pprField</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323506"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323506"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323505"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323505"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323506"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323505"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1577"></span><span>    </span><span id="local-6989586621681323512"><span class="annot"><span class="annottext">rest :: SDoc
</span><a href="#local-6989586621681323512"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323515"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>  </span><span class="hs-comment">-- Happens for non-record constructors</span><span>
</span><span id="line-1578"></span><span>                                           </span><span class="hs-comment">-- with strict fields</span><span>
</span><span id="line-1579"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. (Outputable a, Outputable a) =&gt; (a, a) -&gt; SDoc
</span><a href="#local-6989586621681323507"><span class="hs-identifier hs-var">pprField</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323515"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span>    </span><span id="local-6989586621681323514"><span class="annot"><span class="annottext">header :: SDoc
</span><a href="#local-6989586621681323514"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323516"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1582"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;does not have the required strict field(s)&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-1583"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323515"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-type">missingFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1586"></span><span id="missingFields"><span class="annot"><span class="annottext">missingFields :: ConLike -&gt; [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-var hs-var">missingFields</span></a></span></span><span> </span><span id="local-6989586621681323503"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323503"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681323502"><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323502"><span class="hs-identifier hs-var">fields</span></a></span></span><span>
</span><span id="line-1587"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323501"><span class="hs-identifier hs-var">header</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323500"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1588"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1589"></span><span>    </span><span id="local-6989586621681323495"><span class="annot"><span class="annottext">pprField :: (a, a) -&gt; SDoc
</span><a href="#local-6989586621681323495"><span class="hs-identifier hs-var hs-var">pprField</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323494"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323494"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681323493"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323493"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323494"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;::&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681323493"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1590"></span><span>    </span><span id="local-6989586621681323500"><span class="annot"><span class="annottext">rest :: SDoc
</span><a href="#local-6989586621681323500"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323502"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-1591"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. (Outputable a, Outputable a) =&gt; (a, a) -&gt; SDoc
</span><a href="#local-6989586621681323495"><span class="hs-identifier hs-var">pprField</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323502"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1592"></span><span>    </span><span id="local-6989586621681323501"><span class="annot"><span class="annottext">header :: SDoc
</span><a href="#local-6989586621681323501"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Fields of&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681323503"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1593"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not initialised&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-1594"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681323502"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="hs-comment">-- callCtxt fun args = text &quot;In the call&quot; &lt;+&gt; parens (ppr (foldl' mkHsApp fun args))</span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#noPossibleParents"><span class="hs-identifier hs-type">noPossibleParents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1599"></span><span id="noPossibleParents"><span class="annot"><span class="annottext">noPossibleParents :: [LHsRecUpdField GhcRn] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#noPossibleParents"><span class="hs-identifier hs-var hs-var">noPossibleParents</span></a></span></span><span> </span><span id="local-6989586621681323492"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323492"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span>
</span><span id="line-1600"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No type has all these fields:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (AmbiguousFieldOcc GhcRn)]
</span><a href="#local-6989586621681323491"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1602"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1603"></span><span>    </span><span id="local-6989586621681323491"><span class="annot"><span class="annottext">fields :: [Located (AmbiguousFieldOcc GhcRn)]
</span><a href="#local-6989586621681323491"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="Language.Haskell.Syntax.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681323492"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-1604"></span><span>
</span><span id="line-1605"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#badOverloadedUpdate"><span class="hs-identifier hs-type">badOverloadedUpdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1606"></span><span id="badOverloadedUpdate"><span class="annot"><span class="annottext">badOverloadedUpdate :: SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badOverloadedUpdate"><span class="hs-identifier hs-var hs-var">badOverloadedUpdate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Record update is ambiguous, and requires a type signature&quot;</span></span><span>
</span><span id="line-1607"></span><span>
</span><span id="line-1608"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Static Pointers}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1615"></span><span>
</span><span id="line-1616"></span><span class="hs-comment">-- | A data type to describe why a variable is not closed.</span><span>
</span><span id="line-1617"></span><span class="hs-keyword">data</span><span> </span><span id="NotClosedReason"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-var">NotClosedReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NotLetBoundReason"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotLetBoundReason"><span class="hs-identifier hs-var">NotLetBoundReason</span></a></span></span><span>
</span><span id="line-1618"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="NotTypeClosed"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotTypeClosed"><span class="hs-identifier hs-var">NotTypeClosed</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span>
</span><span id="line-1619"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="NotClosed"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-var">NotClosed</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span class="hs-comment">-- | Checks if the given name is closed and emits an error if not.</span><span>
</span><span id="line-1622"></span><span class="hs-comment">--</span><span>
</span><span id="line-1623"></span><span class="hs-comment">-- See Note [Not-closed error messages].</span><span>
</span><span id="line-1624"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-type">checkClosedInStaticForm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1625"></span><span id="checkClosedInStaticForm"><span class="annot"><span class="annottext">checkClosedInStaticForm :: Name -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-var hs-var">checkClosedInStaticForm</span></a></span></span><span> </span><span id="local-6989586621681323487"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323487"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1626"></span><span>    </span><span id="local-6989586621681323486"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681323486"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcTypeEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var">getLclTypeEnv</span></a></span><span>
</span><span id="line-1627"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681323484"><span class="hs-identifier hs-var">checkClosed</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681323486"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323487"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1628"></span><span>      </span><span class="annot"><span class="annottext">Maybe NotClosedReason
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1629"></span><span>      </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323483"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323483"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NotClosedReason -&gt; SDoc
</span><a href="#local-6989586621681323482"><span class="hs-identifier hs-var">explain</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323487"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323483"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1630"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1631"></span><span>    </span><span class="hs-comment">-- See Note [Checking closedness].</span><span>
</span><span id="line-1632"></span><span>    </span><span class="annot"><a href="#local-6989586621681323484"><span class="hs-identifier hs-type">checkClosed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-1633"></span><span>    </span><span id="local-6989586621681323484"><span class="annot"><span class="annottext">checkClosed :: TcTypeEnv -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681323484"><span class="hs-identifier hs-var hs-var">checkClosed</span></a></span></span><span> </span><span id="local-6989586621681323481"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681323481"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621681323480"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323480"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; NameSet -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681323479"><span class="hs-identifier hs-var">checkLoop</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681323481"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#unitNameSet"><span class="hs-identifier hs-var">unitNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323480"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323480"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1634"></span><span>
</span><span id="line-1635"></span><span>    </span><span class="annot"><a href="#local-6989586621681323479"><span class="hs-identifier hs-type">checkLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-1636"></span><span>    </span><span id="local-6989586621681323479"><span class="annot"><span class="annottext">checkLoop :: TcTypeEnv -&gt; NameSet -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681323479"><span class="hs-identifier hs-var hs-var">checkLoop</span></a></span></span><span> </span><span id="local-6989586621681323477"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681323477"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621681323476"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621681323476"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span id="local-6989586621681323475"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323475"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1637"></span><span>      </span><span class="hs-comment">-- The @visited@ set is an accumulating parameter that contains the set of</span><span>
</span><span id="line-1638"></span><span>      </span><span class="hs-comment">-- visited nodes, so we avoid repeating cycles in the traversal.</span><span>
</span><span id="line-1639"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681323477"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323475"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1640"></span><span>        </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Var
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681323471"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323471"><span class="hs-identifier hs-var">tcid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tct_info :: TcTyThing -&gt; IdBindingInfo
</span><a href="GHC.Tc.Types.html#tct_info"><span class="hs-identifier hs-var">tct_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681323469"><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="#local-6989586621681323469"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="#local-6989586621681323469"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1641"></span><span>          </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.html#ClosedLet"><span class="hs-identifier hs-var">ClosedLet</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1642"></span><span>          </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.html#NotLetBound"><span class="hs-identifier hs-var">NotLetBound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotLetBoundReason"><span class="hs-identifier hs-var">NotLetBoundReason</span></a></span><span>
</span><span id="line-1643"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#NonClosedLet"><span class="hs-identifier hs-type">NonClosedLet</span></a></span><span> </span><span id="local-6989586621681323465"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621681323465"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681323464"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681323464"><span class="hs-identifier hs-var">type_closed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/Data-Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1644"></span><span>            </span><span class="hs-comment">-- Look for a non-closed variable in fvs</span><span>
</span><span id="line-1645"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NotClosedReason -&gt; NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-var">NotClosed</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323462"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323461"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1646"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681323462"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323462"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; [Name]
</span><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621681323465"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-1647"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323462"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621681323476"><span class="hs-identifier hs-var">visited</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681323461"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323461"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTypeEnv -&gt; NameSet -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681323479"><span class="hs-identifier hs-var">checkLoop</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681323477"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet -&gt; Name -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621681323476"><span class="hs-identifier hs-var">visited</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323462"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323462"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1649"></span><span>            </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1650"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681323464"><span class="hs-identifier hs-var">type_closed</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1651"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1652"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-1653"></span><span>              </span><span class="hs-comment">-- We consider non-let-bound variables easier to figure out than</span><span>
</span><span id="line-1654"></span><span>              </span><span class="hs-comment">-- non-closed types, so we report non-closed types to the user</span><span>
</span><span id="line-1655"></span><span>              </span><span class="hs-comment">-- only if we cannot spot the former.</span><span>
</span><span id="line-1656"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotTypeClosed"><span class="hs-identifier hs-var">NotTypeClosed</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681323471"><span class="hs-identifier hs-var">tcid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1657"></span><span>        </span><span class="hs-comment">-- The binding is closed.</span><span>
</span><span id="line-1658"></span><span>        </span><span class="annot"><span class="annottext">Maybe TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1659"></span><span>
</span><span id="line-1660"></span><span>    </span><span class="hs-comment">-- Converts a reason into a human-readable sentence.</span><span>
</span><span id="line-1661"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1662"></span><span>    </span><span class="hs-comment">-- @explain name reason@ starts with</span><span>
</span><span id="line-1663"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1664"></span><span>    </span><span class="hs-comment">-- &quot;&lt;name&gt; is used in a static form but it is not closed because it&quot;</span><span>
</span><span id="line-1665"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1666"></span><span>    </span><span class="hs-comment">-- and then follows a list of causes. For each id in the path, the text</span><span>
</span><span id="line-1667"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1668"></span><span>    </span><span class="hs-comment">-- &quot;uses &lt;id&gt; which&quot;</span><span>
</span><span id="line-1669"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1670"></span><span>    </span><span class="hs-comment">-- is appended, yielding something like</span><span>
</span><span id="line-1671"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1672"></span><span>    </span><span class="hs-comment">-- &quot;uses &lt;id&gt; which uses &lt;id1&gt; which uses &lt;id2&gt; which&quot;</span><span>
</span><span id="line-1673"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1674"></span><span>    </span><span class="hs-comment">-- until the end of the path is reached, which is reported as either</span><span>
</span><span id="line-1675"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1676"></span><span>    </span><span class="hs-comment">-- &quot;is not let-bound&quot;</span><span>
</span><span id="line-1677"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1678"></span><span>    </span><span class="hs-comment">-- when the final node is not let-bound, or</span><span>
</span><span id="line-1679"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1680"></span><span>    </span><span class="hs-comment">-- &quot;has a non-closed type because it contains the type variables:</span><span>
</span><span id="line-1681"></span><span>    </span><span class="hs-comment">-- v1, v2, v3&quot;</span><span>
</span><span id="line-1682"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1683"></span><span>    </span><span class="hs-comment">-- when the final node has a non-closed type.</span><span>
</span><span id="line-1684"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1685"></span><span>    </span><span class="annot"><a href="#local-6989586621681323482"><span class="hs-identifier hs-type">explain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1686"></span><span>    </span><span id="local-6989586621681323482"><span class="annot"><span class="annottext">explain :: Name -&gt; NotClosedReason -&gt; SDoc
</span><a href="#local-6989586621681323482"><span class="hs-identifier hs-var hs-var">explain</span></a></span></span><span> </span><span id="local-6989586621681323456"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323456"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681323455"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323455"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1687"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323456"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is used in a static form but it is not closed&quot;</span></span><span>
</span><span id="line-1688"></span><span>                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;because it&quot;</span></span><span>
</span><span id="line-1689"></span><span>                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1690"></span><span>                        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681323454"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323455"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1691"></span><span>
</span><span id="line-1692"></span><span>    </span><span class="annot"><a href="#local-6989586621681323454"><span class="hs-identifier hs-type">causes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1693"></span><span>    </span><span id="local-6989586621681323454"><span class="annot"><span class="annottext">causes :: NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681323454"><span class="hs-identifier hs-var hs-var">causes</span></a></span></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotLetBoundReason"><span class="hs-identifier hs-var">NotLetBoundReason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not let-bound.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1694"></span><span>    </span><span class="annot"><a href="#local-6989586621681323454"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotTypeClosed"><span class="hs-identifier hs-type">NotTypeClosed</span></a></span><span> </span><span id="local-6989586621681323453"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681323453"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1695"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has a non-closed type because it contains the&quot;</span></span><span>
</span><span id="line-1696"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type variables:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1697"></span><span>        </span><span class="annot"><span class="annottext">VarSet -&gt; ([Var] -&gt; SDoc) -&gt; SDoc
</span><a href="GHC.Types.Var.Set.html#pprVarSet"><span class="hs-identifier hs-var">pprVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681323453"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1698"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1699"></span><span>    </span><span class="annot"><a href="#local-6989586621681323454"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-type">NotClosed</span></a></span><span> </span><span id="local-6989586621681323448"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323448"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681323447"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323447"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1700"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681323446"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681323446"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uses&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681323448"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;which&quot;</span></span><span>
</span><span id="line-1701"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323447"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1702"></span><span>            </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-type">NotClosed</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323446"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681323454"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323447"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1703"></span><span>            </span><span class="annot"><span class="annottext">NotClosedReason
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681323445"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681323445"><span class="hs-identifier hs-var">xs0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681323444"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681323444"><span class="hs-identifier hs-var">xs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681323454"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681323447"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1704"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681323446"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681323445"><span class="hs-identifier hs-var">xs0</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681323444"><span class="hs-identifier hs-var">xs1</span></a></span><span>
</span><span id="line-1705"></span><span>
</span><span id="line-1706"></span><span class="hs-comment">-- Note [Not-closed error messages]</span><span>
</span><span id="line-1707"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1708"></span><span class="hs-comment">--</span><span>
</span><span id="line-1709"></span><span class="hs-comment">-- When variables in a static form are not closed, we go through the trouble</span><span>
</span><span id="line-1710"></span><span class="hs-comment">-- of explaining why they aren't.</span><span>
</span><span id="line-1711"></span><span class="hs-comment">--</span><span>
</span><span id="line-1712"></span><span class="hs-comment">-- Thus, the following program</span><span>
</span><span id="line-1713"></span><span class="hs-comment">--</span><span>
</span><span id="line-1714"></span><span class="hs-comment">-- &gt; {-# LANGUAGE StaticPointers #-}</span><span>
</span><span id="line-1715"></span><span class="hs-comment">-- &gt; module M where</span><span>
</span><span id="line-1716"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-1717"></span><span class="hs-comment">-- &gt; f x = static g</span><span>
</span><span id="line-1718"></span><span class="hs-comment">-- &gt;   where</span><span>
</span><span id="line-1719"></span><span class="hs-comment">-- &gt;     g = h</span><span>
</span><span id="line-1720"></span><span class="hs-comment">-- &gt;     h = x</span><span>
</span><span id="line-1721"></span><span class="hs-comment">--</span><span>
</span><span id="line-1722"></span><span class="hs-comment">-- produces the error</span><span>
</span><span id="line-1723"></span><span class="hs-comment">--</span><span>
</span><span id="line-1724"></span><span class="hs-comment">--    'g' is used in a static form but it is not closed because it</span><span>
</span><span id="line-1725"></span><span class="hs-comment">--    uses 'h' which uses 'x' which is not let-bound.</span><span>
</span><span id="line-1726"></span><span class="hs-comment">--</span><span>
</span><span id="line-1727"></span><span class="hs-comment">-- And a program like</span><span>
</span><span id="line-1728"></span><span class="hs-comment">--</span><span>
</span><span id="line-1729"></span><span class="hs-comment">-- &gt; {-# LANGUAGE StaticPointers #-}</span><span>
</span><span id="line-1730"></span><span class="hs-comment">-- &gt; module M where</span><span>
</span><span id="line-1731"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-1732"></span><span class="hs-comment">-- &gt; import Data.Typeable</span><span>
</span><span id="line-1733"></span><span class="hs-comment">-- &gt; import GHC.StaticPtr</span><span>
</span><span id="line-1734"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- &gt; f :: Typeable a =&gt; a -&gt; StaticPtr TypeRep</span><span>
</span><span id="line-1736"></span><span class="hs-comment">-- &gt; f x = const (static (g undefined)) (h x)</span><span>
</span><span id="line-1737"></span><span class="hs-comment">-- &gt;   where</span><span>
</span><span id="line-1738"></span><span class="hs-comment">-- &gt;     g = h</span><span>
</span><span id="line-1739"></span><span class="hs-comment">-- &gt;     h = typeOf</span><span>
</span><span id="line-1740"></span><span class="hs-comment">--</span><span>
</span><span id="line-1741"></span><span class="hs-comment">-- produces the error</span><span>
</span><span id="line-1742"></span><span class="hs-comment">--</span><span>
</span><span id="line-1743"></span><span class="hs-comment">--    'g' is used in a static form but it is not closed because it</span><span>
</span><span id="line-1744"></span><span class="hs-comment">--    uses 'h' which has a non-closed type because it contains the</span><span>
</span><span id="line-1745"></span><span class="hs-comment">--    type variables: 'a'</span><span>
</span><span id="line-1746"></span><span class="hs-comment">--</span><span>
</span><span id="line-1747"></span><span>
</span><span id="line-1748"></span><span class="hs-comment">-- Note [Checking closedness]</span><span>
</span><span id="line-1749"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1750"></span><span class="hs-comment">--</span><span>
</span><span id="line-1751"></span><span class="hs-comment">-- @checkClosed@ checks if a binding is closed and returns a reason if it is</span><span>
</span><span id="line-1752"></span><span class="hs-comment">-- not.</span><span>
</span><span id="line-1753"></span><span class="hs-comment">--</span><span>
</span><span id="line-1754"></span><span class="hs-comment">-- The bindings define a graph where the nodes are ids, and there is an edge</span><span>
</span><span id="line-1755"></span><span class="hs-comment">-- from @id1@ to @id2@ if the rhs of @id1@ contains @id2@ among its free</span><span>
</span><span id="line-1756"></span><span class="hs-comment">-- variables.</span><span>
</span><span id="line-1757"></span><span class="hs-comment">--</span><span>
</span><span id="line-1758"></span><span class="hs-comment">-- When @n@ is not closed, it has to exist in the graph some node reachable</span><span>
</span><span id="line-1759"></span><span class="hs-comment">-- from @n@ that it is not a let-bound variable or that it has a non-closed</span><span>
</span><span id="line-1760"></span><span class="hs-comment">-- type. Thus, the &quot;reason&quot; is a path from @n@ to this offending node.</span><span>
</span><span id="line-1761"></span><span class="hs-comment">--</span><span>
</span><span id="line-1762"></span><span class="hs-comment">-- When @n@ is not closed, we traverse the graph reachable from @n@ to build</span><span>
</span><span id="line-1763"></span><span class="hs-comment">-- the reason.</span><span>
</span><span id="line-1764"></span><span class="hs-comment">--</span><span>
</span><span id="line-1765"></span></pre></body></html>
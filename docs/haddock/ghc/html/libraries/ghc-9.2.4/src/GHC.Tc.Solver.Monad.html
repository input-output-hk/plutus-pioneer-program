<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, DeriveFunctor, TypeFamilies, ScopedTypeVariables, TypeApplications,
             DerivingStrategies, GeneralizedNewtypeDeriving, ScopedTypeVariables, MultiWayIf, ViewPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-record-updates -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Type definitions for the constraint solver</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Solver.Monad</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-comment">-- The work list</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier">WorkList</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isEmptyWorkList"><span class="hs-identifier">isEmptyWorkList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier">emptyWorkList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListNonEq"><span class="hs-identifier">extendWorkListNonEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListCt"><span class="hs-identifier">extendWorkListCt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListCts"><span class="hs-identifier">extendWorkListCts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListEq"><span class="hs-identifier">extendWorkListEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#appendWorkList"><span class="hs-identifier">appendWorkList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#selectNextWorkItem"><span class="hs-identifier">selectNextWorkItem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#workListSize"><span class="hs-identifier">workListSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getWorkList"><span class="hs-identifier">getWorkList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier">updWorkListTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier">pushLevelNoWorkList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-comment">-- The TcS monad</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier">TcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcS"><span class="hs-identifier">runTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSDeriveds"><span class="hs-identifier">runTcSDeriveds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier">runTcSWithEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSInerts"><span class="hs-identifier">runTcSInerts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#failTcS"><span class="hs-identifier">failTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#warnTcS"><span class="hs-identifier">warnTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addErrTcS"><span class="hs-identifier">addErrTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier">wrapTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSEqualities"><span class="hs-identifier">runTcSEqualities</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestTcS"><span class="hs-identifier">nestTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestImplicTcS"><span class="hs-identifier">nestImplicTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindsTcS"><span class="hs-identifier">setEvBindsTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier">emitImplicationTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitTvImplicationTcS"><span class="hs-identifier">emitTvImplicationTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcPluginTcS"><span class="hs-identifier">runTcPluginTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addUsedGRE"><span class="hs-identifier">addUsedGRE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addUsedGREs"><span class="hs-identifier">addUsedGREs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#keepAlive"><span class="hs-identifier">keepAlive</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchGlobalInst"><span class="hs-identifier">matchGlobalInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier">TcM.ClsInstResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier">QCInst</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-comment">-- Tracing etc</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#panicTcS"><span class="hs-identifier">panicTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier">traceTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-identifier">traceFireTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#bumpStepCountTcS"><span class="hs-identifier">bumpStepCountTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier">csTraceTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier">wrapErrTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapWarnTcS"><span class="hs-identifier">wrapWarnTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#resetUnificationFlag"><span class="hs-identifier">resetUnificationFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setUnificationFlag"><span class="hs-identifier">setUnificationFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-comment">-- Evidence creation and transformation</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier">MaybeNew</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#freshGoals"><span class="hs-identifier">freshGoals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier">isFresh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier">getEvExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcEvBinds"><span class="hs-identifier">newTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newNoTcEvBinds"><span class="hs-identifier">newNoTcEvBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier">newWantedEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEq_SI"><span class="hs-identifier">newWantedEq_SI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier">emitNewWantedEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier">newWanted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWanted_SI"><span class="hs-identifier">newWanted_SI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar"><span class="hs-identifier">newWantedEvVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedNC"><span class="hs-identifier">newWantedNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier">newWantedEvVarNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newDerivedNC"><span class="hs-identifier">newDerivedNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier">newBoundEvVarId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyTyVar"><span class="hs-identifier">unifyTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#reportUnifications"><span class="hs-identifier">reportUnifications</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#touchabilityTest"><span class="hs-identifier">touchabilityTest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TouchabilityTestResult"><span class="hs-identifier">TouchabilityTestResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier">setEvBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier">setWantedEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier">setWantedEvTerm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier">setEvBindIfWanted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier">newEvVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier">newGivenEvVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newGivenEvVars"><span class="hs-identifier">newGivenEvVars</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewDeriveds"><span class="hs-identifier">emitNewDeriveds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewDerivedEq"><span class="hs-identifier">emitNewDerivedEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkReductionDepth"><span class="hs-identifier">checkReductionDepth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSolvedDicts"><span class="hs-identifier">getSolvedDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setSolvedDicts"><span class="hs-identifier">setSolvedDicts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInstEnvs"><span class="hs-identifier">getInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getFamInstEnvs"><span class="hs-identifier">getFamInstEnvs</span></a></span><span class="hs-special">,</span><span>                </span><span class="hs-comment">-- Getting the environments</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTopEnv"><span class="hs-identifier">getTopEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier">getGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getLclEnv"><span class="hs-identifier">getLclEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier">getTcEvBindsVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier">getTcLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvTyCoVars"><span class="hs-identifier">getTcEvTyCoVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsMap"><span class="hs-identifier">getTcEvBindsMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setTcEvBindsMap"><span class="hs-identifier">setTcEvBindsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupClass"><span class="hs-identifier">tcLookupClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupId"><span class="hs-identifier">tcLookupId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- Inerts</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier">InertSet</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier">InertCans</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyInert"><span class="hs-identifier">emptyInert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier">updInertTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier">updInertCans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertDicts"><span class="hs-identifier">updInertDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertIrreds"><span class="hs-identifier">updInertIrreds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getHasGivenEqs"><span class="hs-identifier">getHasGivenEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier">setInertCans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertEqs"><span class="hs-identifier">getInertEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier">getInertCans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier">getInertGivens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertInsols"><span class="hs-identifier">getInertInsols</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInnermostGivenEqLevel"><span class="hs-identifier">getInnermostGivenEqLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier">getTcSInerts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setTcSInerts"><span class="hs-identifier">setTcSInerts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchableGivens"><span class="hs-identifier">matchableGivens</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#prohibitedSuperClassSolve"><span class="hs-identifier">prohibitedSuperClassSolve</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#mightEqualLater"><span class="hs-identifier">mightEqualLater</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getUnsolvedInerts"><span class="hs-identifier">getUnsolvedInerts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#removeInertCts"><span class="hs-identifier">removeInertCts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getPendingGivenScs"><span class="hs-identifier">getPendingGivenScs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertCan"><span class="hs-identifier">addInertCan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertFunEq"><span class="hs-identifier">insertFunEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier">addInertForAll</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier">emitWorkNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier">emitWork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isImprovable"><span class="hs-identifier">isImprovable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-comment">-- The Model</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier">kickOutAfterUnification</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- Inert Safe Haskell safe-overlap failures</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier">addInertSafehask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier">insertSafeOverlapFailureTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSafehask"><span class="hs-identifier">updInertSafehask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSafeOverlapFailures"><span class="hs-identifier">getSafeOverlapFailures</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- Inert CDictCans</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier">DictMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyDictMap"><span class="hs-identifier">emptyDictMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier">lookupInertDict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findDictsByClass"><span class="hs-identifier">findDictsByClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addDict"><span class="hs-identifier">addDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addDictsByClass"><span class="hs-identifier">addDictsByClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#delDict"><span class="hs-identifier">delDict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldDicts"><span class="hs-identifier">foldDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#filterDicts"><span class="hs-identifier">filterDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findDict"><span class="hs-identifier">findDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-comment">-- Inert CEqCans</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier">EqualCtList</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findTyEqs"><span class="hs-identifier">findTyEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldTyEqs"><span class="hs-identifier">foldTyEqs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findEq"><span class="hs-identifier">findEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-comment">-- Inert solved dictionaries</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addSolvedDict"><span class="hs-identifier">addSolvedDict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier">lookupSolvedDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-comment">-- Irreds</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldIrreds"><span class="hs-identifier">foldIrreds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-comment">-- The family application cache</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppInert"><span class="hs-identifier">lookupFamAppInert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppCache"><span class="hs-identifier">lookupFamAppCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendFamAppCache"><span class="hs-identifier">extendFamAppCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier">pprKicked</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-comment">-- Inert function equalities</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findFunEq"><span class="hs-identifier">findFunEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findFunEqsByTyCon"><span class="hs-identifier">findFunEqsByTyCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instDFunType"><span class="hs-identifier">instDFunType</span></a></span><span class="hs-special">,</span><span>                              </span><span class="hs-comment">-- Instantiation</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- MetaTyVars</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newFlexiTcSTy"><span class="hs-identifier">newFlexiTcSTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexi"><span class="hs-identifier">instFlexi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiX"><span class="hs-identifier">instFlexiX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#cloneMetaTyVar"><span class="hs-identifier">cloneMetaTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier">tcInstSkolTyVarsX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier">TcLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier">isFilledMetaTyVar_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar"><span class="hs-identifier">isFilledMetaTyVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFV"><span class="hs-identifier">zonkTyCoVarsAndFV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcType"><span class="hs-identifier">zonkTcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTypes"><span class="hs-identifier">zonkTcTypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTyVar"><span class="hs-identifier">zonkTcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkCo"><span class="hs-identifier">zonkCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFVList"><span class="hs-identifier">zonkTyCoVarsAndFVList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkSimples"><span class="hs-identifier">zonkSimples</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkWC"><span class="hs-identifier">zonkWC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarKind"><span class="hs-identifier">zonkTyCoVarKind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- References</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcRef"><span class="hs-identifier">newTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier">readTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier">writeTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier">updTcRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- Misc</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getDefaultInfo"><span class="hs-identifier">getDefaultInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier">getGlobalRdrEnvTcS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFam"><span class="hs-identifier">matchFam</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier">matchFamTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkWellStagedDFun"><span class="hs-identifier">checkWellStagedDFun</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprEq"><span class="hs-identifier">pprEq</span></a></span><span class="hs-special">,</span><span>                                   </span><span class="hs-comment">-- Smaller utils, re-exported from TcM</span><span>
</span><span id="line-123"></span><span>                                             </span><span class="hs-comment">-- TODO (DV): these are only really used in the</span><span>
</span><span id="line-124"></span><span>                                             </span><span class="hs-comment">-- instance matcher in GHC.Tc.Solver. I am wondering</span><span>
</span><span id="line-125"></span><span>                                             </span><span class="hs-comment">-- if the whole instance matcher simply belongs</span><span>
</span><span id="line-126"></span><span>                                             </span><span class="hs-comment">-- here</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#breakTyEqCycle_maybe"><span class="hs-identifier">breakTyEqCycle_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#rewriterView"><span class="hs-identifier">rewriterView</span></a></span><span>
</span><span id="line-129"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FamInst</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html"><span class="hs-identifier">GHC.Tc.Instance.Class</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#matchGlobalInst"><span class="hs-identifier">matchGlobalInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier">ClsInstResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-146"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#checkWellStaged"><span class="hs-identifier">checkWellStaged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcGetDefaultTys"><span class="hs-identifier">tcGetDefaultTys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier">tcLookupClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier">tcLookupId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#topIdLvl"><span class="hs-identifier">topIdLvl</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html"><span class="hs-identifier">GHC.Tc.Instance.Class</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#InstanceWhat"><span class="hs-identifier">InstanceWhat</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier">safeOverlap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier">instanceReturnsDictCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#canSolveByUnification"><span class="hs-identifier">canSolveByUnification</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rep</span></span><span>  </span><span class="hs-comment">-- this needs to be used only very locally</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unify.html"><span class="hs-identifier">GHC.Core.Unify</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.html"><span class="hs-identifier">GHC.Tc.Errors</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.html#solverDepthErrorTcS"><span class="hs-identifier">solverDepthErrorTcS</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#HasModule"><span class="hs-identifier">HasModule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier">getModule</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier">GlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier">GlobalRdrElt</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcM</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bag</span></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.Env.html"><span class="hs-identifier">GHC.Core.TyCon.Env</span></a></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html"><span class="hs-identifier">GHC.Core.Map.Type</span></a></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html"><span class="hs-identifier">GHC.Data.TrieMap</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-189"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-IORef.html#"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-190"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Exts.html#"><span class="hs-identifier">GHC.Exts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">oneShot</span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List.html#"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapAccumL"><span class="hs-identifier">mapAccumL</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#NonEmpty"><span class="hs-identifier">NonEmpty</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#cons"><span class="hs-identifier">cons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#toList"><span class="hs-identifier">toList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#nonEmpty"><span class="hs-identifier">nonEmpty</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-194"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Arrow.html#"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Arrow.html#first"><span class="hs-identifier">first</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-cpp">

#if defined(DEBUG)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Data.Graph.Directed</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-200"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
*                            Worklists                                *
*  Canonical and non-canonical constraints that the simplifier has to  *
*  work on. Including their simplification depths.                     *
*                                                                      *
*                                                                      *
************************************************************************

Note [WorkList priorities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
A WorkList contains canonical and non-canonical items (of all flavours).
Notice that each Ct now has a simplification depth. We may
consider using this depth for prioritization as well in the future.

As a simple form of priority queue, our worklist separates out

* equalities (wl_eqs); see Note [Prioritise equalities]
* all the rest (wl_rest)

Note [Prioritise equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's very important to process equalities /first/:

* (Efficiency)  The general reason to do so is that if we process a
  class constraint first, we may end up putting it into the inert set
  and then kicking it out later.  That's extra work compared to just
  doing the equality first.

* (Avoiding fundep iteration) As #14723 showed, it's possible to
  get non-termination if we
      - Emit the Derived fundep equalities for a class constraint,
        generating some fresh unification variables.
      - That leads to some unification
      - Which kicks out the class constraint
      - Which isn't solved (because there are still some more Derived
        equalities in the work-list), but generates yet more fundeps
  Solution: prioritise derived equalities over class constraints

* (Class equalities) We need to prioritise equalities even if they
  are hidden inside a class constraint;
  see Note [Prioritise class equalities]

* (Kick-out) We want to apply this priority scheme to kicked-out
  constraints too (see the call to extendWorkListCt in kick_out_rewritable
  E.g. a CIrredCan can be a hetero-kinded (t1 ~ t2), which may become
  homo-kinded when kicked out, and hence we want to prioritise it.

* (Derived equalities) Originally we tried to postpone processing
  Derived equalities, in the hope that we might never need to deal
  with them at all; but in fact we must process Derived equalities
  eagerly, partly for the (Efficiency) reason, and more importantly
  for (Avoiding fundep iteration).

Note [Prioritise class equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We prioritise equalities in the solver (see selectWorkItem). But class
constraints like (a ~ b) and (a ~~ b) are actually equalities too;
see Note [The equality types story] in GHC.Builtin.Types.Prim.

Failing to prioritise these is inefficient (more kick-outs etc).
But, worse, it can prevent us spotting a &quot;recursive knot&quot; among
Wanted constraints.  See comment:10 of #12734 for a worked-out
example.

So we arrange to put these particular class constraints in the wl_eqs.

  NB: since we do not currently apply the substitution to the
  inert_solved_dicts, the knot-tying still seems a bit fragile.
  But this makes it better.

-}</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-comment">-- See Note [WorkList priorities]</span><span>
</span><span id="line-275"></span><span class="hs-keyword">data</span><span> </span><span id="WorkList"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-var">WorkList</span></a></span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="WL"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-var">WL</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="wl_eqs"><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var hs-var">wl_eqs</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- CEqCan, CDictCan, CIrredCan</span><span>
</span><span id="line-277"></span><span>                             </span><span class="hs-comment">-- Given, Wanted, and Derived</span><span>
</span><span id="line-278"></span><span>                       </span><span class="hs-comment">-- Contains both equality constraints and their</span><span>
</span><span id="line-279"></span><span>                       </span><span class="hs-comment">-- class-level variants (a~b) and (a~~b);</span><span>
</span><span id="line-280"></span><span>                       </span><span class="hs-comment">-- See Note [Prioritise equalities]</span><span>
</span><span id="line-281"></span><span>                       </span><span class="hs-comment">-- See Note [Prioritise class equalities]</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="wl_rest"><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var hs-var">wl_rest</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="wl_implics"><span class="annot"><span class="annottext">WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var hs-var">wl_implics</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span>  </span><span class="hs-comment">-- See Note [Residual implications]</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#appendWorkList"><span class="hs-identifier hs-type">appendWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-289"></span><span id="appendWorkList"><span class="annot"><span class="annottext">appendWorkList :: WorkList -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#appendWorkList"><span class="hs-identifier hs-var hs-var">appendWorkList</span></a></span></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333506"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333506"><span class="hs-identifier hs-var">eqs1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333505"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333505"><span class="hs-identifier hs-var">rest1</span></a></span></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333504"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333504"><span class="hs-identifier hs-var">implics1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333503"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333503"><span class="hs-identifier hs-var">eqs2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333502"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333502"><span class="hs-identifier hs-var">rest2</span></a></span></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333501"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333501"><span class="hs-identifier hs-var">implics2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333506"><span class="hs-identifier hs-var">eqs1</span></a></span><span>     </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333503"><span class="hs-identifier hs-var">eqs2</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333505"><span class="hs-identifier hs-var">rest1</span></a></span><span>    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333502"><span class="hs-identifier hs-var">rest2</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333504"><span class="hs-identifier hs-var">implics1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span>   </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333501"><span class="hs-identifier hs-var">implics2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#workListSize"><span class="hs-identifier hs-type">workListSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-299"></span><span id="workListSize"><span class="annot"><span class="annottext">workListSize :: WorkList -&gt; Int
</span><a href="GHC.Tc.Solver.Monad.html#workListSize"><span class="hs-identifier hs-var hs-var">workListSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333499"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333499"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333498"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333498"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333499"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333498"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListEq"><span class="hs-identifier hs-type">extendWorkListEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-303"></span><span id="extendWorkListEq"><span class="annot"><span class="annottext">extendWorkListEq :: Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListEq"><span class="hs-identifier hs-var hs-var">extendWorkListEq</span></a></span></span><span> </span><span id="local-6989586621681333495"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333495"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621681333494"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333494"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333494"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333495"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333494"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListNonEq"><span class="hs-identifier hs-type">extendWorkListNonEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-306"></span><span class="hs-comment">-- Extension by non equality</span><span>
</span><span id="line-307"></span><span id="extendWorkListNonEq"><span class="annot"><span class="annottext">extendWorkListNonEq :: Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListNonEq"><span class="hs-identifier hs-var hs-var">extendWorkListNonEq</span></a></span></span><span> </span><span id="local-6989586621681333493"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333493"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621681333492"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333492"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333492"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_rest :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333493"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333492"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListDeriveds"><span class="hs-identifier hs-type">extendWorkListDeriveds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-310"></span><span id="extendWorkListDeriveds"><span class="annot"><span class="annottext">extendWorkListDeriveds :: [CtEvidence] -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListDeriveds"><span class="hs-identifier hs-var hs-var">extendWorkListDeriveds</span></a></span></span><span> </span><span id="local-6989586621681333490"><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681333490"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621681333489"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333489"><span class="hs-identifier hs-var">wl</span></a></span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListCts"><span class="hs-identifier hs-var">extendWorkListCts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681333490"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333489"><span class="hs-identifier hs-var">wl</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListImplic"><span class="hs-identifier hs-type">extendWorkListImplic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-314"></span><span id="extendWorkListImplic"><span class="annot"><span class="annottext">extendWorkListImplic :: Implication -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListImplic"><span class="hs-identifier hs-var hs-var">extendWorkListImplic</span></a></span></span><span> </span><span id="local-6989586621681333486"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681333486"><span class="hs-identifier hs-var">implic</span></a></span></span><span> </span><span id="local-6989586621681333485"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333485"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333485"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_implics :: Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681333486"><span class="hs-identifier hs-var">implic</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-operator hs-var">`consBag`</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333485"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListCt"><span class="hs-identifier hs-type">extendWorkListCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-317"></span><span class="hs-comment">-- Agnostic</span><span>
</span><span id="line-318"></span><span id="extendWorkListCt"><span class="annot"><span class="annottext">extendWorkListCt :: Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListCt"><span class="hs-identifier hs-var hs-var">extendWorkListCt</span></a></span></span><span> </span><span id="local-6989586621681333483"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333483"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621681333482"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333482"><span class="hs-identifier hs-var">wl</span></a></span></span><span>
</span><span id="line-319"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333483"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>     </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-321"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333483"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333482"><span class="hs-identifier hs-var">wl</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>     </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621681333477"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681333477"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-comment">-- See Note [Prioritise class equalities]</span><span>
</span><span id="line-324"></span><span>       </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqPredClass"><span class="hs-identifier hs-var">isEqPredClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681333477"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-325"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333483"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333482"><span class="hs-identifier hs-var">wl</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>     </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListNonEq"><span class="hs-identifier hs-var">extendWorkListNonEq</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333483"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333482"><span class="hs-identifier hs-var">wl</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendWorkListCts"><span class="hs-identifier hs-type">extendWorkListCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- Agnostic</span><span>
</span><span id="line-331"></span><span id="extendWorkListCts"><span class="annot"><span class="annottext">extendWorkListCts :: [Ct] -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListCts"><span class="hs-identifier hs-var hs-var">extendWorkListCts</span></a></span></span><span> </span><span id="local-6989586621681333475"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333475"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621681333474"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333474"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListCt"><span class="hs-identifier hs-var">extendWorkListCt</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333474"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333475"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isEmptyWorkList"><span class="hs-identifier hs-type">isEmptyWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-334"></span><span id="isEmptyWorkList"><span class="annot"><span class="annottext">isEmptyWorkList :: WorkList -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isEmptyWorkList"><span class="hs-identifier hs-var hs-var">isEmptyWorkList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333472"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333472"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333471"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333471"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333470"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333470"><span class="hs-identifier hs-var">implics</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333472"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333471"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333470"><span class="hs-identifier hs-var">implics</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-type">emptyWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-338"></span><span id="emptyWorkList"><span class="annot"><span class="annottext">emptyWorkList :: WorkList
</span><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-var hs-var">emptyWorkList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#selectWorkItem"><span class="hs-identifier hs-type">selectWorkItem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- See Note [Prioritise equalities]</span><span>
</span><span id="line-342"></span><span id="selectWorkItem"><span class="annot"><span class="annottext">selectWorkItem :: WorkList -&gt; Maybe (Ct, WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#selectWorkItem"><span class="hs-identifier hs-var hs-var">selectWorkItem</span></a></span></span><span> </span><span id="local-6989586621681333464"><span class="annot"><span class="annottext">wl :: WorkList
</span><a href="#local-6989586621681333464"><span class="hs-identifier hs-var">wl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333463"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333463"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333462"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333462"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681333461"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333461"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681333460"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333460"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333463"><span class="hs-identifier hs-var">eqs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333461"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333464"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333460"><span class="hs-identifier hs-var">cts</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681333459"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333459"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681333458"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333458"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333462"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333459"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333464"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_rest :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333458"><span class="hs-identifier hs-var">cts</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getWorkList"><span class="hs-identifier hs-type">getWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-348"></span><span id="getWorkList"><span class="annot"><span class="annottext">getWorkList :: TcS WorkList
</span><a href="GHC.Tc.Solver.Monad.html#getWorkList"><span class="hs-identifier hs-var hs-var">getWorkList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681333457"><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681333457"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-349"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681333457"><span class="hs-identifier hs-var">wl_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#selectNextWorkItem"><span class="hs-identifier hs-type">selectNextWorkItem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- Pick which work item to do next</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- See Note [Prioritise equalities]</span><span>
</span><span id="line-354"></span><span id="selectNextWorkItem"><span class="annot"><span class="annottext">selectNextWorkItem :: TcS (Maybe Ct)
</span><a href="GHC.Tc.Solver.Monad.html#selectNextWorkItem"><span class="hs-identifier hs-var hs-var">selectNextWorkItem</span></a></span></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681333454"><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681333454"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-356"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681333453"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333453"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681333454"><span class="hs-identifier hs-var">wl_var</span></a></span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; Maybe (Ct, WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#selectWorkItem"><span class="hs-identifier hs-var">selectWorkItem</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333453"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-358"></span><span>           </span><span class="annot"><span class="annottext">Maybe (Ct, WorkList)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-359"></span><span>           </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333452"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333452"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333451"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333451"><span class="hs-identifier hs-var">new_wl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- checkReductionDepth (ctLoc ct) (ctPred ct)</span><span>
</span><span id="line-361"></span><span>         </span><span class="hs-comment">-- This is done by GHC.Tc.Solver.Interact.chooseInstance</span><span>
</span><span id="line-362"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcRef a -&gt; a -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681333454"><span class="hs-identifier hs-var">wl_var</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333451"><span class="hs-identifier hs-var">new_wl</span></a></span><span>
</span><span id="line-363"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333452"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-comment">-- Pretty printing</span><span>
</span><span id="line-366"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-367"></span><span>  </span><span id="local-6989586621681333443"><span class="annot"><span class="annottext">ppr :: WorkList -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333441"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333441"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333440"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333440"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333439"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333439"><span class="hs-identifier hs-var">implics</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WL&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-369"></span><span>     </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333441"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Eqs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333441"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333440"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-372"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Non-eqs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333440"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333439"><span class="hs-identifier hs-var">implics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ifPprDebug"><span class="hs-identifier hs-var">ifPprDebug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Implics =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681333439"><span class="hs-identifier hs-var">implics</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(Implics omitted)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                InertSet: the inert set
*                                                                      *
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-keyword">type</span><span> </span><span id="CycleBreakerVarStack"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-identifier hs-var">CycleBreakerVarStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-387"></span><span>   </span><span class="hs-comment">-- ^ a stack of (CycleBreakerTv, original family applications) lists</span><span>
</span><span id="line-388"></span><span>   </span><span class="hs-comment">-- first element in the stack corresponds to current implication;</span><span>
</span><span id="line-389"></span><span>   </span><span class="hs-comment">--   later elements correspond to outer implications</span><span>
</span><span id="line-390"></span><span>   </span><span class="hs-comment">-- used to undo the cycle-breaking needed to handle</span><span>
</span><span id="line-391"></span><span>   </span><span class="hs-comment">-- Note [Type equality cycles] in GHC.Tc.Solver.Canonical</span><span>
</span><span id="line-392"></span><span>   </span><span class="hs-comment">-- Why store the outer implications? For the use in mightEqualLater (only)</span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="hs-keyword">data</span><span> </span><span id="InertSet"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-var">InertSet</span></a></span></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IS"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-var">IS</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="inert_cans"><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var hs-var">inert_cans</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-396"></span><span>              </span><span class="hs-comment">-- Canonical Given, Wanted, Derived</span><span>
</span><span id="line-397"></span><span>              </span><span class="hs-comment">-- Sometimes called &quot;the inert set&quot;</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_cycle_breakers"><span class="annot"><span class="annottext">InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var hs-var">inert_cycle_breakers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_famapp_cache"><span class="annot"><span class="annottext">InertSet -&gt; FunEqMap (Coercion, Type)
</span><a href="GHC.Tc.Solver.Monad.html#inert_famapp_cache"><span class="hs-identifier hs-var hs-var">inert_famapp_cache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>              </span><span class="hs-comment">-- Just a hash-cons cache for use when reducing family applications</span><span>
</span><span id="line-403"></span><span>              </span><span class="hs-comment">-- only</span><span>
</span><span id="line-404"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-405"></span><span>              </span><span class="hs-comment">-- If    F tys :-&gt; (co, rhs, flav),</span><span>
</span><span id="line-406"></span><span>              </span><span class="hs-comment">-- then  co :: rhs ~N F tys</span><span>
</span><span id="line-407"></span><span>              </span><span class="hs-comment">-- all evidence is from instances or Givens; no coercion holes here</span><span>
</span><span id="line-408"></span><span>              </span><span class="hs-comment">-- (We have no way of &quot;kicking out&quot; from the cache, so putting</span><span>
</span><span id="line-409"></span><span>              </span><span class="hs-comment">--  wanteds here means we can end up solving a Wanted with itself. Bad)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_solved_dicts"><span class="annot"><span class="annottext">InertSet -&gt; DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var hs-var">inert_solved_dicts</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-412"></span><span>              </span><span class="hs-comment">-- All Wanteds, of form ev :: C t1 .. tn</span><span>
</span><span id="line-413"></span><span>              </span><span class="hs-comment">-- See Note [Solved dictionaries]</span><span>
</span><span id="line-414"></span><span>              </span><span class="hs-comment">-- and Note [Do not add superclasses of solved dictionaries]</span><span>
</span><span id="line-415"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621681333419"><span class="annot"><span class="annottext">ppr :: InertSet -&gt; SDoc
</span><a href="#local-6989586621681333419"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333418"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333418"><span class="hs-identifier hs-var">ics</span></a></span></span><span>
</span><span id="line-419"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: InertSet -&gt; DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333417"><span class="annot"><span class="annottext">DictMap CtEvidence
</span><a href="#local-6989586621681333417"><span class="hs-identifier hs-var">solved_dicts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333418"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-421"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681333416"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-422"></span><span>               </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Solved dicts =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681333416"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-423"></span><span>         </span><span class="hs-keyword">where</span><span>
</span><span id="line-424"></span><span>           </span><span id="local-6989586621681333416"><span class="annot"><span class="annottext">dicts :: [CtEvidence]
</span><a href="#local-6989586621681333416"><span class="hs-identifier hs-var hs-var">dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap CtEvidence
</span><a href="#local-6989586621681333417"><span class="hs-identifier hs-var">solved_dicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyInertCans"><span class="hs-identifier hs-type">emptyInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-427"></span><span id="emptyInertCans"><span class="annot"><span class="annottext">emptyInertCans :: InertCans
</span><a href="GHC.Tc.Solver.Monad.html#emptyInertCans"><span class="hs-identifier hs-var hs-var">emptyInertCans</span></a></span></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DVarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyDVarEnv"><span class="hs-identifier hs-var">emptyDVarEnv</span></a></span><span>
</span><span id="line-429"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a></span><span>
</span><span id="line-430"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: Bool
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-431"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyDicts"><span class="hs-identifier hs-var">emptyDicts</span></a></span><span>
</span><span id="line-432"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyDicts"><span class="hs-identifier hs-var">emptyDicts</span></a></span><span>
</span><span id="line-433"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyFunEqs"><span class="hs-identifier hs-var">emptyFunEqs</span></a></span><span>
</span><span id="line-434"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-435"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_blocked :: Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var">inert_blocked</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyInert"><span class="hs-identifier hs-type">emptyInert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span>
</span><span id="line-439"></span><span id="emptyInert"><span class="annot"><span class="annottext">emptyInert :: InertSet
</span><a href="GHC.Tc.Solver.Monad.html#emptyInert"><span class="hs-identifier hs-var hs-var">emptyInert</span></a></span></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="GHC.Tc.Solver.Monad.html#emptyInertCans"><span class="hs-identifier hs-var">emptyInertCans</span></a></span><span>
</span><span id="line-441"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_cycle_breakers :: CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-442"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: FunEqMap (Coercion, Type)
</span><a href="GHC.Tc.Solver.Monad.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyFunEqs"><span class="hs-identifier hs-var">emptyFunEqs</span></a></span><span>
</span><span id="line-443"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyDictMap"><span class="hs-identifier hs-var">emptyDictMap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="hs-comment">{- Note [Solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we apply a top-level instance declaration, we add the &quot;solved&quot;
dictionary to the inert_solved_dicts.  In general, we use it to avoid
creating a new EvVar when we have a new goal that we have solved in
the past.

But in particular, we can use it to create *recursive* dictionaries.
The simplest, degenerate case is
    instance C [a] =&gt; C [a] where ...
If we have
    [W] d1 :: C [x]
then we can apply the instance to get
    d1 = $dfCList d
    [W] d2 :: C [x]
Now 'd1' goes in inert_solved_dicts, and we can solve d2 directly from d1.
    d1 = $dfCList d
    d2 = d1

See Note [Example of recursive dictionaries]

VERY IMPORTANT INVARIANT:

 (Solved Dictionary Invariant)
    Every member of the inert_solved_dicts is the result
    of applying an instance declaration that &quot;takes a step&quot;

    An instance &quot;takes a step&quot; if it has the form
        dfunDList d1 d2 = MkD (...) (...) (...)
    That is, the dfun is lazy in its arguments, and guarantees to
    immediately return a dictionary constructor.  NB: all dictionary
    data constructors are lazy in their arguments.

    This property is crucial to ensure that all dictionaries are
    non-bottom, which in turn ensures that the whole &quot;recursive
    dictionary&quot; idea works at all, even if we get something like
        rec { d = dfunDList d dx }
    See Note [Recursive superclasses] in GHC.Tc.TyCl.Instance.

 Reason:
   - All instances, except two exceptions listed below, &quot;take a step&quot;
     in the above sense

   - Exception 1: local quantified constraints have no such guarantee;
     indeed, adding a &quot;solved dictionary&quot; when appling a quantified
     constraint led to the ability to define unsafeCoerce
     in #17267.

   - Exception 2: the magic built-in instance for (~) has no
     such guarantee.  It behaves as if we had
         class    (a ~# b) =&gt; (a ~ b) where {}
         instance (a ~# b) =&gt; (a ~ b) where {}
     The &quot;dfun&quot; for the instance is strict in the coercion.
     Anyway there's no point in recording a &quot;solved dict&quot; for
     (t1 ~ t2); it's not going to allow a recursive dictionary
     to be constructed.  Ditto (~~) and Coercible.

THEREFORE we only add a &quot;solved dictionary&quot;
  - when applying an instance declaration
  - subject to Exceptions 1 and 2 above

In implementation terms
  - GHC.Tc.Solver.Monad.addSolvedDict adds a new solved dictionary,
    conditional on the kind of instance

  - It is only called when applying an instance decl,
    in GHC.Tc.Solver.Interact.doTopReactDict

  - ClsInst.InstanceWhat says what kind of instance was
    used to solve the constraint.  In particular
      * LocalInstance identifies quantified constraints
      * BuiltinEqInstance identifies the strange built-in
        instances for equality.

  - ClsInst.instanceReturnsDictCon says which kind of
    instance guarantees to return a dictionary constructor

Other notes about solved dictionaries

* See also Note [Do not add superclasses of solved dictionaries]

* The inert_solved_dicts field is not rewritten by equalities,
  so it may get out of date.

* The inert_solved_dicts are all Wanteds, never givens

* We only cache dictionaries from top-level instances, not from
  local quantified constraints.  Reason: if we cached the latter
  we'd need to purge the cache when bringing new quantified
  constraints into scope, because quantified constraints &quot;shadow&quot;
  top-level instances.

Note [Do not add superclasses of solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Every member of inert_solved_dicts is the result of applying a
dictionary function, NOT of applying superclass selection to anything.
Consider

        class Ord a =&gt; C a where
        instance Ord [a] =&gt; C [a] where ...

Suppose we are trying to solve
  [G] d1 : Ord a
  [W] d2 : C [a]

Then we'll use the instance decl to give

  [G] d1 : Ord a     Solved: d2 : C [a] = $dfCList d3
  [W] d3 : Ord [a]

We must not add d4 : Ord [a] to the 'solved' set (by taking the
superclass of d2), otherwise we'll use it to solve d3, without ever
using d1, which would be a catastrophe.

Solution: when extending the solved dictionaries, do not add superclasses.
That's why each element of the inert_solved_dicts is the result of applying
a dictionary function.

Note [Example of recursive dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
--- Example 1

    data D r = ZeroD | SuccD (r (D r));

    instance (Eq (r (D r))) =&gt; Eq (D r) where
        ZeroD     == ZeroD     = True
        (SuccD a) == (SuccD b) = a == b
        _         == _         = False;

    equalDC :: D [] -&gt; D [] -&gt; Bool;
    equalDC = (==);

We need to prove (Eq (D [])). Here's how we go:

   [W] d1 : Eq (D [])
By instance decl of Eq (D r):
   [W] d2 : Eq [D []]      where   d1 = dfEqD d2
By instance decl of Eq [a]:
   [W] d3 : Eq (D [])      where   d2 = dfEqList d3
                                   d1 = dfEqD d2
Now this wanted can interact with our &quot;solved&quot; d1 to get:
    d3 = d1

-- Example 2:
This code arises in the context of &quot;Scrap Your Boilerplate with Class&quot;

    class Sat a
    class Data ctx a
    instance  Sat (ctx Char)             =&gt; Data ctx Char       -- dfunData1
    instance (Sat (ctx [a]), Data ctx a) =&gt; Data ctx [a]        -- dfunData2

    class Data Maybe a =&gt; Foo a

    instance Foo t =&gt; Sat (Maybe t)                             -- dfunSat

    instance Data Maybe a =&gt; Foo a                              -- dfunFoo1
    instance Foo a        =&gt; Foo [a]                            -- dfunFoo2
    instance                 Foo [Char]                         -- dfunFoo3

Consider generating the superclasses of the instance declaration
         instance Foo a =&gt; Foo [a]

So our problem is this
    [G] d0 : Foo t
    [W] d1 : Data Maybe [t]   -- Desired superclass

We may add the given in the inert set, along with its superclasses
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  WorkList
    [W] d1 : Data Maybe [t]

Solve d1 using instance dfunData2; d1 := dfunData2 d2 d3
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
  WorkList:
    [W] d2 : Sat (Maybe [t])
    [W] d3 : Data Maybe t

Now, we may simplify d2 using dfunSat; d2 := dfunSat d4
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
  WorkList:
    [W] d3 : Data Maybe t
    [W] d4 : Foo [t]

Now, we can just solve d3 from d01; d3 := d01
  Inert
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
  WorkList
    [W] d4 : Foo [t]

Now, solve d4 using dfunFoo2;  d4 := dfunFoo2 d5
  Inert
    [G] d0  : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
        d4 : Foo [t]
  WorkList:
    [W] d5 : Foo t

Now, d5 can be solved! d5 := d0

Result
   d1 := dfunData2 d2 d3
   d2 := dfunSat d4
   d3 := d01
   d4 := dfunFoo2 d5
   d5 := d0
-}</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                InertCans: the canonical inerts
*                                                                      *
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="hs-keyword">data</span><span> </span><span id="InertCans"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-var">InertCans</span></a></span></span><span>   </span><span class="hs-comment">-- See Note [Detailed InertCans Invariants] for more</span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IC"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-var">IC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="inert_eqs"><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var hs-var">inert_eqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-680"></span><span>              </span><span class="hs-comment">-- See Note [inert_eqs: the inert equalities]</span><span>
</span><span id="line-681"></span><span>              </span><span class="hs-comment">-- All CEqCans with a TyVarLHS; index is the LHS tyvar</span><span>
</span><span id="line-682"></span><span>              </span><span class="hs-comment">-- Domain = skolems and untouchables; a touchable would be unified</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_funeqs"><span class="annot"><span class="annottext">InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var hs-var">inert_funeqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-685"></span><span>              </span><span class="hs-comment">-- All CEqCans with a TyFamLHS; index is the whole family head type.</span><span>
</span><span id="line-686"></span><span>              </span><span class="hs-comment">-- LHS is fully rewritten (modulo eqCanRewrite constraints)</span><span>
</span><span id="line-687"></span><span>              </span><span class="hs-comment">--     wrt inert_eqs</span><span>
</span><span id="line-688"></span><span>              </span><span class="hs-comment">-- Can include all flavours, [G], [W], [WD], [D]</span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_dicts"><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var hs-var">inert_dicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-691"></span><span>              </span><span class="hs-comment">-- Dictionaries only</span><span>
</span><span id="line-692"></span><span>              </span><span class="hs-comment">-- All fully rewritten (modulo flavour constraints)</span><span>
</span><span id="line-693"></span><span>              </span><span class="hs-comment">--     wrt inert_eqs</span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_insts"><span class="annot"><span class="annottext">InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var hs-var">inert_insts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_safehask"><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var hs-var">inert_safehask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-698"></span><span>              </span><span class="hs-comment">-- Failed dictionary resolution due to Safe Haskell overlapping</span><span>
</span><span id="line-699"></span><span>              </span><span class="hs-comment">-- instances restriction. We keep this separate from inert_dicts</span><span>
</span><span id="line-700"></span><span>              </span><span class="hs-comment">-- as it doesn't cause compilation failure, just safe inference</span><span>
</span><span id="line-701"></span><span>              </span><span class="hs-comment">-- failure.</span><span>
</span><span id="line-702"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-703"></span><span>              </span><span class="hs-comment">-- ^ See Note [Safe Haskell Overlapping Instances Implementation]</span><span>
</span><span id="line-704"></span><span>              </span><span class="hs-comment">-- in &quot;GHC.Tc.Solver&quot;</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_irreds"><span class="annot"><span class="annottext">InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var hs-var">inert_irreds</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-707"></span><span>              </span><span class="hs-comment">-- Irreducible predicates that cannot be made canonical,</span><span>
</span><span id="line-708"></span><span>              </span><span class="hs-comment">--     and which don't interact with others (e.g.  (c a))</span><span>
</span><span id="line-709"></span><span>              </span><span class="hs-comment">-- and insoluble predicates (e.g.  Int ~ Bool, or a ~ [a])</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_blocked"><span class="annot"><span class="annottext">InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var hs-var">inert_blocked</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-712"></span><span>              </span><span class="hs-comment">-- Equality predicates blocked on a coercion hole.</span><span>
</span><span id="line-713"></span><span>              </span><span class="hs-comment">-- Each Ct is a CIrredCan with cc_reason = HoleBlockerReason</span><span>
</span><span id="line-714"></span><span>              </span><span class="hs-comment">-- See Note [Equalities with incompatible kinds] in GHC.Tc.Solver.Canonical</span><span>
</span><span id="line-715"></span><span>              </span><span class="hs-comment">-- wrinkle (2)</span><span>
</span><span id="line-716"></span><span>              </span><span class="hs-comment">-- These are stored separately from inert_irreds because</span><span>
</span><span id="line-717"></span><span>              </span><span class="hs-comment">-- they get kicked out for different reasons</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_given_eq_lvl"><span class="annot"><span class="annottext">InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var hs-var">inert_given_eq_lvl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-721"></span><span>              </span><span class="hs-comment">-- The TcLevel of the innermost implication that has a Given</span><span>
</span><span id="line-722"></span><span>              </span><span class="hs-comment">-- equality of the sort that make a unification variable untouchable</span><span>
</span><span id="line-723"></span><span>              </span><span class="hs-comment">-- (see Note [Unification preconditions] in GHC.Tc.Utils.Unify).</span><span>
</span><span id="line-724"></span><span>              </span><span class="hs-comment">-- See Note [Tracking Given equalities] below</span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_given_eqs"><span class="annot"><span class="annottext">InertCans -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eqs"><span class="hs-identifier hs-var hs-var">inert_given_eqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-727"></span><span>              </span><span class="hs-comment">-- True &lt;=&gt; The inert Givens *at this level* (tcl_tclvl)</span><span>
</span><span id="line-728"></span><span>              </span><span class="hs-comment">--          could includes at least one equality /other than/ a</span><span>
</span><span id="line-729"></span><span>              </span><span class="hs-comment">--          let-bound skolem equality.</span><span>
</span><span id="line-730"></span><span>              </span><span class="hs-comment">-- Reason: report these givens when reporting a failed equality</span><span>
</span><span id="line-731"></span><span>              </span><span class="hs-comment">-- See Note [Tracking Given equalities]</span><span>
</span><span id="line-732"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span class="hs-keyword">type</span><span> </span><span id="InertEqs"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-var">InertEqs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#DTyVarEnv"><span class="hs-identifier hs-type">DTyVarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="hs-keyword">newtype</span><span> </span><span id="EqualCtList"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EqualCtList"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span id="local-6989586621681333394"><span class="annot"><span class="annottext">EqualCtList -&gt; SDoc
forall a. (a -&gt; SDoc) -&gt; Outputable a
ppr :: EqualCtList -&gt; SDoc
$cppr :: EqualCtList -&gt; SDoc
</span><a href="#local-6989586621681333394"><span class="hs-identifier hs-var hs-var hs-var hs-var">Outputable</span></a></span></span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-comment">-- See Note [EqualCtList invariants]</span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unitEqualCtList"><span class="hs-identifier hs-type">unitEqualCtList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-741"></span><span id="unitEqualCtList"><span class="annot"><span class="annottext">unitEqualCtList :: Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#unitEqualCtList"><span class="hs-identifier hs-var hs-var">unitEqualCtList</span></a></span></span><span> </span><span id="local-6989586621681333390"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333390"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333390"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addToEqualCtList"><span class="hs-identifier hs-type">addToEqualCtList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-744"></span><span class="hs-comment">-- NB: This function maintains the &quot;derived-before-wanted&quot; invariant of EqualCtList,</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- but not the others. See Note [EqualCtList invariants]</span><span>
</span><span id="line-746"></span><span id="addToEqualCtList"><span class="annot"><span class="annottext">addToEqualCtList :: Ct -&gt; EqualCtList -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#addToEqualCtList"><span class="hs-identifier hs-var hs-var">addToEqualCtList</span></a></span></span><span> </span><span id="local-6989586621681333388"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333388"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span id="local-6989586621681333387"><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333387"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isWantedCt"><span class="hs-identifier hs-var">isWantedCt</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333388"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333385"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333385"><span class="hs-identifier hs-var">eq1</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621681333384"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333384"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333387"><span class="hs-identifier hs-var">old_eqs</span></a></span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333385"><span class="hs-identifier hs-var">eq1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333388"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333384"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-751"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333388"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#cons"><span class="hs-operator hs-var">`cons`</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333387"><span class="hs-identifier hs-var">old_eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#filterEqualCtList"><span class="hs-identifier hs-type">filterEqualCtList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-754"></span><span id="filterEqualCtList"><span class="annot"><span class="annottext">filterEqualCtList :: (Ct -&gt; Bool) -&gt; EqualCtList -&gt; Maybe EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#filterEqualCtList"><span class="hs-identifier hs-var hs-var">filterEqualCtList</span></a></span></span><span> </span><span id="local-6989586621681333382"><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681333382"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span id="local-6989586621681333381"><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333381"><span class="hs-identifier hs-var">cts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">nonEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; NonEmpty a -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#filter"><span class="hs-identifier hs-var">NE.filter</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681333382"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333381"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-type">equalCtListToList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-758"></span><span id="equalCtListToList"><span class="annot"><span class="annottext">equalCtListToList :: EqualCtList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-var hs-var">equalCtListToList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span id="local-6989586621681333378"><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333378"><span class="hs-identifier hs-var">cts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; [a]
</span><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333378"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#listToEqualCtList"><span class="hs-identifier hs-type">listToEqualCtList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-761"></span><span class="hs-comment">-- NB: This does not maintain invariants other than having the EqualCtList be</span><span>
</span><span id="line-762"></span><span class="hs-comment">-- non-empty</span><span>
</span><span id="line-763"></span><span id="listToEqualCtList"><span class="annot"><span class="annottext">listToEqualCtList :: [Ct] -&gt; Maybe EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#listToEqualCtList"><span class="hs-identifier hs-var hs-var">listToEqualCtList</span></a></span></span><span> </span><span id="local-6989586621681333376"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333376"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-var">EqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">nonEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333376"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="hs-comment">{- Note [Tracking Given equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For reasons described in (UNTOUCHABLE) in GHC.Tc.Utils.Unify
Note [Unification preconditions], we can't unify
   alpha[2] ~ Int
under a level-4 implication if there are any Given equalities
bound by the implications at level 3 of 4.  To that end, the
InertCans tracks

  inert_given_eq_lvl :: TcLevel
     -- The TcLevel of the innermost implication that has a Given
     -- equality of the sort that make a unification variable untouchable
     -- (see Note [Unification preconditions] in GHC.Tc.Utils.Unify).

We update inert_given_eq_lvl whenever we add a Given to the
inert set, in updateGivenEqs.

Then a unification variable alpha[n] is untouchable iff
    n &lt; inert_given_eq_lvl
that is, if the unification variable was born outside an
enclosing Given equality.

Exactly which constraints should trigger (UNTOUCHABLE), and hence
should update inert_given_eq_lvl?

* We do /not/ need to worry about let-bound skolems, such ast
     forall[2] a. a ~ [b] =&gt; blah
  See Note [Let-bound skolems]

* Consider an implication
      forall[2]. beta[1] =&gt; alpha[1] ~ Int
  where beta is a unification variable that has already been unified
  to () in an outer scope.  Then alpha[1] is perfectly touchable and
  we can unify alpha := Int. So when deciding whether the givens contain
  an equality, we should canonicalise first, rather than just looking at
  the /original/ givens (#8644).

 * However, we must take account of *potential* equalities. Consider the
   same example again, but this time we have /not/ yet unified beta:
      forall[2] beta[1] =&gt; ...blah...

   Because beta might turn into an equality, updateGivenEqs conservatively
   treats it as a potential equality, and updates inert_give_eq_lvl

 * What about something like forall[2] a b. a ~ F b =&gt; [W] alpha[1] ~ X y z?

   That Given cannot affect the Wanted, because the Given is entirely
   *local*: it mentions only skolems bound in the very same
   implication. Such equalities need not make alpha untouchable. (Test
   case typecheck/should_compile/LocalGivenEqs has a real-life
   motivating example, with some detailed commentary.)
   Hence the 'mentionsOuterVar' test in updateGivenEqs.

   However, solely to support better error messages
   (see Note [HasGivenEqs] in GHC.Tc.Types.Constraint) we also track
   these &quot;local&quot; equalities in the boolean inert_given_eqs field.
   This field is used only to set the ic_given_eqs field to LocalGivenEqs;
   see the function getHasGivenEqs.

   Here is a simpler case that triggers this behaviour:

     data T where
       MkT :: F a ~ G b =&gt; a -&gt; b -&gt; T

     f (MkT _ _) = True

   Because of this behaviour around local equality givens, we can infer the
   type of f. This is typecheck/should_compile/LocalGivenEqs2.

 * We need not look at the equality relation involved (nominal vs
   representational), because representational equalities can still
   imply nominal ones. For example, if (G a ~R G b) and G's argument's
   role is nominal, then we can deduce a ~N b.

Note [Let-bound skolems]
~~~~~~~~~~~~~~~~~~~~~~~~
If   * the inert set contains a canonical Given CEqCan (a ~ ty)
and  * 'a' is a skolem bound in this very implication,

then:
a) The Given is pretty much a let-binding, like
      f :: (a ~ b-&gt;c) =&gt; a -&gt; a
   Here the equality constraint is like saying
      let a = b-&gt;c in ...
   It is not adding any new, local equality  information,
   and hence can be ignored by has_given_eqs

b) 'a' will have been completely substituted out in the inert set,
   so we can safely discard it.

For an example, see #9211.

See also GHC.Tc.Utils.Unify Note [Deeper level on the left] for how we ensure
that the right variable is on the left of the equality when both are
tyvars.

You might wonder whether the skolem really needs to be bound &quot;in the
very same implication&quot; as the equuality constraint.
Consider this (c.f. #15009):

  data S a where
    MkS :: (a ~ Int) =&gt; S a

  g :: forall a. S a -&gt; a -&gt; blah
  g x y = let h = \z. ( z :: Int
                      , case x of
                           MkS -&gt; [y,z])
          in ...

From the type signature for `g`, we get `y::a` .  Then when we
encounter the `\z`, we'll assign `z :: alpha[1]`, say.  Next, from the
body of the lambda we'll get

  [W] alpha[1] ~ Int                             -- From z::Int
  [W] forall[2]. (a ~ Int) =&gt; [W] alpha[1] ~ a   -- From [y,z]

Now, unify alpha := a.  Now we are stuck with an unsolved alpha~Int!
So we must treat alpha as untouchable under the forall[2] implication.

Note [Detailed InertCans Invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The InertCans represents a collection of constraints with the following properties:

  * All canonical

  * No two dictionaries with the same head
  * No two CIrreds with the same type

  * Family equations inert wrt top-level family axioms

  * Dictionaries have no matching top-level instance

  * Given family or dictionary constraints don't mention touchable
    unification variables

  * Non-CEqCan constraints are fully rewritten with respect
    to the CEqCan equalities (modulo eqCanRewrite of course;
    eg a wanted cannot rewrite a given)

  * CEqCan equalities: see Note [inert_eqs: the inert equalities]
    Also see documentation in Constraint.Ct for a list of invariants

Note [EqualCtList invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    * All are equalities
    * All these equalities have the same LHS
    * The list is never empty
    * No element of the list can rewrite any other
    * Derived before Wanted

From the fourth invariant it follows that the list is
   - A single [G], or
   - Zero or one [D] or [WD], followed by any number of [W]

The Wanteds can't rewrite anything which is why we put them last

Note [inert_eqs: the inert equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Definition [Can-rewrite relation]
A &quot;can-rewrite&quot; relation between flavours, written f1 &gt;= f2, is a
binary relation with the following properties

  (R1) &gt;= is transitive
  (R2) If f1 &gt;= f, and f2 &gt;= f,
       then either f1 &gt;= f2 or f2 &gt;= f1
  (See Note [Why R2?].)

Lemma (L0). If f1 &gt;= f then f1 &gt;= f1
Proof.      By property (R2), with f1=f2

Definition [Generalised substitution]
A &quot;generalised substitution&quot; S is a set of triples (lhs -f-&gt; t), where
  lhs is a type variable or an exactly-saturated type family application
    (that is, lhs is a CanEqLHS)
  t is a type
  f is a flavour
such that
  (WF1) if (lhs1 -f1-&gt; t1) in S
           (lhs2 -f2-&gt; t2) in S
        then (f1 &gt;= f2) implies that lhs1 does not appear within lhs2
  (WF2) if (lhs -f-&gt; t) is in S, then t /= lhs

Definition [Applying a generalised substitution]
If S is a generalised substitution
   S(f,t0) = t,  if (t0 -fs-&gt; t) in S, and fs &gt;= f
           = apply S to components of t0, otherwise
See also Note [Flavours with roles].

Theorem: S(f,t0) is well defined as a function.
Proof: Suppose (lhs -f1-&gt; t1) and (lhs -f2-&gt; t2) are both in S,
               and  f1 &gt;= f and f2 &gt;= f
       Then by (R2) f1 &gt;= f2 or f2 &gt;= f1, which contradicts (WF1)

Notation: repeated application.
  S^0(f,t)     = t
  S^(n+1)(f,t) = S(f, S^n(t))

Definition: terminating generalised substitution
A generalised substitution S is *terminating* iff

  (IG1) there is an n such that
        for every f,t, S^n(f,t) = S^(n+1)(f,t)

By (IG1) we define S*(f,t) to be the result of exahaustively
applying S(f,_) to t.

-----------------------------------------------------------------------------
Our main invariant:
   the CEqCans in inert_eqs should be a terminating generalised substitution
-----------------------------------------------------------------------------

Note that termination is not the same as idempotence.  To apply S to a
type, you may have to apply it recursively.  But termination does
guarantee that this recursive use will terminate.

Note [Why R2?]
~~~~~~~~~~~~~~
R2 states that, if we have f1 &gt;= f and f2 &gt;= f, then either f1 &gt;= f2 or f2 &gt;=
f1. If we do not have R2, we will easily fall into a loop.

To see why, imagine we have f1 &gt;= f, f2 &gt;= f, and that's it. Then, let our
inert set S = {a -f1-&gt; b, b -f2-&gt; a}. Computing S(f,a) does not terminate. And
yet, we have a hard time noticing an occurs-check problem when building S, as
the two equalities cannot rewrite one another.

R2 actually restricts our ability to accept user-written programs. See Note
[Deriveds do rewrite Deriveds] in GHC.Tc.Types.Constraint for an example.

Note [Rewritable]
~~~~~~~~~~~~~~~~~
This Note defines what it means for a type variable or type family application
(that is, a CanEqLHS) to be rewritable in a type. This definition is used
by the anyRewritableXXX family of functions and is meant to model the actual
behaviour in GHC.Tc.Solver.Rewrite.

Ignoring roles (for now): A CanEqLHS lhs is *rewritable* in a type t if the
lhs tree appears as a subtree within t without traversing any of the following
components of t:
  * coercions (whether they appear in casts CastTy or as arguments CoercionTy)
  * kinds of variable occurrences
The check for rewritability *does* look in kinds of the bound variable of a
ForAllTy.

Goal: If lhs is not rewritable in t, then t is a fixpoint of the generalised
substitution containing only {lhs -f*-&gt; t'}, where f* is a flavour such that f* &gt;= f
for all f.

The reason for this definition is that the rewriter does not rewrite in coercions
or variables' kinds. In turn, the rewriter does not need to rewrite there because
those places are never used for controlling the behaviour of the solver: these
places are not used in matching instances or in decomposing equalities.

There is one exception to the claim that non-rewritable parts of the tree do
not affect the solver: we sometimes do an occurs-check to decide e.g. how to
orient an equality. (See the comments on
GHC.Tc.Solver.Canonical.canEqTyVarFunEq.) Accordingly, the presence of a
variable in a kind or coercion just might influence the solver. Here is an
example:

  type family Const x y where
    Const x y = x

  AxConst :: forall x y. Const x y ~# x

  alpha :: Const Type Nat
  [W] alpha ~ Int |&gt; (sym (AxConst Type alpha) ;;
                      AxConst Type alpha ;;
                      sym (AxConst Type Nat))

The cast is clearly ludicrous (it ties together a cast and its symmetric version),
but we can't quite rule it out. (See (EQ1) from
Note [Respecting definitional equality] in GHC.Core.TyCo.Rep to see why we need
the Const Type Nat bit.) And yet this cast will (quite rightly) prevent alpha
from unifying with the RHS. I (Richard E) don't have an example of where this
problem can arise from a Haskell program, but we don't have an air-tight argument
for why the definition of *rewritable* given here is correct.

Taking roles into account: we must consider a rewrite at a given role. That is,
a rewrite arises from some equality, and that equality has a role associated
with it. As we traverse a type, we track what role we are allowed to rewrite with.

For example, suppose we have an inert [G] b ~R# Int. Then b is rewritable in
Maybe b but not in F b, where F is a type function. This role-aware logic is
present in both the anyRewritableXXX functions and in the rewriter.
See also Note [anyRewritableTyVar must be role-aware] in GHC.Tc.Utils.TcType.

Note [Extending the inert equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Main Theorem [Stability under extension]
   Suppose we have a &quot;work item&quot;
       lhs -fw-&gt; t
   and a terminating generalised substitution S,
   THEN the extended substitution T = S+(lhs -fw-&gt; t)
        is a terminating generalised substitution
   PROVIDED
      (T1) S(fw,lhs) = lhs   -- LHS of work-item is a fixpoint of S(fw,_)
      (T2) S(fw,t)   = t     -- RHS of work-item is a fixpoint of S(fw,_)
      (T3) lhs not in t      -- No occurs check in the work item
          -- If lhs is a type family application, we require only that
          -- lhs is not *rewritable* in t. See Note [Rewritable] and
          -- Note [CEqCan occurs check] in GHC.Tc.Types.Constraint.

      AND, for every (lhs1 -fs-&gt; s) in S:
           (K0) not (fw &gt;= fs)
                Reason: suppose we kick out (lhs1 -fs-&gt; s),
                        and add (lhs -fw-&gt; t) to the inert set.
                        The latter can't rewrite the former,
                        so the kick-out achieved nothing

              -- From here, we can assume fw &gt;= fs
           OR (K4) lhs1 is a tyvar AND fs &gt;= fw

           OR { (K1) lhs is not rewritable in lhs1. See Note [Rewritable].
                     Reason: if fw &gt;= fs, WF1 says we can't have both
                             lhs0 -fw-&gt; t  and  F lhs0 -fs-&gt; s

                AND (K2): guarantees termination of the new substitution
                    {  (K2a) not (fs &gt;= fs)
                    OR (K2b) lhs not in s }

                AND (K3) See Note [K3: completeness of solving]
                    { (K3a) If the role of fs is nominal: s /= lhs
                      (K3b) If the role of fs is representational:
                            s is not of form (lhs t1 .. tn) } }


Conditions (T1-T3) are established by the canonicaliser
Conditions (K1-K3) are established by GHC.Tc.Solver.Monad.kickOutRewritable

The idea is that
* T1 and T2 are guaranteed by exhaustively rewriting the work-item
  with S(fw,_).

* T3 is guaranteed by an occurs-check on the work item.
  This is done during canonicalisation, in checkTypeEq; invariant
  (TyEq:OC) of CEqCan. See also Note [CEqCan occurs check] in GHC.Tc.Types.Constraint.

* (K1-3) are the &quot;kick-out&quot; criteria.  (As stated, they are really the
  &quot;keep&quot; criteria.) If the current inert S contains a triple that does
  not satisfy (K1-3), then we remove it from S by &quot;kicking it out&quot;,
  and re-processing it.

* Note that kicking out is a Bad Thing, because it means we have to
  re-process a constraint.  The less we kick out, the better.
  TODO: Make sure that kicking out really *is* a Bad Thing. We've assumed
  this but haven't done the empirical study to check.

* Assume we have  G&gt;=G, G&gt;=W and that's all.  Then, when performing
  a unification we add a new given  a -G-&gt; ty.  But doing so does NOT require
  us to kick out an inert wanted that mentions a, because of (K2a).  This
  is a common case, hence good not to kick out. See also (K2a) below.

* Lemma (L2): if not (fw &gt;= fw), then K0 holds and we kick out nothing
  Proof: using Definition [Can-rewrite relation], fw can't rewrite anything
         and so K0 holds.  Intuitively, since fw can't rewrite anything (Lemma (L0)),
         adding it cannot cause any loops
  This is a common case, because Wanteds cannot rewrite Wanteds.
  It's used to avoid even looking for constraint to kick out.

* Lemma (L1): The conditions of the Main Theorem imply that there is no
              (lhs -fs-&gt; t) in S, s.t.  (fs &gt;= fw).
  Proof. Suppose the contrary (fs &gt;= fw).  Then because of (T1),
  S(fw,lhs)=lhs.  But since fs&gt;=fw, S(fw,lhs) = t, hence t=lhs.  But now we
  have (lhs -fs-&gt; lhs) in S, which contradicts (WF2).

* The extended substitution satisfies (WF1) and (WF2)
  - (K1) plus (L1) guarantee that the extended substitution satisfies (WF1).
  - (T3) guarantees (WF2).

* (K2) and (K4) are about termination.  Intuitively, any infinite chain S^0(f,t),
  S^1(f,t), S^2(f,t).... must pass through the new work item infinitely
  often, since the substitution without the work item is terminating; and must
  pass through at least one of the triples in S infinitely often.

  - (K2a): if not(fs&gt;=fs) then there is no f that fs can rewrite (fs&gt;=f)
    (this is Lemma (L0)), and hence this triple never plays a role in application S(f,t).
    It is always safe to extend S with such a triple.

    (NB: we could strengten K1) in this way too, but see K3.

  - (K2b): if lhs not in s, we have no further opportunity to apply the
    work item

  - (K4): See Note [K4]

* Lemma (L3). Suppose we have f* such that, for all f, f* &gt;= f. Then
  if we are adding lhs -fw-&gt; t (where T1, T2, and T3 hold), we will keep a -f*-&gt; s.
  Proof. K4 holds; thus, we keep.

Key lemma to make it watertight.
  Under the conditions of the Main Theorem,
  forall f st fw &gt;= f, a is not in S^k(f,t), for any k

Also, consider roles more carefully. See Note [Flavours with roles]

Note [K4]
~~~~~~~~~
K4 is a &quot;keep&quot; condition of Note [Extending the inert equalities].
Here is the scenario:

* We are considering adding (lhs -fw-&gt; t) to the inert set S.
* S already has (lhs1 -fs-&gt; s).
* We know S(fw, lhs) = lhs, S(fw, t) = t, and lhs is not rewritable in t.
  See Note [Rewritable]. These are (T1), (T2), and (T3).
* We further know fw &gt;= fs. (If not, then we short-circuit via (K0).)

K4 says that we may keep lhs1 -fs-&gt; s in S if:
  lhs1 is a tyvar AND fs &gt;= fw

Why K4 guarantees termination:
  * If fs &gt;= fw, we know a is not rewritable in t, because of (T2).
  * We further know lhs /= a, because of (T1).
  * Accordingly, a use of the new inert item lhs -fw-&gt; t cannot create the conditions
    for a use of a -fs-&gt; s (precisely because t does not mention a), and hence,
    the extended substitution (with lhs -fw-&gt; t in it) is a terminating
    generalised substitution.

Recall that the termination generalised substitution includes only mappings that
pass an occurs check. This is (T3). At one point, we worried that the
argument here would fail if s mentioned a, but (T3) rules out this possibility.
Put another way: the terminating generalised substitution considers only the inert_eqs,
not other parts of the inert set (such as the irreds).

Can we liberalise K4? No.

Why we cannot drop the (fs &gt;= fw) condition:
  * Suppose not (fs &gt;= fw). It might be the case that t mentions a, and this
    can cause a loop. Example:

      Work:  [G] b ~ a
      Inert: [D] a ~ b

    (where G &gt;= G, G &gt;= D, and D &gt;= D)
    If we don't kick out the inert, then we get a loop on e.g. [D] a ~ Int.

  * Note that the above example is different if the inert is a Given G, because
    (T1) won't hold.

Why we cannot drop the tyvar condition:
  * Presume fs &gt;= fw. Thus, F tys is not rewritable in t, because of (T2).
  * Can the use of lhs -fw-&gt; t create the conditions for a use of F tys -fs-&gt; s?
    Yes! This can happen if t appears within tys.

    Here is an example:

      Work:  [G] a ~ Int
      Inert: [G] F Int ~ F a

    Now, if we have [W] F a ~ Bool, we will rewrite ad infinitum on the left-hand
    side. The key reason why K2b works in the tyvar case is that tyvars are atomic:
    if the right-hand side of an equality does not mention a variable a, then it
    cannot allow an equality with an LHS of a to fire. This is not the case for
    type family applications.

Bottom line: K4 can keep only inerts with tyvars on the left. Put differently,
K4 will never prevent an inert with a type family on the left from being kicked
out.

Consequence: We never kick out a Given/Nominal equality with a tyvar on the left.
This is Lemma (L3) of Note [Extending the inert equalities]. It is good because
it means we can effectively model the mutable filling of metavariables with
Given/Nominal equalities. That is: it should be the case that we could rewrite
our solver never to fill in a metavariable; instead, it would &quot;solve&quot; a wanted
like alpha ~ Int by turning it into a Given, allowing it to be used in rewriting.
We would want the solver to behave the same whether it uses metavariables or
Givens. And (L3) says that no Given/Nominals over tyvars are ever kicked out,
just like we never unfill a metavariable. Nice.

Getting this wrong (that is, allowing K4 to apply to situations with the type
family on the left) led to #19042. (At that point, K4 was known as K2b.)

Originally, this condition was part of K2, but #17672 suggests it should be
a top-level K condition.

Note [K3: completeness of solving]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(K3) is not necessary for the extended substitution
to be terminating.  In fact K1 could be made stronger by saying
   ... then (not (fw &gt;= fs) or not (fs &gt;= fs))
But it's not enough for S to be terminating; we also want completeness.
That is, we want to be able to solve all soluble wanted equalities.
Suppose we have

   work-item   b -G-&gt; a
   inert-item  a -W-&gt; b

Assuming (G &gt;= W) but not (W &gt;= W), this fulfills all the conditions,
so we could extend the inerts, thus:

   inert-items   b -G-&gt; a
                 a -W-&gt; b

But if we kicked-out the inert item, we'd get

   work-item     a -W-&gt; b
   inert-item    b -G-&gt; a

Then rewrite the work-item gives us (a -W-&gt; a), which is soluble via Refl.
So we add one more clause to the kick-out criteria

Another way to understand (K3) is that we treat an inert item
        a -f-&gt; b
in the same way as
        b -f-&gt; a
So if we kick out one, we should kick out the other.  The orientation
is somewhat accidental.

When considering roles, we also need the second clause (K3b). Consider

  work-item    c -G/N-&gt; a
  inert-item   a -W/R-&gt; b c

The work-item doesn't get rewritten by the inert, because (&gt;=) doesn't hold.
But we don't kick out the inert item because not (W/R &gt;= W/R).  So we just
add the work item. But then, consider if we hit the following:

  work-item    b -G/N-&gt; Id
  inert-items  a -W/R-&gt; b c
               c -G/N-&gt; a
where
  newtype Id x = Id x

For similar reasons, if we only had (K3a), we wouldn't kick the
representational inert out. And then, we'd miss solving the inert, which
now reduced to reflexivity.

The solution here is to kick out representational inerts whenever the
lhs of a work item is &quot;exposed&quot;, where exposed means being at the
head of the top-level application chain (lhs t1 .. tn).  See
is_can_eq_lhs_head. This is encoded in (K3b).

Beware: if we make this test succeed too often, we kick out too much,
and the solver might loop.  Consider (#14363)
  work item:   [G] a ~R f b
  inert item:  [G] b ~R f a
In GHC 8.2 the completeness tests more aggressive, and kicked out
the inert item; but no rewriting happened and there was an infinite
loop.  All we need is to have the tyvar at the head.

Note [Flavours with roles]
~~~~~~~~~~~~~~~~~~~~~~~~~~
The system described in Note [inert_eqs: the inert equalities]
discusses an abstract
set of flavours. In GHC, flavours have two components: the flavour proper,
taken from {Wanted, Derived, Given} and the equality relation (often called
role), taken from {NomEq, ReprEq}.
When substituting w.r.t. the inert set,
as described in Note [inert_eqs: the inert equalities],
we must be careful to respect all components of a flavour.
For example, if we have

  inert set: a -G/R-&gt; Int
             b -G/R-&gt; Bool

  type role T nominal representational

and we wish to compute S(W/R, T a b), the correct answer is T a Bool, NOT
T Int Bool. The reason is that T's first parameter has a nominal role, and
thus rewriting a to Int in T a b is wrong. Indeed, this non-congruence of
substitution means that the proof in Note [The inert equalities] may need
to be revisited, but we don't think that the end conclusion is wrong.
-}</span><span>
</span><span id="line-1327"></span><span>
</span><span id="line-1328"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1329"></span><span>  </span><span id="local-6989586621681333369"><span class="annot"><span class="annottext">ppr :: InertCans -&gt; SDoc
</span><a href="#local-6989586621681333369"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333368"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333368"><span class="hs-identifier hs-var">eqs</span></a></span></span><span>
</span><span id="line-1330"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333367"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333367"><span class="hs-identifier hs-var">funeqs</span></a></span></span><span>
</span><span id="line-1331"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333366"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333366"><span class="hs-identifier hs-var">dicts</span></a></span></span><span>
</span><span id="line-1332"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333365"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333365"><span class="hs-identifier hs-var">safehask</span></a></span></span><span>
</span><span id="line-1333"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333364"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333364"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-1334"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_blocked :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var">inert_blocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333363"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333363"><span class="hs-identifier hs-var">blocked</span></a></span></span><span>
</span><span id="line-1335"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333362"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333362"><span class="hs-identifier hs-var">ge_lvl</span></a></span></span><span>
</span><span id="line-1336"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: InertCans -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333361"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681333361"><span class="hs-identifier hs-var">given_eqs</span></a></span></span><span>
</span><span id="line-1337"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333360"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333360"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1340"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. DVarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyDVarEnv"><span class="hs-identifier hs-var">isEmptyDVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333368"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1341"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Equalities:&quot;</span></span><span>
</span><span id="line-1342"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; DVarEnv a -&gt; b
</span><a href="GHC.Types.Var.Env.html#foldDVarEnv"><span class="hs-identifier hs-var">foldDVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681333356"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333368"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333367"><span class="hs-identifier hs-var">funeqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1344"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Type-function equalities =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681333356"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333367"><span class="hs-identifier hs-var">funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1345"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333366"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1346"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Dictionaries =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333366"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1347"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333365"><span class="hs-identifier hs-var">safehask</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1348"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Safe Haskell unsafe overlap =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333365"><span class="hs-identifier hs-var">safehask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1349"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyCts"><span class="hs-identifier hs-var">isEmptyCts</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333364"><span class="hs-identifier hs-var">irreds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1350"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Irreds =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333364"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1351"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyCts"><span class="hs-identifier hs-var">isEmptyCts</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333363"><span class="hs-identifier hs-var">blocked</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1352"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Blocked =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333363"><span class="hs-identifier hs-var">blocked</span></a></span><span>
</span><span id="line-1353"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333360"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1354"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given instances =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333360"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1355"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Innermost given equalities =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333362"><span class="hs-identifier hs-var">ge_lvl</span></a></span><span>
</span><span id="line-1356"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given eqs at this level =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681333361"><span class="hs-identifier hs-var">given_eqs</span></a></span><span>
</span><span id="line-1357"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1358"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1359"></span><span>      </span><span id="local-6989586621681333356"><span class="annot"><span class="annottext">folder :: EqualCtList -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681333356"><span class="hs-identifier hs-var hs-var">folder</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span id="local-6989586621681333352"><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333352"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681333351"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333351"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#nonEmptyToBag"><span class="hs-identifier hs-var">nonEmptyToBag</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333352"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#andCts"><span class="hs-operator hs-var">`andCts`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333351"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1360"></span><span>
</span><span id="line-1361"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Shadow constraints and improvement
*                                                                      *
************************************************************************

Note [The improvement story and derived shadows]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Because Wanteds cannot rewrite Wanteds (see Note [Wanteds do not
rewrite Wanteds] in GHC.Tc.Types.Constraint), we may miss some opportunities for
solving.  Here's a classic example (indexed-types/should_fail/T4093a)

    Ambiguity check for f: (Foo e ~ Maybe e) =&gt; Foo e

    We get [G] Foo e ~ Maybe e    (CEqCan)
           [W] Foo ee ~ Foo e     (CEqCan)       -- ee is a unification variable
           [W] Foo ee ~ Maybe ee  (CEqCan)

    The first Wanted gets rewritten to

           [W] Foo ee ~ Maybe e

    But now we appear to be stuck, since we don't rewrite Wanteds with
    Wanteds.  This is silly because we can see that ee := e is the
    only solution.

The basic plan is
  * generate Derived constraints that shadow Wanted constraints
  * allow Derived to rewrite Derived
  * in order to cause some unifications to take place
  * that in turn solve the original Wanteds

The ONLY reason for all these Derived equalities is to tell us how to
unify a variable: that is, what Mark Jones calls &quot;improvement&quot;.

The same idea is sometimes also called &quot;saturation&quot;; find all the
equalities that must hold in any solution.

Or, equivalently, you can think of the derived shadows as implementing
the &quot;model&quot;: a non-idempotent but no-occurs-check substitution,
reflecting *all* *Nominal* equalities (a ~N ty) that are not
immediately soluble by unification.

More specifically, here's how it works (Oct 16):

* Wanted constraints are born as [WD]; this behaves like a
  [W] and a [D] paired together.

* When we are about to add a [WD] to the inert set, if it can
  be rewritten by a [D] a ~ ty, then we split it into [W] and [D],
  putting the latter into the work list (see maybeEmitShadow).

In the example above, we get to the point where we are stuck:
    [WD] Foo ee ~ Foo e
    [WD] Foo ee ~ Maybe ee

But now when [WD] Foo ee ~ Maybe ee is about to be added, we'll
split it into [W] and [D], since the inert [WD] Foo ee ~ Foo e
can rewrite it.  Then:
    work item: [D] Foo ee ~ Maybe ee
    inert:     [W] Foo ee ~ Maybe ee
               [WD] Foo ee ~ Maybe e

See Note [Splitting WD constraints].  Now the work item is rewritten
by the [WD] and we soon get ee := e.

Additional notes:

  * The derived shadow equalities live in inert_eqs, along with
    the Givens and Wanteds; see Note [EqualCtList invariants].

  * We make Derived shadows only for Wanteds, not Givens.  So we
    have only [G], not [GD] and [G] plus splitting.  See
    Note [Add derived shadows only for Wanteds]

  * We also get Derived equalities from functional dependencies
    and type-function injectivity; see calls to unifyDerived.

  * It's worth having [WD] rather than just [W] and [D] because
    * efficiency: silly to process the same thing twice
    * inert_dicts is a finite map keyed by
      the type; it's inconvenient for it to map to TWO constraints

Another example requiring Deriveds is in
Note [Put touchable variables on the left] in GHC.Tc.Solver.Canonical.

Note [Splitting WD constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We are about to add a [WD] constraint to the inert set; and we
know that the inert set has fully rewritten it.  Should we split
it into [W] and [D], and put the [D] in the work list for further
work?

* CDictCan (C tys):
  Yes if the inert set could rewrite tys to make the class constraint,
  or type family, fire.  That is, yes if the inert_eqs intersects
  with the free vars of tys.  For this test we use
  (anyRewritableTyVar True) which ignores casts and coercions in tys,
  because rewriting the casts or coercions won't make the thing fire
  more often.

* CEqCan (lhs ~ ty): Yes if the inert set could rewrite 'lhs' or 'ty'.
  We need to check both 'lhs' and 'ty' against the inert set:
    - Inert set contains  [D] a ~ ty2
      Then we want to put [D] a ~ ty in the worklist, so we'll
      get [D] ty ~ ty2 with consequent good things

    - Inert set contains [D] b ~ a, where b is in ty.
      We can't just add [WD] a ~ ty[b] to the inert set, because
      that breaks the inert-set invariants.  If we tried to
      canonicalise another [D] constraint mentioning 'a', we'd
      get an infinite loop

  Moreover we must use (anyRewritableTyVar False) for the RHS,
  because even tyvars in the casts and coercions could give
  an infinite loop if we don't expose it

* CIrredCan: Yes if the inert set can rewrite the constraint.
  We used to think splitting irreds was unnecessary, but
  see Note [Splitting Irred WD constraints]

* Others: nothing is gained by splitting.

Note [Splitting Irred WD constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Splitting Irred constraints can make a difference. Here is the
scenario:

  a[sk] :: F v     -- F is a type family
  beta :: alpha

  work item: [WD] a ~ beta

This is heterogeneous, so we emit a kind equality and make the work item an
inert Irred.

  work item: [D] F v ~ alpha
  inert: [WD] (a |&gt; co) ~ beta (CIrredCan)

Can't make progress on the work item. Add to inert set. This kicks out the
old inert, because a [D] can rewrite a [WD].

  work item: [WD] (a |&gt; co) ~ beta
  inert: [D] F v ~ alpha (CEqCan)

Can't make progress on this work item either (although GHC tries by
decomposing the cast and rewriting... but that doesn't make a difference),
which is still hetero. Emit a new kind equality and add to inert set. But,
critically, we split the Irred.

  work list:
   [D] F v ~ alpha (CEqCan)
   [D] (a |&gt; co) ~ beta (CIrred) -- this one was split off
  inert:
   [W] (a |&gt; co) ~ beta
   [D] F v ~ alpha

We quickly solve the first work item, as it's the same as an inert.

  work item: [D] (a |&gt; co) ~ beta
  inert:
   [W] (a |&gt; co) ~ beta
   [D] F v ~ alpha

We decompose the cast, yielding

  [D] a ~ beta

We then rewrite the kinds. The lhs kind is F v, which flattens to alpha.

  co' :: F v ~ alpha
  [D] (a |&gt; co') ~ beta

Now this equality is homo-kinded. So we swizzle it around to

  [D] beta ~ (a |&gt; co')

and set beta := a |&gt; co', and go home happy.

If we don't split the Irreds, we loop. This is all dangerously subtle.

This is triggered by test case typecheck/should_compile/SplitWD.

Note [Add derived shadows only for Wanteds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We only add shadows for Wanted constraints. That is, we have
[WD] but not [GD]; and maybeEmitShaodw looks only at [WD]
constraints.

It does just possibly make sense ot add a derived shadow for a
Given. If we created a Derived shadow of a Given, it could be
rewritten by other Deriveds, and that could, conceivably, lead to a
useful unification.

But (a) I have been unable to come up with an example of this
        happening
    (b) see #12660 for how adding the derived shadows
        of a Given led to an infinite loop.
    (c) It's unlikely that rewriting derived Givens will lead
        to a unification because Givens don't mention touchable
        unification variables

For (b) there may be other ways to solve the loop, but simply
reraining from adding derived shadows of Givens is particularly
simple.  And it's more efficient too!

Still, here's one possible reason for adding derived shadows
for Givens.  Consider
           work-item [G] a ~ [b], inerts has [D] b ~ a.
If we added the derived shadow (into the work list)
         [D] a ~ [b]
When we process it, we'll rewrite to a ~ [a] and get an
occurs check.  Without it we'll miss the occurs check (reporting
inaccessible code); but that's probably OK.

Note [Keep CDictCan shadows as CDictCan]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  class C a =&gt; D a b
and [G] D a b, [G] C a in the inert set.  Now we insert
[D] b ~ c.  We want to kick out a derived shadow for [D] D a b,
so we can rewrite it with the new constraint, and perhaps get
instance reduction or other consequences.

BUT we do not want to kick out a *non-canonical* (D a b). If we
did, we would do this:
  - rewrite it to [D] D a c, with pend_sc = True
  - use expandSuperClasses to add C a
  - go round again, which solves C a from the givens
This loop goes on for ever and triggers the simpl_loop limit.

Solution: kick out the CDictCan which will have pend_sc = False,
because we've already added its superclasses.  So we won't re-add
them.  If we forget the pend_sc flag, our cunning scheme for avoiding
generating superclasses repeatedly will fail.

See #11379 for a case of this.

Note [Do not do improvement for WOnly]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We do improvement between two constraints (e.g. for injectivity
or functional dependencies) only if both are &quot;improvable&quot;. And
we improve a constraint wrt the top-level instances only if
it is improvable.

Improvable:     [G] [WD] [D}
Not improvable: [W]

Reasons:

* It's less work: fewer pairs to compare

* Every [W] has a shadow [D] so nothing is lost

* Consider [WD] C Int b,  where 'b' is a skolem, and
    class C a b | a -&gt; b
    instance C Int Bool
  We'll do a fundep on it and emit [D] b ~ Bool
  That will kick out constraint [WD] C Int b
  Then we'll split it to [W] C Int b (keep in inert)
                     and [D] C Int b (in work list)
  When processing the latter we'll rewrite it to
        [D] C Int Bool
  At that point it would be /stupid/ to interact it
  with the inert [W] C Int b in the inert set; after all,
  it's the very constraint from which the [D] C Int Bool
  was split!  We can avoid this by not doing improvement
  on [W] constraints. This came up in #12860.
-}</span><span>
</span><span id="line-1630"></span><span>
</span><span id="line-1631"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#maybeEmitShadow"><span class="hs-identifier hs-type">maybeEmitShadow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-1632"></span><span class="hs-comment">-- See Note [The improvement story and derived shadows]</span><span>
</span><span id="line-1633"></span><span id="maybeEmitShadow"><span class="annot"><span class="annottext">maybeEmitShadow :: InertCans -&gt; Ct -&gt; TcS Ct
</span><a href="GHC.Tc.Solver.Monad.html#maybeEmitShadow"><span class="hs-identifier hs-var hs-var">maybeEmitShadow</span></a></span></span><span> </span><span id="local-6989586621681333347"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333347"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span id="local-6989586621681333346"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333346"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1634"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333345"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621681333345"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333346"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1635"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333341"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333341"><span class="hs-identifier hs-var">pred</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333339"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681333339"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-1636"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: CtEvidence -&gt; ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333345"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1637"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertEqs -&gt; FunEqMap EqualCtList -&gt; Ct -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#shouldSplitWD"><span class="hs-identifier hs-var">shouldSplitWD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333347"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333347"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333346"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1638"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Emit derived shadow&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333346"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333335"><span class="annot"><span class="annottext">derived_ev :: CtEvidence
</span><a href="#local-6989586621681333335"><span class="hs-identifier hs-var hs-var">derived_ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtDerived"><span class="hs-identifier hs-type">CtDerived</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333341"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-1640"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681333339"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1641"></span><span>             </span><span id="local-6989586621681333333"><span class="annot"><span class="annottext">shadow_ct :: Ct
</span><a href="#local-6989586621681333333"><span class="hs-identifier hs-var hs-var">shadow_ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333346"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333335"><span class="hs-identifier hs-var">derived_ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1642"></span><span>               </span><span class="hs-comment">-- Te shadow constraint keeps the canonical shape.</span><span>
</span><span id="line-1643"></span><span>               </span><span class="hs-comment">-- This just saves work, but is sometimes important;</span><span>
</span><span id="line-1644"></span><span>               </span><span class="hs-comment">-- see Note [Keep CDictCan shadows as CDictCan]</span><span>
</span><span id="line-1645"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333333"><span class="hs-identifier hs-var">shadow_ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333331"><span class="annot"><span class="annottext">ev' :: CtEvidence
</span><a href="#local-6989586621681333331"><span class="hs-identifier hs-var hs-var">ev'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333345"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1648"></span><span>             </span><span id="local-6989586621681333329"><span class="annot"><span class="annottext">ct' :: Ct
</span><a href="#local-6989586621681333329"><span class="hs-identifier hs-var hs-var">ct'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333346"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333331"><span class="hs-identifier hs-var">ev'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1649"></span><span>                 </span><span class="hs-comment">-- Record that it now has a shadow</span><span>
</span><span id="line-1650"></span><span>                 </span><span class="hs-comment">-- This is /the/ place we set the flag to WOnly</span><span>
</span><span id="line-1651"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333329"><span class="hs-identifier hs-var">ct'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1652"></span><span>
</span><span id="line-1653"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1654"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333346"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1655"></span><span>
</span><span id="line-1656"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#shouldSplitWD"><span class="hs-identifier hs-type">shouldSplitWD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1657"></span><span class="hs-comment">-- Precondition: 'ct' is [WD], and is inert</span><span>
</span><span id="line-1658"></span><span class="hs-comment">-- True &lt;=&gt; we should split ct ito [W] and [D] because</span><span>
</span><span id="line-1659"></span><span class="hs-comment">--          the inert_eqs can make progress on the [D]</span><span>
</span><span id="line-1660"></span><span class="hs-comment">-- See Note [Splitting WD constraints]</span><span>
</span><span id="line-1661"></span><span>
</span><span id="line-1662"></span><span id="shouldSplitWD"><span class="annot"><span class="annottext">shouldSplitWD :: InertEqs -&gt; FunEqMap EqualCtList -&gt; Ct -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#shouldSplitWD"><span class="hs-identifier hs-var hs-var">shouldSplitWD</span></a></span></span><span> </span><span id="local-6989586621681333328"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333328"><span class="hs-identifier hs-var">inert_eqs</span></a></span></span><span> </span><span id="local-6989586621681333327"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333327"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333324"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333324"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1663"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertEqs -&gt; FunEqMap EqualCtList -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#should_split_match_args"><span class="hs-identifier hs-var">should_split_match_args</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333328"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333327"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333324"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1664"></span><span>    </span><span class="hs-comment">-- NB True: ignore coercions</span><span>
</span><span id="line-1665"></span><span>    </span><span class="hs-comment">-- See Note [Splitting WD constraints]</span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#shouldSplitWD"><span class="hs-identifier hs-var">shouldSplitWD</span></a></span><span> </span><span id="local-6989586621681333322"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333322"><span class="hs-identifier hs-var">inert_eqs</span></a></span></span><span> </span><span id="local-6989586621681333321"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333321"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333317"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333317"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333315"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333315"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1668"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: Ct -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333313"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333313"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1669"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333317"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TcTyVar -&gt; DVarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#elemDVarEnv"><span class="hs-operator hs-var">`elemDVarEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333322"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>
</span><span id="line-1670"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">EqRel
-&gt; (EqRel -&gt; TcTyVar -&gt; Bool)
-&gt; (EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool)
-&gt; Type
-&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableCanEqLHS"><span class="hs-identifier hs-var">anyRewritableCanEqLHS</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333313"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertEqs -&gt; EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTv"><span class="hs-identifier hs-var">canRewriteTv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333322"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunEqMap EqualCtList -&gt; EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTyFam"><span class="hs-identifier hs-var">canRewriteTyFam</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333321"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333315"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1671"></span><span>  </span><span class="hs-comment">-- NB False: do not ignore casts and coercions</span><span>
</span><span id="line-1672"></span><span>  </span><span class="hs-comment">-- See Note [Splitting WD constraints]</span><span>
</span><span id="line-1673"></span><span>
</span><span id="line-1674"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#shouldSplitWD"><span class="hs-identifier hs-var">shouldSplitWD</span></a></span><span> </span><span id="local-6989586621681333307"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333307"><span class="hs-identifier hs-var">inert_eqs</span></a></span></span><span> </span><span id="local-6989586621681333306"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333306"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333305"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333305"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: Ct -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333304"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333304"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
-&gt; (EqRel -&gt; TcTyVar -&gt; Bool)
-&gt; (EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool)
-&gt; Type
-&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableCanEqLHS"><span class="hs-identifier hs-var">anyRewritableCanEqLHS</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333304"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertEqs -&gt; EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTv"><span class="hs-identifier hs-var">canRewriteTv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333307"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunEqMap EqualCtList -&gt; EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTyFam"><span class="hs-identifier hs-var">canRewriteTyFam</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333306"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1676"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333305"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>
</span><span id="line-1678"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#shouldSplitWD"><span class="hs-identifier hs-var">shouldSplitWD</span></a></span><span> </span><span id="local-6989586621681333302"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333302"><span class="hs-identifier hs-var">inert_eqs</span></a></span></span><span> </span><span id="local-6989586621681333301"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333301"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333299"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333299"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1679"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
-&gt; (EqRel -&gt; TcTyVar -&gt; Bool)
-&gt; (EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool)
-&gt; Type
-&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableCanEqLHS"><span class="hs-identifier hs-var">anyRewritableCanEqLHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#ctEvEqRel"><span class="hs-identifier hs-var">ctEvEqRel</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333299"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertEqs -&gt; EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTv"><span class="hs-identifier hs-var">canRewriteTv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333302"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunEqMap EqualCtList -&gt; EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTyFam"><span class="hs-identifier hs-var">canRewriteTyFam</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333301"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333299"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1681"></span><span>
</span><span id="line-1682"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#shouldSplitWD"><span class="hs-identifier hs-var">shouldSplitWD</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>   </span><span class="hs-comment">-- No point in splitting otherwise</span><span>
</span><span id="line-1683"></span><span>
</span><span id="line-1684"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#should_split_match_args"><span class="hs-identifier hs-type">should_split_match_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1685"></span><span class="hs-comment">-- True if the inert_eqs can rewrite anything in the argument types</span><span>
</span><span id="line-1686"></span><span id="should_split_match_args"><span class="annot"><span class="annottext">should_split_match_args :: InertEqs -&gt; FunEqMap EqualCtList -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#should_split_match_args"><span class="hs-identifier hs-var hs-var">should_split_match_args</span></a></span></span><span> </span><span id="local-6989586621681333297"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333297"><span class="hs-identifier hs-var">inert_eqs</span></a></span></span><span> </span><span id="local-6989586621681333296"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333296"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span> </span><span id="local-6989586621681333295"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333295"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1687"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel
-&gt; (EqRel -&gt; TcTyVar -&gt; Bool)
-&gt; (EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool)
-&gt; Type
-&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableCanEqLHS"><span class="hs-identifier hs-var">anyRewritableCanEqLHS</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertEqs -&gt; EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTv"><span class="hs-identifier hs-var">canRewriteTv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333297"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunEqMap EqualCtList -&gt; EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTyFam"><span class="hs-identifier hs-var">canRewriteTyFam</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333296"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333295"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1688"></span><span>    </span><span class="hs-comment">-- See Note [Splitting WD constraints]</span><span>
</span><span id="line-1689"></span><span>
</span><span id="line-1690"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#canRewriteTv"><span class="hs-identifier hs-type">canRewriteTv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1691"></span><span id="canRewriteTv"><span class="annot"><span class="annottext">canRewriteTv :: InertEqs -&gt; EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTv"><span class="hs-identifier hs-var hs-var">canRewriteTv</span></a></span></span><span> </span><span id="local-6989586621681333291"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333291"><span class="hs-identifier hs-var">inert_eqs</span></a></span></span><span> </span><span id="local-6989586621681333290"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333290"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621681333289"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333289"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1692"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333288"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333288"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. DVarEnv a -&gt; TcTyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupDVarEnv"><span class="hs-identifier hs-var">lookupDVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333291"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333289"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1693"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: Ct -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333286"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333286"><span class="hs-identifier hs-var">eq_rel1</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333288"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1694"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333286"><span class="hs-identifier hs-var">eq_rel1</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewrite"><span class="hs-operator hs-var">`eqCanRewrite`</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333290"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-1695"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1696"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1697"></span><span>
</span><span id="line-1698"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#canRewriteTyFam"><span class="hs-identifier hs-type">canRewriteTyFam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1699"></span><span id="canRewriteTyFam"><span class="annot"><span class="annottext">canRewriteTyFam :: FunEqMap EqualCtList -&gt; EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#canRewriteTyFam"><span class="hs-identifier hs-var hs-var">canRewriteTyFam</span></a></span></span><span> </span><span id="local-6989586621681333284"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333284"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span> </span><span id="local-6989586621681333283"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333283"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621681333282"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333282"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span id="local-6989586621681333281"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333281"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1700"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333280"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333280"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333284"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333282"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333281"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1701"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: Ct -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333279"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333279"><span class="hs-identifier hs-var">eq_rel1</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333280"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1702"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333279"><span class="hs-identifier hs-var">eq_rel1</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewrite"><span class="hs-operator hs-var">`eqCanRewrite`</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333283"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-1703"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1704"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1705"></span><span>
</span><span id="line-1706"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isImprovable"><span class="hs-identifier hs-type">isImprovable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1707"></span><span class="hs-comment">-- See Note [Do not do improvement for WOnly]</span><span>
</span><span id="line-1708"></span><span id="isImprovable"><span class="annot"><span class="annottext">isImprovable :: CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isImprovable"><span class="hs-identifier hs-var hs-var">isImprovable</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: CtEvidence -&gt; ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1709"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isImprovable"><span class="hs-identifier hs-var">isImprovable</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><span class="hs-identifier">_</span></span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1710"></span><span>
</span><span id="line-1711"></span><span>
</span><span id="line-1712"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Inert equalities
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1717"></span><span>
</span><span id="line-1718"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addTyEq"><span class="hs-identifier hs-type">addTyEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-1719"></span><span id="addTyEq"><span class="annot"><span class="annottext">addTyEq :: InertEqs -&gt; TcTyVar -&gt; Ct -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#addTyEq"><span class="hs-identifier hs-var hs-var">addTyEq</span></a></span></span><span> </span><span id="local-6989586621681333277"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333277"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span> </span><span id="local-6989586621681333276"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333276"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681333275"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333275"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1720"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; a) -&gt; DVarEnv a -&gt; TcTyVar -&gt; a -&gt; DVarEnv a
</span><a href="GHC.Types.Var.Env.html#extendDVarEnv_C"><span class="hs-identifier hs-var">extendDVarEnv_C</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; EqualCtList -&gt; EqualCtList
</span><a href="#local-6989586621681333273"><span class="hs-identifier hs-var">add_eq</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333277"><span class="hs-identifier hs-var">old_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333276"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#unitEqualCtList"><span class="hs-identifier hs-var">unitEqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333275"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1721"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1722"></span><span>    </span><span id="local-6989586621681333273"><span class="annot"><span class="annottext">add_eq :: EqualCtList -&gt; EqualCtList -&gt; EqualCtList
</span><a href="#local-6989586621681333273"><span class="hs-identifier hs-var hs-var">add_eq</span></a></span></span><span> </span><span id="local-6989586621681333272"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333272"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; EqualCtList -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#addToEqualCtList"><span class="hs-identifier hs-var">addToEqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333275"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333272"><span class="hs-identifier hs-var">old_eqs</span></a></span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addCanFunEq"><span class="hs-identifier hs-type">addCanFunEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-1725"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-1726"></span><span id="addCanFunEq"><span class="annot"><span class="annottext">addCanFunEq :: FunEqMap EqualCtList
-&gt; TyCon -&gt; [Type] -&gt; Ct -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#addCanFunEq"><span class="hs-identifier hs-var hs-var">addCanFunEq</span></a></span></span><span> </span><span id="local-6989586621681333270"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333270"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span> </span><span id="local-6989586621681333269"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333269"><span class="hs-identifier hs-var">fun_tc</span></a></span></span><span> </span><span id="local-6989586621681333268"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333268"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span> </span><span id="local-6989586621681333267"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333267"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1727"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; XT a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#alterTcApp"><span class="hs-identifier hs-var">alterTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333270"><span class="hs-identifier hs-var">old_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333269"><span class="hs-identifier hs-var">fun_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333268"><span class="hs-identifier hs-var">fun_args</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621681333265"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1728"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1729"></span><span>    </span><span id="local-6989586621681333265"><span class="annot"><span class="annottext">upd :: Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621681333265"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681333264"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333264"><span class="hs-identifier hs-var">old_equal_ct_list</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; EqualCtList -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#addToEqualCtList"><span class="hs-identifier hs-var">addToEqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333267"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333264"><span class="hs-identifier hs-var">old_equal_ct_list</span></a></span><span>
</span><span id="line-1730"></span><span>    </span><span class="annot"><a href="#local-6989586621681333265"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#unitEqualCtList"><span class="hs-identifier hs-var">unitEqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333267"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1731"></span><span>
</span><span id="line-1732"></span><span id="local-6989586621681334433"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldTyEqs"><span class="hs-identifier hs-type">foldTyEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334433"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334433"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334433"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334433"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1733"></span><span id="foldTyEqs"><span class="annot"><span class="annottext">foldTyEqs :: forall b. (Ct -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldTyEqs"><span class="hs-identifier hs-var hs-var">foldTyEqs</span></a></span></span><span> </span><span id="local-6989586621681333262"><span class="annot"><span class="annottext">Ct -&gt; b -&gt; b
</span><a href="#local-6989586621681333262"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681333261"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333261"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621681333260"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681333260"><span class="hs-identifier hs-var">z</span></a></span></span><span>
</span><span id="line-1734"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; DVarEnv a -&gt; b
</span><a href="GHC.Types.Var.Env.html#foldDVarEnv"><span class="hs-identifier hs-var">foldDVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span id="local-6989586621681333259"><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333259"><span class="hs-identifier hs-var">cts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681333258"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681333258"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; b -&gt; b
</span><a href="#local-6989586621681333262"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681333258"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty Ct
</span><a href="#local-6989586621681333259"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681333260"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333261"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-1735"></span><span>
</span><span id="line-1736"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findTyEqs"><span class="hs-identifier hs-type">findTyEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1737"></span><span id="findTyEqs"><span class="annot"><span class="annottext">findTyEqs :: InertCans -&gt; TcTyVar -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#findTyEqs"><span class="hs-identifier hs-var hs-var">findTyEqs</span></a></span></span><span> </span><span id="local-6989586621681333257"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333257"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span id="local-6989586621681333256"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333256"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-var">equalCtListToList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1738"></span><span>                                  </span><span class="annot"><span class="annottext">forall a. DVarEnv a -&gt; TcTyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupDVarEnv"><span class="hs-identifier hs-var">lookupDVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333257"><span class="hs-identifier hs-var">icans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333256"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#delEq"><span class="hs-identifier hs-type">delEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1741"></span><span id="delEq"><span class="annot"><span class="annottext">delEq :: InertCans -&gt; CanEqLHS -&gt; Type -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#delEq"><span class="hs-identifier hs-var hs-var">delEq</span></a></span></span><span> </span><span id="local-6989586621681333252"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333252"><span class="hs-identifier hs-var">ic</span></a></span></span><span> </span><span id="local-6989586621681333251"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333251"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621681333250"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333250"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333251"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1742"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333249"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333249"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1743"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333252"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (Maybe a -&gt; Maybe a) -&gt; DVarEnv a -&gt; TcTyVar -&gt; DVarEnv a
</span><a href="GHC.Types.Var.Env.html#alterDVarEnv"><span class="hs-identifier hs-var">alterDVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621681333247"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333252"><span class="hs-identifier hs-var">ic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333249"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1744"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621681333245"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333245"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span id="local-6989586621681333244"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333244"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1745"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333252"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; XT a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#alterTcApp"><span class="hs-identifier hs-var">alterTcApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333252"><span class="hs-identifier hs-var">ic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333245"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333244"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621681333247"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1746"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1747"></span><span>    </span><span class="annot"><a href="#local-6989586621681333243"><span class="hs-identifier hs-type">isThisOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1748"></span><span>    </span><span id="local-6989586621681333243"><span class="annot"><span class="annottext">isThisOne :: Ct -&gt; Bool
</span><a href="#local-6989586621681333243"><span class="hs-identifier hs-var hs-var">isThisOne</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333242"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333242"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#tcEqTypeNoKindCheck"><span class="hs-identifier hs-var">tcEqTypeNoKindCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333250"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333242"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1749"></span><span>    </span><span class="annot"><a href="#local-6989586621681333243"><span class="hs-identifier hs-var">isThisOne</span></a></span><span> </span><span id="local-6989586621681333240"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333240"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;delEq&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333251"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333252"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333240"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1750"></span><span>
</span><span id="line-1751"></span><span>    </span><span class="annot"><a href="#local-6989586621681333247"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-1752"></span><span>    </span><span id="local-6989586621681333247"><span class="annot"><span class="annottext">upd :: Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621681333247"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681333237"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333237"><span class="hs-identifier hs-var">eq_ct_list</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; EqualCtList -&gt; Maybe EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#filterEqualCtList"><span class="hs-identifier hs-var">filterEqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681333243"><span class="hs-identifier hs-var">isThisOne</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333237"><span class="hs-identifier hs-var">eq_ct_list</span></a></span><span>
</span><span id="line-1753"></span><span>    </span><span class="annot"><a href="#local-6989586621681333247"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1754"></span><span>
</span><span id="line-1755"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findEq"><span class="hs-identifier hs-type">findEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1756"></span><span id="findEq"><span class="annot"><span class="annottext">findEq :: InertCans -&gt; CanEqLHS -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#findEq"><span class="hs-identifier hs-var hs-var">findEq</span></a></span></span><span> </span><span id="local-6989586621681333234"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333234"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333233"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333233"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcTyVar -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#findTyEqs"><span class="hs-identifier hs-var">findTyEqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333234"><span class="hs-identifier hs-var">icans</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333233"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1757"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findEq"><span class="hs-identifier hs-var">findEq</span></a></span><span> </span><span id="local-6989586621681333232"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333232"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621681333231"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333231"><span class="hs-identifier hs-var">fun_tc</span></a></span></span><span> </span><span id="local-6989586621681333230"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333230"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1758"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-var">equalCtListToList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1759"></span><span>                 </span><span class="annot"><span class="annottext">forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333232"><span class="hs-identifier hs-var">icans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333231"><span class="hs-identifier hs-var">fun_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333230"><span class="hs-identifier hs-var">fun_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1760"></span><span>
</span><span id="line-1761"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Inert instances: inert_insts
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1766"></span><span>
</span><span id="line-1767"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier hs-type">addInertForAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1768"></span><span class="hs-comment">-- Add a local Given instance, typically arising from a type signature</span><span>
</span><span id="line-1769"></span><span id="addInertForAll"><span class="annot"><span class="annottext">addInertForAll :: QCInst -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier hs-var hs-var">addInertForAll</span></a></span></span><span> </span><span id="local-6989586621681333229"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333229"><span class="hs-identifier hs-var">new_qci</span></a></span></span><span>
</span><span id="line-1770"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681333228"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333228"><span class="hs-identifier hs-var">ics</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-1771"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681333227"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333227"><span class="hs-identifier hs-var">ics1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcS InertCans
</span><a href="#local-6989586621681333226"><span class="hs-identifier hs-var">add_qci</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333228"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-1772"></span><span>
</span><span id="line-1773"></span><span>       </span><span class="hs-comment">-- Update given equalities. C.f updateGivenEqs</span><span>
</span><span id="line-1774"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681333225"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333225"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1775"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333224"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621681333224"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#qci_pred"><span class="hs-identifier hs-var">qci_pred</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333229"><span class="hs-identifier hs-var">new_qci</span></a></span><span>
</span><span id="line-1776"></span><span>             </span><span id="local-6989586621681333222"><span class="annot"><span class="annottext">not_equality :: Bool
</span><a href="#local-6989586621681333222"><span class="hs-identifier hs-var hs-var">not_equality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isClassPred"><span class="hs-identifier hs-var">isClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333224"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqPred"><span class="hs-identifier hs-var">isEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333224"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1777"></span><span>                  </span><span class="hs-comment">-- True &lt;=&gt; definitely not an equality</span><span>
</span><span id="line-1778"></span><span>                  </span><span class="hs-comment">-- A qci_pred like (f a) might be an equality</span><span>
</span><span id="line-1779"></span><span>
</span><span id="line-1780"></span><span>             </span><span id="local-6989586621681333219"><span class="annot"><span class="annottext">ics2 :: InertCans
</span><a href="#local-6989586621681333219"><span class="hs-identifier hs-var hs-var">ics2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681333222"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333227"><span class="hs-identifier hs-var">ics1</span></a></span><span>
</span><span id="line-1781"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333227"><span class="hs-identifier hs-var">ics1</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333225"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-1782"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: Bool
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1783"></span><span>
</span><span id="line-1784"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333219"><span class="hs-identifier hs-var">ics2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1785"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1786"></span><span>    </span><span class="annot"><a href="#local-6989586621681333226"><span class="hs-identifier hs-type">add_qci</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1787"></span><span>    </span><span class="hs-comment">-- See Note [Do not add duplicate quantified instances]</span><span>
</span><span id="line-1788"></span><span>    </span><span id="local-6989586621681333226"><span class="annot"><span class="annottext">add_qci :: InertCans -&gt; TcS InertCans
</span><a href="#local-6989586621681333226"><span class="hs-identifier hs-var hs-var">add_qci</span></a></span></span><span> </span><span id="local-6989586621681333218"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621681333218"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333217"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333217"><span class="hs-identifier hs-var">qcis</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1789"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Bool
</span><a href="#local-6989586621681333216"><span class="hs-identifier hs-var">same_qci</span></a></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333217"><span class="hs-identifier hs-var">qcis</span></a></span><span>
</span><span id="line-1790"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;skipping duplicate quantified instance&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333229"><span class="hs-identifier hs-var">new_qci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1791"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333218"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1792"></span><span>
</span><span id="line-1793"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1794"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;adding new inert quantified instance&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333229"><span class="hs-identifier hs-var">new_qci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1795"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333218"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_insts :: [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333229"><span class="hs-identifier hs-var">new_qci</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333217"><span class="hs-identifier hs-var">qcis</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1796"></span><span>
</span><span id="line-1797"></span><span>    </span><span id="local-6989586621681333216"><span class="annot"><span class="annottext">same_qci :: QCInst -&gt; Bool
</span><a href="#local-6989586621681333216"><span class="hs-identifier hs-var hs-var">same_qci</span></a></span></span><span> </span><span id="local-6989586621681333215"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333215"><span class="hs-identifier hs-var">old_qci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#tcEqType"><span class="hs-identifier hs-var">tcEqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333215"><span class="hs-identifier hs-var">old_qci</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1798"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333229"><span class="hs-identifier hs-var">new_qci</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span class="hs-comment">{- Note [Do not add duplicate quantified instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this (#15244):

  f :: (C g, D g) =&gt; ....
  class S g =&gt; C g where ...
  class S g =&gt; D g where ...
  class (forall a. Eq a =&gt; Eq (g a)) =&gt; S g where ...

Then in f's RHS there are two identical quantified constraints
available, one via the superclasses of C and one via the superclasses
of D.  The two are identical, and it seems wrong to reject the program
because of that. But without doing duplicate-elimination we will have
two matching QCInsts when we try to solve constraints arising from f's
RHS.

The simplest thing is simply to eliminate duplicates, which we do here.
-}</span><span>
</span><span id="line-1818"></span><span>
</span><span id="line-1819"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                  Adding an inert
*                                                                      *
************************************************************************

Note [Adding an equality to the InertCans]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When adding an equality to the inerts:

* Split [WD] into [W] and [D] if the inerts can rewrite the latter;
  done by maybeEmitShadow.

* Kick out any constraints that can be rewritten by the thing
  we are adding.  Done by kickOutRewritable.

* Note that unifying a:=ty, is like adding [G] a~ty; just use
  kickOutRewritable with Nominal, Given.  See kickOutAfterUnification.
-}</span><span>
</span><span id="line-1838"></span><span>
</span><span id="line-1839"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertCan"><span class="hs-identifier hs-type">addInertCan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1840"></span><span class="hs-comment">-- Precondition: item /is/ canonical</span><span>
</span><span id="line-1841"></span><span class="hs-comment">-- See Note [Adding an equality to the InertCans]</span><span>
</span><span id="line-1842"></span><span id="addInertCan"><span class="annot"><span class="annottext">addInertCan :: Ct -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addInertCan"><span class="hs-identifier hs-var hs-var">addInertCan</span></a></span></span><span> </span><span id="local-6989586621681333212"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333212"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1843"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addInertCan {&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1844"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Trying to insert new inert item:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333212"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681333211"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333211"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-1847"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681333210"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333210"><span class="hs-identifier hs-var">ct</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; Ct -&gt; TcS Ct
</span><a href="GHC.Tc.Solver.Monad.html#maybeEmitShadow"><span class="hs-identifier hs-var">maybeEmitShadow</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333211"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333212"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1848"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681333209"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333209"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; Ct -&gt; TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#maybeKickOut"><span class="hs-identifier hs-var">maybeKickOut</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333211"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333210"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1849"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681333207"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333207"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1850"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#add_item"><span class="hs-identifier hs-var">add_item</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333207"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333209"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333210"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1851"></span><span>
</span><span id="line-1852"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addInertCan }&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1853"></span><span>
</span><span id="line-1854"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#maybeKickOut"><span class="hs-identifier hs-type">maybeKickOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1855"></span><span class="hs-comment">-- For a CEqCan, kick out any inert that can be rewritten by the CEqCan</span><span>
</span><span id="line-1856"></span><span id="maybeKickOut"><span class="annot"><span class="annottext">maybeKickOut :: InertCans -&gt; Ct -&gt; TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#maybeKickOut"><span class="hs-identifier hs-var hs-var">maybeKickOut</span></a></span></span><span> </span><span id="local-6989586621681333204"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333204"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span id="local-6989586621681333203"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333203"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1857"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333202"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333202"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333201"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333201"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: Ct -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333200"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333200"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333203"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1858"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333199"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333199"><span class="hs-identifier hs-var">ics'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CanEqLHS -&gt; InertCans -&gt; TcS (Int, InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier hs-var">kickOutRewritable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333201"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333200"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333202"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333204"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-1859"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333199"><span class="hs-identifier hs-var">ics'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1860"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1861"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333204"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-1862"></span><span>
</span><span id="line-1863"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#add_item"><span class="hs-identifier hs-type">add_item</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1864"></span><span id="add_item"><span class="annot"><span class="annottext">add_item :: TcLevel -&gt; InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#add_item"><span class="hs-identifier hs-var hs-var">add_item</span></a></span></span><span> </span><span id="local-6989586621681333196"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333196"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span>
</span><span id="line-1865"></span><span>         </span><span id="local-6989586621681333195"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621681333195"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333194"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333194"><span class="hs-identifier hs-var">funeqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333193"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333193"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1866"></span><span>         </span><span id="local-6989586621681333192"><span class="annot"><span class="annottext">item :: Ct
</span><a href="#local-6989586621681333192"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333191"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333191"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1867"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; Ct -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#updateGivenEqs"><span class="hs-identifier hs-var">updateGivenEqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333196"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333192"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1868"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333191"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1869"></span><span>       </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621681333189"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333189"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681333188"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333188"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333195"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
-&gt; TyCon -&gt; [Type] -&gt; Ct -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#addCanFunEq"><span class="hs-identifier hs-var">addCanFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333194"><span class="hs-identifier hs-var">funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333189"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333188"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333192"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1870"></span><span>       </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333187"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333187"><span class="hs-identifier hs-var">tv</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333195"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertEqs -&gt; TcTyVar -&gt; Ct -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#addTyEq"><span class="hs-identifier hs-var">addTyEq</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333193"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333187"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333192"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1871"></span><span>
</span><span id="line-1872"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#add_item"><span class="hs-identifier hs-var">add_item</span></a></span><span> </span><span id="local-6989586621681333186"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333186"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621681333185"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621681333185"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_blocked :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var">inert_blocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333184"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333184"><span class="hs-identifier hs-var">blocked</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1873"></span><span>         </span><span id="local-6989586621681333183"><span class="annot"><span class="annottext">item :: Ct
</span><a href="#local-6989586621681333183"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_reason :: Ct -&gt; CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#cc_reason"><span class="hs-identifier hs-var">cc_reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleBlockerReason"><span class="hs-identifier hs-type">HoleBlockerReason</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1874"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; Ct -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#updateGivenEqs"><span class="hs-identifier hs-var">updateGivenEqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333186"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333183"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- this item is always an equality</span><span>
</span><span id="line-1875"></span><span>    </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333185"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_blocked :: Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var">inert_blocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333184"><span class="hs-identifier hs-var">blocked</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#snocBag"><span class="hs-operator hs-var">`snocBag`</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333183"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1876"></span><span>
</span><span id="line-1877"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#add_item"><span class="hs-identifier hs-var">add_item</span></a></span><span> </span><span id="local-6989586621681333179"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333179"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621681333178"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621681333178"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333177"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333177"><span class="hs-identifier hs-var">irreds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681333176"><span class="annot"><span class="annottext">item :: Ct
</span><a href="#local-6989586621681333176"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1878"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; Ct -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#updateGivenEqs"><span class="hs-identifier hs-var">updateGivenEqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333179"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333176"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>   </span><span class="hs-comment">-- An Irred might turn out to be an</span><span>
</span><span id="line-1879"></span><span>                                 </span><span class="hs-comment">-- equality, so we play safe</span><span>
</span><span id="line-1880"></span><span>    </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333178"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333177"><span class="hs-identifier hs-var">irreds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#snocBag"><span class="hs-operator hs-var">`Bag.snocBag`</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333176"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1881"></span><span>
</span><span id="line-1882"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#add_item"><span class="hs-identifier hs-var">add_item</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681333175"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333175"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span id="local-6989586621681333174"><span class="annot"><span class="annottext">item :: Ct
</span><a href="#local-6989586621681333174"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333172"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681333172"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333171"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333171"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1883"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333175"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap Ct -&gt; Class -&gt; [Type] -&gt; Ct -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#addDictCt"><span class="hs-identifier hs-var">addDictCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333175"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681333172"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333171"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333174"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1884"></span><span>
</span><span id="line-1885"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#add_item"><span class="hs-identifier hs-var">add_item</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681333169"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333169"><span class="hs-identifier hs-var">item</span></a></span></span><span>
</span><span id="line-1886"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;upd_inert set: can't happen! Inserting &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1887"></span><span>    </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333169"><span class="hs-identifier hs-var">item</span></a></span><span>   </span><span class="hs-comment">-- Can't be CNonCanonical because they only land in inert_irreds</span><span>
</span><span id="line-1888"></span><span>
</span><span id="line-1889"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updateGivenEqs"><span class="hs-identifier hs-type">updateGivenEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1890"></span><span class="hs-comment">-- Set the inert_given_eq_level to the current level (tclvl)</span><span>
</span><span id="line-1891"></span><span class="hs-comment">-- if the constraint is a given equality that should prevent</span><span>
</span><span id="line-1892"></span><span class="hs-comment">-- filling in an outer unification variable.</span><span>
</span><span id="line-1893"></span><span class="hs-comment">-- See See Note [Tracking Given equalities]</span><span>
</span><span id="line-1894"></span><span id="updateGivenEqs"><span class="annot"><span class="annottext">updateGivenEqs :: TcLevel -&gt; Ct -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#updateGivenEqs"><span class="hs-identifier hs-var hs-var">updateGivenEqs</span></a></span></span><span> </span><span id="local-6989586621681333168"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333168"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621681333167"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333167"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621681333166"><span class="annot"><span class="annottext">inerts :: InertCans
</span><a href="#local-6989586621681333166"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333165"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333165"><span class="hs-identifier hs-var">ge_lvl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1895"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333167"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333166"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-1896"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681333163"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333167"><span class="hs-identifier hs-var">ct</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333166"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-comment">-- See Note [Let-bound skolems]</span><span>
</span><span id="line-1897"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333166"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333162"><span class="hs-identifier hs-var">ge_lvl'</span></a></span><span>
</span><span id="line-1898"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: Bool
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1899"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1900"></span><span>    </span><span id="local-6989586621681333162"><span class="annot"><span class="annottext">ge_lvl' :: TcLevel
</span><a href="#local-6989586621681333162"><span class="hs-identifier hs-var hs-var">ge_lvl'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#mentionsOuterVar"><span class="hs-identifier hs-var">mentionsOuterVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333168"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333167"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1901"></span><span>              </span><span class="hs-comment">-- Includes things like (c a), which *might* be an equality</span><span>
</span><span id="line-1902"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333168"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-1903"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1904"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333165"><span class="hs-identifier hs-var">ge_lvl</span></a></span><span>
</span><span id="line-1905"></span><span>
</span><span id="line-1906"></span><span>    </span><span class="annot"><a href="#local-6989586621681333163"><span class="hs-identifier hs-type">not_equality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1907"></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; definitely not an equality of any kind</span><span>
</span><span id="line-1908"></span><span>    </span><span class="hs-comment">--          except for a let-bound skolem, which doesn't count</span><span>
</span><span id="line-1909"></span><span>    </span><span class="hs-comment">--          See Note [Let-bound skolems]</span><span>
</span><span id="line-1910"></span><span>    </span><span class="hs-comment">-- NB: no need to spot the boxed CDictCan (a ~ b) because its</span><span>
</span><span id="line-1911"></span><span>    </span><span class="hs-comment">--     superclass (a ~# b) will be a CEqCan</span><span>
</span><span id="line-1912"></span><span>    </span><span id="local-6989586621681333163"><span class="annot"><span class="annottext">not_equality :: Ct -&gt; Bool
</span><a href="#local-6989586621681333163"><span class="hs-identifier hs-var hs-var">not_equality</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333160"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333160"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isOuterTyVar"><span class="hs-identifier hs-var">isOuterTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681333168"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333160"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1913"></span><span>    </span><span class="annot"><a href="#local-6989586621681333163"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1914"></span><span>    </span><span class="annot"><a href="#local-6989586621681333163"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span>                                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1915"></span><span>
</span><span id="line-1916"></span><span class="hs-comment">-----------------------------------------</span><span>
</span><span id="line-1917"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier hs-type">kickOutRewritable</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span>  </span><span class="hs-comment">-- Flavour/role of the equality that</span><span>
</span><span id="line-1918"></span><span>                                      </span><span class="hs-comment">-- is being added to the inert set</span><span>
</span><span id="line-1919"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>        </span><span class="hs-comment">-- The new equality is lhs ~ ty</span><span>
</span><span id="line-1920"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1921"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1922"></span><span id="kickOutRewritable"><span class="annot"><span class="annottext">kickOutRewritable :: CtFlavourRole -&gt; CanEqLHS -&gt; InertCans -&gt; TcS (Int, InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier hs-var hs-var">kickOutRewritable</span></a></span></span><span> </span><span id="local-6989586621681333158"><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333158"><span class="hs-identifier hs-var">new_fr</span></a></span></span><span> </span><span id="local-6989586621681333157"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333157"><span class="hs-identifier hs-var">new_lhs</span></a></span></span><span> </span><span id="local-6989586621681333156"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333156"><span class="hs-identifier hs-var">ics</span></a></span></span><span>
</span><span id="line-1923"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333155"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333155"><span class="hs-identifier hs-var">kicked_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333154"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333154"><span class="hs-identifier hs-var">ics'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CanEqLHS -&gt; InertCans -&gt; (WorkList, InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#kick_out_rewritable"><span class="hs-identifier hs-var">kick_out_rewritable</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333158"><span class="hs-identifier hs-var">new_fr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333157"><span class="hs-identifier hs-var">new_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333156"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-1924"></span><span>             </span><span id="local-6989586621681333152"><span class="annot"><span class="annottext">n_kicked :: Int
</span><a href="#local-6989586621681333152"><span class="hs-identifier hs-var hs-var">n_kicked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; Int
</span><a href="GHC.Tc.Solver.Monad.html#workListSize"><span class="hs-identifier hs-var">workListSize</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333155"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-1925"></span><span>
</span><span id="line-1926"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681333152"><span class="hs-identifier hs-var">n_kicked</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1927"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkList -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#appendWorkList"><span class="hs-identifier hs-var">appendWorkList</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333155"><span class="hs-identifier hs-var">kicked_out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span>              </span><span class="hs-comment">-- The famapp-cache contains Given evidence from the inert set.</span><span>
</span><span id="line-1930"></span><span>              </span><span class="hs-comment">-- If we're kicking out Givens, we need to remove this evidence</span><span>
</span><span id="line-1931"></span><span>              </span><span class="hs-comment">-- from the cache, too.</span><span>
</span><span id="line-1932"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333150"><span class="annot"><span class="annottext">kicked_given_ev_vars :: [TcTyVar]
</span><a href="#local-6989586621681333150"><span class="hs-identifier hs-var hs-var">kicked_given_ev_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1933"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333149"><span class="hs-identifier hs-var">ev_var</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681333148"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333148"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333155"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-1934"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333149"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333149"><span class="hs-identifier hs-var">ev_var</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333148"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1935"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333158"><span class="hs-identifier hs-var">new_fr</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewriteFR"><span class="hs-operator hs-var">`eqCanRewriteFR`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1936"></span><span>                   </span><span class="hs-comment">-- if this isn't true, no use looking through the constraints</span><span>
</span><span id="line-1937"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681333150"><span class="hs-identifier hs-var">kicked_given_ev_vars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1938"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given(s) have been kicked out; drop from famapp-cache&quot;</span></span><span>
</span><span id="line-1939"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681333150"><span class="hs-identifier hs-var">kicked_given_ev_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1940"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#dropFromFamAppCache"><span class="hs-identifier hs-var">dropFromFamAppCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681333150"><span class="hs-identifier hs-var">kicked_given_ev_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1941"></span><span>
</span><span id="line-1942"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-var">csTraceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1943"></span><span>              </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Kick out, lhs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333157"><span class="hs-identifier hs-var">new_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1944"></span><span>                 </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;n-kicked =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681333152"><span class="hs-identifier hs-var">n_kicked</span></a></span><span>
</span><span id="line-1945"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kicked_out =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333155"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-1946"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Residual inerts =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333154"><span class="hs-identifier hs-var">ics'</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1947"></span><span>
</span><span id="line-1948"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681333152"><span class="hs-identifier hs-var">n_kicked</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333154"><span class="hs-identifier hs-var">ics'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1949"></span><span>
</span><span id="line-1950"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kick_out_rewritable"><span class="hs-identifier hs-type">kick_out_rewritable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span>  </span><span class="hs-comment">-- Flavour/role of the equality that</span><span>
</span><span id="line-1951"></span><span>                                      </span><span class="hs-comment">-- is being added to the inert set</span><span>
</span><span id="line-1952"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>       </span><span class="hs-comment">-- The new equality is lhs ~ ty</span><span>
</span><span id="line-1953"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1954"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1955"></span><span class="hs-comment">-- See Note [kickOutRewritable]</span><span>
</span><span id="line-1956"></span><span id="kick_out_rewritable"><span class="annot"><span class="annottext">kick_out_rewritable :: CtFlavourRole -&gt; CanEqLHS -&gt; InertCans -&gt; (WorkList, InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#kick_out_rewritable"><span class="hs-identifier hs-var hs-var">kick_out_rewritable</span></a></span></span><span> </span><span id="local-6989586621681333138"><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333138"><span class="hs-identifier hs-var">new_fr</span></a></span></span><span> </span><span id="local-6989586621681333137"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333137"><span class="hs-identifier hs-var">new_lhs</span></a></span></span><span>
</span><span id="line-1957"></span><span>                    </span><span id="local-6989586621681333136"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621681333136"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333135"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333135"><span class="hs-identifier hs-var">tv_eqs</span></a></span></span><span>
</span><span id="line-1958"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333134"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333134"><span class="hs-identifier hs-var">dictmap</span></a></span></span><span>
</span><span id="line-1959"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333133"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333133"><span class="hs-identifier hs-var">funeqmap</span></a></span></span><span>
</span><span id="line-1960"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333132"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333132"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-1961"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333131"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333131"><span class="hs-identifier hs-var">old_insts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1962"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333138"><span class="hs-identifier hs-var">new_fr</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqMayRewriteFR"><span class="hs-operator hs-var">`eqMayRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333138"><span class="hs-identifier hs-var">new_fr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1963"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkList
</span><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333136"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1964"></span><span>        </span><span class="hs-comment">-- If new_fr can't rewrite itself, it can't rewrite</span><span>
</span><span id="line-1965"></span><span>        </span><span class="hs-comment">-- anything else, so no need to kick out anything.</span><span>
</span><span id="line-1966"></span><span>        </span><span class="hs-comment">-- (This is a common case: wanteds can't rewrite wanteds)</span><span>
</span><span id="line-1967"></span><span>        </span><span class="hs-comment">-- Lemma (L2) in Note [Extending the inert equalities]</span><span>
</span><span id="line-1968"></span><span>
</span><span id="line-1969"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1970"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333129"><span class="hs-identifier hs-var">kicked_out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333128"><span class="hs-identifier hs-var">inert_cans_in</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1971"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1972"></span><span>    </span><span class="hs-comment">-- inert_safehask stays unchanged; is that right?</span><span>
</span><span id="line-1973"></span><span>    </span><span id="local-6989586621681333128"><span class="annot"><span class="annottext">inert_cans_in :: InertCans
</span><a href="#local-6989586621681333128"><span class="hs-identifier hs-var hs-var">inert_cans_in</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333136"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333127"><span class="hs-identifier hs-var">tv_eqs_in</span></a></span><span>
</span><span id="line-1974"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333126"><span class="hs-identifier hs-var">dicts_in</span></a></span><span>
</span><span id="line-1975"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333125"><span class="hs-identifier hs-var">feqs_in</span></a></span><span>
</span><span id="line-1976"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333124"><span class="hs-identifier hs-var">irs_in</span></a></span><span>
</span><span id="line-1977"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333123"><span class="hs-identifier hs-var">insts_in</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1978"></span><span>
</span><span id="line-1979"></span><span>    </span><span class="annot"><a href="#local-6989586621681333129"><span class="hs-identifier hs-type">kicked_out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-1980"></span><span>    </span><span class="hs-comment">-- NB: use extendWorkList to ensure that kicked-out equalities get priority</span><span>
</span><span id="line-1981"></span><span>    </span><span class="hs-comment">-- See Note [Prioritise equalities] (Kick-out).</span><span>
</span><span id="line-1982"></span><span>    </span><span class="hs-comment">-- The irreds may include non-canonical (hetero-kinded) equality</span><span>
</span><span id="line-1983"></span><span>    </span><span class="hs-comment">-- constraints, which perhaps may have become soluble after new_lhs</span><span>
</span><span id="line-1984"></span><span>    </span><span class="hs-comment">-- is substituted; ditto the dictionaries, which may include (a~b)</span><span>
</span><span id="line-1985"></span><span>    </span><span class="hs-comment">-- or (a~~b) constraints.</span><span>
</span><span id="line-1986"></span><span>    </span><span id="local-6989586621681333129"><span class="annot"><span class="annottext">kicked_out :: WorkList
</span><a href="#local-6989586621681333129"><span class="hs-identifier hs-var hs-var">kicked_out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListCt"><span class="hs-identifier hs-var">extendWorkListCt</span></a></span><span>
</span><span id="line-1987"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkList
</span><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333122"><span class="hs-identifier hs-var">tv_eqs_out</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333121"><span class="hs-identifier hs-var">feqs_out</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1988"></span><span>                          </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333120"><span class="hs-identifier hs-var">dicts_out</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#andCts"><span class="hs-operator hs-var">`andCts`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333119"><span class="hs-identifier hs-var">irs_out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1989"></span><span>                            </span><span class="annot"><span class="annottext">Bag Ct -&gt; [Ct] -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#extendCtsList"><span class="hs-operator hs-var">`extendCtsList`</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333117"><span class="hs-identifier hs-var">insts_out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1990"></span><span>
</span><span id="line-1991"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681333122"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333122"><span class="hs-identifier hs-var">tv_eqs_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333127"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333127"><span class="hs-identifier hs-var">tv_eqs_in</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; DVarEnv a -&gt; b
</span><a href="GHC.Types.Var.Env.html#foldDVarEnv"><span class="hs-identifier hs-var">foldDVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall container.
(container -&gt; CanEqLHS -&gt; EqualCtList -&gt; container)
-&gt; EqualCtList -&gt; ([Ct], container) -&gt; ([Ct], container)
</span><a href="#local-6989586621681333116"><span class="hs-identifier hs-var">kick_out_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs -&gt; CanEqLHS -&gt; EqualCtList -&gt; InertEqs
</span><a href="#local-6989586621681333115"><span class="hs-identifier hs-var">extend_tv_eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1992"></span><span>                                          </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. DVarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyDVarEnv"><span class="hs-identifier hs-var">emptyDVarEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333135"><span class="hs-identifier hs-var">tv_eqs</span></a></span><span>
</span><span id="line-1993"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681333121"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333121"><span class="hs-identifier hs-var">feqs_out</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621681333125"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333125"><span class="hs-identifier hs-var">feqs_in</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall container.
(container -&gt; CanEqLHS -&gt; EqualCtList -&gt; container)
-&gt; EqualCtList -&gt; ([Ct], container) -&gt; ([Ct], container)
</span><a href="#local-6989586621681333116"><span class="hs-identifier hs-var">kick_out_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
-&gt; CanEqLHS -&gt; EqualCtList -&gt; FunEqMap EqualCtList
</span><a href="#local-6989586621681333114"><span class="hs-identifier hs-var">extend_fun_eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1994"></span><span>                                          </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333133"><span class="hs-identifier hs-var">funeqmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyFunEqs"><span class="hs-identifier hs-var">emptyFunEqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1995"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681333120"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333120"><span class="hs-identifier hs-var">dicts_out</span></a></span></span><span class="hs-special">,</span><span>  </span><span id="local-6989586621681333126"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333126"><span class="hs-identifier hs-var">dicts_in</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; DictMap Ct -&gt; (Bag Ct, DictMap Ct)
</span><a href="GHC.Tc.Solver.Monad.html#partitionDicts"><span class="hs-identifier hs-var">partitionDicts</span></a></span><span>   </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681333112"><span class="hs-identifier hs-var">kick_out_ct</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681333134"><span class="hs-identifier hs-var">dictmap</span></a></span><span>
</span><span id="line-1996"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681333119"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333119"><span class="hs-identifier hs-var">irs_out</span></a></span></span><span class="hs-special">,</span><span>    </span><span id="local-6989586621681333124"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333124"><span class="hs-identifier hs-var">irs_in</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Bag a -&gt; (Bag a, Bag a)
</span><a href="GHC.Data.Bag.html#partitionBag"><span class="hs-identifier hs-var">partitionBag</span></a></span><span>     </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681333112"><span class="hs-identifier hs-var">kick_out_ct</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681333132"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1997"></span><span>      </span><span class="hs-comment">-- Kick out even insolubles: See Note [Rewrite insolubles]</span><span>
</span><span id="line-1998"></span><span>      </span><span class="hs-comment">-- Of course we must kick out irreducibles like (c a), in case</span><span>
</span><span id="line-1999"></span><span>      </span><span class="hs-comment">-- we can rewrite 'c' to something more useful</span><span>
</span><span id="line-2000"></span><span>
</span><span id="line-2001"></span><span>    </span><span class="hs-comment">-- Kick-out for inert instances</span><span>
</span><span id="line-2002"></span><span>    </span><span class="hs-comment">-- See Note [Quantified constraints] in GHC.Tc.Solver.Canonical</span><span>
</span><span id="line-2003"></span><span>    </span><span class="annot"><a href="#local-6989586621681333117"><span class="hs-identifier hs-type">insts_out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2004"></span><span>    </span><span class="annot"><a href="#local-6989586621681333123"><span class="hs-identifier hs-type">insts_in</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2005"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681333117"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333117"><span class="hs-identifier hs-var">insts_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333123"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333123"><span class="hs-identifier hs-var">insts_in</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2006"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621681333110"><span class="hs-identifier hs-var">fr_may_rewrite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- All the insts are Givens</span><span>
</span><span id="line-2007"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; Either b c) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Either Ct QCInst
</span><a href="#local-6989586621681333108"><span class="hs-identifier hs-var">kick_out_qci</span></a></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333131"><span class="hs-identifier hs-var">old_insts</span></a></span><span>
</span><span id="line-2008"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2009"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681333131"><span class="hs-identifier hs-var">old_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2010"></span><span>    </span><span id="local-6989586621681333108"><span class="annot"><span class="annottext">kick_out_qci :: QCInst -&gt; Either Ct QCInst
</span><a href="#local-6989586621681333108"><span class="hs-identifier hs-var hs-var">kick_out_qci</span></a></span></span><span> </span><span id="local-6989586621681333107"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333107"><span class="hs-identifier hs-var">qci</span></a></span></span><span>
</span><span id="line-2011"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333106"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621681333106"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333107"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-2012"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333105"><span class="hs-identifier hs-var">fr_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333107"><span class="hs-identifier hs-var">qci</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2013"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333106"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2014"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2015"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681333107"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-2016"></span><span>
</span><span id="line-2017"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333104"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333104"><span class="hs-identifier hs-var">new_role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333138"><span class="hs-identifier hs-var">new_fr</span></a></span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span>    </span><span class="annot"><a href="#local-6989586621681333103"><span class="hs-identifier hs-type">fr_tv_can_rewrite_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2020"></span><span>    </span><span id="local-6989586621681333103"><span class="annot"><span class="annottext">fr_tv_can_rewrite_ty :: TcTyVar -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333103"><span class="hs-identifier hs-var hs-var">fr_tv_can_rewrite_ty</span></a></span></span><span> </span><span id="local-6989586621681333102"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333102"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span> </span><span id="local-6989586621681333101"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333101"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681333100"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333100"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2021"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; EqRel -&gt; (EqRel -&gt; TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableTyVar"><span class="hs-identifier hs-var">anyRewritableTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333101"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="#local-6989586621681333098"><span class="hs-identifier hs-var">can_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333100"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2022"></span><span>                  </span><span class="hs-comment">-- True: ignore casts and coercions</span><span>
</span><span id="line-2023"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2024"></span><span>        </span><span class="annot"><a href="#local-6989586621681333098"><span class="hs-identifier hs-type">can_rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2025"></span><span>        </span><span id="local-6989586621681333098"><span class="annot"><span class="annottext">can_rewrite :: EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="#local-6989586621681333098"><span class="hs-identifier hs-var hs-var">can_rewrite</span></a></span></span><span> </span><span id="local-6989586621681333097"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333097"><span class="hs-identifier hs-var">old_role</span></a></span></span><span> </span><span id="local-6989586621681333096"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333096"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333104"><span class="hs-identifier hs-var">new_role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewrite"><span class="hs-operator hs-var">`eqCanRewrite`</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333097"><span class="hs-identifier hs-var">old_role</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333096"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333102"><span class="hs-identifier hs-var">new_tv</span></a></span><span>
</span><span id="line-2026"></span><span>
</span><span id="line-2027"></span><span>    </span><span class="annot"><a href="#local-6989586621681333095"><span class="hs-identifier hs-type">fr_tf_can_rewrite_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2028"></span><span>    </span><span id="local-6989586621681333095"><span class="annot"><span class="annottext">fr_tf_can_rewrite_ty :: TyCon -&gt; [Type] -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333095"><span class="hs-identifier hs-var hs-var">fr_tf_can_rewrite_ty</span></a></span></span><span> </span><span id="local-6989586621681333094"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333094"><span class="hs-identifier hs-var">new_tf</span></a></span></span><span> </span><span id="local-6989586621681333093"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333093"><span class="hs-identifier hs-var">new_tf_args</span></a></span></span><span> </span><span id="local-6989586621681333092"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333092"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681333091"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333091"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2029"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; (EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableTyFamApp"><span class="hs-identifier hs-var">anyRewritableTyFamApp</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333092"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="#local-6989586621681333089"><span class="hs-identifier hs-var">can_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333091"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2030"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2031"></span><span>        </span><span class="annot"><a href="#local-6989586621681333089"><span class="hs-identifier hs-type">can_rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2032"></span><span>        </span><span id="local-6989586621681333089"><span class="annot"><span class="annottext">can_rewrite :: EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="#local-6989586621681333089"><span class="hs-identifier hs-var hs-var">can_rewrite</span></a></span></span><span> </span><span id="local-6989586621681333088"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333088"><span class="hs-identifier hs-var">old_role</span></a></span></span><span> </span><span id="local-6989586621681333087"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333087"><span class="hs-identifier hs-var">old_tf</span></a></span></span><span> </span><span id="local-6989586621681333086"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333086"><span class="hs-identifier hs-var">old_tf_args</span></a></span></span><span>
</span><span id="line-2033"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333104"><span class="hs-identifier hs-var">new_role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewrite"><span class="hs-operator hs-var">`eqCanRewrite`</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333088"><span class="hs-identifier hs-var">old_role</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2034"></span><span>            </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#tcEqTyConApps"><span class="hs-identifier hs-var">tcEqTyConApps</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333094"><span class="hs-identifier hs-var">new_tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333093"><span class="hs-identifier hs-var">new_tf_args</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333087"><span class="hs-identifier hs-var">old_tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333086"><span class="hs-identifier hs-var">old_tf_args</span></a></span><span>
</span><span id="line-2035"></span><span>              </span><span class="hs-comment">-- it's possible for old_tf_args to have too many. This is fine;</span><span>
</span><span id="line-2036"></span><span>              </span><span class="hs-comment">-- we'll only check what we need to.</span><span>
</span><span id="line-2037"></span><span>
</span><span id="line-2038"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621681333105"><span class="hs-pragma hs-type">fr_can_rewrite_ty</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="hs-comment">-- perform the check here only once</span><span>
</span><span id="line-2039"></span><span>    </span><span class="annot"><a href="#local-6989586621681333105"><span class="hs-identifier hs-type">fr_can_rewrite_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2040"></span><span>    </span><span id="local-6989586621681333105"><span class="annot"><span class="annottext">fr_can_rewrite_ty :: EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333105"><span class="hs-identifier hs-var hs-var">fr_can_rewrite_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333137"><span class="hs-identifier hs-var">new_lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2041"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333084"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333084"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333103"><span class="hs-identifier hs-var">fr_tv_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333084"><span class="hs-identifier hs-var">new_tv</span></a></span><span>
</span><span id="line-2042"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621681333083"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333083"><span class="hs-identifier hs-var">new_tf</span></a></span></span><span> </span><span id="local-6989586621681333082"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333082"><span class="hs-identifier hs-var">new_tf_args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333095"><span class="hs-identifier hs-var">fr_tf_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333083"><span class="hs-identifier hs-var">new_tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333082"><span class="hs-identifier hs-var">new_tf_args</span></a></span><span>
</span><span id="line-2043"></span><span>
</span><span id="line-2044"></span><span>    </span><span class="annot"><a href="#local-6989586621681333110"><span class="hs-identifier hs-type">fr_may_rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2045"></span><span>    </span><span id="local-6989586621681333110"><span class="annot"><span class="annottext">fr_may_rewrite :: CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621681333110"><span class="hs-identifier hs-var hs-var">fr_may_rewrite</span></a></span></span><span> </span><span id="local-6989586621681333081"><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333081"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333138"><span class="hs-identifier hs-var">new_fr</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqMayRewriteFR"><span class="hs-operator hs-var">`eqMayRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333081"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-2046"></span><span>        </span><span class="hs-comment">-- Can the new item rewrite the inert item?</span><span>
</span><span id="line-2047"></span><span>
</span><span id="line-2048"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621681333112"><span class="hs-pragma hs-type">kick_out_ct</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="hs-comment">-- perform case on new_lhs here only once</span><span>
</span><span id="line-2049"></span><span>    </span><span class="annot"><a href="#local-6989586621681333112"><span class="hs-identifier hs-type">kick_out_ct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2050"></span><span>    </span><span class="hs-comment">-- Kick it out if the new CEqCan can rewrite the inert one</span><span>
</span><span id="line-2051"></span><span>    </span><span class="hs-comment">-- See Note [kickOutRewritable]</span><span>
</span><span id="line-2052"></span><span>    </span><span id="local-6989586621681333112"><span class="annot"><span class="annottext">kick_out_ct :: Ct -&gt; Bool
</span><a href="#local-6989586621681333112"><span class="hs-identifier hs-var hs-var">kick_out_ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333137"><span class="hs-identifier hs-var">new_lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2053"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333080"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333080"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681333079"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333079"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333078"><span class="annot"><span class="annottext">fs :: CtFlavourRole
</span><a href="#local-6989586621681333078"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681333077"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333077"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#ctFlavourRole"><span class="hs-identifier hs-var">ctFlavourRole</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333079"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2054"></span><span>                                </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621681333110"><span class="hs-identifier hs-var">fr_may_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333078"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-2055"></span><span>                             </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333103"><span class="hs-identifier hs-var">fr_tv_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333080"><span class="hs-identifier hs-var">new_tv</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333077"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333079"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2056"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621681333075"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333075"><span class="hs-identifier hs-var">new_tf</span></a></span></span><span> </span><span id="local-6989586621681333074"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333074"><span class="hs-identifier hs-var">new_tf_args</span></a></span></span><span>
</span><span id="line-2057"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681333073"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333073"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681333072"><span class="annot"><span class="annottext">fs :: CtFlavourRole
</span><a href="#local-6989586621681333072"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333071"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333071"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#ctFlavourRole"><span class="hs-identifier hs-var">ctFlavourRole</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333073"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2058"></span><span>                  </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621681333110"><span class="hs-identifier hs-var">fr_may_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333072"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-2059"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333095"><span class="hs-identifier hs-var">fr_tf_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333075"><span class="hs-identifier hs-var">new_tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333074"><span class="hs-identifier hs-var">new_tf_args</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333071"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333073"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2060"></span><span>
</span><span id="line-2061"></span><span>    </span><span class="annot"><a href="#local-6989586621681333115"><span class="hs-identifier hs-type">extend_tv_eqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-2062"></span><span>    </span><span id="local-6989586621681333115"><span class="annot"><span class="annottext">extend_tv_eqs :: InertEqs -&gt; CanEqLHS -&gt; EqualCtList -&gt; InertEqs
</span><a href="#local-6989586621681333115"><span class="hs-identifier hs-var hs-var">extend_tv_eqs</span></a></span></span><span> </span><span id="local-6989586621681333070"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333070"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333069"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333069"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681333068"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333068"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DVarEnv a -&gt; TcTyVar -&gt; a -&gt; DVarEnv a
</span><a href="GHC.Types.Var.Env.html#extendDVarEnv"><span class="hs-identifier hs-var">extendDVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333070"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333069"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333068"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-2063"></span><span>    </span><span class="annot"><a href="#local-6989586621681333115"><span class="hs-identifier hs-var">extend_tv_eqs</span></a></span><span> </span><span id="local-6989586621681333066"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333066"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621681333065"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333065"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span id="local-6989586621681333064"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333064"><span class="hs-identifier hs-var">_cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extend_tv_eqs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681333066"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333065"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2064"></span><span>
</span><span id="line-2065"></span><span>    </span><span class="annot"><a href="#local-6989586621681333114"><span class="hs-identifier hs-type">extend_fun_eqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-2066"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-2067"></span><span>    </span><span id="local-6989586621681333114"><span class="annot"><span class="annottext">extend_fun_eqs :: FunEqMap EqualCtList
-&gt; CanEqLHS -&gt; EqualCtList -&gt; FunEqMap EqualCtList
</span><a href="#local-6989586621681333114"><span class="hs-identifier hs-var hs-var">extend_fun_eqs</span></a></span></span><span> </span><span id="local-6989586621681333063"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333063"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621681333062"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333062"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681333061"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333061"><span class="hs-identifier hs-var">fam_args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681333060"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333060"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-2068"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333063"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333062"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333061"><span class="hs-identifier hs-var">fam_args</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333060"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-2069"></span><span>    </span><span class="annot"><a href="#local-6989586621681333114"><span class="hs-identifier hs-var">extend_fun_eqs</span></a></span><span> </span><span id="local-6989586621681333058"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333058"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621681333057"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333057"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span id="local-6989586621681333056"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333056"><span class="hs-identifier hs-var">_cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extend_fun_eqs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681333058"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333057"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2070"></span><span>
</span><span id="line-2071"></span><span>    </span><span id="local-6989586621681334417"><span class="annot"><a href="#local-6989586621681333116"><span class="hs-identifier hs-type">kick_out_eqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681334417"><span class="hs-identifier hs-type">container</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334417"><span class="hs-identifier hs-type">container</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2072"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681334417"><span class="hs-identifier hs-type">container</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2073"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681334417"><span class="hs-identifier hs-type">container</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2074"></span><span>    </span><span id="local-6989586621681333116"><span class="annot"><span class="annottext">kick_out_eqs :: forall container.
(container -&gt; CanEqLHS -&gt; EqualCtList -&gt; container)
-&gt; EqualCtList -&gt; ([Ct], container) -&gt; ([Ct], container)
</span><a href="#local-6989586621681333116"><span class="hs-identifier hs-var hs-var">kick_out_eqs</span></a></span></span><span> </span><span id="local-6989586621681333055"><span class="annot"><span class="annottext">container -&gt; CanEqLHS -&gt; EqualCtList -&gt; container
</span><a href="#local-6989586621681333055"><span class="hs-identifier hs-var">extend</span></a></span></span><span> </span><span id="local-6989586621681333054"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333054"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333053"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333053"><span class="hs-identifier hs-var">acc_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333052"><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621681333052"><span class="hs-identifier hs-var">acc_in</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2075"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333051"><span class="hs-identifier hs-var">eqs_out</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333053"><span class="hs-identifier hs-var">acc_out</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; Maybe EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#listToEqualCtList"><span class="hs-identifier hs-var">listToEqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333049"><span class="hs-identifier hs-var">eqs_in</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2076"></span><span>            </span><span class="annot"><span class="annottext">Maybe EqualCtList
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621681333052"><span class="hs-identifier hs-var">acc_in</span></a></span><span>
</span><span id="line-2077"></span><span>            </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681333048"><span class="annot"><span class="annottext">eqs_in_ecl :: EqualCtList
</span><a href="#local-6989586621681333048"><span class="hs-identifier hs-var">eqs_in_ecl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333047"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333047"><span class="hs-identifier hs-var">eq1</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2078"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">container -&gt; CanEqLHS -&gt; EqualCtList -&gt; container
</span><a href="#local-6989586621681333055"><span class="hs-identifier hs-var">extend</span></a></span><span> </span><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621681333052"><span class="hs-identifier hs-var">acc_in</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333047"><span class="hs-identifier hs-var">eq1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333048"><span class="hs-identifier hs-var">eqs_in_ecl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2079"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2080"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681333051"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333051"><span class="hs-identifier hs-var">eqs_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333049"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681333049"><span class="hs-identifier hs-var">eqs_in</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681333046"><span class="hs-identifier hs-var">kick_out_eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqualCtList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-var">equalCtListToList</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681333054"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>
</span><span id="line-2082"></span><span>    </span><span class="hs-comment">-- Implements criteria K1-K3 in Note [Extending the inert equalities]</span><span>
</span><span id="line-2083"></span><span>    </span><span id="local-6989586621681333046"><span class="annot"><span class="annottext">kick_out_eq :: Ct -&gt; Bool
</span><a href="#local-6989586621681333046"><span class="hs-identifier hs-var hs-var">kick_out_eq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333045"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333045"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333044"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333044"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>
</span><span id="line-2084"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333043"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333043"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: Ct -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681333042"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333042"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2085"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621681333110"><span class="hs-identifier hs-var">fr_may_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333041"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2086"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- (K0) Keep it in the inert set if the new thing can't rewrite it</span><span>
</span><span id="line-2087"></span><span>
</span><span id="line-2088"></span><span>      </span><span class="hs-comment">-- Below here (fr_may_rewrite fs) is True</span><span>
</span><span id="line-2089"></span><span>
</span><span id="line-2090"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333045"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2091"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333041"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqMayRewriteFR"><span class="hs-operator hs-var">`eqMayRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333138"><span class="hs-identifier hs-var">new_fr</span></a></span><span>
</span><span id="line-2092"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- (K4) Keep it in the inert set if the LHS is a tyvar and</span><span>
</span><span id="line-2093"></span><span>               </span><span class="hs-comment">-- it can rewrite the work item. See Note [K4]</span><span>
</span><span id="line-2094"></span><span>
</span><span id="line-2095"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333105"><span class="hs-identifier hs-var">fr_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333042"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333045"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2096"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- (K1)</span><span>
</span><span id="line-2097"></span><span>         </span><span class="hs-comment">-- The above check redundantly checks the role &amp; flavour,</span><span>
</span><span id="line-2098"></span><span>         </span><span class="hs-comment">-- but it's very convenient</span><span>
</span><span id="line-2099"></span><span>
</span><span id="line-2100"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681333039"><span class="hs-identifier hs-var">kick_out_for_inertness</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- (K2)</span><span>
</span><span id="line-2101"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681333038"><span class="hs-identifier hs-var">kick_out_for_completeness</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- (K3)</span><span>
</span><span id="line-2102"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2103"></span><span>
</span><span id="line-2104"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2105"></span><span>        </span><span id="local-6989586621681333041"><span class="annot"><span class="annottext">fs :: CtFlavourRole
</span><a href="#local-6989586621681333041"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681333043"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333042"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2106"></span><span>        </span><span id="local-6989586621681333039"><span class="annot"><span class="annottext">kick_out_for_inertness :: Bool
</span><a href="#local-6989586621681333039"><span class="hs-identifier hs-var hs-var">kick_out_for_inertness</span></a></span></span><span>
</span><span id="line-2107"></span><span>          </span><span class="hs-glyph">=</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333041"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqMayRewriteFR"><span class="hs-operator hs-var">`eqMayRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621681333041"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- (K2a)</span><span>
</span><span id="line-2108"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333105"><span class="hs-identifier hs-var">fr_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333042"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333044"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>    </span><span class="hs-comment">-- (K2b)</span><span>
</span><span id="line-2109"></span><span>
</span><span id="line-2110"></span><span>        </span><span id="local-6989586621681333038"><span class="annot"><span class="annottext">kick_out_for_completeness :: Bool
</span><a href="#local-6989586621681333038"><span class="hs-identifier hs-var hs-var">kick_out_for_completeness</span></a></span></span><span>  </span><span class="hs-comment">-- (K3) and Note [K3: completeness of solving]</span><span>
</span><span id="line-2111"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681333042"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2112"></span><span>              </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333044"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333137"><span class="hs-identifier hs-var">new_lhs</span></a></span><span> </span><span class="hs-comment">-- (K3a)</span><span>
</span><span id="line-2113"></span><span>              </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333035"><span class="hs-identifier hs-var">is_can_eq_lhs_head</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681333137"><span class="hs-identifier hs-var">new_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333044"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>    </span><span class="hs-comment">-- (K3b)</span><span>
</span><span id="line-2114"></span><span>
</span><span id="line-2115"></span><span>    </span><span class="annot"><a href="#local-6989586621681333046"><span class="hs-identifier hs-var">kick_out_eq</span></a></span><span> </span><span id="local-6989586621681333034"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333034"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;keep_eq&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681333034"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2116"></span><span>
</span><span id="line-2117"></span><span>    </span><span id="local-6989586621681333035"><span class="annot"><span class="annottext">is_can_eq_lhs_head :: CanEqLHS -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681333035"><span class="hs-identifier hs-var hs-var">is_can_eq_lhs_head</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681333032"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333032"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-2118"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2119"></span><span>        </span><span id="local-6989586621681333031"><span class="annot"><span class="annottext">go :: Type -&gt; Bool
</span><a href="#local-6989586621681333031"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">Rep.TyVarTy</span></a></span><span> </span><span id="local-6989586621681333029"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333029"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333032"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333029"><span class="hs-identifier hs-var">tv'</span></a></span><span>
</span><span id="line-2120"></span><span>        </span><span class="annot"><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">Rep.AppTy</span></a></span><span> </span><span id="local-6989586621681333027"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333027"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333027"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-2121"></span><span>        </span><span class="annot"><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">Rep.CastTy</span></a></span><span> </span><span id="local-6989586621681333025"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333025"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333025"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2122"></span><span>        </span><span class="annot"><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">Rep.TyConApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2123"></span><span>        </span><span class="annot"><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">Rep.LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2124"></span><span>        </span><span class="annot"><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">Rep.ForAllTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2125"></span><span>        </span><span class="annot"><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">Rep.FunTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2126"></span><span>        </span><span class="annot"><a href="#local-6989586621681333031"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">Rep.CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2127"></span><span>    </span><span class="annot"><a href="#local-6989586621681333035"><span class="hs-identifier hs-var">is_can_eq_lhs_head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621681333019"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333019"><span class="hs-identifier hs-var">fun_tc</span></a></span></span><span> </span><span id="local-6989586621681333018"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333018"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-2128"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2129"></span><span>        </span><span id="local-6989586621681333017"><span class="annot"><span class="annottext">go :: Type -&gt; Bool
</span><a href="#local-6989586621681333017"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">Rep.TyVarTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2130"></span><span>        </span><span class="annot"><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">Rep.AppTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- no TyConApp to the left of an AppTy</span><span>
</span><span id="line-2131"></span><span>        </span><span class="annot"><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">Rep.CastTy</span></a></span><span> </span><span id="local-6989586621681333016"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333016"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681333016"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2132"></span><span>        </span><span class="annot"><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">Rep.TyConApp</span></a></span><span> </span><span id="local-6989586621681333015"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333015"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681333014"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333014"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#tcEqTyConApps"><span class="hs-identifier hs-var">tcEqTyConApps</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333019"><span class="hs-identifier hs-var">fun_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333018"><span class="hs-identifier hs-var">fun_args</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681333015"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681333014"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2133"></span><span>        </span><span class="annot"><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">Rep.LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2134"></span><span>        </span><span class="annot"><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">Rep.ForAllTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2135"></span><span>        </span><span class="annot"><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">Rep.FunTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2136"></span><span>        </span><span class="annot"><a href="#local-6989586621681333017"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">Rep.CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2137"></span><span>
</span><span id="line-2138"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier hs-type">kickOutAfterUnification</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2139"></span><span id="kickOutAfterUnification"><span class="annot"><span class="annottext">kickOutAfterUnification :: TcTyVar -&gt; TcS Int
</span><a href="GHC.Tc.Solver.Monad.html#kickOutAfterUnification"><span class="hs-identifier hs-var hs-var">kickOutAfterUnification</span></a></span></span><span> </span><span id="local-6989586621681333013"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333013"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span>
</span><span id="line-2140"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681333012"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333012"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2141"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333011"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681333011"><span class="hs-identifier hs-var">n_kicked</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333010"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333010"><span class="hs-identifier hs-var">ics2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CanEqLHS -&gt; InertCans -&gt; TcS (Int, InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#kickOutRewritable"><span class="hs-identifier hs-var">kickOutRewritable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2142"></span><span>                                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-var">TyVarLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681333013"><span class="hs-identifier hs-var">new_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333012"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-2143"></span><span>                     </span><span class="hs-comment">-- Given because the tv := xi is given; NomEq because</span><span>
</span><span id="line-2144"></span><span>                     </span><span class="hs-comment">-- only nominal equalities are solved by unification</span><span>
</span><span id="line-2145"></span><span>
</span><span id="line-2146"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333010"><span class="hs-identifier hs-var">ics2</span></a></span><span>
</span><span id="line-2147"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681333011"><span class="hs-identifier hs-var">n_kicked</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2148"></span><span>
</span><span id="line-2149"></span><span class="hs-comment">-- See Wrinkle (2) in Note [Equalities with incompatible kinds] in GHC.Tc.Solver.Canonical</span><span>
</span><span id="line-2150"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#kickOutAfterFillingCoercionHole"><span class="hs-identifier hs-type">kickOutAfterFillingCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2151"></span><span id="kickOutAfterFillingCoercionHole"><span class="annot"><span class="annottext">kickOutAfterFillingCoercionHole :: CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#kickOutAfterFillingCoercionHole"><span class="hs-identifier hs-var hs-var">kickOutAfterFillingCoercionHole</span></a></span></span><span> </span><span id="local-6989586621681333008"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681333008"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span id="local-6989586621681333007"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681333007"><span class="hs-identifier hs-var">filled_co</span></a></span></span><span>
</span><span id="line-2152"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681333006"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333006"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2153"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681333005"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333005"><span class="hs-identifier hs-var">kicked_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681333004"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333004"><span class="hs-identifier hs-var">ics'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; (WorkList, InertCans)
</span><a href="#local-6989586621681333003"><span class="hs-identifier hs-var">kick_out</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333006"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-2154"></span><span>             </span><span id="local-6989586621681333002"><span class="annot"><span class="annottext">n_kicked :: Int
</span><a href="#local-6989586621681333002"><span class="hs-identifier hs-var hs-var">n_kicked</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; Int
</span><a href="GHC.Tc.Solver.Monad.html#workListSize"><span class="hs-identifier hs-var">workListSize</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333005"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-2155"></span><span>
</span><span id="line-2156"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681333002"><span class="hs-identifier hs-var">n_kicked</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2157"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkList -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#appendWorkList"><span class="hs-identifier hs-var">appendWorkList</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333005"><span class="hs-identifier hs-var">kicked_out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2158"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-var">csTraceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2159"></span><span>              </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Kick out, hole =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681333008"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>                 </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;n-kicked =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681333002"><span class="hs-identifier hs-var">n_kicked</span></a></span><span>
</span><span id="line-2161"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kicked_out =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681333005"><span class="hs-identifier hs-var">kicked_out</span></a></span><span>
</span><span id="line-2162"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Residual inerts =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333004"><span class="hs-identifier hs-var">ics'</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2163"></span><span>
</span><span id="line-2164"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-var">setInertCans</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681333004"><span class="hs-identifier hs-var">ics'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2166"></span><span>    </span><span id="local-6989586621681333001"><span class="annot"><span class="annottext">holes_of_co :: UniqSet CoercionHole
</span><a href="#local-6989586621681333001"><span class="hs-identifier hs-var hs-var">holes_of_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; UniqSet CoercionHole
</span><a href="GHC.Core.Coercion.html#coercionHolesOfCo"><span class="hs-identifier hs-var">coercionHolesOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681333007"><span class="hs-identifier hs-var">filled_co</span></a></span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span>    </span><span class="annot"><a href="#local-6989586621681333003"><span class="hs-identifier hs-type">kick_out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2169"></span><span>    </span><span id="local-6989586621681333003"><span class="annot"><span class="annottext">kick_out :: InertCans -&gt; (WorkList, InertCans)
</span><a href="#local-6989586621681333003"><span class="hs-identifier hs-var hs-var">kick_out</span></a></span></span><span> </span><span id="local-6989586621681332999"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621681332999"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_blocked :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var">inert_blocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332998"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332998"><span class="hs-identifier hs-var">blocked</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2170"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332997"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332997"><span class="hs-identifier hs-var">to_kick</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332996"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332996"><span class="hs-identifier hs-var">to_keep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; Either b c) -&gt; Bag a -&gt; (Bag b, Bag c)
</span><a href="GHC.Data.Bag.html#partitionBagWith"><span class="hs-identifier hs-var">partitionBagWith</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Either Ct Ct
</span><a href="#local-6989586621681332994"><span class="hs-identifier hs-var">kick_ct</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332998"><span class="hs-identifier hs-var">blocked</span></a></span><span>
</span><span id="line-2171"></span><span>
</span><span id="line-2172"></span><span>            </span><span id="local-6989586621681332993"><span class="annot"><span class="annottext">kicked_out :: WorkList
</span><a href="#local-6989586621681332993"><span class="hs-identifier hs-var hs-var">kicked_out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListCts"><span class="hs-identifier hs-var">extendWorkListCts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332997"><span class="hs-identifier hs-var">to_kick</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a></span><span>
</span><span id="line-2173"></span><span>            </span><span id="local-6989586621681332992"><span class="annot"><span class="annottext">ics' :: InertCans
</span><a href="#local-6989586621681332992"><span class="hs-identifier hs-var hs-var">ics'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332999"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_blocked :: Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var">inert_blocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332996"><span class="hs-identifier hs-var">to_keep</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2174"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-2175"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681332993"><span class="hs-identifier hs-var">kicked_out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332992"><span class="hs-identifier hs-var">ics'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2176"></span><span>
</span><span id="line-2177"></span><span>    </span><span class="annot"><a href="#local-6989586621681332994"><span class="hs-identifier hs-type">kick_ct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-2178"></span><span>         </span><span class="hs-comment">-- Left: kick out; Right: keep. But even if we keep, we may need</span><span>
</span><span id="line-2179"></span><span>         </span><span class="hs-comment">-- to update the set of blocking holes</span><span>
</span><span id="line-2180"></span><span>    </span><span id="local-6989586621681332994"><span class="annot"><span class="annottext">kick_ct :: Ct -&gt; Either Ct Ct
</span><a href="#local-6989586621681332994"><span class="hs-identifier hs-var hs-var">kick_ct</span></a></span></span><span> </span><span id="local-6989586621681332991"><span class="annot"><span class="annottext">ct :: Ct
</span><a href="#local-6989586621681332991"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_reason :: Ct -&gt; CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#cc_reason"><span class="hs-identifier hs-var">cc_reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleBlockerReason"><span class="hs-identifier hs-type">HoleBlockerReason</span></a></span><span> </span><span id="local-6989586621681332990"><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621681332990"><span class="hs-identifier hs-var">holes</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2181"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681333008"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621681332990"><span class="hs-identifier hs-var">holes</span></a></span><span>
</span><span id="line-2182"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332988"><span class="annot"><span class="annottext">new_holes :: UniqSet CoercionHole
</span><a href="#local-6989586621681332988"><span class="hs-identifier hs-var hs-var">new_holes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621681332990"><span class="hs-identifier hs-var">holes</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; UniqSet a -&gt; a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#delOneFromUniqSet"><span class="hs-operator hs-var">`delOneFromUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681333008"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-2183"></span><span>                              </span><span class="annot"><span class="annottext">forall a. UniqSet a -&gt; UniqSet a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#unionUniqSets"><span class="hs-operator hs-var">`unionUniqSets`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621681333001"><span class="hs-identifier hs-var">holes_of_co</span></a></span><span>
</span><span id="line-2184"></span><span>            </span><span id="local-6989586621681332985"><span class="annot"><span class="annottext">updated_ct :: Ct
</span><a href="#local-6989586621681332985"><span class="hs-identifier hs-var hs-var">updated_ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332991"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_reason :: CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#cc_reason"><span class="hs-identifier hs-var">cc_reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet CoercionHole -&gt; CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#HoleBlockerReason"><span class="hs-identifier hs-var">HoleBlockerReason</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621681332988"><span class="hs-identifier hs-var">new_holes</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2185"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-2186"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall a. UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#isEmptyUniqSet"><span class="hs-identifier hs-var">isEmptyUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet CoercionHole
</span><a href="#local-6989586621681332988"><span class="hs-identifier hs-var">new_holes</span></a></span><span>
</span><span id="line-2187"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332985"><span class="hs-identifier hs-var">updated_ct</span></a></span><span>
</span><span id="line-2188"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332985"><span class="hs-identifier hs-var">updated_ct</span></a></span><span>
</span><span id="line-2189"></span><span>
</span><span id="line-2190"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2191"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.3.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332991"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-2192"></span><span>
</span><span id="line-2193"></span><span>    </span><span class="annot"><a href="#local-6989586621681332994"><span class="hs-identifier hs-var">kick_ct</span></a></span><span> </span><span id="local-6989586621681332983"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332983"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kickOutAfterFillingCoercionHole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332983"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2194"></span><span>
</span><span id="line-2195"></span><span class="hs-comment">{- Note [kickOutRewritable]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [inert_eqs: the inert equalities].

When we add a new inert equality (lhs ~N ty) to the inert set,
we must kick out any inert items that could be rewritten by the
new equality, to maintain the inert-set invariants.

  - We want to kick out an existing inert constraint if
    a) the new constraint can rewrite the inert one
    b) 'lhs' is free in the inert constraint (so that it *will*)
       rewrite it if we kick it out.

    For (b) we use anyRewritableCanLHS, which examines the types /and
    kinds/ that are directly visible in the type. Hence
    we will have exposed all the rewriting we care about to make the
    most precise kinds visible for matching classes etc. No need to
    kick out constraints that mention type variables whose kinds
    contain this LHS!

  - A Derived equality can kick out [D] constraints in inert_eqs,
    inert_dicts, inert_irreds etc.

  - We don't kick out constraints from inert_solved_dicts, and
    inert_solved_funeqs optimistically. But when we lookup we have to
    take the substitution into account

NB: we could in principle avoid kick-out:
  a) When unifying a meta-tyvar from an outer level, because
     then the entire implication will be iterated; see
     Note [The Unification Level Flag]

  b) For Givens, after a unification.  By (GivenInv) in GHC.Tc.Utils.TcType
     Note [TcLevel invariants], a Given can't include a meta-tyvar from
     its own level, so it falls under (a).  Of course, we must still
     kick out Givens when adding a new non-unification Given.

But kicking out more vigorously may lead to earlier unification and fewer
iterations, so we don't take advantage of these possibilities.

Note [Rewrite insolubles]
~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have an insoluble alpha ~ [alpha], which is insoluble
because an occurs check.  And then we unify alpha := [Int].  Then we
really want to rewrite the insoluble to [Int] ~ [[Int]].  Now it can
be decomposed.  Otherwise we end up with a &quot;Can't match [Int] ~
[[Int]]&quot; which is true, but a bit confusing because the outer type
constructors match.

Hence:
 * In the main simplifier loops in GHC.Tc.Solver (solveWanteds,
   simpl_loop), we feed the insolubles in solveSimpleWanteds,
   so that they get rewritten (albeit not solved).

 * We kick insolubles out of the inert set, if they can be
   rewritten (see GHC.Tc.Solver.Monad.kick_out_rewritable)

 * We rewrite those insolubles in GHC.Tc.Solver.Canonical.
   See Note [Make sure that insolubles are fully rewritten]
-}</span><span>
</span><span id="line-2255"></span><span>
</span><span id="line-2256"></span><span>
</span><span id="line-2257"></span><span>
</span><span id="line-2258"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-2259"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier hs-type">addInertSafehask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-2260"></span><span id="addInertSafehask"><span class="annot"><span class="annottext">addInertSafehask :: InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier hs-var hs-var">addInertSafehask</span></a></span></span><span> </span><span id="local-6989586621681332982"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332982"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span id="local-6989586621681332981"><span class="annot"><span class="annottext">item :: Ct
</span><a href="#local-6989586621681332981"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332980"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332980"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332979"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332979"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332982"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap Ct -&gt; Class -&gt; [Type] -&gt; Ct -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#addDictCt"><span class="hs-identifier hs-var">addDictCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332982"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332980"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332979"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332981"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2262"></span><span>
</span><span id="line-2263"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier hs-var">addInertSafehask</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681332978"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332978"><span class="hs-identifier hs-var">item</span></a></span></span><span>
</span><span id="line-2264"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addInertSafehask: can't happen! Inserting &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332978"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-2265"></span><span>
</span><span id="line-2266"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier hs-type">insertSafeOverlapFailureTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2267"></span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation] in GHC.Tc.Solver</span><span>
</span><span id="line-2268"></span><span id="insertSafeOverlapFailureTcS"><span class="annot"><span class="annottext">insertSafeOverlapFailureTcS :: InstanceWhat -&gt; Ct -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#insertSafeOverlapFailureTcS"><span class="hs-identifier hs-var hs-var">insertSafeOverlapFailureTcS</span></a></span></span><span> </span><span id="local-6989586621681332977"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621681332977"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621681332976"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332976"><span class="hs-identifier hs-var">item</span></a></span></span><span>
</span><span id="line-2269"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">InstanceWhat -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#safeOverlap"><span class="hs-identifier hs-var">safeOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621681332977"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2270"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681332975"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332975"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#addInertSafehask"><span class="hs-identifier hs-var">addInertSafehask</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332975"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332976"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2271"></span><span>
</span><span id="line-2272"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSafeOverlapFailures"><span class="hs-identifier hs-type">getSafeOverlapFailures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-2273"></span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation] in GHC.Tc.Solver</span><span>
</span><span id="line-2274"></span><span id="getSafeOverlapFailures"><span class="annot"><span class="annottext">getSafeOverlapFailures :: TcS (Bag Ct)
</span><a href="GHC.Tc.Solver.Monad.html#getSafeOverlapFailures"><span class="hs-identifier hs-var hs-var">getSafeOverlapFailures</span></a></span></span><span>
</span><span id="line-2275"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332974"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332974"><span class="hs-identifier hs-var">safehask</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2276"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#consCts"><span class="hs-identifier hs-var">consCts</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332974"><span class="hs-identifier hs-var">safehask</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2277"></span><span>
</span><span id="line-2278"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-2279"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addSolvedDict"><span class="hs-identifier hs-type">addSolvedDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2280"></span><span class="hs-comment">-- Conditionally add a new item in the solved set of the monad</span><span>
</span><span id="line-2281"></span><span class="hs-comment">-- See Note [Solved dictionaries]</span><span>
</span><span id="line-2282"></span><span id="addSolvedDict"><span class="annot"><span class="annottext">addSolvedDict :: InstanceWhat -&gt; CtEvidence -&gt; Class -&gt; [Type] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addSolvedDict"><span class="hs-identifier hs-var hs-var">addSolvedDict</span></a></span></span><span> </span><span id="local-6989586621681332972"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621681332972"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621681332971"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332971"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span id="local-6989586621681332970"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332970"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332969"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332969"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2283"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isWanted"><span class="hs-identifier hs-var">isWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332971"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-2284"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InstanceWhat -&gt; Bool
</span><a href="GHC.Tc.Instance.Class.html#instanceReturnsDictCon"><span class="hs-identifier hs-var">instanceReturnsDictCon</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621681332972"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-2285"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;updSolvedSetTcs:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332971"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-2286"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332967"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332967"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2287"></span><span>             </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332967"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Class -&gt; [Type] -&gt; a -&gt; DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332967"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332970"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332969"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332971"><span class="hs-identifier hs-var">item</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2288"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2289"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getSolvedDicts"><span class="hs-identifier hs-type">getSolvedDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2292"></span><span id="getSolvedDicts"><span class="annot"><span class="annottext">getSolvedDicts :: TcS (DictMap CtEvidence)
</span><a href="GHC.Tc.Solver.Monad.html#getSolvedDicts"><span class="hs-identifier hs-var hs-var">getSolvedDicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332966"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332966"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332966"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2293"></span><span>
</span><span id="line-2294"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setSolvedDicts"><span class="hs-identifier hs-type">setSolvedDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2295"></span><span id="setSolvedDicts"><span class="annot"><span class="annottext">setSolvedDicts :: DictMap CtEvidence -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setSolvedDicts"><span class="hs-identifier hs-var hs-var">setSolvedDicts</span></a></span></span><span> </span><span id="local-6989586621681332965"><span class="annot"><span class="annottext">DictMap CtEvidence
</span><a href="#local-6989586621681332965"><span class="hs-identifier hs-var">solved_dicts</span></a></span></span><span>
</span><span id="line-2296"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332964"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332964"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2297"></span><span>    </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332964"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap CtEvidence
</span><a href="#local-6989586621681332965"><span class="hs-identifier hs-var">solved_dicts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2298"></span><span>
</span><span id="line-2299"></span><span>
</span><span id="line-2300"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                  Other inert-set operations
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-2305"></span><span>
</span><span id="line-2306"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-type">updInertTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2307"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-2308"></span><span id="updInertTcS"><span class="annot"><span class="annottext">updInertTcS :: (InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-var hs-var">updInertTcS</span></a></span></span><span> </span><span id="local-6989586621681332963"><span class="annot"><span class="annottext">InertSet -&gt; InertSet
</span><a href="#local-6989586621681332963"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-2309"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332962"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332962"><span class="hs-identifier hs-var">is_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a></span><span>
</span><span id="line-2310"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332960"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332960"><span class="hs-identifier hs-var">curr_inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332962"><span class="hs-identifier hs-var">is_var</span></a></span><span>
</span><span id="line-2311"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332962"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertSet
</span><a href="#local-6989586621681332963"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332960"><span class="hs-identifier hs-var">curr_inert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2312"></span><span>
</span><span id="line-2313"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-type">getInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-2314"></span><span id="getInertCans"><span class="annot"><span class="annottext">getInertCans :: TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var hs-var">getInertCans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332958"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332958"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332958"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2315"></span><span>
</span><span id="line-2316"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-type">setInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2317"></span><span id="setInertCans"><span class="annot"><span class="annottext">setInertCans :: InertCans -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setInertCans"><span class="hs-identifier hs-var hs-var">setInertCans</span></a></span></span><span> </span><span id="local-6989586621681332957"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332957"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332956"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332956"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332956"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332957"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2318"></span><span>
</span><span id="line-2319"></span><span id="local-6989586621681334393"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updRetInertCans"><span class="hs-identifier hs-type">updRetInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681334393"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334393"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2320"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-2321"></span><span id="updRetInertCans"><span class="annot"><span class="annottext">updRetInertCans :: forall a. (InertCans -&gt; (a, InertCans)) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#updRetInertCans"><span class="hs-identifier hs-var hs-var">updRetInertCans</span></a></span></span><span> </span><span id="local-6989586621681332950"><span class="annot"><span class="annottext">InertCans -&gt; (a, InertCans)
</span><a href="#local-6989586621681332950"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-2322"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332949"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332949"><span class="hs-identifier hs-var">is_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a></span><span>
</span><span id="line-2323"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332948"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332948"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332949"><span class="hs-identifier hs-var">is_var</span></a></span><span>
</span><span id="line-2324"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332947"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332947"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332946"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332946"><span class="hs-identifier hs-var">cans'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; (a, InertCans)
</span><a href="#local-6989586621681332950"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332948"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2325"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332949"><span class="hs-identifier hs-var">is_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332948"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332946"><span class="hs-identifier hs-var">cans'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2326"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332947"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2327"></span><span>
</span><span id="line-2328"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-type">updInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2329"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-2330"></span><span id="updInertCans"><span class="annot"><span class="annottext">updInertCans :: (InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var hs-var">updInertCans</span></a></span></span><span> </span><span id="local-6989586621681332945"><span class="annot"><span class="annottext">InertCans -&gt; InertCans
</span><a href="#local-6989586621681332945"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-2331"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332944"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332944"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332944"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; InertCans
</span><a href="#local-6989586621681332945"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332944"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2332"></span><span>
</span><span id="line-2333"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertDicts"><span class="hs-identifier hs-type">updInertDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2334"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-2335"></span><span id="updInertDicts"><span class="annot"><span class="annottext">updInertDicts :: (DictMap Ct -&gt; DictMap Ct) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertDicts"><span class="hs-identifier hs-var hs-var">updInertDicts</span></a></span></span><span> </span><span id="local-6989586621681332943"><span class="annot"><span class="annottext">DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332943"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-2336"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332942"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332942"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332942"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332943"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332942"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2337"></span><span>
</span><span id="line-2338"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertSafehask"><span class="hs-identifier hs-type">updInertSafehask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2339"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-2340"></span><span id="updInertSafehask"><span class="annot"><span class="annottext">updInertSafehask :: (DictMap Ct -&gt; DictMap Ct) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertSafehask"><span class="hs-identifier hs-var hs-var">updInertSafehask</span></a></span></span><span> </span><span id="local-6989586621681332941"><span class="annot"><span class="annottext">DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332941"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-2341"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332940"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332940"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332940"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332941"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332940"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2342"></span><span>
</span><span id="line-2343"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updInertIrreds"><span class="hs-identifier hs-type">updInertIrreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2344"></span><span class="hs-comment">-- Modify the inert set with the supplied function</span><span>
</span><span id="line-2345"></span><span id="updInertIrreds"><span class="annot"><span class="annottext">updInertIrreds :: (Bag Ct -&gt; Bag Ct) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertIrreds"><span class="hs-identifier hs-var hs-var">updInertIrreds</span></a></span></span><span> </span><span id="local-6989586621681332939"><span class="annot"><span class="annottext">Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332939"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span>
</span><span id="line-2346"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertCans"><span class="hs-identifier hs-var">updInertCans</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332938"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332938"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332938"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332939"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332938"><span class="hs-identifier hs-var">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2347"></span><span>
</span><span id="line-2348"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertEqs"><span class="hs-identifier hs-type">getInertEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#DTyVarEnv"><span class="hs-identifier hs-type">DTyVarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2349"></span><span id="getInertEqs"><span class="annot"><span class="annottext">getInertEqs :: TcS InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#getInertEqs"><span class="hs-identifier hs-var hs-var">getInertEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332937"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332937"><span class="hs-identifier hs-var">inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332937"><span class="hs-identifier hs-var">inert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2350"></span><span>
</span><span id="line-2351"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInnermostGivenEqLevel"><span class="hs-identifier hs-type">getInnermostGivenEqLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-2352"></span><span id="getInnermostGivenEqLevel"><span class="annot"><span class="annottext">getInnermostGivenEqLevel :: TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getInnermostGivenEqLevel"><span class="hs-identifier hs-var hs-var">getInnermostGivenEqLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332936"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332936"><span class="hs-identifier hs-var">inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2353"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332936"><span class="hs-identifier hs-var">inert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2354"></span><span>
</span><span id="line-2355"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertInsols"><span class="hs-identifier hs-type">getInertInsols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-2356"></span><span class="hs-comment">-- Returns insoluble equality constraints</span><span>
</span><span id="line-2357"></span><span class="hs-comment">-- specifically including Givens</span><span>
</span><span id="line-2358"></span><span id="getInertInsols"><span class="annot"><span class="annottext">getInertInsols :: TcS (Bag Ct)
</span><a href="GHC.Tc.Solver.Monad.html#getInertInsols"><span class="hs-identifier hs-var hs-var">getInertInsols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332935"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332935"><span class="hs-identifier hs-var">inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2359"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#insolubleEqCt"><span class="hs-identifier hs-var">insolubleEqCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332935"><span class="hs-identifier hs-var">inert</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2360"></span><span>
</span><span id="line-2361"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier hs-type">getInertGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2362"></span><span class="hs-comment">-- Returns the Given constraints in the inert set</span><span>
</span><span id="line-2363"></span><span id="getInertGivens"><span class="annot"><span class="annottext">getInertGivens :: TcS [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#getInertGivens"><span class="hs-identifier hs-var hs-var">getInertGivens</span></a></span></span><span>
</span><span id="line-2364"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332932"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332932"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2365"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332931"><span class="annot"><span class="annottext">all_cts :: [Ct]
</span><a href="#local-6989586621681332931"><span class="hs-identifier hs-var hs-var">all_cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332932"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2366"></span><span>                     </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681332930"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681332930"><span class="hs-identifier hs-var">ecl</span></a></span></span><span> </span><span id="local-6989586621681332929"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332929"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-var">equalCtListToList</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681332930"><span class="hs-identifier hs-var">ecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332929"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2367"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332932"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2368"></span><span>                     </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-var">equalCtListToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. DVarEnv a -&gt; [a]
</span><a href="GHC.Types.Var.Env.html#dVarEnvElts"><span class="hs-identifier hs-var">dVarEnvElts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332932"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2369"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332931"><span class="hs-identifier hs-var">all_cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2370"></span><span>
</span><span id="line-2371"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getPendingGivenScs"><span class="hs-identifier hs-type">getPendingGivenScs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2372"></span><span class="hs-comment">-- Find all inert Given dictionaries, or quantified constraints,</span><span>
</span><span id="line-2373"></span><span class="hs-comment">--     whose cc_pend_sc flag is True</span><span>
</span><span id="line-2374"></span><span class="hs-comment">--     and that belong to the current level</span><span>
</span><span id="line-2375"></span><span class="hs-comment">-- Set their cc_pend_sc flag to False in the inert set, and return that Ct</span><span>
</span><span id="line-2376"></span><span id="getPendingGivenScs"><span class="annot"><span class="annottext">getPendingGivenScs :: TcS [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#getPendingGivenScs"><span class="hs-identifier hs-var hs-var">getPendingGivenScs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332926"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332926"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-2377"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. (InertCans -&gt; (a, InertCans)) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#updRetInertCans"><span class="hs-identifier hs-var">updRetInertCans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; InertCans -&gt; ([Ct], InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#get_sc_pending"><span class="hs-identifier hs-var">get_sc_pending</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332926"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2378"></span><span>
</span><span id="line-2379"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#get_sc_pending"><span class="hs-identifier hs-type">get_sc_pending</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2380"></span><span id="get_sc_pending"><span class="annot"><span class="annottext">get_sc_pending :: TcLevel -&gt; InertCans -&gt; ([Ct], InertCans)
</span><a href="GHC.Tc.Solver.Monad.html#get_sc_pending"><span class="hs-identifier hs-var hs-var">get_sc_pending</span></a></span></span><span> </span><span id="local-6989586621681332924"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332924"><span class="hs-identifier hs-var">this_lvl</span></a></span></span><span> </span><span id="local-6989586621681332923"><span class="annot"><span class="annottext">ic :: InertCans
</span><a href="#local-6989586621681332923"><span class="hs-identifier hs-var">ic</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332922"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332922"><span class="hs-identifier hs-var">dicts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332921"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681332921"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2381"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">isGivenCt</span><span> </span><span class="hs-identifier">sc_pending</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">sc_pending</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2382"></span><span>       </span><span class="hs-comment">-- When getPendingScDics is called,</span><span>
</span><span id="line-2383"></span><span>       </span><span class="hs-comment">-- there are never any Wanteds in the inert set</span><span>
</span><span id="line-2384"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332918"><span class="hs-identifier hs-var">sc_pending</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332923"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332916"><span class="hs-identifier hs-var">dicts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: [QCInst]
</span><a href="GHC.Tc.Solver.Monad.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681332915"><span class="hs-identifier hs-var">insts'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2385"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2386"></span><span>    </span><span id="local-6989586621681332918"><span class="annot"><span class="annottext">sc_pending :: [Ct]
</span><a href="#local-6989586621681332918"><span class="hs-identifier hs-var hs-var">sc_pending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332914"><span class="hs-identifier hs-var">sc_pend_insts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332913"><span class="hs-identifier hs-var">sc_pend_dicts</span></a></span><span>
</span><span id="line-2387"></span><span>
</span><span id="line-2388"></span><span>    </span><span id="local-6989586621681332913"><span class="annot"><span class="annottext">sc_pend_dicts :: [Ct]
</span><a href="#local-6989586621681332913"><span class="hs-identifier hs-var hs-var">sc_pend_dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; [Ct] -&gt; [Ct]
</span><a href="#local-6989586621681332912"><span class="hs-identifier hs-var">get_pending</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332922"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2389"></span><span>    </span><span id="local-6989586621681332916"><span class="annot"><span class="annottext">dicts' :: DictMap Ct
</span><a href="#local-6989586621681332916"><span class="hs-identifier hs-var hs-var">dicts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332911"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332922"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332913"><span class="hs-identifier hs-var">sc_pend_dicts</span></a></span><span>
</span><span id="line-2390"></span><span>
</span><span id="line-2391"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681332914"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332914"><span class="hs-identifier hs-var">sc_pend_insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332915"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681332915"><span class="hs-identifier hs-var">insts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; QCInst -&gt; ([Ct], QCInst)
</span><a href="#local-6989586621681332910"><span class="hs-identifier hs-var">get_pending_inst</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621681332921"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-2392"></span><span>
</span><span id="line-2393"></span><span>    </span><span class="annot"><a href="#local-6989586621681332912"><span class="hs-identifier hs-type">get_pending</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Get dicts with cc_pend_sc = True</span><span>
</span><span id="line-2394"></span><span>                                       </span><span class="hs-comment">-- but flipping the flag</span><span>
</span><span id="line-2395"></span><span>    </span><span id="local-6989586621681332912"><span class="annot"><span class="annottext">get_pending :: Ct -&gt; [Ct] -&gt; [Ct]
</span><a href="#local-6989586621681332912"><span class="hs-identifier hs-var hs-var">get_pending</span></a></span></span><span> </span><span id="local-6989586621681332909"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332909"><span class="hs-identifier hs-var">dict</span></a></span></span><span> </span><span id="local-6989586621681332908"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332908"><span class="hs-identifier hs-var">dicts</span></a></span></span><span>
</span><span id="line-2396"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332907"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332907"><span class="hs-identifier hs-var">dict'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Maybe Ct
</span><a href="GHC.Tc.Types.Constraint.html#isPendingScDict"><span class="hs-identifier hs-var">isPendingScDict</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332909"><span class="hs-identifier hs-var">dict</span></a></span><span>
</span><span id="line-2397"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="#local-6989586621681332905"><span class="hs-identifier hs-var">belongs_to_this_level</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332909"><span class="hs-identifier hs-var">dict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2398"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332907"><span class="hs-identifier hs-var">dict'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332908"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-2399"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2400"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332908"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-2401"></span><span>
</span><span id="line-2402"></span><span>    </span><span class="annot"><a href="#local-6989586621681332911"><span class="hs-identifier hs-type">add</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-2403"></span><span>    </span><span id="local-6989586621681332911"><span class="annot"><span class="annottext">add :: Ct -&gt; DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332911"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621681332904"><span class="annot"><span class="annottext">ct :: Ct
</span><a href="#local-6989586621681332904"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332903"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332903"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332902"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332902"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332901"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332901"><span class="hs-identifier hs-var">dicts</span></a></span></span><span>
</span><span id="line-2404"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap Ct -&gt; Class -&gt; [Type] -&gt; Ct -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#addDictCt"><span class="hs-identifier hs-var">addDictCt</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332901"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332903"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332902"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332904"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-2405"></span><span>    </span><span class="annot"><a href="#local-6989586621681332911"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span id="local-6989586621681332900"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332900"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getPendingScDicts&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332900"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2406"></span><span>
</span><span id="line-2407"></span><span>    </span><span class="annot"><a href="#local-6989586621681332910"><span class="hs-identifier hs-type">get_pending_inst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2408"></span><span>    </span><span id="local-6989586621681332910"><span class="annot"><span class="annottext">get_pending_inst :: [Ct] -&gt; QCInst -&gt; ([Ct], QCInst)
</span><a href="#local-6989586621681332910"><span class="hs-identifier hs-var hs-var">get_pending_inst</span></a></span></span><span> </span><span id="local-6989586621681332899"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332899"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621681332898"><span class="annot"><span class="annottext">qci :: QCInst
</span><a href="#local-6989586621681332898"><span class="hs-identifier hs-var">qci</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_ev :: QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332896"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332896"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2409"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332895"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681332895"><span class="hs-identifier hs-var">qci'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Maybe QCInst
</span><a href="GHC.Tc.Types.Constraint.html#isPendingScInst"><span class="hs-identifier hs-var">isPendingScInst</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681332898"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-2410"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="#local-6989586621681332905"><span class="hs-identifier hs-var">belongs_to_this_level</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332896"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2411"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-var">CQuantCan</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681332895"><span class="hs-identifier hs-var">qci'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332899"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681332895"><span class="hs-identifier hs-var">qci'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2412"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2413"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332899"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621681332898"><span class="hs-identifier hs-var">qci</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2414"></span><span>
</span><span id="line-2415"></span><span>    </span><span id="local-6989586621681332905"><span class="annot"><span class="annottext">belongs_to_this_level :: CtEvidence -&gt; Bool
</span><a href="#local-6989586621681332905"><span class="hs-identifier hs-var hs-var">belongs_to_this_level</span></a></span></span><span> </span><span id="local-6989586621681332892"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332892"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcLevel
</span><a href="GHC.Tc.Types.Constraint.html#ctLocLevel"><span class="hs-identifier hs-var">ctLocLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332892"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332924"><span class="hs-identifier hs-var">this_lvl</span></a></span><span>
</span><span id="line-2416"></span><span>    </span><span class="hs-comment">-- We only want Givens from this level; see (3a) in</span><span>
</span><span id="line-2417"></span><span>    </span><span class="hs-comment">-- Note [The superclass story] in GHC.Tc.Solver.Canonical</span><span>
</span><span id="line-2418"></span><span>
</span><span id="line-2419"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getUnsolvedInerts"><span class="hs-identifier hs-type">getUnsolvedInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span>
</span><span id="line-2420"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- All simple constraints</span><span>
</span><span id="line-2421"></span><span class="hs-comment">-- Return all the unsolved [Wanted] or [Derived] constraints</span><span>
</span><span id="line-2422"></span><span class="hs-comment">--</span><span>
</span><span id="line-2423"></span><span class="hs-comment">-- Post-condition: the returned simple constraints are all fully zonked</span><span>
</span><span id="line-2424"></span><span class="hs-comment">--                     (because they come from the inert set)</span><span>
</span><span id="line-2425"></span><span class="hs-comment">--                 the unsolved implics may not be</span><span>
</span><span id="line-2426"></span><span id="getUnsolvedInerts"><span class="annot"><span class="annottext">getUnsolvedInerts :: TcS (Bag Implication, Bag Ct)
</span><a href="GHC.Tc.Solver.Monad.html#getUnsolvedInerts"><span class="hs-identifier hs-var hs-var">getUnsolvedInerts</span></a></span></span><span>
</span><span id="line-2427"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.Monad.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332889"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681332889"><span class="hs-identifier hs-var">tv_eqs</span></a></span></span><span>
</span><span id="line-2428"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332888"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681332888"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span>
</span><span id="line-2429"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332887"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332887"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-2430"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_blocked :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_blocked"><span class="hs-identifier hs-var">inert_blocked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332886"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332886"><span class="hs-identifier hs-var">blocked</span></a></span></span><span>
</span><span id="line-2431"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332885"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332885"><span class="hs-identifier hs-var">idicts</span></a></span></span><span>
</span><span id="line-2432"></span><span>           </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2433"></span><span>
</span><span id="line-2434"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332884"><span class="annot"><span class="annottext">unsolved_tv_eqs :: Bag Ct
</span><a href="#local-6989586621681332884"><span class="hs-identifier hs-var hs-var">unsolved_tv_eqs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b. (Ct -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332883"><span class="hs-identifier hs-var">add_if_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621681332889"><span class="hs-identifier hs-var">tv_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span>
</span><span id="line-2435"></span><span>            </span><span id="local-6989586621681332882"><span class="annot"><span class="annottext">unsolved_fun_eqs :: Bag Ct
</span><a href="#local-6989586621681332882"><span class="hs-identifier hs-var hs-var">unsolved_fun_eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332881"><span class="hs-identifier hs-var">add_if_unsolveds</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681332888"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span>
</span><span id="line-2436"></span><span>            </span><span id="local-6989586621681332880"><span class="annot"><span class="annottext">unsolved_irreds :: Bag Ct
</span><a href="#local-6989586621681332880"><span class="hs-identifier hs-var hs-var">unsolved_irreds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#filterBag"><span class="hs-identifier hs-var">Bag.filterBag</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681332879"><span class="hs-identifier hs-var">is_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332887"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-2437"></span><span>            </span><span id="local-6989586621681332878"><span class="annot"><span class="annottext">unsolved_blocked :: Bag Ct
</span><a href="#local-6989586621681332878"><span class="hs-identifier hs-var hs-var">unsolved_blocked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332886"><span class="hs-identifier hs-var">blocked</span></a></span><span>  </span><span class="hs-comment">-- all blocked equalities are W/D</span><span>
</span><span id="line-2438"></span><span>            </span><span id="local-6989586621681332877"><span class="annot"><span class="annottext">unsolved_dicts :: Bag Ct
</span><a href="#local-6989586621681332877"><span class="hs-identifier hs-var hs-var">unsolved_dicts</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldDicts"><span class="hs-identifier hs-var">foldDicts</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332883"><span class="hs-identifier hs-var">add_if_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332885"><span class="hs-identifier hs-var">idicts</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a></span><span>
</span><span id="line-2439"></span><span>            </span><span id="local-6989586621681332876"><span class="annot"><span class="annottext">unsolved_others :: Bag Ct
</span><a href="#local-6989586621681332876"><span class="hs-identifier hs-var hs-var">unsolved_others</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [Bag a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionManyBags"><span class="hs-identifier hs-var">unionManyBags</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332880"><span class="hs-identifier hs-var">unsolved_irreds</span></a></span><span>
</span><span id="line-2440"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332877"><span class="hs-identifier hs-var">unsolved_dicts</span></a></span><span>
</span><span id="line-2441"></span><span>                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332878"><span class="hs-identifier hs-var">unsolved_blocked</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2442"></span><span>
</span><span id="line-2443"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332874"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681332874"><span class="hs-identifier hs-var">implics</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (Bag Implication)
</span><a href="GHC.Tc.Solver.Monad.html#getWorkListImplics"><span class="hs-identifier hs-var">getWorkListImplics</span></a></span><span>
</span><span id="line-2444"></span><span>
</span><span id="line-2445"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getUnsolvedInerts&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2446"></span><span>        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; tv eqs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332884"><span class="hs-identifier hs-var">unsolved_tv_eqs</span></a></span><span>
</span><span id="line-2447"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fun eqs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332882"><span class="hs-identifier hs-var">unsolved_fun_eqs</span></a></span><span>
</span><span id="line-2448"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;others =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332876"><span class="hs-identifier hs-var">unsolved_others</span></a></span><span>
</span><span id="line-2449"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;implics =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681332874"><span class="hs-identifier hs-var">implics</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2450"></span><span>
</span><span id="line-2451"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681332874"><span class="hs-identifier hs-var">implics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332884"><span class="hs-identifier hs-var">unsolved_tv_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span>
</span><span id="line-2452"></span><span>                          </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332882"><span class="hs-identifier hs-var">unsolved_fun_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span>
</span><span id="line-2453"></span><span>                          </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332876"><span class="hs-identifier hs-var">unsolved_others</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2454"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2455"></span><span>    </span><span class="annot"><a href="#local-6989586621681332883"><span class="hs-identifier hs-type">add_if_unsolved</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-2456"></span><span>    </span><span id="local-6989586621681332883"><span class="annot"><span class="annottext">add_if_unsolved :: Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332883"><span class="hs-identifier hs-var hs-var">add_if_unsolved</span></a></span></span><span> </span><span id="local-6989586621681332872"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332872"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621681332871"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332871"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681332879"><span class="hs-identifier hs-var">is_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332872"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332872"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#consCts"><span class="hs-operator hs-var">`consCts`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332871"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-2457"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332871"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-2458"></span><span>
</span><span id="line-2459"></span><span>    </span><span class="annot"><a href="#local-6989586621681332881"><span class="hs-identifier hs-type">add_if_unsolveds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-2460"></span><span>    </span><span id="local-6989586621681332881"><span class="annot"><span class="annottext">add_if_unsolveds :: EqualCtList -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332881"><span class="hs-identifier hs-var hs-var">add_if_unsolveds</span></a></span></span><span> </span><span id="local-6989586621681332870"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681332870"><span class="hs-identifier hs-var">new_cts</span></a></span></span><span> </span><span id="local-6989586621681332869"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332869"><span class="hs-identifier hs-var">old_cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="#local-6989586621681332883"><span class="hs-identifier hs-var">add_if_unsolved</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332869"><span class="hs-identifier hs-var">old_cts</span></a></span><span>
</span><span id="line-2461"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqualCtList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.Monad.html#equalCtListToList"><span class="hs-identifier hs-var">equalCtListToList</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621681332870"><span class="hs-identifier hs-var">new_cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2462"></span><span>
</span><span id="line-2463"></span><span>    </span><span id="local-6989586621681332879"><span class="annot"><span class="annottext">is_unsolved :: Ct -&gt; Bool
</span><a href="#local-6989586621681332879"><span class="hs-identifier hs-var hs-var">is_unsolved</span></a></span></span><span> </span><span id="local-6989586621681332868"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332868"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332868"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Wanted or Derived</span><span>
</span><span id="line-2464"></span><span>
</span><span id="line-2465"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getHasGivenEqs"><span class="hs-identifier hs-type">getHasGivenEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>           </span><span class="hs-comment">-- TcLevel of this implication</span><span>
</span><span id="line-2466"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HasGivenEqs"><span class="hs-identifier hs-type">HasGivenEqs</span></a></span><span> </span><span class="hs-comment">-- are there Given equalities?</span><span>
</span><span id="line-2467"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Insoluble equalities arising from givens</span><span>
</span><span id="line-2468"></span><span class="hs-comment">-- See Note [Tracking Given equalities]</span><span>
</span><span id="line-2469"></span><span id="getHasGivenEqs"><span class="annot"><span class="annottext">getHasGivenEqs :: TcLevel -&gt; TcS (HasGivenEqs, Bag Ct)
</span><a href="GHC.Tc.Solver.Monad.html#getHasGivenEqs"><span class="hs-identifier hs-var hs-var">getHasGivenEqs</span></a></span></span><span> </span><span id="local-6989586621681332867"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332867"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span>
</span><span id="line-2470"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332866"><span class="annot"><span class="annottext">inerts :: InertCans
</span><a href="#local-6989586621681332866"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332865"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332865"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-2471"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: InertCans -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332864"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332864"><span class="hs-identifier hs-var">given_eqs</span></a></span></span><span>
</span><span id="line-2472"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332863"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332863"><span class="hs-identifier hs-var">ge_lvl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2473"></span><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertCans
</span><a href="GHC.Tc.Solver.Monad.html#getInertCans"><span class="hs-identifier hs-var">getInertCans</span></a></span><span>
</span><span id="line-2474"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332862"><span class="annot"><span class="annottext">insols :: Bag Ct
</span><a href="#local-6989586621681332862"><span class="hs-identifier hs-var hs-var">insols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#insolubleEqCt"><span class="hs-identifier hs-var">insolubleEqCt</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332865"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-2475"></span><span>                      </span><span class="hs-comment">-- Specifically includes ones that originated in some</span><span>
</span><span id="line-2476"></span><span>                      </span><span class="hs-comment">-- outer context but were refined to an insoluble by</span><span>
</span><span id="line-2477"></span><span>                      </span><span class="hs-comment">-- a local equality; so do /not/ add ct_given_here.</span><span>
</span><span id="line-2478"></span><span>
</span><span id="line-2479"></span><span>             </span><span class="hs-comment">-- See Note [HasGivenEqs] in GHC.Tc.Types.Constraint, and</span><span>
</span><span id="line-2480"></span><span>             </span><span class="hs-comment">-- Note [Tracking Given equalities] in this module</span><span>
</span><span id="line-2481"></span><span>             </span><span id="local-6989586621681332861"><span class="annot"><span class="annottext">has_ge :: HasGivenEqs
</span><a href="#local-6989586621681332861"><span class="hs-identifier hs-var hs-var">has_ge</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332863"><span class="hs-identifier hs-var">ge_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332867"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasGivenEqs
</span><a href="GHC.Tc.Types.Constraint.html#MaybeGivenEqs"><span class="hs-identifier hs-var">MaybeGivenEqs</span></a></span><span>
</span><span id="line-2482"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332864"><span class="hs-identifier hs-var">given_eqs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasGivenEqs
</span><a href="GHC.Tc.Types.Constraint.html#LocalGivenEqs"><span class="hs-identifier hs-var">LocalGivenEqs</span></a></span><span>
</span><span id="line-2483"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasGivenEqs
</span><a href="GHC.Tc.Types.Constraint.html#NoGivenEqs"><span class="hs-identifier hs-var">NoGivenEqs</span></a></span><span>
</span><span id="line-2484"></span><span>
</span><span id="line-2485"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getHasGivenEqs&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2486"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;given_eqs:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332864"><span class="hs-identifier hs-var">given_eqs</span></a></span><span>
</span><span id="line-2487"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ge_lvl:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332863"><span class="hs-identifier hs-var">ge_lvl</span></a></span><span>
</span><span id="line-2488"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ambient level:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332867"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-2489"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Inerts:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332866"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-2490"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Insols:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332862"><span class="hs-identifier hs-var">insols</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2491"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasGivenEqs
</span><a href="#local-6989586621681332861"><span class="hs-identifier hs-var">has_ge</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332862"><span class="hs-identifier hs-var">insols</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2492"></span><span>
</span><span id="line-2493"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#mentionsOuterVar"><span class="hs-identifier hs-type">mentionsOuterVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2494"></span><span id="mentionsOuterVar"><span class="annot"><span class="annottext">mentionsOuterVar :: TcLevel -&gt; CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#mentionsOuterVar"><span class="hs-identifier hs-var hs-var">mentionsOuterVar</span></a></span></span><span> </span><span id="local-6989586621681332857"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332857"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621681332856"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332856"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-2495"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfType"><span class="hs-identifier hs-var">anyFreeVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isOuterTyVar"><span class="hs-identifier hs-var">isOuterTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332857"><span class="hs-identifier hs-var">tclvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2496"></span><span>    </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332856"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2497"></span><span>
</span><span id="line-2498"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isOuterTyVar"><span class="hs-identifier hs-type">isOuterTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2499"></span><span class="hs-comment">-- True of a type variable that comes from a</span><span>
</span><span id="line-2500"></span><span class="hs-comment">-- shallower level than the ambient level (tclvl)</span><span>
</span><span id="line-2501"></span><span id="isOuterTyVar"><span class="annot"><span class="annottext">isOuterTyVar :: TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isOuterTyVar"><span class="hs-identifier hs-var hs-var">isOuterTyVar</span></a></span></span><span> </span><span id="local-6989586621681332853"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332853"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621681332852"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332852"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-2502"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332852"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isTouchableMetaTyVar</span><span> </span><span class="hs-identifier">tclvl</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tclvl</span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-2503"></span><span>                 </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332853"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332852"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2504"></span><span>    </span><span class="hs-comment">-- ASSERT: we are dealing with Givens here, and invariant (GivenInv) from</span><span>
</span><span id="line-2505"></span><span>    </span><span class="hs-comment">-- Note Note [TcLevel invariants] in GHC.Tc.Utils.TcType ensures that there can't</span><span>
</span><span id="line-2506"></span><span>    </span><span class="hs-comment">-- be a touchable meta tyvar.   If this wasn't true, you might worry that,</span><span>
</span><span id="line-2507"></span><span>    </span><span class="hs-comment">-- at level 3, a meta-tv alpha[3] gets unified with skolem b[2], and thereby</span><span>
</span><span id="line-2508"></span><span>    </span><span class="hs-comment">-- becomes &quot;outer&quot; even though its level numbers says it isn't.</span><span>
</span><span id="line-2509"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- Coercion variables; doesn't much matter</span><span>
</span><span id="line-2510"></span><span>
</span><span id="line-2511"></span><span class="hs-comment">-- | Returns Given constraints that might,</span><span>
</span><span id="line-2512"></span><span class="hs-comment">-- potentially, match the given pred. This is used when checking to see if a</span><span>
</span><span id="line-2513"></span><span class="hs-comment">-- Given might overlap with an instance. See Note [Instance and Given overlap]</span><span>
</span><span id="line-2514"></span><span class="hs-comment">-- in &quot;GHC.Tc.Solver.Interact&quot;</span><span>
</span><span id="line-2515"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchableGivens"><span class="hs-identifier hs-type">matchableGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-2516"></span><span id="matchableGivens"><span class="annot"><span class="annottext">matchableGivens :: CtLoc -&gt; Type -&gt; InertSet -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#matchableGivens"><span class="hs-identifier hs-var hs-var">matchableGivens</span></a></span></span><span> </span><span id="local-6989586621681332846"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332846"><span class="hs-identifier hs-var">loc_w</span></a></span></span><span> </span><span id="local-6989586621681332845"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332845"><span class="hs-identifier hs-var">pred_w</span></a></span></span><span> </span><span id="local-6989586621681332844"><span class="annot"><span class="annottext">inerts :: InertSet
</span><a href="#local-6989586621681332844"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332843"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332843"><span class="hs-identifier hs-var">inert_cans</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2517"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681332842"><span class="hs-identifier hs-var">matchable_given</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332841"><span class="hs-identifier hs-var">all_relevant_givens</span></a></span><span>
</span><span id="line-2518"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2519"></span><span>    </span><span class="hs-comment">-- just look in class constraints and irreds. matchableGivens does get called</span><span>
</span><span id="line-2520"></span><span>    </span><span class="hs-comment">-- for ~R constraints, but we don't need to look through equalities, because</span><span>
</span><span id="line-2521"></span><span>    </span><span class="hs-comment">-- canonical equalities are used for rewriting. We'll only get caught by</span><span>
</span><span id="line-2522"></span><span>    </span><span class="hs-comment">-- non-canonical -- that is, irreducible -- equalities.</span><span>
</span><span id="line-2523"></span><span>    </span><span class="annot"><a href="#local-6989586621681332841"><span class="hs-identifier hs-type">all_relevant_givens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-2524"></span><span>    </span><span id="local-6989586621681332841"><span class="annot"><span class="annottext">all_relevant_givens :: Bag Ct
</span><a href="#local-6989586621681332841"><span class="hs-identifier hs-var hs-var">all_relevant_givens</span></a></span></span><span>
</span><span id="line-2525"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332840"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332840"><span class="hs-identifier hs-var">clas</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Class, [Type])
</span><a href="GHC.Core.Predicate.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332845"><span class="hs-identifier hs-var">pred_w</span></a></span><span>
</span><span id="line-2526"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Class -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#findDictsByClass"><span class="hs-identifier hs-var">findDictsByClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332843"><span class="hs-identifier hs-var">inert_cans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332840"><span class="hs-identifier hs-var">clas</span></a></span><span>
</span><span id="line-2527"></span><span>        </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332843"><span class="hs-identifier hs-var">inert_cans</span></a></span><span>
</span><span id="line-2528"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2529"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; Bag Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332843"><span class="hs-identifier hs-var">inert_cans</span></a></span><span>
</span><span id="line-2530"></span><span>
</span><span id="line-2531"></span><span>    </span><span class="annot"><a href="#local-6989586621681332842"><span class="hs-identifier hs-type">matchable_given</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2532"></span><span>    </span><span id="local-6989586621681332842"><span class="annot"><span class="annottext">matchable_given :: Ct -&gt; Bool
</span><a href="#local-6989586621681332842"><span class="hs-identifier hs-var hs-var">matchable_given</span></a></span></span><span> </span><span id="local-6989586621681332838"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332838"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-2533"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332837"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332837"><span class="hs-identifier hs-var">loc_g</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332836"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332836"><span class="hs-identifier hs-var">pred_g</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332838"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-2534"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; Type -&gt; CtLoc -&gt; Type -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#mightEqualLater"><span class="hs-identifier hs-var">mightEqualLater</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332844"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332836"><span class="hs-identifier hs-var">pred_g</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332837"><span class="hs-identifier hs-var">loc_g</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332845"><span class="hs-identifier hs-var">pred_w</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332846"><span class="hs-identifier hs-var">loc_w</span></a></span><span>
</span><span id="line-2535"></span><span>
</span><span id="line-2536"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2537"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2538"></span><span>
</span><span id="line-2539"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#mightEqualLater"><span class="hs-identifier hs-type">mightEqualLater</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2540"></span><span class="hs-comment">-- See Note [What might equal later?]</span><span>
</span><span id="line-2541"></span><span class="hs-comment">-- Used to implement logic in Note [Instance and Given overlap] in GHC.Tc.Solver.Interact</span><span>
</span><span id="line-2542"></span><span id="mightEqualLater"><span class="annot"><span class="annottext">mightEqualLater :: InertSet -&gt; Type -&gt; CtLoc -&gt; Type -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#mightEqualLater"><span class="hs-identifier hs-var hs-var">mightEqualLater</span></a></span></span><span> </span><span id="local-6989586621681332834"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332834"><span class="hs-identifier hs-var">inert_set</span></a></span></span><span> </span><span id="local-6989586621681332833"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332833"><span class="hs-identifier hs-var">given_pred</span></a></span></span><span> </span><span id="local-6989586621681332832"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332832"><span class="hs-identifier hs-var">given_loc</span></a></span></span><span> </span><span id="local-6989586621681332831"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332831"><span class="hs-identifier hs-var">wanted_pred</span></a></span></span><span> </span><span id="local-6989586621681332830"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332830"><span class="hs-identifier hs-var">wanted_loc</span></a></span></span><span>
</span><span id="line-2543"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var">prohibitedSuperClassSolve</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332832"><span class="hs-identifier hs-var">given_loc</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332830"><span class="hs-identifier hs-var">wanted_loc</span></a></span><span>
</span><span id="line-2544"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2545"></span><span>
</span><span id="line-2546"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2547"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BindFun -&gt; [Type] -&gt; [Type] -&gt; UnifyResult
</span><a href="GHC.Core.Unify.html#tcUnifyTysFG"><span class="hs-identifier hs-var">tcUnifyTysFG</span></a></span><span> </span><span class="annot"><span class="annottext">BindFun
</span><a href="#local-6989586621681332828"><span class="hs-identifier hs-var">bind_fun</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332827"><span class="hs-identifier hs-var">flattened_given</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332826"><span class="hs-identifier hs-var">flattened_wanted</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2548"></span><span>      </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="GHC.Core.Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- types that are surely apart do not equal later</span><span>
</span><span id="line-2549"></span><span>      </span><span class="annot"><a href="GHC.Core.Unify.html#MaybeApart"><span class="hs-identifier hs-type">MaybeApart</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeApartReason
</span><a href="GHC.Core.Unify.html#MARInfinite"><span class="hs-identifier hs-var">MARInfinite</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- see Example 7 in the Note.</span><span>
</span><span id="line-2550"></span><span>      </span><span class="annot"><span class="annottext">UnifyResult
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2551"></span><span>
</span><span id="line-2552"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2553"></span><span>    </span><span id="local-6989586621681332822"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621681332822"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332833"><span class="hs-identifier hs-var">given_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332831"><span class="hs-identifier hs-var">wanted_pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2554"></span><span>
</span><span id="line-2555"></span><span>    </span><span class="hs-comment">-- NB: flatten both at the same time, so that we can share mappings</span><span>
</span><span id="line-2556"></span><span>    </span><span class="hs-comment">-- from type family applications to variables, and also to guarantee</span><span>
</span><span id="line-2557"></span><span>    </span><span class="hs-comment">-- that the fresh variables are really fresh between the given and</span><span>
</span><span id="line-2558"></span><span>    </span><span class="hs-comment">-- the wanted. Flattening both at the same time is needed to get</span><span>
</span><span id="line-2559"></span><span>    </span><span class="hs-comment">-- Example 10 from the Note.</span><span>
</span><span id="line-2560"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621681332827"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332827"><span class="hs-identifier hs-var">flattened_given</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332826"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332826"><span class="hs-identifier hs-var">flattened_wanted</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332819"><span class="annot"><span class="annottext">TyVarEnv (TyCon, [Type])
</span><a href="#local-6989586621681332819"><span class="hs-identifier hs-var">var_mapping</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2561"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; [Type] -&gt; ([Type], TyVarEnv (TyCon, [Type]))
</span><a href="GHC.Core.Unify.html#flattenTysX"><span class="hs-identifier hs-var">flattenTysX</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681332822"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332833"><span class="hs-identifier hs-var">given_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332831"><span class="hs-identifier hs-var">wanted_pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2562"></span><span>
</span><span id="line-2563"></span><span>    </span><span class="annot"><a href="#local-6989586621681332828"><span class="hs-identifier hs-type">bind_fun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Unify.html#BindFun"><span class="hs-identifier hs-type">BindFun</span></a></span><span>
</span><span id="line-2564"></span><span>    </span><span id="local-6989586621681332828"><span class="annot"><span class="annottext">bind_fun :: BindFun
</span><a href="#local-6989586621681332828"><span class="hs-identifier hs-var hs-var">bind_fun</span></a></span></span><span> </span><span id="local-6989586621681332817"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332817"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681332816"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332816"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>
</span><span id="line-2565"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332817"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2566"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; MetaInfo -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681332814"><span class="hs-identifier hs-var">can_unify</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332817"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#metaTyVarInfo"><span class="hs-identifier hs-var">metaTyVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332817"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332816"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-2567"></span><span>         </span><span class="hs-comment">-- this checks for CycleBreakerTvs and TyVarTvs; forgetting</span><span>
</span><span id="line-2568"></span><span>         </span><span class="hs-comment">-- the latter was #19106.</span><span>
</span><span id="line-2569"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindFlag
</span><a href="GHC.Core.Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a></span><span>
</span><span id="line-2570"></span><span>
</span><span id="line-2571"></span><span>         </span><span class="hs-comment">-- See Examples 4, 5, and 6 from the Note</span><span>
</span><span id="line-2572"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332811"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332811"><span class="hs-identifier hs-var">_fam_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332810"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332810"><span class="hs-identifier hs-var">fam_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; TcTyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarEnv (TyCon, [Type])
</span><a href="#local-6989586621681332819"><span class="hs-identifier hs-var">var_mapping</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332817"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2573"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; [Type] -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfTypes"><span class="hs-identifier hs-var">anyFreeVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621681332807"><span class="hs-identifier hs-var">mentions_meta_ty_var</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332810"><span class="hs-identifier hs-var">fam_args</span></a></span><span>
</span><span id="line-2574"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindFlag
</span><a href="GHC.Core.Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a></span><span>
</span><span id="line-2575"></span><span>
</span><span id="line-2576"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2577"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindFlag
</span><a href="GHC.Core.Unify.html#Apart"><span class="hs-identifier hs-var">Apart</span></a></span><span>
</span><span id="line-2578"></span><span>
</span><span id="line-2579"></span><span>    </span><span class="hs-comment">-- True for TauTv and TyVarTv (and RuntimeUnkTv) meta-tyvars</span><span>
</span><span id="line-2580"></span><span>    </span><span class="hs-comment">-- (as they can be unified)</span><span>
</span><span id="line-2581"></span><span>    </span><span class="hs-comment">-- and also for CycleBreakerTvs that mentions meta-tyvars</span><span>
</span><span id="line-2582"></span><span>    </span><span class="annot"><a href="#local-6989586621681332807"><span class="hs-identifier hs-type">mentions_meta_ty_var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2583"></span><span>    </span><span id="local-6989586621681332807"><span class="annot"><span class="annottext">mentions_meta_ty_var :: TcTyVar -&gt; Bool
</span><a href="#local-6989586621681332807"><span class="hs-identifier hs-var hs-var">mentions_meta_ty_var</span></a></span></span><span> </span><span id="local-6989586621681332805"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332805"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-2584"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332805"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2585"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#metaTyVarInfo"><span class="hs-identifier hs-var">metaTyVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332805"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2586"></span><span>          </span><span class="hs-comment">-- See Examples 8 and 9 in the Note</span><span>
</span><span id="line-2587"></span><span>          </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#CycleBreakerTv"><span class="hs-identifier hs-var">CycleBreakerTv</span></a></span><span>
</span><span id="line-2588"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfType"><span class="hs-identifier hs-var">anyFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621681332807"><span class="hs-identifier hs-var">mentions_meta_ty_var</span></a></span><span>
</span><span id="line-2589"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; InertSet -&gt; Type
</span><a href="GHC.Tc.Solver.Monad.html#lookupCycleBreakerVar"><span class="hs-identifier hs-var">lookupCycleBreakerVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332805"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332834"><span class="hs-identifier hs-var">inert_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2590"></span><span>          </span><span class="annot"><span class="annottext">MetaInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2591"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2592"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2593"></span><span>
</span><span id="line-2594"></span><span>    </span><span class="hs-comment">-- like canSolveByUnification, but allows cbv variables to unify</span><span>
</span><span id="line-2595"></span><span>    </span><span class="annot"><a href="#local-6989586621681332814"><span class="hs-identifier hs-type">can_unify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2596"></span><span>    </span><span id="local-6989586621681332814"><span class="annot"><span class="annottext">can_unify :: TcTyVar -&gt; MetaInfo -&gt; Type -&gt; Bool
</span><a href="#local-6989586621681332814"><span class="hs-identifier hs-var hs-var">can_unify</span></a></span></span><span> </span><span id="local-6989586621681332802"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332802"><span class="hs-identifier hs-var">_lhs_tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span> </span><span id="local-6989586621681332800"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332800"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>  </span><span class="hs-comment">-- see Example 3 from the Note</span><span>
</span><span id="line-2597"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332799"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332799"><span class="hs-identifier hs-var">rhs_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TcTyVar
</span><a href="GHC.Tc.Utils.TcType.html#tcGetTyVar_maybe"><span class="hs-identifier hs-var">tcGetTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332800"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-2598"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332799"><span class="hs-identifier hs-var">rhs_tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2599"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_info :: TcTyVarDetails -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2600"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- could unify with anything</span><span>
</span><span id="line-2601"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-type">SkolemTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2602"></span><span>          </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2603"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-comment">-- not a var on the RHS</span><span>
</span><span id="line-2604"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2605"></span><span>    </span><span class="annot"><a href="#local-6989586621681332814"><span class="hs-identifier hs-var">can_unify</span></a></span><span> </span><span id="local-6989586621681332792"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332792"><span class="hs-identifier hs-var">lhs_tv</span></a></span></span><span> </span><span id="local-6989586621681332791"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621681332791"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span id="local-6989586621681332790"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332790"><span class="hs-identifier hs-var">_rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621681332807"><span class="hs-identifier hs-var">mentions_meta_ty_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332792"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span>
</span><span id="line-2606"></span><span>
</span><span id="line-2607"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-type">prohibitedSuperClassSolve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2608"></span><span class="hs-comment">-- See Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance</span><span>
</span><span id="line-2609"></span><span id="prohibitedSuperClassSolve"><span class="annot"><span class="annottext">prohibitedSuperClassSolve :: CtLoc -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var hs-var">prohibitedSuperClassSolve</span></a></span></span><span> </span><span id="local-6989586621681332789"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332789"><span class="hs-identifier hs-var">from_loc</span></a></span></span><span> </span><span id="local-6989586621681332788"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332788"><span class="hs-identifier hs-var">solve_loc</span></a></span></span><span>
</span><span id="line-2610"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstSCOrigin"><span class="hs-identifier hs-type">InstSCOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681332786"><span class="annot"><span class="annottext">TypeSize
</span><a href="#local-6989586621681332786"><span class="hs-identifier hs-var">given_size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332789"><span class="hs-identifier hs-var">from_loc</span></a></span><span>
</span><span id="line-2611"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ScOrigin"><span class="hs-identifier hs-type">ScOrigin</span></a></span><span> </span><span id="local-6989586621681332783"><span class="annot"><span class="annottext">TypeSize
</span><a href="#local-6989586621681332783"><span class="hs-identifier hs-var">wanted_size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332788"><span class="hs-identifier hs-var">solve_loc</span></a></span><span>
</span><span id="line-2612"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeSize
</span><a href="#local-6989586621681332786"><span class="hs-identifier hs-var">given_size</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">TypeSize
</span><a href="#local-6989586621681332783"><span class="hs-identifier hs-var">wanted_size</span></a></span><span>
</span><span id="line-2613"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2614"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2615"></span><span>
</span><span id="line-2616"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
    Cycle breakers
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-2621"></span><span>
</span><span id="line-2622"></span><span class="hs-comment">-- | Return the type family application a CycleBreakerTv maps to.</span><span>
</span><span id="line-2623"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupCycleBreakerVar"><span class="hs-identifier hs-type">lookupCycleBreakerVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>    </span><span class="hs-comment">-- ^ cbv, must be a CycleBreakerTv</span><span>
</span><span id="line-2624"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span>
</span><span id="line-2625"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>     </span><span class="hs-comment">-- ^ type family application the cbv maps to</span><span>
</span><span id="line-2626"></span><span id="lookupCycleBreakerVar"><span class="annot"><span class="annottext">lookupCycleBreakerVar :: TcTyVar -&gt; InertSet -&gt; Type
</span><a href="GHC.Tc.Solver.Monad.html#lookupCycleBreakerVar"><span class="hs-identifier hs-var hs-var">lookupCycleBreakerVar</span></a></span></span><span> </span><span id="local-6989586621681332782"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332782"><span class="hs-identifier hs-var">cbv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cycle_breakers :: InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332781"><span class="annot"><span class="annottext">CycleBreakerVarStack
</span><a href="#local-6989586621681332781"><span class="hs-identifier hs-var">cbvs_stack</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2627"></span><span class="hs-comment">-- This function looks at every environment in the stack. This is necessary</span><span>
</span><span id="line-2628"></span><span class="hs-comment">-- to avoid #20231. This function (and its one usage site) is the only reason</span><span>
</span><span id="line-2629"></span><span class="hs-comment">-- that we store a stack instead of just the top environment.</span><span>
</span><span id="line-2630"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332780"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332780"><span class="hs-identifier hs-var">tyfam_app</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isCycleBreakerTyVar</span><span> </span><span class="hs-identifier">cbv</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2631"></span><span>                      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f (Maybe a) -&gt; Maybe a
</span><a href="GHC.Data.Maybe.html#firstJusts"><span class="hs-identifier hs-var">firstJusts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#map"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.16.3.0/src/GHC-List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332782"><span class="hs-identifier hs-var">cbv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CycleBreakerVarStack
</span><a href="#local-6989586621681332781"><span class="hs-identifier hs-var">cbvs_stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2632"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332780"><span class="hs-identifier hs-var">tyfam_app</span></a></span><span>
</span><span id="line-2633"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2634"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupCycleBreakerVar found an unbound cycle breaker&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332782"><span class="hs-identifier hs-var">cbv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CycleBreakerVarStack
</span><a href="#local-6989586621681332781"><span class="hs-identifier hs-var">cbvs_stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2635"></span><span>
</span><span id="line-2636"></span><span class="hs-comment">-- | Push a fresh environment onto the cycle-breaker var stack. Useful</span><span>
</span><span id="line-2637"></span><span class="hs-comment">-- when entering a nested implication.</span><span>
</span><span id="line-2638"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pushCycleBreakerVarStack"><span class="hs-identifier hs-type">pushCycleBreakerVarStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span>
</span><span id="line-2639"></span><span id="pushCycleBreakerVarStack"><span class="annot"><span class="annottext">pushCycleBreakerVarStack :: CycleBreakerVarStack -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#pushCycleBreakerVarStack"><span class="hs-identifier hs-var hs-var">pushCycleBreakerVarStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.16.3.0/src/Data-List-NonEmpty.html#%3C%7C"><span class="hs-operator hs-var">NE.&lt;|</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2640"></span><span>
</span><span id="line-2641"></span><span class="hs-comment">-- | Add a new cycle-breaker binding to the top environment on the stack.</span><span>
</span><span id="line-2642"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertCycleBreakerBinding"><span class="hs-identifier hs-type">insertCycleBreakerBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>   </span><span class="hs-comment">-- ^ cbv, must be a CycleBreakerTv</span><span>
</span><span id="line-2643"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>    </span><span class="hs-comment">-- ^ cbv's expansion</span><span>
</span><span id="line-2644"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span>
</span><span id="line-2645"></span><span id="insertCycleBreakerBinding"><span class="annot"><span class="annottext">insertCycleBreakerBinding :: TcTyVar -&gt; Type -&gt; CycleBreakerVarStack -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#insertCycleBreakerBinding"><span class="hs-identifier hs-var hs-var">insertCycleBreakerBinding</span></a></span></span><span> </span><span id="local-6989586621681332771"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332771"><span class="hs-identifier hs-var">cbv</span></a></span></span><span> </span><span id="local-6989586621681332770"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332770"><span class="hs-identifier hs-var">expansion</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332769"><span class="annot"><span class="annottext">[(TcTyVar, Type)]
</span><a href="#local-6989586621681332769"><span class="hs-identifier hs-var">top_env</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621681332768"><span class="annot"><span class="annottext">[[(TcTyVar, Type)]]
</span><a href="#local-6989586621681332768"><span class="hs-identifier hs-var">rest_envs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2646"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isCycleBreakerTyVar</span><span> </span><span class="hs-identifier">cbv</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2647"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332771"><span class="hs-identifier hs-var">cbv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332770"><span class="hs-identifier hs-var">expansion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(TcTyVar, Type)]
</span><a href="#local-6989586621681332769"><span class="hs-identifier hs-var">top_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="annot"><span class="annottext">[[(TcTyVar, Type)]]
</span><a href="#local-6989586621681332768"><span class="hs-identifier hs-var">rest_envs</span></a></span><span>
</span><span id="line-2648"></span><span>
</span><span id="line-2649"></span><span class="hs-comment">-- | Perform a monadic operation on all pairs in the top environment</span><span>
</span><span id="line-2650"></span><span class="hs-comment">-- in the stack.</span><span>
</span><span id="line-2651"></span><span id="local-6989586621681334357"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#forAllCycleBreakerBindings_"><span class="hs-identifier hs-type">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334357"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2652"></span><span>                            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span>
</span><span id="line-2653"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334357"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334357"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2654"></span><span id="forAllCycleBreakerBindings_"><span class="annot"><span class="annottext">forAllCycleBreakerBindings_ :: forall (m :: * -&gt; *).
Monad m =&gt;
CycleBreakerVarStack -&gt; (TcTyVar -&gt; Type -&gt; m ()) -&gt; m ()
</span><a href="GHC.Tc.Solver.Monad.html#forAllCycleBreakerBindings_"><span class="hs-identifier hs-var hs-var">forAllCycleBreakerBindings_</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332763"><span class="annot"><span class="annottext">[(TcTyVar, Type)]
</span><a href="#local-6989586621681332763"><span class="hs-identifier hs-var">top_env</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621681332762"><span class="annot"><span class="annottext">[[(TcTyVar, Type)]]
</span><a href="#local-6989586621681332762"><span class="hs-identifier hs-var">_rest_envs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332761"><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; m ()
</span><a href="#local-6989586621681332761"><span class="hs-identifier hs-var">action</span></a></span></span><span>
</span><span id="line-2655"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(TcTyVar, Type)]
</span><a href="#local-6989586621681332763"><span class="hs-identifier hs-var">top_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; m ()
</span><a href="#local-6989586621681332761"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2656"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#forAllCycleBreakerBindings_"><span class="hs-pragma hs-type">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- to allow SPECIALISE later</span><span>
</span><span id="line-2657"></span><span>
</span><span id="line-2658"></span><span>
</span><span id="line-2659"></span><span class="hs-comment">{- Note [Unsolved Derived equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In getUnsolvedInerts, we return a derived equality from the inert_eqs
because it is a candidate for floating out of this implication.  We
only float equalities with a meta-tyvar on the left, so we only pull
those out here.

Note [What might equal later?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We must determine whether a Given might later equal a Wanted. We
definitely need to account for the possibility that any metavariable
might be arbitrarily instantiated. Yet we do *not* want
to allow skolems in to be instantiated, as we've already rewritten
with respect to any Givens. (We're solving a Wanted here, and so
all Givens have already been processed.)

This is best understood by example.

1. C alpha  ~?  C Int

   That given certainly might match later.

2. C a  ~?  C Int

   No. No new givens are going to arise that will get the `a` to rewrite
   to Int.

3. C alpha[tv]   ~?  C Int

   That alpha[tv] is a TyVarTv, unifiable only with other type variables.
   It cannot equal later.

4. C (F alpha)   ~?   C Int

   Sure -- that can equal later, if we learn something useful about alpha.

5. C (F alpha[tv])  ~?  C Int

   This, too, might equal later. Perhaps we have [G] F b ~ Int elsewhere.
   Or maybe we have C (F alpha[tv] beta[tv]), these unify with each other,
   and F x x = Int. Remember: returning True doesn't commit ourselves to
   anything.

6. C (F a)  ~?  C a

   No, this won't match later. If we could rewrite (F a) or a, we would
   have by now.

7. C (Maybe alpha)  ~?  C alpha

   We say this cannot equal later, because it would require
   alpha := Maybe (Maybe (Maybe ...)). While such a type can be contrived,
   we choose not to worry about it. See Note [Infinitary substitution in lookup]
   in GHC.Core.InstEnv. Getting this wrong let to #19107, tested in
   typecheck/should_compile/T19107.

8. C cbv   ~?  C Int
   where cbv = F a

   The cbv is a cycle-breaker var which stands for F a. See
   Note [Type equality cycles] in GHC.Tc.Solver.Canonical.
   This is just like case 6, and we say &quot;no&quot;. Saying &quot;no&quot; here is
   essential in getting the parser to type-check, with its use of DisambECP.

9. C cbv   ~?   C Int
   where cbv = F alpha

   Here, we might indeed equal later. Distinguishing between
   this case and Example 8 is why we need the InertSet in mightEqualLater.

10. C (F alpha, Int)  ~?  C (Bool, F alpha)

   This cannot equal later, because F a would have to equal both Bool and
   Int.

To deal with type family applications, we use the Core flattener. See
Note [Flattening type-family applications when matching instances] in GHC.Core.Unify.
The Core flattener replaces all type family applications with
fresh variables. The next question: should we allow these fresh
variables in the domain of a unifying substitution?

A type family application that mentions only skolems (example 6) is settled:
any skolems would have been rewritten w.r.t. Givens by now. These type family
applications match only themselves. A type family application that mentions
metavariables, on the other hand, can match anything. So, if the original type
family application contains a metavariable, we use BindMe to tell the unifier
to allow it in the substitution. On the other hand, a type family application
with only skolems is considered rigid.

This treatment fixes #18910 and is tested in
typecheck/should_compile/InstanceGivenOverlap{,2}
-}</span><span>
</span><span id="line-2751"></span><span>
</span><span id="line-2752"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#removeInertCts"><span class="hs-identifier hs-type">removeInertCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-2753"></span><span class="hs-comment">-- ^ Remove inert constraints from the 'InertCans', for use when a</span><span>
</span><span id="line-2754"></span><span class="hs-comment">-- typechecker plugin wishes to discard a given.</span><span>
</span><span id="line-2755"></span><span id="removeInertCts"><span class="annot"><span class="annottext">removeInertCts :: [Ct] -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#removeInertCts"><span class="hs-identifier hs-var hs-var">removeInertCts</span></a></span></span><span> </span><span id="local-6989586621681332758"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332758"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621681332757"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332757"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#removeInertCt"><span class="hs-identifier hs-var">removeInertCt</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332757"><span class="hs-identifier hs-var">icans</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332758"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-2756"></span><span>
</span><span id="line-2757"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#removeInertCt"><span class="hs-identifier hs-type">removeInertCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-2758"></span><span id="removeInertCt"><span class="annot"><span class="annottext">removeInertCt :: InertCans -&gt; Ct -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#removeInertCt"><span class="hs-identifier hs-var hs-var">removeInertCt</span></a></span></span><span> </span><span id="local-6989586621681332754"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332754"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span id="local-6989586621681332753"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332753"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2759"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332753"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2760"></span><span>
</span><span id="line-2761"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332752"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332752"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332751"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332751"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2762"></span><span>      </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332754"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Class -&gt; [Type] -&gt; DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#delDict"><span class="hs-identifier hs-var">delDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332754"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332752"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332751"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2763"></span><span>
</span><span id="line-2764"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332750"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681332750"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332749"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332749"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; CanEqLHS -&gt; Type -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#delEq"><span class="hs-identifier hs-var">delEq</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332754"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681332750"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332749"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2765"></span><span>
</span><span id="line-2766"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-type">CQuantCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removeInertCt: CQuantCan&quot;</span></span><span>
</span><span id="line-2767"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removeInertCt: CIrredEvCan&quot;</span></span><span>
</span><span id="line-2768"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CNonCanonical"><span class="hs-identifier hs-type">CNonCanonical</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removeInertCt: CNonCanonical&quot;</span></span><span>
</span><span id="line-2769"></span><span>
</span><span id="line-2770"></span><span class="hs-comment">-- | Looks up a family application in the inerts; returned coercion</span><span>
</span><span id="line-2771"></span><span class="hs-comment">-- is oriented input ~ output</span><span>
</span><span id="line-2772"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppInert"><span class="hs-identifier hs-type">lookupFamAppInert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2773"></span><span id="lookupFamAppInert"><span class="annot"><span class="annottext">lookupFamAppInert :: TyCon -&gt; [Type] -&gt; TcS (Maybe (Coercion, Type, CtFlavourRole))
</span><a href="GHC.Tc.Solver.Monad.html#lookupFamAppInert"><span class="hs-identifier hs-var hs-var">lookupFamAppInert</span></a></span></span><span> </span><span id="local-6989586621681332746"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332746"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681332745"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332745"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2774"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; FunEqMap EqualCtList
</span><a href="GHC.Tc.Solver.Monad.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332744"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681332744"><span class="hs-identifier hs-var">inert_funeqs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span>
</span><span id="line-2775"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunEqMap EqualCtList -&gt; Maybe (Coercion, Type, CtFlavourRole)
</span><a href="#local-6989586621681332743"><span class="hs-identifier hs-var">lookup_inerts</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681332744"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2776"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2777"></span><span>    </span><span id="local-6989586621681332743"><span class="annot"><span class="annottext">lookup_inerts :: FunEqMap EqualCtList -&gt; Maybe (Coercion, Type, CtFlavourRole)
</span><a href="#local-6989586621681332743"><span class="hs-identifier hs-var hs-var">lookup_inerts</span></a></span></span><span> </span><span id="local-6989586621681332742"><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681332742"><span class="hs-identifier hs-var">inert_funeqs</span></a></span></span><span>
</span><span id="line-2778"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332741"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332741"><span class="hs-identifier hs-var">ctev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332740"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332740"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2779"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap EqualCtList
</span><a href="#local-6989586621681332742"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332746"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332745"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2780"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; Coercion
</span><a href="GHC.Tc.Types.Constraint.html#ctEvCoercion"><span class="hs-identifier hs-var">ctEvCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332741"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332740"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavourRole"><span class="hs-identifier hs-var">ctEvFlavourRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332741"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2781"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2782"></span><span>
</span><span id="line-2783"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupInInerts"><span class="hs-identifier hs-type">lookupInInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2784"></span><span class="hs-comment">-- Is this exact predicate type cached in the solved or canonicals of the InertSet?</span><span>
</span><span id="line-2785"></span><span id="lookupInInerts"><span class="annot"><span class="annottext">lookupInInerts :: CtLoc -&gt; Type -&gt; TcS (Maybe CtEvidence)
</span><a href="GHC.Tc.Solver.Monad.html#lookupInInerts"><span class="hs-identifier hs-var hs-var">lookupInInerts</span></a></span></span><span> </span><span id="local-6989586621681332736"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332736"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332735"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332735"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-2786"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621681332734"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332734"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332733"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332733"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332735"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-2787"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332732"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332732"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span>
</span><span id="line-2788"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier hs-var">lookupSolvedDict</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332732"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332736"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332734"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332733"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a -&gt; m a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#mplus"><span class="hs-operator hs-var">`mplus`</span></a></span><span>
</span><span id="line-2789"></span><span>                 </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe Ct
</span><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier hs-var">lookupInertDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332732"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332736"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332734"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332733"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2790"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-comment">-- NB: No caching for equalities, IPs, holes, or errors</span><span>
</span><span id="line-2791"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2792"></span><span>
</span><span id="line-2793"></span><span class="hs-comment">-- | Look up a dictionary inert.</span><span>
</span><span id="line-2794"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier hs-type">lookupInertDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-2795"></span><span id="lookupInertDict"><span class="annot"><span class="annottext">lookupInertDict :: InertCans -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe Ct
</span><a href="GHC.Tc.Solver.Monad.html#lookupInertDict"><span class="hs-identifier hs-var hs-var">lookupInertDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332730"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332730"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332729"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332729"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332728"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332728"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332727"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332727"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2796"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findDict"><span class="hs-identifier hs-var">findDict</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332730"><span class="hs-identifier hs-var">dicts</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332729"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332728"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332727"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2797"></span><span>      </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332726"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332726"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332726"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-2798"></span><span>      </span><span class="annot"><span class="annottext">Maybe Ct
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2799"></span><span>
</span><span id="line-2800"></span><span class="hs-comment">-- | Look up a solved inert.</span><span>
</span><span id="line-2801"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier hs-type">lookupSolvedDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-2802"></span><span class="hs-comment">-- Returns just if exactly this predicate type exists in the solved.</span><span>
</span><span id="line-2803"></span><span id="lookupSolvedDict"><span class="annot"><span class="annottext">lookupSolvedDict :: InertSet -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#lookupSolvedDict"><span class="hs-identifier hs-var hs-var">lookupSolvedDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: InertSet -&gt; DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332725"><span class="annot"><span class="annottext">DictMap CtEvidence
</span><a href="#local-6989586621681332725"><span class="hs-identifier hs-var">solved</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332724"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332724"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332723"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332723"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332722"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332722"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2804"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findDict"><span class="hs-identifier hs-var">findDict</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap CtEvidence
</span><a href="#local-6989586621681332725"><span class="hs-identifier hs-var">solved</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332724"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332723"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332722"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2805"></span><span>      </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332721"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332721"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332721"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2806"></span><span>      </span><span class="annot"><span class="annottext">Maybe CtEvidence
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2807"></span><span>
</span><span id="line-2808"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-2809"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#lookupFamAppCache"><span class="hs-identifier hs-type">lookupFamAppCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2810"></span><span id="lookupFamAppCache"><span class="annot"><span class="annottext">lookupFamAppCache :: TyCon -&gt; [Type] -&gt; TcS (Maybe (Coercion, Type))
</span><a href="GHC.Tc.Solver.Monad.html#lookupFamAppCache"><span class="hs-identifier hs-var hs-var">lookupFamAppCache</span></a></span></span><span> </span><span id="local-6989586621681332720"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332720"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681332719"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332719"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2811"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: InertSet -&gt; FunEqMap (Coercion, Type)
</span><a href="GHC.Tc.Solver.Monad.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332718"><span class="annot"><span class="annottext">FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332718"><span class="hs-identifier hs-var">famapp_cache</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span>
</span><span id="line-2812"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332718"><span class="hs-identifier hs-var">famapp_cache</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332720"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332719"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2813"></span><span>           </span><span id="local-6989586621681332717"><span class="annot"><span class="annottext">result :: Maybe (Coercion, Type)
</span><a href="#local-6989586621681332717"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332716"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332716"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332715"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332715"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2814"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;famapp_cache hit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332720"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332719"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2815"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332715"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2816"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332716"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2817"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion, Type)
</span><a href="#local-6989586621681332717"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2818"></span><span>           </span><span class="annot"><span class="annottext">Maybe (Coercion, Type)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2819"></span><span>
</span><span id="line-2820"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#extendFamAppCache"><span class="hs-identifier hs-type">extendFamAppCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2821"></span><span class="hs-comment">-- NB: co :: rhs ~ F tys, to match expectations of rewriter</span><span>
</span><span id="line-2822"></span><span id="extendFamAppCache"><span class="annot"><span class="annottext">extendFamAppCache :: TyCon -&gt; [Type] -&gt; (Coercion, Type) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#extendFamAppCache"><span class="hs-identifier hs-var hs-var">extendFamAppCache</span></a></span></span><span> </span><span id="local-6989586621681332713"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332713"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681332712"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332712"><span class="hs-identifier hs-var">xi_args</span></a></span></span><span> </span><span id="local-6989586621681332711"><span class="annot"><span class="annottext">stuff :: (Coercion, Type)
</span><a href="#local-6989586621681332711"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332710"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332710"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2823"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332709"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681332709"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2824"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_FamAppCache"><span class="hs-identifier hs-var">Opt_FamAppCache</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681332709"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2825"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extendFamAppCache&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332713"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332712"><span class="hs-identifier hs-var">xi_args</span></a></span><span>
</span><span id="line-2826"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332710"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2827"></span><span>            </span><span class="hs-comment">-- 'co' can be bottom, in the case of derived items</span><span>
</span><span id="line-2828"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332706"><span class="annot"><span class="annottext">is :: InertSet
</span><a href="#local-6989586621681332706"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: InertSet -&gt; FunEqMap (Coercion, Type)
</span><a href="GHC.Tc.Solver.Monad.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332705"><span class="annot"><span class="annottext">FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332705"><span class="hs-identifier hs-var">fc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2829"></span><span>            </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332706"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: FunEqMap (Coercion, Type)
</span><a href="GHC.Tc.Solver.Monad.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#insertFunEq"><span class="hs-identifier hs-var">insertFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332705"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332713"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332712"><span class="hs-identifier hs-var">xi_args</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion, Type)
</span><a href="#local-6989586621681332711"><span class="hs-identifier hs-var">stuff</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2830"></span><span>
</span><span id="line-2831"></span><span class="hs-comment">-- Remove entries from the cache whose evidence mentions variables in the</span><span>
</span><span id="line-2832"></span><span class="hs-comment">-- supplied set</span><span>
</span><span id="line-2833"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#dropFromFamAppCache"><span class="hs-identifier hs-type">dropFromFamAppCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2834"></span><span id="dropFromFamAppCache"><span class="annot"><span class="annottext">dropFromFamAppCache :: VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#dropFromFamAppCache"><span class="hs-identifier hs-var hs-var">dropFromFamAppCache</span></a></span></span><span> </span><span id="local-6989586621681332704"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332704"><span class="hs-identifier hs-var">varset</span></a></span></span><span>
</span><span id="line-2835"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332703"><span class="annot"><span class="annottext">inerts :: InertSet
</span><a href="#local-6989586621681332703"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: InertSet -&gt; FunEqMap (Coercion, Type)
</span><a href="GHC.Tc.Solver.Monad.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332702"><span class="annot"><span class="annottext">FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332702"><span class="hs-identifier hs-var">famapp_cache</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span>
</span><span id="line-2836"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332701"><span class="annot"><span class="annottext">filtered :: FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332701"><span class="hs-identifier hs-var hs-var">filtered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; TcAppMap a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#filterTcAppMap"><span class="hs-identifier hs-var">filterTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">(Coercion, Type) -&gt; Bool
</span><a href="#local-6989586621681332699"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332702"><span class="hs-identifier hs-var">famapp_cache</span></a></span><span>
</span><span id="line-2837"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setTcSInerts"><span class="hs-identifier hs-var">setTcSInerts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332703"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: FunEqMap (Coercion, Type)
</span><a href="GHC.Tc.Solver.Monad.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunEqMap (Coercion, Type)
</span><a href="#local-6989586621681332701"><span class="hs-identifier hs-var">filtered</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2838"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2839"></span><span>    </span><span class="annot"><a href="#local-6989586621681332699"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2840"></span><span>    </span><span id="local-6989586621681332699"><span class="annot"><span class="annottext">check :: (Coercion, Type) -&gt; Bool
</span><a href="#local-6989586621681332699"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332698"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332698"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfCo"><span class="hs-identifier hs-var">anyFreeVarsOfCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332704"><span class="hs-identifier hs-var">varset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332698"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2841"></span><span>
</span><span id="line-2842"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Irreds
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-2847"></span><span>
</span><span id="line-2848"></span><span id="local-6989586621681334337"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldIrreds"><span class="hs-identifier hs-type">foldIrreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334337"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334337"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334337"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334337"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-2849"></span><span id="foldIrreds"><span class="annot"><span class="annottext">foldIrreds :: forall b. (Ct -&gt; b -&gt; b) -&gt; Bag Ct -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldIrreds"><span class="hs-identifier hs-var hs-var">foldIrreds</span></a></span></span><span> </span><span id="local-6989586621681332694"><span class="annot"><span class="annottext">Ct -&gt; b -&gt; b
</span><a href="#local-6989586621681332694"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681332693"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332693"><span class="hs-identifier hs-var">irreds</span></a></span></span><span> </span><span id="local-6989586621681332692"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681332692"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; b -&gt; b
</span><a href="#local-6989586621681332694"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681332692"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332693"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-2850"></span><span>
</span><span id="line-2851"></span><span>
</span><span id="line-2852"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   TcAppMap
*                                                                      *
************************************************************************

Note [Use loose types in inert set]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Whenever we are looking up an inert dictionary (CDictCan) or function
equality (CEqCan), we use a TcAppMap, which uses the Unique of the
class/type family tycon and then a trie which maps the arguments. This
trie does *not* need to match the kinds of the arguments; this Note
explains why.

Consider the types ty0 = (T ty1 ty2 ty3 ty4) and ty0' = (T ty1' ty2' ty3' ty4'),
where ty4 and ty4' have different kinds. Let's further assume that both types
ty0 and ty0' are well-typed. Because the kind of T is closed, it must be that
one of the ty1..ty3 does not match ty1'..ty3' (and that the kind of the fourth
argument to T is dependent on whichever one changed). Since we are matching
all arguments, during the inert-set lookup, we know that ty1..ty3 do indeed
match ty1'..ty3'. Therefore, the kind of ty4 and ty4' must match, too --
without ever looking at it.

Accordingly, we use LooseTypeMap, which skips the kind check when looking
up a type. I (Richard E) believe this is just an optimization, and that
looking at kinds would be harmless.

-}</span><span>
</span><span id="line-2880"></span><span>
</span><span id="line-2881"></span><span class="hs-keyword">type</span><span> </span><span id="TcAppMap"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-var">TcAppMap</span></a></span></span><span> </span><span id="local-6989586621681332691"><span class="annot"><a href="#local-6989586621681332691"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.Env.html#DTyConEnv"><span class="hs-identifier hs-type">DTyConEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332691"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2882"></span><span>    </span><span class="hs-comment">-- Indexed by tycon then the arg types, using &quot;loose&quot; matching, where</span><span>
</span><span id="line-2883"></span><span>    </span><span class="hs-comment">-- we don't require kind equality. This allows, for example, (a |&gt; co)</span><span>
</span><span id="line-2884"></span><span>    </span><span class="hs-comment">-- to match (a).</span><span>
</span><span id="line-2885"></span><span>    </span><span class="hs-comment">-- See Note [Use loose types in inert set]</span><span>
</span><span id="line-2886"></span><span>    </span><span class="hs-comment">-- Used for types and classes; hence UniqDFM</span><span>
</span><span id="line-2887"></span><span>    </span><span class="hs-comment">-- See Note [foldTM determinism] in GHC.Data.TrieMap for why we use DTyConEnv here</span><span>
</span><span id="line-2888"></span><span>
</span><span id="line-2889"></span><span id="local-6989586621681334449"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isEmptyTcAppMap"><span class="hs-identifier hs-type">isEmptyTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334449"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2890"></span><span id="isEmptyTcAppMap"><span class="annot"><span class="annottext">isEmptyTcAppMap :: forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isEmptyTcAppMap"><span class="hs-identifier hs-var hs-var">isEmptyTcAppMap</span></a></span></span><span> </span><span id="local-6989586621681332690"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332690"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DTyConEnv a -&gt; Bool
</span><a href="GHC.Core.TyCon.Env.html#isEmptyDTyConEnv"><span class="hs-identifier hs-var">isEmptyDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332690"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2891"></span><span>
</span><span id="line-2892"></span><span id="local-6989586621681332688"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyTcAppMap"><span class="hs-identifier hs-type">emptyTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332688"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2893"></span><span id="emptyTcAppMap"><span class="annot"><span class="annottext">emptyTcAppMap :: forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyTcAppMap"><span class="hs-identifier hs-var hs-var">emptyTcAppMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#emptyDTyConEnv"><span class="hs-identifier hs-var">emptyDTyConEnv</span></a></span><span>
</span><span id="line-2894"></span><span>
</span><span id="line-2895"></span><span id="local-6989586621681332685"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findTcApp"><span class="hs-identifier hs-type">findTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332685"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332685"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2896"></span><span id="findTcApp"><span class="annot"><span class="annottext">findTcApp :: forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findTcApp"><span class="hs-identifier hs-var hs-var">findTcApp</span></a></span></span><span> </span><span id="local-6989586621681332680"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332680"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332679"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332679"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681332678"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332678"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332677"><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332677"><span class="hs-identifier hs-var">tys_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. DTyConEnv a -&gt; TyCon -&gt; Maybe a
</span><a href="GHC.Core.TyCon.Env.html#lookupDTyConEnv"><span class="hs-identifier hs-var">lookupDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332680"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332679"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2897"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b. TrieMap m =&gt; Key m -&gt; m b -&gt; Maybe b
</span><a href="GHC.Data.TrieMap.html#lookupTM"><span class="hs-identifier hs-var">lookupTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332678"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332677"><span class="hs-identifier hs-var">tys_map</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2898"></span><span>
</span><span id="line-2899"></span><span id="local-6989586621681334327"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#delTcApp"><span class="hs-identifier hs-type">delTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334327"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334327"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2900"></span><span id="delTcApp"><span class="annot"><span class="annottext">delTcApp :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#delTcApp"><span class="hs-identifier hs-var hs-var">delTcApp</span></a></span></span><span> </span><span id="local-6989586621681332672"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332672"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332671"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332671"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681332670"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332670"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a) -&gt; DTyConEnv a -&gt; TyCon -&gt; DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#adjustDTyConEnv"><span class="hs-identifier hs-var">adjustDTyConEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; Key m -&gt; m a -&gt; m a
</span><a href="GHC.Data.TrieMap.html#deleteTM"><span class="hs-identifier hs-var">deleteTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332670"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332672"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332671"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2901"></span><span>
</span><span id="line-2902"></span><span id="local-6989586621681334409"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertTcApp"><span class="hs-identifier hs-type">insertTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334409"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334409"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334409"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2903"></span><span id="insertTcApp"><span class="annot"><span class="annottext">insertTcApp :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#insertTcApp"><span class="hs-identifier hs-var hs-var">insertTcApp</span></a></span></span><span> </span><span id="local-6989586621681332665"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332665"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332664"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332664"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681332663"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332663"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681332662"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332662"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(Maybe a -&gt; Maybe a) -&gt; DTyConEnv a -&gt; TyCon -&gt; DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#alterDTyConEnv"><span class="hs-identifier hs-var">alterDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332660"><span class="hs-identifier hs-var">alter_tm</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332665"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332664"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2904"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2905"></span><span>    </span><span id="local-6989586621681332660"><span class="annot"><span class="annottext">alter_tm :: Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332660"><span class="hs-identifier hs-var hs-var">alter_tm</span></a></span></span><span> </span><span id="local-6989586621681332659"><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332659"><span class="hs-identifier hs-var">mb_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; Key m -&gt; a -&gt; m a -&gt; m a
</span><a href="GHC.Data.TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332663"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332662"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332659"><span class="hs-identifier hs-var">mb_tm</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; m a
</span><a href="GHC.Data.TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2906"></span><span>
</span><span id="line-2907"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#alterTcApp"><span class="hs-identifier hs-type">alterTcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681334435"><span class="annot"><a href="#local-6989586621681334435"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334435"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334435"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334435"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-2908"></span><span id="alterTcApp"><span class="annot"><span class="annottext">alterTcApp :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; XT a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#alterTcApp"><span class="hs-identifier hs-var hs-var">alterTcApp</span></a></span></span><span> </span><span id="local-6989586621681332653"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332653"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332652"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332652"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681332651"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332651"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681332650"><span class="annot"><span class="annottext">XT a
</span><a href="#local-6989586621681332650"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(Maybe a -&gt; Maybe a) -&gt; DTyConEnv a -&gt; TyCon -&gt; DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#alterDTyConEnv"><span class="hs-identifier hs-var">alterDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332649"><span class="hs-identifier hs-var">alter_tm</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332653"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332652"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2909"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2910"></span><span>    </span><span class="annot"><a href="#local-6989586621681332649"><span class="hs-identifier hs-type">alter_tm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334435"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334435"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2911"></span><span>    </span><span id="local-6989586621681332649"><span class="annot"><span class="annottext">alter_tm :: Maybe (ListMap LooseTypeMap a) -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332649"><span class="hs-identifier hs-var hs-var">alter_tm</span></a></span></span><span> </span><span id="local-6989586621681332648"><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332648"><span class="hs-identifier hs-var">m_elt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b. TrieMap m =&gt; Key m -&gt; XT b -&gt; m b -&gt; m b
</span><a href="GHC.Data.TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332651"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">XT a
</span><a href="#local-6989586621681332650"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332648"><span class="hs-identifier hs-var">m_elt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; m a
</span><a href="GHC.Data.TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2912"></span><span>
</span><span id="line-2913"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#filterTcAppMap"><span class="hs-identifier hs-type">filterTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681334338"><span class="annot"><a href="#local-6989586621681334338"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681334338"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334338"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334338"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-2914"></span><span id="filterTcAppMap"><span class="annot"><span class="annottext">filterTcAppMap :: forall a. (a -&gt; Bool) -&gt; TcAppMap a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#filterTcAppMap"><span class="hs-identifier hs-var hs-var">filterTcAppMap</span></a></span></span><span> </span><span id="local-6989586621681332644"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621681332644"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681332643"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332643"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; DTyConEnv a -&gt; DTyConEnv b
</span><a href="GHC.Core.TyCon.Env.html#mapMaybeDTyConEnv"><span class="hs-identifier hs-var">mapMaybeDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332641"><span class="hs-identifier hs-var">one_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332643"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2915"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2916"></span><span>    </span><span class="annot"><a href="#local-6989586621681332641"><span class="hs-identifier hs-type">one_tycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334338"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Map.Type.html#LooseTypeMap"><span class="hs-identifier hs-type">LooseTypeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334338"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2917"></span><span>    </span><span id="local-6989586621681332641"><span class="annot"><span class="annottext">one_tycon :: ListMap LooseTypeMap a -&gt; Maybe (ListMap LooseTypeMap a)
</span><a href="#local-6989586621681332641"><span class="hs-identifier hs-var hs-var">one_tycon</span></a></span></span><span> </span><span id="local-6989586621681332640"><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332640"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-2918"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; m a -&gt; Bool
</span><a href="GHC.Data.TrieMap.html#isEmptyTM"><span class="hs-identifier hs-var">isEmptyTM</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332638"><span class="hs-identifier hs-var">filtered_tm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2919"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332638"><span class="hs-identifier hs-var">filtered_tm</span></a></span><span>
</span><span id="line-2920"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2921"></span><span>        </span><span id="local-6989586621681332638"><span class="annot"><span class="annottext">filtered_tm :: ListMap LooseTypeMap a
</span><a href="#local-6989586621681332638"><span class="hs-identifier hs-var hs-var">filtered_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; (a -&gt; Bool) -&gt; m a -&gt; m a
</span><a href="GHC.Data.TrieMap.html#filterTM"><span class="hs-identifier hs-var">filterTM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621681332644"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332640"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-2922"></span><span>
</span><span id="line-2923"></span><span id="local-6989586621681332636"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcAppMapToBag"><span class="hs-identifier hs-type">tcAppMapToBag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332636"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332636"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2924"></span><span id="tcAppMapToBag"><span class="annot"><span class="annottext">tcAppMapToBag :: forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#tcAppMapToBag"><span class="hs-identifier hs-var hs-var">tcAppMapToBag</span></a></span></span><span> </span><span id="local-6989586621681332634"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332634"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332634"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-2925"></span><span>
</span><span id="line-2926"></span><span id="local-6989586621681332631"><span id="local-6989586621681332632"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldTcAppMap"><span class="hs-identifier hs-type">foldTcAppMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681332632"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332631"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332631"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332632"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332631"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332631"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-2927"></span><span id="foldTcAppMap"><span class="annot"><span class="annottext">foldTcAppMap :: forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldTcAppMap"><span class="hs-identifier hs-var hs-var">foldTcAppMap</span></a></span></span><span> </span><span id="local-6989586621681332629"><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621681332629"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681332628"><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332628"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332627"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681332627"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall elt a. (elt -&gt; a -&gt; a) -&gt; a -&gt; DTyConEnv elt -&gt; a
</span><a href="GHC.Core.TyCon.Env.html#foldDTyConEnv"><span class="hs-identifier hs-var">foldDTyConEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
TrieMap m =&gt;
(a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
</span><a href="GHC.Data.TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
</span><a href="#local-6989586621681332629"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681332627"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">TcAppMap a
</span><a href="#local-6989586621681332628"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2928"></span><span>
</span><span id="line-2929"></span><span>
</span><span id="line-2930"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   DictMap
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-2935"></span><span>
</span><span id="line-2936"></span><span>
</span><span id="line-2937"></span><span class="hs-comment">{- Note [Tuples hiding implicit parameters]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   f,g :: (?x::Int, C a) =&gt; a -&gt; a
   f v = let ?x = 4 in g v

The call to 'g' gives rise to a Wanted constraint (?x::Int, C a).
We must /not/ solve this from the Given (?x::Int, C a), because of
the intervening binding for (?x::Int).  #14218.

We deal with this by arranging that we always fail when looking up a
tuple constraint that hides an implicit parameter. Not that this applies
  * both to the inert_dicts (lookupInertDict)
  * and to the solved_dicts (looukpSolvedDict)
An alternative would be not to extend these sets with such tuple
constraints, but it seemed more direct to deal with the lookup.

Note [Solving CallStack constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose f :: HasCallStack =&gt; blah.  Then

* Each call to 'f' gives rise to
    [W] s1 :: IP &quot;callStack&quot; CallStack    -- CtOrigin = OccurrenceOf f
  with a CtOrigin that says &quot;OccurrenceOf f&quot;.
  Remember that HasCallStack is just shorthand for
    IP &quot;callStack CallStack
  See Note [Overview of implicit CallStacks] in GHC.Tc.Types.Evidence

* We cannonicalise such constraints, in GHC.Tc.Solver.Canonical.canClassNC, by
  pushing the call-site info on the stack, and changing the CtOrigin
  to record that has been done.
   Bind:  s1 = pushCallStack &lt;site-info&gt; s2
   [W] s2 :: IP &quot;callStack&quot; CallStack   -- CtOrigin = IPOccOrigin

* Then, and only then, we can solve the constraint from an enclosing
  Given.

So we must be careful /not/ to solve 's1' from the Givens.  Again,
we ensure this by arranging that findDict always misses when looking
up souch constraints.
-}</span><span>
</span><span id="line-2978"></span><span>
</span><span id="line-2979"></span><span class="hs-keyword">type</span><span> </span><span id="DictMap"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-var">DictMap</span></a></span></span><span> </span><span id="local-6989586621681332624"><span class="annot"><a href="#local-6989586621681332624"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332624"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-2980"></span><span>
</span><span id="line-2981"></span><span id="local-6989586621681332623"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyDictMap"><span class="hs-identifier hs-type">emptyDictMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332623"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2982"></span><span id="emptyDictMap"><span class="annot"><span class="annottext">emptyDictMap :: forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyDictMap"><span class="hs-identifier hs-var hs-var">emptyDictMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a></span><span>
</span><span id="line-2983"></span><span>
</span><span id="line-2984"></span><span id="local-6989586621681334342"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findDict"><span class="hs-identifier hs-type">findDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334342"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334342"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2985"></span><span id="findDict"><span class="annot"><span class="annottext">findDict :: forall a. DictMap a -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findDict"><span class="hs-identifier hs-var hs-var">findDict</span></a></span></span><span> </span><span id="local-6989586621681332622"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332622"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332621"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332621"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332620"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332620"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332619"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332619"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2986"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Bool
</span><a href="GHC.Core.Predicate.html#hasIPSuperClasses"><span class="hs-identifier hs-var">hasIPSuperClasses</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332620"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332619"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-comment">-- See Note [Tuples hiding implicit parameters]</span><span>
</span><span id="line-2987"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2988"></span><span>
</span><span id="line-2989"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Maybe FastString
</span><a href="GHC.Tc.Utils.TcType.html#isCallStackPred"><span class="hs-identifier hs-var">isCallStackPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332620"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332619"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2990"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-type">OccurrenceOf</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332621"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2991"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>             </span><span class="hs-comment">-- See Note [Solving CallStack constraints]</span><span>
</span><span id="line-2992"></span><span>
</span><span id="line-2993"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2994"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findTcApp"><span class="hs-identifier hs-var">findTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332622"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332620"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332619"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2995"></span><span>
</span><span id="line-2996"></span><span id="local-6989586621681334378"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findDictsByClass"><span class="hs-identifier hs-type">findDictsByClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334378"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334378"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2997"></span><span id="findDictsByClass"><span class="annot"><span class="annottext">findDictsByClass :: forall a. DictMap a -&gt; Class -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#findDictsByClass"><span class="hs-identifier hs-var hs-var">findDictsByClass</span></a></span></span><span> </span><span id="local-6989586621681332613"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332613"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332612"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332612"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-2998"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332611"><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332611"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. DTyConEnv a -&gt; TyCon -&gt; Maybe a
</span><a href="GHC.Core.TyCon.Env.html#lookupDTyConEnv"><span class="hs-identifier hs-var">lookupDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332613"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332612"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
TrieMap m =&gt;
(a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
</span><a href="GHC.Data.TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332611"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-2999"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-3000"></span><span>
</span><span id="line-3001"></span><span id="local-6989586621681334346"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#delDict"><span class="hs-identifier hs-type">delDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334346"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334346"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3002"></span><span id="delDict"><span class="annot"><span class="annottext">delDict :: forall a. DictMap a -&gt; Class -&gt; [Type] -&gt; DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#delDict"><span class="hs-identifier hs-var hs-var">delDict</span></a></span></span><span> </span><span id="local-6989586621681332610"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332610"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332609"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332609"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332608"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332608"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#delTcApp"><span class="hs-identifier hs-var">delTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332610"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332609"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332608"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-3003"></span><span>
</span><span id="line-3004"></span><span id="local-6989586621681334397"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addDict"><span class="hs-identifier hs-type">addDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334397"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334397"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334397"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3005"></span><span id="addDict"><span class="annot"><span class="annottext">addDict :: forall a. DictMap a -&gt; Class -&gt; [Type] -&gt; a -&gt; DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#addDict"><span class="hs-identifier hs-var hs-var">addDict</span></a></span></span><span> </span><span id="local-6989586621681332607"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332607"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332606"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332606"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332605"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332605"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681332604"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332604"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621681332607"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332606"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332605"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332604"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-3006"></span><span>
</span><span id="line-3007"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addDictCt"><span class="hs-identifier hs-type">addDictCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-3008"></span><span class="hs-comment">-- Like addDict, but combines [W] and [D] to [WD]</span><span>
</span><span id="line-3009"></span><span class="hs-comment">-- See Note [KeepBoth] in GHC.Tc.Solver.Interact</span><span>
</span><span id="line-3010"></span><span id="addDictCt"><span class="annot"><span class="annottext">addDictCt :: DictMap Ct -&gt; Class -&gt; [Type] -&gt; Ct -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#addDictCt"><span class="hs-identifier hs-var hs-var">addDictCt</span></a></span></span><span> </span><span id="local-6989586621681332603"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332603"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332602"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332602"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332601"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332601"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681332600"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332600"><span class="hs-identifier hs-var">new_ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; XT a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#alterTcApp"><span class="hs-identifier hs-var">alterTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332603"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332602"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332601"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ct -&gt; Maybe Ct
</span><a href="#local-6989586621681332599"><span class="hs-identifier hs-var">xt_ct</span></a></span><span>
</span><span id="line-3011"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3012"></span><span>    </span><span id="local-6989586621681332598"><span class="annot"><span class="annottext">new_ct_ev :: CtEvidence
</span><a href="#local-6989586621681332598"><span class="hs-identifier hs-var hs-var">new_ct_ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332600"><span class="hs-identifier hs-var">new_ct</span></a></span><span>
</span><span id="line-3013"></span><span>
</span><span id="line-3014"></span><span>    </span><span class="annot"><a href="#local-6989586621681332599"><span class="hs-identifier hs-type">xt_ct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-3015"></span><span>    </span><span id="local-6989586621681332599"><span class="annot"><span class="annottext">xt_ct :: Maybe Ct -&gt; Maybe Ct
</span><a href="#local-6989586621681332599"><span class="hs-identifier hs-var hs-var">xt_ct</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332597"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332597"><span class="hs-identifier hs-var">old_ct</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3016"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: CtEvidence -&gt; ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332596"><span class="hs-identifier hs-var">old_ct_ev</span></a></span><span>
</span><span id="line-3017"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtDerived"><span class="hs-identifier hs-type">CtDerived</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332598"><span class="hs-identifier hs-var">new_ct_ev</span></a></span><span>
</span><span id="line-3018"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332597"><span class="hs-identifier hs-var">old_ct</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332596"><span class="hs-identifier hs-var">old_ct_ev</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3019"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtDerived"><span class="hs-identifier hs-type">CtDerived</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332596"><span class="hs-identifier hs-var">old_ct_ev</span></a></span><span>
</span><span id="line-3020"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: CtEvidence -&gt; ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332598"><span class="hs-identifier hs-var">new_ct_ev</span></a></span><span>
</span><span id="line-3021"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332600"><span class="hs-identifier hs-var">new_ct</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332598"><span class="hs-identifier hs-var">new_ct_ev</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3022"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3023"></span><span>        </span><span id="local-6989586621681332596"><span class="annot"><span class="annottext">old_ct_ev :: CtEvidence
</span><a href="#local-6989586621681332596"><span class="hs-identifier hs-var hs-var">old_ct_ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332597"><span class="hs-identifier hs-var">old_ct</span></a></span><span>
</span><span id="line-3024"></span><span>
</span><span id="line-3025"></span><span>    </span><span class="annot"><a href="#local-6989586621681332599"><span class="hs-identifier hs-var">xt_ct</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ct
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332600"><span class="hs-identifier hs-var">new_ct</span></a></span><span>
</span><span id="line-3026"></span><span>
</span><span id="line-3027"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addDictsByClass"><span class="hs-identifier hs-type">addDictsByClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-3028"></span><span id="addDictsByClass"><span class="annot"><span class="annottext">addDictsByClass :: DictMap Ct -&gt; Class -&gt; Bag Ct -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#addDictsByClass"><span class="hs-identifier hs-var hs-var">addDictsByClass</span></a></span></span><span> </span><span id="local-6989586621681332595"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332595"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332594"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332594"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332593"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332593"><span class="hs-identifier hs-var">items</span></a></span></span><span>
</span><span id="line-3029"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DTyConEnv a -&gt; TyCon -&gt; a -&gt; DTyConEnv a
</span><a href="GHC.Core.TyCon.Env.html#extendDTyConEnv"><span class="hs-identifier hs-var">extendDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332595"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332594"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *}.
(Key m ~ [Type], TrieMap m) =&gt;
Ct -&gt; m Ct -&gt; m Ct
</span><a href="#local-6989586621681332591"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; m a
</span><a href="GHC.Data.TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332593"><span class="hs-identifier hs-var">items</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3030"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3031"></span><span>    </span><span id="local-6989586621681332591"><span class="annot"><span class="annottext">add :: Ct -&gt; m Ct -&gt; m Ct
</span><a href="#local-6989586621681332591"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621681332583"><span class="annot"><span class="annottext">ct :: Ct
</span><a href="#local-6989586621681332583"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332582"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332582"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332581"><span class="annot"><span class="annottext">m Ct
</span><a href="#local-6989586621681332581"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. TrieMap m =&gt; Key m -&gt; a -&gt; m a -&gt; m a
</span><a href="GHC.Data.TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332582"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332583"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">m Ct
</span><a href="#local-6989586621681332581"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-3032"></span><span>    </span><span class="annot"><a href="#local-6989586621681332591"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span id="local-6989586621681332580"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332580"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="annot"><span class="annottext">m Ct
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addDictsByClass&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332580"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3033"></span><span>
</span><span id="line-3034"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#filterDicts"><span class="hs-identifier hs-type">filterDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>
</span><span id="line-3035"></span><span id="filterDicts"><span class="annot"><span class="annottext">filterDicts :: (Ct -&gt; Bool) -&gt; DictMap Ct -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#filterDicts"><span class="hs-identifier hs-var hs-var">filterDicts</span></a></span></span><span> </span><span id="local-6989586621681332579"><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681332579"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681332578"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332578"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; TcAppMap a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#filterTcAppMap"><span class="hs-identifier hs-var">filterTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681332579"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332578"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-3036"></span><span>
</span><span id="line-3037"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#partitionDicts"><span class="hs-identifier hs-type">partitionDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3038"></span><span id="partitionDicts"><span class="annot"><span class="annottext">partitionDicts :: (Ct -&gt; Bool) -&gt; DictMap Ct -&gt; (Bag Ct, DictMap Ct)
</span><a href="GHC.Tc.Solver.Monad.html#partitionDicts"><span class="hs-identifier hs-var hs-var">partitionDicts</span></a></span></span><span> </span><span id="local-6989586621681332577"><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681332577"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681332576"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332576"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; (Bag Ct, DictMap Ct) -&gt; (Bag Ct, DictMap Ct)
</span><a href="#local-6989586621681332575"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332576"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyDicts"><span class="hs-identifier hs-var">emptyDicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3039"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3040"></span><span>    </span><span id="local-6989586621681332575"><span class="annot"><span class="annottext">k :: Ct -&gt; (Bag Ct, DictMap Ct) -&gt; (Bag Ct, DictMap Ct)
</span><a href="#local-6989586621681332575"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681332574"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332574"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332573"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332573"><span class="hs-identifier hs-var">yeses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332572"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332572"><span class="hs-identifier hs-var">noes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621681332577"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332574"><span class="hs-identifier hs-var">ct</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332574"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-operator hs-var">`consBag`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332573"><span class="hs-identifier hs-var">yeses</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332572"><span class="hs-identifier hs-var">noes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3041"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332573"><span class="hs-identifier hs-var">yeses</span></a></span><span class="hs-special">,</span><span>              </span><span class="annot"><span class="annottext">Ct -&gt; DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332571"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332574"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332572"><span class="hs-identifier hs-var">noes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3042"></span><span>    </span><span id="local-6989586621681332571"><span class="annot"><span class="annottext">add :: Ct -&gt; DictMap Ct -&gt; DictMap Ct
</span><a href="#local-6989586621681332571"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621681332567"><span class="annot"><span class="annottext">ct :: Ct
</span><a href="#local-6989586621681332567"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332566"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332566"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332565"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332565"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332564"><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332564"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-3043"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Class -&gt; [Type] -&gt; a -&gt; DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#addDict"><span class="hs-identifier hs-var">addDict</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><a href="#local-6989586621681332564"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332566"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332565"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332567"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-3044"></span><span>    </span><span class="annot"><a href="#local-6989586621681332571"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span id="local-6989586621681332563"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332563"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="annot"><span class="annottext">DictMap Ct
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;partitionDicts&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681332563"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3045"></span><span>
</span><span id="line-3046"></span><span id="local-6989586621681334466"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#dictsToBag"><span class="hs-identifier hs-type">dictsToBag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334466"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334466"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3047"></span><span id="dictsToBag"><span class="annot"><span class="annottext">dictsToBag :: forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#dictsToBag"><span class="hs-identifier hs-var hs-var">dictsToBag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Monad.html#tcAppMapToBag"><span class="hs-identifier hs-var">tcAppMapToBag</span></a></span><span>
</span><span id="line-3048"></span><span>
</span><span id="line-3049"></span><span id="local-6989586621681332561"><span id="local-6989586621681332562"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldDicts"><span class="hs-identifier hs-type">foldDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681332562"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332561"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332561"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332562"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332561"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332561"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-3050"></span><span id="foldDicts"><span class="annot"><span class="annottext">foldDicts :: forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldDicts"><span class="hs-identifier hs-var hs-var">foldDicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span>
</span><span id="line-3051"></span><span>
</span><span id="line-3052"></span><span id="local-6989586621681334463"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyDicts"><span class="hs-identifier hs-type">emptyDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334463"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3053"></span><span id="emptyDicts"><span class="annot"><span class="annottext">emptyDicts :: forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyDicts"><span class="hs-identifier hs-var hs-var">emptyDicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a></span><span>
</span><span id="line-3054"></span><span>
</span><span id="line-3055"></span><span>
</span><span id="line-3056"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   FunEqMap
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-3061"></span><span>
</span><span id="line-3062"></span><span class="hs-keyword">type</span><span> </span><span id="FunEqMap"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-var">FunEqMap</span></a></span></span><span> </span><span id="local-6989586621681332560"><span class="annot"><a href="#local-6989586621681332560"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332560"><span class="hs-identifier hs-type">a</span></a></span><span>  </span><span class="hs-comment">-- A map whose key is a (TyCon, [Type]) pair</span><span>
</span><span id="line-3063"></span><span>
</span><span id="line-3064"></span><span id="local-6989586621681332559"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emptyFunEqs"><span class="hs-identifier hs-type">emptyFunEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcAppMap"><span class="hs-identifier hs-type">TcAppMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332559"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3065"></span><span id="emptyFunEqs"><span class="annot"><span class="annottext">emptyFunEqs :: forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyFunEqs"><span class="hs-identifier hs-var hs-var">emptyFunEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. DictMap a
</span><a href="GHC.Tc.Solver.Monad.html#emptyTcAppMap"><span class="hs-identifier hs-var">emptyTcAppMap</span></a></span><span>
</span><span id="line-3066"></span><span>
</span><span id="line-3067"></span><span id="local-6989586621681334437"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findFunEq"><span class="hs-identifier hs-type">findFunEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334437"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334437"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3068"></span><span id="findFunEq"><span class="annot"><span class="annottext">findFunEq :: forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findFunEq"><span class="hs-identifier hs-var hs-var">findFunEq</span></a></span></span><span> </span><span id="local-6989586621681332558"><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621681332558"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332557"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332557"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681332556"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332556"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Monad.html#findTcApp"><span class="hs-identifier hs-var">findTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621681332558"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332557"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332556"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-3069"></span><span>
</span><span id="line-3070"></span><span id="local-6989586621681334293"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#findFunEqsByTyCon"><span class="hs-identifier hs-type">findFunEqsByTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334293"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681334293"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-3071"></span><span class="hs-comment">-- Get inert function equation constraints that have the given tycon</span><span>
</span><span id="line-3072"></span><span class="hs-comment">-- in their head.  Not that the constraints remain in the inert set.</span><span>
</span><span id="line-3073"></span><span class="hs-comment">-- We use this to check for derived interactions with built-in type-function</span><span>
</span><span id="line-3074"></span><span class="hs-comment">-- constructors.</span><span>
</span><span id="line-3075"></span><span id="findFunEqsByTyCon"><span class="annot"><span class="annottext">findFunEqsByTyCon :: forall a. FunEqMap a -&gt; TyCon -&gt; [a]
</span><a href="GHC.Tc.Solver.Monad.html#findFunEqsByTyCon"><span class="hs-identifier hs-var hs-var">findFunEqsByTyCon</span></a></span></span><span> </span><span id="local-6989586621681332554"><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621681332554"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332553"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332553"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-3076"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332552"><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332552"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. DTyConEnv a -&gt; TyCon -&gt; Maybe a
</span><a href="GHC.Core.TyCon.Env.html#lookupDTyConEnv"><span class="hs-identifier hs-var">lookupDTyConEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621681332554"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332553"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
TrieMap m =&gt;
(a -&gt; b -&gt; b) -&gt; m a -&gt; b -&gt; b
</span><a href="GHC.Data.TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ListMap LooseTypeMap a
</span><a href="#local-6989586621681332552"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3077"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3078"></span><span>
</span><span id="line-3079"></span><span id="local-6989586621681334446"><span id="local-6989586621681334447"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#foldFunEqs"><span class="hs-identifier hs-type">foldFunEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681334447"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334446"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334446"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334447"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334446"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334446"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-3080"></span><span id="foldFunEqs"><span class="annot"><span class="annottext">foldFunEqs :: forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldFunEqs"><span class="hs-identifier hs-var hs-var">foldFunEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b -&gt; b) -&gt; FunEqMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Monad.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span>
</span><span id="line-3081"></span><span>
</span><span id="line-3082"></span><span id="local-6989586621681332551"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#insertFunEq"><span class="hs-identifier hs-type">insertFunEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332551"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681332551"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332551"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3083"></span><span id="insertFunEq"><span class="annot"><span class="annottext">insertFunEq :: forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#insertFunEq"><span class="hs-identifier hs-var hs-var">insertFunEq</span></a></span></span><span> </span><span id="local-6989586621681332550"><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621681332550"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332549"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332549"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681332548"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332548"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681332547"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332547"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Monad.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">FunEqMap a
</span><a href="#local-6989586621681332550"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681332549"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332548"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332547"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-3084"></span><span>
</span><span id="line-3085"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
*              The TcS solver monad                                    *
*                                                                      *
************************************************************************

Note [The TcS monad]
~~~~~~~~~~~~~~~~~~~~
The TcS monad is a weak form of the main Tc monad

All you can do is
    * fail
    * allocate new variables
    * fill in evidence variables

Filling in a dictionary evidence variable means to create a binding
for it, so TcS carries a mutable location where the binding can be
added.  This is initialised from the innermost implication constraint.
-}</span><span>
</span><span id="line-3105"></span><span>
</span><span id="line-3106"></span><span class="hs-keyword">data</span><span> </span><span id="TcSEnv"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a></span></span><span>
</span><span id="line-3107"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TcSEnv"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-var">TcSEnv</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-3108"></span><span>      </span><span id="tcs_ev_binds"><span class="annot"><span class="annottext">TcSEnv -&gt; EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var hs-var">tcs_ev_binds</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3109"></span><span>
</span><span id="line-3110"></span><span>      </span><span id="tcs_unified"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var hs-var">tcs_unified</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-3111"></span><span>         </span><span class="hs-comment">-- The number of unification variables we have filled</span><span>
</span><span id="line-3112"></span><span>         </span><span class="hs-comment">-- The important thing is whether it is non-zero</span><span>
</span><span id="line-3113"></span><span>
</span><span id="line-3114"></span><span>      </span><span id="tcs_unif_lvl"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var hs-var">tcs_unif_lvl</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-3115"></span><span>         </span><span class="hs-comment">-- The Unification Level Flag</span><span>
</span><span id="line-3116"></span><span>         </span><span class="hs-comment">-- Outermost level at which we have unified a meta tyvar</span><span>
</span><span id="line-3117"></span><span>         </span><span class="hs-comment">-- Starts at Nothing, then (Just i), then (Just j) where j&lt;i</span><span>
</span><span id="line-3118"></span><span>         </span><span class="hs-comment">-- See Note [The Unification Level Flag]</span><span>
</span><span id="line-3119"></span><span>
</span><span id="line-3120"></span><span>      </span><span id="tcs_count"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var hs-var">tcs_count</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Global step count</span><span>
</span><span id="line-3121"></span><span>
</span><span id="line-3122"></span><span>      </span><span id="tcs_inerts"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var hs-var">tcs_inerts</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Current inert set</span><span>
</span><span id="line-3123"></span><span>
</span><span id="line-3124"></span><span>      </span><span class="hs-comment">-- See Note [WorkList priorities] and</span><span>
</span><span id="line-3125"></span><span>      </span><span id="tcs_worklist"><span class="annot"><span class="annottext">TcSEnv -&gt; IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var hs-var">tcs_worklist</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-comment">-- Current worklist</span><span>
</span><span id="line-3126"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-3127"></span><span>
</span><span id="line-3128"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-3129"></span><span class="hs-keyword">newtype</span><span> </span><span id="TcS"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span></span><span> </span><span id="local-6989586621681334288"><span class="annot"><a href="#local-6989586621681334288"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TcS"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unTcS"><span class="annot"><span class="annottext">forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var hs-var">unTcS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334288"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332532"><span id="local-6989586621681332536"><span class="annot"><span class="annottext">forall a b. a -&gt; TcS b -&gt; TcS a
forall a b. (a -&gt; b) -&gt; TcS a -&gt; TcS b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; TcS b -&gt; TcS a
$c&lt;$ :: forall a b. a -&gt; TcS b -&gt; TcS a
fmap :: forall a b. (a -&gt; b) -&gt; TcS a -&gt; TcS b
$cfmap :: forall a b. (a -&gt; b) -&gt; TcS a -&gt; TcS b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3130"></span><span>
</span><span id="line-3131"></span><span class="hs-comment">-- | Smart constructor for 'TcS', as describe in Note [The one-shot state</span><span>
</span><span id="line-3132"></span><span class="hs-comment">-- monad trick] in &quot;GHC.Utils.Monad&quot;.</span><span>
</span><span id="line-3133"></span><span id="local-6989586621681334283"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-type">mkTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334283"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334283"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3134"></span><span id="mkTcS"><span class="annot"><span class="annottext">mkTcS :: forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var hs-var">mkTcS</span></a></span></span><span> </span><span id="local-6989586621681332528"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332528"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">oneShot :: forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-identifier hs-type">oneShot</span></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332528"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3135"></span><span>
</span><span id="line-3136"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681332518"><span id="local-6989586621681332520"><span id="local-6989586621681332522"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3137"></span><span>  </span><span id="local-6989586621681332515"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; TcS a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></a></span></span><span> </span><span id="local-6989586621681332514"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332514"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TcSEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332514"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3138"></span><span>  </span><span id="local-6989586621681332512"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. TcS (a -&gt; b) -&gt; TcS a -&gt; TcS b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#ap"><span class="hs-identifier hs-var">ap</span></a></span><span>
</span><span id="line-3139"></span><span>
</span><span id="line-3140"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681332504"><span id="local-6989586621681332506"><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3141"></span><span>  </span><span id="local-6989586621681332501"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332501"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681332500"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. TcS a -&gt; (a -&gt; TcS b) -&gt; TcS b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></a></span></span><span> </span><span id="local-6989586621681332499"><span class="annot"><span class="annottext">a -&gt; TcS b
</span><a href="#local-6989586621681332499"><span class="hs-identifier hs-var">k</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681332498"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332498"><span class="hs-identifier hs-var">ebs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3142"></span><span>    </span><span class="annot"><span class="annottext">forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var">unTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332501"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332498"><span class="hs-identifier hs-var">ebs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681332497"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332497"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var">unTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcS b
</span><a href="#local-6989586621681332499"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332497"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332498"><span class="hs-identifier hs-var">ebs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3143"></span><span>
</span><span id="line-3144"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad-Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3145"></span><span>  </span><span id="local-6989586621681332489"><span class="annot"><span class="annottext">fail :: forall a. String -&gt; TcS a
</span><a href="../../base-4.16.3.0/src/Control-Monad-Fail.html#fail"><span class="hs-identifier hs-var hs-var hs-var hs-var">fail</span></a></span></span><span> </span><span id="local-6989586621681332488"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681332488"><span class="hs-identifier hs-var">err</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TcSEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../base-4.16.3.0/src/Control-Monad-Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681332488"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-3146"></span><span>
</span><span id="line-3147"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681332481"><span id="local-6989586621681332483"><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3148"></span><span>   </span><span id="local-6989586621681332477"><span class="annot"><span class="annottext">getUniqueSupplyM :: TcS UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var hs-var hs-var hs-var">getUniqueSupplyM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span><span>
</span><span id="line-3149"></span><span>
</span><span id="line-3150"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html#HasModule"><span class="hs-identifier hs-type">HasModule</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3151"></span><span>   </span><span id="local-6989586621681332466"><span class="annot"><span class="annottext">getModule :: TcS Module
</span><a href="#local-6989586621681332466"><span class="hs-identifier hs-var hs-var hs-var hs-var">getModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-3152"></span><span>
</span><span id="line-3153"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681332457"><span id="local-6989586621681332459"><span id="local-6989586621681332461"><span class="annot"><a href="GHC.Types.TyThing.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3154"></span><span>   </span><span id="local-6989586621681332453"><span class="annot"><span class="annottext">lookupThing :: Name -&gt; TcS TyThing
</span><a href="GHC.Types.TyThing.html#lookupThing"><span class="hs-identifier hs-var hs-var hs-var hs-var">lookupThing</span></a></span></span><span> </span><span id="local-6989586621681332451"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681332451"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadThings m =&gt; Name -&gt; m TyThing
</span><a href="GHC.Types.TyThing.html#lookupThing"><span class="hs-identifier hs-var">lookupThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681332451"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3155"></span><span>
</span><span id="line-3156"></span><span class="hs-comment">-- Basic functionality</span><span>
</span><span id="line-3157"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3158"></span><span id="local-6989586621681334485"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-type">wrapTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334485"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334485"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3159"></span><span class="hs-comment">-- Do not export wrapTcS, because it promotes an arbitrary TcM to TcS,</span><span>
</span><span id="line-3160"></span><span class="hs-comment">-- and TcS is supposed to have limited functionality</span><span>
</span><span id="line-3161"></span><span id="wrapTcS"><span class="annot"><span class="annottext">wrapTcS :: forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var hs-var">wrapTcS</span></a></span></span><span> </span><span id="local-6989586621681332450"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681332450"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681332449"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332449"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681332450"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-comment">-- a TcM action will not use the TcEvBinds</span><span>
</span><span id="line-3162"></span><span>
</span><span id="line-3163"></span><span id="local-6989586621681332448"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier hs-type">wrapErrTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332448"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332448"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3164"></span><span class="hs-comment">-- The thing wrapped should just fail</span><span>
</span><span id="line-3165"></span><span class="hs-comment">-- There's no static check; it's up to the user</span><span>
</span><span id="line-3166"></span><span class="hs-comment">-- Having a variant for each error message is too painful</span><span>
</span><span id="line-3167"></span><span id="wrapErrTcS"><span class="annot"><span class="annottext">wrapErrTcS :: forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier hs-var hs-var">wrapErrTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span>
</span><span id="line-3168"></span><span>
</span><span id="line-3169"></span><span id="local-6989586621681332447"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#wrapWarnTcS"><span class="hs-identifier hs-type">wrapWarnTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332447"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332447"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3170"></span><span class="hs-comment">-- The thing wrapped should just add a warning, or no-op</span><span>
</span><span id="line-3171"></span><span class="hs-comment">-- There's no static check; it's up to the user</span><span>
</span><span id="line-3172"></span><span id="wrapWarnTcS"><span class="annot"><span class="annottext">wrapWarnTcS :: forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapWarnTcS"><span class="hs-identifier hs-var hs-var">wrapWarnTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span>
</span><span id="line-3173"></span><span>
</span><span id="line-3174"></span><span id="local-6989586621681334236"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#failTcS"><span class="hs-identifier hs-type">failTcS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#panicTcS"><span class="hs-identifier hs-type">panicTcS</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334236"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3175"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#warnTcS"><span class="hs-identifier hs-type">warnTcS</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3176"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addErrTcS"><span class="hs-identifier hs-type">addErrTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3177"></span><span id="failTcS"><span class="annot"><span class="annottext">failTcS :: forall a. SDoc -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#failTcS"><span class="hs-identifier hs-var hs-var">failTcS</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">TcM.failWith</span></a></span><span>
</span><span id="line-3178"></span><span id="warnTcS"><span class="annot"><span class="annottext">warnTcS :: WarningFlag -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#warnTcS"><span class="hs-identifier hs-var hs-var">warnTcS</span></a></span></span><span> </span><span id="local-6989586621681332445"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681332445"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarn"><span class="hs-identifier hs-var">TcM.addWarn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681332445"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3179"></span><span id="addErrTcS"><span class="annot"><span class="annottext">addErrTcS :: SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addErrTcS"><span class="hs-identifier hs-var hs-var">addErrTcS</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">TcM.addErr</span></a></span><span>
</span><span id="line-3180"></span><span id="panicTcS"><span class="annot"><span class="annottext">panicTcS :: forall a. SDoc -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#panicTcS"><span class="hs-identifier hs-var hs-var">panicTcS</span></a></span></span><span> </span><span id="local-6989586621681332439"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332439"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Solver.Canonical&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332439"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-3181"></span><span>
</span><span id="line-3182"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-type">traceTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3183"></span><span id="traceTcS"><span class="annot"><span class="annottext">traceTcS :: String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var hs-var">traceTcS</span></a></span></span><span> </span><span id="local-6989586621681332438"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681332438"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621681332437"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332437"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681332438"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332437"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3184"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-pragma hs-type">traceTcS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-3185"></span><span>
</span><span id="line-3186"></span><span id="local-6989586621681334230"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcPluginTcS"><span class="hs-identifier hs-type">runTcPluginTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334230"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334230"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3187"></span><span id="runTcPluginTcS"><span class="annot"><span class="annottext">runTcPluginTcS :: forall a. TcPluginM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#runTcPluginTcS"><span class="hs-identifier hs-var hs-var">runTcPluginTcS</span></a></span></span><span> </span><span id="local-6989586621681332434"><span class="annot"><span class="annottext">TcPluginM a
</span><a href="#local-6989586621681332434"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TcPluginM a -&gt; EvBindsVar -&gt; TcM a
</span><a href="GHC.Tc.Types.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a></span><span> </span><span class="annot"><span class="annottext">TcPluginM a
</span><a href="#local-6989586621681332434"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var">getTcEvBindsVar</span></a></span><span>
</span><span id="line-3188"></span><span>
</span><span id="line-3189"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3190"></span><span>    </span><span id="local-6989586621681332428"><span class="annot"><span class="annottext">getDynFlags :: TcS DynFlags
</span><a href="#local-6989586621681332428"><span class="hs-identifier hs-var hs-var hs-var hs-var">getDynFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-3191"></span><span>
</span><span id="line-3192"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier hs-type">getGlobalRdrEnvTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-3193"></span><span id="getGlobalRdrEnvTcS"><span class="annot"><span class="annottext">getGlobalRdrEnvTcS :: TcS GlobalRdrEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier hs-var hs-var">getGlobalRdrEnvTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">TcM.getGlobalRdrEnv</span></a></span><span>
</span><span id="line-3194"></span><span>
</span><span id="line-3195"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#bumpStepCountTcS"><span class="hs-identifier hs-type">bumpStepCountTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3196"></span><span id="bumpStepCountTcS"><span class="annot"><span class="annottext">bumpStepCountTcS :: TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#bumpStepCountTcS"><span class="hs-identifier hs-var hs-var">bumpStepCountTcS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681332426"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332426"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3197"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332425"><span class="annot"><span class="annottext">ref :: IORef Int
</span><a href="#local-6989586621681332425"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332426"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-3198"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332424"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332424"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332425"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3199"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332425"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332424"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3200"></span><span>
</span><span id="line-3201"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-type">csTraceTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3202"></span><span id="csTraceTcS"><span class="annot"><span class="annottext">csTraceTcS :: SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-identifier hs-var hs-var">csTraceTcS</span></a></span></span><span> </span><span id="local-6989586621681332423"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332423"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-3203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcM SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332423"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3204"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcS"><span class="hs-pragma hs-type">csTraceTcS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-3205"></span><span>
</span><span id="line-3206"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-identifier hs-type">traceFireTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3207"></span><span class="hs-comment">-- Dump a rule-firing trace</span><span>
</span><span id="line-3208"></span><span id="traceFireTcS"><span class="annot"><span class="annottext">traceFireTcS :: CtEvidence -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-identifier hs-var hs-var">traceFireTcS</span></a></span></span><span> </span><span id="local-6989586621681332421"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332421"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621681332420"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332420"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-3209"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#mkTcS"><span class="hs-identifier hs-var">mkTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681332419"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332419"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3210"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332418"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332418"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332419"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3211"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332417"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332417"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">TcM.getTcLevel</span></a></span><span>
</span><span id="line-3212"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Step&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332418"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-3213"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;l:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332417"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-3214"></span><span>                                    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;d:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; SubGoalDepth
</span><a href="GHC.Tc.Types.Constraint.html#ctLocDepth"><span class="hs-identifier hs-var">ctLocDepth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332421"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3215"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332420"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3216"></span><span>                     </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332421"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3217"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#traceFireTcS"><span class="hs-pragma hs-type">traceFireTcS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-3218"></span><span>
</span><span id="line-3219"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-type">csTraceTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3220"></span><span class="hs-comment">-- Constraint-solver tracing, -ddump-cs-trace</span><span>
</span><span id="line-3221"></span><span id="csTraceTcM"><span class="annot"><span class="annottext">csTraceTcM :: TcM SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-var hs-var">csTraceTcM</span></a></span></span><span> </span><span id="local-6989586621681332410"><span class="annot"><span class="annottext">TcM SDoc
</span><a href="#local-6989586621681332410"><span class="hs-identifier hs-var">mk_doc</span></a></span></span><span>
</span><span id="line-3222"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332409"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681332409"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-3223"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span>  </span><span class="annot"><span class="annottext">DumpFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cs_trace"><span class="hs-identifier hs-var">Opt_D_dump_cs_trace</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681332409"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-3224"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-var">Opt_D_dump_tc_trace</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681332409"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3225"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332405"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332405"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM SDoc
</span><a href="#local-6989586621681332410"><span class="hs-identifier hs-var">mk_doc</span></a></span><span>
</span><span id="line-3226"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-var">TcM.dumpTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3227"></span><span>                       </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cs_trace"><span class="hs-identifier hs-var">Opt_D_dump_cs_trace</span></a></span><span>
</span><span id="line-3228"></span><span>                       </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span>
</span><span id="line-3229"></span><span>                       </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332405"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3230"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-pragma hs-type">csTraceTcM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-3231"></span><span>
</span><span id="line-3232"></span><span id="local-6989586621681334220"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcS"><span class="hs-identifier hs-type">runTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334220"><span class="hs-identifier hs-type">a</span></a></span><span>                </span><span class="hs-comment">-- What to run</span><span>
</span><span id="line-3233"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681334220"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3234"></span><span id="runTcS"><span class="annot"><span class="annottext">runTcS :: forall a. TcS a -&gt; TcM (a, EvBindMap)
</span><a href="GHC.Tc.Solver.Monad.html#runTcS"><span class="hs-identifier hs-var hs-var">runTcS</span></a></span></span><span> </span><span id="local-6989586621681332398"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332398"><span class="hs-identifier hs-var">tcs</span></a></span></span><span>
</span><span id="line-3235"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332397"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332397"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-3236"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332395"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332395"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var">runTcSWithEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332397"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332398"><span class="hs-identifier hs-var">tcs</span></a></span><span>
</span><span id="line-3237"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332394"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681332394"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindMap
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var">TcM.getTcEvBindsMap</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332397"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-3238"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332395"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681332394"><span class="hs-identifier hs-var">ev_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3239"></span><span class="hs-comment">-- | This variant of 'runTcS' will keep solving, even when only Deriveds</span><span>
</span><span id="line-3240"></span><span class="hs-comment">-- are left around. It also doesn't return any evidence, as callers won't</span><span>
</span><span id="line-3241"></span><span class="hs-comment">-- need it.</span><span>
</span><span id="line-3242"></span><span id="local-6989586621681334216"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSDeriveds"><span class="hs-identifier hs-type">runTcSDeriveds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334216"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334216"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3243"></span><span id="runTcSDeriveds"><span class="annot"><span class="annottext">runTcSDeriveds :: forall a. TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSDeriveds"><span class="hs-identifier hs-var hs-var">runTcSDeriveds</span></a></span></span><span> </span><span id="local-6989586621681332391"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332391"><span class="hs-identifier hs-var">tcs</span></a></span></span><span>
</span><span id="line-3244"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332390"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332390"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-3245"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var">runTcSWithEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332390"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332391"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3246"></span><span>
</span><span id="line-3247"></span><span class="hs-comment">-- | This can deal only with equality constraints.</span><span>
</span><span id="line-3248"></span><span id="local-6989586621681332389"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSEqualities"><span class="hs-identifier hs-type">runTcSEqualities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332389"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681332389"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3249"></span><span id="runTcSEqualities"><span class="annot"><span class="annottext">runTcSEqualities :: forall a. TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSEqualities"><span class="hs-identifier hs-var hs-var">runTcSEqualities</span></a></span></span><span> </span><span id="local-6989586621681332387"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332387"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-3250"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332386"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332386"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var">TcM.newNoTcEvBinds</span></a></span><span>
</span><span id="line-3251"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var">runTcSWithEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332386"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332387"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3252"></span><span>
</span><span id="line-3253"></span><span class="hs-comment">-- | A variant of 'runTcS' that takes and returns an 'InertSet' for</span><span>
</span><span id="line-3254"></span><span class="hs-comment">-- later resumption of the 'TcS' session.</span><span>
</span><span id="line-3255"></span><span id="local-6989586621681334213"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSInerts"><span class="hs-identifier hs-type">runTcSInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334213"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681334213"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3256"></span><span id="runTcSInerts"><span class="annot"><span class="annottext">runTcSInerts :: forall a. InertSet -&gt; TcS a -&gt; TcM (a, InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#runTcSInerts"><span class="hs-identifier hs-var hs-var">runTcSInerts</span></a></span></span><span> </span><span id="local-6989586621681332379"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332379"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span id="local-6989586621681332378"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332378"><span class="hs-identifier hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3257"></span><span>  </span><span id="local-6989586621681332377"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332377"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-3258"></span><span>  </span><span class="annot"><span class="annottext">forall a. Bool -&gt; EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-var">runTcSWithEvBinds'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332377"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3259"></span><span>    </span><span class="annot"><span class="annottext">InertSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setTcSInerts"><span class="hs-identifier hs-var">setTcSInerts</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332379"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-3260"></span><span>    </span><span id="local-6989586621681332375"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332375"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332378"><span class="hs-identifier hs-var">tcs</span></a></span><span>
</span><span id="line-3261"></span><span>    </span><span id="local-6989586621681332374"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332374"><span class="hs-identifier hs-var">new_inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span>
</span><span id="line-3262"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332375"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332374"><span class="hs-identifier hs-var">new_inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3263"></span><span>
</span><span id="line-3264"></span><span id="local-6989586621681334217"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-type">runTcSWithEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-3265"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334217"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3266"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334217"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3267"></span><span id="runTcSWithEvBinds"><span class="annot"><span class="annottext">runTcSWithEvBinds :: forall a. EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds"><span class="hs-identifier hs-var hs-var">runTcSWithEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Bool -&gt; EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-var">runTcSWithEvBinds'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3268"></span><span>
</span><span id="line-3269"></span><span id="local-6989586621681334211"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-type">runTcSWithEvBinds'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ Restore type equality cycles afterwards?</span><span>
</span><span id="line-3270"></span><span>                           </span><span class="hs-comment">-- Don't if you want to reuse the InertSet.</span><span>
</span><span id="line-3271"></span><span>                           </span><span class="hs-comment">-- See also Note [Type equality cycles]</span><span>
</span><span id="line-3272"></span><span>                           </span><span class="hs-comment">-- in GHC.Tc.Solver.Canonical</span><span>
</span><span id="line-3273"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-3274"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334211"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3275"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334211"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3276"></span><span id="runTcSWithEvBinds%27"><span class="annot"><span class="annottext">runTcSWithEvBinds' :: forall a. Bool -&gt; EvBindsVar -&gt; TcS a -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#runTcSWithEvBinds%27"><span class="hs-identifier hs-var hs-var">runTcSWithEvBinds'</span></a></span></span><span> </span><span id="local-6989586621681332355"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332355"><span class="hs-identifier hs-var">restore_cycles</span></a></span></span><span> </span><span id="local-6989586621681332354"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332354"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span id="local-6989586621681332353"><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332353"><span class="hs-identifier hs-var">tcs</span></a></span></span><span>
</span><span id="line-3277"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332352"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332352"><span class="hs-identifier hs-var">unified_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-3278"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332350"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332350"><span class="hs-identifier hs-var">step_count</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-3279"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332349"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332349"><span class="hs-identifier hs-var">inert_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="GHC.Tc.Solver.Monad.html#emptyInert"><span class="hs-identifier hs-var">emptyInert</span></a></span><span>
</span><span id="line-3280"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332348"><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332348"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a></span><span>
</span><span id="line-3281"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332347"><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332347"><span class="hs-identifier hs-var">unif_lvl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3282"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332346"><span class="annot"><span class="annottext">env :: TcSEnv
</span><a href="#local-6989586621681332346"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_ev_binds :: EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332354"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-3283"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unified :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332352"><span class="hs-identifier hs-var">unified_var</span></a></span><span>
</span><span id="line-3284"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unif_lvl :: IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332347"><span class="hs-identifier hs-var">unif_lvl_var</span></a></span><span>
</span><span id="line-3285"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_count :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332350"><span class="hs-identifier hs-var">step_count</span></a></span><span>
</span><span id="line-3286"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332349"><span class="hs-identifier hs-var">inert_var</span></a></span><span>
</span><span id="line-3287"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_worklist :: IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332348"><span class="hs-identifier hs-var">wl_var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3288"></span><span>
</span><span id="line-3289"></span><span>             </span><span class="hs-comment">-- Run the computation</span><span>
</span><span id="line-3290"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332345"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332345"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcS a -&gt; TcSEnv -&gt; TcM a
</span><a href="GHC.Tc.Solver.Monad.html#unTcS"><span class="hs-identifier hs-var">unTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcS a
</span><a href="#local-6989586621681332353"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332346"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-3291"></span><span>
</span><span id="line-3292"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332344"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332344"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332350"><span class="hs-identifier hs-var">step_count</span></a></span><span>
</span><span id="line-3293"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332344"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3294"></span><span>         </span><span class="annot"><span class="annottext">TcM SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#csTraceTcM"><span class="hs-identifier hs-var">csTraceTcM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Constraint solver steps =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332344"><span class="hs-identifier hs-var">count</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3295"></span><span>
</span><span id="line-3296"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332355"><span class="hs-identifier hs-var">restore_cycles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3297"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332342"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332342"><span class="hs-identifier hs-var">inert_set</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332349"><span class="hs-identifier hs-var">inert_var</span></a></span><span>
</span><span id="line-3298"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-var">restoreTyVarCycles</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332342"><span class="hs-identifier hs-var">inert_set</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-cpp">

#if defined(DEBUG)
</span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">TcM.getTcEvBindsMap</span><span> </span><span class="hs-identifier">ev_binds_var</span><span>
</span><span id="line-3302"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-identifier">ev_binds</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-3305"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332345"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3306"></span><span>
</span><span id="line-3307"></span><span class="hs-comment">----------------------------</span><span class="hs-cpp">
#if defined(DEBUG)
</span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">EvBindMap</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3310"></span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-identifier">ev_binds_map</span><span>
</span><span id="line-3311"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">cycles</span><span>
</span><span id="line-3312"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3313"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">coercion_cycles</span><span>
</span><span id="line-3314"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TcM.traceTc</span><span> </span><span class="hs-string">&quot;Cycle in evidence binds&quot;</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cycles</span><span>
</span><span id="line-3315"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>
</span><span id="line-3316"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;Cycle in coercion bindings&quot;</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">coercion_cycles</span><span>
</span><span id="line-3317"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3318"></span><span>    </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">evBindMapBinds</span><span> </span><span class="hs-identifier">ev_binds_map</span><span>
</span><span id="line-3319"></span><span>
</span><span id="line-3320"></span><span>    </span><span class="hs-identifier">cycles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier">EvBind</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-3321"></span><span>    </span><span class="hs-identifier">cycles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CyclicSCC</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">stronglyConnCompFromEdgedVerticesUniq</span><span> </span><span class="hs-identifier">edges</span><span class="hs-special">]</span><span>
</span><span id="line-3322"></span><span>
</span><span id="line-3323"></span><span>    </span><span class="hs-identifier">coercion_cycles</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">cycles</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">is_co_bind</span><span> </span><span class="hs-identifier">c</span><span class="hs-special">]</span><span>
</span><span id="line-3324"></span><span>    </span><span class="hs-identifier">is_co_bind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">EvBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isEqPrimPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span>
</span><span id="line-3325"></span><span>
</span><span id="line-3326"></span><span>    </span><span class="hs-identifier">edges</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">Node</span><span> </span><span class="hs-identifier">EvVar</span><span> </span><span class="hs-identifier">EvBind</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3327"></span><span>    </span><span class="hs-identifier">edges</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">DigraphNode</span><span> </span><span class="hs-identifier">bind</span><span> </span><span class="hs-identifier">bndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nonDetEltsUniqSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">evVarsOfTerm</span><span> </span><span class="hs-identifier">rhs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3328"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">bind</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">EvBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bndr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eb_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rhs</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">bagToList</span><span> </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3329"></span><span>            </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here as</span><span>
</span><span id="line-3330"></span><span>            </span><span class="hs-comment">-- stronglyConnCompFromEdgedVertices is still deterministic even</span><span>
</span><span id="line-3331"></span><span>            </span><span class="hs-comment">-- if the edges are in nondeterministic order as explained in</span><span>
</span><span id="line-3332"></span><span>            </span><span class="hs-comment">-- Note [Deterministic SCC] in GHC.Data.Graph.Directed.</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-3335"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-3336"></span><span id="local-6989586621681334206"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindsTcS"><span class="hs-identifier hs-type">setEvBindsTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334206"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334206"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3337"></span><span id="setEvBindsTcS"><span class="annot"><span class="annottext">setEvBindsTcS :: forall a. EvBindsVar -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#setEvBindsTcS"><span class="hs-identifier hs-var hs-var">setEvBindsTcS</span></a></span></span><span> </span><span id="local-6989586621681332340"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332340"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621681332339"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332339"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3338"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332338"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332338"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332339"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332338"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_ev_binds :: EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332340"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3339"></span><span>
</span><span id="line-3340"></span><span id="local-6989586621681334204"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestImplicTcS"><span class="hs-identifier hs-type">nestImplicTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-3341"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334204"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-3342"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334204"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3343"></span><span id="nestImplicTcS"><span class="annot"><span class="annottext">nestImplicTcS :: forall a. EvBindsVar -&gt; TcLevel -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#nestImplicTcS"><span class="hs-identifier hs-var hs-var">nestImplicTcS</span></a></span></span><span> </span><span id="local-6989586621681332330"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332330"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621681332329"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332329"><span class="hs-identifier hs-var">inner_tclvl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621681332328"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332328"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3344"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_unified :: TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332327"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332327"><span class="hs-identifier hs-var">unified_var</span></a></span></span><span>
</span><span id="line-3345"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332326"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332326"><span class="hs-identifier hs-var">old_inert_var</span></a></span></span><span>
</span><span id="line-3346"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_count :: TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332325"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332325"><span class="hs-identifier hs-var">count</span></a></span></span><span>
</span><span id="line-3347"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unif_lvl :: TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332324"><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332324"><span class="hs-identifier hs-var">unif_lvl</span></a></span></span><span>
</span><span id="line-3348"></span><span>                   </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3349"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332323"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332323"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332326"><span class="hs-identifier hs-var">old_inert_var</span></a></span><span>
</span><span id="line-3350"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332322"><span class="annot"><span class="annottext">nest_inert :: InertSet
</span><a href="#local-6989586621681332322"><span class="hs-identifier hs-var hs-var">nest_inert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332323"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cycle_breakers :: CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CycleBreakerVarStack -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#pushCycleBreakerVarStack"><span class="hs-identifier hs-var">pushCycleBreakerVarStack</span></a></span><span>
</span><span id="line-3351"></span><span>                                                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332323"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3352"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332323"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3353"></span><span>                                                   </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: Bool
</span><a href="GHC.Tc.Solver.Monad.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3354"></span><span>                 </span><span class="hs-comment">-- All other InertSet fields are inherited</span><span>
</span><span id="line-3355"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332321"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332321"><span class="hs-identifier hs-var">new_inert_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332322"><span class="hs-identifier hs-var">nest_inert</span></a></span><span>
</span><span id="line-3356"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332320"><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332320"><span class="hs-identifier hs-var">new_wl_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a></span><span>
</span><span id="line-3357"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332319"><span class="annot"><span class="annottext">nest_env :: TcSEnv
</span><a href="#local-6989586621681332319"><span class="hs-identifier hs-var hs-var">nest_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_count :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_count"><span class="hs-identifier hs-var">tcs_count</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332325"><span class="hs-identifier hs-var">count</span></a></span><span>     </span><span class="hs-comment">-- Inherited</span><span>
</span><span id="line-3358"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unif_lvl :: IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332324"><span class="hs-identifier hs-var">unif_lvl</span></a></span><span>  </span><span class="hs-comment">-- Inherited</span><span>
</span><span id="line-3359"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_ev_binds :: EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332330"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3360"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_unified :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332327"><span class="hs-identifier hs-var">unified_var</span></a></span><span>
</span><span id="line-3361"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332321"><span class="hs-identifier hs-var">new_inert_var</span></a></span><span>
</span><span id="line-3362"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_worklist :: IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332320"><span class="hs-identifier hs-var">new_wl_var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3363"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332318"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332318"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcLevel -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier hs-var">TcM.setTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332329"><span class="hs-identifier hs-var">inner_tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3364"></span><span>                </span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332328"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332319"><span class="hs-identifier hs-var">nest_env</span></a></span><span>
</span><span id="line-3365"></span><span>
</span><span id="line-3366"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332316"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332316"><span class="hs-identifier hs-var">out_inert_set</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332321"><span class="hs-identifier hs-var">new_inert_var</span></a></span><span>
</span><span id="line-3367"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-var">restoreTyVarCycles</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332316"><span class="hs-identifier hs-var">out_inert_set</span></a></span><span class="hs-cpp">

#if defined(DEBUG)
</span><span>       </span><span class="hs-comment">-- Perform a check that the thing_inside did not cause cycles</span><span>
</span><span id="line-3371"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ev_binds</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">TcM.getTcEvBindsMap</span><span> </span><span class="hs-identifier">ref</span><span>
</span><span id="line-3372"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">checkForCyclicBinds</span><span> </span><span class="hs-identifier">ev_binds</span><span class="hs-cpp">
#endif
</span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332318"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3375"></span><span>
</span><span id="line-3376"></span><span id="local-6989586621681334201"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#nestTcS"><span class="hs-identifier hs-type">nestTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334201"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334201"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3377"></span><span class="hs-comment">-- Use the current untouchables, augmenting the current</span><span>
</span><span id="line-3378"></span><span class="hs-comment">-- evidence bindings, and solved dictionaries</span><span>
</span><span id="line-3379"></span><span class="hs-comment">-- But have no effect on the InertCans, or on the inert_famapp_cache</span><span>
</span><span id="line-3380"></span><span class="hs-comment">-- (we want to inherit the latter from processing the Givens)</span><span>
</span><span id="line-3381"></span><span id="nestTcS"><span class="annot"><span class="annottext">nestTcS :: forall a. TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#nestTcS"><span class="hs-identifier hs-var hs-var">nestTcS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621681332308"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332308"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3382"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332307"><span class="annot"><span class="annottext">env :: TcSEnv
</span><a href="#local-6989586621681332307"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcSEnv"><span class="hs-identifier hs-type">TcSEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332306"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332306"><span class="hs-identifier hs-var">inerts_var</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3383"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332305"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332305"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332306"><span class="hs-identifier hs-var">inerts_var</span></a></span><span>
</span><span id="line-3384"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332304"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332304"><span class="hs-identifier hs-var">new_inert_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332305"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-3385"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332303"><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332303"><span class="hs-identifier hs-var">new_wl_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="GHC.Tc.Solver.Monad.html#emptyWorkList"><span class="hs-identifier hs-var">emptyWorkList</span></a></span><span>
</span><span id="line-3386"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332302"><span class="annot"><span class="annottext">nest_env :: TcSEnv
</span><a href="#local-6989586621681332302"><span class="hs-identifier hs-var hs-var">nest_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332307"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_inerts :: IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332304"><span class="hs-identifier hs-var">new_inert_var</span></a></span><span>
</span><span id="line-3387"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcs_worklist :: IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332303"><span class="hs-identifier hs-var">new_wl_var</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3388"></span><span>
</span><span id="line-3389"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332301"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332301"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332308"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332302"><span class="hs-identifier hs-var">nest_env</span></a></span><span>
</span><span id="line-3390"></span><span>
</span><span id="line-3391"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332300"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332300"><span class="hs-identifier hs-var">new_inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332304"><span class="hs-identifier hs-var">new_inert_var</span></a></span><span>
</span><span id="line-3392"></span><span>
</span><span id="line-3393"></span><span>       </span><span class="hs-comment">-- we want to propagate the safe haskell failures</span><span>
</span><span id="line-3394"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332299"><span class="annot"><span class="annottext">old_ic :: InertCans
</span><a href="#local-6989586621681332299"><span class="hs-identifier hs-var hs-var">old_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332305"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-3395"></span><span>             </span><span id="local-6989586621681332298"><span class="annot"><span class="annottext">new_ic :: InertCans
</span><a href="#local-6989586621681332298"><span class="hs-identifier hs-var hs-var">new_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332300"><span class="hs-identifier hs-var">new_inerts</span></a></span><span>
</span><span id="line-3396"></span><span>             </span><span id="local-6989586621681332297"><span class="annot"><span class="annottext">nxt_ic :: InertCans
</span><a href="#local-6989586621681332297"><span class="hs-identifier hs-var hs-var">nxt_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332299"><span class="hs-identifier hs-var">old_ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; DictMap Ct
</span><a href="GHC.Tc.Solver.Monad.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332298"><span class="hs-identifier hs-var">new_ic</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3397"></span><span>
</span><span id="line-3398"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332306"><span class="hs-identifier hs-var">inerts_var</span></a></span><span>  </span><span class="hs-comment">-- See Note [Propagate the solved dictionaries]</span><span>
</span><span id="line-3399"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332305"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; DictMap CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332300"><span class="hs-identifier hs-var">new_inerts</span></a></span><span>
</span><span id="line-3400"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertCans
</span><a href="GHC.Tc.Solver.Monad.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621681332297"><span class="hs-identifier hs-var">nxt_ic</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3401"></span><span>
</span><span id="line-3402"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332301"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3403"></span><span>
</span><span id="line-3404"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier hs-type">emitImplicationTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3405"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Skolems</span><span>
</span><span id="line-3406"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- Givens</span><span>
</span><span id="line-3407"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>              </span><span class="hs-comment">-- Wanteds</span><span>
</span><span id="line-3408"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-type">TcEvBinds</span></a></span><span>
</span><span id="line-3409"></span><span class="hs-comment">-- Add an implication to the TcS monad work-list</span><span>
</span><span id="line-3410"></span><span id="emitImplicationTcS"><span class="annot"><span class="annottext">emitImplicationTcS :: TcLevel
-&gt; SkolemInfo -&gt; [TcTyVar] -&gt; [TcTyVar] -&gt; Bag Ct -&gt; TcS TcEvBinds
</span><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier hs-var hs-var">emitImplicationTcS</span></a></span></span><span> </span><span id="local-6989586621681332295"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332295"><span class="hs-identifier hs-var">new_tclvl</span></a></span></span><span> </span><span id="local-6989586621681332294"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681332294"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621681332293"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332293"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span> </span><span id="local-6989586621681332292"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332292"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span id="local-6989586621681332291"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332291"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span>
</span><span id="line-3411"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332290"><span class="annot"><span class="annottext">wc :: WantedConstraints
</span><a href="#local-6989586621681332290"><span class="hs-identifier hs-var hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wc_simple :: Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332291"><span class="hs-identifier hs-var">wanteds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3412"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332287"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332287"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3413"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332286"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332286"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-3414"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332285"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332285"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Implication
</span><a href="GHC.Tc.Utils.TcMType.html#newImplication"><span class="hs-identifier hs-var">TcM.newImplication</span></a></span><span>
</span><span id="line-3415"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332285"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ic_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.Constraint.html#ic_tclvl"><span class="hs-identifier hs-var">ic_tclvl</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332295"><span class="hs-identifier hs-var">new_tclvl</span></a></span><span>
</span><span id="line-3416"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_skols :: [TcTyVar]
</span><a href="GHC.Tc.Types.Constraint.html#ic_skols"><span class="hs-identifier hs-var">ic_skols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332293"><span class="hs-identifier hs-var">skol_tvs</span></a></span><span>
</span><span id="line-3417"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_given :: [TcTyVar]
</span><a href="GHC.Tc.Types.Constraint.html#ic_given"><span class="hs-identifier hs-var">ic_given</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332292"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-3418"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_wanted :: WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681332290"><span class="hs-identifier hs-var">wc</span></a></span><span>
</span><span id="line-3419"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_binds :: EvBindsVar
</span><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332286"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-3420"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_info :: SkolemInfo
</span><a href="GHC.Tc.Types.Constraint.html#ic_info"><span class="hs-identifier hs-var">ic_info</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681332294"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3421"></span><span>
</span><span id="line-3422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Implication -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-var">emitImplication</span></a></span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332287"><span class="hs-identifier hs-var">imp</span></a></span><span>
</span><span id="line-3423"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#TcEvBinds"><span class="hs-identifier hs-var">TcEvBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Implication -&gt; EvBindsVar
</span><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332287"><span class="hs-identifier hs-var">imp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3424"></span><span>
</span><span id="line-3425"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitTvImplicationTcS"><span class="hs-identifier hs-type">emitTvImplicationTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-3426"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Skolems</span><span>
</span><span id="line-3427"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>              </span><span class="hs-comment">-- Wanteds</span><span>
</span><span id="line-3428"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3429"></span><span class="hs-comment">-- Just like emitImplicationTcS but no givens and no bindings</span><span>
</span><span id="line-3430"></span><span id="emitTvImplicationTcS"><span class="annot"><span class="annottext">emitTvImplicationTcS :: TcLevel -&gt; SkolemInfo -&gt; [TcTyVar] -&gt; Bag Ct -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitTvImplicationTcS"><span class="hs-identifier hs-var hs-var">emitTvImplicationTcS</span></a></span></span><span> </span><span id="local-6989586621681332275"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332275"><span class="hs-identifier hs-var">new_tclvl</span></a></span></span><span> </span><span id="local-6989586621681332274"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681332274"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621681332273"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332273"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span> </span><span id="local-6989586621681332272"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332272"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span>
</span><span id="line-3431"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332271"><span class="annot"><span class="annottext">wc :: WantedConstraints
</span><a href="#local-6989586621681332271"><span class="hs-identifier hs-var hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wc_simple :: Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#wc_simple"><span class="hs-identifier hs-var">wc_simple</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332272"><span class="hs-identifier hs-var">wanteds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3432"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332270"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332270"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3433"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332269"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332269"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var">TcM.newNoTcEvBinds</span></a></span><span>
</span><span id="line-3434"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332268"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332268"><span class="hs-identifier hs-var">imp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Implication
</span><a href="GHC.Tc.Utils.TcMType.html#newImplication"><span class="hs-identifier hs-var">TcM.newImplication</span></a></span><span>
</span><span id="line-3435"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332268"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ic_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.Constraint.html#ic_tclvl"><span class="hs-identifier hs-var">ic_tclvl</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332275"><span class="hs-identifier hs-var">new_tclvl</span></a></span><span>
</span><span id="line-3436"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_skols :: [TcTyVar]
</span><a href="GHC.Tc.Types.Constraint.html#ic_skols"><span class="hs-identifier hs-var">ic_skols</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332273"><span class="hs-identifier hs-var">skol_tvs</span></a></span><span>
</span><span id="line-3437"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_wanted :: WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#ic_wanted"><span class="hs-identifier hs-var">ic_wanted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681332271"><span class="hs-identifier hs-var">wc</span></a></span><span>
</span><span id="line-3438"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_binds :: EvBindsVar
</span><a href="GHC.Tc.Types.Constraint.html#ic_binds"><span class="hs-identifier hs-var">ic_binds</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332269"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-3439"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_info :: SkolemInfo
</span><a href="GHC.Tc.Types.Constraint.html#ic_info"><span class="hs-identifier hs-var">ic_info</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681332274"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3440"></span><span>
</span><span id="line-3441"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Implication -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-var">emitImplication</span></a></span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332270"><span class="hs-identifier hs-var">imp</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3442"></span><span>
</span><span id="line-3443"></span><span>
</span><span id="line-3444"></span><span class="hs-comment">{- Note [Propagate the solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's really quite important that nestTcS does not discard the solved
dictionaries from the thing_inside.
Consider
   Eq [a]
   forall b. empty =&gt;  Eq [a]
We solve the simple (Eq [a]), under nestTcS, and then turn our attention to
the implications.  It's definitely fine to use the solved dictionaries on
the inner implications, and it can make a significant performance difference
if you do so.
-}</span><span>
</span><span id="line-3456"></span><span>
</span><span id="line-3457"></span><span class="hs-comment">-- Getters and setters of GHC.Tc.Utils.Env fields</span><span>
</span><span id="line-3458"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3459"></span><span>
</span><span id="line-3460"></span><span class="hs-comment">-- Getter of inerts and worklist</span><span>
</span><span id="line-3461"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcSInertsRef"><span class="hs-identifier hs-type">getTcSInertsRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3462"></span><span id="getTcSInertsRef"><span class="annot"><span class="annottext">getTcSInertsRef :: TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInertsRef"><span class="hs-identifier hs-var hs-var">getTcSInertsRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef InertSet
</span><a href="GHC.Tc.Solver.Monad.html#tcs_inerts"><span class="hs-identifier hs-var">tcs_inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3463"></span><span>
</span><span id="line-3464"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-type">getTcSWorkListRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3465"></span><span id="getTcSWorkListRef"><span class="annot"><span class="annottext">getTcSWorkListRef :: TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var hs-var">getTcSWorkListRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef WorkList
</span><a href="GHC.Tc.Solver.Monad.html#tcs_worklist"><span class="hs-identifier hs-var">tcs_worklist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3466"></span><span>
</span><span id="line-3467"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-type">getTcSInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span>
</span><span id="line-3468"></span><span id="getTcSInerts"><span class="annot"><span class="annottext">getTcSInerts :: TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var hs-var">getTcSInerts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span>
</span><span id="line-3469"></span><span>
</span><span id="line-3470"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setTcSInerts"><span class="hs-identifier hs-type">setTcSInerts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3471"></span><span id="setTcSInerts"><span class="annot"><span class="annottext">setTcSInerts :: InertSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setTcSInerts"><span class="hs-identifier hs-var hs-var">setTcSInerts</span></a></span></span><span> </span><span id="local-6989586621681332267"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332267"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332266"><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332266"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef InertSet)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInertsRef"><span class="hs-identifier hs-var">getTcSInertsRef</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcRef a -&gt; a -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef InertSet
</span><a href="#local-6989586621681332266"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681332267"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3472"></span><span>
</span><span id="line-3473"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getWorkListImplics"><span class="hs-identifier hs-type">getWorkListImplics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3474"></span><span id="getWorkListImplics"><span class="annot"><span class="annottext">getWorkListImplics :: TcS (Bag Implication)
</span><a href="GHC.Tc.Solver.Monad.html#getWorkListImplics"><span class="hs-identifier hs-var hs-var">getWorkListImplics</span></a></span></span><span>
</span><span id="line-3475"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332265"><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332265"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-3476"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332264"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681332264"><span class="hs-identifier hs-var">wl_curr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332265"><span class="hs-identifier hs-var">wl_var</span></a></span><span>
</span><span id="line-3477"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.Monad.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621681332264"><span class="hs-identifier hs-var">wl_curr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3478"></span><span>
</span><span id="line-3479"></span><span id="local-6989586621681334196"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier hs-type">pushLevelNoWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334196"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681334196"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3480"></span><span class="hs-comment">-- Push the level and run thing_inside</span><span>
</span><span id="line-3481"></span><span class="hs-comment">-- However, thing_inside should not generate any work items</span><span class="hs-cpp">
#if defined(DEBUG)
</span><span class="hs-identifier">pushLevelNoWorkList</span><span> </span><span class="hs-identifier">err_doc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TcS</span><span> </span><span class="hs-identifier">thing_inside</span><span class="hs-special">)</span><span>
</span><span id="line-3484"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TcS</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TcM.pushTcLevelM</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-3485"></span><span>                 </span><span class="hs-identifier">thing_inside</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">env</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcs_worklist</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">wl_panic</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3486"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3487"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3488"></span><span>    </span><span class="hs-identifier">wl_panic</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;GHC.Tc.Solver.Monad.buildImplication&quot;</span><span> </span><span class="hs-identifier">err_doc</span><span>
</span><span id="line-3489"></span><span>                         </span><span class="hs-comment">-- This panic checks that the thing-inside</span><span>
</span><span id="line-3490"></span><span>                         </span><span class="hs-comment">-- does not emit any work-list constraints</span><span class="hs-cpp">
#else
</span><span id="pushLevelNoWorkList"><span class="annot"><span class="annottext">pushLevelNoWorkList :: forall a. SDoc -&gt; TcS a -&gt; TcS (TcLevel, a)
</span><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier hs-var hs-var">pushLevelNoWorkList</span></a></span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621681332263"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332263"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3493"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681332262"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332262"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcM (TcLevel, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-var">TcM.pushTcLevelM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332263"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332262"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Don't check</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-3496"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-type">updWorkListTcS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3497"></span><span id="updWorkListTcS"><span class="annot"><span class="annottext">updWorkListTcS :: (WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var hs-var">updWorkListTcS</span></a></span></span><span> </span><span id="local-6989586621681332260"><span class="annot"><span class="annottext">WorkList -&gt; WorkList
</span><a href="#local-6989586621681332260"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-3498"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332259"><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332259"><span class="hs-identifier hs-var">wl_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (IORef WorkList)
</span><a href="GHC.Tc.Solver.Monad.html#getTcSWorkListRef"><span class="hs-identifier hs-var">getTcSWorkListRef</span></a></span><span>
</span><span id="line-3499"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcRef a -&gt; (a -&gt; a) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WorkList
</span><a href="#local-6989586621681332259"><span class="hs-identifier hs-var">wl_var</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList -&gt; WorkList
</span><a href="#local-6989586621681332260"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3500"></span><span>
</span><span id="line-3501"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-type">emitWorkNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3502"></span><span id="emitWorkNC"><span class="annot"><span class="annottext">emitWorkNC :: [CtEvidence] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-var hs-var">emitWorkNC</span></a></span></span><span> </span><span id="local-6989586621681332258"><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681332258"><span class="hs-identifier hs-var">evs</span></a></span></span><span>
</span><span id="line-3503"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681332258"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-3504"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3505"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3506"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681332258"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3507"></span><span>
</span><span id="line-3508"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-type">emitWork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3509"></span><span id="emitWork"><span class="annot"><span class="annottext">emitWork :: [Ct] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var hs-var">emitWork</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- avoid printing, among other work</span><span>
</span><span id="line-3510"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span id="local-6989586621681332257"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332257"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-3511"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Emitting fresh work&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332257"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3512"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListCts"><span class="hs-identifier hs-var">extendWorkListCts</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621681332257"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3513"></span><span>
</span><span id="line-3514"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-type">emitImplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3515"></span><span id="emitImplication"><span class="annot"><span class="annottext">emitImplication :: Implication -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitImplication"><span class="hs-identifier hs-var hs-var">emitImplication</span></a></span></span><span> </span><span id="local-6989586621681332256"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332256"><span class="hs-identifier hs-var">implic</span></a></span></span><span>
</span><span id="line-3516"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Implication -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListImplic"><span class="hs-identifier hs-var">extendWorkListImplic</span></a></span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681332256"><span class="hs-identifier hs-var">implic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3517"></span><span>
</span><span id="line-3518"></span><span id="local-6989586621681334192"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcRef"><span class="hs-identifier hs-type">newTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681334192"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334192"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3519"></span><span id="newTcRef"><span class="annot"><span class="annottext">newTcRef :: forall a. a -&gt; TcS (TcRef a)
</span><a href="GHC.Tc.Solver.Monad.html#newTcRef"><span class="hs-identifier hs-var hs-var">newTcRef</span></a></span></span><span> </span><span id="local-6989586621681332255"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332255"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332255"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3520"></span><span>
</span><span id="line-3521"></span><span id="local-6989586621681334478"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334478"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334478"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3522"></span><span id="readTcRef"><span class="annot"><span class="annottext">readTcRef :: forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var hs-var">readTcRef</span></a></span></span><span> </span><span id="local-6989586621681332254"><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681332254"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681332254"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3523"></span><span>
</span><span id="line-3524"></span><span id="local-6989586621681334475"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681334475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-3525"></span><span id="writeTcRef"><span class="annot"><span class="annottext">writeTcRef :: forall a. TcRef a -&gt; a -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#writeTcRef"><span class="hs-identifier hs-var hs-var">writeTcRef</span></a></span></span><span> </span><span id="local-6989586621681332253"><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681332253"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621681332252"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332252"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681332253"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332252"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3526"></span><span>
</span><span id="line-3527"></span><span id="local-6989586621681334193"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334193"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681334193"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-glyph">-&gt;</span><span class="annot"><a href="#local-6989586621681334193"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-3528"></span><span id="updTcRef"><span class="annot"><span class="annottext">updTcRef :: forall a. TcRef a -&gt; (a -&gt; a) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updTcRef"><span class="hs-identifier hs-var hs-var">updTcRef</span></a></span></span><span> </span><span id="local-6989586621681332251"><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681332251"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621681332250"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621681332250"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">TcM.updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681332251"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621681332250"><span class="hs-identifier hs-var">upd_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3529"></span><span>
</span><span id="line-3530"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-type">getTcEvBindsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-3531"></span><span id="getTcEvBindsVar"><span class="annot"><span class="annottext">getTcEvBindsVar :: TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var hs-var">getTcEvBindsVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#tcs_ev_binds"><span class="hs-identifier hs-var">tcs_ev_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3532"></span><span>
</span><span id="line-3533"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-3534"></span><span id="getTcLevel"><span class="annot"><span class="annottext">getTcLevel :: TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var hs-var">getTcLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">TcM.getTcLevel</span></a></span><span>
</span><span id="line-3535"></span><span>
</span><span id="line-3536"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-type">getTcEvTyCoVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>
</span><span id="line-3537"></span><span id="getTcEvTyCoVars"><span class="annot"><span class="annottext">getTcEvTyCoVars :: EvBindsVar -&gt; TcS VarSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-var hs-var">getTcEvTyCoVars</span></a></span></span><span> </span><span id="local-6989586621681332247"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332247"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span>
</span><span id="line-3538"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM VarSet
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-var">TcM.getTcEvTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332247"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-3539"></span><span>
</span><span id="line-3540"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-type">getTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span>
</span><span id="line-3541"></span><span id="getTcEvBindsMap"><span class="annot"><span class="annottext">getTcEvBindsMap :: EvBindsVar -&gt; TcS EvBindMap
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var hs-var">getTcEvBindsMap</span></a></span></span><span> </span><span id="local-6989586621681332245"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332245"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span>
</span><span id="line-3542"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindMap
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var">TcM.getTcEvBindsMap</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332245"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-3543"></span><span>
</span><span id="line-3544"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-type">setTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3545"></span><span id="setTcEvBindsMap"><span class="annot"><span class="annottext">setTcEvBindsMap :: EvBindsVar -&gt; EvBindMap -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var hs-var">setTcEvBindsMap</span></a></span></span><span> </span><span id="local-6989586621681332244"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332244"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span id="local-6989586621681332243"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681332243"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-3546"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; EvBindMap -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var">TcM.setTcEvBindsMap</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332244"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681332243"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-3547"></span><span>
</span><span id="line-3548"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#unifyTyVar"><span class="hs-identifier hs-type">unifyTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3549"></span><span class="hs-comment">-- Unify a meta-tyvar with a type</span><span>
</span><span id="line-3550"></span><span class="hs-comment">-- We keep track of how many unifications have happened in tcs_unified,</span><span>
</span><span id="line-3551"></span><span class="hs-comment">--</span><span>
</span><span id="line-3552"></span><span class="hs-comment">-- We should never unify the same variable twice!</span><span>
</span><span id="line-3553"></span><span id="unifyTyVar"><span class="annot"><span class="annottext">unifyTyVar :: TcTyVar -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#unifyTyVar"><span class="hs-identifier hs-var hs-var">unifyTyVar</span></a></span></span><span> </span><span id="local-6989586621681332241"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332241"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681332240"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332240"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-3554"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isMetaTyVar</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tv</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3555"></span><span>    </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332239"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332239"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3556"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unifyTyVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332241"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332240"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3557"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; TcM ()
</span><a href="GHC.Tc.Utils.TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">TcM.writeMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332241"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332240"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-3558"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">TcM.updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332239"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3559"></span><span>
</span><span id="line-3560"></span><span id="local-6989586621681334184"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#reportUnifications"><span class="hs-identifier hs-type">reportUnifications</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681334184"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681334184"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3561"></span><span id="reportUnifications"><span class="annot"><span class="annottext">reportUnifications :: forall a. TcS a -&gt; TcS (Int, a)
</span><a href="GHC.Tc.Solver.Monad.html#reportUnifications"><span class="hs-identifier hs-var hs-var">reportUnifications</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span id="local-6989586621681332230"><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332230"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3562"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681332229"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332229"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3563"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332228"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332228"><span class="hs-identifier hs-var">inner_unified</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">TcM.newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-3564"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332227"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332227"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; TcM a
</span><a href="#local-6989586621681332230"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332229"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcs_unified :: IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332228"><span class="hs-identifier hs-var">inner_unified</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3565"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332226"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332226"><span class="hs-identifier hs-var">n_unifs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681332228"><span class="hs-identifier hs-var">inner_unified</span></a></span><span>
</span><span id="line-3566"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">TcM.updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef Int
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unified"><span class="hs-identifier hs-var">tcs_unified</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332229"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332226"><span class="hs-identifier hs-var">n_unifs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3567"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332226"><span class="hs-identifier hs-var">n_unifs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681332227"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3568"></span><span>
</span><span id="line-3569"></span><span class="hs-keyword">data</span><span> </span><span id="TouchabilityTestResult"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TouchabilityTestResult"><span class="hs-identifier hs-var">TouchabilityTestResult</span></a></span></span><span>
</span><span id="line-3570"></span><span>  </span><span class="hs-comment">-- See Note [Solve by unification] in GHC.Tc.Solver.Interact</span><span>
</span><span id="line-3571"></span><span>  </span><span class="hs-comment">-- which points out that having TouchableSameLevel is just an optimisation;</span><span>
</span><span id="line-3572"></span><span>  </span><span class="hs-comment">-- we could manage with TouchableOuterLevel alone (suitably renamed)</span><span>
</span><span id="line-3573"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TouchableSameLevel"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TouchableSameLevel"><span class="hs-identifier hs-var">TouchableSameLevel</span></a></span></span><span>
</span><span id="line-3574"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TouchableOuterLevel"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TouchableOuterLevel"><span class="hs-identifier hs-var">TouchableOuterLevel</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Promote these</span><span>
</span><span id="line-3575"></span><span>                        </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>     </span><span class="hs-comment">-- ..to this level</span><span>
</span><span id="line-3576"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Untouchable"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Untouchable"><span class="hs-identifier hs-var">Untouchable</span></a></span></span><span>
</span><span id="line-3577"></span><span>
</span><span id="line-3578"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TouchabilityTestResult"><span class="hs-identifier hs-type">TouchabilityTestResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3579"></span><span>  </span><span id="local-6989586621681332218"><span class="annot"><span class="annottext">ppr :: TouchabilityTestResult -&gt; SDoc
</span><a href="#local-6989586621681332218"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#TouchableSameLevel"><span class="hs-identifier hs-var">TouchableSameLevel</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TouchableSameLevel&quot;</span></span><span>
</span><span id="line-3580"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TouchableOuterLevel"><span class="hs-identifier hs-type">TouchableOuterLevel</span></a></span><span> </span><span id="local-6989586621681332217"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332217"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681332216"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332216"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TouchableOuterLevel&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332216"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332217"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3581"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#Untouchable"><span class="hs-identifier hs-var">Untouchable</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Untouchable&quot;</span></span><span>
</span><span id="line-3582"></span><span>
</span><span id="line-3583"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#touchabilityTest"><span class="hs-identifier hs-type">touchabilityTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TouchabilityTestResult"><span class="hs-identifier hs-type">TouchabilityTestResult</span></a></span><span>
</span><span id="line-3584"></span><span class="hs-comment">-- This is the key test for untouchability:</span><span>
</span><span id="line-3585"></span><span class="hs-comment">-- See Note [Unification preconditions] in GHC.Tc.Utils.Unify</span><span>
</span><span id="line-3586"></span><span class="hs-comment">-- and Note [Solve by unification] in GHC.Tc.Solver.Interact</span><span>
</span><span id="line-3587"></span><span id="touchabilityTest"><span class="annot"><span class="annottext">touchabilityTest :: CtFlavour -&gt; TcTyVar -&gt; Type -&gt; TcS TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#touchabilityTest"><span class="hs-identifier hs-var hs-var">touchabilityTest</span></a></span></span><span> </span><span id="local-6989586621681332214"><span class="annot"><span class="annottext">CtFlavour
</span><a href="#local-6989586621681332214"><span class="hs-identifier hs-var">flav</span></a></span></span><span> </span><span id="local-6989586621681332213"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332213"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span id="local-6989586621681332212"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332212"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-3588"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="#local-6989586621681332214"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span>  </span><span class="hs-comment">-- See Note [Do not unify Givens]</span><span>
</span><span id="line-3589"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_tclvl :: TcTyVarDetails -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#mtv_tclvl"><span class="hs-identifier hs-var">mtv_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332209"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332209"><span class="hs-identifier hs-var">tv_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mtv_info :: TcTyVarDetails -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332208"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621681332208"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332213"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-3590"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.Unify.html#canSolveByUnification"><span class="hs-identifier hs-var">canSolveByUnification</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621681332208"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332212"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-3591"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332207"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332207"><span class="hs-identifier hs-var">ambient_lvl</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-3592"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332206"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332206"><span class="hs-identifier hs-var">given_eq_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getInnermostGivenEqLevel"><span class="hs-identifier hs-var">getInnermostGivenEqLevel</span></a></span><span>
</span><span id="line-3593"></span><span>
</span><span id="line-3594"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332209"><span class="hs-identifier hs-var">tv_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#sameDepthAs"><span class="hs-operator hs-var">`sameDepthAs`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332207"><span class="hs-identifier hs-var">ambient_lvl</span></a></span><span>
</span><span id="line-3595"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#TouchableSameLevel"><span class="hs-identifier hs-var">TouchableSameLevel</span></a></span><span>
</span><span id="line-3596"></span><span>
</span><span id="line-3597"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332209"><span class="hs-identifier hs-var">tv_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#deeperThanOrSame"><span class="hs-operator hs-var">`deeperThanOrSame`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332206"><span class="hs-identifier hs-var">given_eq_lvl</span></a></span><span>   </span><span class="hs-comment">-- No intervening given equalities</span><span>
</span><span id="line-3598"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="#local-6989586621681332203"><span class="hs-identifier hs-var">does_not_escape</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332209"><span class="hs-identifier hs-var">tv_lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332202"><span class="hs-identifier hs-var">free_skols</span></a></span><span>  </span><span class="hs-comment">-- No skolem escapes</span><span>
</span><span id="line-3599"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; TcLevel -&gt; TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#TouchableOuterLevel"><span class="hs-identifier hs-var">TouchableOuterLevel</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332201"><span class="hs-identifier hs-var">free_metas</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332209"><span class="hs-identifier hs-var">tv_lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3600"></span><span>
</span><span id="line-3601"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3602"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#Untouchable"><span class="hs-identifier hs-var">Untouchable</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3603"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3604"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#Untouchable"><span class="hs-identifier hs-var">Untouchable</span></a></span><span>
</span><span id="line-3605"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3606"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621681332201"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332201"><span class="hs-identifier hs-var">free_metas</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332202"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332202"><span class="hs-identifier hs-var">free_skols</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isPromotableMetaTyVar"><span class="hs-identifier hs-var">isPromotableMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3607"></span><span>                                </span><span class="annot"><span class="annottext">forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span>               </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3608"></span><span>                                </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332212"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-3609"></span><span>
</span><span id="line-3610"></span><span>     </span><span id="local-6989586621681332203"><span class="annot"><span class="annottext">does_not_escape :: TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="#local-6989586621681332203"><span class="hs-identifier hs-var hs-var">does_not_escape</span></a></span></span><span> </span><span id="local-6989586621681332197"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332197"><span class="hs-identifier hs-var">tv_lvl</span></a></span></span><span> </span><span id="local-6989586621681332196"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332196"><span class="hs-identifier hs-var">fv</span></a></span></span><span>
</span><span id="line-3611"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332196"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332197"><span class="hs-identifier hs-var">tv_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#deeperThanOrSame"><span class="hs-operator hs-var">`deeperThanOrSame`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332196"><span class="hs-identifier hs-var">fv</span></a></span><span>
</span><span id="line-3612"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3613"></span><span>       </span><span class="hs-comment">-- Coercion variables are not an escape risk</span><span>
</span><span id="line-3614"></span><span>       </span><span class="hs-comment">-- If an implication binds a coercion variable, it'll have equalities,</span><span>
</span><span id="line-3615"></span><span>       </span><span class="hs-comment">-- so the &quot;intervening given equalities&quot; test above will catch it</span><span>
</span><span id="line-3616"></span><span>       </span><span class="hs-comment">-- Coercion holes get filled with coercions, so again no problem.</span><span>
</span><span id="line-3617"></span><span>
</span><span id="line-3618"></span><span class="hs-comment">{- Note [Do not unify Givens]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this GADT match
   data T a where
      T1 :: T Int
      ...

   f x = case x of
           T1 -&gt; True
           ...

So we get f :: T alpha[1] -&gt; beta[1]
          x :: T alpha[1]
and from the T1 branch we get the implication
   forall[2] (alpha[1] ~ Int) =&gt; beta[1] ~ Bool

Now, clearly we don't want to unify alpha:=Int!  Yet at the moment we
process [G] alpha[1] ~ Int, we don't have any given-equalities in the
inert set, and hence there are no given equalities to make alpha untouchable.

NB: if it were alpha[2] ~ Int, this argument wouldn't hold.  But that
never happens: invariant (GivenInv) in Note [TcLevel invariants]
in GHC.Tc.Utils.TcType.

Simple solution: never unify in Givens!
-}</span><span>
</span><span id="line-3644"></span><span>
</span><span id="line-3645"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getDefaultInfo"><span class="hs-identifier hs-type">getDefaultInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3646"></span><span id="getDefaultInfo"><span class="annot"><span class="annottext">getDefaultInfo :: TcS ([Type], (Bool, Bool))
</span><a href="GHC.Tc.Solver.Monad.html#getDefaultInfo"><span class="hs-identifier hs-var hs-var">getDefaultInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ([Type], (Bool, Bool))
</span><a href="GHC.Tc.Utils.Env.html#tcGetDefaultTys"><span class="hs-identifier hs-var">TcM.tcGetDefaultTys</span></a></span><span>
</span><span id="line-3647"></span><span>
</span><span id="line-3648"></span><span class="hs-comment">-- Just get some environments needed for instance looking up and matching</span><span>
</span><span id="line-3649"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3650"></span><span>
</span><span id="line-3651"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getInstEnvs"><span class="hs-identifier hs-type">getInstEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnvs"><span class="hs-identifier hs-type">InstEnvs</span></a></span><span>
</span><span id="line-3652"></span><span id="getInstEnvs"><span class="annot"><span class="annottext">getInstEnvs :: TcS InstEnvs
</span><a href="GHC.Tc.Solver.Monad.html#getInstEnvs"><span class="hs-identifier hs-var hs-var">getInstEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">TcM.tcGetInstEnvs</span></a></span><span>
</span><span id="line-3653"></span><span>
</span><span id="line-3654"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getFamInstEnvs"><span class="hs-identifier hs-type">getFamInstEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3655"></span><span id="getFamInstEnvs"><span class="annot"><span class="annottext">getFamInstEnvs :: TcS (FamInstEnv, FamInstEnv)
</span><a href="GHC.Tc.Solver.Monad.html#getFamInstEnvs"><span class="hs-identifier hs-var hs-var">getFamInstEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcM (FamInstEnv, FamInstEnv)
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">FamInst.tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-3656"></span><span>
</span><span id="line-3657"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-3658"></span><span id="getTopEnv"><span class="annot"><span class="annottext">getTopEnv :: TcS HscEnv
</span><a href="GHC.Tc.Solver.Monad.html#getTopEnv"><span class="hs-identifier hs-var hs-var">getTopEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">TcM.getTopEnv</span></a></span><span>
</span><span id="line-3659"></span><span>
</span><span id="line-3660"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-3661"></span><span id="getGblEnv"><span class="annot"><span class="annottext">getGblEnv :: TcS TcGblEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGblEnv"><span class="hs-identifier hs-var hs-var">getGblEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">TcM.getGblEnv</span></a></span><span>
</span><span id="line-3662"></span><span>
</span><span id="line-3663"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getLclEnv"><span class="hs-identifier hs-type">getLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span>
</span><span id="line-3664"></span><span id="getLclEnv"><span class="annot"><span class="annottext">getLclEnv :: TcS TcLclEnv
</span><a href="GHC.Tc.Solver.Monad.html#getLclEnv"><span class="hs-identifier hs-var hs-var">getLclEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">TcM.getLclEnv</span></a></span><span>
</span><span id="line-3665"></span><span>
</span><span id="line-3666"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupClass"><span class="hs-identifier hs-type">tcLookupClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>
</span><span id="line-3667"></span><span id="tcLookupClass"><span class="annot"><span class="annottext">tcLookupClass :: Name -&gt; TcS Class
</span><a href="GHC.Tc.Solver.Monad.html#tcLookupClass"><span class="hs-identifier hs-var hs-var">tcLookupClass</span></a></span></span><span> </span><span id="local-6989586621681332190"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681332190"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">TcM.tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681332190"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-3668"></span><span>
</span><span id="line-3669"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcLookupId"><span class="hs-identifier hs-type">tcLookupId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-3670"></span><span id="tcLookupId"><span class="annot"><span class="annottext">tcLookupId :: Name -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#tcLookupId"><span class="hs-identifier hs-var hs-var">tcLookupId</span></a></span></span><span> </span><span id="local-6989586621681332188"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681332188"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">TcM.tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681332188"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-3671"></span><span>
</span><span id="line-3672"></span><span class="hs-comment">-- Setting names as used (used in the deriving of Coercible evidence)</span><span>
</span><span id="line-3673"></span><span class="hs-comment">-- Too hackish to expose it to TcS? In that case somehow extract the used</span><span>
</span><span id="line-3674"></span><span class="hs-comment">-- constructors from the result of solveInteract</span><span>
</span><span id="line-3675"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addUsedGREs"><span class="hs-identifier hs-type">addUsedGREs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3676"></span><span id="addUsedGREs"><span class="annot"><span class="annottext">addUsedGREs :: [GlobalRdrElt] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addUsedGREs"><span class="hs-identifier hs-var hs-var">addUsedGREs</span></a></span></span><span> </span><span id="local-6989586621681332187"><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621681332187"><span class="hs-identifier hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span>  </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; TcM ()
</span><a href="GHC.Rename.Env.html#addUsedGREs"><span class="hs-identifier hs-var">TcM.addUsedGREs</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621681332187"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-3677"></span><span>
</span><span id="line-3678"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#addUsedGRE"><span class="hs-identifier hs-type">addUsedGRE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3679"></span><span id="addUsedGRE"><span class="annot"><span class="annottext">addUsedGRE :: Bool -&gt; GlobalRdrElt -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addUsedGRE"><span class="hs-identifier hs-var hs-var">addUsedGRE</span></a></span></span><span> </span><span id="local-6989586621681332185"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332185"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span></span><span> </span><span id="local-6989586621681332184"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681332184"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GlobalRdrElt -&gt; TcM ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var">TcM.addUsedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332185"><span class="hs-identifier hs-var">warn_if_deprec</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681332184"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-3680"></span><span>
</span><span id="line-3681"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#keepAlive"><span class="hs-identifier hs-type">keepAlive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3682"></span><span id="keepAlive"><span class="annot"><span class="annottext">keepAlive :: Name -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#keepAlive"><span class="hs-identifier hs-var hs-var">keepAlive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var">TcM.keepAlive</span></a></span><span>
</span><span id="line-3683"></span><span>
</span><span id="line-3684"></span><span class="hs-comment">-- Various smaller utilities [TODO, maybe will be absorbed in the instance matcher]</span><span>
</span><span id="line-3685"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3686"></span><span>
</span><span id="line-3687"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkWellStagedDFun"><span class="hs-identifier hs-type">checkWellStagedDFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#InstanceWhat"><span class="hs-identifier hs-type">InstanceWhat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3688"></span><span class="hs-comment">-- Check that we do not try to use an instance before it is available.  E.g.</span><span>
</span><span id="line-3689"></span><span class="hs-comment">--    instance Eq T where ...</span><span>
</span><span id="line-3690"></span><span class="hs-comment">--    f x = $( ... (\(p::T) -&gt; p == p)... )</span><span>
</span><span id="line-3691"></span><span class="hs-comment">-- Here we can't use the equality function from the instance in the splice</span><span>
</span><span id="line-3692"></span><span>
</span><span id="line-3693"></span><span id="checkWellStagedDFun"><span class="annot"><span class="annottext">checkWellStagedDFun :: CtLoc -&gt; InstanceWhat -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#checkWellStagedDFun"><span class="hs-identifier hs-var hs-var">checkWellStagedDFun</span></a></span></span><span> </span><span id="local-6989586621681332181"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332181"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332180"><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621681332180"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621681332179"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332179"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-3694"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#TopLevInstance"><span class="hs-identifier hs-type">TopLevInstance</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">iw_dfun_id :: InstanceWhat -&gt; TcTyVar
</span><a href="GHC.Tc.Instance.Class.html#iw_dfun_id"><span class="hs-identifier hs-var">iw_dfun_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332176"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332176"><span class="hs-identifier hs-var">dfun_id</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstanceWhat
</span><a href="#local-6989586621681332180"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-3695"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332175"><span class="annot"><span class="annottext">bind_lvl :: Int
</span><a href="#local-6989586621681332175"><span class="hs-identifier hs-var hs-var">bind_lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Int
</span><a href="GHC.Tc.Utils.Env.html#topIdLvl"><span class="hs-identifier hs-var">TcM.topIdLvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332176"><span class="hs-identifier hs-var">dfun_id</span></a></span><span>
</span><span id="line-3696"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332175"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Tc.Types.html#impLevel"><span class="hs-identifier hs-var">impLevel</span></a></span><span>
</span><span id="line-3697"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. CtLoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-var">TcM.setCtLocM</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332181"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3698"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332172"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681332172"><span class="hs-identifier hs-var">use_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">TcM.getStage</span></a></span><span>
</span><span id="line-3699"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; Int -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Env.html#checkWellStaged"><span class="hs-identifier hs-var">TcM.checkWellStaged</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681332170"><span class="hs-identifier hs-var">pp_thing</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332175"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; Int
</span><a href="GHC.Tc.Types.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681332172"><span class="hs-identifier hs-var">use_stage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3700"></span><span>
</span><span id="line-3701"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3702"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Fast path for common case</span><span>
</span><span id="line-3703"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3704"></span><span>    </span><span id="local-6989586621681332170"><span class="annot"><span class="annottext">pp_thing :: SDoc
</span><a href="#local-6989586621681332170"><span class="hs-identifier hs-var hs-var">pp_thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instance for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332179"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3705"></span><span>
</span><span id="line-3706"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprEq"><span class="hs-identifier hs-type">pprEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3707"></span><span id="pprEq"><span class="annot"><span class="annottext">pprEq :: Type -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.Solver.Monad.html#pprEq"><span class="hs-identifier hs-var hs-var">pprEq</span></a></span></span><span> </span><span id="local-6989586621681332167"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332167"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681332166"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332166"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332167"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'~'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332166"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-3708"></span><span>
</span><span id="line-3709"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-type">isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3710"></span><span id="isFilledMetaTyVar_maybe"><span class="annot"><span class="annottext">isFilledMetaTyVar_maybe :: TcTyVar -&gt; TcS (Maybe Type)
</span><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var hs-var">isFilledMetaTyVar_maybe</span></a></span></span><span> </span><span id="local-6989586621681332163"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332163"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM (Maybe Type)
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var">TcM.isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332163"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3711"></span><span>
</span><span id="line-3712"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar"><span class="hs-identifier hs-type">isFilledMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3713"></span><span id="isFilledMetaTyVar"><span class="annot"><span class="annottext">isFilledMetaTyVar :: TcTyVar -&gt; TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar"><span class="hs-identifier hs-var hs-var">isFilledMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621681332161"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332161"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM Bool
</span><a href="GHC.Tc.Utils.TcMType.html#isFilledMetaTyVar"><span class="hs-identifier hs-var">TcM.isFilledMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332161"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3714"></span><span>
</span><span id="line-3715"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-type">zonkTyCoVarsAndFV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a></span><span>
</span><span id="line-3716"></span><span id="zonkTyCoVarsAndFV"><span class="annot"><span class="annottext">zonkTyCoVarsAndFV :: VarSet -&gt; TcS VarSet
</span><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var hs-var">zonkTyCoVarsAndFV</span></a></span></span><span> </span><span id="local-6989586621681332158"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332158"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; TcM VarSet
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTyCoVarsAndFV"><span class="hs-identifier hs-var">TcM.zonkTyCoVarsAndFV</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332158"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3717"></span><span>
</span><span id="line-3718"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-type">zonkTyCoVarsAndFVList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3719"></span><span id="zonkTyCoVarsAndFVList"><span class="annot"><span class="annottext">zonkTyCoVarsAndFVList :: [TcTyVar] -&gt; TcS [TcTyVar]
</span><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-var hs-var">zonkTyCoVarsAndFVList</span></a></span></span><span> </span><span id="local-6989586621681332155"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332155"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; TcM [TcTyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTyCoVarsAndFVList"><span class="hs-identifier hs-var">TcM.zonkTyCoVarsAndFVList</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332155"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3720"></span><span>
</span><span id="line-3721"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkCo"><span class="hs-identifier hs-type">zonkCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-3722"></span><span id="zonkCo"><span class="annot"><span class="annottext">zonkCo :: Coercion -&gt; TcS Coercion
</span><a href="GHC.Tc.Solver.Monad.html#zonkCo"><span class="hs-identifier hs-var hs-var">zonkCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; TcM Coercion
</span><a href="GHC.Tc.Utils.TcMType.html#zonkCo"><span class="hs-identifier hs-var">TcM.zonkCo</span></a></span><span>
</span><span id="line-3723"></span><span>
</span><span id="line-3724"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcType"><span class="hs-identifier hs-type">zonkTcType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-3725"></span><span id="zonkTcType"><span class="annot"><span class="annottext">zonkTcType :: Type -&gt; TcS Type
</span><a href="GHC.Tc.Solver.Monad.html#zonkTcType"><span class="hs-identifier hs-var hs-var">zonkTcType</span></a></span></span><span> </span><span id="local-6989586621681332152"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332152"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">TcM.zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332152"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3726"></span><span>
</span><span id="line-3727"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTypes"><span class="hs-identifier hs-type">zonkTcTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3728"></span><span id="zonkTcTypes"><span class="annot"><span class="annottext">zonkTcTypes :: [Type] -&gt; TcS [Type]
</span><a href="GHC.Tc.Solver.Monad.html#zonkTcTypes"><span class="hs-identifier hs-var hs-var">zonkTcTypes</span></a></span></span><span> </span><span id="local-6989586621681332150"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332150"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTypes"><span class="hs-identifier hs-var">TcM.zonkTcTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332150"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3729"></span><span>
</span><span id="line-3730"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTcTyVar"><span class="hs-identifier hs-type">zonkTcTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-3731"></span><span id="zonkTcTyVar"><span class="annot"><span class="annottext">zonkTcTyVar :: TcTyVar -&gt; TcS Type
</span><a href="GHC.Tc.Solver.Monad.html#zonkTcTyVar"><span class="hs-identifier hs-var hs-var">zonkTcTyVar</span></a></span></span><span> </span><span id="local-6989586621681332148"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332148"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">TcM.zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332148"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3732"></span><span>
</span><span id="line-3733"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkSimples"><span class="hs-identifier hs-type">zonkSimples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-3734"></span><span id="zonkSimples"><span class="annot"><span class="annottext">zonkSimples :: Bag Ct -&gt; TcS (Bag Ct)
</span><a href="GHC.Tc.Solver.Monad.html#zonkSimples"><span class="hs-identifier hs-var hs-var">zonkSimples</span></a></span></span><span> </span><span id="local-6989586621681332146"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332146"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Ct -&gt; TcM (Bag Ct)
</span><a href="GHC.Tc.Utils.TcMType.html#zonkSimples"><span class="hs-identifier hs-var">TcM.zonkSimples</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681332146"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3735"></span><span>
</span><span id="line-3736"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkWC"><span class="hs-identifier hs-type">zonkWC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-3737"></span><span id="zonkWC"><span class="annot"><span class="annottext">zonkWC :: WantedConstraints -&gt; TcS WantedConstraints
</span><a href="GHC.Tc.Solver.Monad.html#zonkWC"><span class="hs-identifier hs-var hs-var">zonkWC</span></a></span></span><span> </span><span id="local-6989586621681332144"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681332144"><span class="hs-identifier hs-var">wc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM WantedConstraints
</span><a href="GHC.Tc.Utils.TcMType.html#zonkWC"><span class="hs-identifier hs-var">TcM.zonkWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681332144"><span class="hs-identifier hs-var">wc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3738"></span><span>
</span><span id="line-3739"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarKind"><span class="hs-identifier hs-type">zonkTyCoVarKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a></span><span>
</span><span id="line-3740"></span><span id="zonkTyCoVarKind"><span class="annot"><span class="annottext">zonkTyCoVarKind :: TcTyVar -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#zonkTyCoVarKind"><span class="hs-identifier hs-var hs-var">zonkTyCoVarKind</span></a></span></span><span> </span><span id="local-6989586621681332142"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332142"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTyCoVarKind"><span class="hs-identifier hs-var">TcM.zonkTyCoVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332142"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3741"></span><span>
</span><span id="line-3742"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-3743"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier hs-type">pprKicked</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3744"></span><span id="pprKicked"><span class="annot"><span class="annottext">pprKicked :: Int -&gt; SDoc
</span><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier hs-var hs-var">pprKicked</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-3745"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#pprKicked"><span class="hs-identifier hs-var">pprKicked</span></a></span><span> </span><span id="local-6989586621681332140"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332140"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681332140"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kicked out&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-3746"></span><span>
</span><span id="line-3747"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
*              The Unification Level Flag                              *
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-3752"></span><span>
</span><span id="line-3753"></span><span class="hs-comment">{- Note [The Unification Level Flag]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a deep tree of implication constraints
   forall[1] a.                              -- Outer-implic
      C alpha[1]                               -- Simple
      forall[2] c. ....(C alpha[1])....        -- Implic-1
      forall[2] b. ....(alpha[1] ~ Int)....    -- Implic-2

The (C alpha) is insoluble until we know alpha.  We solve alpha
by unifying alpha:=Int somewhere deep inside Implic-2. But then we
must try to solve the Outer-implic all over again. This time we can
solve (C alpha) both in Outer-implic, and nested inside Implic-1.

When should we iterate solving a level-n implication?
Answer: if any unification of a tyvar at level n takes place
        in the ic_implics of that implication.

* What if a unification takes place at level n-1? Then don't iterate
  level n, because we'll iterate level n-1, and that will in turn iterate
  level n.

* What if a unification takes place at level n, in the ic_simples of
  level n?  No need to track this, because the kick-out mechanism deals
  with it.  (We can't drop kick-out in favour of iteration, because kick-out
  works for skolem-equalities, not just unifications.)

So the monad-global Unification Level Flag, kept in tcs_unif_lvl keeps
track of
  - Whether any unifications at all have taken place (Nothing =&gt; no unifications)
  - If so, what is the outermost level that has seen a unification (Just lvl)

The iteration done in the simplify_loop/maybe_simplify_again loop in GHC.Tc.Solver.

It helpful not to iterate unless there is a chance of progress.  #8474 is
an example:

  * There's a deeply-nested chain of implication constraints.
       ?x:alpha =&gt; ?y1:beta1 =&gt; ... ?yn:betan =&gt; [W] ?x:Int

  * From the innermost one we get a [D] alpha[1] ~ Int,
    so we can unify.

  * It's better not to iterate the inner implications, but go all the
    way out to level 1 before iterating -- because iterating level 1
    will iterate the inner levels anyway.

(In the olden days when we &quot;floated&quot; thse Derived constraints, this was
much, much more important -- we got exponential behaviour, as each iteration
produced the same Derived constraint.)
-}</span><span>
</span><span id="line-3803"></span><span>
</span><span id="line-3804"></span><span>
</span><span id="line-3805"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#resetUnificationFlag"><span class="hs-identifier hs-type">resetUnificationFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3806"></span><span class="hs-comment">-- We are at ambient level i</span><span>
</span><span id="line-3807"></span><span class="hs-comment">-- If the unification flag = Just i, reset it to Nothing and return True</span><span>
</span><span id="line-3808"></span><span class="hs-comment">-- Otherwise leave it unchanged and return False</span><span>
</span><span id="line-3809"></span><span id="resetUnificationFlag"><span class="annot"><span class="annottext">resetUnificationFlag :: TcS Bool
</span><a href="GHC.Tc.Solver.Monad.html#resetUnificationFlag"><span class="hs-identifier hs-var hs-var">resetUnificationFlag</span></a></span></span><span>
</span><span id="line-3810"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681332139"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332139"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3811"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332138"><span class="annot"><span class="annottext">ref :: IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332138"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332139"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-3812"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332137"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332137"><span class="hs-identifier hs-var">ambient_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">TcM.getTcLevel</span></a></span><span>
</span><span id="line-3813"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332136"><span class="annot"><span class="annottext">Maybe TcLevel
</span><a href="#local-6989586621681332136"><span class="hs-identifier hs-var">mb_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332138"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3814"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;resetUnificationFlag&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3815"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ambient:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332137"><span class="hs-identifier hs-var">ambient_lvl</span></a></span><span>
</span><span id="line-3816"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unif_lvl:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TcLevel
</span><a href="#local-6989586621681332136"><span class="hs-identifier hs-var">mb_lvl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3817"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TcLevel
</span><a href="#local-6989586621681332136"><span class="hs-identifier hs-var">mb_lvl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3818"></span><span>           </span><span class="annot"><span class="annottext">Maybe TcLevel
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3819"></span><span>           </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332135"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332135"><span class="hs-identifier hs-var">unif_lvl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332137"><span class="hs-identifier hs-var">ambient_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332135"><span class="hs-identifier hs-var">unif_lvl</span></a></span><span>
</span><span id="line-3820"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3821"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3822"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332138"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3823"></span><span>                               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3824"></span><span>
</span><span id="line-3825"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setUnificationFlag"><span class="hs-identifier hs-type">setUnificationFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3826"></span><span class="hs-comment">-- (setUnificationFlag i) sets the unification level to (Just i)</span><span>
</span><span id="line-3827"></span><span class="hs-comment">-- unless it already is (Just j) where j &lt;= i</span><span>
</span><span id="line-3828"></span><span id="setUnificationFlag"><span class="annot"><span class="annottext">setUnificationFlag :: TcLevel -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setUnificationFlag"><span class="hs-identifier hs-var hs-var">setUnificationFlag</span></a></span></span><span> </span><span id="local-6989586621681332134"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332134"><span class="hs-identifier hs-var">lvl</span></a></span></span><span>
</span><span id="line-3829"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (TcSEnv -&gt; TcM a) -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-var">TcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681332133"><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332133"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3830"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332132"><span class="annot"><span class="annottext">ref :: IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332132"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcSEnv -&gt; IORef (Maybe TcLevel)
</span><a href="GHC.Tc.Solver.Monad.html#tcs_unif_lvl"><span class="hs-identifier hs-var">tcs_unif_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcSEnv
</span><a href="#local-6989586621681332133"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-3831"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332131"><span class="annot"><span class="annottext">Maybe TcLevel
</span><a href="#local-6989586621681332131"><span class="hs-identifier hs-var">mb_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332132"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3832"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TcLevel
</span><a href="#local-6989586621681332131"><span class="hs-identifier hs-var">mb_lvl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3833"></span><span>           </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332130"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332130"><span class="hs-identifier hs-var">unif_lvl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332134"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#deeperThanOrSame"><span class="hs-operator hs-var">`deeperThanOrSame`</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332130"><span class="hs-identifier hs-var">unif_lvl</span></a></span><span>
</span><span id="line-3834"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3835"></span><span>           </span><span class="annot"><span class="annottext">Maybe TcLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe TcLevel)
</span><a href="#local-6989586621681332132"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681332134"><span class="hs-identifier hs-var">lvl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3836"></span><span>
</span><span id="line-3837"></span><span>
</span><span id="line-3838"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
*                Instantiation etc.
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-3843"></span><span>
</span><span id="line-3844"></span><span class="hs-comment">-- Instantiations</span><span>
</span><span id="line-3845"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3846"></span><span>
</span><span id="line-3847"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instDFunType"><span class="hs-identifier hs-type">instDFunType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3848"></span><span id="instDFunType"><span class="annot"><span class="annottext">instDFunType :: TcTyVar -&gt; [Maybe Type] -&gt; TcS ([Type], [Type])
</span><a href="GHC.Tc.Solver.Monad.html#instDFunType"><span class="hs-identifier hs-var hs-var">instDFunType</span></a></span></span><span> </span><span id="local-6989586621681332126"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332126"><span class="hs-identifier hs-var">dfun_id</span></a></span></span><span> </span><span id="local-6989586621681332125"><span class="annot"><span class="annottext">[Maybe Type]
</span><a href="#local-6989586621681332125"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span>
</span><span id="line-3849"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; [Maybe Type] -&gt; TcM ([Type], [Type])
</span><a href="GHC.Tc.Utils.Instantiate.html#instDFunType"><span class="hs-identifier hs-var">TcM.instDFunType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332126"><span class="hs-identifier hs-var">dfun_id</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Type]
</span><a href="#local-6989586621681332125"><span class="hs-identifier hs-var">inst_tys</span></a></span><span>
</span><span id="line-3850"></span><span>
</span><span id="line-3851"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newFlexiTcSTy"><span class="hs-identifier hs-type">newFlexiTcSTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-3852"></span><span id="newFlexiTcSTy"><span class="annot"><span class="annottext">newFlexiTcSTy :: Type -&gt; TcS Type
</span><a href="GHC.Tc.Solver.Monad.html#newFlexiTcSTy"><span class="hs-identifier hs-var hs-var">newFlexiTcSTy</span></a></span></span><span> </span><span id="local-6989586621681332122"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332122"><span class="hs-identifier hs-var">knd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">TcM.newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332122"><span class="hs-identifier hs-var">knd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3853"></span><span>
</span><span id="line-3854"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#cloneMetaTyVar"><span class="hs-identifier hs-type">cloneMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-3855"></span><span id="cloneMetaTyVar"><span class="annot"><span class="annottext">cloneMetaTyVar :: TcTyVar -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#cloneMetaTyVar"><span class="hs-identifier hs-var hs-var">cloneMetaTyVar</span></a></span></span><span> </span><span id="local-6989586621681332120"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332120"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#cloneMetaTyVar"><span class="hs-identifier hs-var">TcM.cloneMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332120"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3856"></span><span>
</span><span id="line-3857"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexi"><span class="hs-identifier hs-type">instFlexi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TKVar"><span class="hs-identifier hs-type">TKVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-3858"></span><span id="instFlexi"><span class="annot"><span class="annottext">instFlexi :: [TcTyVar] -&gt; TcS TCvSubst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexi"><span class="hs-identifier hs-var hs-var">instFlexi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TcTyVar] -&gt; TcS TCvSubst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiX"><span class="hs-identifier hs-var">instFlexiX</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a></span><span>
</span><span id="line-3859"></span><span>
</span><span id="line-3860"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiX"><span class="hs-identifier hs-type">instFlexiX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TKVar"><span class="hs-identifier hs-type">TKVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-3861"></span><span id="instFlexiX"><span class="annot"><span class="annottext">instFlexiX :: TCvSubst -&gt; [TcTyVar] -&gt; TcS TCvSubst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiX"><span class="hs-identifier hs-var hs-var">instFlexiX</span></a></span></span><span> </span><span id="local-6989586621681332116"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681332116"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681332115"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332115"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-3862"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; TcTyVar -&gt; TcM TCvSubst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiHelper"><span class="hs-identifier hs-var">instFlexiHelper</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681332116"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332115"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3863"></span><span>
</span><span id="line-3864"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#instFlexiHelper"><span class="hs-identifier hs-type">instFlexiHelper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TKVar"><span class="hs-identifier hs-type">TKVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-3865"></span><span id="instFlexiHelper"><span class="annot"><span class="annottext">instFlexiHelper :: TCvSubst -&gt; TcTyVar -&gt; TcM TCvSubst
</span><a href="GHC.Tc.Solver.Monad.html#instFlexiHelper"><span class="hs-identifier hs-var hs-var">instFlexiHelper</span></a></span></span><span> </span><span id="local-6989586621681332112"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681332112"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681332111"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332111"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-3866"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332110"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681332110"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">TcM.newUnique</span></a></span><span>
</span><span id="line-3867"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681332108"><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621681332108"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaInfo -&gt; TcM TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaDetails"><span class="hs-identifier hs-var">TcM.newMetaDetails</span></a></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TauTv"><span class="hs-identifier hs-var">TauTv</span></a></span><span>
</span><span id="line-3868"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332105"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681332105"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Name
</span><a href="GHC.Types.Name.html#setNameUnique"><span class="hs-identifier hs-var">setNameUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332111"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681332110"><span class="hs-identifier hs-var">uniq</span></a></span><span>
</span><span id="line-3869"></span><span>             </span><span id="local-6989586621681332102"><span class="annot"><span class="annottext">kind :: Type
</span><a href="#local-6989586621681332102"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681332112"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332111"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3870"></span><span>             </span><span id="local-6989586621681332099"><span class="annot"><span class="annottext">ty' :: Type
</span><a href="#local-6989586621681332099"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; TcTyVar
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681332105"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332102"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621681332108"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3871"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instFlexi&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332099"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3872"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; TcTyVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681332112"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332111"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332099"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3873"></span><span>
</span><span id="line-3874"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchGlobalInst"><span class="hs-identifier hs-type">matchGlobalInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-3875"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True &lt;=&gt; caller is the short-cut solver</span><span>
</span><span id="line-3876"></span><span>                             </span><span class="hs-comment">-- See Note [Shortcut solving: overlap]</span><span>
</span><span id="line-3877"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#ClsInstResult"><span class="hs-identifier hs-type">TcM.ClsInstResult</span></a></span><span>
</span><span id="line-3878"></span><span id="matchGlobalInst"><span class="annot"><span class="annottext">matchGlobalInst :: DynFlags -&gt; Bool -&gt; Class -&gt; [Type] -&gt; TcS ClsInstResult
</span><a href="GHC.Tc.Solver.Monad.html#matchGlobalInst"><span class="hs-identifier hs-var hs-var">matchGlobalInst</span></a></span></span><span> </span><span id="local-6989586621681332095"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681332095"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681332094"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332094"><span class="hs-identifier hs-var">short_cut</span></a></span></span><span> </span><span id="local-6989586621681332093"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332093"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681332092"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332092"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-3879"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; Class -&gt; [Type] -&gt; TcM ClsInstResult
</span><a href="GHC.Tc.Instance.Class.html#matchGlobalInst"><span class="hs-identifier hs-var">TcM.matchGlobalInst</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681332095"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681332094"><span class="hs-identifier hs-var">short_cut</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681332093"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681332092"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3880"></span><span>
</span><span id="line-3881"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-type">tcInstSkolTyVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3882"></span><span id="tcInstSkolTyVarsX"><span class="annot"><span class="annottext">tcInstSkolTyVarsX :: TCvSubst -&gt; [TcTyVar] -&gt; TcS (TCvSubst, [TcTyVar])
</span><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var hs-var">tcInstSkolTyVarsX</span></a></span></span><span> </span><span id="local-6989586621681332091"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681332091"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681332090"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332090"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TcTyVar] -&gt; TcM (TCvSubst, [TcTyVar])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">TcM.tcInstSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681332091"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621681332090"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-3883"></span><span>
</span><span id="line-3884"></span><span class="hs-comment">-- Creating and setting evidence variables and CtFlavors</span><span>
</span><span id="line-3885"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3886"></span><span>
</span><span id="line-3887"></span><span class="hs-keyword">data</span><span> </span><span id="MaybeNew"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-var">MaybeNew</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Fresh"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Cached"><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a></span><span>
</span><span id="line-3888"></span><span>
</span><span id="line-3889"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier hs-type">isFresh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3890"></span><span id="isFresh"><span class="annot"><span class="annottext">isFresh :: MaybeNew -&gt; Bool
</span><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier hs-var hs-var">isFresh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3891"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#isFresh"><span class="hs-identifier hs-var">isFresh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3892"></span><span>
</span><span id="line-3893"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#freshGoals"><span class="hs-identifier hs-type">freshGoals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3894"></span><span id="freshGoals"><span class="annot"><span class="annottext">freshGoals :: [MaybeNew] -&gt; [CtEvidence]
</span><a href="GHC.Tc.Solver.Monad.html#freshGoals"><span class="hs-identifier hs-var hs-var">freshGoals</span></a></span></span><span> </span><span id="local-6989586621681332086"><span class="annot"><span class="annottext">[MaybeNew]
</span><a href="#local-6989586621681332086"><span class="hs-identifier hs-var">mns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332085"><span class="hs-identifier hs-var">ctev</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span> </span><span id="local-6989586621681332085"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332085"><span class="hs-identifier hs-var">ctev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MaybeNew]
</span><a href="#local-6989586621681332086"><span class="hs-identifier hs-var">mns</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3895"></span><span>
</span><span id="line-3896"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-type">getEvExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a></span><span>
</span><span id="line-3897"></span><span id="getEvExpr"><span class="annot"><span class="annottext">getEvExpr :: MaybeNew -&gt; EvExpr
</span><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-var hs-var">getEvExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span> </span><span id="local-6989586621681332084"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332084"><span class="hs-identifier hs-var">ctev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EvExpr
</span><a href="GHC.Tc.Types.Constraint.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332084"><span class="hs-identifier hs-var">ctev</span></a></span><span>
</span><span id="line-3898"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-var">getEvExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span id="local-6989586621681332082"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621681332082"><span class="hs-identifier hs-var">evt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621681332082"><span class="hs-identifier hs-var">evt</span></a></span><span>
</span><span id="line-3899"></span><span>
</span><span id="line-3900"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-type">setEvBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3901"></span><span id="setEvBind"><span class="annot"><span class="annottext">setEvBind :: EvBind -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-var hs-var">setEvBind</span></a></span></span><span> </span><span id="local-6989586621681332081"><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621681332081"><span class="hs-identifier hs-var">ev_bind</span></a></span></span><span>
</span><span id="line-3902"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332080"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332080"><span class="hs-identifier hs-var">evb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var">getTcEvBindsVar</span></a></span><span>
</span><span id="line-3903"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; EvBind -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-var">TcM.addTcEvBind</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332080"><span class="hs-identifier hs-var">evb</span></a></span><span> </span><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621681332081"><span class="hs-identifier hs-var">ev_bind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3904"></span><span>
</span><span id="line-3905"></span><span class="hs-comment">-- | Mark variables as used filling a coercion hole</span><span>
</span><span id="line-3906"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-type">useVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#CoVarSet"><span class="hs-identifier hs-type">CoVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3907"></span><span id="useVars"><span class="annot"><span class="annottext">useVars :: VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-var hs-var">useVars</span></a></span></span><span> </span><span id="local-6989586621681332076"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332076"><span class="hs-identifier hs-var">co_vars</span></a></span></span><span>
</span><span id="line-3908"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332075"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332075"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#getTcEvBindsVar"><span class="hs-identifier hs-var">getTcEvBindsVar</span></a></span><span>
</span><span id="line-3909"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332074"><span class="annot"><span class="annottext">ref :: IORef VarSet
</span><a href="#local-6989586621681332074"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; IORef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681332075"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span>
</span><span id="line-3910"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3911"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332072"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332072"><span class="hs-identifier hs-var">tcvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">TcM.readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef VarSet
</span><a href="#local-6989586621681332074"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3912"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332071"><span class="annot"><span class="annottext">tcvs' :: VarSet
</span><a href="#local-6989586621681332071"><span class="hs-identifier hs-var hs-var">tcvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332072"><span class="hs-identifier hs-var">tcvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332076"><span class="hs-identifier hs-var">co_vars</span></a></span><span>
</span><span id="line-3913"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">TcM.writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef VarSet
</span><a href="#local-6989586621681332074"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681332071"><span class="hs-identifier hs-var">tcvs'</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3914"></span><span>
</span><span id="line-3915"></span><span class="hs-comment">-- | Equalities only</span><span>
</span><span id="line-3916"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-type">setWantedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3917"></span><span id="setWantedEq"><span class="annot"><span class="annottext">setWantedEq :: TcEvDest -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var hs-var">setWantedEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span id="local-6989586621681332068"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332068"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332067"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332067"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-3918"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-var">useVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332067"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3919"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var">fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332068"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332067"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3920"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-type">EvVarDest</span></a></span><span> </span><span id="local-6989586621681332063"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332063"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setWantedEq&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332063"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3921"></span><span>
</span><span id="line-3922"></span><span class="hs-comment">-- | Good for both equalities and non-equalities</span><span>
</span><span id="line-3923"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-type">setWantedEvTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3924"></span><span id="setWantedEvTerm"><span class="annot"><span class="annottext">setWantedEvTerm :: TcEvDest -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var hs-var">setWantedEvTerm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-type">HoleDest</span></a></span><span> </span><span id="local-6989586621681332062"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332062"><span class="hs-identifier hs-var">hole</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332061"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332061"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-3925"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332060"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332060"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvTerm -&gt; Maybe Coercion
</span><a href="GHC.Tc.Types.Evidence.html#evTermCoercion_maybe"><span class="hs-identifier hs-var">evTermCoercion_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332061"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-3926"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#useVars"><span class="hs-identifier hs-var">useVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#coVarsOfCo"><span class="hs-identifier hs-var">coVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332060"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3927"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var">fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332062"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332060"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3928"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3929"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Yukky eq_sel for a HoleDest]</span><span>
</span><span id="line-3930"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681332058"><span class="annot"><span class="annottext">co_var :: TcTyVar
</span><a href="#local-6989586621681332058"><span class="hs-identifier hs-var hs-var">co_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; TcTyVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332062"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-3931"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EvBind -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; EvTerm -&gt; EvBind
</span><a href="GHC.Tc.Types.Evidence.html#mkWantedEvBind"><span class="hs-identifier hs-var">mkWantedEvBind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332058"><span class="hs-identifier hs-var">co_var</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332061"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3932"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var">fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332062"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Coercion
</span><a href="GHC.Tc.Types.Evidence.html#mkTcCoVarCo"><span class="hs-identifier hs-var">mkTcCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332058"><span class="hs-identifier hs-var">co_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3933"></span><span>
</span><span id="line-3934"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-type">EvVarDest</span></a></span><span> </span><span id="local-6989586621681332054"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332054"><span class="hs-identifier hs-var">ev_id</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681332053"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332053"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-3935"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBind -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; EvTerm -&gt; EvBind
</span><a href="GHC.Tc.Types.Evidence.html#mkWantedEvBind"><span class="hs-identifier hs-var">mkWantedEvBind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332054"><span class="hs-identifier hs-var">ev_id</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332053"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3936"></span><span>
</span><span id="line-3937"></span><span class="hs-comment">{- Note [Yukky eq_sel for a HoleDest]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
How can it be that a Wanted with HoleDest gets evidence that isn't
just a coercion? i.e. evTermCoercion_maybe returns Nothing.

Consider [G] forall a. blah =&gt; a ~ T
         [W] S ~# T

Then doTopReactEqPred carefully looks up the (boxed) constraint (S ~
T) in the quantified constraints, and wraps the (boxed) evidence it
gets back in an eq_sel to extract the unboxed (S ~# T).  We can't put
that term into a coercion, so we add a value binding
    h = eq_sel (...)
and the coercion variable h to fill the coercion hole.
We even re-use the CoHole's Id for this binding!

Yuk!
-}</span><span>
</span><span id="line-3955"></span><span>
</span><span id="line-3956"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-type">fillCoercionHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3957"></span><span id="fillCoercionHole"><span class="annot"><span class="annottext">fillCoercionHole :: CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#fillCoercionHole"><span class="hs-identifier hs-var hs-var">fillCoercionHole</span></a></span></span><span> </span><span id="local-6989586621681332052"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332052"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span id="local-6989586621681332051"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332051"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-3958"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcM ()
</span><a href="GHC.Tc.Utils.TcMType.html#fillCoercionHole"><span class="hs-identifier hs-var">TcM.fillCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332052"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332051"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-3959"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#kickOutAfterFillingCoercionHole"><span class="hs-identifier hs-var">kickOutAfterFillingCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332052"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332051"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3960"></span><span>
</span><span id="line-3961"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier hs-type">setEvBindIfWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3962"></span><span id="setEvBindIfWanted"><span class="annot"><span class="annottext">setEvBindIfWanted :: CtEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier hs-var hs-var">setEvBindIfWanted</span></a></span></span><span> </span><span id="local-6989586621681332049"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332049"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621681332048"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332048"><span class="hs-identifier hs-var">tm</span></a></span></span><span>
</span><span id="line-3963"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332049"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3964"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681332046"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621681332046"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcEvDest -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621681332046"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332048"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-3965"></span><span>      </span><span class="annot"><span class="annottext">CtEvidence
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3966"></span><span>
</span><span id="line-3967"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newTcEvBinds"><span class="hs-identifier hs-type">newTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-3968"></span><span id="newTcEvBinds"><span class="annot"><span class="annottext">newTcEvBinds :: TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var hs-var">newTcEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var">TcM.newTcEvBinds</span></a></span><span>
</span><span id="line-3969"></span><span>
</span><span id="line-3970"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-type">newNoTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-3971"></span><span id="newNoTcEvBinds"><span class="annot"><span class="annottext">newNoTcEvBinds :: TcS EvBindsVar
</span><a href="GHC.Tc.Solver.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var hs-var">newNoTcEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var">TcM.newNoTcEvBinds</span></a></span><span>
</span><span id="line-3972"></span><span>
</span><span id="line-3973"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-type">newEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-3974"></span><span id="newEvVar"><span class="annot"><span class="annottext">newEvVar :: Type -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-var hs-var">newEvVar</span></a></span></span><span> </span><span id="local-6989586621681332045"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332045"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall gbl lcl. Type -&gt; TcRnIf gbl lcl TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVar"><span class="hs-identifier hs-var">TcM.newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332045"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3975"></span><span>
</span><span id="line-3976"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-type">newGivenEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-3977"></span><span class="hs-comment">-- Make a new variable of the given PredType,</span><span>
</span><span id="line-3978"></span><span class="hs-comment">-- immediately bind it to the given term</span><span>
</span><span id="line-3979"></span><span class="hs-comment">-- and return its CtEvidence</span><span>
</span><span id="line-3980"></span><span class="hs-comment">-- See Note [Bind new Givens immediately] in GHC.Tc.Types.Constraint</span><span>
</span><span id="line-3981"></span><span id="newGivenEvVar"><span class="annot"><span class="annottext">newGivenEvVar :: CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var hs-var">newGivenEvVar</span></a></span></span><span> </span><span id="local-6989586621681332043"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332043"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332042"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332042"><span class="hs-identifier hs-var">pred</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332041"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332041"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3982"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332040"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332040"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; EvTerm -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier hs-var">newBoundEvVarId</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332042"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332041"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-3983"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332042"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332040"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332043"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3984"></span><span>
</span><span id="line-3985"></span><span class="hs-comment">-- | Make a new 'Id' of the given type, bound (in the monad's EvBinds) to the</span><span>
</span><span id="line-3986"></span><span class="hs-comment">-- given term</span><span>
</span><span id="line-3987"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier hs-type">newBoundEvVarId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-3988"></span><span id="newBoundEvVarId"><span class="annot"><span class="annottext">newBoundEvVarId :: Type -&gt; EvTerm -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newBoundEvVarId"><span class="hs-identifier hs-var hs-var">newBoundEvVarId</span></a></span></span><span> </span><span id="local-6989586621681332039"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332039"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621681332038"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332038"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-3989"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332037"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332037"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332039"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-3990"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EvBind -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBind"><span class="hs-identifier hs-var">setEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; EvTerm -&gt; EvBind
</span><a href="GHC.Tc.Types.Evidence.html#mkGivenEvBind"><span class="hs-identifier hs-var">mkGivenEvBind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332037"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681332038"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3991"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332037"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3992"></span><span>
</span><span id="line-3993"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newGivenEvVars"><span class="hs-identifier hs-type">newGivenEvVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3994"></span><span id="newGivenEvVars"><span class="annot"><span class="annottext">newGivenEvVars :: CtLoc -&gt; [(Type, EvTerm)] -&gt; TcS [CtEvidence]
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVars"><span class="hs-identifier hs-var hs-var">newGivenEvVars</span></a></span></span><span> </span><span id="local-6989586621681332035"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332035"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332034"><span class="annot"><span class="annottext">[(Type, EvTerm)]
</span><a href="#local-6989586621681332034"><span class="hs-identifier hs-var">pts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332035"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Type, EvTerm)]
</span><a href="#local-6989586621681332034"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-3995"></span><span>
</span><span id="line-3996"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier hs-type">emitNewWantedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-3997"></span><span class="hs-comment">-- | Emit a new Wanted equality into the work-list</span><span>
</span><span id="line-3998"></span><span id="emitNewWantedEq"><span class="annot"><span class="annottext">emitNewWantedEq :: CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS Coercion
</span><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier hs-var hs-var">emitNewWantedEq</span></a></span></span><span> </span><span id="local-6989586621681332032"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332032"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332031"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681332031"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681332030"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332030"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681332029"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332029"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-3999"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681332028"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332028"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681332027"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332027"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332032"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681332031"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332030"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332029"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-4000"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332028"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4001"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681332027"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4002"></span><span>
</span><span id="line-4003"></span><span class="hs-comment">-- | Make a new equality CtEvidence</span><span>
</span><span id="line-4004"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-type">newWantedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-4005"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4006"></span><span id="newWantedEq"><span class="annot"><span class="annottext">newWantedEq :: CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var hs-var">newWantedEq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
-&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq_SI"><span class="hs-identifier hs-var">newWantedEq_SI</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a></span><span>
</span><span id="line-4007"></span><span>
</span><span id="line-4008"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEq_SI"><span class="hs-identifier hs-type">newWantedEq_SI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ShadowInfo"><span class="hs-identifier hs-type">ShadowInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-4009"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-4010"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4011"></span><span id="newWantedEq_SI"><span class="annot"><span class="annottext">newWantedEq_SI :: ShadowInfo
-&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq_SI"><span class="hs-identifier hs-var hs-var">newWantedEq_SI</span></a></span></span><span> </span><span id="local-6989586621681332026"><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332026"><span class="hs-identifier hs-var">si</span></a></span></span><span> </span><span id="local-6989586621681332025"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332025"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332024"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681332024"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681332023"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332023"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681332022"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332022"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-4012"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332021"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332021"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM CoercionHole
</span><a href="GHC.Tc.Utils.TcMType.html#newCoercionHole"><span class="hs-identifier hs-var">TcM.newCoercionHole</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332019"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4013"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Emitting new coercion hole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332021"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332019"><span class="hs-identifier hs-var">pty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4014"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332019"><span class="hs-identifier hs-var">pty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332021"><span class="hs-identifier hs-var">hole</span></a></span><span>
</span><span id="line-4015"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332026"><span class="hs-identifier hs-var">si</span></a></span><span>
</span><span id="line-4016"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332025"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-4017"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier hs-var">mkHoleCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681332021"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4018"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4019"></span><span>    </span><span id="local-6989586621681332019"><span class="annot"><span class="annottext">pty :: Type
</span><a href="#local-6989586621681332019"><span class="hs-identifier hs-var hs-var">pty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681332024"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332023"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332022"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-4020"></span><span>
</span><span id="line-4021"></span><span class="hs-comment">-- no equalities here. Use newWantedEq instead</span><span>
</span><span id="line-4022"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-type">newWantedEvVarNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-4023"></span><span id="newWantedEvVarNC"><span class="annot"><span class="annottext">newWantedEvVarNC :: CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-var hs-var">newWantedEvVarNC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC_SI"><span class="hs-identifier hs-var">newWantedEvVarNC_SI</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a></span><span>
</span><span id="line-4024"></span><span>
</span><span id="line-4025"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC_SI"><span class="hs-identifier hs-type">newWantedEvVarNC_SI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ShadowInfo"><span class="hs-identifier hs-type">ShadowInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-4026"></span><span class="hs-comment">-- Don't look up in the solved/inerts; we know it's not there</span><span>
</span><span id="line-4027"></span><span id="newWantedEvVarNC_SI"><span class="annot"><span class="annottext">newWantedEvVarNC_SI :: ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC_SI"><span class="hs-identifier hs-var hs-var">newWantedEvVarNC_SI</span></a></span></span><span> </span><span id="local-6989586621681332014"><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332014"><span class="hs-identifier hs-var">si</span></a></span></span><span> </span><span id="local-6989586621681332013"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332013"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332012"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332012"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-4028"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332011"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332011"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332012"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4029"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Emitting new wanted&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332011"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332012"><span class="hs-identifier hs-var">pty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-4030"></span><span>                                         </span><span class="annot"><span class="annottext">CtLoc -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332013"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4031"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332012"><span class="hs-identifier hs-var">pty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681332011"><span class="hs-identifier hs-var">new_ev</span></a></span><span>
</span><span id="line-4032"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_nosh :: ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#ctev_nosh"><span class="hs-identifier hs-var">ctev_nosh</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332014"><span class="hs-identifier hs-var">si</span></a></span><span>
</span><span id="line-4033"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332013"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-4034"></span><span>
</span><span id="line-4035"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar"><span class="hs-identifier hs-type">newWantedEvVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span>
</span><span id="line-4036"></span><span id="newWantedEvVar"><span class="annot"><span class="annottext">newWantedEvVar :: CtLoc -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar"><span class="hs-identifier hs-var hs-var">newWantedEvVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar_SI"><span class="hs-identifier hs-var">newWantedEvVar_SI</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a></span><span>
</span><span id="line-4037"></span><span>
</span><span id="line-4038"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar_SI"><span class="hs-identifier hs-type">newWantedEvVar_SI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ShadowInfo"><span class="hs-identifier hs-type">ShadowInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span>
</span><span id="line-4039"></span><span class="hs-comment">-- For anything except ClassPred, this is the same as newWantedEvVarNC</span><span>
</span><span id="line-4040"></span><span id="newWantedEvVar_SI"><span class="annot"><span class="annottext">newWantedEvVar_SI :: ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar_SI"><span class="hs-identifier hs-var hs-var">newWantedEvVar_SI</span></a></span></span><span> </span><span id="local-6989586621681332008"><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332008"><span class="hs-identifier hs-var">si</span></a></span></span><span> </span><span id="local-6989586621681332007"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332007"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681332006"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332006"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-4041"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332005"><span class="annot"><span class="annottext">Maybe CtEvidence
</span><a href="#local-6989586621681332005"><span class="hs-identifier hs-var">mb_ct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcS (Maybe CtEvidence)
</span><a href="GHC.Tc.Solver.Monad.html#lookupInInerts"><span class="hs-identifier hs-var">lookupInInerts</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332007"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332006"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4042"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe CtEvidence
</span><a href="#local-6989586621681332005"><span class="hs-identifier hs-var">mb_ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4043"></span><span>            </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681332004"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332004"><span class="hs-identifier hs-var">ctev</span></a></span></span><span>
</span><span id="line-4044"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isDerived"><span class="hs-identifier hs-var">isDerived</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332004"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4045"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newWantedEvVar/cache hit&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332004"><span class="hs-identifier hs-var">ctev</span></a></span><span>
</span><span id="line-4046"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; EvExpr
</span><a href="GHC.Tc.Types.Constraint.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332004"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4047"></span><span>            </span><span class="annot"><span class="annottext">Maybe CtEvidence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681332002"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332002"><span class="hs-identifier hs-var">ctev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC_SI"><span class="hs-identifier hs-var">newWantedEvVarNC_SI</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332008"><span class="hs-identifier hs-var">si</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332007"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681332006"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4048"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681332002"><span class="hs-identifier hs-var">ctev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4049"></span><span>
</span><span id="line-4050"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier hs-type">newWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span>
</span><span id="line-4051"></span><span class="hs-comment">-- Deals with both equalities and non equalities. Tries to look</span><span>
</span><span id="line-4052"></span><span class="hs-comment">-- up non-equalities in the cache</span><span>
</span><span id="line-4053"></span><span id="newWanted"><span class="annot"><span class="annottext">newWanted :: CtLoc -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier hs-var hs-var">newWanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWanted_SI"><span class="hs-identifier hs-var">newWanted_SI</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="GHC.Tc.Types.Constraint.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a></span><span>
</span><span id="line-4054"></span><span>
</span><span id="line-4055"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWanted_SI"><span class="hs-identifier hs-type">newWanted_SI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ShadowInfo"><span class="hs-identifier hs-type">ShadowInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#MaybeNew"><span class="hs-identifier hs-type">MaybeNew</span></a></span><span>
</span><span id="line-4056"></span><span id="newWanted_SI"><span class="annot"><span class="annottext">newWanted_SI :: ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWanted_SI"><span class="hs-identifier hs-var hs-var">newWanted_SI</span></a></span></span><span> </span><span id="local-6989586621681332001"><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332001"><span class="hs-identifier hs-var">si</span></a></span></span><span> </span><span id="local-6989586621681332000"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332000"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681331999"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331999"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-4057"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331998"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681331998"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331997"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331997"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331996"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331996"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Role, Type, Type)
</span><a href="GHC.Core.Predicate.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331999"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4058"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-var">Fresh</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
-&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq_SI"><span class="hs-identifier hs-var">newWantedEq_SI</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332001"><span class="hs-identifier hs-var">si</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332000"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681331998"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331997"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331996"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-4059"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-4060"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShadowInfo -&gt; CtLoc -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVar_SI"><span class="hs-identifier hs-var">newWantedEvVar_SI</span></a></span><span> </span><span class="annot"><span class="annottext">ShadowInfo
</span><a href="#local-6989586621681332001"><span class="hs-identifier hs-var">si</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681332000"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331999"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4061"></span><span>
</span><span id="line-4062"></span><span class="hs-comment">-- deals with both equalities and non equalities. Doesn't do any cache lookups.</span><span>
</span><span id="line-4063"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newWantedNC"><span class="hs-identifier hs-type">newWantedNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-4064"></span><span id="newWantedNC"><span class="annot"><span class="annottext">newWantedNC :: CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedNC"><span class="hs-identifier hs-var hs-var">newWantedNC</span></a></span></span><span> </span><span id="local-6989586621681331994"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331994"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681331993"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331993"><span class="hs-identifier hs-var">pty</span></a></span></span><span>
</span><span id="line-4065"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331992"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681331992"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331991"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331991"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331990"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331990"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Role, Type, Type)
</span><a href="GHC.Core.Predicate.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331993"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4066"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.3.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (CtEvidence, Coercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331994"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681331992"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331991"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331990"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-4067"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-4068"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-var">newWantedEvVarNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331994"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331993"><span class="hs-identifier hs-var">pty</span></a></span><span>
</span><span id="line-4069"></span><span>
</span><span id="line-4070"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewDeriveds"><span class="hs-identifier hs-type">emitNewDeriveds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4071"></span><span id="emitNewDeriveds"><span class="annot"><span class="annottext">emitNewDeriveds :: CtLoc -&gt; [Type] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitNewDeriveds"><span class="hs-identifier hs-var hs-var">emitNewDeriveds</span></a></span></span><span> </span><span id="local-6989586621681331989"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331989"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681331988"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331988"><span class="hs-identifier hs-var">preds</span></a></span></span><span>
</span><span id="line-4072"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331988"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-4073"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4074"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-4075"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331987"><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681331987"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.3.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newDerivedNC"><span class="hs-identifier hs-var">newDerivedNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331989"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331988"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-4076"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Emitting new deriveds&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681331987"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4077"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CtEvidence] -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListDeriveds"><span class="hs-identifier hs-var">extendWorkListDeriveds</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621681331987"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4078"></span><span>
</span><span id="line-4079"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#emitNewDerivedEq"><span class="hs-identifier hs-type">emitNewDerivedEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4080"></span><span class="hs-comment">-- Create new equality Derived and put it in the work list</span><span>
</span><span id="line-4081"></span><span class="hs-comment">-- There's no caching, no lookupInInerts</span><span>
</span><span id="line-4082"></span><span id="emitNewDerivedEq"><span class="annot"><span class="annottext">emitNewDerivedEq :: CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitNewDerivedEq"><span class="hs-identifier hs-var hs-var">emitNewDerivedEq</span></a></span></span><span> </span><span id="local-6989586621681331986"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331986"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681331985"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681331985"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681331984"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331984"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681331983"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331983"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-4083"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331982"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331982"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newDerivedNC"><span class="hs-identifier hs-var">newDerivedNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331986"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681331985"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331984"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331983"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4084"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Emitting new derived equality&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331982"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; SDoc
</span><a href="GHC.Tc.Types.Constraint.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331986"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4085"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(WorkList -&gt; WorkList) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updWorkListTcS"><span class="hs-identifier hs-var">updWorkListTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.Monad.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331982"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4086"></span><span>         </span><span class="hs-comment">-- Very important: put in the wl_eqs</span><span>
</span><span id="line-4087"></span><span>         </span><span class="hs-comment">-- See Note [Prioritise equalities] (Avoiding fundep iteration)</span><span>
</span><span id="line-4088"></span><span>
</span><span id="line-4089"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#newDerivedNC"><span class="hs-identifier hs-type">newDerivedNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-4090"></span><span id="newDerivedNC"><span class="annot"><span class="annottext">newDerivedNC :: CtLoc -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newDerivedNC"><span class="hs-identifier hs-var hs-var">newDerivedNC</span></a></span></span><span> </span><span id="local-6989586621681331981"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331981"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681331980"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331980"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-4091"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtDerived"><span class="hs-identifier hs-type">CtDerived</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331980"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331981"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4092"></span><span>
</span><span id="line-4093"></span><span class="hs-comment">-- --------- Check done in GHC.Tc.Solver.Interact.selectNewWorkItem???? ---------</span><span>
</span><span id="line-4094"></span><span class="hs-comment">-- | Checks if the depth of the given location is too much. Fails if</span><span>
</span><span id="line-4095"></span><span class="hs-comment">-- it's too big, with an appropriate error message.</span><span>
</span><span id="line-4096"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#checkReductionDepth"><span class="hs-identifier hs-type">checkReductionDepth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>   </span><span class="hs-comment">-- ^ type being reduced</span><span>
</span><span id="line-4097"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4098"></span><span id="checkReductionDepth"><span class="annot"><span class="annottext">checkReductionDepth :: CtLoc -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#checkReductionDepth"><span class="hs-identifier hs-var hs-var">checkReductionDepth</span></a></span></span><span> </span><span id="local-6989586621681331979"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331979"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681331978"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331978"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-4099"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331977"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681331977"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-4100"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SubGoalDepth -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#subGoalDepthExceeded"><span class="hs-identifier hs-var">subGoalDepthExceeded</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681331977"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; SubGoalDepth
</span><a href="GHC.Tc.Types.Constraint.html#ctLocDepth"><span class="hs-identifier hs-var">ctLocDepth</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331979"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4101"></span><span>         </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapErrTcS"><span class="hs-identifier hs-var">wrapErrTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4102"></span><span>         </span><span class="annot"><span class="annottext">forall a. CtLoc -&gt; Type -&gt; TcM a
</span><a href="GHC.Tc.Errors.html#solverDepthErrorTcS"><span class="hs-identifier hs-var">solverDepthErrorTcS</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331979"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331978"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4103"></span><span>
</span><span id="line-4104"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFam"><span class="hs-identifier hs-type">matchFam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4105"></span><span class="hs-comment">-- Given (F tys) return (ty, co), where co :: ty ~N F tys</span><span>
</span><span id="line-4106"></span><span id="matchFam"><span class="annot"><span class="annottext">matchFam :: TyCon -&gt; [Type] -&gt; TcS (Maybe (Coercion, Type))
</span><a href="GHC.Tc.Solver.Monad.html#matchFam"><span class="hs-identifier hs-var hs-var">matchFam</span></a></span></span><span> </span><span id="local-6989586621681331974"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331974"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681331973"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331973"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (b, d) (c, d)
</span><a href="../../base-4.16.3.0/src/Control-Arrow.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TcM (Maybe (Coercion, Type))
</span><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier hs-var">matchFamTcM</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331974"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331973"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-4107"></span><span>
</span><span id="line-4108"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier hs-type">matchFamTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4109"></span><span class="hs-comment">-- Given (F tys) return (ty, co), where co :: F tys ~N ty</span><span>
</span><span id="line-4110"></span><span id="matchFamTcM"><span class="annot"><span class="annottext">matchFamTcM :: TyCon -&gt; [Type] -&gt; TcM (Maybe (Coercion, Type))
</span><a href="GHC.Tc.Solver.Monad.html#matchFamTcM"><span class="hs-identifier hs-var hs-var">matchFamTcM</span></a></span></span><span> </span><span id="local-6989586621681331971"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331971"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681331970"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331970"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-4111"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331969"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621681331969"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (FamInstEnv, FamInstEnv)
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">FamInst.tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-4112"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681331968"><span class="annot"><span class="annottext">match_fam_result :: Maybe (Coercion, Type)
</span><a href="#local-6989586621681331968"><span class="hs-identifier hs-var hs-var">match_fam_result</span></a></span></span><span>
</span><span id="line-4113"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
-&gt; Role -&gt; TyCon -&gt; [Type] -&gt; Maybe (Coercion, Type)
</span><a href="GHC.Core.FamInstEnv.html#reduceTyFamApp_maybe"><span class="hs-identifier hs-var">reduceTyFamApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621681331969"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331971"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331970"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-4114"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">TcM.traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchFamTcM&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4115"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Matching:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331971"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331970"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4116"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall {a} {a}.
(Outputable a, Outputable a) =&gt;
Maybe (a, a) -&gt; SDoc
</span><a href="#local-6989586621681331965"><span class="hs-identifier hs-var">ppr_res</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion, Type)
</span><a href="#local-6989586621681331968"><span class="hs-identifier hs-var">match_fam_result</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4117"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Coercion, Type)
</span><a href="#local-6989586621681331968"><span class="hs-identifier hs-var">match_fam_result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4119"></span><span>    </span><span id="local-6989586621681331965"><span class="annot"><span class="annottext">ppr_res :: Maybe (a, a) -&gt; SDoc
</span><a href="#local-6989586621681331965"><span class="hs-identifier hs-var hs-var">ppr_res</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (a, a)
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Match failed&quot;</span></span><span>
</span><span id="line-4120"></span><span>    </span><span class="annot"><a href="#local-6989586621681331965"><span class="hs-identifier hs-var">ppr_res</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331960"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681331960"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681331959"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681331959"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Match succeeded:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4121"></span><span>                                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Rewrites to:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681331959"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4122"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Coercion:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681331960"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4123"></span><span>
</span><span id="line-4124"></span><span class="hs-comment">{-
Note [Residual implications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The wl_implics in the WorkList are the residual implication
constraints that are generated while solving or canonicalising the
current worklist.  Specifically, when canonicalising
   (forall a. t1 ~ forall a. t2)
from which we get the implication
   (forall a. t1 ~ t2)
See GHC.Tc.Solver.Monad.deferTcSForAllEq
-}</span><span>
</span><span id="line-4135"></span><span>
</span><span id="line-4136"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Breaking type equality cycles
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-4143"></span><span>
</span><span id="line-4144"></span><span class="hs-comment">-- | Conditionally replace all type family applications in the RHS with fresh</span><span>
</span><span id="line-4145"></span><span class="hs-comment">-- variables, emitting givens that relate the type family application to the</span><span>
</span><span id="line-4146"></span><span class="hs-comment">-- variable. See Note [Type equality cycles] in GHC.Tc.Solver.Canonical.</span><span>
</span><span id="line-4147"></span><span class="hs-comment">-- This only works under conditions as described in the Note; otherwise, returns</span><span>
</span><span id="line-4148"></span><span class="hs-comment">-- Nothing.</span><span>
</span><span id="line-4149"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#breakTyEqCycle_maybe"><span class="hs-identifier hs-type">breakTyEqCycle_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-4150"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CheckTyEqResult"><span class="hs-identifier hs-type">CheckTyEqResult</span></a></span><span>   </span><span class="hs-comment">-- result of checkTypeEq</span><span>
</span><span id="line-4151"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>
</span><span id="line-4152"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>     </span><span class="hs-comment">-- RHS</span><span>
</span><span id="line-4153"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4154"></span><span>                         </span><span class="hs-comment">-- new RHS that doesn't have any type families</span><span>
</span><span id="line-4155"></span><span>                         </span><span class="hs-comment">-- co :: new type ~N old type</span><span>
</span><span id="line-4156"></span><span>                         </span><span class="hs-comment">-- TcTyVar is the LHS tv; convenient for the caller</span><span>
</span><span id="line-4157"></span><span id="breakTyEqCycle_maybe"><span class="annot"><span class="annottext">breakTyEqCycle_maybe :: CtEvidence
-&gt; CheckTyEqResult
-&gt; CanEqLHS
-&gt; Type
-&gt; TcS (Maybe (Coercion, Type))
</span><a href="GHC.Tc.Solver.Monad.html#breakTyEqCycle_maybe"><span class="hs-identifier hs-var hs-var">breakTyEqCycle_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CycleBreakerOrigin"><span class="hs-identifier hs-type">CycleBreakerOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-4158"></span><span>  </span><span class="hs-comment">-- see Detail (7) of Note</span><span>
</span><span id="line-4159"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4160"></span><span>
</span><span id="line-4161"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#breakTyEqCycle_maybe"><span class="hs-identifier hs-var">breakTyEqCycle_maybe</span></a></span><span> </span><span id="local-6989586621681331957"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331957"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621681331956"><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621681331956"><span class="hs-identifier hs-var">cte_result</span></a></span></span><span> </span><span id="local-6989586621681331955"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681331955"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621681331954"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331954"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-4162"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621681331953"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-4163"></span><span>
</span><span id="line-4164"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621681331956"><span class="hs-identifier hs-var">cte_result</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; CheckTyEqProblem -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cterHasOnlyProblem"><span class="hs-operator hs-var">`cterHasOnlyProblem`</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteSolubleOccurs"><span class="hs-identifier hs-var">cteSolubleOccurs</span></a></span><span>
</span><span id="line-4165"></span><span>     </span><span class="hs-comment">-- only do this if the only problem is a soluble occurs-check</span><span>
</span><span id="line-4166"></span><span>     </span><span class="hs-comment">-- See Detail (8) of the Note.</span><span>
</span><span id="line-4167"></span><span>
</span><span id="line-4168"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331950"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681331950"><span class="hs-identifier hs-var">should_break</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS Bool
</span><a href="#local-6989586621681331949"><span class="hs-identifier hs-var">final_check</span></a></span><span>
</span><span id="line-4169"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681331950"><span class="hs-identifier hs-var">should_break</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331948"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331948"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331947"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331947"><span class="hs-identifier hs-var">new_rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331954"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-4170"></span><span>                                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331948"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331947"><span class="hs-identifier hs-var">new_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4171"></span><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4172"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4173"></span><span>    </span><span id="local-6989586621681331945"><span class="annot"><span class="annottext">flavour :: CtFlavour
</span><a href="#local-6989586621681331945"><span class="hs-identifier hs-var hs-var">flavour</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331957"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-4174"></span><span>    </span><span id="local-6989586621681331953"><span class="annot"><span class="annottext">eq_rel :: EqRel
</span><a href="#local-6989586621681331953"><span class="hs-identifier hs-var hs-var">eq_rel</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#ctEvEqRel"><span class="hs-identifier hs-var">ctEvEqRel</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331957"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-4175"></span><span>
</span><span id="line-4176"></span><span>    </span><span id="local-6989586621681331949"><span class="annot"><span class="annottext">final_check :: TcS Bool
</span><a href="#local-6989586621681331949"><span class="hs-identifier hs-var hs-var">final_check</span></a></span></span><span>
</span><span id="line-4177"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="#local-6989586621681331945"><span class="hs-identifier hs-var">flavour</span></a></span><span>
</span><span id="line-4178"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-4179"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtFlavour -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#ctFlavourContainsDerived"><span class="hs-identifier hs-var">ctFlavourContainsDerived</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="#local-6989586621681331945"><span class="hs-identifier hs-var">flavour</span></a></span><span>
</span><span id="line-4180"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621681331943"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681331943"><span class="hs-identifier hs-var">lhs_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621681331955"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-4181"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331942"><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="#local-6989586621681331942"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtFlavour -&gt; TcTyVar -&gt; Type -&gt; TcS TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#touchabilityTest"><span class="hs-identifier hs-var">touchabilityTest</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Derived"><span class="hs-identifier hs-var">Derived</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681331943"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331954"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-4182"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="#local-6989586621681331942"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4183"></span><span>               </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#Untouchable"><span class="hs-identifier hs-var">Untouchable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4184"></span><span>               </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4185"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-4186"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4187"></span><span>
</span><span id="line-4188"></span><span>    </span><span class="hs-comment">-- This could be considerably more efficient. See Detail (5) of Note.</span><span>
</span><span id="line-4189"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4190"></span><span>    </span><span id="local-6989586621681331946"><span class="annot"><span class="annottext">go :: Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681331940"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331940"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681331939"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331939"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Tc.Solver.Monad.html#rewriterView"><span class="hs-identifier hs-var">rewriterView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331940"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331939"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-4191"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">Rep.TyConApp</span></a></span><span> </span><span id="local-6989586621681331938"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331938"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681331937"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331937"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4192"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331938"><span class="hs-identifier hs-var">tc</span></a></span><span>  </span><span class="hs-comment">-- worried about whether this type family is not actually</span><span>
</span><span id="line-4193"></span><span>                              </span><span class="hs-comment">-- causing trouble? See Detail (5) of Note.</span><span>
</span><span id="line-4194"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331935"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331935"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331934"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331934"><span class="hs-identifier hs-var">extra_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/GHC-List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331938"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331937"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-4195"></span><span>                 </span><span id="local-6989586621681331931"><span class="annot"><span class="annottext">fun_app :: Type
</span><a href="#local-6989586621681331931"><span class="hs-identifier hs-var hs-var">fun_app</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331938"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331935"><span class="hs-identifier hs-var">fun_args</span></a></span><span>
</span><span id="line-4196"></span><span>                 </span><span id="local-6989586621681331930"><span class="annot"><span class="annottext">fun_app_kind :: Type
</span><a href="#local-6989586621681331930"><span class="hs-identifier hs-var hs-var">fun_app_kind</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331931"><span class="hs-identifier hs-var">fun_app</span></a></span><span>
</span><span id="line-4197"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331928"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331928"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331927"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331927"><span class="hs-identifier hs-var">new_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331926"><span class="hs-identifier hs-var">emit_work</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331930"><span class="hs-identifier hs-var">fun_app_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331931"><span class="hs-identifier hs-var">fun_app</span></a></span><span>
</span><span id="line-4198"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331925"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681331925"><span class="hs-identifier hs-var">extra_args_cos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331924"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331924"><span class="hs-identifier hs-var">extra_args'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331934"><span class="hs-identifier hs-var">extra_args</span></a></span><span>
</span><span id="line-4199"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331928"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681331925"><span class="hs-identifier hs-var">extra_args_cos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331927"><span class="hs-identifier hs-var">new_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331924"><span class="hs-identifier hs-var">extra_args'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4200"></span><span>              </span><span class="hs-comment">-- Worried that this substitution will change kinds?</span><span>
</span><span id="line-4201"></span><span>              </span><span class="hs-comment">-- See Detail (3) of Note</span><span>
</span><span id="line-4202"></span><span>
</span><span id="line-4203"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-4204"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331920"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681331920"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331919"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331919"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331937"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-4205"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331938"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681331920"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331938"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681331919"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4206"></span><span>
</span><span id="line-4207"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">Rep.AppTy</span></a></span><span> </span><span id="local-6989586621681331917"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331917"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681331916"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331916"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4208"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331915"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331915"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331914"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331914"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331917"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-4209"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331913"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331913"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331912"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331912"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331916"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-4210"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331915"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331913"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331914"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331912"><span class="hs-identifier hs-var">ty2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4211"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">Rep.FunTy</span></a></span><span> </span><span id="local-6989586621681331909"><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681331909"><span class="hs-identifier hs-var">vis</span></a></span></span><span> </span><span id="local-6989586621681331908"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331908"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681331907"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331907"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681331906"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331906"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4212"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331905"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331905"><span class="hs-identifier hs-var">co_w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331904"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331904"><span class="hs-identifier hs-var">w'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331908"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-4213"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331903"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331903"><span class="hs-identifier hs-var">co_arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331902"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331902"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331907"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-4214"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331901"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331901"><span class="hs-identifier hs-var">co_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331900"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331900"><span class="hs-identifier hs-var">res'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331906"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-4215"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331905"><span class="hs-identifier hs-var">co_w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331903"><span class="hs-identifier hs-var">co_arg</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331901"><span class="hs-identifier hs-var">co_res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnonArgFlag -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681331909"><span class="hs-identifier hs-var">vis</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331904"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331902"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331900"><span class="hs-identifier hs-var">res'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4216"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">Rep.CastTy</span></a></span><span> </span><span id="local-6989586621681331897"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331897"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681331896"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331896"><span class="hs-identifier hs-var">cast_co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4217"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681331895"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331895"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681331894"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331894"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331897"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4218"></span><span>             </span><span class="hs-comment">-- co :: ty' ~N ty</span><span>
</span><span id="line-4219"></span><span>             </span><span class="hs-comment">-- return_co :: (ty' |&gt; cast_co) ~ (ty |&gt; cast_co)</span><span>
</span><span id="line-4220"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier hs-var">castCoercionKind1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331895"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331894"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331897"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331896"><span class="hs-identifier hs-var">cast_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331894"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331896"><span class="hs-identifier hs-var">cast_co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4221"></span><span>
</span><span id="line-4222"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681331891"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681331891"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">Rep.TyVarTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *}. Monad m =&gt; Type -&gt; m (Coercion, Type)
</span><a href="#local-6989586621681331890"><span class="hs-identifier hs-var">skip</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331891"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4223"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681331889"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681331889"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">Rep.LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *}. Monad m =&gt; Type -&gt; m (Coercion, Type)
</span><a href="#local-6989586621681331890"><span class="hs-identifier hs-var">skip</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331889"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4224"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681331888"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681331888"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">Rep.ForAllTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *}. Monad m =&gt; Type -&gt; m (Coercion, Type)
</span><a href="#local-6989586621681331890"><span class="hs-identifier hs-var">skip</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331888"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-comment">-- See Detail (1) of Note</span><span>
</span><span id="line-4225"></span><span>    </span><span class="annot"><a href="#local-6989586621681331946"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681331887"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681331887"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">Rep.CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *}. Monad m =&gt; Type -&gt; m (Coercion, Type)
</span><a href="#local-6989586621681331890"><span class="hs-identifier hs-var">skip</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331887"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-comment">-- See Detail (2) of Note</span><span>
</span><span id="line-4226"></span><span>
</span><span id="line-4227"></span><span>    </span><span id="local-6989586621681331890"><span class="annot"><span class="annottext">skip :: Type -&gt; m (Coercion, Type)
</span><a href="#local-6989586621681331890"><span class="hs-identifier hs-var hs-var">skip</span></a></span></span><span> </span><span id="local-6989586621681331884"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331884"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331884"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331884"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4228"></span><span>
</span><span id="line-4229"></span><span>    </span><span class="annot"><a href="#local-6989586621681331926"><span class="hs-identifier hs-type">emit_work</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>                   </span><span class="hs-comment">-- of the function application</span><span>
</span><span id="line-4230"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>                   </span><span class="hs-comment">-- original function application</span><span>
</span><span id="line-4231"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- rewritten type (the fresh tyvar)</span><span>
</span><span id="line-4232"></span><span>    </span><span id="local-6989586621681331926"><span class="annot"><span class="annottext">emit_work :: Type -&gt; Type -&gt; TcS (Coercion, Type)
</span><a href="#local-6989586621681331926"><span class="hs-identifier hs-var hs-var">emit_work</span></a></span></span><span> </span><span id="local-6989586621681331881"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331881"><span class="hs-identifier hs-var">fun_app_kind</span></a></span></span><span> </span><span id="local-6989586621681331880"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331880"><span class="hs-identifier hs-var">fun_app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="#local-6989586621681331945"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4233"></span><span>      </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4234"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331879"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681331879"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newCycleBreakerTyVar"><span class="hs-identifier hs-var">TcM.newCycleBreakerTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331881"><span class="hs-identifier hs-var">fun_app_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4235"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681331877"><span class="annot"><span class="annottext">new_ty :: Type
</span><a href="#local-6989586621681331877"><span class="hs-identifier hs-var hs-var">new_ty</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681331879"><span class="hs-identifier hs-var">new_tv</span></a></span><span>
</span><span id="line-4236"></span><span>                 </span><span id="local-6989586621681331876"><span class="annot"><span class="annottext">given_pred :: Type
</span><a href="#local-6989586621681331876"><span class="hs-identifier hs-var hs-var">given_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkHeteroPrimEqPred"><span class="hs-identifier hs-var">mkHeteroPrimEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331881"><span class="hs-identifier hs-var">fun_app_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331881"><span class="hs-identifier hs-var">fun_app_kind</span></a></span><span>
</span><span id="line-4237"></span><span>                                                 </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331880"><span class="hs-identifier hs-var">fun_app</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331877"><span class="hs-identifier hs-var">new_ty</span></a></span><span>
</span><span id="line-4238"></span><span>                 </span><span id="local-6989586621681331874"><span class="annot"><span class="annottext">given_term :: EvTerm
</span><a href="#local-6989586621681331874"><span class="hs-identifier hs-var hs-var">given_term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331877"><span class="hs-identifier hs-var">new_ty</span></a></span><span>  </span><span class="hs-comment">-- See Detail (4) of Note</span><span>
</span><span id="line-4239"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681331872"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331872"><span class="hs-identifier hs-var">new_given</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331871"><span class="hs-identifier hs-var">new_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331876"><span class="hs-identifier hs-var">given_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621681331874"><span class="hs-identifier hs-var">given_term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4240"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;breakTyEqCycle replacing type family in Given&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331872"><span class="hs-identifier hs-var">new_given</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4241"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[CtEvidence] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-var">emitWorkNC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331872"><span class="hs-identifier hs-var">new_given</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4242"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#updInertTcS"><span class="hs-identifier hs-var">updInertTcS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681331870"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681331870"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4243"></span><span>               </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681331870"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cycle_breakers :: CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; CycleBreakerVarStack -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#insertCycleBreakerBinding"><span class="hs-identifier hs-var">insertCycleBreakerBinding</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681331879"><span class="hs-identifier hs-var">new_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331880"><span class="hs-identifier hs-var">fun_app</span></a></span><span>
</span><span id="line-4244"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681331870"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4245"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331877"><span class="hs-identifier hs-var">new_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331877"><span class="hs-identifier hs-var">new_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4246"></span><span>                </span><span class="hs-comment">-- Why reflexive? See Detail (4) of the Note</span><span>
</span><span id="line-4247"></span><span>
</span><span id="line-4248"></span><span>      </span><span id="local-6989586621681331869"><span class="annot"><span class="annottext">CtFlavour
</span><a href="#local-6989586621681331869"><span class="hs-identifier hs-var">_derived_or_wd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4249"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681331868"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681331868"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#wrapTcS"><span class="hs-identifier hs-var">wrapTcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM TcTyVar
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVar"><span class="hs-identifier hs-var">TcM.newFlexiTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331881"><span class="hs-identifier hs-var">fun_app_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4250"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681331866"><span class="annot"><span class="annottext">new_ty :: Type
</span><a href="#local-6989586621681331866"><span class="hs-identifier hs-var hs-var">new_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621681331868"><span class="hs-identifier hs-var">new_tv</span></a></span><span>
</span><span id="line-4251"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681331865"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331865"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS Coercion
</span><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier hs-var">emitNewWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681331871"><span class="hs-identifier hs-var">new_loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331866"><span class="hs-identifier hs-var">new_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331880"><span class="hs-identifier hs-var">fun_app</span></a></span><span>
</span><span id="line-4252"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681331865"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331866"><span class="hs-identifier hs-var">new_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4253"></span><span>
</span><span id="line-4254"></span><span>      </span><span class="hs-comment">-- See Detail (7) of the Note</span><span>
</span><span id="line-4255"></span><span>    </span><span id="local-6989586621681331871"><span class="annot"><span class="annottext">new_loc :: CtLoc
</span><a href="#local-6989586621681331871"><span class="hs-identifier hs-var hs-var">new_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (CtOrigin -&gt; CtOrigin) -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#updateCtLocOrigin"><span class="hs-identifier hs-var">updateCtLocOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621681331957"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#CycleBreakerOrigin"><span class="hs-identifier hs-var">CycleBreakerOrigin</span></a></span><span>
</span><span id="line-4256"></span><span>
</span><span id="line-4257"></span><span class="hs-comment">-- does not fit scenario from Note</span><span>
</span><span id="line-4258"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#breakTyEqCycle_maybe"><span class="hs-identifier hs-var">breakTyEqCycle_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4259"></span><span>
</span><span id="line-4260"></span><span class="hs-comment">-- | Fill in CycleBreakerTvs with the variables they stand for.</span><span>
</span><span id="line-4261"></span><span class="hs-comment">-- See Note [Type equality cycles] in GHC.Tc.Solver.Canonical.</span><span>
</span><span id="line-4262"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-type">restoreTyVarCycles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4263"></span><span id="restoreTyVarCycles"><span class="annot"><span class="annottext">restoreTyVarCycles :: InertSet -&gt; TcM ()
</span><a href="GHC.Tc.Solver.Monad.html#restoreTyVarCycles"><span class="hs-identifier hs-var hs-var">restoreTyVarCycles</span></a></span></span><span> </span><span id="local-6989586621681331863"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681331863"><span class="hs-identifier hs-var">is</span></a></span></span><span>
</span><span id="line-4264"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
CycleBreakerVarStack -&gt; (TcTyVar -&gt; Type -&gt; m ()) -&gt; m ()
</span><a href="GHC.Tc.Solver.Monad.html#forAllCycleBreakerBindings_"><span class="hs-identifier hs-var">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.Monad.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681331863"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; TcM ()
</span><a href="GHC.Tc.Utils.TcMType.html#writeMetaTyVar"><span class="hs-identifier hs-var">TcM.writeMetaTyVar</span></a></span><span>
</span><span id="line-4265"></span><span class="hs-pragma">{-# SPECIALISE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#forAllCycleBreakerBindings_"><span class="hs-pragma hs-type">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-pragma">::</span><span>
</span><span id="line-4266"></span><span>      </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#CycleBreakerVarStack"><span class="hs-pragma hs-type">CycleBreakerVarStack</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-pragma hs-type">TcTyVar</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-pragma hs-type">TcType</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-pragma hs-type">TcM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-pragma hs-type">TcM</span></a></span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-4267"></span><span>
</span><span id="line-4268"></span><span class="hs-comment">-- Unwrap a type synonym only when either:</span><span>
</span><span id="line-4269"></span><span class="hs-comment">--   The type synonym is forgetful, or</span><span>
</span><span id="line-4270"></span><span class="hs-comment">--   the type synonym mentions a type family in its expansion</span><span>
</span><span id="line-4271"></span><span class="hs-comment">-- See Note [Rewriting synonyms] in GHC.Tc.Solver.Rewrite.</span><span>
</span><span id="line-4272"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#rewriterView"><span class="hs-identifier hs-type">rewriterView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-4273"></span><span id="rewriterView"><span class="annot"><span class="annottext">rewriterView :: Type -&gt; Maybe Type
</span><a href="GHC.Tc.Solver.Monad.html#rewriterView"><span class="hs-identifier hs-var hs-var">rewriterView</span></a></span></span><span> </span><span id="local-6989586621681331862"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681331862"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">Rep.TyConApp</span></a></span><span> </span><span id="local-6989586621681331861"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331861"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-4274"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isForgetfulSynTyCon"><span class="hs-identifier hs-var">isForgetfulSynTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331861"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeSynonymTyCon"><span class="hs-identifier hs-var">isTypeSynonymTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331861"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFamFreeTyCon"><span class="hs-identifier hs-var">isFamFreeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681331861"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4275"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331862"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4276"></span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#rewriterView"><span class="hs-identifier hs-var">rewriterView</span></a></span><span> </span><span id="local-6989586621681331856"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681331856"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4277"></span></pre></body></html>
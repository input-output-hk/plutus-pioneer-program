<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | Temporary file-system management</span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Utils.TmpFs</span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier">TmpFs</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#initTmpFs"><span class="hs-identifier">initTmpFs</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#forkTmpFsFrom"><span class="hs-identifier">forkTmpFsFrom</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#mergeTmpFsInto"><span class="hs-identifier">mergeTmpFsInto</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier">FilesToClean</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#emptyFilesToClean"><span class="hs-identifier">emptyFilesToClean</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier">TempFileLifetime</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#cleanTempDirs"><span class="hs-identifier">cleanTempDirs</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#cleanTempFiles"><span class="hs-identifier">cleanTempFiles</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#cleanCurrentModuleTempFiles"><span class="hs-identifier">cleanCurrentModuleTempFiles</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#addFilesToClean"><span class="hs-identifier">addFilesToClean</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#changeTempFilesLifetime"><span class="hs-identifier">changeTempFilesLifetime</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier">newTempName</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempLibName"><span class="hs-identifier">newTempLibName</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempDir"><span class="hs-identifier">newTempDir</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#withSystemTempDirectory"><span class="hs-identifier">withSystemTempDirectory</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#withTempDirectory"><span class="hs-identifier">withTempDirectory</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Exception</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html"><span class="hs-identifier">GHC.Driver.Phases</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-List.html#"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Set.html#"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Set.html#"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/Data-IORef.html#"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.6.2/src/System-Directory.html#"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath-1.4.2.2/src/System-FilePath.html#"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/System-IO-Error.html#"><span class="hs-identifier">System.IO.Error</span></a></span><span class="hs-cpp">

#if !defined(mingw32_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/System-Posix-Internals.html#"><span class="hs-identifier">System.Posix.Internals</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- | Temporary file-system</span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="TmpFs"><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-var">TmpFs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TmpFs"><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-var">TmpFs</span></a></span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tmp_dirs_to_clean"><span class="annot"><span class="annottext">TmpFs -&gt; IORef (Map String String)
</span><a href="GHC.Utils.TmpFs.html#tmp_dirs_to_clean"><span class="hs-identifier hs-var hs-var">tmp_dirs_to_clean</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>      </span><span class="hs-comment">-- ^ Maps system temporary directory (passed via settings or DynFlags) to</span><span>
</span><span id="line-54"></span><span>      </span><span class="hs-comment">-- an actual temporary directory for this process.</span><span>
</span><span id="line-55"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-56"></span><span>      </span><span class="hs-comment">-- It's a Map probably to support changing the system temporary directory</span><span>
</span><span id="line-57"></span><span>      </span><span class="hs-comment">-- over time.</span><span>
</span><span id="line-58"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-59"></span><span>      </span><span class="hs-comment">-- Shared with forked TmpFs.</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tmp_next_suffix"><span class="annot"><span class="annottext">TmpFs -&gt; IORef Int
</span><a href="GHC.Utils.TmpFs.html#tmp_next_suffix"><span class="hs-identifier hs-var hs-var">tmp_next_suffix</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-comment">-- ^ The next available suffix to uniquely name a temp file, updated</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-comment">-- atomically.</span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-65"></span><span>      </span><span class="hs-comment">-- Shared with forked TmpFs.</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tmp_files_to_clean"><span class="annot"><span class="annottext">TmpFs -&gt; IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var hs-var">tmp_files_to_clean</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-68"></span><span>      </span><span class="hs-comment">-- ^ Files to clean (per session or per module)</span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span>      </span><span class="hs-comment">-- Not shared with forked TmpFs.</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- | A collection of files that must be deleted before ghc exits.</span><span>
</span><span id="line-74"></span><span class="hs-keyword">data</span><span> </span><span id="FilesToClean"><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-var">FilesToClean</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FilesToClean"><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-var">FilesToClean</span></a></span></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="ftcGhcSession"><span class="annot"><span class="annottext">FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var hs-var">ftcGhcSession</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-comment">-- ^ Files that will be deleted at the end of runGhc(T)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="ftcCurrentModule"><span class="annot"><span class="annottext">FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var hs-var">ftcCurrentModule</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-comment">-- ^ Files that will be deleted the next time</span><span>
</span><span id="line-80"></span><span>        </span><span class="hs-comment">-- 'cleanCurrentModuleTempFiles' is called, or otherwise at the end of</span><span>
</span><span id="line-81"></span><span>        </span><span class="hs-comment">-- the session.</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Used when a temp file is created. This determines which component Set of</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- FilesToClean will get the temp file</span><span>
</span><span id="line-86"></span><span class="hs-keyword">data</span><span> </span><span id="TempFileLifetime"><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier hs-var">TempFileLifetime</span></a></span></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TFL_CurrentModule"><span class="annot"><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-comment">-- ^ A file with lifetime TFL_CurrentModule will be cleaned up at the</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- end of upweep_mod</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TFL_GhcSession"><span class="annot"><a href="GHC.Utils.TmpFs.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-comment">-- ^ A file with lifetime TFL_GhcSession will be cleaned up at the end of</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- runGhc(T)</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681140854"><span id="local-6989586621681140856"><span id="local-6989586621681140858"><span class="annot"><span class="annottext">Int -&gt; TempFileLifetime -&gt; ShowS
[TempFileLifetime] -&gt; ShowS
TempFileLifetime -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TempFileLifetime] -&gt; ShowS
$cshowList :: [TempFileLifetime] -&gt; ShowS
show :: TempFileLifetime -&gt; String
$cshow :: TempFileLifetime -&gt; String
showsPrec :: Int -&gt; TempFileLifetime -&gt; ShowS
$cshowsPrec :: Int -&gt; TempFileLifetime -&gt; ShowS
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | An empty FilesToClean</span><span>
</span><span id="line-97"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#emptyFilesToClean"><span class="hs-identifier hs-type">emptyFilesToClean</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-98"></span><span id="emptyFilesToClean"><span class="annot"><span class="annottext">emptyFilesToClean :: FilesToClean
</span><a href="GHC.Utils.TmpFs.html#emptyFilesToClean"><span class="hs-identifier hs-var hs-var">emptyFilesToClean</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set String -&gt; Set String -&gt; FilesToClean
</span><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-var">FilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Merge two FilesToClean</span><span>
</span><span id="line-101"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#mergeFilesToClean"><span class="hs-identifier hs-type">mergeFilesToClean</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-102"></span><span id="mergeFilesToClean"><span class="annot"><span class="annottext">mergeFilesToClean :: FilesToClean -&gt; FilesToClean -&gt; FilesToClean
</span><a href="GHC.Utils.TmpFs.html#mergeFilesToClean"><span class="hs-identifier hs-var hs-var">mergeFilesToClean</span></a></span></span><span> </span><span id="local-6989586621681140850"><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140850"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681140849"><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140849"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftcGhcSession :: Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140850"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140849"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftcCurrentModule :: Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140850"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140849"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Initialise an empty TmpFs</span><span>
</span><span id="line-108"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#initTmpFs"><span class="hs-identifier hs-type">initTmpFs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-109"></span><span id="initTmpFs"><span class="annot"><span class="annottext">initTmpFs :: IO TmpFs
</span><a href="GHC.Utils.TmpFs.html#initTmpFs"><span class="hs-identifier hs-var hs-var">initTmpFs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621681140847"><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681140847"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="GHC.Utils.TmpFs.html#emptyFilesToClean"><span class="hs-identifier hs-var">emptyFilesToClean</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621681140845"><span class="annot"><span class="annottext">IORef (Map String String)
</span><a href="#local-6989586621681140845"><span class="hs-identifier hs-var">dirs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621681140843"><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681140843"><span class="hs-identifier hs-var">next</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tmp_files_to_clean :: IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681140847"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tmp_dirs_to_clean :: IORef (Map String String)
</span><a href="GHC.Utils.TmpFs.html#tmp_dirs_to_clean"><span class="hs-identifier hs-var">tmp_dirs_to_clean</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Map String String)
</span><a href="#local-6989586621681140845"><span class="hs-identifier hs-var">dirs</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tmp_next_suffix :: IORef Int
</span><a href="GHC.Utils.TmpFs.html#tmp_next_suffix"><span class="hs-identifier hs-var">tmp_next_suffix</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Int
</span><a href="#local-6989586621681140843"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | Initialise an empty TmpFs sharing unique numbers and per-process temporary</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- directories with the given TmpFs</span><span>
</span><span id="line-121"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#forkTmpFsFrom"><span class="hs-identifier hs-type">forkTmpFsFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-122"></span><span id="forkTmpFsFrom"><span class="annot"><span class="annottext">forkTmpFsFrom :: TmpFs -&gt; IO TmpFs
</span><a href="GHC.Utils.TmpFs.html#forkTmpFsFrom"><span class="hs-identifier hs-var hs-var">forkTmpFsFrom</span></a></span></span><span> </span><span id="local-6989586621681140842"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140842"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621681140841"><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681140841"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="GHC.Utils.TmpFs.html#emptyFilesToClean"><span class="hs-identifier hs-var">emptyFilesToClean</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tmp_files_to_clean :: IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681140841"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tmp_dirs_to_clean :: IORef (Map String String)
</span><a href="GHC.Utils.TmpFs.html#tmp_dirs_to_clean"><span class="hs-identifier hs-var">tmp_dirs_to_clean</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IORef (Map String String)
</span><a href="GHC.Utils.TmpFs.html#tmp_dirs_to_clean"><span class="hs-identifier hs-var">tmp_dirs_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140842"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tmp_next_suffix :: IORef Int
</span><a href="GHC.Utils.TmpFs.html#tmp_next_suffix"><span class="hs-identifier hs-var">tmp_next_suffix</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IORef Int
</span><a href="GHC.Utils.TmpFs.html#tmp_next_suffix"><span class="hs-identifier hs-var">tmp_next_suffix</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140842"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | Merge the first TmpFs into the second.</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- The first TmpFs is returned emptied.</span><span>
</span><span id="line-133"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#mergeTmpFsInto"><span class="hs-identifier hs-type">mergeTmpFsInto</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span id="mergeTmpFsInto"><span class="annot"><span class="annottext">mergeTmpFsInto :: TmpFs -&gt; TmpFs -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#mergeTmpFsInto"><span class="hs-identifier hs-var hs-var">mergeTmpFsInto</span></a></span></span><span> </span><span id="local-6989586621681140840"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140840"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621681140839"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140839"><span class="hs-identifier hs-var">dst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621681140838"><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140838"><span class="hs-identifier hs-var">src_files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmpFs -&gt; IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140840"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681140836"><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140836"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilesToClean
</span><a href="GHC.Utils.TmpFs.html#emptyFilesToClean"><span class="hs-identifier hs-var">emptyFilesToClean</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140836"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmpFs -&gt; IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140839"><span class="hs-identifier hs-var">dst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681140835"><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140835"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilesToClean -&gt; FilesToClean -&gt; FilesToClean
</span><a href="GHC.Utils.TmpFs.html#mergeFilesToClean"><span class="hs-identifier hs-var">mergeFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140838"><span class="hs-identifier hs-var">src_files</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140835"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#cleanTempDirs"><span class="hs-identifier hs-type">cleanTempDirs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span id="cleanTempDirs"><span class="annot"><span class="annottext">cleanTempDirs :: Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#cleanTempDirs"><span class="hs-identifier hs-var hs-var">cleanTempDirs</span></a></span></span><span> </span><span id="local-6989586621681140834"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140834"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140833"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140833"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140832"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140832"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-140"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepTmpFiles"><span class="hs-identifier hs-var">Opt_KeepTmpFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140832"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a></span><span>
</span><span id="line-142"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140827"><span class="annot"><span class="annottext">ref :: IORef (Map String String)
</span><a href="#local-6989586621681140827"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IORef (Map String String)
</span><a href="GHC.Utils.TmpFs.html#tmp_dirs_to_clean"><span class="hs-identifier hs-var">tmp_dirs_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140833"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span id="local-6989586621681140826"><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140826"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Map String String)
</span><a href="#local-6989586621681140827"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681140825"><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140825"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140825"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeTmpDirs"><span class="hs-identifier hs-var">removeTmpDirs</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140834"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140832"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140826"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Delete all files in @tmp_files_to_clean@.</span><span>
</span><span id="line-147"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#cleanTempFiles"><span class="hs-identifier hs-type">cleanTempFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span id="cleanTempFiles"><span class="annot"><span class="annottext">cleanTempFiles :: Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#cleanTempFiles"><span class="hs-identifier hs-var hs-var">cleanTempFiles</span></a></span></span><span> </span><span id="local-6989586621681140822"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140822"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140821"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140821"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140820"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140820"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-149"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepTmpFiles"><span class="hs-identifier hs-var">Opt_KeepTmpFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140820"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a></span><span>
</span><span id="line-151"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140819"><span class="annot"><span class="annottext">ref :: IORef FilesToClean
</span><a href="#local-6989586621681140819"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140821"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-152"></span><span>        </span><span id="local-6989586621681140818"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140818"><span class="hs-identifier hs-var">to_delete</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681140819"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-153"></span><span>            </span><span class="hs-glyph">\</span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-154"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftcCurrentModule :: FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681140817"><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140817"><span class="hs-identifier hs-var">cm_files</span></a></span></span><span>
</span><span id="line-155"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftcGhcSession :: FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681140816"><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140816"><span class="hs-identifier hs-var">gs_files</span></a></span></span><span>
</span><span id="line-156"></span><span>                </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="GHC.Utils.TmpFs.html#emptyFilesToClean"><span class="hs-identifier hs-var">emptyFilesToClean</span></a></span><span>
</span><span id="line-157"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140817"><span class="hs-identifier hs-var">cm_files</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140816"><span class="hs-identifier hs-var">gs_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeTmpFiles"><span class="hs-identifier hs-var">removeTmpFiles</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140822"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140820"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140818"><span class="hs-identifier hs-var">to_delete</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Delete all files in @tmp_files_to_clean@. That have lifetime</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- TFL_CurrentModule.</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- If a file must be cleaned eventually, but must survive a</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- cleanCurrentModuleTempFiles, ensure it has lifetime TFL_GhcSession.</span><span>
</span><span id="line-164"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#cleanCurrentModuleTempFiles"><span class="hs-identifier hs-type">cleanCurrentModuleTempFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span id="cleanCurrentModuleTempFiles"><span class="annot"><span class="annottext">cleanCurrentModuleTempFiles :: Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#cleanCurrentModuleTempFiles"><span class="hs-identifier hs-var hs-var">cleanCurrentModuleTempFiles</span></a></span></span><span> </span><span id="local-6989586621681140813"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140813"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140812"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140812"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140811"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140811"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-166"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.3.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepTmpFiles"><span class="hs-identifier hs-var">Opt_KeepTmpFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140811"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a></span><span>
</span><span id="line-168"></span><span>   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140810"><span class="annot"><span class="annottext">ref :: IORef FilesToClean
</span><a href="#local-6989586621681140810"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140812"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span id="local-6989586621681140809"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140809"><span class="hs-identifier hs-var">to_delete</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681140810"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-170"></span><span>            </span><span class="hs-glyph">\</span><span id="local-6989586621681140808"><span class="annot"><span class="annottext">ftc :: FilesToClean
</span><a href="#local-6989586621681140808"><span class="hs-identifier hs-var">ftc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ftcCurrentModule :: FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681140807"><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140807"><span class="hs-identifier hs-var">cm_files</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilesToClean
</span><a href="#local-6989586621681140808"><span class="hs-identifier hs-var">ftc</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ftcCurrentModule :: Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140807"><span class="hs-identifier hs-var">cm_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeTmpFiles"><span class="hs-identifier hs-var">removeTmpFiles</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140813"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140811"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140809"><span class="hs-identifier hs-var">to_delete</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | Ensure that new_files are cleaned on the next call of</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- 'cleanTempFiles' or 'cleanCurrentModuleTempFiles', depending on lifetime.</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- If any of new_files are already tracked, they will have their lifetime</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- updated.</span><span>
</span><span id="line-178"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#addFilesToClean"><span class="hs-identifier hs-type">addFilesToClean</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="addFilesToClean"><span class="annot"><span class="annottext">addFilesToClean :: TmpFs -&gt; TempFileLifetime -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#addFilesToClean"><span class="hs-identifier hs-var hs-var">addFilesToClean</span></a></span></span><span> </span><span id="local-6989586621681140806"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140806"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140805"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140805"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span id="local-6989586621681140804"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140804"><span class="hs-identifier hs-var">new_files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><a href="../../base-4.16.3.0/src/Data-IORef.html#modifyIORef%27"><span class="hs-identifier hs-var">modifyIORef'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmpFs -&gt; IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140806"><span class="hs-identifier hs-var">tmpfs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">\</span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftcCurrentModule :: FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681140802"><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140802"><span class="hs-identifier hs-var">cm_files</span></a></span></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftcGhcSession :: FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681140801"><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140801"><span class="hs-identifier hs-var">gs_files</span></a></span></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140805"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftcCurrentModule :: Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140802"><span class="hs-identifier hs-var">cm_files</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140800"><span class="hs-identifier hs-var">new_files_set</span></a></span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftcGhcSession :: Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140801"><span class="hs-identifier hs-var">gs_files</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140800"><span class="hs-identifier hs-var">new_files_set</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftcCurrentModule :: Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140802"><span class="hs-identifier hs-var">cm_files</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140800"><span class="hs-identifier hs-var">new_files_set</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftcGhcSession :: Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140801"><span class="hs-identifier hs-var">gs_files</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140800"><span class="hs-identifier hs-var">new_files_set</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621681140800"><span class="annot"><span class="annottext">new_files_set :: Set String
</span><a href="#local-6989586621681140800"><span class="hs-identifier hs-var hs-var">new_files_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140804"><span class="hs-identifier hs-var">new_files</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">-- | Update the lifetime of files already being tracked. If any files are</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- not being tracked they will be discarded.</span><span>
</span><span id="line-197"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#changeTempFilesLifetime"><span class="hs-identifier hs-type">changeTempFilesLifetime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span id="changeTempFilesLifetime"><span class="annot"><span class="annottext">changeTempFilesLifetime :: TmpFs -&gt; TempFileLifetime -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#changeTempFilesLifetime"><span class="hs-identifier hs-var hs-var">changeTempFilesLifetime</span></a></span></span><span> </span><span id="local-6989586621681140797"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140797"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140796"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140796"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span id="local-6989586621681140795"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140795"><span class="hs-identifier hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="GHC.Utils.TmpFs.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftcCurrentModule :: FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681140794"><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140794"><span class="hs-identifier hs-var">cm_files</span></a></span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftcGhcSession :: FilesToClean -&gt; Set String
</span><a href="GHC.Utils.TmpFs.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681140793"><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140793"><span class="hs-identifier hs-var">gs_files</span></a></span></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmpFs -&gt; IORef FilesToClean
</span><a href="GHC.Utils.TmpFs.html#tmp_files_to_clean"><span class="hs-identifier hs-var">tmp_files_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140797"><span class="hs-identifier hs-var">tmpfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140791"><span class="annot"><span class="annottext">old_set :: Set String
</span><a href="#local-6989586621681140791"><span class="hs-identifier hs-var hs-var">old_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140796"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140793"><span class="hs-identifier hs-var">gs_files</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140794"><span class="hs-identifier hs-var">cm_files</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span id="local-6989586621681140790"><span class="annot"><span class="annottext">existing_files :: [String]
</span><a href="#local-6989586621681140790"><span class="hs-identifier hs-var hs-var">existing_files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140789"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681140789"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140789"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140795"><span class="hs-identifier hs-var">files</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140789"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.5.1/src/Data-Set-Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set String
</span><a href="#local-6989586621681140791"><span class="hs-identifier hs-var">old_set</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="annottext">TmpFs -&gt; TempFileLifetime -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140797"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140796"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140790"><span class="hs-identifier hs-var">existing_files</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- Return a unique numeric temp file suffix</span><span>
</span><span id="line-210"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempSuffix"><span class="hs-identifier hs-type">newTempSuffix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-211"></span><span id="newTempSuffix"><span class="annot"><span class="annottext">newTempSuffix :: TmpFs -&gt; IO Int
</span><a href="GHC.Utils.TmpFs.html#newTempSuffix"><span class="hs-identifier hs-var hs-var">newTempSuffix</span></a></span></span><span> </span><span id="local-6989586621681140786"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140786"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmpFs -&gt; IORef Int
</span><a href="GHC.Utils.TmpFs.html#tmp_next_suffix"><span class="hs-identifier hs-var">tmp_next_suffix</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140786"><span class="hs-identifier hs-var">tmpfs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681140785"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140785"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140785"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140785"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- Find a temporary name that doesn't already exist.</span><span>
</span><span id="line-215"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-type">newTempName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-216"></span><span id="newTempName"><span class="annot"><span class="annottext">newTempName :: Logger
-&gt; TmpFs -&gt; DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var hs-var">newTempName</span></a></span></span><span> </span><span id="local-6989586621681140782"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140782"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140781"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140781"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140780"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140780"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681140779"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140779"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span id="local-6989586621681140778"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140778"><span class="hs-identifier hs-var">extn</span></a></span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681140777"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140777"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#getTempDir"><span class="hs-identifier hs-var">getTempDir</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140782"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140781"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140780"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-218"></span><span>       </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621681140775"><span class="hs-identifier hs-var">findTempName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140777"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="../../filepath-1.4.2.2/src/System-FilePath-Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghc_&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See Note [Deterministic base name]</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="#local-6989586621681140775"><span class="hs-identifier hs-type">findTempName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621681140775"><span class="annot"><span class="annottext">findTempName :: String -&gt; IO String
</span><a href="#local-6989586621681140775"><span class="hs-identifier hs-var hs-var">findTempName</span></a></span></span><span> </span><span id="local-6989586621681140773"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140773"><span class="hs-identifier hs-var">prefix</span></a></span></span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681140772"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140772"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IO Int
</span><a href="GHC.Utils.TmpFs.html#newTempSuffix"><span class="hs-identifier hs-var">newTempSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140781"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-223"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140771"><span class="annot"><span class="annottext">filename :: String
</span><a href="#local-6989586621681140771"><span class="hs-identifier hs-var hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140773"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140772"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="../../filepath-1.4.2.2/src/System-FilePath-Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140778"><span class="hs-identifier hs-var">extn</span></a></span><span>
</span><span id="line-224"></span><span>           </span><span id="local-6989586621681140768"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681140768"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140771"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-225"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681140768"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621681140775"><span class="hs-identifier hs-var">findTempName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140773"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-226"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- clean it up later</span><span>
</span><span id="line-227"></span><span>                        </span><span class="annot"><span class="annottext">TmpFs -&gt; TempFileLifetime -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140781"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140779"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140771"><span class="hs-identifier hs-var">filename</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140771"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempDir"><span class="hs-identifier hs-type">newTempDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-231"></span><span id="newTempDir"><span class="annot"><span class="annottext">newTempDir :: Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempDir"><span class="hs-identifier hs-var hs-var">newTempDir</span></a></span></span><span> </span><span id="local-6989586621681140766"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140766"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140765"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140765"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140764"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140764"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681140763"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140763"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#getTempDir"><span class="hs-identifier hs-var">getTempDir</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140766"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140765"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140764"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-233"></span><span>       </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621681140762"><span class="hs-identifier hs-var">findTempDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140763"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="../../filepath-1.4.2.2/src/System-FilePath-Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghc_&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><a href="#local-6989586621681140762"><span class="hs-identifier hs-type">findTempDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621681140762"><span class="annot"><span class="annottext">findTempDir :: String -&gt; IO String
</span><a href="#local-6989586621681140762"><span class="hs-identifier hs-var hs-var">findTempDir</span></a></span></span><span> </span><span id="local-6989586621681140761"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140761"><span class="hs-identifier hs-var">prefix</span></a></span></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681140760"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140760"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IO Int
</span><a href="GHC.Utils.TmpFs.html#newTempSuffix"><span class="hs-identifier hs-var">newTempSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140765"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-238"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140759"><span class="annot"><span class="annottext">filename :: String
</span><a href="#local-6989586621681140759"><span class="hs-identifier hs-var hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140761"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140760"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-239"></span><span>           </span><span id="local-6989586621681140758"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681140758"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#doesDirectoryExist"><span class="hs-identifier hs-var">doesDirectoryExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140759"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-240"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681140758"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621681140762"><span class="hs-identifier hs-var">findTempDir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140761"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-241"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#createDirectory"><span class="hs-identifier hs-var">createDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140759"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-242"></span><span>                        </span><span class="hs-comment">-- see mkTempDir below; this is wrong: -&gt; consIORef (tmp_dirs_to_clean tmpfs) filename</span><span>
</span><span id="line-243"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140759"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#newTempLibName"><span class="hs-identifier hs-type">newTempLibName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span id="newTempLibName"><span class="annot"><span class="annottext">newTempLibName :: Logger
-&gt; TmpFs
-&gt; DynFlags
-&gt; TempFileLifetime
-&gt; String
-&gt; IO (String, String, String)
</span><a href="GHC.Utils.TmpFs.html#newTempLibName"><span class="hs-identifier hs-var hs-var">newTempLibName</span></a></span></span><span> </span><span id="local-6989586621681140755"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140755"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140754"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140754"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140753"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140753"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681140752"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140752"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span id="local-6989586621681140751"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140751"><span class="hs-identifier hs-var">extn</span></a></span></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681140750"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140750"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#getTempDir"><span class="hs-identifier hs-var">getTempDir</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140755"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140754"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140753"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-249"></span><span>       </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO (String, String, String)
</span><a href="#local-6989586621681140749"><span class="hs-identifier hs-var">findTempName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140750"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghc_&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><a href="#local-6989586621681140749"><span class="hs-identifier hs-type">findTempName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621681140749"><span class="annot"><span class="annottext">findTempName :: String -&gt; String -&gt; IO (String, String, String)
</span><a href="#local-6989586621681140749"><span class="hs-identifier hs-var hs-var">findTempName</span></a></span></span><span> </span><span id="local-6989586621681140748"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140748"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621681140747"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140747"><span class="hs-identifier hs-var">prefix</span></a></span></span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681140746"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140746"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IO Int
</span><a href="GHC.Utils.TmpFs.html#newTempSuffix"><span class="hs-identifier hs-var">newTempSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140754"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-comment">-- See Note [Deterministic base name]</span><span>
</span><span id="line-254"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140745"><span class="annot"><span class="annottext">libname :: String
</span><a href="#local-6989586621681140745"><span class="hs-identifier hs-var hs-var">libname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140747"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140746"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-255"></span><span>               </span><span id="local-6989586621681140744"><span class="annot"><span class="annottext">filename :: String
</span><a href="#local-6989586621681140744"><span class="hs-identifier hs-var hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140748"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="../../filepath-1.4.2.2/src/System-FilePath-Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140745"><span class="hs-identifier hs-var">libname</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="../../filepath-1.4.2.2/src/System-FilePath-Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140751"><span class="hs-identifier hs-var">extn</span></a></span><span>
</span><span id="line-256"></span><span>           </span><span id="local-6989586621681140743"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681140743"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140744"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-257"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681140743"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO (String, String, String)
</span><a href="#local-6989586621681140749"><span class="hs-identifier hs-var">findTempName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140748"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140747"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-258"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- clean it up later</span><span>
</span><span id="line-259"></span><span>                        </span><span class="annot"><span class="annottext">TmpFs -&gt; TempFileLifetime -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140754"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681140752"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140744"><span class="hs-identifier hs-var">filename</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-260"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140744"><span class="hs-identifier hs-var">filename</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140748"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140745"><span class="hs-identifier hs-var">libname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-comment">-- Return our temporary directory within tmp_dir, creating one if we</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- don't have one yet.</span><span>
</span><span id="line-265"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#getTempDir"><span class="hs-identifier hs-type">getTempDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-266"></span><span id="getTempDir"><span class="annot"><span class="annottext">getTempDir :: Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#getTempDir"><span class="hs-identifier hs-var hs-var">getTempDir</span></a></span></span><span> </span><span id="local-6989586621681140742"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140742"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140741"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140741"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681140740"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140740"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621681140739"><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140739"><span class="hs-identifier hs-var">mapping</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. IORef a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Map String String)
</span><a href="#local-6989586621681140738"><span class="hs-identifier hs-var">dir_ref</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140736"><span class="hs-identifier hs-var">tmp_dir</span></a></span><span> </span><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140739"><span class="hs-identifier hs-var">mapping</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>            </span><span id="local-6989586621681140735"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140735"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="GHC.Utils.TmpFs.html#getProcessID"><span class="hs-identifier hs-var">getProcessID</span></a></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140733"><span class="annot"><span class="annottext">prefix :: String
</span><a href="#local-6989586621681140733"><span class="hs-identifier hs-var hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140736"><span class="hs-identifier hs-var">tmp_dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="../../filepath-1.4.2.2/src/System-FilePath-Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghc&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140735"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IO.html#mask_"><span class="hs-identifier hs-var">mask_</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621681140732"><span class="hs-identifier hs-var">mkTempDir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140733"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681140731"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140731"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140731"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>    </span><span id="local-6989586621681140736"><span class="annot"><span class="annottext">tmp_dir :: String
</span><a href="#local-6989586621681140736"><span class="hs-identifier hs-var hs-var">tmp_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140740"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621681140738"><span class="annot"><span class="annottext">dir_ref :: IORef (Map String String)
</span><a href="#local-6989586621681140738"><span class="hs-identifier hs-var hs-var">dir_ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IORef (Map String String)
</span><a href="GHC.Utils.TmpFs.html#tmp_dirs_to_clean"><span class="hs-identifier hs-var">tmp_dirs_to_clean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140741"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="#local-6989586621681140732"><span class="hs-identifier hs-type">mkTempDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621681140732"><span class="annot"><span class="annottext">mkTempDir :: String -&gt; IO String
</span><a href="#local-6989586621681140732"><span class="hs-identifier hs-var hs-var">mkTempDir</span></a></span></span><span> </span><span id="local-6989586621681140729"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140729"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>        </span><span id="local-6989586621681140728"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140728"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IO Int
</span><a href="GHC.Utils.TmpFs.html#newTempSuffix"><span class="hs-identifier hs-var">newTempSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681140741"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140727"><span class="annot"><span class="annottext">our_dir :: String
</span><a href="#local-6989586621681140727"><span class="hs-identifier hs-var hs-var">our_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140729"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140728"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>        </span><span class="hs-comment">-- 1. Speculatively create our new directory.</span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#createDirectory"><span class="hs-identifier hs-var">createDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140727"><span class="hs-identifier hs-var">our_dir</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-comment">-- 2. Update the tmp_dirs_to_clean mapping unless an entry already exists</span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-comment">-- (i.e. unless another thread beat us to it).</span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621681140726"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681140726"><span class="hs-identifier hs-var">their_dir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.16.3.0/src/GHC-IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Map String String)
</span><a href="#local-6989586621681140738"><span class="hs-identifier hs-var">dir_ref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681140725"><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140725"><span class="hs-identifier hs-var">mapping</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-289"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140736"><span class="hs-identifier hs-var">tmp_dir</span></a></span><span> </span><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140725"><span class="hs-identifier hs-var">mapping</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>                </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681140724"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140724"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140725"><span class="hs-identifier hs-var">mapping</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140724"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>                </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.5.1/src/Data-Map-Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140736"><span class="hs-identifier hs-var">tmp_dir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140727"><span class="hs-identifier hs-var">our_dir</span></a></span><span> </span><span class="annot"><span class="annottext">Map String String
</span><a href="#local-6989586621681140725"><span class="hs-identifier hs-var">mapping</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-comment">-- 3. If there was an existing entry, return it and delete the</span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-comment">-- directory we created.  Otherwise return the directory we created.</span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681140726"><span class="hs-identifier hs-var">their_dir</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-296"></span><span>            </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>                </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140742"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140740"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-298"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Created temporary directory:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140727"><span class="hs-identifier hs-var">our_dir</span></a></span><span>
</span><span id="line-299"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140727"><span class="hs-identifier hs-var">our_dir</span></a></span><span>
</span><span id="line-300"></span><span>            </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681140719"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140719"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#removeDirectory"><span class="hs-identifier hs-var">removeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140727"><span class="hs-identifier hs-var">our_dir</span></a></span><span>
</span><span id="line-302"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140719"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.Exception.html#catchIO"><span class="hs-operator hs-var">`catchIO`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681140716"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140716"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../base-4.16.3.0/src/System-IO-Error.html#isAlreadyExistsError"><span class="hs-identifier hs-var">isAlreadyExistsError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140716"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-304"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="#local-6989586621681140732"><span class="hs-identifier hs-var">mkTempDir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140729"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. IOException -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IO-Exception.html#ioError"><span class="hs-identifier hs-var">ioError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140716"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">{- Note [Deterministic base name]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The filename of temporary files, especially the basename of C files, can end
up in the output in some form, e.g. as part of linker debug information. In the
interest of bit-wise exactly reproducible compilation (#4012), the basename of
the temporary file no longer contains random information (it used to contain
the process id).

This is ok, as the temporary directory used contains the pid (see getTempDir).
-}</span><span>
</span><span id="line-317"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#removeTmpDirs"><span class="hs-identifier hs-type">removeTmpDirs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span id="removeTmpDirs"><span class="annot"><span class="annottext">removeTmpDirs :: Logger -&gt; DynFlags -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeTmpDirs"><span class="hs-identifier hs-var hs-var">removeTmpDirs</span></a></span></span><span> </span><span id="local-6989586621681140713"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140713"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140712"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140712"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681140711"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140711"><span class="hs-identifier hs-var">ds</span></a></span></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Logger -&gt; DynFlags -&gt; String -&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Utils.Error.html#traceCmd"><span class="hs-identifier hs-var">traceCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140713"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140712"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Deleting temp dirs&quot;</span></span><span>
</span><span id="line-320"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Deleting: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140711"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; (String -&gt; IO ()) -&gt; String -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeWith"><span class="hs-identifier hs-var">removeWith</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140713"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140712"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#removeDirectory"><span class="hs-identifier hs-var">removeDirectory</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140711"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#removeTmpFiles"><span class="hs-identifier hs-type">removeTmpFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span id="removeTmpFiles"><span class="annot"><span class="annottext">removeTmpFiles :: Logger -&gt; DynFlags -&gt; [String] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeTmpFiles"><span class="hs-identifier hs-var hs-var">removeTmpFiles</span></a></span></span><span> </span><span id="local-6989586621681140706"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140706"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140705"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140705"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681140704"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140704"><span class="hs-identifier hs-var">fs</span></a></span></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="#local-6989586621681140703"><span class="hs-identifier hs-var">warnNon</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="annottext">forall a. Logger -&gt; DynFlags -&gt; String -&gt; String -&gt; IO a -&gt; IO a
</span><a href="GHC.Utils.Error.html#traceCmd"><span class="hs-identifier hs-var">traceCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140706"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140705"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Deleting temp files&quot;</span></span><span>
</span><span id="line-327"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Deleting: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140702"><span class="hs-identifier hs-var">deletees</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; (String -&gt; IO ()) -&gt; String -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeWith"><span class="hs-identifier hs-var">removeWith</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140706"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140705"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#removeFile"><span class="hs-identifier hs-var">removeFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140702"><span class="hs-identifier hs-var">deletees</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-330"></span><span>     </span><span class="hs-comment">-- Flat out refuse to delete files that are likely to be source input</span><span>
</span><span id="line-331"></span><span>     </span><span class="hs-comment">-- files (is there a worse bug than having a compiler delete your source</span><span>
</span><span id="line-332"></span><span>     </span><span class="hs-comment">-- files?)</span><span>
</span><span id="line-333"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span>     </span><span class="hs-comment">-- Deleting source files is a sign of a bug elsewhere, so prominently flag</span><span>
</span><span id="line-335"></span><span>     </span><span class="hs-comment">-- the condition.</span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621681140703"><span class="annot"><span class="annottext">warnNon :: IO () -&gt; IO ()
</span><a href="#local-6989586621681140703"><span class="hs-identifier hs-var hs-var">warnNon</span></a></span></span><span> </span><span id="local-6989586621681140700"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681140700"><span class="hs-identifier hs-var">act</span></a></span></span><span>
</span><span id="line-337"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.3.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140698"><span class="hs-identifier hs-var">non_deletees</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681140700"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-338"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140706"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140705"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WARNING - NOT deleting source files:&quot;</span></span><span>
</span><span id="line-340"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140698"><span class="hs-identifier hs-var">non_deletees</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681140700"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681140698"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140698"><span class="hs-identifier hs-var">non_deletees</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681140702"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140702"><span class="hs-identifier hs-var">deletees</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.3.0/src/Data-OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHaskellUserSrcFilename"><span class="hs-identifier hs-var">isHaskellUserSrcFilename</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681140704"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#removeWith"><span class="hs-identifier hs-type">removeWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span id="removeWith"><span class="annot"><span class="annottext">removeWith :: Logger -&gt; DynFlags -&gt; (String -&gt; IO ()) -&gt; String -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#removeWith"><span class="hs-identifier hs-var hs-var">removeWith</span></a></span></span><span> </span><span id="local-6989586621681140694"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140694"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681140693"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140693"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681140692"><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="#local-6989586621681140692"><span class="hs-identifier hs-var">remover</span></a></span></span><span> </span><span id="local-6989586621681140691"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140691"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="#local-6989586621681140692"><span class="hs-identifier hs-var">remover</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140691"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.Exception.html#catchIO"><span class="hs-operator hs-var">`catchIO`</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681140690"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140690"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-348"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140689"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681140689"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../base-4.16.3.0/src/System-IO-Error.html#isDoesNotExistError"><span class="hs-identifier hs-var">isDoesNotExistError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140690"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-349"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Warning: deleting non-existent&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140691"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-350"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Warning: exception raised when deleting&quot;</span></span><span>
</span><span id="line-351"></span><span>                                            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140691"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span>
</span><span id="line-352"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140690"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681140694"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681140693"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681140689"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-special">)</span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span class="hs-comment">-- relies on Int == Int32 on Windows</span><span>
</span><span id="line-358"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;_getpid&quot;</span><span> </span><span class="hs-identifier">getProcessID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span class="hs-cpp">
#else
</span><span class="annot"><a href="GHC.Utils.TmpFs.html#getProcessID"><span class="hs-identifier hs-type">getProcessID</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-361"></span><span id="getProcessID"><span class="annot"><span class="annottext">getProcessID :: IO Int
</span><a href="GHC.Utils.TmpFs.html#getProcessID"><span class="hs-identifier hs-var hs-var">getProcessID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CPid
</span><a href="../../base-4.16.3.0/src/System-Posix-Internals.html#c_getpid"><span class="hs-identifier hs-var">System.Posix.Internals.c_getpid</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.3.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- The following three functions are from the `temporary` package.</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">-- | Create and use a temporary directory in the system standard temporary</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- directory.</span><span>
</span><span id="line-368"></span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- Behaves exactly the same as 'withTempDirectory', except that the parent</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- temporary directory will be that returned by 'getTemporaryDirectory'.</span><span>
</span><span id="line-371"></span><span id="local-6989586621681140981"><span class="annot"><a href="GHC.Utils.TmpFs.html#withSystemTempDirectory"><span class="hs-identifier hs-type">withSystemTempDirectory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>   </span><span class="hs-comment">-- ^ Directory name template. See 'openTempFile'.</span><span>
</span><span id="line-372"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681140981"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Callback that can use the directory</span><span>
</span><span id="line-373"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681140981"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-374"></span><span id="withSystemTempDirectory"><span class="annot"><span class="annottext">withSystemTempDirectory :: forall a. String -&gt; (String -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.TmpFs.html#withSystemTempDirectory"><span class="hs-identifier hs-var hs-var">withSystemTempDirectory</span></a></span></span><span> </span><span id="local-6989586621681140681"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140681"><span class="hs-identifier hs-var">template</span></a></span></span><span> </span><span id="local-6989586621681140680"><span class="annot"><span class="annottext">String -&gt; IO a
</span><a href="#local-6989586621681140680"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="annottext">IO String
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#getTemporaryDirectory"><span class="hs-identifier hs-var">getTemporaryDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681140678"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140678"><span class="hs-identifier hs-var">tmpDir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; String -&gt; (String -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.TmpFs.html#withTempDirectory"><span class="hs-identifier hs-var">withTempDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140678"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140681"><span class="hs-identifier hs-var">template</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO a
</span><a href="#local-6989586621681140680"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | Create and use a temporary directory.</span><span>
</span><span id="line-379"></span><span class="hs-comment">--</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- Creates a new temporary directory inside the given directory, making use</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- of the template. The temp directory is deleted after use. For example:</span><span>
</span><span id="line-382"></span><span class="hs-comment">--</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- &gt; withTempDirectory &quot;src&quot; &quot;sdist.&quot; $ \tmpDir -&gt; do ...</span><span>
</span><span id="line-384"></span><span class="hs-comment">--</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- The @tmpDir@ will be a new subdirectory of the given directory, e.g.</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- @src/sdist.342@.</span><span>
</span><span id="line-387"></span><span id="local-6989586621681140979"><span class="annot"><a href="GHC.Utils.TmpFs.html#withTempDirectory"><span class="hs-identifier hs-type">withTempDirectory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ Temp directory to create the directory in</span><span>
</span><span id="line-388"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>   </span><span class="hs-comment">-- ^ Directory name template. See 'openTempFile'.</span><span>
</span><span id="line-389"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681140979"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Callback that can use the directory</span><span>
</span><span id="line-390"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681140979"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-391"></span><span id="withTempDirectory"><span class="annot"><span class="annottext">withTempDirectory :: forall a. String -&gt; String -&gt; (String -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.TmpFs.html#withTempDirectory"><span class="hs-identifier hs-var hs-var">withTempDirectory</span></a></span></span><span> </span><span id="local-6989586621681140677"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140677"><span class="hs-identifier hs-var">targetDir</span></a></span></span><span> </span><span id="local-6989586621681140676"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140676"><span class="hs-identifier hs-var">template</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><span class="annottext">forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="../../base-4.16.3.0/src/Control-Exception-Base.html#bracket"><span class="hs-identifier hs-var">Exception.bracket</span></a></span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#createTempDirectory"><span class="hs-identifier hs-var">createTempDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140677"><span class="hs-identifier hs-var">targetDir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140676"><span class="hs-identifier hs-var">template</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#ignoringIOErrors"><span class="hs-identifier hs-var">ignoringIOErrors</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#removeDirectoryRecursive"><span class="hs-identifier hs-var">removeDirectoryRecursive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#ignoringIOErrors"><span class="hs-identifier hs-type">ignoringIOErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span id="ignoringIOErrors"><span class="annot"><span class="annottext">ignoringIOErrors :: IO () -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#ignoringIOErrors"><span class="hs-identifier hs-var hs-var">ignoringIOErrors</span></a></span></span><span> </span><span id="local-6989586621681140671"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681140671"><span class="hs-identifier hs-var">ioe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681140671"><span class="hs-identifier hs-var">ioe</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.Exception.html#catchIO"><span class="hs-operator hs-var">`catchIO`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="annot"><a href="GHC.Utils.TmpFs.html#createTempDirectory"><span class="hs-identifier hs-type">createTempDirectory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.16.3.0/src/GHC-IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-401"></span><span id="createTempDirectory"><span class="annot"><span class="annottext">createTempDirectory :: String -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#createTempDirectory"><span class="hs-identifier hs-var hs-var">createTempDirectory</span></a></span></span><span> </span><span id="local-6989586621681140669"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140669"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span id="local-6989586621681140668"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140668"><span class="hs-identifier hs-var">template</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621681140667"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140667"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="GHC.Utils.TmpFs.html#getProcessID"><span class="hs-identifier hs-var">getProcessID</span></a></span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; IO String
</span><a href="#local-6989586621681140666"><span class="hs-identifier hs-var">findTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140667"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681140666"><span class="annot"><span class="annottext">findTempName :: Int -&gt; IO String
</span><a href="#local-6989586621681140666"><span class="hs-identifier hs-var hs-var">findTempName</span></a></span></span><span> </span><span id="local-6989586621681140665"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140665"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681140664"><span class="annot"><span class="annottext">path :: String
</span><a href="#local-6989586621681140664"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140669"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><a href="../../filepath-1.4.2.2/src/System-FilePath-Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140668"><span class="hs-identifier hs-var">template</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.3.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140665"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-406"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory-1.3.6.2/src/System-Directory.html#createDirectory"><span class="hs-identifier hs-var">createDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140664"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-407"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.3.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681140664"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-408"></span><span>          </span><span class="annot"><span class="annottext">forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.Exception.html#catchIO"><span class="hs-operator hs-var">`catchIO`</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681140663"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140663"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../base-4.16.3.0/src/System-IO-Error.html#isAlreadyExistsError"><span class="hs-identifier hs-var">isAlreadyExistsError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140663"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-409"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO String
</span><a href="#local-6989586621681140666"><span class="hs-identifier hs-var">findTempName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681140665"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.3.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. IOException -&gt; IO a
</span><a href="../../base-4.16.3.0/src/GHC-IO-Exception.html#ioError"><span class="hs-identifier hs-var">ioError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681140663"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-410"></span></pre></body></html>
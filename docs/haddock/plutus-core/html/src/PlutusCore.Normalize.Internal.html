<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- | The internals of the normalizer.</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds       #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusCore.Normalize.Internal</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier">NormalizeTypeT</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier">MonadNormalizeType</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#runNormalizeTypeT"><span class="hs-identifier">runNormalizeTypeT</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#withExtendedTypeVarEnv"><span class="hs-identifier">withExtendedTypeVarEnv</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier">normalizeTypeM</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#substNormalizeTypeM"><span class="hs-identifier">substNormalizeTypeM</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypesInM"><span class="hs-identifier">normalizeTypesInM</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Core.html"><span class="hs-identifier">PlutusCore.Core</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.MkPlc.html"><span class="hs-identifier">PlutusCore.MkPlc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.MkPlc.html#mkTyBuiltinOf"><span class="hs-identifier">mkTyBuiltinOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.html"><span class="hs-identifier">PlutusCore.Name</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html"><span class="hs-identifier">PlutusCore.Quote</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html"><span class="hs-identifier">PlutusCore.Rename</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusPrelude.html"><span class="hs-identifier">PlutusPrelude</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Reader</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.State</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Universe.html"><span class="hs-identifier">Universe</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">{- Note [Global uniqueness]
WARNING: everything in this module works under the assumption that the global uniqueness condition
is satisfied. The invariant is not checked, enforced or automatically fulfilled. So you must ensure
that the global uniqueness condition is satisfied before calling ANY function from this module.

The invariant is preserved. In future we will enforce the invariant.
-}</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | Mapping from variables to what they stand for (each row represents a substitution).</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- Needed for efficiency reasons, otherwise we could just use substitutions.</span><span>
</span><span id="line-40"></span><span class="hs-keyword">type</span><span> </span><span id="TypeVarEnv"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#TypeVarEnv"><span class="hs-identifier hs-var">TypeVarEnv</span></a></span></span><span> </span><span id="local-6989586621681072748"><span class="annot"><a href="#local-6989586621681072748"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681072747"><span class="annot"><a href="#local-6989586621681072747"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681072746"><span class="annot"><a href="#local-6989586621681072746"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#UniqueMap"><span class="hs-identifier hs-type">UniqueMap</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Rename.Internal.html#Dupable"><span class="hs-identifier hs-type">Dupable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072748"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072747"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072746"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | The environments that type normalization runs in.</span><span>
</span><span id="line-43"></span><span class="hs-keyword">newtype</span><span> </span><span id="NormalizeTypeEnv"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeEnv"><span class="hs-identifier hs-var">NormalizeTypeEnv</span></a></span></span><span> </span><span id="local-6989586621681073084"><span class="annot"><a href="#local-6989586621681073084"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681073083"><span class="annot"><a href="#local-6989586621681073083"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681073082"><span class="annot"><a href="#local-6989586621681073082"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NormalizeTypeEnv"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeEnv"><span class="hs-identifier hs-var">NormalizeTypeEnv</span></a></span></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_normalizeTypeEnvTypeVarEnv"><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
NormalizeTypeEnv tyname uni ann -&gt; TypeVarEnv tyname uni ann
</span><a href="PlutusCore.Normalize.Internal.html#_normalizeTypeEnvTypeVarEnv"><span class="hs-identifier hs-var hs-var">_normalizeTypeEnvTypeVarEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#TypeVarEnv"><span class="hs-identifier hs-type">TypeVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073084"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073083"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073082"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span id="normalizeTypeEnvTypeVarEnv"><span id="local-6989586621681073074"><span id="local-6989586621681073075"><span id="local-6989586621681073076"><span id="local-6989586621681073082"><span id="local-6989586621681073083"><span id="local-6989586621681073084"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">NormalizeTypeEnv</span></span></span></span></span></span></span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">{- Note [NormalizeTypeT]
Type normalization requires 'Quote' (because we need to be able to generate fresh names), but we
do not put 'Quote' into 'NormalizeTypeT'. The reason for this is that it makes type signatures of
various runners much nicer and also more generic. For example, we have

    runNormalizeTypeT :: MonadQuote m =&gt; NormalizeTypeT m tyname uni ann a -&gt; m a

If 'NormalizeTypeT' contained 'Quote', it would be

    runNormalizeTypeT :: NormalizeTypeT m tyname uni ann a -&gt; QuoteT m a

which hardcodes 'QuoteT' to be the outermost transformer.

Type normalization can run in any @m@ (as long as it's a 'MonadQuote') as witnessed by
the following type signature:

    normalizeTypeM
        :: (HasUnique (tyname ann) TypeUnique, MonadQuote m)
        =&gt; Type tyname uni ann -&gt; NormalizeTypeT m tyname uni ann (Normalized (Type tyname uni ann))

so it's natural to have runners that do not break this genericity.
-}</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">{- Note [Normalization API]
Normalization is split in two parts:

1. functions returning computations that perform reductions and run in defined in this module
   monad transformers (e.g. 'NormalizeTypeT')
2. runners of those computations

The reason for splitting the API is that this way the type-theoretic notion of normalization is
separated from implementation-specific details. (This used to be more important when we had
to deal with gas, and could maybe be changed now.)
-}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- See Note [NormalizedTypeT].</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | The monad transformer that type normalization runs in.</span><span>
</span><span id="line-86"></span><span class="hs-keyword">newtype</span><span> </span><span id="NormalizeTypeT"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-var">NormalizeTypeT</span></a></span></span><span> </span><span id="local-6989586621681073062"><span class="annot"><a href="#local-6989586621681073062"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681073061"><span class="annot"><a href="#local-6989586621681073061"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681073060"><span class="annot"><a href="#local-6989586621681073060"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681073059"><span class="annot"><a href="#local-6989586621681073059"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span id="local-6989586621681073058"><span class="annot"><a href="#local-6989586621681073058"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NormalizeTypeT"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-var">NormalizeTypeT</span></a></span></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="unNormalizeTypeT"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
NormalizeTypeT m tyname uni ann a
-&gt; ReaderT (NormalizeTypeEnv tyname uni ann) m a
</span><a href="PlutusCore.Normalize.Internal.html#unNormalizeTypeT"><span class="hs-identifier hs-var hs-var">unNormalizeTypeT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeEnv"><span class="hs-identifier hs-type">NormalizeTypeEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073061"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073060"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073059"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681073062"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073058"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">(</span><span> </span><span id="local-6989586621681072727"><span id="local-6989586621681072732"><span class="annot"><span class="annottext">forall a b.
a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
forall a b.
(a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Functor m =&gt;
a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Functor m =&gt;
(a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
&lt;$ :: forall a b.
a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
$c&lt;$ :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Functor m =&gt;
a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
fmap :: forall a b.
(a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
$cfmap :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Functor m =&gt;
(a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072700"><span id="local-6989586621681072704"><span id="local-6989586621681072708"><span id="local-6989586621681072712"><span id="local-6989586621681072717"><span class="annot"><span class="annottext">forall a. a -&gt; NormalizeTypeT m tyname uni ann a
forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
forall a b.
NormalizeTypeT m tyname uni ann (a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
forall a b c.
(a -&gt; b -&gt; c)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall {m :: * -&gt; *} {tyname} {uni :: * -&gt; *} {ann}.
Applicative m =&gt;
Functor (NormalizeTypeT m tyname uni ann)
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Applicative m =&gt;
a -&gt; NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Applicative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Applicative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Applicative m =&gt;
NormalizeTypeT m tyname uni ann (a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann c
&lt;* :: forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
$c&lt;* :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Applicative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann a
*&gt; :: forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
$c*&gt; :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Applicative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
liftA2 :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann c
$cliftA2 :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann c
&lt;*&gt; :: forall a b.
NormalizeTypeT m tyname uni ann (a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
$c&lt;*&gt; :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Applicative m =&gt;
NormalizeTypeT m tyname uni ann (a -&gt; b)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
pure :: forall a. a -&gt; NormalizeTypeT m tyname uni ann a
$cpure :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Applicative m =&gt;
a -&gt; NormalizeTypeT m tyname uni ann a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072676"><span id="local-6989586621681072680"><span id="local-6989586621681072684"><span id="local-6989586621681072689"><span class="annot"><span class="annottext">forall a. NormalizeTypeT m tyname uni ann a
forall a.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann [a]
forall a.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
forall (f :: * -&gt; *).
Applicative f
-&gt; (forall a. f a)
-&gt; (forall a. f a -&gt; f a -&gt; f a)
-&gt; (forall a. f a -&gt; f [a])
-&gt; (forall a. f a -&gt; f [a])
-&gt; Alternative f
forall {m :: * -&gt; *} {tyname} {uni :: * -&gt; *} {ann}.
Alternative m =&gt;
Applicative (NormalizeTypeT m tyname uni ann)
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Alternative m =&gt;
NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Alternative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann [a]
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Alternative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
many :: forall a.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann [a]
$cmany :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Alternative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann [a]
some :: forall a.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann [a]
$csome :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Alternative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann [a]
&lt;|&gt; :: forall a.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
$c&lt;|&gt; :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Alternative m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
empty :: forall a. NormalizeTypeT m tyname uni ann a
$cempty :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Alternative m =&gt;
NormalizeTypeT m tyname uni ann a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Alternative</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072656"><span id="local-6989586621681072660"><span id="local-6989586621681072665"><span class="annot"><span class="annottext">forall a. a -&gt; NormalizeTypeT m tyname uni ann a
forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; (a -&gt; NormalizeTypeT m tyname uni ann b)
-&gt; NormalizeTypeT m tyname uni ann b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
forall {m :: * -&gt; *} {tyname} {uni :: * -&gt; *} {ann}.
Monad m =&gt;
Applicative (NormalizeTypeT m tyname uni ann)
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Monad m =&gt;
a -&gt; NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Monad m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Monad m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; (a -&gt; NormalizeTypeT m tyname uni ann b)
-&gt; NormalizeTypeT m tyname uni ann b
return :: forall a. a -&gt; NormalizeTypeT m tyname uni ann a
$creturn :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
Monad m =&gt;
a -&gt; NormalizeTypeT m tyname uni ann a
&gt;&gt; :: forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
$c&gt;&gt; :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Monad m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann b
-&gt; NormalizeTypeT m tyname uni ann b
&gt;&gt;= :: forall a b.
NormalizeTypeT m tyname uni ann a
-&gt; (a -&gt; NormalizeTypeT m tyname uni ann b)
-&gt; NormalizeTypeT m tyname uni ann b
$c&gt;&gt;= :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a b.
Monad m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; (a -&gt; NormalizeTypeT m tyname uni ann b)
-&gt; NormalizeTypeT m tyname uni ann b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072637"><span id="local-6989586621681072642"><span class="annot"><span class="annottext">forall a. NormalizeTypeT m tyname uni ann a
forall a.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *).
Alternative m
-&gt; Monad m
-&gt; (forall a. m a)
-&gt; (forall a. m a -&gt; m a -&gt; m a)
-&gt; MonadPlus m
forall {m :: * -&gt; *} {tyname} {uni :: * -&gt; *} {ann}.
MonadPlus m =&gt;
Monad (NormalizeTypeT m tyname uni ann)
forall {m :: * -&gt; *} {tyname} {uni :: * -&gt; *} {ann}.
MonadPlus m =&gt;
Alternative (NormalizeTypeT m tyname uni ann)
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
MonadPlus m =&gt;
NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
MonadPlus m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
mplus :: forall a.
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
$cmplus :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
MonadPlus m =&gt;
NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
mzero :: forall a. NormalizeTypeT m tyname uni ann a
$cmzero :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
MonadPlus m =&gt;
NormalizeTypeT m tyname uni ann a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadPlus</span></a></span></span></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072617"><span id="local-6989586621681072621"><span id="local-6989586621681072626"><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeEnv"><span class="hs-identifier hs-type">NormalizeTypeEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073061"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073060"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073059"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072598"><span id="local-6989586621681072602"><span id="local-6989586621681072607"><span id="local-6989586621681072937"><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072937"><span class="hs-identifier hs-type">s</span></a></span></span></span></span></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072587"><span class="annot"><span class="annottext">forall a. Quote a -&gt; NormalizeTypeT m tyname uni ann a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. Quote a -&gt; m a) -&gt; MonadQuote m
forall {m :: * -&gt; *} {tyname} {uni :: * -&gt; *} {ann}.
MonadQuote m =&gt;
Monad (NormalizeTypeT m tyname uni ann)
forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
MonadQuote m =&gt;
Quote a -&gt; NormalizeTypeT m tyname uni ann a
liftQuote :: forall a. Quote a -&gt; NormalizeTypeT m tyname uni ann a
$cliftQuote :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
MonadQuote m =&gt;
Quote a -&gt; NormalizeTypeT m tyname uni ann a
</span><a href="PlutusCore.Quote.html#C%3AMonadQuote"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadQuote</span></a></span></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | The constraints that type normalization requires.</span><span>
</span><span id="line-95"></span><span class="hs-keyword">type</span><span> </span><span id="MonadNormalizeType"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier hs-var">MonadNormalizeType</span></a></span></span><span> </span><span id="local-6989586621681072580"><span class="annot"><a href="#local-6989586621681072580"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681072579"><span class="annot"><a href="#local-6989586621681072579"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072579"><span class="hs-identifier hs-type">m</span></a></span><span>     </span><span class="hs-comment">-- Type normalization must preserve global uniqueness.</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Universe.Core.html#HasUniApply"><span class="hs-identifier hs-type">HasUniApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072580"><span class="hs-identifier hs-type">uni</span></a></span><span>  </span><span class="hs-comment">-- See Note [Normalization of built-in types].</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Run a 'NormalizeTypeT' computation.</span><span>
</span><span id="line-101"></span><span id="local-6989586621681072921"><span id="local-6989586621681072922"><span id="local-6989586621681072923"><span id="local-6989586621681072924"><span id="local-6989586621681072925"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#runNormalizeTypeT"><span class="hs-identifier hs-type">runNormalizeTypeT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072925"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072924"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072923"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072922"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072921"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681072925"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072921"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span><span>
</span><span id="line-102"></span><span id="runNormalizeTypeT"><span class="annot"><span class="annottext">runNormalizeTypeT :: forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
NormalizeTypeT m tyname uni ann a -&gt; m a
</span><a href="PlutusCore.Normalize.Internal.html#runNormalizeTypeT"><span class="hs-identifier hs-var hs-var">runNormalizeTypeT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
TypeVarEnv tyname uni ann -&gt; NormalizeTypeEnv tyname uni ann
</span><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeEnv"><span class="hs-identifier hs-var">NormalizeTypeEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) tyname (uni :: * -&gt; *) ann a.
NormalizeTypeT m tyname uni ann a
-&gt; ReaderT (NormalizeTypeEnv tyname uni ann) m a
</span><a href="PlutusCore.Normalize.Internal.html#unNormalizeTypeT"><span class="hs-identifier hs-var">unNormalizeTypeT</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Locally extend a 'TypeVarEnv' in a 'NormalizeTypeT' computation.</span><span>
</span><span id="line-105"></span><span id="local-6989586621681072894"><span id="local-6989586621681072897"><span id="local-6989586621681072898"><span id="local-6989586621681072899"><span id="local-6989586621681072902"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#withExtendedTypeVarEnv"><span class="hs-identifier hs-type">withExtendedTypeVarEnv</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072902"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072899"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681072902"><span class="hs-identifier hs-type">tyname</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072902"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072898"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072897"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072899"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072902"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072898"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072897"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072894"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072899"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072902"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072898"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072897"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072894"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span><span>
</span><span id="line-111"></span><span id="withExtendedTypeVarEnv"><span class="annot"><span class="annottext">withExtendedTypeVarEnv :: forall tyname (m :: * -&gt; *) (uni :: * -&gt; *) ann a.
(HasUnique tyname TypeUnique, Monad m) =&gt;
tyname
-&gt; Normalized (Type tyname uni ann)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
</span><a href="PlutusCore.Normalize.Internal.html#withExtendedTypeVarEnv"><span class="hs-identifier hs-var hs-var">withExtendedTypeVarEnv</span></a></span></span><span> </span><span id="local-6989586621681072565"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072565"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann tyname (uni :: * -&gt; *) ann.
Iso
  (NormalizeTypeEnv tyname uni ann)
  (NormalizeTypeEnv tyname uni ann)
  (TypeVarEnv tyname uni ann)
  (TypeVarEnv tyname uni ann)
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeEnvTypeVarEnv"><span class="hs-identifier hs-var">normalizeTypeEnvTypeVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall name unique a.
HasUnique name unique =&gt;
name -&gt; a -&gt; UniqueMap unique a -&gt; UniqueMap unique a
</span><a href="PlutusCore.Name.html#insertByName"><span class="hs-identifier hs-var">insertByName</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072565"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Dupable a
</span><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier hs-var">dupable</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Look up a @tyname@ in a 'TypeVarEnv'.</span><span>
</span><span id="line-115"></span><span id="local-6989586621681072874"><span id="local-6989586621681072875"><span id="local-6989586621681072876"><span id="local-6989586621681072877"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#lookupTyNameM"><span class="hs-identifier hs-type">lookupTyNameM</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072877"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072876"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681072877"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072876"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072877"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072875"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072874"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Rename.Internal.html#Dupable"><span class="hs-identifier hs-type">Dupable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072877"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072875"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072874"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-118"></span><span id="lookupTyNameM"><span class="annot"><span class="annottext">lookupTyNameM :: forall tyname (m :: * -&gt; *) (uni :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, Monad m) =&gt;
tyname
-&gt; NormalizeTypeT
     m
     tyname
     uni
     ann
     (Maybe (Dupable (Normalized (Type tyname uni ann))))
</span><a href="PlutusCore.Normalize.Internal.html#lookupTyNameM"><span class="hs-identifier hs-var hs-var">lookupTyNameM</span></a></span></span><span> </span><span id="local-6989586621681072555"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072555"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall name unique a.
HasUnique name unique =&gt;
name -&gt; UniqueMap unique a -&gt; Maybe a
</span><a href="PlutusCore.Name.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072555"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
NormalizeTypeEnv tyname uni ann -&gt; TypeVarEnv tyname uni ann
</span><a href="PlutusCore.Normalize.Internal.html#_normalizeTypeEnvTypeVarEnv"><span class="hs-identifier hs-var">_normalizeTypeEnvTypeVarEnv</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">{- Note [Normalization]
Normalization works under the assumption that variables are globally unique.
We use environments instead of substitutions as they're more efficient.

Since all names are unique and there is no need to track scopes, type normalization has only two
interesting cases: function application and a variable usage. In the function application case we
normalize a function and its argument, add the normalized argument to the environment and continue
normalization. In the variable case we look up the variable in the current environment: if it's not
found, we leave the variable untouched. If the variable is found, then what this variable stands for
was previously added to an environment (while handling the function application case), so we pick
this value and rename all bound variables in it to preserve the global uniqueness condition. It is
safe to do so, because picked values cannot contain uninstantiated variables as only normalized types
are added to environments and normalization instantiates all variables presented in an environment.

See also Note [Normalization of built-in types].
-}</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">{- Note [Normalization of built-in types]
Instantiating a polymorphic built-in type amounts to applying it to some arguments. However,
the notion of &quot;applying&quot; is ambiguous, it can mean one of these two things:

1. lifting the built-in type to 'Type' and applying that via 'TyApp'
2. applying the built-in type right inside the universe to get a monomorphized type tag
   (e.g. the default universe has 'DefaultUniApply' for that purpose)

We need both of these things. The former allows us to assign types to polymorphic built-in functions
(otherwise applying a built-in type to a type variable would be unrepresentable), the latter is
used at runtime to juggle type tags so that we can avoid @unsafeCoerce@-ing, bring instances in
scope via 'bring' etc -- for all of that we have to have fully monomorphized type tags at runtime.

So in order for type checking to work we need to normalize polymorphic built-in types. For that
we simply turn intra-universe applications into regular type applications during type normalization.

We could go the other way around and &quot;reduce&quot; regular type applications into intra-universe ones,
however that would be harder to implement, because collapsing a general 'Type' into a 'SomeTypeIn'
is harder than expanding a 'SomeTypeIn' into a 'Type'. And it would also be impossible to do in the
general case, 'cause you can't collapse an application of a built-in type to, say, a type variable
into an intra-universe application as there are no type variables there. I guess we could &quot;reduce&quot;
application of built-in types in some cases and not reduce them in others and still make the whole
thing work, but that requires substantially more logic and is also a lot harder to get right.
Hence we do the opposite, which is straightforward.
-}</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- See Note [Normalization of built-in types].</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | Normalize a built-in type by replacing each application inside the universe with regular</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- type application.</span><span>
</span><span id="line-166"></span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeUni"><span class="hs-identifier hs-type">normalizeUni</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681072860"><span class="annot"><a href="#local-6989586621681072860"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072857"><span class="annot"><a href="#local-6989586621681072857"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681072860"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681072859"><span class="annot"><a href="#local-6989586621681072859"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681072855"><span class="annot"><a href="#local-6989586621681072855"><span class="hs-identifier hs-type">tyname</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Universe.Core.html#HasUniApply"><span class="hs-identifier hs-type">HasUniApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072859"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681072859"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#Esc"><span class="hs-identifier hs-type">Esc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072857"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072855"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072859"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="normalizeUni"><span class="annot"><span class="annottext">normalizeUni :: forall k (a :: k) (uni :: * -&gt; *) tyname.
HasUniApply uni =&gt;
uni (Esc a) -&gt; Type tyname uni ()
</span><a href="PlutusCore.Normalize.Internal.html#normalizeUni"><span class="hs-identifier hs-var hs-var">normalizeUni</span></a></span></span><span> </span><span id="local-6989586621681072549"><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681072549"><span class="hs-identifier hs-var">uni</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) tb r.
HasUniApply uni =&gt;
uni tb
-&gt; r
-&gt; (forall k l (f :: k -&gt; l) (a :: k).
    (tb ~ Esc (f a)) =&gt;
    uni (Esc f) -&gt; uni (Esc a) -&gt; r)
-&gt; r
</span><a href="Universe.Core.html#matchUniApply"><span class="hs-identifier hs-var">matchUniApply</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681072549"><span class="hs-identifier hs-var">uni</span></a></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-comment">-- If @uni@ is not an intra-universe application, then we're done.</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k (a :: k) (uni :: * -&gt; *) tyname ann.
ann -&gt; uni (Esc a) -&gt; Type tyname uni ann
</span><a href="PlutusCore.MkPlc.html#mkTyBuiltinOf"><span class="hs-identifier hs-var">mkTyBuiltinOf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681072549"><span class="hs-identifier hs-var">uni</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-comment">-- If it is, then we turn that application into normal type application and recurse</span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-comment">-- into both the function and its argument.</span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681072544"><span class="annot"><span class="annottext">uni (Esc f)
</span><a href="#local-6989586621681072544"><span class="hs-identifier hs-var">uniF</span></a></span></span><span> </span><span id="local-6989586621681072543"><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681072543"><span class="hs-identifier hs-var">uniA</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k (a :: k) (uni :: * -&gt; *) tyname.
HasUniApply uni =&gt;
uni (Esc a) -&gt; Type tyname uni ()
</span><a href="PlutusCore.Normalize.Internal.html#normalizeUni"><span class="hs-identifier hs-var">normalizeUni</span></a></span><span> </span><span class="annot"><span class="annottext">uni (Esc f)
</span><a href="#local-6989586621681072544"><span class="hs-identifier hs-var">uniF</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k (a :: k) (uni :: * -&gt; *) tyname.
HasUniApply uni =&gt;
uni (Esc a) -&gt; Type tyname uni ()
</span><a href="PlutusCore.Normalize.Internal.html#normalizeUni"><span class="hs-identifier hs-var">normalizeUni</span></a></span><span> </span><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681072543"><span class="hs-identifier hs-var">uniA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- See Note [Normalization].</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Normalize a 'Type' in the 'NormalizeTypeT' monad.</span><span>
</span><span id="line-178"></span><span id="local-6989586621681072827"><span id="local-6989586621681072829"><span id="local-6989586621681072830"><span id="local-6989586621681072831"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-type">normalizeTypeM</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072831"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier hs-type">MonadNormalizeType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072830"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072829"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072831"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072830"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072827"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072829"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072831"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072830"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072827"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072831"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072830"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072827"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-181"></span><span id="normalizeTypeM"><span class="annot"><span class="annottext">normalizeTypeM :: forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var hs-var">normalizeTypeM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-type">TyForall</span></a></span><span> </span><span id="local-6989586621681072486"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072486"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681072485"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072485"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681072484"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681072484"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681072483"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072483"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072486"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072485"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681072484"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072483"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-183"></span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-type">TyIFix</span></a></span><span> </span><span id="local-6989586621681072480"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072480"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681072479"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072479"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681072478"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072478"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072480"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072479"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Applicative f1, Applicative f2) =&gt;
f1 (f2 (a -&gt; b)) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%2A%3E%3E"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072478"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-185"></span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-type">TyFun</span></a></span><span> </span><span id="local-6989586621681072475"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072475"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681072474"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072474"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621681072473"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072473"><span class="hs-identifier hs-var">cod</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072475"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072474"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Applicative f1, Applicative f2) =&gt;
f1 (f2 (a -&gt; b)) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%2A%3E%3E"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072473"><span class="hs-identifier hs-var">cod</span></a></span><span>
</span><span id="line-187"></span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyLam"><span class="hs-identifier hs-type">TyLam</span></a></span><span> </span><span id="local-6989586621681072471"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072471"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681072470"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072470"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681072469"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681072469"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681072468"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072468"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyLam"><span class="hs-identifier hs-var">TyLam</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072471"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072470"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681072469"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072468"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-189"></span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-type">TyApp</span></a></span><span> </span><span id="local-6989586621681072467"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072467"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681072466"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072466"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681072465"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072465"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621681072464"><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072464"><span class="hs-identifier hs-var">vFun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072466"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621681072463"><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072463"><span class="hs-identifier hs-var">vArg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072465"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072464"><span class="hs-identifier hs-var">vFun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyLam"><span class="hs-identifier hs-type">TyLam</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681072461"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072461"><span class="hs-identifier hs-var">nArg</span></a></span></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681072460"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072460"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Normalized (Type tyname uni ann)
-&gt; tyname
-&gt; Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#substNormalizeTypeM"><span class="hs-identifier hs-var">substNormalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072463"><span class="hs-identifier hs-var">vArg</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072461"><span class="hs-identifier hs-var">nArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072460"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072467"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072464"><span class="hs-identifier hs-var">vFun</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072463"><span class="hs-identifier hs-var">vArg</span></a></span><span>
</span><span id="line-195"></span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span id="local-6989586621681072458"><span class="annot"><span class="annottext">var :: Type tyname uni ann
</span><a href="#local-6989586621681072458"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681072456"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072456"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621681072455"><span class="annot"><span class="annottext">Maybe (Dupable (Normalized (Type tyname uni ann)))
</span><a href="#local-6989586621681072455"><span class="hs-identifier hs-var">mayTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname (m :: * -&gt; *) (uni :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, Monad m) =&gt;
tyname
-&gt; NormalizeTypeT
     m
     tyname
     uni
     ann
     (Maybe (Dupable (Normalized (Type tyname uni ann))))
</span><a href="PlutusCore.Normalize.Internal.html#lookupTyNameM"><span class="hs-identifier hs-var">lookupTyNameM</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072456"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Dupable (Normalized (Type tyname uni ann)))
</span><a href="#local-6989586621681072455"><span class="hs-identifier hs-var">mayTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-comment">-- A variable is always normalized.</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Dupable (Normalized (Type tyname uni ann)))
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681072458"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072453"><span class="annot"><span class="annottext">Dupable (Normalized (Type tyname uni ann))
</span><a href="#local-6989586621681072453"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadQuote m, Rename a) =&gt;
Dupable a -&gt; m a
</span><a href="PlutusCore.Rename.html#liftDupable"><span class="hs-identifier hs-var">liftDupable</span></a></span><span> </span><span class="annot"><span class="annottext">Dupable (Normalized (Type tyname uni ann))
</span><a href="#local-6989586621681072453"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-201"></span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyBuiltin"><span class="hs-identifier hs-type">TyBuiltin</span></a></span><span> </span><span id="local-6989586621681072450"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072450"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#SomeTypeIn"><span class="hs-identifier hs-type">SomeTypeIn</span></a></span><span> </span><span id="local-6989586621681072444"><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681072444"><span class="hs-identifier hs-var">uni</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681072450"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k (a :: k) (uni :: * -&gt; *) tyname.
HasUniApply uni =&gt;
uni (Esc a) -&gt; Type tyname uni ()
</span><a href="PlutusCore.Normalize.Internal.html#normalizeUni"><span class="hs-identifier hs-var">normalizeUni</span></a></span><span> </span><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681072444"><span class="hs-identifier hs-var">uni</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">{- Note [Normalizing substitution]
@substituteNormalizeM@ is only ever used as normalizing substitution that receives two already
normalized types. However we do not enforce this in the type signature, because
1) it's perfectly correct for the last argument to be non-normalized
2) it would be annoying to wrap 'Type's into 'NormalizedType's
-}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- See Note [Normalizing substitution].</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | Substitute a type for a variable in a type and normalize in the 'NormalizeTypeT' monad.</span><span>
</span><span id="line-213"></span><span id="local-6989586621681072801"><span id="local-6989586621681072802"><span id="local-6989586621681072803"><span id="local-6989586621681072804"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#substNormalizeTypeM"><span class="hs-identifier hs-type">substNormalizeTypeM</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072804"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier hs-type">MonadNormalizeType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072803"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072802"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072804"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072803"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072801"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>                                    </span><span class="hs-comment">-- ^ @ty@</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681072804"><span class="hs-identifier hs-type">tyname</span></a></span><span>                                                              </span><span class="hs-comment">-- ^ @name@</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072804"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072803"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072801"><span class="hs-identifier hs-type">ann</span></a></span><span>                                                 </span><span class="hs-comment">-- ^ @body@</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072802"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072804"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072803"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072801"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072804"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072803"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072801"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>  </span><span class="hs-comment">-- ^ @NORM ([ty / name] body)@</span><span>
</span><span id="line-219"></span><span id="substNormalizeTypeM"><span class="annot"><span class="annottext">substNormalizeTypeM :: forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Normalized (Type tyname uni ann)
-&gt; tyname
-&gt; Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#substNormalizeTypeM"><span class="hs-identifier hs-var hs-var">substNormalizeTypeM</span></a></span></span><span> </span><span id="local-6989586621681072434"><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072434"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681072433"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072433"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (m :: * -&gt; *) (uni :: * -&gt; *) ann a.
(HasUnique tyname TypeUnique, Monad m) =&gt;
tyname
-&gt; Normalized (Type tyname uni ann)
-&gt; NormalizeTypeT m tyname uni ann a
-&gt; NormalizeTypeT m tyname uni ann a
</span><a href="PlutusCore.Normalize.Internal.html#withExtendedTypeVarEnv"><span class="hs-identifier hs-var">withExtendedTypeVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681072433"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type tyname uni ann)
</span><a href="#local-6989586621681072434"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Normalize every 'Type' in a 'Term'.</span><span>
</span><span id="line-222"></span><span id="local-6989586621681072780"><span id="local-6989586621681072781"><span id="local-6989586621681072782"><span id="local-6989586621681072783"><span id="local-6989586621681072784"><span id="local-6989586621681072785"><span class="annot"><a href="PlutusCore.Normalize.Internal.html#normalizeTypesInM"><span class="hs-identifier hs-type">normalizeTypesInM</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072785"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">TypeUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier hs-type">MonadNormalizeType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072784"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072783"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072785"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072782"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072784"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072781"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072780"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#NormalizeTypeT"><span class="hs-identifier hs-type">NormalizeTypeT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072785"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072784"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072780"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072785"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072782"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072784"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072781"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681072780"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-225"></span><span id="normalizeTypesInM"><span class="annot"><span class="annottext">normalizeTypesInM :: forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) name fun ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Term tyname name uni fun ann
-&gt; NormalizeTypeT m tyname uni ann (Term tyname name uni fun ann)
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypesInM"><span class="hs-identifier hs-var hs-var">normalizeTypesInM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
LensLike (WrappedMonad m) a b a b -&gt; (b -&gt; m b) -&gt; a -&gt; m b
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">transformMOf</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun ann.
Traversal'
  (Term tyname name uni fun ann) (Term tyname name uni fun ann)
</span><a href="PlutusCore.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="annot"><span class="annottext">forall {name} {fun} {ann}.
Term tyname name uni fun ann
-&gt; NormalizeTypeT m tyname uni ann (Term tyname name uni fun ann)
</span><a href="#local-6989586621681072420"><span class="hs-identifier hs-var">normalizeChildTypes</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621681072420"><span class="annot"><span class="annottext">normalizeChildTypes :: Term tyname name uni fun ann
-&gt; NormalizeTypeT m tyname uni ann (Term tyname name uni fun ann)
</span><a href="#local-6989586621681072420"><span class="hs-identifier hs-var hs-var">normalizeChildTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun ann.
Traversal' (Term tyname name uni fun ann) (Type tyname uni ann)
</span><a href="PlutusCore.Core.Plated.html#termSubtypes"><span class="hs-identifier hs-var">termSubtypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) (m :: * -&gt; *) ann.
(HasUnique tyname TypeUnique, MonadNormalizeType uni m) =&gt;
Type tyname uni ann
-&gt; NormalizeTypeT
     m tyname uni ann (Normalized (Type tyname uni ann))
</span><a href="PlutusCore.Normalize.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span></pre></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts  #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs             #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Optimization passes for removing dead code, mainly dead let bindings.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.Transform.DeadCode</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#removeDeadBindings"><span class="hs-identifier">removeDeadBindings</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.html"><span class="hs-identifier">PlutusIR</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Analysis.Dependencies.html"><span class="hs-identifier">PlutusIR.Analysis.Dependencies</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Deps</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.MkPir.html"><span class="hs-identifier">PlutusIR.MkPir</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Transform.Rename.html"><span class="hs-identifier">PlutusIR.Transform.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.html"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.html"><span class="hs-identifier">PlutusCore.Builtin</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.html"><span class="hs-identifier">PlutusCore.Name</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Reader</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.Coerce</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../algebraic-graphs/html/src"><span class="hs-identifier">Algebra.Graph</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../algebraic-graphs/html/src"><span class="hs-identifier">Algebra.Graph.ToGraph</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html"><span class="hs-identifier">PlutusCore.Quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier">MonadQuote</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#freshTyName"><span class="hs-identifier">freshTyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#liftQuote"><span class="hs-identifier">liftQuote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.StdLib.Data.ScottUnit.html"><span class="hs-identifier">PlutusCore.StdLib.Data.ScottUnit</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unit</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../witherable/html/src"><span class="hs-identifier">Witherable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../witherable/html/src"><span class="hs-identifier">Witherable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../witherable/html/src"><span class="hs-identifier">wither</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | Remove all the dead let bindings in a term.</span><span>
</span><span id="line-32"></span><span id="local-6989586621681118335"><span id="local-6989586621681118339"><span id="local-6989586621681118341"><span id="local-6989586621681118342"><span id="local-6989586621681118345"><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#removeDeadBindings"><span class="hs-identifier hs-type">removeDeadBindings</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118345"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">PLC.TermUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>       </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118342"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118341"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">PLC.MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118339"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">PLC.BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118341"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118345"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118342"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118341"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118335"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681118339"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118345"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118342"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118341"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118335"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-38"></span><span id="removeDeadBindings"><span class="annot"><span class="annottext">removeDeadBindings :: forall name (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
(HasUnique name TermUnique, ToBuiltinMeaning uni fun,
 MonadQuote m) =&gt;
BuiltinVersion fun
-&gt; Term TyName name uni fun a -&gt; m (Term TyName name uni fun a)
</span><a href="PlutusIR.Transform.DeadCode.html#removeDeadBindings"><span class="hs-identifier hs-var hs-var">removeDeadBindings</span></a></span></span><span> </span><span id="local-6989586621681118105"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681118105"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621681118104"><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681118104"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-39"></span><span>    </span><span id="local-6989586621681118103"><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681118103"><span class="hs-identifier hs-var">tRen</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). (Rename a, MonadQuote m) =&gt; a -&gt; m a
</span><a href="PlutusCore.Rename.html#rename"><span class="hs-identifier hs-var">PLC.rename</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681118104"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadQuote m =&gt; Quote a -&gt; m a
</span><a href="PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
Monad m =&gt;
LensLike (WrappedMonad m) a b a b -&gt; (b -&gt; m b) -&gt; a -&gt; m b
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">transformMOf</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Traversal'
  (Term tyname name uni fun a) (Term tyname name uni fun a)
</span><a href="PlutusIR.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
(MonadReader Liveness m, HasUnique name TermUnique,
 MonadQuote m) =&gt;
Term TyName name uni fun a -&gt; m (Term TyName name uni fun a)
</span><a href="PlutusIR.Transform.DeadCode.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681118103"><span class="hs-identifier hs-var">tRen</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name tyname (uni :: * -&gt; *) fun a.
(HasUnique name TermUnique, HasUnique tyname TypeUnique,
 ToBuiltinMeaning uni fun) =&gt;
BuiltinVersion fun -&gt; Term tyname name uni fun a -&gt; Liveness
</span><a href="PlutusIR.Transform.DeadCode.html#calculateLiveness"><span class="hs-identifier hs-var">calculateLiveness</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681118105"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681118103"><span class="hs-identifier hs-var">tRen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">type</span><span> </span><span id="Liveness"><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#Liveness"><span class="hs-identifier hs-var">Liveness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="PlutusIR.Analysis.Dependencies.html#Node"><span class="hs-identifier hs-type">Deps.Node</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span id="local-6989586621681118275"><span id="local-6989586621681118276"><span id="local-6989586621681118277"><span id="local-6989586621681118278"><span id="local-6989586621681118279"><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#calculateLiveness"><span class="hs-identifier hs-type">calculateLiveness</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118279"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">PLC.TermUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118278"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">PLC.TypeUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>       </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118277"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118276"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">PLC.BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118276"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118278"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118279"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118277"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118276"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118275"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a></span></span></span></span></span></span><span>
</span><span id="line-50"></span><span id="calculateLiveness"><span class="annot"><span class="annottext">calculateLiveness :: forall name tyname (uni :: * -&gt; *) fun a.
(HasUnique name TermUnique, HasUnique tyname TypeUnique,
 ToBuiltinMeaning uni fun) =&gt;
BuiltinVersion fun -&gt; Term tyname name uni fun a -&gt; Liveness
</span><a href="PlutusIR.Transform.DeadCode.html#calculateLiveness"><span class="hs-identifier hs-var hs-var">calculateLiveness</span></a></span></span><span> </span><span id="local-6989586621681118080"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681118080"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621681118079"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681118079"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><a href="#local-6989586621681118078"><span class="hs-identifier hs-type">depGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../algebraic-graphs/html/src"><span class="hs-identifier hs-type">G.Graph</span></a></span><span> </span><span class="annot"><a href="PlutusIR.Analysis.Dependencies.html#Node"><span class="hs-identifier hs-type">Deps.Node</span></a></span><span>
</span><span id="line-53"></span><span>        </span><span id="local-6989586621681118078"><span class="annot"><span class="annottext">depGraph :: Graph Node
</span><a href="#local-6989586621681118078"><span class="hs-identifier hs-var hs-var">depGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall g tyname name (uni :: * -&gt; *) fun a.
(DepGraph g, HasUnique tyname TypeUnique,
 HasUnique name TermUnique, ToBuiltinMeaning uni fun) =&gt;
BuiltinVersion fun
-&gt; Term tyname name uni fun a -&gt; (g, StrictnessMap)
</span><a href="PlutusIR.Analysis.Dependencies.html#runTermDeps"><span class="hs-identifier hs-var">Deps.runTermDeps</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681118080"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681118079"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall t.
(ToGraph t, Ord (ToVertex t)) =&gt;
t -&gt; ToVertex t -&gt; [ToVertex t]
</span><a href="../../../../algebraic-graphs/html/src"><span class="hs-identifier hs-var">T.reachable</span></a></span><span> </span><span class="annot"><span class="annottext">Graph Node
</span><a href="#local-6989586621681118078"><span class="hs-identifier hs-var">depGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="PlutusIR.Analysis.Dependencies.html#Root"><span class="hs-identifier hs-var">Deps.Root</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span id="local-6989586621681118247"><span id="local-6989586621681118248"><span id="local-6989586621681118249"><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#live"><span class="hs-identifier hs-type">live</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118249"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118248"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118247"><span class="hs-identifier hs-type">unique</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681118248"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681118249"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span><span>
</span><span id="line-57"></span><span id="live"><span class="annot"><span class="annottext">live :: forall (m :: * -&gt; *) n unique.
(MonadReader Liveness m, HasUnique n unique) =&gt;
n -&gt; m Bool
</span><a href="PlutusIR.Transform.DeadCode.html#live"><span class="hs-identifier hs-var hs-var">live</span></a></span></span><span> </span><span id="local-6989586621681118059"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681118059"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-59"></span><span>        </span><span id="local-6989586621681118058"><span class="annot"><span class="annottext">u :: Unique
</span><a href="#local-6989586621681118058"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">coerce :: forall a b. Coercible a b =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681118059"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a unique. HasUnique a unique =&gt; Lens' a unique
</span><a href="PlutusCore.Name.html#unique"><span class="hs-identifier hs-var">PLC.unique</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; Node
</span><a href="PlutusIR.Analysis.Dependencies.html#Variable"><span class="hs-identifier hs-var">Deps.Variable</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681118058"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span id="local-6989586621681118223"><span id="local-6989586621681118224"><span id="local-6989586621681118225"><span id="local-6989586621681118226"><span id="local-6989586621681118227"><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#liveBinding"><span class="hs-identifier hs-type">liveBinding</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118227"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118226"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">PLC.TermUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118227"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118226"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118225"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118224"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118223"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681118227"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118226"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118225"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118224"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118223"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-66"></span><span id="liveBinding"><span class="annot"><span class="annottext">liveBinding :: forall (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
(MonadReader Liveness m, HasUnique name TermUnique,
 MonadQuote m) =&gt;
Binding TyName name uni fun a
-&gt; m (Maybe (Binding TyName name uni fun a))
</span><a href="PlutusIR.Transform.DeadCode.html#liveBinding"><span class="hs-identifier hs-var hs-var">liveBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-68"></span><span>        </span><span class="hs-comment">-- TODO: HasUnique instances for VarDecl and TyVarDecl?</span><span>
</span><span id="line-69"></span><span>        </span><span id="local-6989586621681118012"><span class="annot"><span class="annottext">liveVarDecl :: VarDecl tyname n uni ann -&gt; m Bool
</span><a href="#local-6989586621681118012"><span class="hs-identifier hs-var hs-var">liveVarDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681118010"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681118010"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) n unique.
(MonadReader Liveness m, HasUnique n unique) =&gt;
n -&gt; m Bool
</span><a href="PlutusIR.Transform.DeadCode.html#live"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681118010"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-70"></span><span>        </span><span id="local-6989586621681118005"><span class="annot"><span class="annottext">liveTyVarDecl :: TyVarDecl n ann -&gt; m Bool
</span><a href="#local-6989586621681118005"><span class="hs-identifier hs-var hs-var">liveTyVarDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681118003"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681118003"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) n unique.
(MonadReader Liveness m, HasUnique n unique) =&gt;
n -&gt; m Bool
</span><a href="PlutusIR.Transform.DeadCode.html#live"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681118003"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-72"></span><span>        </span><span id="local-6989586621681118002"><span class="annot"><span class="annottext">b :: Binding TyName name uni fun a
</span><a href="#local-6989586621681118002"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681118000"><span class="annot"><span class="annottext">VarDecl TyName name uni a
</span><a href="#local-6989586621681118000"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>            </span><span id="local-6989586621681117999"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117999"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {n} {unique} {tyname} {uni :: * -&gt; *} {ann}.
(MonadReader Liveness m, HasUnique n unique) =&gt;
VarDecl tyname n uni ann -&gt; m Bool
</span><a href="#local-6989586621681118012"><span class="hs-identifier hs-var">liveVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName name uni a
</span><a href="#local-6989586621681118000"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-74"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117999"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName name uni fun a
</span><a href="#local-6989586621681118002"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span id="local-6989586621681117998"><span class="annot"><span class="annottext">b :: Binding TyName name uni fun a
</span><a href="#local-6989586621681117998"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681117996"><span class="annot"><span class="annottext">TyVarDecl TyName a
</span><a href="#local-6989586621681117996"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>            </span><span id="local-6989586621681117995"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117995"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {n} {unique} {ann}.
(MonadReader Liveness m, HasUnique n unique) =&gt;
TyVarDecl n ann -&gt; m Bool
</span><a href="#local-6989586621681118005"><span class="hs-identifier hs-var">liveTyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName a
</span><a href="#local-6989586621681117996"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-77"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117995"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName name uni fun a
</span><a href="#local-6989586621681117998"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span id="local-6989586621681117994"><span class="annot"><span class="annottext">b :: Binding TyName name uni fun a
</span><a href="#local-6989586621681117994"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span id="local-6989586621681117992"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117992"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681117990"><span class="annot"><span class="annottext">TyVarDecl TyName a
</span><a href="#local-6989586621681117990"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName a]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681117989"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681117989"><span class="hs-identifier hs-var">destr</span></a></span></span><span> </span><span id="local-6989586621681117988"><span class="annot"><span class="annottext">[VarDecl TyName name uni a]
</span><a href="#local-6989586621681117988"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>            </span><span id="local-6989586621681117987"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117987"><span class="hs-identifier hs-var">dtypeLive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {n} {unique} {ann}.
(MonadReader Liveness m, HasUnique n unique) =&gt;
TyVarDecl n ann -&gt; m Bool
</span><a href="#local-6989586621681118005"><span class="hs-identifier hs-var">liveTyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName a
</span><a href="#local-6989586621681117990"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-80"></span><span>            </span><span id="local-6989586621681117986"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117986"><span class="hs-identifier hs-var">destrLive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) n unique.
(MonadReader Liveness m, HasUnique n unique) =&gt;
n -&gt; m Bool
</span><a href="PlutusIR.Transform.DeadCode.html#live"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681117989"><span class="hs-identifier hs-var">destr</span></a></span><span>
</span><span id="line-81"></span><span>            </span><span id="local-6989586621681117985"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681117985"><span class="hs-identifier hs-var">constrsLive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {n} {unique} {tyname} {uni :: * -&gt; *} {ann}.
(MonadReader Liveness m, HasUnique n unique) =&gt;
VarDecl tyname n uni ann -&gt; m Bool
</span><a href="#local-6989586621681118012"><span class="hs-identifier hs-var">liveVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName name uni a]
</span><a href="#local-6989586621681117988"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-82"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681117983"><span class="annot"><span class="annottext">termLive :: Bool
</span><a href="#local-6989586621681117983"><span class="hs-identifier hs-var hs-var">termLive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">or</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117986"><span class="hs-identifier hs-var">destrLive</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681117985"><span class="hs-identifier hs-var">constrsLive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117987"><span class="hs-identifier hs-var">dtypeLive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681117983"><span class="hs-identifier hs-var">termLive</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-84"></span><span>                 </span><span class="hs-comment">-- At least one term-level part is live, keep the whole thing</span><span>
</span><span id="line-85"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName name uni fun a
</span><a href="#local-6989586621681117994"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-86"></span><span>                </span><span class="hs-comment">-- Nothing is live, remove the whole thing</span><span>
</span><span id="line-87"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-88"></span><span>                </span><span class="hs-comment">-- See Note [Dependencies for datatype bindings, and pruning them]</span><span>
</span><span id="line-89"></span><span>                 </span><span class="hs-comment">-- Datatype is live but no term-level parts are, replace with a trivial type binding</span><span>
</span><span id="line-90"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; TyVarDecl tyname a
-&gt; Type tyname uni a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-var">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117992"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName a
</span><a href="#local-6989586621681117990"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a (uni :: * -&gt; *).
MonadQuote m =&gt;
Kind a -&gt; m (Type TyName uni a)
</span><a href="PlutusIR.Transform.DeadCode.html#mkTypeOfKind"><span class="hs-identifier hs-var">mkTypeOfKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname ann. TyVarDecl tyname ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#_tyVarDeclKind"><span class="hs-identifier hs-var">_tyVarDeclKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName a
</span><a href="#local-6989586621681117990"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- | Given a kind, make a type (any type!) of that kind.</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- Generates things of the form 'unit -&gt; unit -&gt; ... -&gt; unit'</span><span>
</span><span id="line-94"></span><span id="local-6989586621681118177"><span id="local-6989586621681118178"><span id="local-6989586621681118179"><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#mkTypeOfKind"><span class="hs-identifier hs-type">mkTypeOfKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118179"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118178"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681118179"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118177"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118178"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-95"></span><span id="mkTypeOfKind"><span class="annot"><span class="annottext">mkTypeOfKind :: forall (m :: * -&gt; *) a (uni :: * -&gt; *).
MonadQuote m =&gt;
Kind a -&gt; m (Type TyName uni a)
</span><a href="PlutusIR.Transform.DeadCode.html#mkTypeOfKind"><span class="hs-identifier hs-var hs-var">mkTypeOfKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-comment">-- The scott-encoded unit here is a little bulky but it continues to be the easiest</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-comment">-- way to get a type of kind Type without relying on builtins.</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span id="local-6989586621681117963"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117963"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117963"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.StdLib.Data.ScottUnit.html#unit"><span class="hs-identifier hs-var">Unit.unit</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#KindArrow"><span class="hs-identifier hs-type">KindArrow</span></a></span><span> </span><span id="local-6989586621681117959"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117959"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681117958"><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681117958"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span id="local-6989586621681117957"><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681117957"><span class="hs-identifier hs-var">ki'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>        </span><span id="local-6989586621681117956"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681117956"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; Text -&gt; m TyName
</span><a href="PlutusCore.Quote.html#freshTyName"><span class="hs-identifier hs-var">freshTyName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyLam"><span class="hs-identifier hs-var">TyLam</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117959"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681117956"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681117958"><span class="hs-identifier hs-var">ki</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a (uni :: * -&gt; *).
MonadQuote m =&gt;
Kind a -&gt; m (Type TyName uni a)
</span><a href="PlutusIR.Transform.DeadCode.html#mkTypeOfKind"><span class="hs-identifier hs-var">mkTypeOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681117957"><span class="hs-identifier hs-var">ki'</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621681118280"><span id="local-6989586621681118281"><span id="local-6989586621681118282"><span id="local-6989586621681118283"><span id="local-6989586621681118284"><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#processTerm"><span class="hs-identifier hs-type">processTerm</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="PlutusIR.Transform.DeadCode.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118284"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118283"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">PLC.TermUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118284"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118283"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118282"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118281"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118280"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681118284"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118283"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118282"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118281"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681118280"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-107"></span><span id="processTerm"><span class="annot"><span class="annottext">processTerm :: forall (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
(MonadReader Liveness m, HasUnique name TermUnique,
 MonadQuote m) =&gt;
Term TyName name uni fun a -&gt; m (Term TyName name uni fun a)
</span><a href="PlutusIR.Transform.DeadCode.html#processTerm"><span class="hs-identifier hs-var hs-var">processTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-comment">-- throw away dead bindings</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621681117937"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117937"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681117936"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681117936"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681117935"><span class="annot"><span class="annottext">NonEmpty (Binding TyName name uni fun a)
</span><a href="#local-6989586621681117935"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681117934"><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681117934"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a tyname name (uni :: * -&gt; *) fun.
a
-&gt; Recursivity
-&gt; [Binding tyname name uni fun a]
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.MkPir.html#mkLet"><span class="hs-identifier hs-var">mkLet</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681117937"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681117936"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Witherable t, Applicative f) =&gt;
(a -&gt; f (Maybe b)) -&gt; t a -&gt; f (t b)
</span><a href="../../../../witherable/html/src"><span class="hs-identifier hs-var">wither</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
(MonadReader Liveness m, HasUnique name TermUnique,
 MonadQuote m) =&gt;
Binding TyName name uni fun a
-&gt; m (Maybe (Binding TyName name uni fun a))
</span><a href="PlutusIR.Transform.DeadCode.html#liveBinding"><span class="hs-identifier hs-var">liveBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName name uni fun a)
</span><a href="#local-6989586621681117935"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681117934"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621681117931"><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681117931"><span class="hs-identifier hs-var">x</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName name uni fun a
</span><a href="#local-6989586621681117931"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-111"></span></pre></body></html>
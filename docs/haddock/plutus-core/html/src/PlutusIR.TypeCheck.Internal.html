<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- | The internal module of the type checker that defines the actual algorithms,</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- but not the user-facing API.</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds    #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase         #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes         #-}</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.TypeCheck.Internal</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#BuiltinTypes"><span class="hs-identifier">BuiltinTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckConfig"><span class="hs-identifier">TypeCheckConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier">TypeCheckT</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#MonadKindCheck"><span class="hs-identifier">MonadKindCheck</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#MonadTypeCheck"><span class="hs-identifier">MonadTypeCheck</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier">MonadTypeCheckPir</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#tccBuiltinTypes"><span class="hs-identifier">tccBuiltinTypes</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier">PirTCConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#AllowEscape"><span class="hs-identifier">AllowEscape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier">inferTypeM</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier">checkTypeM</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier">runTypeCheckM</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusPrelude.html"><span class="hs-identifier">PlutusPrelude</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.html"><span class="hs-identifier">PlutusIR</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Datatype.html"><span class="hs-identifier">PlutusIR.Compiler.Datatype</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Provenance.html"><span class="hs-identifier">PlutusIR.Compiler.Provenance</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html"><span class="hs-identifier">PlutusIR.Compiler.Types</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Error.html"><span class="hs-identifier">PlutusIR.Error</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.MkPir.html"><span class="hs-identifier">PlutusIR.MkPir</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PIR</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Transform.Rename.html"><span class="hs-identifier">PlutusIR.Transform.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.html"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#toPatFuncKind"><span class="hs-identifier">toPatFuncKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#tyVarDeclName"><span class="hs-identifier">tyVarDeclName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#typeAnn"><span class="hs-identifier">typeAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Error.html"><span class="hs-identifier">PlutusCore.Error</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- we mirror inferTypeM, checkTypeM of plc-tc and extend it for plutus-ir terms</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html"><span class="hs-identifier">PlutusCore.TypeCheck.Internal</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier">checkTypeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier">inferTypeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier">runTypeCheckM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Monad.Error.Lens</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-43"></span><span class="hs-comment">-- Using @transformers@ rather than @mtl@, because the former doesn't impose the 'Monad' constraint</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- on 'local'.</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Reader</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Universe.html"><span class="hs-identifier">Universe</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">{- Note [PLC Typechecker code reuse]
For PIR kind-checking, we reuse `checkKindM`, `inferKindM` directly from the PLC typechecker.
For PIR type-checking, we port the `checkTypeM` and `inferTypeM` from PLC typechecker.
The port is a direct copy, except for the modifications of `Term` to `PIR.Term`
and error type signatures and `throwError` to accommodate for the new pir type-errors.
These modifications are currently necessary since PIR.Term ADT /= PLC.Term ADT.
We then extend this ported `PIR.inferTypeM` with cases for inferring type of LetRec and LetNonRec.

See Note [Notation] of PlutusCore.TypeCheck.Internal for the notation of inference rules, which appear in the comments.
-}</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">{- Note [PIR vs Paper Syntax Difference]
Link to the paper: &lt;https://hydra.iohk.io/job/Cardano/plutus/linux.papers.unraveling-recursion/latest/download-by-type/doc-pdf/unraveling-recursion&gt;
FIR's syntax requires that the data-constructor is annotated with a *list of its argument types* (domain),
instead of requiring a single valid type T (usually in the form `dataconstr : arg1 -&gt; arg2 -&gt;... argn`)
The codomain is also left out of the syntax and implied to be of the type `[TypeCons tyarg1 tyarg2 ... tyargn]`
(what would be expected for a non-GADT). Finally, the leading &quot;forall type-parameters&quot; are implicit (since they are consider in scope).

PIR's syntax requires that a full (valid) type is written for the data-constructor, using the syntax for types
(the forall type-parameters remains implicit). This means that the codomain has to be be explicitly given in PIR.
To make sure that the PIR-user has written down the expected non-GADT type we do an extra codomainCheck.
This codomainCheck will have to be relaxed if/when PIR introduces GADTs.
More importantly, since the type for the PIR data-constructor can be any syntax-valid type,
the PIR user may have placed inside there a non-normalized type there. Currently, the PIR typechecker will
assume the types of all data-constructors are prior normalized *before* type-checking, otherwise
the PIR typechecking and PIR compilation will fail.
See NOTE [Normalization of data-constructors' types] at PlutusIR.Compiler.Datatype
-}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">{- Note [PIR vs Paper Escaping Types Difference]
Link to the paper: &lt;https://hydra.iohk.io/job/Cardano/plutus/linux.papers.unraveling-recursion/latest/download-by-type/doc-pdf/unraveling-recursion&gt;
In FIR paper's Fig.6, T-Let and T-LetRec rules dictate that: Gamma !- inTerm :: * for two reasons:
1. check (locally) that the kind of the in-term's inferred type is indeed *
2. ensure that the inferred type does not escaping its scope (hence Gamma)

This is in general true for the PIR implementation as well, except in the special
case when a Type is inferred for the top-level expression (`program`-level).
In contrast to (2), we allow such a &quot;top-level&quot; type to escape its scope;
the reasoning is that PIR programs with toplevel escaping types would behave correctly when they are translated down to PLC.
Even in the case where we let the type variables escape, (1) must still hold:
the kind of the escaping type should still be star. Unfortunately, in order to check that we'd have to use the variables
which are no longer in scope. So we skip the rule (Gamma !- inTermTopLevel :: *) in case of top-level inferred types.

The implementation has a user-configurable flag to let the typechecker know if the current term under examination
is at the program's &quot;top-level&quot; position, and thus allow its type to escape. The flag is automatically set to no-type-escape
when typechecking inside a let termbind's rhs term.
-}</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | a shorthand for our pir-specialized tc functions</span><span>
</span><span id="line-98"></span><span class="hs-keyword">type</span><span> </span><span id="PirTCEnv"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-var">PirTCEnv</span></a></span></span><span> </span><span id="local-6989586621681113942"><span class="annot"><a href="#local-6989586621681113942"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681113941"><span class="annot"><a href="#local-6989586621681113941"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681113940"><span class="annot"><a href="#local-6989586621681113940"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113942"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113941"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113942"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113941"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681113940"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | The constraints that are required for type checking Plutus IR.</span><span>
</span><span id="line-101"></span><span class="hs-keyword">type</span><span> </span><span id="MonadTypeCheckPir"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-var">MonadTypeCheckPir</span></a></span></span><span> </span><span id="local-6989586621681113939"><span class="annot"><a href="#local-6989586621681113939"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621681113938"><span class="annot"><a href="#local-6989586621681113938"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681113937"><span class="annot"><a href="#local-6989586621681113937"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681113936"><span class="annot"><a href="#local-6989586621681113936"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span id="local-6989586621681113935"><span class="annot"><a href="#local-6989586621681113935"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#MonadTypeCheck"><span class="hs-identifier hs-type">MonadTypeCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113939"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113938"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113937"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681113938"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113937"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113936"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113935"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Error.html#AsTypeErrorExt"><span class="hs-identifier hs-type">AsTypeErrorExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113939"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113938"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681113936"><span class="hs-identifier hs-type">ann</span></a></span><span>  </span><span class="hs-comment">-- Plutus IR has additional type errors, see 'TypeErrorExt'.</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- ###########################</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- ## Port of Type checking ##</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- ##########################</span><span>
</span><span id="line-109"></span><span class="hs-comment">--  Taken from `PlutusCore.Typecheck.Internal`</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- See the [Global uniqueness] and [Type rules] notes.</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Check a 'Term' against a 'NormalizedType'.</span><span>
</span><span id="line-113"></span><span id="local-6989586621681114375"><span id="local-6989586621681114376"><span id="local-6989586621681114377"><span id="local-6989586621681114378"><span id="local-6989586621681114379"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-type">checkTypeM</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-type">MonadTypeCheckPir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114379"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114378"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114377"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114376"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114375"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114376"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114378"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114377"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114376"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114378"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114378"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114377"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114375"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- [infer| G !- term : vTermTy]    vTermTy ~ vTy</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- ---------------------------------------------</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- [check| G !- term : vTy]</span><span>
</span><span id="line-123"></span><span id="checkTypeM"><span class="annot"><span class="annottext">checkTypeM :: forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var hs-var">checkTypeM</span></a></span></span><span> </span><span id="local-6989586621681113894"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113894"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113893"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113893"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621681113892"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113892"><span class="hs-identifier hs-var">vTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621681113891"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113891"><span class="hs-identifier hs-var">vTermTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113893"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113891"><span class="hs-identifier hs-var">vTermTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113892"><span class="hs-identifier hs-var">vTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">throwing</span></a></span><span> </span><span class="annot"><span class="annottext">forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113894"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113893"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113892"><span class="hs-identifier hs-var">vTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113891"><span class="hs-identifier hs-var">vTermTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- See the [Global uniqueness] and [Type rules] notes.</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Synthesize the type of a term, returning a normalized type.</span><span>
</span><span id="line-129"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-type">inferTypeM</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681114327"><span class="annot"><a href="#local-6989586621681114327"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621681114323"><span class="annot"><a href="#local-6989586621681114323"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681114326"><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681114325"><span class="annot"><a href="#local-6989586621681114325"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681114324"><span class="annot"><a href="#local-6989586621681114324"><span class="hs-identifier hs-type">ann</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-131"></span><span>       </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-type">MonadTypeCheckPir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114327"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114325"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114324"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114323"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114325"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114324"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114325"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114323"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- c : vTy</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- -------------------------</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- [infer| G !- con c : vTy]</span><span>
</span><span id="line-136"></span><span id="inferTypeM"><span class="annot"><span class="annottext">inferTypeM :: forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var hs-var">inferTypeM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../some/html/src"><span class="hs-identifier hs-type">Some</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#ValueOf"><span class="hs-identifier hs-type">ValueOf</span></a></span><span> </span><span id="local-6989586621681113676"><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681113676"><span class="hs-identifier hs-var">uni</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- See Note [Normalization of built-in types].</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k (a :: k) (uni :: * -&gt; *) tyname ann.
ann -&gt; uni (Esc a) -&gt; Type tyname uni ann
</span><a href="PlutusCore.MkPlc.html#mkTyBuiltinOf"><span class="hs-identifier hs-var">PIR.mkTyBuiltinOf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621681113676"><span class="hs-identifier hs-var">uni</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- [infer| G !- bi : vTy]</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- ------------------------------</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- [infer| G !- builtin bi : vTy]</span><span>
</span><span id="line-143"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621681113672"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113672"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113671"><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681113671"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadTypeCheck err term uni fun ann m,
 HasTypeCheckConfig cfg uni fun) =&gt;
ann
-&gt; fun
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#lookupBuiltinM"><span class="hs-identifier hs-var">lookupBuiltinM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113672"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681113671"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- [infer| G !- v : ty]    ty ~&gt; vTy</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- ---------------------------------</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- [infer| G !- var v : vTy]</span><span>
</span><span id="line-149"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681113668"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113668"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113667"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681113667"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadTypeCheck err term uni fun ann m,
 HasTypeCheckConfig cfg uni fun) =&gt;
ann
-&gt; Name
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#lookupVarM"><span class="hs-identifier hs-var">lookupVarM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113668"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681113667"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- [check| G !- dom :: *]    dom ~&gt; vDom    [infer| G , n : dom !- body : vCod]</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- [infer| G !- lam n dom body : vDom -&gt; vCod]</span><span>
</span><span id="line-155"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621681113664"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113664"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113663"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681113663"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681113662"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113662"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621681113661"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113661"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113664"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113662"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621681113658"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113658"><span class="hs-identifier hs-var">vDom</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113662"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113658"><span class="hs-identifier hs-var">vDom</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Applicative f1, Applicative f2) =&gt;
f1 (f2 (a -&gt; b)) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%2A%3E%3E"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusCore.TypeCheck.Internal.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681113663"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113658"><span class="hs-identifier hs-var">vDom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113661"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- [infer| G , n :: nK !- body : vBodyTy]</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- ---------------------------------------------------</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- [infer| G !- abs n nK body : all (n :: nK) vBodyTy]</span><span>
</span><span id="line-163"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113652"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681113652"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681113651"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681113651"><span class="hs-identifier hs-var">nK</span></a></span></span><span> </span><span id="local-6989586621681113650"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113650"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681113647"><span class="annot"><span class="annottext">nK_ :: Kind ()
</span><a href="#local-6989586621681113647"><span class="hs-identifier hs-var hs-var">nK_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681113651"><span class="hs-identifier hs-var">nK</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681113652"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113647"><span class="hs-identifier hs-var">nK_</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
TyName
-&gt; Kind ()
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusCore.TypeCheck.Internal.html#withTyVar"><span class="hs-identifier hs-var">withTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681113652"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113647"><span class="hs-identifier hs-var">nK_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113650"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- [infer| G !- fun : vDom -&gt; vCod]    [check| G !- arg : vDom]</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- [infer| G !- fun arg : vCod]</span><span>
</span><span id="line-170"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621681113643"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113643"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113642"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113642"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681113641"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113641"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621681113640"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113640"><span class="hs-identifier hs-var">vFunTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113642"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113640"><span class="hs-identifier hs-var">vFunTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-type">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113639"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113639"><span class="hs-identifier hs-var">vDom</span></a></span></span><span> </span><span id="local-6989586621681113638"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113638"><span class="hs-identifier hs-var">vCod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>            </span><span class="hs-comment">-- Subparts of a normalized type, so normalized.</span><span>
</span><span id="line-175"></span><span>            </span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var">checkTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113643"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113641"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113639"><span class="hs-identifier hs-var">vDom</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113638"><span class="hs-identifier hs-var">vCod</span></a></span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">throwing</span></a></span><span> </span><span class="annot"><span class="annottext">forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113643"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113642"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113640"><span class="hs-identifier hs-var">vFunTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">-- [infer| G !- body : all (n :: nK) vCod]    [check| G !- ty :: tyK]    ty ~&gt; vTy</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- -------------------------------------------------------------------------------</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- [infer| G !- body {ty} : NORM ([vTy / n] vCod)]</span><span>
</span><span id="line-182"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span id="local-6989586621681113634"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113634"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113633"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113633"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621681113632"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113632"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621681113631"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113631"><span class="hs-identifier hs-var">vBodyTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113633"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113631"><span class="hs-identifier hs-var">vBodyTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-type">TyForall</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113630"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681113630"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681113629"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113629"><span class="hs-identifier hs-var">nK</span></a></span></span><span> </span><span id="local-6989586621681113628"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113628"><span class="hs-identifier hs-var">vCod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>            </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113634"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113632"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113629"><span class="hs-identifier hs-var">nK</span></a></span><span>
</span><span id="line-187"></span><span>            </span><span id="local-6989586621681113627"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113627"><span class="hs-identifier hs-var">vTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113632"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-188"></span><span>            </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) fun cfg.
MonadNormalizeType uni m =&gt;
Normalized (Type TyName uni ())
-&gt; TyName
-&gt; Type TyName uni ()
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#substNormalizeTypeM"><span class="hs-identifier hs-var">substNormalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113627"><span class="hs-identifier hs-var">vTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681113630"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113628"><span class="hs-identifier hs-var">vCod</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">throwing</span></a></span><span> </span><span class="annot"><span class="annottext">forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113634"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113633"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyTyName"><span class="hs-identifier hs-var">dummyTyName</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113631"><span class="hs-identifier hs-var">vBodyTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- [infer| G !- arg :: k]    [check| G !- pat :: (k -&gt; *) -&gt; k -&gt; *]    pat ~&gt; vPat    arg ~&gt; vArg</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- [check| G !- term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- -----------------------------------------------------------------------------------------------</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- [infer| G !- iwrap pat arg term : ifix vPat vArg]</span><span>
</span><span id="line-195"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span id="local-6989586621681113622"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113622"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113621"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113621"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681113620"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113620"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681113619"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113619"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621681113618"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113618"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
Type TyName uni ann -&gt; TypeCheckT uni fun cfg m (Kind ())
</span><a href="PlutusCore.TypeCheck.Internal.html#inferKindM"><span class="hs-identifier hs-var">inferKindM</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113620"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113622"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113621"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind () -&gt; Kind ()
</span><a href="PlutusCore.Core.Type.html#toPatFuncKind"><span class="hs-identifier hs-var">toPatFuncKind</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113618"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621681113616"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113616"><span class="hs-identifier hs-var">vPat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113621"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621681113615"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113615"><span class="hs-identifier hs-var">vArg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113620"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var">checkTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113622"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113619"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) fun cfg.
MonadNormalizeType uni m =&gt;
Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Kind ()
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#unfoldIFixOf"><span class="hs-identifier hs-var">unfoldIFixOf</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113616"><span class="hs-identifier hs-var">vPat</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113615"><span class="hs-identifier hs-var">vArg</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113618"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113616"><span class="hs-identifier hs-var">vPat</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113615"><span class="hs-identifier hs-var">vArg</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- [infer| G !- term : ifix vPat vArg]    [infer| G !- vArg :: k]</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- [infer| G !- unwrap term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><span id="line-206"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-type">Unwrap</span></a></span><span> </span><span id="local-6989586621681113609"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113609"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113608"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113608"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>    </span><span id="local-6989586621681113607"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113607"><span class="hs-identifier hs-var">vTermTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113608"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113607"><span class="hs-identifier hs-var">vTermTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-type">TyIFix</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113606"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113606"><span class="hs-identifier hs-var">vPat</span></a></span></span><span> </span><span id="local-6989586621681113605"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113605"><span class="hs-identifier hs-var">vArg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>            </span><span id="local-6989586621681113604"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113604"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
Type TyName uni ann -&gt; TypeCheckT uni fun cfg m (Kind ())
</span><a href="PlutusCore.TypeCheck.Internal.html#inferKindM"><span class="hs-identifier hs-var">inferKindM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113609"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113605"><span class="hs-identifier hs-var">vArg</span></a></span><span>
</span><span id="line-211"></span><span>            </span><span class="hs-comment">-- Subparts of a normalized type, so normalized.</span><span>
</span><span id="line-212"></span><span>            </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) fun cfg.
MonadNormalizeType uni m =&gt;
Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Kind ()
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#unfoldIFixOf"><span class="hs-identifier hs-var">unfoldIFixOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113606"><span class="hs-identifier hs-var">vPat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621681113605"><span class="hs-identifier hs-var">vArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621681113604"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">throwing</span></a></span><span> </span><span class="annot"><span class="annottext">forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113609"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113608"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113607"><span class="hs-identifier hs-var">vTermTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- [check| G !- ty :: *]    ty ~&gt; vTy</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- ----------------------------------</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- [infer| G !- error ty : vTy]</span><span>
</span><span id="line-218"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621681113601"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113601"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113600"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113600"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113601"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113600"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113600"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- ##############</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- ## Port end ##</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- ##############</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Note on symbols:  '=&gt;' means implies</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">{-
checkKindFromBinding(G,b) checkTypeFromBinding(G,b)
!null(bs) =&gt; [infer| G,withVarsOfBinding(b),withTyVarsOfBinding(b) !- (let nonrec {bs} in inT) : ty]
null(bs) =&gt; [infer| G,withVarsOfBinding(b),withTyVarsOfBinding(b) !- inT : ty]
ty ~&gt; vTy
-------------------------------------------------
[infer| G !- (let nonrec {b ; bs} in inT) : vTy]
-}</span><span>
</span><span id="line-235"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621681113598"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113598"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113597"><span class="annot"><span class="annottext">r :: Recursivity
</span><a href="#local-6989586621681113597"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span id="local-6989586621681113595"><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113595"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681113594"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113594"><span class="hs-identifier hs-var">inTerm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- Check each binding individually, then if ok, introduce its new type/vars to the (linearly) next let or inTerm</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621681113593"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113593"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) fun ann.
MonadNormalizeType uni m =&gt;
NonEmpty (Binding TyName Name uni fun ann)
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#substTypeBinds"><span class="hs-identifier hs-var">substTypeBinds</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113595"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a.
Binding TyName Name uni fun ann
-&gt; PirTCEnv uni fun m a -&gt; PirTCEnv uni fun m a
</span><a href="#local-6989586621681113590"><span class="hs-identifier hs-var">checkBindingThenScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113594"><span class="hs-identifier hs-var">inTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113595"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">-- check the in-term's inferred type has kind * (except at toplevel)</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadKindCheck err (Term TyName Name uni fun ()) uni fun ann m =&gt;
ann -&gt; Normalized (Type TyName uni ()) -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-var">checkStarInferred</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113598"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113593"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113593"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621681114185"><span class="annot"><a href="#local-6989586621681113590"><span class="hs-identifier hs-type">checkBindingThenScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114325"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114324"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114325"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114323"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114185"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114326"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114325"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114323"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114185"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621681113590"><span class="annot"><span class="annottext">checkBindingThenScope :: forall a.
Binding TyName Name uni fun ann
-&gt; PirTCEnv uni fun m a -&gt; PirTCEnv uni fun m a
</span><a href="#local-6989586621681113590"><span class="hs-identifier hs-var hs-var">checkBindingThenScope</span></a></span></span><span> </span><span id="local-6989586621681113576"><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621681113576"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681113575"><span class="annot"><span class="annottext">PirTCEnv uni fun m a
</span><a href="#local-6989586621681113575"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-comment">-- check that the kinds of the declared types are correct</span><span>
</span><span id="line-245"></span><span>        </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadKindCheck err (Term TyName Name uni fun ()) uni fun ann m =&gt;
Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-var">checkKindFromBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621681113576"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-comment">-- check that the types of declared terms are correct</span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Recursivity
-&gt; Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-var">checkTypeFromBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113597"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621681113576"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-comment">-- add new *normalized* termvariables to env</span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-comment">-- Note that the order of adding typesVSkinds here does not matter</span><span>
</span><span id="line-250"></span><span>        </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann cfg (m :: * -&gt; *) a.
Binding TyName name uni fun ann
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-var">withTyVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621681113576"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg ann (m :: * -&gt; *) a.
MonadNormalizeType uni m =&gt;
Recursivity
-&gt; Binding TyName Name uni fun ann
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113597"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621681113576"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCEnv uni fun m a
</span><a href="#local-6989586621681113575"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">{-
G'=G,withTyVarsOfBindings(bs)
forall b in bs. checkKindFromBinding(G', b)
G''=G',withVarsOfBindings(bs)
forall b in bs. checkTypeFromBinding(G'', b)
[infer| G'' !- inT : ty] ty ~&gt; vTy
-------------------------------------------------
[infer| G !- (let rec bs in inT) : vTy]
-}</span><span>
</span><span id="line-262"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621681113570"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113570"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113569"><span class="annot"><span class="annottext">r :: Recursivity
</span><a href="#local-6989586621681113569"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span id="local-6989586621681113567"><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113567"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681113566"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113566"><span class="hs-identifier hs-var">inTerm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621681113565"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113565"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) name (uni :: * -&gt; *) fun ann cfg (m :: * -&gt; *)
       a.
Foldable f =&gt;
f (Binding TyName name uni fun ann)
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBindings"><span class="hs-identifier hs-var">withTyVarsOfBindings</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113567"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-comment">-- check that the kinds of the declared types *over all bindings* are correct</span><span>
</span><span id="line-265"></span><span>       </span><span class="hs-comment">-- Note that, compared to NonRec, we need the newtyvars in scope to do kindchecking</span><span>
</span><span id="line-266"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113567"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadKindCheck err (Term TyName Name uni fun ()) uni fun ann m =&gt;
Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-var">checkKindFromBinding</span></a></span><span>
</span><span id="line-267"></span><span>        </span><span id="local-6989586621681113562"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113562"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) (t :: * -&gt; *) fun ann cfg a.
(MonadNormalizeType uni m, Foldable t) =&gt;
Recursivity
-&gt; t (Binding TyName Name uni fun ann)
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBindings"><span class="hs-identifier hs-var">withVarsOfBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113569"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113567"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>               </span><span class="hs-comment">-- check that the types of declared terms are correct</span><span>
</span><span id="line-269"></span><span>              </span><span class="hs-comment">-- Note that, compared to NonRec, we need the newtyvars+newvars in scope to do typechecking</span><span>
</span><span id="line-270"></span><span>              </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113567"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Recursivity
-&gt; Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-var">checkTypeFromBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113569"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-271"></span><span>              </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113566"><span class="hs-identifier hs-var">inTerm</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) fun ann.
MonadNormalizeType uni m =&gt;
NonEmpty (Binding TyName Name uni fun ann)
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#substTypeBinds"><span class="hs-identifier hs-var">substTypeBinds</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113567"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113562"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-comment">-- check the in-term's inferred type has kind * (except at toplevel)</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadKindCheck err (Term TyName Name uni fun ()) uni fun ann m =&gt;
ann -&gt; Normalized (Type TyName uni ()) -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-var">checkStarInferred</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113570"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113565"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113565"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-comment">{-| This checks that a newly-introduced type variable is correctly kinded.

(b is ty::K = rhs) =&gt; [check| G !- rhs :: K]
(b is term (X::T) =&gt; [check| G !- T :: *])
(b is data (X::K) tyarg1::K1 ... tyargN::KN  = _) =&gt; [check| G, X::K, tyarg1::K1...tyargN::KN !- [X tyarg1 ... tyargN] :: *]
--------------------------------------------------------------------------------------
checkKindFromBinding(G,b)
-}</span><span>
</span><span id="line-285"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-type">checkKindFromBinding</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681114178"><span class="annot"><a href="#local-6989586621681114178"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621681114174"><span class="annot"><a href="#local-6989586621681114174"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681114177"><span class="annot"><a href="#local-6989586621681114177"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681114176"><span class="annot"><a href="#local-6989586621681114176"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681114175"><span class="annot"><a href="#local-6989586621681114175"><span class="hs-identifier hs-type">ann</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-287"></span><span>       </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#MonadKindCheck"><span class="hs-identifier hs-type">MonadKindCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114178"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114177"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114176"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681114177"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114176"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114175"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114174"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114177"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114176"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114175"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114177"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114176"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114174"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span id="checkKindFromBinding"><span class="annot"><span class="annottext">checkKindFromBinding :: forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadKindCheck err (Term TyName Name uni fun ()) uni fun ann m =&gt;
Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-var hs-var">checkKindFromBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-comment">-- For a type binding, correct means that the the RHS is indeed kinded by the declared kind.</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span id="local-6989586621681113529"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113529"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113528"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681113528"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681113527"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113527"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113529"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113527"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681113528"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-comment">-- For a term binding, correct means that the declared type has kind *.</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113524"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113524"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann. Type tyname uni ann -&gt; ann
</span><a href="PlutusCore.Core.Type.html#typeAnn"><span class="hs-identifier hs-var">typeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113524"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113524"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-comment">-- For a datatype binding, correct means that the type constructor has kind * when fully-applied to its type arguments.</span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113522"><span class="annot"><span class="annottext">dt :: Datatype TyName Name uni ann
</span><a href="#local-6989586621681113522"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span id="local-6989586621681113520"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113520"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113519"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113519"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681113518"><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681113518"><span class="hs-identifier hs-var">tyargs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113517"><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681113517"><span class="hs-identifier hs-var">vdecls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-comment">-- tycon+tyargs must be in scope during kindchecking</span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">forall ann (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
[TyVarDecl TyName ann]
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113519"><span class="hs-identifier hs-var">tycon</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681113518"><span class="hs-identifier hs-var">tyargs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>          </span><span class="hs-comment">-- the fully-applied type-constructor must be *-kinded</span><span>
</span><span id="line-302"></span><span>          </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113520"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113515"><span class="hs-identifier hs-var">appliedTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>          </span><span class="hs-comment">-- the types of all the data-constructors must be *-kinded</span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
VarDecl tyname name uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681113517"><span class="hs-identifier hs-var">vdecls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-305"></span><span>               </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113520"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">`flip`</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>       </span><span id="local-6989586621681113515"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113515"><span class="hs-identifier hs-var">appliedTyCon</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114177"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114175"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (uni :: * -&gt; *).
a -&gt; Datatype TyName Name uni a -&gt; Type TyName uni a
</span><a href="PlutusIR.Compiler.Datatype.html#mkDatatypeValueType"><span class="hs-identifier hs-var">mkDatatypeValueType</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113520"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681113522"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">{- | This checks that a newly-introduced variable has declared the *right type* for its term
(rhs term in case of termbind or implicit constructor term in case of dataconstructor).

(b is t:ty = _) =&gt; [check| G !- t : nTy]  ty ~&gt; vTy
---------------------------------------------------
checkTypeFromBinding(G,b)
-}</span><span>
</span><span id="line-317"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-type">checkTypeFromBinding</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681114173"><span class="annot"><a href="#local-6989586621681114173"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621681114169"><span class="annot"><a href="#local-6989586621681114169"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681114172"><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681114171"><span class="annot"><a href="#local-6989586621681114171"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681114170"><span class="annot"><a href="#local-6989586621681114170"><span class="hs-identifier hs-type">ann</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-319"></span><span>       </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-type">MonadTypeCheckPir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114173"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114171"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114170"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114169"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Recursivity"><span class="hs-identifier hs-type">Recursivity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114171"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114170"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114171"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114169"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span id="checkTypeFromBinding"><span class="annot"><span class="annottext">checkTypeFromBinding :: forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Recursivity
-&gt; Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-var hs-var">checkTypeFromBinding</span></a></span></span><span> </span><span id="local-6989586621681113467"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113467"><span class="hs-identifier hs-var">recurs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- no types to check</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621681113466"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113466"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113465"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113465"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681113464"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113464"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-comment">-- See Note [PIR vs Paper Escaping Types Difference]</span><span>
</span><span id="line-325"></span><span>        </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
PirTCEnv uni fun m a -&gt; PirTCEnv uni fun m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withNoEscapingTypes"><span class="hs-identifier hs-var">withNoEscapingTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var">checkTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113466"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681113464"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113465"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113461"><span class="annot"><span class="annottext">dt :: Datatype TyName Name uni ann
</span><a href="#local-6989586621681113461"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span id="local-6989586621681113460"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113460"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113459"><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681113459"><span class="hs-identifier hs-var">tyargs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113458"><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681113458"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-327"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
VarDecl tyname name uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681113458"><span class="hs-identifier hs-var">constrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-328"></span><span>            </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681113457"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113457"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; PirTCEnv uni fun m ()
</span><a href="#local-6989586621681113456"><span class="hs-identifier hs-var">checkConRes</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113457"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; PirTCEnv uni fun m ()
</span><a href="#local-6989586621681113455"><span class="hs-identifier hs-var">checkNonRecScope</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113457"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-330"></span><span>       </span><span id="local-6989586621681113454"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113454"><span class="hs-identifier hs-var">appliedTyCon</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114170"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (uni :: * -&gt; *).
a -&gt; Datatype TyName Name uni a -&gt; Type TyName uni a
</span><a href="PlutusIR.Compiler.Datatype.html#mkDatatypeValueType"><span class="hs-identifier hs-var">mkDatatypeValueType</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113460"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681113461"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-331"></span><span>       </span><span class="annot"><a href="#local-6989586621681113456"><span class="hs-identifier hs-type">checkConRes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114170"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114171"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114169"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>       </span><span id="local-6989586621681113456"><span class="annot"><span class="annottext">checkConRes :: Type TyName uni ann -&gt; PirTCEnv uni fun m ()
</span><a href="#local-6989586621681113456"><span class="hs-identifier hs-var hs-var">checkConRes</span></a></span></span><span> </span><span id="local-6989586621681113453"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113453"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>           </span><span class="hs-comment">-- We earlier checked that datacons' type is *-kinded (using checkKindBinding), but this is not enough:</span><span>
</span><span id="line-334"></span><span>           </span><span class="hs-comment">-- we must also check that its result type is EXACTLY `[[TypeCon tyarg1] ... tyargn]` (ignoring annotations)</span><span>
</span><span id="line-335"></span><span>           </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni a -&gt; Type tyname uni a
</span><a href="PlutusIR.Compiler.Datatype.html#funResultType"><span class="hs-identifier hs-var">funResultType</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113453"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113454"><span class="hs-identifier hs-var">appliedTyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-336"></span><span>               </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">throwing</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (uni :: * -&gt; *) ann.
AsTypeErrorExt r uni ann =&gt;
Prism' r (TypeErrorExt uni ann)
</span><a href="PlutusIR.Error.html#_TypeErrorExt"><span class="hs-identifier hs-var">_TypeErrorExt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) ann.
ann -&gt; Type TyName uni ann -&gt; TypeErrorExt uni ann
</span><a href="PlutusIR.Error.html#MalformedDataConstrResType"><span class="hs-identifier hs-var">MalformedDataConstrResType</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113460"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113454"><span class="hs-identifier hs-var">appliedTyCon</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>       </span><span class="hs-comment">-- if nonrec binding, make sure that type-constructor is not part of the data-constructor's argument types.</span><span>
</span><span id="line-339"></span><span>       </span><span class="annot"><a href="#local-6989586621681113455"><span class="hs-identifier hs-type">checkNonRecScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114170"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114172"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114171"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114169"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>       </span><span id="local-6989586621681113455"><span class="annot"><span class="annottext">checkNonRecScope :: Type TyName uni ann -&gt; PirTCEnv uni fun m ()
</span><a href="#local-6989586621681113455"><span class="hs-identifier hs-var hs-var">checkNonRecScope</span></a></span></span><span> </span><span id="local-6989586621681113449"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113449"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113467"><span class="hs-identifier hs-var">recurs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-341"></span><span>           </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>           </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>               </span><span class="hs-comment">-- now we make sure that dataconstructor is not self-recursive, i.e. funargs don't contain tycon</span><span>
</span><span id="line-344"></span><span>               </span><span class="annot"><span class="annottext">forall ann (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
[TyVarDecl TyName ann]
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681113459"><span class="hs-identifier hs-var">tyargs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- tycon not in scope here</span><span>
</span><span id="line-345"></span><span>                      </span><span class="hs-comment">-- OPTIMIZE: we use inferKind for scope-checking, but a simple ADT-traversal would suffice</span><span>
</span><span id="line-346"></span><span>                      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni a -&gt; [Type tyname uni a]
</span><a href="PlutusIR.Compiler.Datatype.html#funTyArgs"><span class="hs-identifier hs-var">funTyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113449"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
Type TyName uni ann -&gt; TypeCheckT uni fun cfg m (Kind ())
</span><a href="PlutusCore.TypeCheck.Internal.html#inferKindM"><span class="hs-identifier hs-var">inferKindM</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">-- | Check that the in-Term's inferred type of a Let has kind *.</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- Skip this check at the top-level, to allow top-level types to escape; see Note [PIR vs Paper Escaping Types Difference].</span><span>
</span><span id="line-350"></span><span id="local-6989586621681114180"><span id="local-6989586621681114181"><span id="local-6989586621681114182"><span id="local-6989586621681114183"><span id="local-6989586621681114184"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-type">checkStarInferred</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#MonadKindCheck"><span class="hs-identifier hs-type">MonadKindCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114184"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114183"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114182"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681114183"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114182"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114181"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114180"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114181"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114183"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114183"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114182"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114180"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-353"></span><span id="checkStarInferred"><span class="annot"><span class="annottext">checkStarInferred :: forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadKindCheck err (Term TyName Name uni fun ()) uni fun ann m =&gt;
ann -&gt; Normalized (Type TyName uni ()) -&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-var hs-var">checkStarInferred</span></a></span></span><span> </span><span id="local-6989586621681113429"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113429"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681113428"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113428"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621681113427"><span class="annot"><span class="annottext">AllowEscape
</span><a href="#local-6989586621681113427"><span class="hs-identifier hs-var">allowEscape</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun1 cfg1 fun2 cfg2.
Lens
  (TypeCheckEnv uni fun1 cfg1) (TypeCheckEnv uni fun2 cfg2) cfg1 cfg2
</span><a href="PlutusCore.TypeCheck.Internal.html#tceTypeCheckConfig"><span class="hs-identifier hs-var">tceTypeCheckConfig</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun. Lens' (PirTCConfig uni fun) AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#pirConfigAllowEscape"><span class="hs-identifier hs-var">pirConfigAllowEscape</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="#local-6989586621681113427"><span class="hs-identifier hs-var">allowEscape</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>        </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#NoEscape"><span class="hs-identifier hs-var">NoEscape</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *) cfg.
(MonadKindCheck err term uni fun ann m, HasKindCheckConfig cfg) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckT uni fun cfg m ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113429"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681113429"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113428"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-comment">-- NOTE: we completely skip the check in case of toplevel because we would need an *final, extended Gamma environment*</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-comment">-- to run the kind-check in, but we cannot easily get that since we are using a Reader for environments and not State</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#YesEscape"><span class="hs-identifier hs-var">YesEscape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | Changes the flag in nested-lets so to disallow returning a type outside of the type's scope</span><span>
</span><span id="line-363"></span><span id="local-6989586621681114101"><span id="local-6989586621681114102"><span id="local-6989586621681114103"><span id="local-6989586621681114104"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withNoEscapingTypes"><span class="hs-identifier hs-type">withNoEscapingTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114104"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114103"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114102"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114101"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114104"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114103"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114102"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114101"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-364"></span><span id="withNoEscapingTypes"><span class="annot"><span class="annottext">withNoEscapingTypes :: forall (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
PirTCEnv uni fun m a -&gt; PirTCEnv uni fun m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withNoEscapingTypes"><span class="hs-identifier hs-var hs-var">withNoEscapingTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a.
(r -&gt; r) -&gt; ReaderT r m a -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun1 cfg1 fun2 cfg2.
Lens
  (TypeCheckEnv uni fun1 cfg1) (TypeCheckEnv uni fun2 cfg2) cfg1 cfg2
</span><a href="PlutusCore.TypeCheck.Internal.html#tceTypeCheckConfig"><span class="hs-identifier hs-var">tceTypeCheckConfig</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun. Lens' (PirTCConfig uni fun) AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#pirConfigAllowEscape"><span class="hs-identifier hs-var">pirConfigAllowEscape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#NoEscape"><span class="hs-identifier hs-var">NoEscape</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">-- | Run a 'TypeCheckM' computation by supplying a 'TypeCheckConfig' to it.</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- Differs from its PLC version in that is passes an extra env flag 'YesEscape'.</span><span>
</span><span id="line-368"></span><span id="local-6989586621681114042"><span id="local-6989586621681114043"><span id="local-6989586621681114044"><span id="local-6989586621681114045"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier hs-type">runTypeCheckM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114045"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114044"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114045"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114044"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114043"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114042"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114043"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114042"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-369"></span><span id="runTypeCheckM"><span class="annot"><span class="annottext">runTypeCheckM :: forall (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
PirTCConfig uni fun -&gt; PirTCEnv uni fun m a -&gt; m a
</span><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier hs-var hs-var">runTypeCheckM</span></a></span></span><span> </span><span id="local-6989586621681113413"><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681113413"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681113412"><span class="annot"><span class="annottext">PirTCEnv uni fun m a
</span><a href="#local-6989586621681113412"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCEnv uni fun m a
</span><a href="#local-6989586621681113412"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg.
cfg -&gt; TyVarKinds -&gt; VarTypes uni -&gt; TypeCheckEnv uni fun cfg
</span><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckEnv"><span class="hs-identifier hs-var">TypeCheckEnv</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681113413"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- Helpers</span><span>
</span><span id="line-372"></span><span class="hs-comment">----------</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="hs-comment">-- | For a single binding, generate the newly-introduce term-variables' types,</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- normalize them, rename them and add them into scope.</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- Newly-declared term variables are: variables of termbinds, constructors, destructor</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- Note: Assumes that the input is globally-unique and preserves global-uniqueness</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- Note to self: actually passing here recursivity is unnecessary, but we do it for sake of compiler/datatype.hs api</span><span>
</span><span id="line-379"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-type">withVarsOfBinding</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681114161"><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681114159"><span class="annot"><a href="#local-6989586621681114159"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681114157"><span class="annot"><a href="#local-6989586621681114157"><span class="hs-identifier hs-type">cfg</span></a></span></span><span> </span><span id="local-6989586621681114158"><span class="annot"><a href="#local-6989586621681114158"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span id="local-6989586621681114160"><span class="annot"><a href="#local-6989586621681114160"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681114156"><span class="annot"><a href="#local-6989586621681114156"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-381"></span><span>       </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier hs-type">MonadNormalizeType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114160"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Recursivity"><span class="hs-identifier hs-type">Recursivity</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114159"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114158"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114159"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114157"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114160"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114156"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114159"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114157"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114160"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114156"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-386"></span><span id="withVarsOfBinding"><span class="annot"><span class="annottext">withVarsOfBinding :: forall (uni :: * -&gt; *) fun cfg ann (m :: * -&gt; *) a.
MonadNormalizeType uni m =&gt;
Recursivity
-&gt; Binding TyName Name uni fun ann
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var hs-var">withVarsOfBinding</span></a></span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621681113391"><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113391"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113391"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-387"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113390"><span class="annot"><span class="annottext">VarDecl TyName Name uni ann
</span><a href="#local-6989586621681113390"><span class="hs-identifier hs-var">vdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681113389"><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113389"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621681113388"><span class="annot"><span class="annottext">Normalized (Type TyName uni ann)
</span><a href="#local-6989586621681113388"><span class="hs-identifier hs-var">vTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
VarDecl tyname name uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni ann
</span><a href="#local-6989586621681113390"><span class="hs-identifier hs-var">vdecl</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-comment">-- no need to rename here</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusCore.TypeCheck.Internal.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
VarDecl tyname name uni ann -&gt; name
</span><a href="PlutusCore.Core.Type.html#_varDeclName"><span class="hs-identifier hs-var">_varDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni ann
</span><a href="#local-6989586621681113390"><span class="hs-identifier hs-var">vdecl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ann)
</span><a href="#local-6989586621681113388"><span class="hs-identifier hs-var">vTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113389"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-391"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span id="local-6989586621681113386"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113386"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113385"><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681113385"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681113384"><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113384"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-comment">-- generate all the definitions</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681113383"><span class="annot"><span class="annottext">Def (TyVarDecl TyName (Provenance ann)) (PLCRecType uni Any ann)
</span><a href="#local-6989586621681113383"><span class="hs-identifier hs-var">_tyconstrDef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681113382"><span class="annot"><span class="annottext">[Def
   (VarDecl TyName Name uni (Provenance ann)) (PIRTerm uni Any ann)]
</span><a href="#local-6989586621681113382"><span class="hs-identifier hs-var">constrDefs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681113381"><span class="annot"><span class="annottext">Def
  (VarDecl TyName Name uni (Provenance ann)) (PIRTerm uni Any ann)
</span><a href="#local-6989586621681113381"><span class="hs-identifier hs-var">destrDef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) (uni :: * -&gt; *) a fun.
MonadQuote m =&gt;
Recursivity
-&gt; Datatype TyName Name uni (Provenance a)
-&gt; m (Def (TyVarDecl TyName (Provenance a)) (PLCRecType uni fun a),
      [Def (VarDecl TyName Name uni (Provenance a)) (PIRTerm uni fun a)],
      Def (VarDecl TyName Name uni (Provenance a)) (PIRTerm uni fun a))
</span><a href="PlutusIR.Compiler.Datatype.html#compileDatatypeDefs"><span class="hs-identifier hs-var">compileDatatypeDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113386"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (Provenance a)
</span><a href="PlutusIR.Compiler.Provenance.html#original"><span class="hs-identifier hs-var">original</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681113385"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-comment">-- ignore the generated rhs terms of constructors/destructor</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681113377"><span class="annot"><span class="annottext">structorDecls :: [VarDecl TyName Name uni (Provenance ann)]
</span><a href="#local-6989586621681113377"><span class="hs-identifier hs-var hs-var">structorDecls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall var val. Def var val -&gt; var
</span><a href="PlutusCore.MkPlc.html#defVar"><span class="hs-identifier hs-var">PIR.defVar</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Def
  (VarDecl TyName Name uni (Provenance ann)) (PIRTerm uni Any ann)
</span><a href="#local-6989586621681113381"><span class="hs-identifier hs-var">destrDef</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Def
   (VarDecl TyName Name uni (Provenance ann)) (PIRTerm uni Any ann)]
</span><a href="#local-6989586621681113382"><span class="hs-identifier hs-var">constrDefs</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni (Provenance ann)
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113375"><span class="hs-identifier hs-var">normRenameScope</span></a></span><span> </span><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113384"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni (Provenance ann)]
</span><a href="#local-6989586621681113377"><span class="hs-identifier hs-var">structorDecls</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-comment">-- normalize, then introduce the vardecl to scope</span><span>
</span><span id="line-399"></span><span>      </span><span class="annot"><a href="#local-6989586621681113375"><span class="hs-identifier hs-type">normRenameScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Compiler.Provenance.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114158"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114159"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114157"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114160"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114161"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114159"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114157"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114160"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114156"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-401"></span><span>      </span><span id="local-6989586621681113375"><span class="annot"><span class="annottext">normRenameScope :: VarDecl TyName Name uni (Provenance ann)
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113375"><span class="hs-identifier hs-var hs-var">normRenameScope</span></a></span></span><span> </span><span id="local-6989586621681113374"><span class="annot"><span class="annottext">VarDecl TyName Name uni (Provenance ann)
</span><a href="#local-6989586621681113374"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681113373"><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113373"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>          </span><span id="local-6989586621681113372"><span class="annot"><span class="annottext">Normalized (Type TyName uni (Provenance ann))
</span><a href="#local-6989586621681113372"><span class="hs-identifier hs-var">normRenamedTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
VarDecl tyname name uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni (Provenance ann)
</span><a href="#local-6989586621681113374"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-403"></span><span>          </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusCore.TypeCheck.Internal.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
VarDecl tyname name uni ann -&gt; name
</span><a href="PlutusCore.Core.Type.html#_varDeclName"><span class="hs-identifier hs-var">_varDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni (Provenance ann)
</span><a href="#local-6989586621681113374"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni (Provenance ann))
</span><a href="#local-6989586621681113372"><span class="hs-identifier hs-var">normRenamedTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113373"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span id="local-6989586621681114137"><span id="local-6989586621681114138"><span id="local-6989586621681114139"><span id="local-6989586621681114140"><span id="local-6989586621681114141"><span id="local-6989586621681114142"><span id="local-6989586621681114143"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBindings"><span class="hs-identifier hs-type">withVarsOfBindings</span></a></span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier hs-type">MonadNormalizeType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114143"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114142"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114141"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Recursivity"><span class="hs-identifier hs-type">Recursivity</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114141"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114143"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114140"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114139"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114143"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114140"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114138"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114142"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114137"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114143"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114140"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114138"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114142"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114137"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span></span></span><span>
</span><span id="line-412"></span><span id="withVarsOfBindings"><span class="annot"><span class="annottext">withVarsOfBindings :: forall (uni :: * -&gt; *) (m :: * -&gt; *) (t :: * -&gt; *) fun ann cfg a.
(MonadNormalizeType uni m, Foldable t) =&gt;
Recursivity
-&gt; t (Binding TyName Name uni fun ann)
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBindings"><span class="hs-identifier hs-var hs-var">withVarsOfBindings</span></a></span></span><span> </span><span id="local-6989586621681113367"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113367"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681113366"><span class="annot"><span class="annottext">t (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113366"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681113365"><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113365"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg ann (m :: * -&gt; *) a.
MonadNormalizeType uni m =&gt;
Recursivity
-&gt; Binding TyName Name uni fun ann
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681113367"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeCheckT uni fun cfg m a
</span><a href="#local-6989586621681113365"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">t (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621681113366"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">-- | Scope a typechecking computation with the given binding's newly-introducing type (if there is one)</span><span>
</span><span id="line-415"></span><span id="local-6989586621681114162"><span id="local-6989586621681114163"><span id="local-6989586621681114164"><span id="local-6989586621681114165"><span id="local-6989586621681114166"><span id="local-6989586621681114167"><span id="local-6989586621681114168"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-type">withTyVarsOfBinding</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114168"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114167"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114166"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114165"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114167"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114166"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114164"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114163"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114162"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114167"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114166"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114164"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114163"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114162"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span></span></span><span>
</span><span id="line-419"></span><span id="withTyVarsOfBinding"><span class="annot"><span class="annottext">withTyVarsOfBinding :: forall name (uni :: * -&gt; *) fun ann cfg (m :: * -&gt; *) a.
Binding TyName name uni fun ann
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-var hs-var">withTyVarsOfBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-420"></span><span>       </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113364"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113364"><span class="hs-identifier hs-var">tvdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ann (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
[TyVarDecl TyName ann]
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113364"><span class="hs-identifier hs-var">tvdecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>       </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113363"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113363"><span class="hs-identifier hs-var">tvdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName name uni ann]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ann (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
[TyVarDecl TyName ann]
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113363"><span class="hs-identifier hs-var">tvdecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-422"></span><span>       </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-comment">-- no type to introduce</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-- | Extend the typecheck reader environment with the kinds of the newly-introduced type variables of a binding.</span><span>
</span><span id="line-425"></span><span id="local-6989586621681114148"><span id="local-6989586621681114149"><span id="local-6989586621681114150"><span id="local-6989586621681114151"><span id="local-6989586621681114152"><span id="local-6989586621681114153"><span id="local-6989586621681114154"><span id="local-6989586621681114155"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBindings"><span class="hs-identifier hs-type">withTyVarsOfBindings</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114155"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114155"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114154"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114153"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114152"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114151"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114153"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114152"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114150"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114149"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114148"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114153"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114152"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114150"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114149"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114148"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-430"></span><span id="withTyVarsOfBindings"><span class="annot"><span class="annottext">withTyVarsOfBindings :: forall (f :: * -&gt; *) name (uni :: * -&gt; *) fun ann cfg (m :: * -&gt; *)
       a.
Foldable f =&gt;
f (Binding TyName name uni fun ann)
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBindings"><span class="hs-identifier hs-var hs-var">withTyVarsOfBindings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann cfg (m :: * -&gt; *) a.
Binding TyName name uni fun ann
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-var">withTyVarsOfBinding</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-comment">-- | Helper to add type variables into a computation's environment.</span><span>
</span><span id="line-433"></span><span id="local-6989586621681114119"><span id="local-6989586621681114120"><span id="local-6989586621681114121"><span id="local-6989586621681114122"><span id="local-6989586621681114123"><span id="local-6989586621681114124"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-type">withTyVarDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114124"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114123"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114122"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114121"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114120"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114119"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckT"><span class="hs-identifier hs-type">TypeCheckT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114123"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114122"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114121"><span class="hs-identifier hs-type">cfg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114120"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114119"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-434"></span><span id="withTyVarDecls"><span class="annot"><span class="annottext">withTyVarDecls :: forall ann (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
[TyVarDecl TyName ann]
-&gt; TypeCheckT uni fun cfg m a -&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var hs-var">withTyVarDecls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113357"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681113357"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681113356"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681113356"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun cfg (m :: * -&gt; *) a.
TyName
-&gt; Kind ()
-&gt; TypeCheckT uni fun cfg m a
-&gt; TypeCheckT uni fun cfg m a
</span><a href="PlutusCore.TypeCheck.Internal.html#withTyVar"><span class="hs-identifier hs-var">withTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681113357"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681113356"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-comment">-- | Substitute `TypeBind`s from the given list of `Binding`s in the given `Type`.</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- This is so that @let a = (con integer) in \(x : a) -&gt; x@ typechecks.</span><span>
</span><span id="line-438"></span><span id="local-6989586621681114189"><span id="local-6989586621681114190"><span id="local-6989586621681114191"><span id="local-6989586621681114192"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#substTypeBinds"><span class="hs-identifier hs-type">substTypeBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><a href="PlutusCore.Normalize.Internal.html#MonadNormalizeType"><span class="hs-identifier hs-type">MonadNormalizeType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114192"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114192"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114190"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114189"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114192"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114192"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114190"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114191"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114192"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-443"></span><span id="substTypeBinds"><span class="annot"><span class="annottext">substTypeBinds :: forall (uni :: * -&gt; *) (m :: * -&gt; *) fun ann.
MonadNormalizeType uni m =&gt;
NonEmpty (Binding TyName Name uni fun ann)
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#substTypeBinds"><span class="hs-identifier hs-var hs-var">substTypeBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldrM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681113342"><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621681113342"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681113341"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113341"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621681113342"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681113340"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113340"><span class="hs-identifier hs-var">tvar</span></a></span></span><span> </span><span id="local-6989586621681113339"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113339"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-445"></span><span>        </span><span id="local-6989586621681113338"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113338"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) ann fun cfg.
MonadNormalizeType uni m =&gt;
Type TyName uni ann
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681113339"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-comment">-- See Note [Normalizing substitution] for why `substNormalizeTypeM`</span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-comment">-- doesn't take a normalized type.</span><span>
</span><span id="line-448"></span><span>        </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) (m :: * -&gt; *) fun cfg.
MonadNormalizeType uni m =&gt;
Normalized (Type TyName uni ())
-&gt; TyName
-&gt; Type TyName uni ()
-&gt; TypeCheckT uni fun cfg m (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#substNormalizeTypeM"><span class="hs-identifier hs-var">substNormalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113338"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681113340"><span class="hs-identifier hs-var">tvar</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname1 ann tyname2.
Lens
  (TyVarDecl tyname1 ann) (TyVarDecl tyname2 ann) tyname1 tyname2
</span><a href="PlutusCore.Core.Type.html#tyVarDeclName"><span class="hs-identifier hs-var">tyVarDeclName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113341"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681113341"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-450"></span></pre></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies  #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | Kind/type inference/checking, mirroring PlutusCore.TypeCheck</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.TypeCheck</span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Configuration.</span></span><span>
</span><span id="line-8"></span><span>      </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#BuiltinTypes"><span class="hs-identifier">BuiltinTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier">PirTCConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#tccBuiltinTypes"><span class="hs-identifier">tccBuiltinTypes</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.html#getDefTypeCheckConfig"><span class="hs-identifier">getDefTypeCheckConfig</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Type checking, extending the plc typechecker</span></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.html#inferType"><span class="hs-identifier">inferType</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.html#checkType"><span class="hs-identifier">checkType</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.html#inferTypeOfProgram"><span class="hs-identifier">inferTypeOfProgram</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.html#checkTypeOfProgram"><span class="hs-identifier">checkTypeOfProgram</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html"><span class="hs-identifier">PlutusCore.Rename</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.html"><span class="hs-identifier">PlutusCore.TypeCheck</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.html"><span class="hs-identifier">PlutusIR</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Error.html"><span class="hs-identifier">PlutusIR.Error</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Transform.Rename.html"><span class="hs-identifier">PlutusIR.Transform.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html"><span class="hs-identifier">PlutusIR.TypeCheck.Internal</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-comment">{- Note [Goal of PIR typechecker]

The PIR typechecker is an extension  of the PLC typechecker; whereas the PLC typechecker
works on PLC terms, the PIR typechecker works on the PIR terms. A PIR term
can be thought of as a superset of the PLC term language: it adds the `LetRec` and `LetNonRec` syntactic
constructs. Because of ths, the PIR typechecker simply extends the PLC typechecker by adding checks
for these two let constructs of PIR.

Since we already have a PIR-&gt;PLC compiler, some would say that it would suffice to first compile the PIR to PLC
and then only run the PLC typechecker. While this is mostly true, there are some reasons for having also
the PIR typechecker as an extra step on the compiler pipeline:

- The error-messages can refer to features of PIR syntax which don't exist in PLC, such as let-terms

- Although PIR is an IR and as such is not supposed to be written by humans, we do have some hand-written PIR code
in our examples/samples/testcases that we would like to make sure they typecheck.

- Our deadcode eliminator which works on PIR (in `PlutusIR.Optimizer.Deadcode`) may eliminate ill-typed code, which
would turn, much to a surprise, an ill-typed program to a well-typed one.

- Some lets of the PIR user may be declared as recursive although they do not *have to* be, e.g. `let (rec) x = 3 in`
would be better written as `let (nonrec) x = 3 in`. In such cases we could signal a warning/error (NB: not implemented atm, and probably not the job of the typechecker pass).

- In general, as an extra source of (type) safety.
-}</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | The default 'TypeCheckConfig'.</span><span>
</span><span id="line-55"></span><span id="local-6989586621681114635"><span id="local-6989586621681114636"><span id="local-6989586621681114637"><span id="local-6989586621681114638"><span id="local-6989586621681114639"><span id="local-6989586621681114640"><span class="annot"><a href="PlutusIR.TypeCheck.html#getDefTypeCheckConfig"><span class="hs-identifier hs-type">getDefTypeCheckConfig</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#MonadKindCheck"><span class="hs-identifier hs-type">MonadKindCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114640"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114639"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114638"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114637"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114636"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114635"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.html#Typecheckable"><span class="hs-identifier hs-type">PLC.Typecheckable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114638"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114637"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114636"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114635"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114638"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114637"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-58"></span><span id="getDefTypeCheckConfig"><span class="annot"><span class="annottext">getDefTypeCheckConfig :: forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
(MonadKindCheck err term uni fun ann m, Typecheckable uni fun) =&gt;
ann -&gt; m (PirTCConfig uni fun)
</span><a href="PlutusIR.TypeCheck.html#getDefTypeCheckConfig"><span class="hs-identifier hs-var hs-var">getDefTypeCheckConfig</span></a></span></span><span> </span><span id="local-6989586621681114492"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681114492"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621681114491"><span class="annot"><span class="annottext">TypeCheckConfig uni fun
</span><a href="#local-6989586621681114491"><span class="hs-identifier hs-var">configPlc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall err term (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
(MonadKindCheck err term uni fun ann m, Typecheckable uni fun) =&gt;
ann -&gt; m (TypeCheckConfig uni fun)
</span><a href="PlutusCore.TypeCheck.html#getDefTypeCheckConfig"><span class="hs-identifier hs-var">PLC.getDefTypeCheckConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681114492"><span class="hs-identifier hs-var">ann</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun.
TypeCheckConfig uni fun -&gt; AllowEscape -&gt; PirTCConfig uni fun
</span><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-var">PirTCConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TypeCheckConfig uni fun
</span><a href="#local-6989586621681114491"><span class="hs-identifier hs-var">configPlc</span></a></span><span> </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#YesEscape"><span class="hs-identifier hs-var">YesEscape</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- | Infer the type of a term.</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- Note: The &quot;inferred type&quot; can escape its scope if YesEscape config is passed, see [PIR vs Paper Escaping Types Difference]</span><span>
</span><span id="line-64"></span><span id="local-6989586621681114597"><span id="local-6989586621681114598"><span id="local-6989586621681114599"><span id="local-6989586621681114600"><span id="local-6989586621681114601"><span class="annot"><a href="PlutusIR.TypeCheck.html#inferType"><span class="hs-identifier hs-type">inferType</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-type">MonadTypeCheckPir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114601"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114600"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114599"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114598"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114597"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114600"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114599"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114600"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114599"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114598"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114597"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114600"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-67"></span><span id="inferType"><span class="annot"><span class="annottext">inferType :: forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
PirTCConfig uni fun
-&gt; Term TyName Name uni fun ann
-&gt; m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.html#inferType"><span class="hs-identifier hs-var hs-var">inferType</span></a></span></span><span> </span><span id="local-6989586621681114459"><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114459"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). (Rename a, MonadQuote m) =&gt; a -&gt; m a
</span><a href="PlutusCore.Rename.html#rename"><span class="hs-identifier hs-var">rename</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
PirTCConfig uni fun -&gt; PirTCEnv uni fun m a -&gt; m a
</span><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114459"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall err (m :: * -&gt; *) (uni :: * -&gt; *) fun ann.
MonadTypeCheckPir err uni fun ann m =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- | Check a term against a type.</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- Infers the type of the term and checks that it's equal to the given type</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- throwing a 'TypeError' (annotated with the value of the @ann@ argument) otherwise.</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- Note: this may allow witnessing a type that escapes its scope, see [PIR vs Paper Escaping Types Difference]</span><span>
</span><span id="line-73"></span><span id="local-6989586621681114546"><span id="local-6989586621681114547"><span id="local-6989586621681114548"><span id="local-6989586621681114549"><span id="local-6989586621681114550"><span class="annot"><a href="PlutusIR.TypeCheck.html#checkType"><span class="hs-identifier hs-type">checkType</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-type">MonadTypeCheckPir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114550"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114549"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114548"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114547"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114546"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114549"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114548"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114547"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114549"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114548"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114547"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114549"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114546"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-80"></span><span id="checkType"><span class="annot"><span class="annottext">checkType :: forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
PirTCConfig uni fun
-&gt; ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; m ()
</span><a href="PlutusIR.TypeCheck.html#checkType"><span class="hs-identifier hs-var hs-var">checkType</span></a></span></span><span> </span><span id="local-6989586621681114428"><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114428"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681114427"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681114427"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681114426"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114426"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621681114425"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681114425"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>    </span><span id="local-6989586621681114424"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114424"><span class="hs-identifier hs-var">termRen</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). (Rename a, MonadQuote m) =&gt; a -&gt; m a
</span><a href="PlutusCore.Rename.html#rename"><span class="hs-identifier hs-var">rename</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114426"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
PirTCConfig uni fun -&gt; PirTCEnv uni fun m a -&gt; m a
</span><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier hs-var">runTypeCheckM</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114428"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun m ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var">checkTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681114427"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114424"><span class="hs-identifier hs-var">termRen</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621681114425"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Infer the type of a program.</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- Note: The &quot;inferred type&quot; can escape its scope if YesEscape config is passed, see [PIR vs Paper Escaping Types Difference]</span><span>
</span><span id="line-86"></span><span id="local-6989586621681114531"><span id="local-6989586621681114532"><span id="local-6989586621681114533"><span id="local-6989586621681114534"><span id="local-6989586621681114535"><span class="annot"><a href="PlutusIR.TypeCheck.html#inferTypeOfProgram"><span class="hs-identifier hs-type">inferTypeOfProgram</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-type">MonadTypeCheckPir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114535"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114534"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114533"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114532"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114531"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114534"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114533"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114534"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114533"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114532"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114531"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114534"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-89"></span><span id="inferTypeOfProgram"><span class="annot"><span class="annottext">inferTypeOfProgram :: forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
PirTCConfig uni fun
-&gt; Program TyName Name uni fun ann
-&gt; m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.html#inferTypeOfProgram"><span class="hs-identifier hs-var hs-var">inferTypeOfProgram</span></a></span></span><span> </span><span id="local-6989586621681114406"><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114406"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681114404"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114404"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
PirTCConfig uni fun
-&gt; Term TyName Name uni fun ann
-&gt; m (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.html#inferType"><span class="hs-identifier hs-var">inferType</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114406"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114404"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Check a program against a type.</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- Infers the type of the program and checks that it's equal to the given type</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- throwing a 'TypeError' (annotated with the value of the @ann@ argument) otherwise.</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- Note: this may allow witnessing a type that escapes its scope, see [PIR vs Paper Escaping Types Difference]</span><span>
</span><span id="line-95"></span><span id="local-6989586621681114520"><span id="local-6989586621681114521"><span id="local-6989586621681114522"><span id="local-6989586621681114523"><span id="local-6989586621681114524"><span class="annot"><a href="PlutusIR.TypeCheck.html#checkTypeOfProgram"><span class="hs-identifier hs-type">checkTypeOfProgram</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#MonadTypeCheckPir"><span class="hs-identifier hs-type">MonadTypeCheckPir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114524"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114523"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114522"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114521"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114520"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114523"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114522"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114521"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114523"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114522"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114521"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681114523"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681114520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-102"></span><span id="checkTypeOfProgram"><span class="annot"><span class="annottext">checkTypeOfProgram :: forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
PirTCConfig uni fun
-&gt; ann
-&gt; Program TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; m ()
</span><a href="PlutusIR.TypeCheck.html#checkTypeOfProgram"><span class="hs-identifier hs-var hs-var">checkTypeOfProgram</span></a></span></span><span> </span><span id="local-6989586621681114387"><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114387"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681114386"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681114386"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681114385"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114385"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall err (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadTypeCheckPir err uni fun ann m =&gt;
PirTCConfig uni fun
-&gt; ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; m ()
</span><a href="PlutusIR.TypeCheck.html#checkType"><span class="hs-identifier hs-var">checkType</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621681114387"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681114386"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681114385"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-103"></span></pre></body></html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADR 5: PAB and indexing component integration &mdash; Plutus Tools SDK User Guide 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ADR 6: Common Contract API" href="0006-common-contract-api.html" />
    <link rel="prev" title="ADR 4: Making a case for Marconi" href="0004-marconi-initiative.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #fcfcfc" >
            <a href="../index.html" class="icon icon-home"> Plutus Tools SDK User Guide
            <img src="../_static/cardano-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Explore Plutus</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plutus/explanations/index.html">Explanations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html">Plutus tools in development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#logical-components">Logical components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#marconi">1. Marconi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#plutus-use-case-examples">2. Plutus use case examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#pab-plutus-application-backend">3. PAB (Plutus application backend)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#contract-monad-emulator">4. Contract monad emulator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#plutus-contract-model-testing">5. Plutus contract model testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#plutus-contract-state-machine">6. Plutus contract state machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#contract-api-also-known-as-contract-monad">7. Contract API (also known as Contract monad)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#plutus-chain-index">8. Plutus chain index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#plutus-ledger-constraints">9. Plutus ledger constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#plutus-tx-constraints">10. Plutus Tx constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#id10">11. Plutus ledger</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/plutus-tools-component-descriptions.html#plutus-script-utils">12. Plutus script utils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/explanations/rollback.html">What is a rollback?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/rollback.html#what-does-this-mean-for-dapps">What does this mean for dapps?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/explanations/pab.html">What is the PAB?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/pab.html#client-interface">Client interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/pab.html#other-components">Other components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/pab.html#chain-index">Chain index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/pab.html#alonzo-node">Alonzo node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/pab.html#wallet">Wallet</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/pab.html#deployment-scenarios">Deployment Scenarios</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/pab.html#hosted">Hosted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/pab.html#in-browser">In-browser</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html">What is the order book pattern?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#example-distributed-exchange">Example: Distributed exchange</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#orders-and-plutus-scripts">Orders and Plutus scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#decentralisation">Decentralisation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#generalising-the-pattern">Generalising the pattern</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#off-chain-oracles">Off-chain oracles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#on-chain-oracles">On-chain oracles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#state-machines">State machines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/explanations/order-book-pattern.html#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plutus/tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plutus/tutorials/basic-apps.html">Writing a basic Plutus app in an emulated environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#defining-the-types">Defining the types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#instances-for-data-types">Instances for data types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#defining-the-validator-script">Defining the validator script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#asking-for-input">Asking for input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#locking-the-funds">Locking the funds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#unlocking-the-funds">Unlocking the funds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#running-the-app-on-the-plutus-apps-emulator">Running the app on the Plutus apps emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/basic-apps.html#exercise">Exercise</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/tutorials/basic-apps-constraints.html">Extending the basic Plutus app with the constraints API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/tutorials/contract-testing.html">Property-based testing of Plutus contracts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#an-overview-of-the-guessing-game">An overview of the guessing game</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#emulated-wallets">Emulated wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#values-and-tokens">Values and <span class="xref std std-term">tokens</span></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#introducing-contract-models">Introducing contract models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#generating-actions">Generating actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#modelling-expectations">Modelling expectations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#restricting-test-cases-with-preconditions">Restricting test cases with preconditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#performing-actions">Performing actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#shrinking-actions">Shrinking Actions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#debugging-the-model">Debugging the model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#adding-delays-to-test-cases">Adding delays to test cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#rerunning-a-failed-test">Rerunning a failed test</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#controlling-the-log-level">Controlling the log-level</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#refining-preconditions">Refining preconditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#measuring-and-tuning-distributions">Measuring and tuning distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#custom-generators-vs-preconditions">Custom generators vs preconditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#instrumenting-contract-models-to-gather-statistics">Instrumenting contract models to gather statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#goal-directed-testing-with-dynamic-logic">Goal-directed testing with dynamic logic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#introducing-the-dynamic-logic-monad">Introducing the dynamic logic monad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#quantifiers-in-dynamic-logic">Quantifiers in dynamic logic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#repeating-a-dynamic-logic-test">Repeating a dynamic logic test</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#something-good-is-always-possible">Something good is always possible</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#monitoring-and-tuning-dynamic-logic-tests">Monitoring and tuning dynamic logic tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#more-dynamic-logic">More dynamic logic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#limitations">Limitations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#testing-only-via-contract-endpoints">Testing only via <span class="xref std std-term">contract endpoints</span></a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#test-assumptions-on-timing">Test assumptions on timing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#testing-for-information-leaks">Testing for information leaks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-testing.html#further-examples">Further Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/tutorials/contract-models.html">Testing Plutus Contracts with Contract Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#basic-contract-models">Basic Contract Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#example-a-simple-escrow-contract">Example: A Simple Escrow Contract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#the-contract-model-type">The Contract Model Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#what-contracts-shall-we-test">What contracts shall we test?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#what-actions-should-tests-perform">What actions should tests perform?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#generating-actions">Generating Actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#running-tests-and-debugging-the-model">Running tests and debugging the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#analysing-the-distribution-of-tests">Analysing the distribution of tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#parameterising-models-and-dynamic-contract-instances">Parameterising Models and Dynamic Contract Instances</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#adding-an-initial-action-and-test-case-phases">Adding an initial action, and test case phases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#dynamic-contract-instances">Dynamic contract instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#running-our-extended-tests-another-design-issue">Running our extended tests; another design issue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#id3">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#testing-no-locked-funds-with-dynamic-logic">Testing “No Locked Funds” with Dynamic Logic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#writing-and-testing-properties-using-dynamic-logic">Writing and testing properties using Dynamic Logic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#digression-revisiting-a-design-decision">Digression: revisiting a design decision</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#fair-s-fair-unilateral-strategies">Fair’s fair: Unilateral strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#fixing-the-contract-refunds">Fixing the contract: refunds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#id4">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#taking-time-into-account">Taking Time into Account</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#slots-and-posixtime">Slots and POSIXTime</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#initialising-the-deadline">Initialising the deadline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#modelling-the-passage-of-time">Modelling the passage of time</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#monitoring-and-the-distribution-of-tests">Monitoring and the distribution of tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#no-locked-funds">No locked funds?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#digression-testing-the-model-alone-for-speed">Digression: testing the model alone for speed</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#id5">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#measuring-coverage-of-on-chain-code">Measuring coverage of on-chain code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#adding-a-coverage-index">Adding a coverage index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#measuring-coverage">Measuring coverage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#interpreting-the-coverage-annotations">Interpreting the coverage annotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#the-generated-coverage-report">The generated coverage report</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#crashes-and-how-to-tolerate-them">Crashes, and how to tolerate them</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#id6">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#debugging-the-auction-contract-with-model-assertions">Debugging the Auction contract with model assertions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#modelling-the-auction-contract">Modelling the Auction contract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#id7">No locked funds?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#model-assertions-and-unexpected-expectations">Model assertions, and unexpected expectations.</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#crashing-the-auction">Crashing the auction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#coverage-of-the-auction-contract">Coverage of the Auction contract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#id8">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/tutorials/contract-models.html#becoming-level-1-certification-ready">Becoming Level 1 Certification Ready</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/tutorials/contract-models.html#id9">Exercises</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plutus/howtos/index.html">How-to guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plutus/howtos/getting-started.html">How to get started with the Plutus Platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/getting-started.html#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html">How to write a scalable Plutus app</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#the-building-blocks">The building blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#transaction-outputs">Transaction outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#state-of-transaction-outputs">State of transaction outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#changing-the-state-of-our-app">Changing the state of our app</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#minting-policy-scripts">Minting Policy Scripts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#scalability-guidelines">Scalability guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#decentralised-exchange">Decentralised exchange</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#marlowe">Marlowe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/writing-a-scalable-app.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/howtos/handling-blockchain-events.html">How to handle blockchain events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/handling-blockchain-events.html#transaction-output-lifecycle">Transaction output lifecycle</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/handling-blockchain-events.html#transaction-states">Transaction states</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/handling-blockchain-events.html#pab-functions-for-listening-to-state-changes">PAB functions for listening to state changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/howtos/analysing-scripts.html">How to analyse the cost and size of Plutus scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/analysing-scripts.html#resource-use-of-plutus-scripts">Resource use of Plutus scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/analysing-scripts.html#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/analysing-scripts.html#validator-scripts">Validator scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/analysing-scripts.html#partial-transactions">Partial transactions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plutus/howtos/plutus-spending-script-example.html">Plutus Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plutus/howtos/plutus-spending-script-example.html#what-is-a-plutus-spending-script">What is a Plutus spending script?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plutus/howtos/plutus-spending-script-example.html#an-example-of-using-a-plutus-spending-script">An example of using a Plutus spending script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plutus/troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plutus/troubleshooting.html#error-codes">Error codes</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architectural decision records</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architectural Decision Records</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0001-record-architecture-decisions.html">ADR 1: Record architectural decisions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0001-record-architecture-decisions.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="0001-record-architecture-decisions.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0001-record-architecture-decisions.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0001-record-architecture-decisions.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0001-record-architecture-decisions.html#implications">Implications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0001-record-architecture-decisions.html#adr-template">ADR template</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0002-repository-standardization.html">ADR 2: Repository Standardization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0002-repository-standardization.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002-repository-standardization.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002-repository-standardization.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002-repository-standardization.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002-repository-standardization.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0002-repository-standardization.html#implications">Implications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0003-marconi-monorepo.html">ADR 3: Move Marconi into a separate repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0003-marconi-monorepo.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003-marconi-monorepo.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003-marconi-monorepo.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003-marconi-monorepo.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003-marconi-monorepo.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="0003-marconi-monorepo.html#related-decisions">Related Decisions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0004-marconi-initiative.html">ADR 4: Making a case for Marconi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#design-principles-of-marconi">Design principles of Marconi</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#indexing-solution">Indexing solution</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#query-and-storage">Query and storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#identification-of-events">Identification of events</a></li>
<li class="toctree-l3"><a class="reference internal" href="0004-marconi-initiative.html#event-streams">Event streams</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ADR 5: PAB and indexing component integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decisions">Decisions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alternative-solutions">Alternative solutions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#make-sure-all-components-are-in-sync">Make sure all components are in sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-indexing-specific-functions-in-the-contract-api">Add indexing specific functions in the Contract API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-functions-should-interact-with-a-single-source-of-truth">Query functions should interact with a single source of truth</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0006-common-contract-api.html">ADR 6: Common Contract API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0006-common-contract-api.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="0006-common-contract-api.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0006-common-contract-api.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0006-common-contract-api.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0006-common-contract-api.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0006-common-contract-api.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="0006-common-contract-api.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0007-support-reference-inputs-in-constraint-library.html">ADR 7: Support reference inputs in constraint library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0007-support-reference-inputs-in-constraint-library.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007-support-reference-inputs-in-constraint-library.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007-support-reference-inputs-in-constraint-library.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007-support-reference-inputs-in-constraint-library.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007-support-reference-inputs-in-constraint-library.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0007-support-reference-inputs-in-constraint-library.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0008-support-inline-datums-in-constraint-library.html">ADR 8: Support inline datums in constraint library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0008-support-inline-datums-in-constraint-library.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0008-support-inline-datums-in-constraint-library.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0008-support-inline-datums-in-constraint-library.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0008-support-inline-datums-in-constraint-library.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0008-support-inline-datums-in-constraint-library.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0008-support-inline-datums-in-constraint-library.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0009-support-reference-scripts-in-constraint-library.html">ADR 9: Support reference scripts in constraint library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0009-support-reference-scripts-in-constraint-library.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0009-support-reference-scripts-in-constraint-library.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0009-support-reference-scripts-in-constraint-library.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0009-support-reference-scripts-in-constraint-library.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0009-support-reference-scripts-in-constraint-library.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0009-support-reference-scripts-in-constraint-library.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html">ADR 10: Rolling back on-disk data for Marconi indexers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#decision">Decision</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#events">Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#queries">Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#api-design">API Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="0010-marconi-indexer-rollbacks.html#implementation">Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html">ADR 11: Support return and total collateral when building transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html#alternatives">Alternatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="0011-support-return-and-total-collateral-when-building-transactions.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html">ADR 12: Commit to data types in cardano-api</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#alternatives">Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#define-our-own-data-types-for-off-chain-use">Define our own data types for off-chain use</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="0012-commit-to-data-types-in-cardano-api.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0013-tx-validity-time-range-fix.html">ADR 13: Transaction validity time range fix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#alternatives">Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#add-mustvalidateinslotrange-constraint">Add <code class="docutils literal notranslate"><span class="pre">MustValidateInSlotRange</span></code> constraint</a></li>
<li class="toctree-l4"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#remove-mustvalidateintimerange">Remove <code class="docutils literal notranslate"><span class="pre">mustValidateInTimeRange</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#alter-mustvalidateintimerange">Alter <code class="docutils literal notranslate"><span class="pre">mustValidateInTimeRange</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0013-tx-validity-time-range-fix.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0014-marconi-query-interface.html">ADR 14: Marconi Query Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0014-marconi-query-interface.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0014-marconi-query-interface.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0014-marconi-query-interface.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0014-marconi-query-interface.html#decision">Decision</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0014-marconi-query-interface.html#implications">Implications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0015-time-conversion.html">ADR 15: Time conversion semantic change</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#alternatives">Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0015-time-conversion.html#changing-the-representation-of-slotconfig-to-the-correct-one">Changing the representation of <code class="docutils literal notranslate"><span class="pre">SlotConfig</span></code> to the correct one</a></li>
<li class="toctree-l4"><a class="reference internal" href="0015-time-conversion.html#directly-use-epochinfo-in-the-emulator-and-contract-api">Directly use EpochInfo in the emulator and Contract API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0015-time-conversion.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0016-cardano-node-emulator.html">ADR 16: Self-contained cardano-node emulator component</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0016-cardano-node-emulator.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0016-cardano-node-emulator.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0016-cardano-node-emulator.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0016-cardano-node-emulator.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0016-cardano-node-emulator.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="0016-cardano-node-emulator.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0017-end-to-end-testing-strategy.html">ADR 17: End-to-end testing strategy for Plutus, cardano-ledger-api and cardano-node-client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#types-of-plutus-tests-for-the-plutus-e2e-tests-haskell-framework">Types of Plutus tests for the <code class="docutils literal notranslate"><span class="pre">plutus-e2e-tests</span></code> Haskell framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#argument">Argument</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#pros-of-building-and-maintaining-our-own-test-framework">Pros of building and maintaining our own test framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#cons-of-building-and-maintaining-our-own-test-framework">Cons of building and maintaining our own test framework</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#additional-considerations">Additional Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#alternatives">Alternatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#notes">Notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="0017-end-to-end-testing-strategy.html#other-places-spinning-up-a-local-testnet">Other places spinning up a local testnet</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/cost-model-parameters.html">Cost model parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/bibliography.html">Bibliography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/index.html#elsewhere">Elsewhere</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #fcfcfc" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Plutus Tools SDK User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Architectural Decision Records</a> &raquo;</li>
      <li>ADR 5: PAB and indexing component integration</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/input-output-hk/plutus/blob/master/doc/adr/0005-pab-indexing-solution-integration.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adr-5-pab-and-indexing-component-integration">
<h1>ADR 5: PAB and indexing component integration<a class="headerlink" href="#adr-5-pab-and-indexing-component-integration" title="Permalink to this heading"></a></h1>
<p>Date: 2022-07-27</p>
<section id="author-s">
<h2>Author(s)<a class="headerlink" href="#author-s" title="Permalink to this heading"></a></h2>
<p>koslambrou &lt;<a class="reference external" href="mailto:konstantinos&#46;lambrou&#37;&#52;&#48;iohk&#46;io">konstantinos<span>&#46;</span>lambrou<span>&#64;</span>iohk<span>&#46;</span>io</a>&gt;</p>
</section>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this heading"></a></h2>
<p>Proposed</p>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this heading"></a></h2>
<p>Let’s start with the problematic example (copy-paste of the current <cite>PubKey</cite>
contract in <cite>plutus-use-cases</cite>).</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="c1">-- | Lock some funds in a &#39;PayToPubKey&#39; contract, returning the output&#39;s address</span><span class="w"></span>
<span class="c1">--   and a &#39;TxIn&#39; transaction input that can spend it.</span><span class="w"></span>
<span class="nf">pubKeyContract</span><span class="w"></span>
<span class="w">    </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="kt">AsPubKeyError</span><span class="w"> </span><span class="n">e</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ow">=&gt;</span><span class="w"> </span><span class="kt">PaymentPubKeyHash</span><span class="w"></span>
<span class="w">    </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Value</span><span class="w"></span>
<span class="w">    </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Contract</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">(</span><span class="kt">TxOutRef</span><span class="p">,</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">ChainIndexTxOut</span><span class="p">,</span><span class="w"> </span><span class="kt">TypedValidator</span><span class="w"> </span><span class="kt">PubKeyContract</span><span class="p">)</span><span class="w"></span>
<span class="nf">pubKeyContract</span><span class="w"> </span><span class="n">pk</span><span class="w"> </span><span class="n">vl</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">mapError</span><span class="w"> </span><span class="p">(</span><span class="n">review</span><span class="w"> </span><span class="n">_PubKeyError</span><span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">    </span><span class="c1">-- Step 1</span><span class="w"></span>
<span class="w">    </span><span class="kr">let</span><span class="w"> </span><span class="n">inst</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">typedValidator</span><span class="w"> </span><span class="n">pk</span><span class="w"></span>
<span class="w">        </span><span class="n">address</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Scripts</span><span class="o">.</span><span class="n">validatorAddress</span><span class="w"> </span><span class="n">inst</span><span class="w"></span>
<span class="w">        </span><span class="n">tx</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Constraints</span><span class="o">.</span><span class="n">mustPayToTheScriptWithDatumHash</span><span class="w"> </span><span class="nb">()</span><span class="w"> </span><span class="n">vl</span><span class="w"></span>
<span class="w">    </span><span class="n">ledgerTx</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">mkTxConstraints</span><span class="w"> </span><span class="p">(</span><span class="kt">Constraints</span><span class="o">.</span><span class="n">typedValidatorLookups</span><span class="w"> </span><span class="n">inst</span><span class="p">)</span><span class="w"> </span><span class="n">tx</span><span class="w"></span>
<span class="w">               </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="n">submitUnbalancedTx</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">Constraints</span><span class="o">.</span><span class="n">adjustUnbalancedTx</span><span class="w"></span>

<span class="w">    </span><span class="c1">-- Step 2</span><span class="w"></span>
<span class="w">    </span><span class="kr">_</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">awaitTxConfirmed</span><span class="w"> </span><span class="p">(</span><span class="n">getCardanoTxId</span><span class="w"> </span><span class="n">ledgerTx</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="c1">-- Step 3</span><span class="w"></span>
<span class="w">    </span><span class="kr">let</span><span class="w"> </span><span class="n">refs</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Map</span><span class="o">.</span><span class="n">keys</span><span class="w"></span>
<span class="w">               </span><span class="o">$</span><span class="w"> </span><span class="kt">Map</span><span class="o">.</span><span class="n">filter</span><span class="w"> </span><span class="p">((</span><span class="o">==</span><span class="p">)</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">txOutAddress</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="o">$</span><span class="w"> </span><span class="n">getCardanoTxProducedOutputs</span><span class="w"> </span><span class="n">ledgerTx</span><span class="w"></span>
<span class="w">    </span><span class="kr">case</span><span class="w"> </span><span class="n">refs</span><span class="w"> </span><span class="kr">of</span><span class="w"></span>
<span class="w">        </span><span class="kt">[]</span><span class="w">                   </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">throwing</span><span class="w"> </span><span class="n">_ScriptOutputMissing</span><span class="w"> </span><span class="n">pk</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="n">outRef</span><span class="p">]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">            </span><span class="c1">-- Step 4</span><span class="w"></span>
<span class="w">            </span><span class="n">ciTxOut</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">unspentTxOutFromRef</span><span class="w"> </span><span class="n">outRef</span><span class="w"></span>
<span class="w">            </span><span class="n">pure</span><span class="w"> </span><span class="p">(</span><span class="n">outRef</span><span class="p">,</span><span class="w"> </span><span class="n">ciTxOut</span><span class="p">,</span><span class="w"> </span><span class="n">inst</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kr">_</span><span class="w">                    </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">throwing</span><span class="w"> </span><span class="n">_MultipleScriptOutputs</span><span class="w"> </span><span class="n">pk</span><span class="w"></span>
</pre></div>
</div>
<p>Here’s an outline of the contract’s steps:</p>
<ol class="arabic simple">
<li><p>Creates a transaction and submits it to the node</p></li>
<li><p>Waits for transaction to be confirmed</p></li>
<li><p>Finds the first UTXO of that transaction (return type <cite>TxOutRef</cite>)</p></li>
<li><p>Queries the plutus-chain-index to get the <cite>ChainIndexTxOut</cite> out of that
<cite>TxOutRef</cite></p></li>
</ol>
<p>The problem is that the <cite>ciTxOut</cite> variable in step 4 will almost always result
in <cite>Nothing</cite>.</p>
<p>Why? Here’s some context.</p>
<p>The PAB listens to the local node and stores blockchain information in memory
such as the status of transactions, the status of transaction outputs, the last
synced slot, the current slot, etc., in a variable of type <cite>BlockchainEnv</cite>.
The <cite>awaitTxConfirmed</cite> is actually querying the state of <cite>BlockchainEnv</cite> and
waits until the status of the transaction transitions to <cite>Confirmed</cite>.</p>
<p>Meanwhile, plutus-chain-index (our main indexing component at the time of this
writing) is also listening to incoming blocks from the local node and indexes
them into a database.
The indexed data can be queried using the REST API interface.</p>
<p>This brings up the main issue: the PAB and plutus-chain-index each listen to
the same source of information (a local Cardano node), but each index the
information at different speeds.
For a dApp developer writing off-chain code using the Contract API, there is no
abstraction for handling multiple sources of truth.</p>
<p>Currently, in the best case scenario (fully synced PAB and plutus-chain-index),
plutus-chain-index will always trail behind the in-memory storage of the PAB by
a few seconds.
Therefore, even in this scenario, querying the plutus-chain-index with
<cite>unspentTxOutFromRef</cite> in the above contract has a high probability of returning
<cite>Nothing</cite>.</p>
</section>
<section id="decisions">
<h2>Decisions<a class="headerlink" href="#decisions" title="Permalink to this heading"></a></h2>
<p>The best solution is probably a combination of the <a class="reference internal" href="#alternative-solutions">Alternative solutions</a>
described below.
However, we will mainly choose the <a class="reference internal" href="#query-functions-should-interact-with-a-single-source-of-truth">Query functions should interact with a
single source of truth</a> solution.</p>
<ul class="simple">
<li><p>We will replace <cite>plutus-chain-index</cite> with <cite>Marconi</cite> as PAB’s indexing
component</p></li>
<li><p>We will move out the blockchain information indexed by PAB in Marconi</p></li>
<li><p>We will add new indexers in Marconi in order to replicate the information
indexed by <cite>plutus-chain-index</cite></p></li>
<li><p>We will adapt the architecture of Marconi (which will become our new indexing
component) to support waiting queries</p></li>
<li><p>Since we suppose that indexing component should be in the same machine as the
PAB, then we will use Marconi as a library to index and query the indexed
blockchain information without relying on an HTTP API</p></li>
</ul>
</section>
<section id="alternative-solutions">
<h2>Alternative solutions<a class="headerlink" href="#alternative-solutions" title="Permalink to this heading"></a></h2>
<p>In this section, we describe all the ways to deal with the problem.
Note that final decision might include one or more of these alternate
solutions.</p>
<section id="make-sure-all-components-are-in-sync">
<h3>Make sure all components are in sync<a class="headerlink" href="#make-sure-all-components-are-in-sync" title="Permalink to this heading"></a></h3>
<p>We can make sure that all indexing components are syncing at the same speed.
For example, if PAB syncs from the local node and arrives at slot 100, then it
needs to wait for the chain-index to also arrive at slot 100. Only then can it
respond to a Contract request.</p>
<p>A simply way to achieve this behavior is to change the implementation of
Contract API handler functions (like <cite>utxosAt</cite>, <cite>unspentTxOutFromRef</cite>, etc.) by
waiting for the component to be in sync with all other components.
For example, let’s take the <cite>utxosAt</cite> request which basically queries UTXOs
from a given address using <cite>plutus-chain-index</cite>.
We could, before querying, wait for <cite>plutus-chain-index</cite> to be in sync with all
components which index blockchain data (PAB, <a class="reference external" href="https://blockfrost.io">Blockfrost</a>).</p>
<p>Pros:</p>
<ul class="simple">
<li><p>All the indexed information is consistent with each other</p></li>
</ul>
<p>Cons:</p>
<ul class="simple">
<li><p>As fast as the slowest indexing component</p></li>
<li><p>Tight coupling between the indexing components meaning that if the Contract
only uses chain-index requests without using requests from other indexing
components, the chain-index will still have to wait for all other components
to be in sync with each other</p></li>
</ul>
</section>
<section id="add-indexing-specific-functions-in-the-contract-api">
<h3>Add indexing specific functions in the Contract API<a class="headerlink" href="#add-indexing-specific-functions-in-the-contract-api" title="Permalink to this heading"></a></h3>
<p>In this scenario, we would need to split Contract API requests which interact
with an external indexing component to the ones that use the PAB.
Currently, we have <cite>awaitTxConfirmed</cite> which uses the indexed information in the
PAB to wait for a transaction status to change to <cite>Confirmed</cite>.
On top of that, we can have <cite>awaitTxIndexed</cite> or <cite>awaitTxOutIndexed</cite> which will
wait for the information to be indexed in the external indexing component.</p>
<p>Pros:</p>
<ul class="simple">
<li><p>Limits design change on the PAB</p></li>
<li><p>More control given to the user of the Contract API</p></li>
</ul>
<p>Cons:</p>
<ul class="simple">
<li><p>Adds an undesired complexity to the Contract API</p></li>
<li><p>We’ll need to add a bunch of functions (e.g., <cite>currentNodeSlot</cite>,
<cite>currentMarconiSlot</cite>, <cite>awaitMarconiTxConfirmed, `awaitScrollsTxConfirmed</cite>,
etc.) for each new indexing component we want to support</p></li>
</ul>
</section>
<section id="query-functions-should-interact-with-a-single-source-of-truth">
<h3>Query functions should interact with a single source of truth<a class="headerlink" href="#query-functions-should-interact-with-a-single-source-of-truth" title="Permalink to this heading"></a></h3>
<p>In this scenario, we make the design decision that the Contract API should only
interact with a single indexing component.
Thus, any blockchain information currently stored in the PAB should be moved to
the indexing component.
Also, combining indexing components would need to be integrated in the single
indexing solution that’s connected to the PAB.</p>
<p>Pros:</p>
<ul class="simple">
<li><p>Simplest in design to implement (other than manual work to move code)</p></li>
<li><p>No modification to the Contract API</p></li>
<li><p>Augments PAB’s cohesion, because it’s responsability will be limited to
contract instance management</p></li>
</ul>
<p>Cons:</p>
<ul class="simple">
<li><p>The design of the indexing component will need to be changed to support
waiting queries (like the <cite>awaitTxConfirmed</cite> from PAB)</p></li>
<li><p>Still under the assumption that the indexing component is in sync with the
PAB in order to use some querying functions</p></li>
</ul>
</section>
</section>
<section id="implications">
<h2>Implications<a class="headerlink" href="#implications" title="Permalink to this heading"></a></h2>
<p>Having a single source of truth indexer will augment the PAB’s cohesion and
greatly simpy the <cite>plutus-pab</cite> codebase.
Also, we will not encounter the situation where we have multiple indexers that
index at different speeds.</p>
<p>However, there is still the problem that the indexing solution might not be in sync with the local node.
Therefore, we need to make another decision on how to deal with it.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this heading"></a></h2>
<p>This problem manifested itself in the Github issue <a class="reference external" href="https://github.com/input-output-hk/plutus-apps/issues/473">#473</a> and there was a
temporary fix in the PR <a class="reference external" href="https://github.com/input-output-hk/plutus-apps/pull/496">#496</a>.
However, the proper solution to the issue would be the implementation of this
ADR.</p>
<p>This ADR has been discussed here: <a class="reference external" href="https://github.com/input-output-hk/plutus-apps/pull/550">#550</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="0004-marconi-initiative.html" class="btn btn-neutral float-left" title="ADR 4: Making a case for Marconi" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="0006-common-contract-api.html" class="btn btn-neutral float-right" title="ADR 6: Common Contract API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1980, IOHK.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
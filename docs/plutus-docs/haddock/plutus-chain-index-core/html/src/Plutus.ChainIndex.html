<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds        #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds   #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns   #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators    #-}</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.ChainIndex</span><span class="hs-special">(</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Plutus.ChainIndex.html#runChainIndexEffects"><span class="hs-identifier">runChainIndexEffects</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.html#handleChainIndexEffects"><span class="hs-identifier">handleChainIndexEffects</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.html#RunRequirements"><span class="hs-identifier">RunRequirements</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">Control.Monad.Freer.Extras.Pagination</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.ChainIndexError.html"><span class="hs-identifier">Plutus.ChainIndex.ChainIndexError</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.ChainIndexLog.html"><span class="hs-identifier">Plutus.ChainIndex.ChainIndexLog</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.Effects.html"><span class="hs-identifier">Plutus.ChainIndex.Effects</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.Handlers.html"><span class="hs-identifier">Plutus.ChainIndex.Handlers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.Tx.html"><span class="hs-identifier">Plutus.ChainIndex.Tx</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxIdState.html"><span class="hs-identifier">Plutus.ChainIndex.TxIdState</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.ChainIndex.TxIdState.html#fromBlock"><span class="hs-identifier">fromBlock</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxIdState.html#fromTx"><span class="hs-identifier">fromTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxIdState.html#rollback"><span class="hs-identifier">rollback</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxOutBalance.html"><span class="hs-identifier">Plutus.ChainIndex.TxOutBalance</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.ChainIndex.TxOutBalance.html#fromBlock"><span class="hs-identifier">fromBlock</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxOutBalance.html#fromTx"><span class="hs-identifier">fromTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxOutBalance.html#isSpentOutput"><span class="hs-identifier">isSpentOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxOutBalance.html#isUnspentOutput"><span class="hs-identifier">isUnspentOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.TxOutBalance.html#rollback"><span class="hs-identifier">rollback</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.Types.html"><span class="hs-identifier">Plutus.ChainIndex.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.UtxoState.html"><span class="hs-identifier">Plutus.ChainIndex.UtxoState</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Export</span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.BM.Trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Trace</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">TVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">atomically</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">readTVarIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">writeTVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Control.Monad.Freer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">LastMember</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Member</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">interpret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Control.Monad.Freer.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">handleError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">runError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">throwError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">Control.Monad.Freer.Extras.Beam.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">BeamEffect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">handleBeam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">Control.Monad.Freer.Extras.Beam.Sqlite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">runBeam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">Control.Monad.Freer.Extras.Log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">LogMsg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">Control.Monad.Freer.Extras.Modify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">raiseEnd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">raiseMUnderN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Control.Monad.Freer.Reader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">runReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Control.Monad.Freer.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">runState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/zxq0h870rlfkadlbglxsnlfqnd0xfp5v-resource-pool-lib-resource-pool-0.3.1.0-haddock-doc/share/doc/resource-pool/html/src"><span class="hs-identifier">Data.Pool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/zxq0h870rlfkadlbglxsnlfqnd0xfp5v-resource-pool-lib-resource-pool-0.3.1.0-haddock-doc/share/doc/resource-pool/html/src"><span class="hs-identifier">Pool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/c2ys4mf3ij618ysqljn71b9gp0j0imn5-beam-sqlite-lib-beam-sqlite-0.5.1.2-haddock-doc/share/doc/beam-sqlite/html/src"><span class="hs-identifier">Database.Beam.Sqlite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/c2ys4mf3ij618ysqljn71b9gp0j0imn5-beam-sqlite-lib-beam-sqlite-0.5.1.2-haddock-doc/share/doc/beam-sqlite/html/src"><span class="hs-identifier">Sqlite</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/b6yy9siiwmm7jl9mla9asdhq1ck23cq8-sqlite-simple-lib-sqlite-simple-0.4.18.2-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Sqlite</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Monitoring.Util.html"><span class="hs-identifier">Plutus.Monitoring.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Monitoring.Util.html#PrettyObject"><span class="hs-identifier">PrettyObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Monitoring.Util.html#PrettyObject"><span class="hs-identifier">PrettyObject</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Monitoring.Util.html#convertLog"><span class="hs-identifier">convertLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Monitoring.Util.html#runLogEffects"><span class="hs-identifier">runLogEffects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- | The required arguments to run the chain index effects.</span><span>
</span><span id="line-42"></span><span class="hs-keyword">data</span><span> </span><span id="RunRequirements"><span class="annot"><a href="Plutus.ChainIndex.html#RunRequirements"><span class="hs-identifier hs-var">RunRequirements</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunRequirements"><span class="annot"><a href="Plutus.ChainIndex.html#RunRequirements"><span class="hs-identifier hs-var">RunRequirements</span></a></span></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="trace"><span class="annot"><span class="annottext">RunRequirements -&gt; Trace IO (PrettyObject ChainIndexLog)
</span><a href="Plutus.ChainIndex.html#trace"><span class="hs-identifier hs-var hs-var">trace</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Trace</span></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Monitoring.Util.html#PrettyObject"><span class="hs-identifier hs-type">PrettyObject</span></a></span><span> </span><span class="annot"><a href="Plutus.ChainIndex.ChainIndexLog.html#ChainIndexLog"><span class="hs-identifier hs-type">ChainIndexLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="stateTVar"><span class="annot"><span class="annottext">RunRequirements -&gt; TVar ChainIndexState
</span><a href="Plutus.ChainIndex.html#stateTVar"><span class="hs-identifier hs-var hs-var">stateTVar</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">TVar</span></a></span><span> </span><span class="annot"><a href="Plutus.ChainIndex.Handlers.html#ChainIndexState"><span class="hs-identifier hs-type">ChainIndexState</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pool"><span class="annot"><span class="annottext">RunRequirements -&gt; Pool Connection
</span><a href="Plutus.ChainIndex.html#pool"><span class="hs-identifier hs-var hs-var">pool</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/zxq0h870rlfkadlbglxsnlfqnd0xfp5v-resource-pool-lib-resource-pool-0.3.1.0-haddock-doc/share/doc/resource-pool/html/src"><span class="hs-identifier hs-type">Pool</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/b6yy9siiwmm7jl9mla9asdhq1ck23cq8-sqlite-simple-lib-sqlite-simple-0.4.18.2-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">Sqlite.Connection</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="securityParam"><span class="annot"><span class="annottext">RunRequirements -&gt; Int
</span><a href="Plutus.ChainIndex.html#securityParam"><span class="hs-identifier hs-var hs-var">securityParam</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | Run the chain index effects.</span><span>
</span><span id="line-50"></span><span id="local-6989586621679726784"><span class="annot"><a href="Plutus.ChainIndex.html#runChainIndexEffects"><span class="hs-identifier hs-type">runChainIndexEffects</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.html#RunRequirements"><span class="hs-identifier hs-type">RunRequirements</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Eff</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Plutus.ChainIndex.Effects.html#ChainIndexQueryEffect"><span class="hs-identifier hs-type">ChainIndexQueryEffect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.Effects.html#ChainIndexControlEffect"><span class="hs-identifier hs-type">ChainIndexControlEffect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-type">BeamEffect</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/c2ys4mf3ij618ysqljn71b9gp0j0imn5-beam-sqlite-lib-beam-sqlite-0.5.1.2-haddock-doc/share/doc/beam-sqlite/html/src"><span class="hs-identifier hs-type">Sqlite</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679726784"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Plutus.ChainIndex.ChainIndexError.html#ChainIndexError"><span class="hs-identifier hs-type">ChainIndexError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679726784"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-54"></span><span id="runChainIndexEffects"><span class="annot"><span class="annottext">runChainIndexEffects :: RunRequirements
-&gt; Eff
     '[ChainIndexQueryEffect, ChainIndexControlEffect,
       BeamEffect Sqlite]
     a
-&gt; IO (Either ChainIndexError a)
</span><a href="Plutus.ChainIndex.html#runChainIndexEffects"><span class="hs-identifier hs-var hs-var">runChainIndexEffects</span></a></span></span><span> </span><span id="local-6989586621679726783"><span class="annot"><span class="annottext">RunRequirements
</span><a href="#local-6989586621679726783"><span class="hs-identifier hs-var">runReq</span></a></span></span><span> </span><span id="local-6989586621679726782"><span class="annot"><span class="annottext">Eff
  '[ChainIndexQueryEffect, ChainIndexControlEffect,
    BeamEffect Sqlite]
  a
</span><a href="#local-6989586621679726782"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">Trace IO ChainIndexLog -&gt; Eff '[LogMsg ChainIndexLog, IO] ~&gt; IO
forall (m :: * -&gt; *) l.
MonadIO m =&gt;
Trace m l -&gt; Eff '[LogMsg l, m] ~&gt; m
</span><a href="Plutus.Monitoring.Util.html#runLogEffects"><span class="hs-identifier hs-var">runLogEffects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ChainIndexLog -&gt; PrettyObject ChainIndexLog)
-&gt; Trace IO (PrettyObject ChainIndexLog) -&gt; Trace IO ChainIndexLog
forall a b (m :: * -&gt; *). (a -&gt; b) -&gt; Trace m b -&gt; Trace m a
</span><a href="Plutus.Monitoring.Util.html#convertLog"><span class="hs-identifier hs-var">convertLog</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexLog -&gt; PrettyObject ChainIndexLog
forall t. t -&gt; PrettyObject t
</span><a href="Plutus.Monitoring.Util.html#PrettyObject"><span class="hs-identifier hs-var">PrettyObject</span></a></span><span> </span><span class="annot"><span class="annottext">(Trace IO (PrettyObject ChainIndexLog) -&gt; Trace IO ChainIndexLog)
-&gt; Trace IO (PrettyObject ChainIndexLog) -&gt; Trace IO ChainIndexLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RunRequirements -&gt; Trace IO (PrettyObject ChainIndexLog)
</span><a href="Plutus.ChainIndex.html#trace"><span class="hs-identifier hs-var hs-var">trace</span></a></span><span> </span><span class="annot"><span class="annottext">RunRequirements
</span><a href="#local-6989586621679726783"><span class="hs-identifier hs-var">runReq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><span class="annottext">(Eff '[LogMsg ChainIndexLog, IO] (Either ChainIndexError a)
 -&gt; IO (Either ChainIndexError a))
-&gt; Eff '[LogMsg ChainIndexLog, IO] (Either ChainIndexError a)
-&gt; IO (Either ChainIndexError a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RunRequirements
-&gt; Eff
     '[ChainIndexQueryEffect, ChainIndexControlEffect,
       BeamEffect Sqlite, LogMsg ChainIndexLog, IO]
     a
-&gt; Eff '[LogMsg ChainIndexLog, IO] (Either ChainIndexError a)
forall (effs :: [* -&gt; *]) a.
(LastMember IO effs, Member (LogMsg ChainIndexLog) effs) =&gt;
RunRequirements
-&gt; Eff
     (ChainIndexQueryEffect
        : ChainIndexControlEffect : BeamEffect Sqlite : effs)
     a
-&gt; Eff effs (Either ChainIndexError a)
</span><a href="Plutus.ChainIndex.html#handleChainIndexEffects"><span class="hs-identifier hs-var">handleChainIndexEffects</span></a></span><span> </span><span class="annot"><span class="annottext">RunRequirements
</span><a href="#local-6989586621679726783"><span class="hs-identifier hs-var">runReq</span></a></span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   '[ChainIndexQueryEffect, ChainIndexControlEffect,
     BeamEffect Sqlite, LogMsg ChainIndexLog, IO]
   a
 -&gt; Eff '[LogMsg ChainIndexLog, IO] (Either ChainIndexError a))
-&gt; Eff
     '[ChainIndexQueryEffect, ChainIndexControlEffect,
       BeamEffect Sqlite, LogMsg ChainIndexLog, IO]
     a
-&gt; Eff '[LogMsg ChainIndexLog, IO] (Either ChainIndexError a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Eff
  '[ChainIndexQueryEffect, ChainIndexControlEffect,
    BeamEffect Sqlite]
  a
-&gt; Eff
     '[ChainIndexQueryEffect, ChainIndexControlEffect,
       BeamEffect Sqlite, LogMsg ChainIndexLog, IO]
     a
forall (effs :: [* -&gt; *]) (as :: [* -&gt; *]).
CanWeakenEnd as effs =&gt;
Eff as ~&gt; Eff effs
</span><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-var">raiseEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Eff
  '[ChainIndexQueryEffect, ChainIndexControlEffect,
    BeamEffect Sqlite]
  a
</span><a href="#local-6989586621679726782"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | Handle the chain index effects from the set of all effects.</span><span>
</span><span id="line-60"></span><span id="local-6989586621679726876"><span id="local-6989586621679726879"><span class="annot"><a href="Plutus.ChainIndex.html#handleChainIndexEffects"><span class="hs-identifier hs-type">handleChainIndexEffects</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">LastMember</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679726879"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-type">LogMsg</span></a></span><span> </span><span class="annot"><a href="Plutus.ChainIndex.ChainIndexLog.html#ChainIndexLog"><span class="hs-identifier hs-type">ChainIndexLog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679726879"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.html#RunRequirements"><span class="hs-identifier hs-type">RunRequirements</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Eff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.ChainIndex.Effects.html#ChainIndexQueryEffect"><span class="hs-identifier hs-type">ChainIndexQueryEffect</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Plutus.ChainIndex.Effects.html#ChainIndexControlEffect"><span class="hs-identifier hs-type">ChainIndexControlEffect</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-type">BeamEffect</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/c2ys4mf3ij618ysqljn71b9gp0j0imn5-beam-sqlite-lib-beam-sqlite-0.5.1.2-haddock-doc/share/doc/beam-sqlite/html/src"><span class="hs-identifier hs-type">Sqlite</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679726879"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679726876"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Eff</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679726879"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Plutus.ChainIndex.ChainIndexError.html#ChainIndexError"><span class="hs-identifier hs-type">ChainIndexError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679726876"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-65"></span><span id="handleChainIndexEffects"><span class="annot"><span class="annottext">handleChainIndexEffects :: RunRequirements
-&gt; Eff
     (ChainIndexQueryEffect
        : ChainIndexControlEffect : BeamEffect Sqlite : effs)
     a
-&gt; Eff effs (Either ChainIndexError a)
</span><a href="Plutus.ChainIndex.html#handleChainIndexEffects"><span class="hs-identifier hs-var hs-var">handleChainIndexEffects</span></a></span></span><span> </span><span class="annot"><a href="Plutus.ChainIndex.html#RunRequirements"><span class="hs-identifier hs-type">RunRequirements</span></a></span><span class="hs-special">{</span><span id="local-6989586621679726781"><span class="annot"><span class="annottext">Trace IO (PrettyObject ChainIndexLog)
trace :: Trace IO (PrettyObject ChainIndexLog)
trace :: RunRequirements -&gt; Trace IO (PrettyObject ChainIndexLog)
</span><a href="#local-6989586621679726781"><span class="hs-identifier hs-var hs-var">trace</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679726780"><span class="annot"><span class="annottext">TVar ChainIndexState
stateTVar :: TVar ChainIndexState
stateTVar :: RunRequirements -&gt; TVar ChainIndexState
</span><a href="#local-6989586621679726780"><span class="hs-identifier hs-var hs-var">stateTVar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679726779"><span class="annot"><span class="annottext">Pool Connection
pool :: Pool Connection
pool :: RunRequirements -&gt; Pool Connection
</span><a href="#local-6989586621679726779"><span class="hs-identifier hs-var hs-var">pool</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679726778"><span class="annot"><span class="annottext">Int
securityParam :: Int
securityParam :: RunRequirements -&gt; Int
</span><a href="#local-6989586621679726778"><span class="hs-identifier hs-var hs-var">securityParam</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679726777"><span class="annot"><span class="annottext">Eff
  (ChainIndexQueryEffect
     : ChainIndexControlEffect : BeamEffect Sqlite : effs)
  a
</span><a href="#local-6989586621679726777"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-66"></span><span>    </span><span id="local-6989586621679726776"><span class="annot"><span class="annottext">ChainIndexState
</span><a href="#local-6989586621679726776"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ChainIndexState -&gt; Eff effs ChainIndexState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ChainIndexState -&gt; Eff effs ChainIndexState)
-&gt; IO ChainIndexState -&gt; Eff effs ChainIndexState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TVar ChainIndexState -&gt; IO ChainIndexState
forall a. TVar a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">readTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">TVar ChainIndexState
</span><a href="#local-6989586621679726780"><span class="hs-identifier hs-var">stateTVar</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679726775"><span class="annot"><span class="annottext">Either ChainIndexError a
</span><a href="#local-6989586621679726775"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679726774"><span class="annot"><span class="annottext">ChainIndexState
</span><a href="#local-6989586621679726774"><span class="hs-identifier hs-var">newState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><span class="annottext">ChainIndexState
-&gt; Eff (State ChainIndexState : effs) (Either ChainIndexError a)
-&gt; Eff effs (Either ChainIndexError a, ChainIndexState)
forall s (effs :: [* -&gt; *]) a.
s -&gt; Eff (State s : effs) a -&gt; Eff effs (a, s)
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">runState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexState
</span><a href="#local-6989586621679726776"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><span class="annottext">(Eff (State ChainIndexState : effs) (Either ChainIndexError a)
 -&gt; Eff effs (Either ChainIndexError a, ChainIndexState))
-&gt; Eff (State ChainIndexState : effs) (Either ChainIndexError a)
-&gt; Eff effs (Either ChainIndexError a, ChainIndexState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pool Connection
-&gt; Eff
     (Reader (Pool Connection) : State ChainIndexState : effs)
     (Either ChainIndexError a)
-&gt; Eff (State ChainIndexState : effs) (Either ChainIndexError a)
forall r (effs :: [* -&gt; *]) a.
r -&gt; Eff (Reader r : effs) a -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">runReader</span></a></span><span> </span><span class="annot"><span class="annottext">Pool Connection
</span><a href="#local-6989586621679726779"><span class="hs-identifier hs-var">pool</span></a></span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Reader (Pool Connection) : State ChainIndexState : effs)
   (Either ChainIndexError a)
 -&gt; Eff (State ChainIndexState : effs) (Either ChainIndexError a))
-&gt; Eff
     (Reader (Pool Connection) : State ChainIndexState : effs)
     (Either ChainIndexError a)
-&gt; Eff (State ChainIndexState : effs) (Either ChainIndexError a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Depth
-&gt; Eff
     (Reader Depth
        : Reader (Pool Connection) : State ChainIndexState : effs)
     (Either ChainIndexError a)
-&gt; Eff
     (Reader (Pool Connection) : State ChainIndexState : effs)
     (Either ChainIndexError a)
forall r (effs :: [* -&gt; *]) a.
r -&gt; Eff (Reader r : effs) a -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">runReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Depth
</span><a href="Plutus.ChainIndex.Types.html#Depth"><span class="hs-identifier hs-var">Depth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679726778"><span class="hs-identifier hs-var">securityParam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Reader Depth
      : Reader (Pool Connection) : State ChainIndexState : effs)
   (Either ChainIndexError a)
 -&gt; Eff
      (Reader (Pool Connection) : State ChainIndexState : effs)
      (Either ChainIndexError a))
-&gt; Eff
     (Reader Depth
        : Reader (Pool Connection) : State ChainIndexState : effs)
     (Either ChainIndexError a)
-&gt; Eff
     (Reader (Pool Connection) : State ChainIndexState : effs)
     (Either ChainIndexError a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]) a.
Eff (Error ChainIndexError : effs) a
-&gt; Eff effs (Either ChainIndexError a)
forall e (effs :: [* -&gt; *]) a.
Eff (Error e : effs) a -&gt; Eff effs (Either e a)
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">runError</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.ChainIndex.ChainIndexError.html#ChainIndexError"><span class="hs-identifier hs-type">ChainIndexError</span></a></span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Error ChainIndexError
      : Reader Depth : Reader (Pool Connection) : State ChainIndexState
      : effs)
   a
 -&gt; Eff
      (Reader Depth
         : Reader (Pool Connection) : State ChainIndexState : effs)
      (Either ChainIndexError a))
-&gt; Eff
     (Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
-&gt; Eff
     (Reader Depth
        : Reader (Pool Connection) : State ChainIndexState : effs)
     (Either ChainIndexError a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (Error BeamError
      : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
      : State ChainIndexState : effs)
   a
 -&gt; (BeamError
     -&gt; Eff
          (Error ChainIndexError
             : Reader Depth : Reader (Pool Connection) : State ChainIndexState
             : effs)
          a)
 -&gt; Eff
      (Error ChainIndexError
         : Reader Depth : Reader (Pool Connection) : State ChainIndexState
         : effs)
      a)
-&gt; (BeamError
    -&gt; Eff
         (Error ChainIndexError
            : Reader Depth : Reader (Pool Connection) : State ChainIndexState
            : effs)
         a)
-&gt; Eff
     (Error BeamError
        : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
        : State ChainIndexState : effs)
     a
-&gt; Eff
     (Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">Eff
  (Error BeamError
     : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
     : State ChainIndexState : effs)
  a
-&gt; (BeamError
    -&gt; Eff
         (Error ChainIndexError
            : Reader Depth : Reader (Pool Connection) : State ChainIndexState
            : effs)
         a)
-&gt; Eff
     (Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
forall e (effs :: [* -&gt; *]) a.
Eff (Error e : effs) a -&gt; (e -&gt; Eff effs a) -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">handleError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainIndexError
-&gt; Eff
     (Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
forall e (effs :: [* -&gt; *]) a.
Member (Error e) effs =&gt;
e -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainIndexError
 -&gt; Eff
      (Error ChainIndexError
         : Reader Depth : Reader (Pool Connection) : State ChainIndexState
         : effs)
      a)
-&gt; (BeamError -&gt; ChainIndexError)
-&gt; BeamError
-&gt; Eff
     (Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BeamError -&gt; ChainIndexError
</span><a href="Plutus.ChainIndex.ChainIndexError.html#BeamEffectError"><span class="hs-identifier hs-var">BeamEffectError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Error BeamError
      : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
      : State ChainIndexState : effs)
   a
 -&gt; Eff
      (Error ChainIndexError
         : Reader Depth : Reader (Pool Connection) : State ChainIndexState
         : effs)
      a)
-&gt; Eff
     (Error BeamError
        : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
        : State ChainIndexState : effs)
     a
-&gt; Eff
     (Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(BeamEffect Sqlite
 ~&gt; Eff
      (Error BeamError
         : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
         : State ChainIndexState : effs))
-&gt; Eff
     (BeamEffect Sqlite
        : Error BeamError : Error ChainIndexError : Reader Depth
        : Reader (Pool Connection) : State ChainIndexState : effs)
   ~&gt; Eff
        (Error BeamError
           : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
           : State ChainIndexState : effs)
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
(eff ~&gt; Eff effs) -&gt; Eff (eff : effs) ~&gt; Eff effs
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Trace IO BeamLog
 -&gt; SqliteM
    ~&gt; Eff
         (Error BeamError
            : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
            : State ChainIndexState : effs))
-&gt; Trace IO BeamLog
-&gt; BeamEffect Sqlite
   ~&gt; Eff
        (Error BeamError
           : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
           : State ChainIndexState : effs)
forall dbt (dbM :: * -&gt; *) (effs :: [* -&gt; *]).
(BeamSqlBackend dbt, MonadBeam dbt dbM,
 BeamHasInsertOnConflict dbt) =&gt;
(Trace IO BeamLog -&gt; dbM ~&gt; Eff effs)
-&gt; Trace IO BeamLog -&gt; BeamEffect dbt ~&gt; Eff effs
</span><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-var">handleBeam</span></a></span><span> </span><span class="annot"><span class="annottext">Trace IO BeamLog
-&gt; SqliteM
   ~&gt; Eff
        (Error BeamError
           : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
           : State ChainIndexState : effs)
forall (effs :: [* -&gt; *]).
(LastMember IO effs, Member (Reader (Pool Connection)) effs) =&gt;
Trace IO BeamLog -&gt; SqliteM ~&gt; Eff effs
</span><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-var">runBeam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BeamLog -&gt; PrettyObject ChainIndexLog)
-&gt; Trace IO (PrettyObject ChainIndexLog) -&gt; Trace IO BeamLog
forall a b (m :: * -&gt; *). (a -&gt; b) -&gt; Trace m b -&gt; Trace m a
</span><a href="Plutus.Monitoring.Util.html#convertLog"><span class="hs-identifier hs-var">convertLog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainIndexLog -&gt; PrettyObject ChainIndexLog
forall t. t -&gt; PrettyObject t
</span><a href="Plutus.Monitoring.Util.html#PrettyObject"><span class="hs-identifier hs-var">PrettyObject</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainIndexLog -&gt; PrettyObject ChainIndexLog)
-&gt; (BeamLog -&gt; ChainIndexLog)
-&gt; BeamLog
-&gt; PrettyObject ChainIndexLog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BeamLog -&gt; ChainIndexLog
</span><a href="Plutus.ChainIndex.ChainIndexLog.html#BeamLogItem"><span class="hs-identifier hs-var">Export.BeamLogItem</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Trace IO (PrettyObject ChainIndexLog)
</span><a href="#local-6989586621679726781"><span class="hs-identifier hs-var">trace</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (BeamEffect Sqlite
      : Error BeamError : Error ChainIndexError : Reader Depth
      : Reader (Pool Connection) : State ChainIndexState : effs)
   a
 -&gt; Eff
      (Error BeamError
         : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
         : State ChainIndexState : effs)
      a)
-&gt; Eff
     (BeamEffect Sqlite
        : Error BeamError : Error ChainIndexError : Reader Depth
        : Reader (Pool Connection) : State ChainIndexState : effs)
     a
-&gt; Eff
     (Error BeamError
        : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
        : State ChainIndexState : effs)
     a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainIndexControlEffect
 ~&gt; Eff
      (BeamEffect Sqlite
         : Error BeamError : Error ChainIndexError : Reader Depth
         : Reader (Pool Connection) : State ChainIndexState : effs))
-&gt; Eff
     (ChainIndexControlEffect
        : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
   ~&gt; Eff
        (BeamEffect Sqlite
           : Error BeamError : Error ChainIndexError : Reader Depth
           : Reader (Pool Connection) : State ChainIndexState : effs)
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
(eff ~&gt; Eff effs) -&gt; Eff (eff : effs) ~&gt; Eff effs
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State ChainIndexState) effs, Member (Reader Depth) effs,
 Member (BeamEffect Sqlite) effs,
 Member (Error ChainIndexError) effs,
 Member (LogMsg ChainIndexLog) effs) =&gt;
ChainIndexControlEffect ~&gt; Eff effs
ChainIndexControlEffect
~&gt; Eff
     (BeamEffect Sqlite
        : Error BeamError : Error ChainIndexError : Reader Depth
        : Reader (Pool Connection) : State ChainIndexState : effs)
</span><a href="Plutus.ChainIndex.Handlers.html#handleControl"><span class="hs-identifier hs-var">handleControl</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (ChainIndexControlEffect
      : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
      : Reader Depth : Reader (Pool Connection) : State ChainIndexState
      : effs)
   a
 -&gt; Eff
      (BeamEffect Sqlite
         : Error BeamError : Error ChainIndexError : Reader Depth
         : Reader (Pool Connection) : State ChainIndexState : effs)
      a)
-&gt; Eff
     (ChainIndexControlEffect
        : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
-&gt; Eff
     (BeamEffect Sqlite
        : Error BeamError : Error ChainIndexError : Reader Depth
        : Reader (Pool Connection) : State ChainIndexState : effs)
     a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainIndexQueryEffect
 ~&gt; Eff
      (ChainIndexControlEffect
         : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
         : Reader Depth : Reader (Pool Connection) : State ChainIndexState
         : effs))
-&gt; Eff
     (ChainIndexQueryEffect
        : ChainIndexControlEffect : BeamEffect Sqlite : Error BeamError
        : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
        : State ChainIndexState : effs)
   ~&gt; Eff
        (ChainIndexControlEffect
           : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
           : Reader Depth : Reader (Pool Connection) : State ChainIndexState
           : effs)
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
(eff ~&gt; Eff effs) -&gt; Eff (eff : effs) ~&gt; Eff effs
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State ChainIndexState) effs,
 Member (BeamEffect Sqlite) effs,
 Member (Error ChainIndexError) effs,
 Member (LogMsg ChainIndexLog) effs) =&gt;
ChainIndexQueryEffect ~&gt; Eff effs
ChainIndexQueryEffect
~&gt; Eff
     (ChainIndexControlEffect
        : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
</span><a href="Plutus.ChainIndex.Handlers.html#handleQuery"><span class="hs-identifier hs-var">handleQuery</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-comment">-- Insert the 5 effects needed by the handlers of the 3 chain index effects between those 3 effects and 'effs'.</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (ChainIndexQueryEffect
      : ChainIndexControlEffect : BeamEffect Sqlite : Error BeamError
      : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
      : State ChainIndexState : effs)
   a
 -&gt; Eff
      (ChainIndexControlEffect
         : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
         : Reader Depth : Reader (Pool Connection) : State ChainIndexState
         : effs)
      a)
-&gt; Eff
     (ChainIndexQueryEffect
        : ChainIndexControlEffect : BeamEffect Sqlite : Error BeamError
        : Error ChainIndexError : Reader Depth : Reader (Pool Connection)
        : State ChainIndexState : effs)
     a
-&gt; Eff
     (ChainIndexControlEffect
        : BeamEffect Sqlite : Error BeamError : Error ChainIndexError
        : Reader Depth : Reader (Pool Connection) : State ChainIndexState
        : effs)
     a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Eff
  ('[ChainIndexQueryEffect, ChainIndexControlEffect,
     BeamEffect Sqlite]
   :++: effs)
  a
-&gt; Eff
     ('[ChainIndexQueryEffect, ChainIndexControlEffect,
        BeamEffect Sqlite]
      :++: ('[Error BeamError, Error ChainIndexError, Reader Depth,
              Reader (Pool Connection), State ChainIndexState]
            :++: effs))
     a
forall (effs' :: [* -&gt; *]) (as :: [* -&gt; *]) (effs :: [* -&gt; *]).
(UnderN as, Weakens effs') =&gt;
Eff (as :++: effs) ~&gt; Eff (as :++: (effs' :++: effs))
</span><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-var">raiseMUnderN</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Eff
  (ChainIndexQueryEffect
     : ChainIndexControlEffect : BeamEffect Sqlite : effs)
  a
Eff
  ('[ChainIndexQueryEffect, ChainIndexControlEffect,
     BeamEffect Sqlite]
   :++: effs)
  a
</span><a href="#local-6989586621679726777"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Eff effs ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Eff effs ()) -&gt; IO () -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TVar ChainIndexState -&gt; ChainIndexState -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">writeTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar ChainIndexState
</span><a href="#local-6989586621679726780"><span class="hs-identifier hs-var">stateTVar</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexState
</span><a href="#local-6989586621679726774"><span class="hs-identifier hs-var">newState</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">Either ChainIndexError a -&gt; Eff effs (Either ChainIndexError a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Either ChainIndexError a
</span><a href="#local-6989586621679726775"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-80"></span></pre></body></html>
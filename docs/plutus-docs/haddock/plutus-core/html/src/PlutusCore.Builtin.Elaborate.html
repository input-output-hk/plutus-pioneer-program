<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- GHC doesn't like the definition of 'TrySpecializeAsVar'.</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-redundant-constraints #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds          #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DataKinds                #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances        #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies   #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds                #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StandaloneKindSignatures #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications         #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies             #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators            #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances     #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusCore.Builtin.Elaborate</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ElaborateFromTo"><span class="hs-identifier">ElaborateFromTo</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html"><span class="hs-identifier">PlutusCore.Builtin.KnownTypeAst</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html"><span class="hs-identifier">PlutusCore.Builtin.Polymorphism</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html"><span class="hs-identifier">PlutusCore.Core.Type</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Kind</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GHC</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Type.Bool</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Type.Equality</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.TypeLits</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-comment">-- The 'TryUnify' gadget explained in detail in https://github.com/effectfully/sketches/tree/master/poly-type-of-saga/part1-try-unify</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">-- | Check if two values of different kinds are in fact the same value (with the same kind).</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- A heterogeneous version of @Type.Equality.(==)@.</span><span>
</span><span id="line-32"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">(===)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955794"><span class="annot"><a href="#local-6989586621680955794"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680955793"><span class="annot"><a href="#local-6989586621680955793"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680955794"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955793"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="local-6989586621680955792"><span class="annot"><a href="#local-6989586621680955792"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="%3D%3D%3D"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span></span><span> </span><span id="local-6989586621680955791"><span class="annot"><a href="#local-6989586621680955791"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>    </span><span id="local-6989586621680955790"><span class="annot"><a href="#local-6989586621680955790"><span class="hs-identifier hs-type hs-type">x</span></a></span></span><span> </span><span id="%3D%3D%3D"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680955790"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">True</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span id="local-6989586621680955789"><span class="annot"><a href="#local-6989586621680955789"><span class="hs-identifier hs-type hs-type">x</span></a></span></span><span> </span><span id="%3D%3D%3D"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span></span><span> </span><span id="local-6989586621680955788"><span class="annot"><a href="#local-6989586621680955788"><span class="hs-identifier hs-type hs-type">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">False</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955846"><span class="annot"><a href="#local-6989586621680955846"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680955845"><span class="annot"><a href="#local-6989586621680955845"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955846"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955845"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="#local-6989586621680955844"><span class="hs-identifier hs-type">same</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955843"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955842"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="TryUnify"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-var">TryUnify</span></a></span></span><span> </span><span id="local-6989586621680955844"><span class="annot"><a href="#local-6989586621680955844"><span class="hs-identifier hs-type">same</span></a></span></span><span> </span><span id="local-6989586621680955843"><span class="annot"><a href="#local-6989586621680955843"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680955842"><span class="annot"><a href="#local-6989586621680955842"><span class="hs-identifier hs-type">y</span></a></span></span><span>
</span><span id="line-39"></span><span id="local-6989586621680955786"><span id="local-6989586621680955787"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955787"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955786"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">False</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">False</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955787"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955786"><span class="hs-identifier hs-type">y</span></a></span></span></span><span>
</span><span id="line-40"></span><span id="local-6989586621680955781"><span id="local-6989586621680955782"><span id="local-6989586621680955783"><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# INCOHERENT</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955783"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-type">~~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955782"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680955781"><span class="hs-identifier hs-type">same</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">True</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955781"><span class="hs-identifier hs-type">same</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955783"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955782"><span class="hs-identifier hs-type">y</span></a></span></span></span></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | Unify two values unless they're obviously distinct (in which case do nothing).</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- Allows us to detect and specialize type variables, since a type variable is not obviously</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- distinct from anything else and so the INCOHERENT instance of 'TryUnify' gets triggered and the</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- variable gets unified with whatever we want it to.</span><span>
</span><span id="line-46"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#~%3F~"><span class="hs-operator hs-type">(~?~)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955778"><span class="annot"><a href="#local-6989586621680955778"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680955777"><span class="annot"><a href="#local-6989586621680955777"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680955778"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955777"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">type</span><span> </span><span id="local-6989586621680955776"><span class="annot"><a href="#local-6989586621680955776"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="~%3F~"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#~%3F~"><span class="hs-operator hs-var">~?~</span></a></span></span><span> </span><span id="local-6989586621680955775"><span class="annot"><a href="#local-6989586621680955775"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955776"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955775"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680955776"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955775"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | Get the element at an @i@th position in a list.</span><span>
</span><span id="line-50"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955773"><span class="annot"><a href="#local-6989586621680955773"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680955773"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955773"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span id="local-6989586621680955772"><span class="annot"><a href="#local-6989586621680955772"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621680955771"><span class="annot"><a href="#local-6989586621680955771"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-52"></span><span>    </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Not enough elements&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680955770"><span class="annot"><a href="#local-6989586621680955770"><span class="hs-identifier hs-type hs-type">x</span></a></span></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span id="local-6989586621680955769"><span class="annot"><a href="#local-6989586621680955769"><span class="hs-identifier hs-type hs-type">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680955770"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span id="local-6989586621680955768"><span class="annot"><a href="#local-6989586621680955768"><span class="hs-identifier hs-type hs-type">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span id="local-6989586621680955767"><span class="annot"><a href="#local-6989586621680955767"><span class="hs-identifier hs-type hs-type">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955768"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-type">-</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680955767"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | Get the name at the @i@th position in the list of default names. We could use @a_0@, @a_1@,</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- @a_2@ etc instead, but @a@, @b@, @c@ etc are nicer.</span><span>
</span><span id="line-58"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-type">GetName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="GetName"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-var">GetName</span></a></span></span><span> </span><span id="local-6989586621680955765"><span class="annot"><a href="#local-6989586621680955765"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621680955764"><span class="annot"><a href="#local-6989586621680955764"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>    </span><span id="GetName"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-var">GetName</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span id="local-6989586621680955763"><span class="annot"><a href="#local-6989586621680955763"><span class="hs-identifier hs-type hs-type">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955763"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;a&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;b&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;c&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;d&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;e&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;i&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;j&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;k&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;l&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>    </span><span id="GetName"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-var">GetName</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>        </span><span id="local-6989586621680955762"><span class="annot"><a href="#local-6989586621680955762"><span class="hs-identifier hs-type hs-type">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955762"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;f&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;g&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;h&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;m&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;n&quot;</span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- For higher-kinded types.</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- | Like 'id', but a type constructor.</span><span>
</span><span id="line-64"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955760"><span class="annot"><a href="#local-6989586621680955760"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680955760"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955760"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Id"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Id"><span class="hs-identifier hs-var">Id</span></a></span></span><span> </span><span id="local-6989586621680955759"><span class="annot"><a href="#local-6989586621680955759"><span class="hs-identifier hs-type">x</span></a></span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | Try to specialize @a@ as a type representing a PLC type variable.</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- @i@ is a fresh id and @j@ is a final one (either @i + 1@ or @i@ depending on whether</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- specialization attempt is successful or not).</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- @f@ is for wrapping 'TyVarRep' (see 'HandleHole' for how this is used).</span><span>
</span><span id="line-71"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955830"><span class="annot"><a href="#local-6989586621680955830"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955830"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955830"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955830"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">class</span><span> </span><span id="TrySpecializeAsVar"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-var">TrySpecializeAsVar</span></a></span></span><span> </span><span id="local-6989586621680955829"><span class="annot"><a href="#local-6989586621680955829"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680955828"><span class="annot"><a href="#local-6989586621680955828"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680955827"><span class="annot"><a href="#local-6989586621680955827"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680955826"><span class="annot"><a href="#local-6989586621680955826"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680955829"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955827"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955826"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955828"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-73"></span><span id="local-6989586621680955753"><span id="local-6989586621680955754"><span id="local-6989586621680955755"><span id="local-6989586621680955756"><span id="local-6989586621680955757"><span id="local-6989586621680955758"><span class="hs-keyword">instance</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621680955758"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955757"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#TyVarRep"><span class="hs-identifier hs-type">TyVarRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680955756"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#TyNameRep"><span class="hs-identifier hs-type">TyNameRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-type">GetName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955756"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955755"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680955755"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-comment">-- Try to unify @a@ with a freshly created @var@.</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680955754"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#~%3F~"><span class="hs-operator hs-type">~?~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955758"><span class="hs-identifier hs-type">var</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- If @a@ is equal to @var@ then unification was successful and we just used the fresh id and</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- so we need to bump it up. Otherwise @var@ was discarded and so the fresh id is still fresh.</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- Replacing @(===)@ with @(==)@ causes errors at use site, for whatever reason.</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680955753"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955754"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955758"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955755"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-type">+</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680955755"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955755"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955753"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955757"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955754"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680955756"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | First try to specialize the hole using 'TrySpecializeAsVar' and then recurse on the result of</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- that using 'HandleHoles'.</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- @i@ is a fresh id and @j@ is a final one as in 'TrySpecializeAsVar', but since 'HandleHole' can</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- specialize multiple variables, @j@ can be equal to @i + n@ for any @n@ (including @0@).</span><span>
</span><span id="line-87"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">class</span><span> </span><span id="HandleHole"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-var">HandleHole</span></a></span></span><span> </span><span id="local-6989586621680955817"><span class="annot"><a href="#local-6989586621680955817"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680955816"><span class="annot"><a href="#local-6989586621680955816"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680955815"><span class="annot"><a href="#local-6989586621680955815"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680955814"><span class="annot"><a href="#local-6989586621680955814"><span class="hs-identifier hs-type">hole</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680955817"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955815"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955814"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955816"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- In the Rep context @x@ is attempted to be instantiated as a 'TyVarRep'.</span><span>
</span><span id="line-90"></span><span id="local-6989586621680955744"><span id="local-6989586621680955745"><span id="local-6989586621680955746"><span id="local-6989586621680955747"><span id="local-6989586621680955748"><span class="hs-keyword">instance</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955748"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955747"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955746"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- The two 'Id's cancel each other.</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-type">HandleHoles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955747"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955745"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955744"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955746"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955748"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955745"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955744"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#RepHole"><span class="hs-identifier hs-type">RepHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955746"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- In the Type context @a@ is attempted to be instantiated as a 'TyVarRep' wrapped in @Opaque val@.</span><span>
</span><span id="line-95"></span><span id="local-6989586621680955737"><span id="local-6989586621680955738"><span id="local-6989586621680955739"><span id="local-6989586621680955740"><span id="local-6989586621680955741"><span class="hs-keyword">instance</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955741"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955740"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#Opaque"><span class="hs-identifier hs-type">Opaque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955739"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680955738"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-type">HandleHoles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955740"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955737"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955739"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955738"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955741"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955737"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955739"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#TypeHole"><span class="hs-identifier hs-type">TypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955738"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Call 'HandleHole' over each hole from the list, threading the state (the fresh unique) through</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- the calls.</span><span>
</span><span id="line-102"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">class</span><span> </span><span id="HandleHolesGo"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-var">HandleHolesGo</span></a></span></span><span> </span><span id="local-6989586621680955804"><span class="annot"><a href="#local-6989586621680955804"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680955803"><span class="annot"><a href="#local-6989586621680955803"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680955802"><span class="annot"><a href="#local-6989586621680955802"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680955801"><span class="annot"><a href="#local-6989586621680955801"><span class="hs-identifier hs-type">holes</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680955804"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955802"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955801"><span class="hs-identifier hs-type">holes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955803"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-104"></span><span id="local-6989586621680955733"><span id="local-6989586621680955734"><span id="local-6989586621680955735"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="#local-6989586621680955735"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955734"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955735"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955734"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955733"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-105"></span><span id="local-6989586621680955726"><span id="local-6989586621680955727"><span id="local-6989586621680955728"><span id="local-6989586621680955729"><span id="local-6989586621680955730"><span id="local-6989586621680955731"><span class="hs-keyword">instance</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955731"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955730"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955729"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955728"><span class="hs-identifier hs-type">hole</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955730"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955727"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955729"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955726"><span class="hs-identifier hs-type">holes</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955731"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955727"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955729"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680955728"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680955726"><span class="hs-identifier hs-type">holes</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | If the outermost constructor of the second argument is known and happens to be one of the</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- constructors of the list data type, then the second argument is returned back. Otherwise the</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- first one is returned, which is meant to be a custom type error.</span><span>
</span><span id="line-113"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-type">ThrowOnStuckList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955724"><span class="annot"><a href="#local-6989586621680955724"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680955724"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680955724"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680955724"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span id="local-6989586621680955723"><span class="annot"><a href="#local-6989586621680955723"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621680955722"><span class="annot"><a href="#local-6989586621680955722"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>    </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>    </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621680955721"><span class="annot"><a href="#local-6989586621680955721"><span class="hs-identifier hs-type hs-type">x</span></a></span></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span id="local-6989586621680955720"><span class="annot"><a href="#local-6989586621680955720"><span class="hs-identifier hs-type hs-type">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680955721"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680955720"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span id="local-6989586621680955719"><span class="annot"><a href="#local-6989586621680955719"><span class="hs-identifier hs-type hs-type">err</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680955719"><span class="hs-identifier hs-type">err</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-type">UnknownTypeError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955717"><span class="annot"><a href="#local-6989586621680955717"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680955716"><span class="annot"><a href="#local-6989586621680955716"><span class="hs-identifier hs-type">any</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955717"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955716"><span class="hs-identifier hs-type">any</span></a></span><span>
</span><span id="line-120"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnknownTypeError"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-var">UnknownTypeError</span></a></span></span><span> </span><span id="local-6989586621680955715"><span class="annot"><a href="#local-6989586621680955715"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680955714"><span class="annot"><a href="#local-6989586621680955714"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span id="UnknownTypeError"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-var">UnknownTypeError</span></a></span></span><span> </span><span id="local-6989586621680955713"><span class="annot"><a href="#local-6989586621680955713"><span class="hs-identifier hs-type hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680955712"><span class="annot"><a href="#local-6989586621680955712"><span class="hs-identifier hs-type hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">TypeError</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-special">(</span><span>         </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;No instance for &#8216;KnownTypeAst &quot;</span></span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">ShowType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955713"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">ShowType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955712"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-126"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;)&#8217;&quot;</span></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Which means&quot;</span></span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  &#8216;&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">ShowType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955712"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&#8217;&quot;</span></span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;is neither a built-in type, nor one of the control types.&quot;</span></span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;If it can be represented in terms of one of the built-in types&quot;</span></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  then go add the instance (you may need a &#8216;KnownTypeIn&#8217; one too)&quot;</span></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  alongside the instance for the built-in type.&quot;</span></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Otherwise you may need to add a new built-in type&quot;</span></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  (provided you're doing something that can be supported in principle)&quot;</span></span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- | Get the holes of @x@ and recurse into them.</span><span>
</span><span id="line-138"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-type">HandleHoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680955710"><span class="annot"><a href="#local-6989586621680955710"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680955710"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">type</span><span> </span><span id="HandleHoles"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-var">HandleHoles</span></a></span></span><span> </span><span id="local-6989586621680955709"><span class="annot"><a href="#local-6989586621680955709"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680955708"><span class="annot"><a href="#local-6989586621680955708"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680955707"><span class="annot"><a href="#local-6989586621680955707"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680955706"><span class="annot"><a href="#local-6989586621680955706"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- Here we detect a stuck application of 'ToHoles' and throw 'UnknownTypeError' on it.</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">-- See https://blog.csongor.co.uk/report-stuck-families for a detailed description of how</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- detection of stuck type families works.</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955709"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955708"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955707"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-type">ThrowOnStuckList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-type">UnknownTypeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955707"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955706"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#ToHoles"><span class="hs-identifier hs-type">ToHoles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955706"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- | Specialize each Haskell type variable in @a@ as a type representing a PLC type variable.</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- @i@ is a fresh id and @j@ is a final one as in 'TrySpecializeAsVar', but since 'HandleHole' can</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- specialize multiple variables, @j@ can be equal to @i + n@ for any @n@ (including @0@).</span><span>
</span><span id="line-148"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ElaborateFromTo"><span class="hs-identifier hs-type">ElaborateFromTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">type</span><span> </span><span id="ElaborateFromTo"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ElaborateFromTo"><span class="hs-identifier hs-var">ElaborateFromTo</span></a></span></span><span> </span><span id="local-6989586621680955704"><span class="annot"><a href="#local-6989586621680955704"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680955703"><span class="annot"><a href="#local-6989586621680955703"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680955702"><span class="annot"><a href="#local-6989586621680955702"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680955701"><span class="annot"><a href="#local-6989586621680955701"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955704"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955703"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955702"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#TypeHole"><span class="hs-identifier hs-type">TypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680955701"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span></pre></body></html>
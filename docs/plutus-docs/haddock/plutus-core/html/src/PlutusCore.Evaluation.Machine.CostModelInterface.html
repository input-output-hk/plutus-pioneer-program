<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass    #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusCore.Evaluation.Machine.CostModelInterface</span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier">CostModelParams</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Evaluation.Machine.Cek.CekMachineCosts.html#CekMachineCosts"><span class="hs-identifier">CekMachineCosts</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#extractCostModelParams"><span class="hs-identifier">extractCostModelParams</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applyCostModelParams"><span class="hs-identifier">applyCostModelParams</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelApplyError"><span class="hs-identifier">CostModelApplyError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.BuiltinCostModel.html"><span class="hs-identifier">PlutusCore.Evaluation.Machine.BuiltinCostModel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.MachineParameters.html"><span class="hs-identifier">PlutusCore.Evaluation.Machine.MachineParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#CostModel"><span class="hs-identifier">CostModel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Evaluation.Machine.Cek.CekMachineCosts.html"><span class="hs-identifier">UntypedPlutusCore.Evaluation.Machine.Cek.CekMachineCosts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Evaluation.Machine.Cek.CekMachineCosts.html#CekMachineCosts"><span class="hs-identifier">CekMachineCosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Evaluation.Machine.Cek.CekMachineCosts.html#cekMachineCostsPrefix"><span class="hs-identifier">cekMachineCostsPrefix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Data.Aeson.Flatten.html"><span class="hs-identifier">Data.Aeson.Flatten</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/1lijxpzbkqglyyn51i9w8fvqinsawjqm-unordered-containers-lib-unordered-containers-0.2.19.1-haddock-doc/share/doc/unordered-containers/html/src"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Data.Map.Merge.Lazy</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-identifier">Prettyprinter</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-comment">{- Note [Cost model parameters]
We want to expose to the ledger some notion of the &quot;cost model
parameters&quot;. Intuitively, these should be all the numbers that appear in the
cost model.

However, there are quite a few quirks to deal with.

1. BuiltinCostModel is stuctured.

That is, it's a complex data structure and the numbers in question are often
nested inside it.  To deal with this quickly, we take the ugly approach of
operating on the JSON representation of the model.  We flatten this down into a
simple key-value mapping (see 'flattenObject' and 'unflattenObject'), and then
look only at the numbers.

2. We use CostingIntegers, Aeson uses Data.Scientific.

The numbers in CostModel objects are CostingIntegers, which are usually the
64-bit SatInt type (but Integer on 32-bit machines).  Numerical values in
Aeson-encoded JSON objects are represented as Data.Scientific (Integer mantissa,
Int exponent). We should be able to convert between these types without loss of
precision, except that Scientific numbers of large magnitude will overflow to
SatInt::MaxBound or underflow to SatInt::MinBound.  This is OK because
CostModelParams objects should never contain such large numbers. Any Plutus Core
programs whose cost reaches MaxBound will fail due to excessive resource usage.

3. BuiltinCostModel includes the *type* of the model, which isn't a parameter

We can just strip the type out, but in particular this means that the parameters are
not enough to *construct* a model.  So we punt and say that you can *update* a
model by giving the parameters. So you can take the default model and then
overwrite the parameters, which seems okay.

This is also implemented in a horrible JSON-y way.

4. The implementation is not nice.

Ugly JSON stuff and failure possibilities where there probably shouldn't be any.

5. The overall cost model now includes two components: a model for the internal
costs of the evaluator and a model for built-in evaluation costs.  We just
re-use the technique mentioned above to extract parameters for the evaluator
costs, merging these with the parameters for the builtin cost model to obtain
parameters for the overall model.  To recover cost model components we assume
that every field in the cost model for the evaluator begins with a prefix (eg
&quot;cek&quot;) which is does not occur as a prefix of any built-in function, and use
that to split the map of parameters into two maps.

-}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- See Note [Cost model parameters]</span><span>
</span><span id="line-79"></span><span class="hs-keyword">type</span><span> </span><span id="CostModelParams"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-var">CostModelParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text.Text</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- See Note [Cost model parameters]</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | Extract the model parameters from a model.</span><span>
</span><span id="line-83"></span><span id="local-6989586621680964004"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#extractParams"><span class="hs-identifier hs-type">extractParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680964004"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680964004"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span></span><span>
</span><span id="line-84"></span><span id="extractParams"><span class="annot"><span class="annottext">extractParams :: a -&gt; Maybe CostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#extractParams"><span class="hs-identifier hs-var hs-var">extractParams</span></a></span></span><span> </span><span id="local-6989586621680963983"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680963983"><span class="hs-identifier hs-var">cm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680963983"><span class="hs-identifier hs-var">cm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621680963980"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680963980"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-87"></span><span>            </span><span id="local-6989586621680963979"><span class="annot"><span class="annottext">flattened :: HashMap Text Value
</span><a href="#local-6989586621680963979"><span class="hs-identifier hs-var hs-var">flattened</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; HashMap Text Value
</span><a href="Data.Aeson.Flatten.html#objToHm"><span class="hs-identifier hs-var">objToHm</span></a></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; HashMap Text Value) -&gt; Object -&gt; HashMap Text Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Object
</span><a href="Data.Aeson.Flatten.html#flattenObject"><span class="hs-identifier hs-var">flattenObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680963980"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-88"></span><span>            </span><span id="local-6989586621680963976"><span class="annot"><span class="annottext">usingCostingIntegers :: HashMap Text Integer
</span><a href="#local-6989586621680963976"><span class="hs-identifier hs-var hs-var">usingCostingIntegers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Maybe Integer)
-&gt; HashMap Text Value -&gt; HashMap Text Integer
forall v1 v2 k. (v1 -&gt; Maybe v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><a href="../file:///nix/store/1lijxpzbkqglyyn51i9w8fvqinsawjqm-unordered-containers-lib-unordered-containers-0.2.19.1-haddock-doc/share/doc/unordered-containers/html/src"><span class="hs-identifier hs-var">HM.mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span id="local-6989586621680963973"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621680963973"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Maybe Integer) -&gt; Integer -&gt; Maybe Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Integer
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">ceiling</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621680963973"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap Text Value
</span><a href="#local-6989586621680963979"><span class="hs-identifier hs-var">flattened</span></a></span><span>
</span><span id="line-89"></span><span>            </span><span class="hs-comment">-- ^ Only (the contents of) the &quot;Just&quot; values are retained in the output map.</span><span>
</span><span id="line-90"></span><span>            </span><span id="local-6989586621680963971"><span class="annot"><span class="annottext">mapified :: CostModelParams
</span><a href="#local-6989586621680963971"><span class="hs-identifier hs-var hs-var">mapified</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, Integer)] -&gt; CostModelParams
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Text, Integer)] -&gt; CostModelParams)
-&gt; [(Text, Integer)] -&gt; CostModelParams
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Integer -&gt; [(Text, Integer)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><a href="../file:///nix/store/1lijxpzbkqglyyn51i9w8fvqinsawjqm-unordered-containers-lib-unordered-containers-0.2.19.1-haddock-doc/share/doc/unordered-containers/html/src"><span class="hs-identifier hs-var">HM.toList</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Integer
</span><a href="#local-6989586621680963976"><span class="hs-identifier hs-var">usingCostingIntegers</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CostModelParams -&gt; Maybe CostModelParams
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963971"><span class="hs-identifier hs-var">mapified</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CostModelParams
forall a. Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | The type of errors that 'applyParams' can throw.</span><span>
</span><span id="line-96"></span><span class="hs-keyword">data</span><span> </span><span id="CostModelApplyError"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelApplyError"><span class="hs-identifier hs-var">CostModelApplyError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>      </span><span id="CMUnknownParamError"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMUnknownParamError"><span class="hs-identifier hs-var">CMUnknownParamError</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text.Text</span></a></span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-comment">-- ^ a costmodel parameter with the give name does not exist in the costmodel to be applied upon</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CMInternalReadError"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMInternalReadError"><span class="hs-identifier hs-var">CMInternalReadError</span></a></span></span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-comment">-- ^ internal error when we are transforming the applyParams' input to json (should not happen)</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CMInternalWriteError"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMInternalWriteError"><span class="hs-identifier hs-var">CMInternalWriteError</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-comment">-- ^ internal error when we are transforming the applied params from json with given jsonstring error (should not happen)</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span id="local-6989586621680963960"><span id="local-6989586621680963962"><span id="local-6989586621680963964"><span class="annot"><span class="annottext">Int -&gt; CostModelApplyError -&gt; ShowS
[CostModelApplyError] -&gt; ShowS
CostModelApplyError -&gt; String
(Int -&gt; CostModelApplyError -&gt; ShowS)
-&gt; (CostModelApplyError -&gt; String)
-&gt; ([CostModelApplyError] -&gt; ShowS)
-&gt; Show CostModelApplyError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CostModelApplyError] -&gt; ShowS
$cshowList :: [CostModelApplyError] -&gt; ShowS
show :: CostModelApplyError -&gt; String
$cshow :: CostModelApplyError -&gt; String
showsPrec :: Int -&gt; CostModelApplyError -&gt; ShowS
$cshowsPrec :: Int -&gt; CostModelApplyError -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span id="local-6989586621680963951"><span id="local-6989586621680963953"><span id="local-6989586621680963955"><span class="annot"><span class="annottext">Show CostModelApplyError
Typeable CostModelApplyError
Typeable CostModelApplyError
-&gt; Show CostModelApplyError
-&gt; (CostModelApplyError -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe CostModelApplyError)
-&gt; (CostModelApplyError -&gt; String)
-&gt; Exception CostModelApplyError
SomeException -&gt; Maybe CostModelApplyError
CostModelApplyError -&gt; String
CostModelApplyError -&gt; SomeException
forall e.
Typeable e
-&gt; Show e
-&gt; (e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e)
-&gt; (e -&gt; String)
-&gt; Exception e
displayException :: CostModelApplyError -&gt; String
$cdisplayException :: CostModelApplyError -&gt; String
fromException :: SomeException -&gt; Maybe CostModelApplyError
$cfromException :: SomeException -&gt; Maybe CostModelApplyError
toException :: CostModelApplyError -&gt; SomeException
$ctoException :: CostModelApplyError -&gt; SomeException
$cp2Exception :: Show CostModelApplyError
$cp1Exception :: Typeable CostModelApplyError
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Exception</span></a></span></span></span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680963947"><span class="annot"><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelApplyError"><span class="hs-identifier hs-type">CostModelApplyError</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621680963945"><span class="annot"><span class="annottext">pretty :: CostModelApplyError -&gt; Doc ann
</span><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc ann
</span><a href="#local-6989586621680963943"><span class="hs-identifier hs-var">preamble</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Doc ann -&gt; Doc ann)
-&gt; (CostModelApplyError -&gt; Doc ann)
-&gt; CostModelApplyError
-&gt; Doc ann
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMUnknownParamError"><span class="hs-identifier hs-type">CMUnknownParamError</span></a></span><span> </span><span id="local-6989586621680963940"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963940"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Unknown cost model parameter:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963940"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">CostModelApplyError
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMInternalReadError"><span class="hs-identifier hs-var">CMInternalReadError</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Internal problem occurred upon reading the given cost model parameteres&quot;</span></span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMInternalWriteError"><span class="hs-identifier hs-type">CMInternalWriteError</span></a></span><span> </span><span id="local-6989586621680963939"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680963939"><span class="hs-identifier hs-var">str</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Internal problem occurred upon generating the applied cost model parameters with JSON error:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><a href="../file:///nix/store/sbv9pqjhqdwa0bq7cll6wmzgwjf0al3r-prettyprinter-lib-prettyprinter-1.7.1-haddock-doc/share/doc/prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680963939"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>          </span><span id="local-6989586621680963943"><span class="annot"><span class="annottext">preamble :: Doc ann
</span><a href="#local-6989586621680963943"><span class="hs-identifier hs-var hs-var">preamble</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;applyParams error:&quot;</span></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- See Note [Cost model parameters]</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | Update a model by overwriting the parameters with the given ones.</span><span>
</span><span id="line-116"></span><span id="local-6989586621680963995"><span id="local-6989586621680963996"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applyParams"><span class="hs-identifier hs-type">applyParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963996"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963996"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelApplyError"><span class="hs-identifier hs-type">CostModelApplyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963995"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680963996"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-118"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span><span>
</span><span id="line-119"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680963995"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963996"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-120"></span><span id="applyParams"><span class="annot"><span class="annottext">applyParams :: a -&gt; CostModelParams -&gt; m a
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applyParams"><span class="hs-identifier hs-var hs-var">applyParams</span></a></span></span><span> </span><span id="local-6989586621680963937"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680963937"><span class="hs-identifier hs-var">cm</span></a></span></span><span> </span><span id="local-6989586621680963936"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963936"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680963937"><span class="hs-identifier hs-var">cm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621680963935"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680963935"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-123"></span><span>            </span><span id="local-6989586621680963934"><span class="annot"><span class="annottext">usingScientific :: Map Text Value
</span><a href="#local-6989586621680963934"><span class="hs-identifier hs-var hs-var">usingScientific</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value) -&gt; CostModelParams -&gt; Map Text Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">Number</span></a></span><span> </span><span class="annot"><span class="annottext">(Scientific -&gt; Value)
-&gt; (Integer -&gt; Scientific) -&gt; Integer -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Scientific
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963936"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-124"></span><span>            </span><span id="local-6989586621680963933"><span class="annot"><span class="annottext">flattened :: Map Text Value
</span><a href="#local-6989586621680963933"><span class="hs-identifier hs-var hs-var">flattened</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text Value -&gt; Map Text Value
forall a. HashMap Text a -&gt; Map Text a
</span><a href="#local-6989586621680963932"><span class="hs-identifier hs-var">fromHash</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap Text Value -&gt; Map Text Value)
-&gt; HashMap Text Value -&gt; Map Text Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; HashMap Text Value
</span><a href="Data.Aeson.Flatten.html#objToHm"><span class="hs-identifier hs-var">objToHm</span></a></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; HashMap Text Value) -&gt; Object -&gt; HashMap Text Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Object
</span><a href="Data.Aeson.Flatten.html#flattenObject"><span class="hs-identifier hs-var">flattenObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680963935"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>            </span><span class="hs-comment">-- this is where the overwriting happens</span><span>
</span><span id="line-127"></span><span>            </span><span class="hs-comment">-- fail when key is in params (left) but not in the model (right)</span><span>
</span><span id="line-128"></span><span>            </span><span id="local-6989586621680963931"><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621680963931"><span class="hs-identifier hs-var">merged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WhenMissing m Text Value Value
-&gt; WhenMissing m Text Value Value
-&gt; WhenMatched m Text Value Value Value
-&gt; Map Text Value
-&gt; Map Text Value
-&gt; m (Map Text Value)
forall (f :: * -&gt; *) k a c b.
(Applicative f, Ord k) =&gt;
WhenMissing f k a c
-&gt; WhenMissing f k b c
-&gt; WhenMatched f k a b c
-&gt; Map k a
-&gt; Map k b
-&gt; f (Map k c)
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.mergeA</span></a></span><span> </span><span class="annot"><span class="annottext">WhenMissing m Text Value Value
forall x y. WhenMissing m Text x y
</span><a href="#local-6989586621680963929"><span class="hs-identifier hs-var">failMissing</span></a></span><span> </span><span class="annot"><span class="annottext">WhenMissing m Text Value Value
forall (f :: * -&gt; *) k x. Applicative f =&gt; WhenMissing f k x x
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.preserveMissing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Value -&gt; Value -&gt; Value)
-&gt; WhenMatched m Text Value Value Value
forall (f :: * -&gt; *) k x y z.
Applicative f =&gt;
(k -&gt; x -&gt; y -&gt; z) -&gt; WhenMatched f k x y z
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.zipWithMatched</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Value -&gt; Value
forall p p p. p -&gt; p -&gt; p -&gt; p
</span><a href="#local-6989586621680963926"><span class="hs-identifier hs-var">leftBiased</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621680963934"><span class="hs-identifier hs-var">usingScientific</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621680963933"><span class="hs-identifier hs-var">flattened</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680963925"><span class="annot"><span class="annottext">unflattened :: Object
</span><a href="#local-6989586621680963925"><span class="hs-identifier hs-var hs-var">unflattened</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Object -&gt; Object
</span><a href="Data.Aeson.Flatten.html#unflattenObject"><span class="hs-identifier hs-var">unflattenObject</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Object -&gt; Object) -&gt; Object -&gt; Object
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Value -&gt; Object
</span><a href="Data.Aeson.Flatten.html#hmToObj"><span class="hs-identifier hs-var">hmToObj</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap Text Value -&gt; Object) -&gt; HashMap Text Value -&gt; Object
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Value -&gt; HashMap Text Value
forall v. Map Text v -&gt; HashMap Text v
</span><a href="#local-6989586621680963922"><span class="hs-identifier hs-var">toHash</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Value
</span><a href="#local-6989586621680963931"><span class="hs-identifier hs-var">merged</span></a></span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Result a
forall a. FromJSON a =&gt; Value -&gt; Result a
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">fromJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; Value
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680963925"><span class="hs-identifier hs-var">unflattened</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>                </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621680963919"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680963919"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680963919"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-132"></span><span>                </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621680963917"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680963917"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CostModelApplyError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(CostModelApplyError -&gt; m a) -&gt; CostModelApplyError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; CostModelApplyError
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMInternalWriteError"><span class="hs-identifier hs-var">CMInternalWriteError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680963917"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CostModelApplyError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">CostModelApplyError
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMInternalReadError"><span class="hs-identifier hs-var">CMInternalReadError</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621680963922"><span class="annot"><span class="annottext">toHash :: Map Text v -&gt; HashMap Text v
</span><a href="#local-6989586621680963922"><span class="hs-identifier hs-var hs-var">toHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, v)] -&gt; HashMap Text v
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><a href="../file:///nix/store/1lijxpzbkqglyyn51i9w8fvqinsawjqm-unordered-containers-lib-unordered-containers-0.2.19.1-haddock-doc/share/doc/unordered-containers/html/src"><span class="hs-identifier hs-var">HM.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Text, v)] -&gt; HashMap Text v)
-&gt; (Map Text v -&gt; [(Text, v)]) -&gt; Map Text v -&gt; HashMap Text v
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text v -&gt; [(Text, v)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621680963932"><span class="annot"><span class="annottext">fromHash :: HashMap Text a -&gt; Map Text a
</span><a href="#local-6989586621680963932"><span class="hs-identifier hs-var hs-var">fromHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, a)] -&gt; Map Text a
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Text, a)] -&gt; Map Text a)
-&gt; (HashMap Text a -&gt; [(Text, a)]) -&gt; HashMap Text a -&gt; Map Text a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text a -&gt; [(Text, a)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><a href="../file:///nix/store/1lijxpzbkqglyyn51i9w8fvqinsawjqm-unordered-containers-lib-unordered-containers-0.2.19.1-haddock-doc/share/doc/unordered-containers/html/src"><span class="hs-identifier hs-var">HM.toList</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- fail when field missing</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621680963929"><span class="annot"><span class="annottext">failMissing :: WhenMissing m Text x y
</span><a href="#local-6989586621680963929"><span class="hs-identifier hs-var hs-var">failMissing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; x -&gt; m y) -&gt; WhenMissing m Text x y
forall (f :: * -&gt; *) k x y.
Applicative f =&gt;
(k -&gt; x -&gt; f y) -&gt; WhenMissing f k x y
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.traverseMissing</span></a></span><span> </span><span class="annot"><span class="annottext">((Text -&gt; x -&gt; m y) -&gt; WhenMissing m Text x y)
-&gt; (Text -&gt; x -&gt; m y) -&gt; WhenMissing m Text x y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680963912"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963912"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680963911"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680963911"><span class="hs-identifier hs-var">_v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CostModelApplyError -&gt; m y
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">(CostModelApplyError -&gt; m y) -&gt; CostModelApplyError -&gt; m y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; CostModelApplyError
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CMUnknownParamError"><span class="hs-identifier hs-var">CMUnknownParamError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963912"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">-- left-biased merging when key found in both maps</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621680963926"><span class="annot"><span class="annottext">leftBiased :: p -&gt; p -&gt; p -&gt; p
</span><a href="#local-6989586621680963926"><span class="hs-identifier hs-var hs-var">leftBiased</span></a></span></span><span> </span><span id="local-6989586621680963910"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680963910"><span class="hs-identifier hs-var">_k</span></a></span></span><span> </span><span id="local-6989586621680963909"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680963909"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680963908"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680963908"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680963909"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | Parameters for a machine step model and a builtin evaluation model bundled together.</span><span>
</span><span id="line-144"></span><span class="hs-keyword">data</span><span> </span><span id="SplitCostModelParams"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#SplitCostModelParams"><span class="hs-identifier hs-var">SplitCostModelParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>    </span><span id="SplitCostModelParams"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#SplitCostModelParams"><span class="hs-identifier hs-var">SplitCostModelParams</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-146"></span><span>      </span><span id="_machineParams"><span class="annot"><span class="annottext">SplitCostModelParams -&gt; CostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#_machineParams"><span class="hs-identifier hs-var hs-var">_machineParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_builtinParams"><span class="annot"><span class="annottext">SplitCostModelParams -&gt; CostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#_builtinParams"><span class="hs-identifier hs-var hs-var">_builtinParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | Split a CostModelParams object into two subobjects according to some prefix:</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- see item 5 of Note [Cost model parameters].</span><span>
</span><span id="line-152"></span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#splitParams"><span class="hs-identifier hs-type">splitParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#SplitCostModelParams"><span class="hs-identifier hs-type">SplitCostModelParams</span></a></span><span>
</span><span id="line-153"></span><span id="splitParams"><span class="annot"><span class="annottext">splitParams :: Text -&gt; CostModelParams -&gt; SplitCostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#splitParams"><span class="hs-identifier hs-var hs-var">splitParams</span></a></span></span><span> </span><span id="local-6989586621680963903"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963903"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621680963902"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963902"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680963901"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963901"><span class="hs-identifier hs-var">machineparams</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680963900"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963900"><span class="hs-identifier hs-var">builtinparams</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Integer -&gt; Bool)
-&gt; CostModelParams -&gt; (CostModelParams, CostModelParams)
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; (Map k a, Map k a)
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.partitionWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680963898"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963898"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-var">Text.isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963903"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963898"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963902"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CostModelParams -&gt; CostModelParams -&gt; SplitCostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#SplitCostModelParams"><span class="hs-identifier hs-var">SplitCostModelParams</span></a></span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963901"><span class="hs-identifier hs-var">machineparams</span></a></span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963900"><span class="hs-identifier hs-var">builtinparams</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- | Given a CostModel, produce a single map containing the parameters from both components</span><span>
</span><span id="line-158"></span><span id="local-6989586621680963895"><span id="local-6989586621680963896"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#extractCostModelParams"><span class="hs-identifier hs-type">extractCostModelParams</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963896"><span class="hs-identifier hs-type">machinecosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963895"><span class="hs-identifier hs-type">builtincosts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963896"><span class="hs-identifier hs-type">machinecosts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963895"><span class="hs-identifier hs-type">builtincosts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span></span></span><span>
</span><span id="line-161"></span><span id="extractCostModelParams"><span class="annot"><span class="annottext">extractCostModelParams :: CostModel machinecosts builtincosts -&gt; Maybe CostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#extractCostModelParams"><span class="hs-identifier hs-var hs-var">extractCostModelParams</span></a></span></span><span> </span><span id="local-6989586621680963894"><span class="annot"><span class="annottext">CostModel machinecosts builtincosts
</span><a href="#local-6989586621680963894"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- this is using the applicative instance of Maybe</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">CostModelParams -&gt; CostModelParams -&gt; CostModelParams
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.union</span></a></span><span> </span><span class="annot"><span class="annottext">(CostModelParams -&gt; CostModelParams -&gt; CostModelParams)
-&gt; Maybe CostModelParams
-&gt; Maybe (CostModelParams -&gt; CostModelParams)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">machinecosts -&gt; Maybe CostModelParams
forall a. ToJSON a =&gt; a -&gt; Maybe CostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#extractParams"><span class="hs-identifier hs-var">extractParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostModel machinecosts builtincosts -&gt; machinecosts
forall machinecosts builtincosts.
CostModel machinecosts builtincosts -&gt; machinecosts
</span><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#_machineCostModel"><span class="hs-identifier hs-var hs-var">_machineCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">CostModel machinecosts builtincosts
</span><a href="#local-6989586621680963894"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (CostModelParams -&gt; CostModelParams)
-&gt; Maybe CostModelParams -&gt; Maybe CostModelParams
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">builtincosts -&gt; Maybe CostModelParams
forall a. ToJSON a =&gt; a -&gt; Maybe CostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#extractParams"><span class="hs-identifier hs-var">extractParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostModel machinecosts builtincosts -&gt; builtincosts
forall machinecosts builtincosts.
CostModel machinecosts builtincosts -&gt; builtincosts
</span><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#_builtinCostModel"><span class="hs-identifier hs-var hs-var">_builtinCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">CostModel machinecosts builtincosts
</span><a href="#local-6989586621680963894"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | Given a set of cost model parameters, split it into two parts according to</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- some prefix and use those parts to update the components of a cost model.</span><span>
</span><span id="line-166"></span><span class="hs-comment">{- Strictly we don't need to do the splitting: when we call fromJSON in
   applyParams any superfluous objects in the map being decoded will be
   discarded, so we could update both components of the cost model with the
   entire set of parameters without having to worry about splitting the
   parameters on a prefix of the key.  This relies on what appears to be an
   undocumented implementation choice in Aeson though (other JSON decoders (for
   other languages) seem to vary in how unknown fields are handled), so let's be
   explicit. -}</span><span>
</span><span id="line-174"></span><span id="local-6989586621680963989"><span id="local-6989586621680963990"><span id="local-6989586621680963991"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applySplitCostModelParams"><span class="hs-identifier hs-type">applySplitCostModelParams</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963991"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963990"><span class="hs-identifier hs-type">builtincosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963991"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963990"><span class="hs-identifier hs-type">builtincosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelApplyError"><span class="hs-identifier hs-type">CostModelApplyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963989"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text.Text</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963991"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963990"><span class="hs-identifier hs-type">builtincosts</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680963989"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963991"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963990"><span class="hs-identifier hs-type">builtincosts</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-180"></span><span id="applySplitCostModelParams"><span class="annot"><span class="annottext">applySplitCostModelParams :: Text
-&gt; CostModel evaluatorcosts builtincosts
-&gt; CostModelParams
-&gt; m (CostModel evaluatorcosts builtincosts)
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applySplitCostModelParams"><span class="hs-identifier hs-var hs-var">applySplitCostModelParams</span></a></span></span><span> </span><span id="local-6989586621680963888"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963888"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621680963887"><span class="annot"><span class="annottext">CostModel evaluatorcosts builtincosts
</span><a href="#local-6989586621680963887"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621680963886"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963886"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#SplitCostModelParams"><span class="hs-identifier hs-type">SplitCostModelParams</span></a></span><span> </span><span id="local-6989586621680963885"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963885"><span class="hs-identifier hs-var">machineparams</span></a></span></span><span> </span><span id="local-6989586621680963884"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963884"><span class="hs-identifier hs-var">builtinparams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; CostModelParams -&gt; SplitCostModelParams
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#splitParams"><span class="hs-identifier hs-var">splitParams</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680963888"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963886"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">evaluatorcosts
-&gt; builtincosts -&gt; CostModel evaluatorcosts builtincosts
forall machinecosts builtincosts.
machinecosts -&gt; builtincosts -&gt; CostModel machinecosts builtincosts
</span><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#CostModel"><span class="hs-identifier hs-var">CostModel</span></a></span><span> </span><span class="annot"><span class="annottext">(evaluatorcosts
 -&gt; builtincosts -&gt; CostModel evaluatorcosts builtincosts)
-&gt; m evaluatorcosts
-&gt; m (builtincosts -&gt; CostModel evaluatorcosts builtincosts)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">evaluatorcosts -&gt; CostModelParams -&gt; m evaluatorcosts
forall a (m :: * -&gt; *).
(FromJSON a, ToJSON a, MonadError CostModelApplyError m) =&gt;
a -&gt; CostModelParams -&gt; m a
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applyParams"><span class="hs-identifier hs-var">applyParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostModel evaluatorcosts builtincosts -&gt; evaluatorcosts
forall machinecosts builtincosts.
CostModel machinecosts builtincosts -&gt; machinecosts
</span><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#_machineCostModel"><span class="hs-identifier hs-var hs-var">_machineCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">CostModel evaluatorcosts builtincosts
</span><a href="#local-6989586621680963887"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963885"><span class="hs-identifier hs-var">machineparams</span></a></span><span>
</span><span id="line-183"></span><span>                 </span><span class="annot"><span class="annottext">m (builtincosts -&gt; CostModel evaluatorcosts builtincosts)
-&gt; m builtincosts -&gt; m (CostModel evaluatorcosts builtincosts)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">builtincosts -&gt; CostModelParams -&gt; m builtincosts
forall a (m :: * -&gt; *).
(FromJSON a, ToJSON a, MonadError CostModelApplyError m) =&gt;
a -&gt; CostModelParams -&gt; m a
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applyParams"><span class="hs-identifier hs-var">applyParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostModel evaluatorcosts builtincosts -&gt; builtincosts
forall machinecosts builtincosts.
CostModel machinecosts builtincosts -&gt; builtincosts
</span><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#_builtinCostModel"><span class="hs-identifier hs-var hs-var">_builtinCostModel</span></a></span><span> </span><span class="annot"><span class="annottext">CostModel evaluatorcosts builtincosts
</span><a href="#local-6989586621680963887"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621680963884"><span class="hs-identifier hs-var">builtinparams</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | Update a CostModel for the CEK machine with a given set of parameters,</span><span>
</span><span id="line-186"></span><span id="local-6989586621680963880"><span id="local-6989586621680963881"><span id="local-6989586621680963882"><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applyCostModelParams"><span class="hs-identifier hs-type">applyCostModelParams</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963882"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963881"><span class="hs-identifier hs-type">builtincosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963882"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963881"><span class="hs-identifier hs-type">builtincosts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelApplyError"><span class="hs-identifier hs-type">CostModelApplyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963880"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963882"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963881"><span class="hs-identifier hs-type">builtincosts</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#CostModelParams"><span class="hs-identifier hs-type">CostModelParams</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680963880"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Evaluation.Machine.MachineParameters.html#CostModel"><span class="hs-identifier hs-type">CostModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963882"><span class="hs-identifier hs-type">evaluatorcosts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680963881"><span class="hs-identifier hs-type">builtincosts</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-191"></span><span id="applyCostModelParams"><span class="annot"><span class="annottext">applyCostModelParams :: CostModel evaluatorcosts builtincosts
-&gt; CostModelParams -&gt; m (CostModel evaluatorcosts builtincosts)
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applyCostModelParams"><span class="hs-identifier hs-var hs-var">applyCostModelParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; CostModel evaluatorcosts builtincosts
-&gt; CostModelParams
-&gt; m (CostModel evaluatorcosts builtincosts)
forall evaluatorcosts builtincosts (m :: * -&gt; *).
(FromJSON evaluatorcosts, FromJSON builtincosts,
 ToJSON evaluatorcosts, ToJSON builtincosts,
 MonadError CostModelApplyError m) =&gt;
Text
-&gt; CostModel evaluatorcosts builtincosts
-&gt; CostModelParams
-&gt; m (CostModel evaluatorcosts builtincosts)
</span><a href="PlutusCore.Evaluation.Machine.CostModelInterface.html#applySplitCostModelParams"><span class="hs-identifier hs-var">applySplitCostModelParams</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="UntypedPlutusCore.Evaluation.Machine.Cek.CekMachineCosts.html#cekMachineCostsPrefix"><span class="hs-identifier hs-var">cekMachineCostsPrefix</span></a></span><span>
</span><span id="line-192"></span></pre></body></html>
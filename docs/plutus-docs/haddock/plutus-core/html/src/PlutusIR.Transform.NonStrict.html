<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts  #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | Compile non-strict bindings into strict bindings.</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.Transform.NonStrict</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#compileNonStrictBindings"><span class="hs-identifier">compileNonStrictBindings</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.html"><span class="hs-identifier">PlutusIR</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Transform.Rename.html"><span class="hs-identifier">PlutusIR.Transform.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Transform.Substitute.html"><span class="hs-identifier">PlutusIR.Transform.Substitute</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html"><span class="hs-identifier">PlutusCore.Quote</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.StdLib.Data.ScottUnit.html"><span class="hs-identifier">PlutusCore.StdLib.Data.ScottUnit</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unit</span></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">Strict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier">Control.Monad.State</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-comment">{- Note [Compiling non-strict bindings]
Given `let x : ty = rhs in body`, we
- Replace `let x : ty = rhs in ...` with `let x : () -&gt; ty = \arg : () -&gt; rhs in ...`
- Replace all references to `x` in `body` with `x ()`

To avoid quadratic behaviour, we do the latter substitution in one go, by collecting
all the substitutions to do as we go, and then doing them in one go at the end.

Since we are constructing a global substitution, so we need globally unique
names to avoid clashes.
-}</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">{- Note [Using unit versus force/delay]
We don't have force/delay in PIR, but we can use trivial type-abstractions and instantiations,
which will erase to force and delay in UPLC. Not quite as nice, but it doesn't require an extension
to the language.

However, we retain the *option* to use unit-lambdas instead, since we rely on this pass to
handle recursive, non-function bindings and give them function types. `delayed x` is not a
function type but `() -&gt; x` is!
-}</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">type</span><span> </span><span id="Substs"><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#Substs"><span class="hs-identifier hs-var">Substs</span></a></span></span><span> </span><span id="local-6989586621680974748"><span class="annot"><a href="#local-6989586621680974748"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621680974747"><span class="annot"><a href="#local-6989586621680974747"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621680974746"><span class="annot"><a href="#local-6989586621680974746"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974748"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974747"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974746"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">-- | Compile all the non-strict bindings in a term into strict bindings. Note: requires globally</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- unique names.</span><span>
</span><span id="line-45"></span><span id="local-6989586621680974742"><span id="local-6989586621680974743"><span id="local-6989586621680974744"><span id="local-6989586621680974745"><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#compileNonStrictBindings"><span class="hs-identifier hs-type">compileNonStrictBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974745"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974744"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974743"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974742"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680974745"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974744"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974743"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974742"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-46"></span><span id="compileNonStrictBindings"><span class="annot"><span class="annottext">compileNonStrictBindings :: Bool
-&gt; Term TyName Name uni fun a -&gt; m (Term TyName Name uni fun a)
</span><a href="PlutusIR.Transform.NonStrict.html#compileNonStrictBindings"><span class="hs-identifier hs-var hs-var">compileNonStrictBindings</span></a></span></span><span> </span><span id="local-6989586621680974741"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680974741"><span class="hs-identifier hs-var">useUnit</span></a></span></span><span> </span><span id="local-6989586621680974740"><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974740"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680974739"><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974739"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680974738"><span class="annot"><span class="annottext">Map Name (Term TyName Name uni fun a)
</span><a href="#local-6989586621680974738"><span class="hs-identifier hs-var">substs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Quote
  (Term TyName Name uni fun a, Map Name (Term TyName Name uni fun a))
-&gt; m (Term TyName Name uni fun a,
      Map Name (Term TyName Name uni fun a))
forall (m :: * -&gt; *) a. MonadQuote m =&gt; Quote a -&gt; m a
</span><a href="PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a></span><span> </span><span class="annot"><span class="annottext">(Quote
   (Term TyName Name uni fun a, Map Name (Term TyName Name uni fun a))
 -&gt; m (Term TyName Name uni fun a,
       Map Name (Term TyName Name uni fun a)))
-&gt; Quote
     (Term TyName Name uni fun a, Map Name (Term TyName Name uni fun a))
-&gt; m (Term TyName Name uni fun a,
      Map Name (Term TyName Name uni fun a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT
   (Map Name (Term TyName Name uni fun a))
   (QuoteT Identity)
   (Term TyName Name uni fun a)
 -&gt; Map Name (Term TyName Name uni fun a)
 -&gt; Quote
      (Term TyName Name uni fun a,
       Map Name (Term TyName Name uni fun a)))
-&gt; Map Name (Term TyName Name uni fun a)
-&gt; StateT
     (Map Name (Term TyName Name uni fun a))
     (QuoteT Identity)
     (Term TyName Name uni fun a)
-&gt; Quote
     (Term TyName Name uni fun a, Map Name (Term TyName Name uni fun a))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">StateT
  (Map Name (Term TyName Name uni fun a))
  (QuoteT Identity)
  (Term TyName Name uni fun a)
-&gt; Map Name (Term TyName Name uni fun a)
-&gt; Quote
     (Term TyName Name uni fun a, Map Name (Term TyName Name uni fun a))
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><a href="../file:///nix/store/8r01jj9dl6h1x2byph07y6wxfb3ysd8c-transformers-lib-transformers-0.5.6.2-haddock-doc/share/doc/transformers/html/src"><span class="hs-identifier hs-var hs-var">runStateT</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (Term TyName Name uni fun a)
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT
   (Map Name (Term TyName Name uni fun a))
   (QuoteT Identity)
   (Term TyName Name uni fun a)
 -&gt; Quote
      (Term TyName Name uni fun a,
       Map Name (Term TyName Name uni fun a)))
-&gt; StateT
     (Map Name (Term TyName Name uni fun a))
     (QuoteT Identity)
     (Term TyName Name uni fun a)
-&gt; Quote
     (Term TyName Name uni fun a, Map Name (Term TyName Name uni fun a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Term TyName Name uni fun a
-&gt; StateT
     (Map Name (Term TyName Name uni fun a))
     (QuoteT Identity)
     (Term TyName Name uni fun a)
forall (uni :: * -&gt; *) fun a (m :: * -&gt; *).
(MonadState (Substs uni fun a) m, MonadQuote m) =&gt;
Bool
-&gt; Term TyName Name uni fun a -&gt; m (Term TyName Name uni fun a)
</span><a href="PlutusIR.Transform.NonStrict.html#strictifyTerm"><span class="hs-identifier hs-var">strictifyTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680974741"><span class="hs-identifier hs-var">useUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974740"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-comment">-- See Note [Compiling non-strict bindings]</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">Term TyName Name uni fun a -&gt; m (Term TyName Name uni fun a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Term TyName Name uni fun a -&gt; m (Term TyName Name uni fun a))
-&gt; Term TyName Name uni fun a -&gt; m (Term TyName Name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe (Term TyName Name uni fun a))
-&gt; Term TyName Name uni fun a -&gt; Term TyName Name uni fun a
forall name tyname (uni :: * -&gt; *) fun a.
(name -&gt; Maybe (Term tyname name uni fun a))
-&gt; Term tyname name uni fun a -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Transform.Substitute.html#termSubstNames"><span class="hs-identifier hs-var">termSubstNames</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680974732"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974732"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Map Name (Term TyName Name uni fun a)
-&gt; Maybe (Term TyName Name uni fun a)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974732"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name (Term TyName Name uni fun a)
</span><a href="#local-6989586621680974738"><span class="hs-identifier hs-var">substs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974739"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span id="local-6989586621680974840"><span id="local-6989586621680974842"><span id="local-6989586621680974843"><span id="local-6989586621680974844"><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#strictifyTerm"><span class="hs-identifier hs-type">strictifyTerm</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#Substs"><span class="hs-identifier hs-type">Substs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974844"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974843"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974842"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680974840"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974840"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974844"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974843"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974842"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680974840"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974844"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974843"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974842"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-54"></span><span id="strictifyTerm"><span class="annot"><span class="annottext">strictifyTerm :: Bool
-&gt; Term TyName Name uni fun a -&gt; m (Term TyName Name uni fun a)
</span><a href="PlutusIR.Transform.NonStrict.html#strictifyTerm"><span class="hs-identifier hs-var hs-var">strictifyTerm</span></a></span></span><span> </span><span id="local-6989586621680974730"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680974730"><span class="hs-identifier hs-var">useUnit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">-- See Note [Using unit versus force/delay]</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680974729"><span class="annot"><span class="annottext">transformation :: Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
</span><a href="#local-6989586621680974729"><span class="hs-identifier hs-var hs-var">transformation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680974730"><span class="hs-identifier hs-var">useUnit</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
forall (uni :: * -&gt; *) fun a (m :: * -&gt; *).
(MonadState (Substs uni fun a) m, MonadQuote m) =&gt;
Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
</span><a href="PlutusIR.Transform.NonStrict.html#strictifyBindingWithUnit"><span class="hs-identifier hs-var">strictifyBindingWithUnit</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
forall (uni :: * -&gt; *) fun a (m :: * -&gt; *).
(MonadState (Substs uni fun a) m, MonadQuote m) =&gt;
Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
</span><a href="PlutusIR.Transform.NonStrict.html#strictifyBinding"><span class="hs-identifier hs-var">strictifyBinding</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LensLike
  (WrappedMonad m)
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
-&gt; (Term TyName Name uni fun a -&gt; m (Term TyName Name uni fun a))
-&gt; Term TyName Name uni fun a
-&gt; m (Term TyName Name uni fun a)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
LensLike (WrappedMonad m) a b a b -&gt; (b -&gt; m b) -&gt; a -&gt; m b
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">transformMOf</span></a></span><span> </span><span class="annot"><span class="annottext">LensLike
  (WrappedMonad m)
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
forall tyname name (uni :: * -&gt; *) fun a.
Traversal'
  (Term tyname name uni fun a) (Term tyname name uni fun a)
</span><a href="PlutusIR.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LensLike
  m
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
  (Binding TyName Name uni fun a)
  (Binding TyName Name uni fun a)
-&gt; LensLike
     m
     (Term TyName Name uni fun a)
     (Term TyName Name uni fun a)
     (Binding TyName Name uni fun a)
     (Binding TyName Name uni fun a)
forall (f :: * -&gt; *) s t a b.
LensLike f s t a b -&gt; LensLike f s t a b
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">traverseOf</span></a></span><span> </span><span class="annot"><span class="annottext">LensLike
  m
  (Term TyName Name uni fun a)
  (Term TyName Name uni fun a)
  (Binding TyName Name uni fun a)
  (Binding TyName Name uni fun a)
forall tyname name (uni :: * -&gt; *) fun a.
Traversal'
  (Term tyname name uni fun a) (Binding tyname name uni fun a)
</span><a href="PlutusIR.Core.Plated.html#termBindings"><span class="hs-identifier hs-var">termBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
</span><a href="#local-6989586621680974729"><span class="hs-identifier hs-var">transformation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span id="local-6989586621680974719"><span id="local-6989586621680974720"><span id="local-6989586621680974721"><span id="local-6989586621680974722"><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#strictifyBinding"><span class="hs-identifier hs-type">strictifyBinding</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#Substs"><span class="hs-identifier hs-type">Substs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974722"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974721"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974720"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680974719"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974719"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974722"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974721"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974720"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680974719"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974722"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974721"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974720"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-62"></span><span id="strictifyBinding"><span class="annot"><span class="annottext">strictifyBinding :: Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
</span><a href="PlutusIR.Transform.NonStrict.html#strictifyBinding"><span class="hs-identifier hs-var hs-var">strictifyBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span id="local-6989586621680974717"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974717"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#NonStrict"><span class="hs-identifier hs-var">NonStrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621680974714"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974714"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span id="local-6989586621680974713"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974713"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680974712"><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680974712"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680974711"><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974711"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>        </span><span class="hs-comment">-- The annotation to use for new synthetic nodes</span><span>
</span><span id="line-65"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680974710"><span class="annot"><span class="annottext">ann :: a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var hs-var">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974714"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>        </span><span id="local-6989586621680974709"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680974709"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m TyName
forall (m :: * -&gt; *). MonadQuote m =&gt; Text -&gt; m TyName
</span><a href="PlutusCore.Quote.html#freshTyName"><span class="hs-identifier hs-var">freshTyName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;dead&quot;</span></span><span>
</span><span id="line-68"></span><span>        </span><span class="hs-comment">-- See Note [Compiling non-strict bindings]</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><span class="annottext">(Map Name (Term TyName Name uni fun a)
 -&gt; Map Name (Term TyName Name uni fun a))
-&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((Map Name (Term TyName Name uni fun a)
  -&gt; Map Name (Term TyName Name uni fun a))
 -&gt; m ())
-&gt; (Map Name (Term TyName Name uni fun a)
    -&gt; Map Name (Term TyName Name uni fun a))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Term TyName Name uni fun a
-&gt; Map Name (Term TyName Name uni fun a)
-&gt; Map Name (Term TyName Name uni fun a)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974713"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(Term TyName Name uni fun a
 -&gt; Map Name (Term TyName Name uni fun a)
 -&gt; Map Name (Term TyName Name uni fun a))
-&gt; Term TyName Name uni fun a
-&gt; Map Name (Term TyName Name uni fun a)
-&gt; Map Name (Term TyName Name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a
-&gt; Term TyName Name uni fun a
-&gt; Type TyName uni a
-&gt; Term TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Name -&gt; Term TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; name -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974713"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TyName -&gt; Kind a -&gt; Type TyName uni a -&gt; Type TyName uni a
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680974709"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Kind a
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TyName -&gt; Type TyName uni a
forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680974709"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Binding TyName Name uni fun a
 -&gt; m (Binding TyName Name uni fun a))
-&gt; Binding TyName Name uni fun a
-&gt; m (Binding TyName Name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a
-&gt; Strictness
-&gt; VarDecl TyName Name uni fun a
-&gt; Term TyName Name uni fun a
-&gt; Binding TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Strictness
-&gt; VarDecl tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974717"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#Strict"><span class="hs-identifier hs-var">Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Name -&gt; Type TyName uni a -&gt; VarDecl TyName Name uni fun a
forall k tyname name (uni :: * -&gt; *) (fun :: k) ann.
ann
-&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni fun ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974714"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974713"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TyName -&gt; Kind a -&gt; Type TyName uni a -&gt; Type TyName uni a
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680974709"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Kind a
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680974712"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
-&gt; TyName
-&gt; Kind a
-&gt; Term TyName Name uni fun a
-&gt; Term TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; tyname
-&gt; Kind a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-var">TyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680974709"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Kind a
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974710"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974711"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621680974698"><span class="annot"><span class="annottext">Binding TyName Name uni fun a
</span><a href="#local-6989586621680974698"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a
</span><a href="#local-6989586621680974698"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span id="local-6989586621680974821"><span id="local-6989586621680974822"><span id="local-6989586621680974823"><span id="local-6989586621680974824"><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#strictifyBindingWithUnit"><span class="hs-identifier hs-type">strictifyBindingWithUnit</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Transform.NonStrict.html#Substs"><span class="hs-identifier hs-type">Substs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974824"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974823"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974822"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680974821"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974821"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974824"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974823"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974822"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680974821"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974824"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974823"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680974822"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-77"></span><span id="strictifyBindingWithUnit"><span class="annot"><span class="annottext">strictifyBindingWithUnit :: Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
</span><a href="PlutusIR.Transform.NonStrict.html#strictifyBindingWithUnit"><span class="hs-identifier hs-var hs-var">strictifyBindingWithUnit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span id="local-6989586621680974697"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974697"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#NonStrict"><span class="hs-identifier hs-var">NonStrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621680974696"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974696"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span id="local-6989586621680974695"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974695"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680974694"><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680974694"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680974693"><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974693"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-comment">-- The annotation to use for new synthetic nodes</span><span>
</span><span id="line-80"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680974692"><span class="annot"><span class="annottext">ann :: a
</span><a href="#local-6989586621680974692"><span class="hs-identifier hs-var hs-var">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974696"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>        </span><span id="local-6989586621680974691"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974691"><span class="hs-identifier hs-var">argName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Quote Name -&gt; m Name
forall (m :: * -&gt; *) a. MonadQuote m =&gt; Quote a -&gt; m a
</span><a href="PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a></span><span> </span><span class="annot"><span class="annottext">(Quote Name -&gt; m Name) -&gt; Quote Name -&gt; m Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Quote Name
forall (m :: * -&gt; *). MonadQuote m =&gt; Text -&gt; m Name
</span><a href="PlutusCore.Quote.html#freshName"><span class="hs-identifier hs-var">freshName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;arg&quot;</span></span><span>
</span><span id="line-83"></span><span>        </span><span class="hs-comment">-- TODO: These are created at every use site, we should bind them globally</span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680974689"><span class="annot"><span class="annottext">unit :: Type TyName uni a
</span><a href="#local-6989586621680974689"><span class="hs-keyword hs-var hs-var">unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974692"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Type TyName uni () -&gt; Type TyName uni a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.StdLib.Data.ScottUnit.html#unit"><span class="hs-identifier hs-var">Unit.unit</span></a></span><span>
</span><span id="line-85"></span><span>            </span><span id="local-6989586621680974686"><span class="annot"><span class="annottext">unitval :: Term TyName Name uni fun a
</span><a href="#local-6989586621680974686"><span class="hs-identifier hs-var hs-var">unitval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974692"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Term TyName Name uni fun () -&gt; Term TyName Name uni fun a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ()
forall (term :: * -&gt; *) (uni :: * -&gt; *) fun.
TermLike term TyName Name uni fun =&gt;
term ()
</span><a href="PlutusCore.StdLib.Data.ScottUnit.html#unitval"><span class="hs-identifier hs-var">Unit.unitval</span></a></span><span>
</span><span id="line-86"></span><span>            </span><span id="local-6989586621680974684"><span class="annot"><span class="annottext">forced :: Term TyName Name uni fun a
</span><a href="#local-6989586621680974684"><span class="hs-identifier hs-var hs-var">forced</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
-&gt; Term TyName Name uni fun a
-&gt; Term TyName Name uni fun a
-&gt; Term TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974692"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Name -&gt; Term TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; name -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974692"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974695"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974686"><span class="hs-identifier hs-var">unitval</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-comment">-- See Note [Compiling non-strict bindings]</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">(Map Name (Term TyName Name uni fun a)
 -&gt; Map Name (Term TyName Name uni fun a))
-&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((Map Name (Term TyName Name uni fun a)
  -&gt; Map Name (Term TyName Name uni fun a))
 -&gt; m ())
-&gt; (Map Name (Term TyName Name uni fun a)
    -&gt; Map Name (Term TyName Name uni fun a))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Term TyName Name uni fun a
-&gt; Map Name (Term TyName Name uni fun a)
-&gt; Map Name (Term TyName Name uni fun a)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974695"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974684"><span class="hs-identifier hs-var">forced</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Binding TyName Name uni fun a
 -&gt; m (Binding TyName Name uni fun a))
-&gt; Binding TyName Name uni fun a
-&gt; m (Binding TyName Name uni fun a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a
-&gt; Strictness
-&gt; VarDecl TyName Name uni fun a
-&gt; Term TyName Name uni fun a
-&gt; Binding TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Strictness
-&gt; VarDecl tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974697"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#Strict"><span class="hs-identifier hs-var">Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Name -&gt; Type TyName uni a -&gt; VarDecl TyName Name uni fun a
forall k tyname name (uni :: * -&gt; *) (fun :: k) ann.
ann
-&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni fun ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974696"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974695"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Type TyName uni a -&gt; Type TyName uni a -&gt; Type TyName uni a
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974692"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
forall (uni :: * -&gt; *). Type TyName uni a
</span><a href="#local-6989586621680974689"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680974694"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
-&gt; Name
-&gt; Type TyName uni a
-&gt; Term TyName Name uni fun a
-&gt; Term TyName Name uni fun a
forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; name
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680974692"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680974691"><span class="hs-identifier hs-var">argName</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
forall (uni :: * -&gt; *). Type TyName uni a
</span><a href="#local-6989586621680974689"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680974693"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621680974680"><span class="annot"><span class="annottext">Binding TyName Name uni fun a
</span><a href="#local-6989586621680974680"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a -&gt; m (Binding TyName Name uni fun a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun a
</span><a href="#local-6989586621680974680"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-93"></span></pre></body></html>
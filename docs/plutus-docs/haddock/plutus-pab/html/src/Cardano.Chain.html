<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell     #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators       #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Chain</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier">Cardano.Node.Emulator.Chain</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EC</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier">Cardano.Node.Emulator.Params</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier">Params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Concurrent</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">index</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Control.Monad.Freer</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">Control.Monad.Freer.Extras.Log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">LogMsg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">logDebug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">logInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier">logWarn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Control.Monad.Freer.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">gets</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">modify</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">traverse_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">listToMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">CardanoTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Index</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Index</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">type</span><span> </span><span id="TxPool"><span class="annot"><a href="Cardano.Chain.html#TxPool"><span class="hs-identifier hs-var">TxPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">CardanoTx</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span id="local-6989586621680381756"><span id="local-6989586621680381757"></span></span><span class="hs-keyword">data</span><span> </span><span id="MockNodeServerChainState"><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-var">MockNodeServerChainState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MockNodeServerChainState"><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-var">MockNodeServerChainState</span></a></span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_txPool"><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; TxPool
</span><a href="Cardano.Chain.html#_txPool"><span class="hs-identifier hs-var hs-var">_txPool</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Chain.html#TxPool"><span class="hs-identifier hs-type">TxPool</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_index"><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; UtxoIndex
</span><a href="Cardano.Chain.html#_index"><span class="hs-identifier hs-var hs-var">_index</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Index.UtxoIndex</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_currentSlot"><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; Slot
</span><a href="Cardano.Chain.html#_currentSlot"><span class="hs-identifier hs-var hs-var">_currentSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Slot</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_channel"><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; TChan Block
</span><a href="Cardano.Chain.html#_channel"><span class="hs-identifier hs-var hs-var">_channel</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-type">TChan</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_tip"><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; Maybe Block
</span><a href="Cardano.Chain.html#_tip"><span class="hs-identifier hs-var hs-var">_tip</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 MockNodeServerChainState -&gt; Rep MockNodeServerChainState x)
-&gt; (forall x.
    Rep MockNodeServerChainState x -&gt; MockNodeServerChainState)
-&gt; Generic MockNodeServerChainState
forall x.
Rep MockNodeServerChainState x -&gt; MockNodeServerChainState
forall x.
MockNodeServerChainState -&gt; Rep MockNodeServerChainState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x.
Rep MockNodeServerChainState x -&gt; MockNodeServerChainState
$cfrom :: forall x.
MockNodeServerChainState -&gt; Rep MockNodeServerChainState x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span id="txPool"><span id="tip"><span id="index"><span id="currentSlot"><span id="channel"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">MockNodeServerChainState</span></span></span></span></span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680381737"><span id="local-6989586621680381740"><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-comment">-- Skip showing the full chain</span><span>
</span><span id="line-45"></span><span>    </span><span id="local-6989586621680381735"><span class="annot"><span class="annottext">show :: MockNodeServerChainState -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680381733"><span class="annot"><span class="annottext">TxPool
_txPool :: TxPool
_txPool :: MockNodeServerChainState -&gt; TxPool
</span><a href="#local-6989586621680381733"><span class="hs-identifier hs-var hs-var">_txPool</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680381732"><span class="annot"><span class="annottext">UtxoIndex
_index :: UtxoIndex
_index :: MockNodeServerChainState -&gt; UtxoIndex
</span><a href="#local-6989586621680381732"><span class="hs-identifier hs-var hs-var">_index</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680381731"><span class="annot"><span class="annottext">Slot
_currentSlot :: Slot
_currentSlot :: MockNodeServerChainState -&gt; Slot
</span><a href="#local-6989586621680381731"><span class="hs-identifier hs-var hs-var">_currentSlot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680381730"><span class="annot"><span class="annottext">Maybe Block
_tip :: Maybe Block
_tip :: MockNodeServerChainState -&gt; Maybe Block
</span><a href="#local-6989586621680381730"><span class="hs-identifier hs-var hs-var">_tip</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MockNodeServerChainState { &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxPool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TxPool
</span><a href="#local-6989586621680381733"><span class="hs-identifier hs-var">_txPool</span></a></span><span>
</span><span id="line-47"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoIndex -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621680381732"><span class="hs-identifier hs-var">_index</span></a></span><span>
</span><span id="line-48"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621680381731"><span class="hs-identifier hs-var">_currentSlot</span></a></span><span>
</span><span id="line-49"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Block -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Block
</span><a href="#local-6989586621680381730"><span class="hs-identifier hs-var">_tip</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; }&quot;</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span id="local-6989586621680381729"><span class="annot"><a href="Cardano.Chain.html#emptyChainState"><span class="hs-identifier hs-type">emptyChainState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381729"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680381729"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span></span><span>
</span><span id="line-52"></span><span id="emptyChainState"><span class="annot"><span class="annottext">emptyChainState :: m MockNodeServerChainState
</span><a href="Cardano.Chain.html#emptyChainState"><span class="hs-identifier hs-var hs-var">emptyChainState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>    </span><span id="local-6989586621680381727"><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381727"><span class="hs-identifier hs-var">chan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TChan Block) -&gt; m (TChan Block)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (TChan Block) -&gt; m (TChan Block))
-&gt; (STM (TChan Block) -&gt; IO (TChan Block))
-&gt; STM (TChan Block)
-&gt; m (TChan Block)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">STM (TChan Block) -&gt; IO (TChan Block)
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (TChan Block) -&gt; m (TChan Block))
-&gt; STM (TChan Block) -&gt; m (TChan Block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM (TChan Block)
forall a. STM (TChan a)
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">newTChan</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; m MockNodeServerChainState
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; m MockNodeServerChainState)
-&gt; MockNodeServerChainState -&gt; m MockNodeServerChainState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxPool
-&gt; UtxoIndex
-&gt; Slot
-&gt; TChan Block
-&gt; Maybe Block
-&gt; MockNodeServerChainState
</span><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-var">MockNodeServerChainState</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">UtxoIndex
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381727"><span class="hs-identifier hs-var">chan</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Block
forall a. Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span id="local-6989586621680381723"><span class="annot"><a href="Cardano.Chain.html#getChannel"><span class="hs-identifier hs-type">getChannel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381723"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680381723"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-type">TChan</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-57"></span><span id="getChannel"><span class="annot"><span class="annottext">getChannel :: MVar MockNodeServerChainState -&gt; m (TChan Block)
</span><a href="Cardano.Chain.html#getChannel"><span class="hs-identifier hs-var hs-var">getChannel</span></a></span></span><span> </span><span id="local-6989586621680381721"><span class="annot"><span class="annottext">MVar MockNodeServerChainState
</span><a href="#local-6989586621680381721"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO MockNodeServerChainState -&gt; m MockNodeServerChainState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar MockNodeServerChainState -&gt; IO MockNodeServerChainState
forall a. MVar a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar MockNodeServerChainState
</span><a href="#local-6989586621680381721"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m MockNodeServerChainState
-&gt; (MockNodeServerChainState -&gt; TChan Block) -&gt; m (TChan Block)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TChan Block) MockNodeServerChainState (TChan Block)
-&gt; MockNodeServerChainState -&gt; TChan Block
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TChan Block) MockNodeServerChainState (TChan Block)
Lens' MockNodeServerChainState (TChan Block)
</span><a href="Cardano.Chain.html#channel"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | Build a PAB ChainState from a emulator ChainState</span><span>
</span><span id="line-60"></span><span id="local-6989586621680381717"><span class="annot"><a href="Cardano.Chain.html#fromEmulatorChainState"><span class="hs-identifier hs-type">fromEmulatorChainState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381717"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ChainState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680381717"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span></span><span>
</span><span id="line-61"></span><span id="fromEmulatorChainState"><span class="annot"><span class="annottext">fromEmulatorChainState :: ChainState -&gt; m MockNodeServerChainState
</span><a href="Cardano.Chain.html#fromEmulatorChainState"><span class="hs-identifier hs-var hs-var">fromEmulatorChainState</span></a></span></span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ChainState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680381714"><span class="annot"><span class="annottext">TxPool
_txPool :: ChainState -&gt; TxPool
_txPool :: TxPool
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var hs-var">EC._txPool</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680381712"><span class="annot"><span class="annottext">UtxoIndex
_index :: ChainState -&gt; UtxoIndex
_index :: UtxoIndex
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var hs-var">EC._index</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680381710"><span class="annot"><span class="annottext">Slot
_chainCurrentSlot :: ChainState -&gt; Slot
_chainCurrentSlot :: Slot
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var hs-var">EC._chainCurrentSlot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680381708"><span class="annot"><span class="annottext">Blockchain
_chainNewestFirst :: ChainState -&gt; Blockchain
_chainNewestFirst :: Blockchain
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var hs-var">EC._chainNewestFirst</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621680381706"><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381706"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TChan Block) -&gt; m (TChan Block)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (TChan Block) -&gt; m (TChan Block))
-&gt; IO (TChan Block) -&gt; m (TChan Block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM (TChan Block) -&gt; IO (TChan Block)
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">STM (TChan Block)
forall a. STM (TChan a)
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">newTChan</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><span class="annottext">(Block -&gt; IO ()) -&gt; Blockchain -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; (Block -&gt; STM ()) -&gt; Block -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block -&gt; Block -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">writeTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381706"><span class="hs-identifier hs-var">ch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blockchain
</span><a href="#local-6989586621680381708"><span class="hs-identifier hs-var">_chainNewestFirst</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; m MockNodeServerChainState
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; m MockNodeServerChainState)
-&gt; MockNodeServerChainState -&gt; m MockNodeServerChainState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MockNodeServerChainState :: TxPool
-&gt; UtxoIndex
-&gt; Slot
-&gt; TChan Block
-&gt; Maybe Block
-&gt; MockNodeServerChainState
</span><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_channel :: TChan Block
</span><a href="Cardano.Chain.html#_channel"><span class="hs-identifier hs-var">_channel</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381706"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-66"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_txPool :: TxPool
</span><a href="Cardano.Chain.html#_txPool"><span class="hs-identifier hs-var">_txPool</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxPool
</span><a href="#local-6989586621680381714"><span class="hs-identifier hs-var">_txPool</span></a></span><span>
</span><span id="line-67"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_index :: UtxoIndex
</span><a href="Cardano.Chain.html#_index"><span class="hs-identifier hs-var">_index</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621680381712"><span class="hs-identifier hs-var">_index</span></a></span><span>
</span><span id="line-68"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_currentSlot :: Slot
</span><a href="Cardano.Chain.html#_currentSlot"><span class="hs-identifier hs-var">_currentSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621680381710"><span class="hs-identifier hs-var">_chainCurrentSlot</span></a></span><span>
</span><span id="line-69"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_tip :: Maybe Block
</span><a href="Cardano.Chain.html#_tip"><span class="hs-identifier hs-var">_tip</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blockchain -&gt; Maybe Block
forall a. [a] -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Blockchain
</span><a href="#local-6989586621680381708"><span class="hs-identifier hs-var">_chainNewestFirst</span></a></span><span>
</span><span id="line-70"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- Get the current tip or wait for one if there are no blocks.</span><span>
</span><span id="line-73"></span><span class="annot"><a href="Cardano.Chain.html#getTip"><span class="hs-identifier hs-type">getTip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680381815"><span class="annot"><a href="#local-6989586621680381815"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381815"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680381815"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span>
</span><span id="line-74"></span><span id="getTip"><span class="annot"><span class="annottext">getTip :: MVar MockNodeServerChainState -&gt; m Block
</span><a href="Cardano.Chain.html#getTip"><span class="hs-identifier hs-var hs-var">getTip</span></a></span></span><span> </span><span id="local-6989586621680381702"><span class="annot"><span class="annottext">MVar MockNodeServerChainState
</span><a href="#local-6989586621680381702"><span class="hs-identifier hs-var">mvChainState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Block -&gt; m Block
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Block -&gt; m Block) -&gt; IO Block -&gt; m Block
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar MockNodeServerChainState -&gt; IO MockNodeServerChainState
forall a. MVar a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar MockNodeServerChainState
</span><a href="#local-6989586621680381702"><span class="hs-identifier hs-var">mvChainState</span></a></span><span> </span><span class="annot"><span class="annottext">IO MockNodeServerChainState
-&gt; (MockNodeServerChainState -&gt; IO Block) -&gt; IO Block
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_tip :: MockNodeServerChainState -&gt; Maybe Block
</span><a href="Cardano.Chain.html#_tip"><span class="hs-identifier hs-var">_tip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680381701"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381701"><span class="hs-identifier hs-var">tip'</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Block -&gt; IO Block
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381701"><span class="hs-identifier hs-var">tip'</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680381700"><span class="annot"><span class="annottext">TChan Block
_channel :: TChan Block
_channel :: MockNodeServerChainState -&gt; TChan Block
</span><a href="#local-6989586621680381700"><span class="hs-identifier hs-var hs-var">_channel</span></a></span></span><span> </span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-comment">-- Wait for the initial block.</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="annottext">IO Block -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Block -&gt; IO ()) -&gt; IO Block -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO Block -&gt; IO Block
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Block -&gt; IO Block) -&gt; IO Block -&gt; IO Block
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM Block -&gt; IO Block
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM Block -&gt; IO Block) -&gt; STM Block -&gt; IO Block
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block -&gt; STM Block
forall a. TChan a -&gt; STM a
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">peekTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381700"><span class="hs-identifier hs-var">_channel</span></a></span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><span class="annottext">MVar MockNodeServerChainState -&gt; IO Block
forall (m :: * -&gt; *).
MonadIO m =&gt;
MVar MockNodeServerChainState -&gt; m Block
</span><a href="Cardano.Chain.html#getTip"><span class="hs-identifier hs-var">getTip</span></a></span><span> </span><span class="annot"><span class="annottext">MVar MockNodeServerChainState
</span><a href="#local-6989586621680381702"><span class="hs-identifier hs-var">mvChainState</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span id="local-6989586621680381697"><span id="local-6989586621680381698"><span class="annot"><a href="Cardano.Chain.html#handleControlChain"><span class="hs-identifier hs-type">handleControlChain</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-82"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680381698"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-83"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-type">LogMsg</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ChainEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680381698"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-84"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">LastMember</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381697"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381698"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-85"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381697"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ChainControlEffect</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/nkim7nifcqpdb4r433zhbv94ima3fwqb-natural-transformation-lib-natural-transformation-0.4-haddock-doc/share/doc/natural-transformation/html/src"><span class="hs-operator hs-type">~&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Eff</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381698"><span class="hs-identifier hs-type">effs</span></a></span></span></span><span>
</span><span id="line-87"></span><span id="handleControlChain"><span class="annot"><span class="annottext">handleControlChain :: Params -&gt; ChainControlEffect ~&gt; Eff effs
</span><a href="Cardano.Chain.html#handleControlChain"><span class="hs-identifier hs-var hs-var">handleControlChain</span></a></span></span><span> </span><span id="local-6989586621680381694"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621680381694"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">ChainControlEffect x
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var">EC.ProcessBlock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-89"></span><span>        </span><span id="local-6989586621680381692"><span class="annot"><span class="annottext">TxPool
</span><a href="#local-6989586621680381692"><span class="hs-identifier hs-var">pool</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; TxPool) -&gt; Eff effs TxPool
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; TxPool) -&gt; Eff effs TxPool)
-&gt; (MockNodeServerChainState -&gt; TxPool) -&gt; Eff effs TxPool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxPool MockNodeServerChainState TxPool
-&gt; MockNodeServerChainState -&gt; TxPool
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TxPool MockNodeServerChainState TxPool
Lens' MockNodeServerChainState TxPool
</span><a href="Cardano.Chain.html#txPool"><span class="hs-identifier hs-var">txPool</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span id="local-6989586621680381691"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621680381691"><span class="hs-identifier hs-var">slot</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; Slot) -&gt; Eff effs Slot
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; Slot) -&gt; Eff effs Slot)
-&gt; (MockNodeServerChainState -&gt; Slot) -&gt; Eff effs Slot
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Slot MockNodeServerChainState Slot
-&gt; MockNodeServerChainState -&gt; Slot
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Slot MockNodeServerChainState Slot
Lens' MockNodeServerChainState Slot
</span><a href="Cardano.Chain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span id="local-6989586621680381690"><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621680381690"><span class="hs-identifier hs-var">idx</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; UtxoIndex) -&gt; Eff effs UtxoIndex
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; UtxoIndex) -&gt; Eff effs UtxoIndex)
-&gt; (MockNodeServerChainState -&gt; UtxoIndex) -&gt; Eff effs UtxoIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Getting UtxoIndex MockNodeServerChainState UtxoIndex
-&gt; MockNodeServerChainState -&gt; UtxoIndex
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting UtxoIndex MockNodeServerChainState UtxoIndex
Lens' MockNodeServerChainState UtxoIndex
</span><a href="Cardano.Chain.html#index"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span id="local-6989586621680381689"><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381689"><span class="hs-identifier hs-var">chan</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; TChan Block) -&gt; Eff effs (TChan Block)
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; TChan Block)
 -&gt; Eff effs (TChan Block))
-&gt; (MockNodeServerChainState -&gt; TChan Block)
-&gt; Eff effs (TChan Block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TChan Block) MockNodeServerChainState (TChan Block)
-&gt; MockNodeServerChainState -&gt; TChan Block
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TChan Block) MockNodeServerChainState (TChan Block)
Lens' MockNodeServerChainState (TChan Block)
</span><a href="Cardano.Chain.html#channel"><span class="hs-identifier hs-var">channel</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ValidatedBlock</span></a></span><span> </span><span id="local-6989586621680381687"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381687"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621680381686"><span class="annot"><span class="annottext">[ChainEvent]
</span><a href="#local-6989586621680381686"><span class="hs-identifier hs-var">events</span></a></span></span><span> </span><span id="local-6989586621680381685"><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621680381685"><span class="hs-identifier hs-var">idx'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params -&gt; Slot -&gt; UtxoIndex -&gt; TxPool -&gt; ValidatedBlock
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var">EC.validateBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621680381694"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621680381691"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621680381690"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">TxPool
</span><a href="#local-6989586621680381692"><span class="hs-identifier hs-var">pool</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall s (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; s) -&gt; Eff effs ()
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; MockNodeServerChainState)
 -&gt; Eff effs ())
-&gt; (MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxPool -&gt; Identity TxPool)
-&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState
Lens' MockNodeServerChainState TxPool
</span><a href="Cardano.Chain.html#txPool"><span class="hs-identifier hs-var">txPool</span></a></span><span> </span><span class="annot"><span class="annottext">((TxPool -&gt; Identity TxPool)
 -&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState)
-&gt; TxPool -&gt; MockNodeServerChainState -&gt; MockNodeServerChainState
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall s (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; s) -&gt; Eff effs ()
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; MockNodeServerChainState)
 -&gt; Eff effs ())
-&gt; (MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Block -&gt; Identity (Maybe Block))
-&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState
Lens' MockNodeServerChainState (Maybe Block)
</span><a href="Cardano.Chain.html#tip"><span class="hs-identifier hs-var">tip</span></a></span><span>    </span><span class="annot"><span class="annottext">((Maybe Block -&gt; Identity (Maybe Block))
 -&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState)
-&gt; Block -&gt; MockNodeServerChainState -&gt; MockNodeServerChainState
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">?~</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381687"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall s (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; s) -&gt; Eff effs ()
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; MockNodeServerChainState)
 -&gt; Eff effs ())
-&gt; (MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UtxoIndex -&gt; Identity UtxoIndex)
-&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState
Lens' MockNodeServerChainState UtxoIndex
</span><a href="Cardano.Chain.html#index"><span class="hs-identifier hs-var">index</span></a></span><span>  </span><span class="annot"><span class="annottext">((UtxoIndex -&gt; Identity UtxoIndex)
 -&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState)
-&gt; UtxoIndex
-&gt; MockNodeServerChainState
-&gt; MockNodeServerChainState
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621680381685"><span class="hs-identifier hs-var">idx'</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">(ChainEvent -&gt; Eff effs ()) -&gt; [ChainEvent] -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="annot"><span class="annottext">ChainEvent -&gt; Eff effs ()
forall (effs :: [* -&gt; *]).
Member (LogMsg ChainEvent) effs =&gt;
ChainEvent -&gt; Eff effs ()
</span><a href="Cardano.Chain.html#logEvent"><span class="hs-identifier hs-var">logEvent</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainEvent]
</span><a href="#local-6989586621680381686"><span class="hs-identifier hs-var">events</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; Eff effs ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Eff effs ()) -&gt; IO () -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block -&gt; Block -&gt; STM ()
forall a. TChan a -&gt; a -&gt; STM ()
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">writeTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381689"><span class="hs-identifier hs-var">chan</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381687"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><span class="annottext">Block -&gt; Eff effs Block
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381687"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ModifySlot</span></a></span><span> </span><span id="local-6989586621680381679"><span class="annot"><span class="annottext">Slot -&gt; Slot
</span><a href="#local-6989586621680381679"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall s (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; s) -&gt; Eff effs ()
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter MockNodeServerChainState MockNodeServerChainState Slot Slot
-&gt; (Slot -&gt; Slot)
-&gt; MockNodeServerChainState
-&gt; MockNodeServerChainState
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter MockNodeServerChainState MockNodeServerChainState Slot Slot
Lens' MockNodeServerChainState Slot
</span><a href="Cardano.Chain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Slot -&gt; Slot
</span><a href="#local-6989586621680381679"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff effs () -&gt; Eff effs x -&gt; Eff effs x
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; x) -&gt; Eff effs x
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Slot MockNodeServerChainState Slot
-&gt; MockNodeServerChainState -&gt; Slot
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Slot MockNodeServerChainState Slot
Lens' MockNodeServerChainState Slot
</span><a href="Cardano.Chain.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span id="local-6989586621680381677"><span class="annot"><a href="Cardano.Chain.html#handleChain"><span class="hs-identifier hs-type">handleChain</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-107"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.html#MockNodeServerChainState"><span class="hs-identifier hs-type">MockNodeServerChainState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680381677"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">Params</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ChainEffect</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/nkim7nifcqpdb4r433zhbv94ima3fwqb-natural-transformation-lib-natural-transformation-0.4-haddock-doc/share/doc/natural-transformation/html/src"><span class="hs-operator hs-type">~&gt;</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Eff</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381677"><span class="hs-identifier hs-type">effs</span></a></span></span><span>
</span><span id="line-110"></span><span id="handleChain"><span class="annot"><span class="annottext">handleChain :: Params -&gt; ChainEffect ~&gt; Eff effs
</span><a href="Cardano.Chain.html#handleChain"><span class="hs-identifier hs-var hs-var">handleChain</span></a></span></span><span> </span><span id="local-6989586621680381675"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621680381675"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.QueueTx</span></a></span><span> </span><span id="local-6989586621680381673"><span class="annot"><span class="annottext">CardanoTx
</span><a href="#local-6989586621680381673"><span class="hs-identifier hs-var">tx</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall s (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; s) -&gt; Eff effs ()
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((MockNodeServerChainState -&gt; MockNodeServerChainState)
 -&gt; Eff effs ())
-&gt; (MockNodeServerChainState -&gt; MockNodeServerChainState)
-&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TxPool -&gt; Identity TxPool)
 -&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState)
-&gt; (TxPool -&gt; TxPool)
-&gt; MockNodeServerChainState
-&gt; MockNodeServerChainState
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">(TxPool -&gt; Identity TxPool)
-&gt; MockNodeServerChainState -&gt; Identity MockNodeServerChainState
Lens' MockNodeServerChainState TxPool
</span><a href="Cardano.Chain.html#txPool"><span class="hs-identifier hs-var">txPool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoTx -&gt; TxPool -&gt; TxPool
</span><a href="Cardano.Chain.html#addTxToPool"><span class="hs-identifier hs-var">addTxToPool</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoTx
</span><a href="#local-6989586621680381673"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">ChainEffect x
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var">EC.GetCurrentSlot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(MockNodeServerChainState -&gt; Slot) -&gt; Eff effs Slot
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">MockNodeServerChainState -&gt; Slot
</span><a href="Cardano.Chain.html#_currentSlot"><span class="hs-identifier hs-var hs-var">_currentSlot</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="annottext">ChainEffect x
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var">EC.GetParams</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Params -&gt; Eff effs Params
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621680381675"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span id="local-6989586621680381784"><span class="annot"><a href="Cardano.Chain.html#logEvent"><span class="hs-identifier hs-type">logEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-type">LogMsg</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ChainEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680381784"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.ChainEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-type">Eff</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381784"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-116"></span><span id="logEvent"><span class="annot"><span class="annottext">logEvent :: ChainEvent -&gt; Eff effs ()
</span><a href="Cardano.Chain.html#logEvent"><span class="hs-identifier hs-var hs-var">logEvent</span></a></span></span><span> </span><span id="local-6989586621680381669"><span class="annot"><span class="annottext">ChainEvent
</span><a href="#local-6989586621680381669"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ChainEvent
</span><a href="#local-6989586621680381669"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.SlotAdd</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainEvent -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-var">logDebug</span></a></span><span> </span><span class="annot"><span class="annottext">ChainEvent
</span><a href="#local-6989586621680381669"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-type">EC.TxnValidationFail</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainEvent -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-var">logWarn</span></a></span><span> </span><span class="annot"><span class="annottext">ChainEvent
</span><a href="#local-6989586621680381669"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="annottext">ChainEvent
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainEvent -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><a href="../../../../freer-extras/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ChainEvent
</span><a href="#local-6989586621680381669"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="annot"><a href="Cardano.Chain.html#addTxToPool"><span class="hs-identifier hs-type">addTxToPool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">CardanoTx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Chain.html#TxPool"><span class="hs-identifier hs-type">TxPool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Chain.html#TxPool"><span class="hs-identifier hs-type">TxPool</span></a></span><span>
</span><span id="line-122"></span><span id="addTxToPool"><span class="annot"><span class="annottext">addTxToPool :: CardanoTx -&gt; TxPool -&gt; TxPool
</span><a href="Cardano.Chain.html#addTxToPool"><span class="hs-identifier hs-var hs-var">addTxToPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | Fetch the currently stored chain by iterating over the channel until</span><span>
</span><span id="line-125"></span><span class="hs-comment">--   there is nothing left to be returned.</span><span>
</span><span id="line-126"></span><span class="annot"><a href="Cardano.Chain.html#chainNewestFirst"><span class="hs-identifier hs-type">chainNewestFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680381665"><span class="annot"><a href="#local-6989586621680381665"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680381665"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-type">TChan</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680381665"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span id="chainNewestFirst"><span class="annot"><span class="annottext">chainNewestFirst :: TChan Block -&gt; m Blockchain
</span><a href="Cardano.Chain.html#chainNewestFirst"><span class="hs-identifier hs-var hs-var">chainNewestFirst</span></a></span></span><span> </span><span id="local-6989586621680381664"><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381664"><span class="hs-identifier hs-var">ch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621680381663"><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381663"><span class="hs-identifier hs-var">localChannel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TChan Block) -&gt; m (TChan Block)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (TChan Block) -&gt; m (TChan Block))
-&gt; IO (TChan Block) -&gt; m (TChan Block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM (TChan Block) -&gt; IO (TChan Block)
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (TChan Block) -&gt; IO (TChan Block))
-&gt; STM (TChan Block) -&gt; IO (TChan Block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block -&gt; STM (TChan Block)
forall a. TChan a -&gt; STM (TChan a)
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">cloneTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381664"><span class="hs-identifier hs-var">ch</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">TChan Block -&gt; Blockchain -&gt; m Blockchain
</span><a href="#local-6989586621680381661"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381663"><span class="hs-identifier hs-var">localChannel</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><a href="#local-6989586621680381661"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-type">TChan</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680381665"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Block</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621680381661"><span class="annot"><span class="annottext">go :: TChan Block -&gt; Blockchain -&gt; m Blockchain
</span><a href="#local-6989586621680381661"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680381660"><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381660"><span class="hs-identifier hs-var">local</span></a></span></span><span> </span><span id="local-6989586621680381659"><span class="annot"><span class="annottext">Blockchain
</span><a href="#local-6989586621680381659"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe Block) -&gt; m (Maybe Block)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Block) -&gt; m (Maybe Block))
-&gt; IO (Maybe Block) -&gt; m (Maybe Block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM (Maybe Block) -&gt; IO (Maybe Block)
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe Block) -&gt; IO (Maybe Block))
-&gt; STM (Maybe Block) -&gt; IO (Maybe Block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block -&gt; STM (Maybe Block)
forall a. TChan a -&gt; STM (Maybe a)
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">tryReadTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381660"><span class="hs-identifier hs-var">local</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe Block) -&gt; (Maybe Block -&gt; m Blockchain) -&gt; m Blockchain
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-134"></span><span>            </span><span class="annot"><span class="annottext">Maybe Block
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blockchain -&gt; m Blockchain
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Blockchain
</span><a href="#local-6989586621680381659"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-135"></span><span>            </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680381657"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381657"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TChan Block -&gt; Blockchain -&gt; m Blockchain
</span><a href="#local-6989586621680381661"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TChan Block
</span><a href="#local-6989586621680381664"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680381657"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Blockchain -&gt; Blockchain
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Blockchain
</span><a href="#local-6989586621680381659"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span></pre></body></html>
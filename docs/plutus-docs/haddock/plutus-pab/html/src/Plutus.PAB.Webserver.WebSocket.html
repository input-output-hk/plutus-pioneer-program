<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators       #-}</span><span>
</span><span id="line-10"></span><span class="hs-comment">{-

Handlers for the websockets exposed by the PAB.

-}</span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.PAB.Webserver.WebSocket</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#wsHandler"><span class="hs-identifier">wsHandler</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWebsocket"><span class="hs-identifier">combinedWebsocket</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#contractInstanceUpdates"><span class="hs-identifier">contractInstanceUpdates</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Reports</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#getContractReport"><span class="hs-identifier">getContractReport</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Streams of PAB events</span></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#openEndpoints"><span class="hs-identifier">openEndpoints</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#slotChange"><span class="hs-identifier">slotChange</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#observableStateChange"><span class="hs-identifier">observableStateChange</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/2myid1dmcir40n7j5xgzi0viq9sz375m-tasty-lib-tasty-1.4.3-haddock-doc/share/doc/tasty/html/src"><span class="hs-identifier">Control.Concurrent.Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/qbfqwxngc2v3vsmy4gi1kzmsvhddq0qv-async-lib-async-2.2.4-haddock-doc/share/doc/async/html/src"><span class="hs-identifier">Async</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/qbfqwxngc2v3vsmy4gi1kzmsvhddq0qv-async-lib-async-2.2.4-haddock-doc/share/doc/async/html/src"><span class="hs-identifier">async</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/qbfqwxngc2v3vsmy4gi1kzmsvhddq0qv-async-lib-async-2.2.4-haddock-doc/share/doc/async/html/src"><span class="hs-identifier">waitAnyCancel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">STM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html"><span class="hs-identifier">Control.Concurrent.STM.Extras.Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier">STMStream</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#foldM"><span class="hs-identifier">foldM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#singleton"><span class="hs-identifier">singleton</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#unfold"><span class="hs-identifier">unfold</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#unfoldOn"><span class="hs-identifier">unfoldOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">handle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forever</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">Control.Monad.Freer.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier">throwError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">ToJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JSON</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">first</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">PubKeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Slot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier">Network.WebSockets</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WS</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier">Network.WebSockets.Connection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier">Connection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier">PendingConnection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">ActiveEndpoint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract.Wallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">ExportTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html"><span class="hs-identifier">Plutus.PAB.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier">PABAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html"><span class="hs-identifier">Plutus.PAB.Core</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html"><span class="hs-identifier">Plutus.PAB.Core.ContractInstance.STM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#BlockchainEnv"><span class="hs-identifier">BlockchainEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#OpenEndpoint"><span class="hs-identifier">OpenEndpoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#oepName"><span class="hs-identifier">oepName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html"><span class="hs-identifier">Plutus.PAB.Core.ContractInstance.STM</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Instances</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Effects.Contract.html"><span class="hs-identifier">Plutus.PAB.Effects.Contract</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Contract</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Events.ContractInstanceState.html"><span class="hs-identifier">Plutus.PAB.Events.ContractInstanceState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Events.ContractInstanceState.html#fromResp"><span class="hs-identifier">fromResp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Types.html"><span class="hs-identifier">Plutus.PAB.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Types.html#PABError"><span class="hs-identifier">PABError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Types.html#OtherError"><span class="hs-identifier">OtherError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.API.html"><span class="hs-identifier">Plutus.PAB.Webserver.API</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html"><span class="hs-identifier">Plutus.PAB.Webserver.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#CombinedWSStreamToClient"><span class="hs-identifier">CombinedWSStreamToClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#InstanceUpdate"><span class="hs-identifier">InstanceUpdate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#SlotChange"><span class="hs-identifier">SlotChange</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>                                   </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#CombinedWSStreamToServer"><span class="hs-identifier">CombinedWSStreamToServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#Subscribe"><span class="hs-identifier">Subscribe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#Unsubscribe"><span class="hs-identifier">Unsubscribe</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>                                   </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#ContractReport"><span class="hs-identifier">ContractReport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#ContractReport"><span class="hs-identifier">ContractReport</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#crActiveContractStates"><span class="hs-identifier">crActiveContractStates</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#crAvailableContracts"><span class="hs-identifier">crAvailableContracts</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>                                   </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#ContractSignatureResponse"><span class="hs-identifier">ContractSignatureResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#ContractSignatureResponse"><span class="hs-identifier">ContractSignatureResponse</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>                                   </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#InstanceStatusToClient"><span class="hs-identifier">InstanceStatusToClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#ContractFinished"><span class="hs-identifier">ContractFinished</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#NewActiveEndpoints"><span class="hs-identifier">NewActiveEndpoints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#NewObservableState"><span class="hs-identifier">NewObservableState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#NewYieldedExportTxs"><span class="hs-identifier">NewYieldedExportTxs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/b04nrk4i8h9kq5glikqcildam8xwyw84-servant-server-lib-servant-server-0.18.3-haddock-doc/share/doc/servant-server/html/src"><span class="hs-identifier">Servant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/vyn800dwc7jzx9nlwjw9m6vsd46p5skc-servant-lib-servant-0.18.3-haddock-doc/share/doc/servant/html/src"><span class="hs-operator">(:&lt;|&gt;)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/vyn800dwc7jzx9nlwjw9m6vsd46p5skc-servant-lib-servant-0.18.3-haddock-doc/share/doc/servant/html/src"><span class="hs-operator">(:&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Wallet.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">ContractInstanceId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#getContractReport"><span class="hs-identifier hs-type">getContractReport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395368"><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395367"><span class="annot"><a href="#local-6989586621680395367"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.PAB.Effects.Contract.html#PABContract"><span class="hs-identifier hs-type">Contract.PABContract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395367"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#ContractReport"><span class="hs-identifier hs-type">ContractReport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Effects.Contract.html#ContractDef"><span class="hs-identifier hs-type">Contract.ContractDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span id="getContractReport"><span class="annot"><span class="annottext">getContractReport :: PABAction t env (ContractReport (ContractDef t))
</span><a href="Plutus.PAB.Webserver.WebSocket.html#getContractReport"><span class="hs-identifier hs-var hs-var">getContractReport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621680395366"><span class="annot"><span class="annottext">[ContractDef t]
</span><a href="#local-6989586621680395366"><span class="hs-identifier hs-var">availableContracts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (ContractDefinition t) effs =&gt;
Eff effs [ContractDef t]
forall t (effs :: [* -&gt; *]).
Member (ContractDefinition t) effs =&gt;
Eff effs [ContractDef t]
</span><a href="Plutus.PAB.Effects.Contract.html#getDefinitions"><span class="hs-identifier hs-var">Contract.getDefinitions</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span id="local-6989586621680395364"><span class="annot"><span class="annottext">[ContractInstanceId]
</span><a href="#local-6989586621680395364"><span class="hs-identifier hs-var">activeContractIDs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((ContractInstanceId, ContractActivationArgs (ContractDef t))
 -&gt; ContractInstanceId)
-&gt; [(ContractInstanceId, ContractActivationArgs (ContractDef t))]
-&gt; [ContractInstanceId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceId, ContractActivationArgs (ContractDef t))
-&gt; ContractInstanceId
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(ContractInstanceId, ContractActivationArgs (ContractDef t))]
 -&gt; [ContractInstanceId])
-&gt; (Map ContractInstanceId (ContractActivationArgs (ContractDef t))
    -&gt; [(ContractInstanceId, ContractActivationArgs (ContractDef t))])
-&gt; Map ContractInstanceId (ContractActivationArgs (ContractDef t))
-&gt; [ContractInstanceId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map ContractInstanceId (ContractActivationArgs (ContractDef t))
-&gt; [(ContractInstanceId, ContractActivationArgs (ContractDef t))]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ContractInstanceId (ContractActivationArgs (ContractDef t))
 -&gt; [ContractInstanceId])
-&gt; Eff
     (PABEffects t env)
     (Map ContractInstanceId (ContractActivationArgs (ContractDef t)))
-&gt; Eff (PABEffects t env) [ContractInstanceId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (ContractStore t) effs =&gt;
Eff
  effs
  (Map ContractInstanceId (ContractActivationArgs (ContractDef t)))
forall t (effs :: [* -&gt; *]).
Member (ContractStore t) effs =&gt;
Eff
  effs
  (Map ContractInstanceId (ContractActivationArgs (ContractDef t)))
</span><a href="Plutus.PAB.Effects.Contract.html#getActiveContracts"><span class="hs-identifier hs-var">Contract.getActiveContracts</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621680395359"><span class="annot"><span class="annottext">[ContractSignatureResponse (ContractDef t)]
</span><a href="#local-6989586621680395359"><span class="hs-identifier hs-var">crAvailableContracts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><span class="annottext">(ContractDef t
 -&gt; Eff
      (PABEffects t env) (ContractSignatureResponse (ContractDef t)))
-&gt; [ContractDef t]
-&gt; Eff
     (PABEffects t env) [ContractSignatureResponse (ContractDef t)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span>
</span><span id="line-73"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680395357"><span class="annot"><span class="annottext">ContractDef t
</span><a href="#local-6989586621680395357"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContractDef t
-&gt; [FunctionSchema FormSchema]
-&gt; ContractSignatureResponse (ContractDef t)
forall t.
t -&gt; [FunctionSchema FormSchema] -&gt; ContractSignatureResponse t
</span><a href="Plutus.PAB.Webserver.Types.html#ContractSignatureResponse"><span class="hs-identifier hs-var">ContractSignatureResponse</span></a></span><span> </span><span class="annot"><span class="annottext">ContractDef t
</span><a href="#local-6989586621680395357"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">([FunctionSchema FormSchema]
 -&gt; ContractSignatureResponse (ContractDef t))
-&gt; Eff (PABEffects t env) [FunctionSchema FormSchema]
-&gt; Eff
     (PABEffects t env) (ContractSignatureResponse (ContractDef t))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ContractDef t -&gt; Eff (PABEffects t env) [FunctionSchema FormSchema]
forall t (effs :: [* -&gt; *]).
(Member (ContractEffect t) effs, PABContract t) =&gt;
ContractDef t -&gt; Eff effs [FunctionSchema FormSchema]
</span><a href="Plutus.PAB.Effects.Contract.html#exportSchema"><span class="hs-identifier hs-var">Contract.exportSchema</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="annottext">ContractDef t
</span><a href="#local-6989586621680395357"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>            </span><span class="annot"><span class="annottext">[ContractDef t]
</span><a href="#local-6989586621680395366"><span class="hs-identifier hs-var">availableContracts</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621680395355"><span class="annot"><span class="annottext">[(ContractInstanceId, PartiallyDecodedResponse PABReq)]
</span><a href="#local-6989586621680395355"><span class="hs-identifier hs-var">crActiveContractStates</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ContractInstanceId
 -&gt; Eff
      (PABEffects t env)
      (ContractInstanceId, PartiallyDecodedResponse PABReq))
-&gt; [ContractInstanceId]
-&gt; Eff
     (PABEffects t env)
     [(ContractInstanceId, PartiallyDecodedResponse PABReq)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680395354"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395354"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContractInstanceId -&gt; Eff (PABEffects t env) (State t)
forall t (effs :: [* -&gt; *]).
Member (ContractStore t) effs =&gt;
ContractInstanceId -&gt; Eff effs (State t)
</span><a href="Plutus.PAB.Effects.Contract.html#getState"><span class="hs-identifier hs-var">Contract.getState</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395354"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (PABEffects t env) (State t)
-&gt; (State t
    -&gt; Eff
         (PABEffects t env)
         (ContractInstanceId, PartiallyDecodedResponse PABReq))
-&gt; Eff
     (PABEffects t env)
     (ContractInstanceId, PartiallyDecodedResponse PABReq)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680395352"><span class="annot"><span class="annottext">State t
</span><a href="#local-6989586621680395352"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ContractInstanceId, PartiallyDecodedResponse PABReq)
-&gt; Eff
     (PABEffects t env)
     (ContractInstanceId, PartiallyDecodedResponse PABReq)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395354"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContractResponse Value Value PABResp PABReq
-&gt; PartiallyDecodedResponse PABReq
forall s v.
ContractResponse Value Value s v -&gt; PartiallyDecodedResponse v
</span><a href="Plutus.PAB.Events.ContractInstanceState.html#fromResp"><span class="hs-identifier hs-var">fromResp</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractResponse Value Value PABResp PABReq
 -&gt; PartiallyDecodedResponse PABReq)
-&gt; ContractResponse Value Value PABResp PABReq
-&gt; PartiallyDecodedResponse PABReq
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy t -&gt; State t -&gt; ContractResponse Value Value PABResp PABReq
forall contract.
PABContract contract =&gt;
Proxy contract
-&gt; State contract -&gt; ContractResponse Value Value PABResp PABReq
</span><a href="Plutus.PAB.Effects.Contract.html#serialisableState"><span class="hs-identifier hs-var">Contract.serialisableState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy t
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395368"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State t
</span><a href="#local-6989586621680395352"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ContractInstanceId]
</span><a href="#local-6989586621680395364"><span class="hs-identifier hs-var">activeContractIDs</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="annottext">ContractReport (ContractDef t)
-&gt; PABAction t env (ContractReport (ContractDef t))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ContractReport :: forall t.
[ContractSignatureResponse t]
-&gt; [(ContractInstanceId, PartiallyDecodedResponse PABReq)]
-&gt; ContractReport t
</span><a href="Plutus.PAB.Webserver.Types.html#ContractReport"><span class="hs-identifier hs-type">ContractReport</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">[ContractSignatureResponse (ContractDef t)]
crAvailableContracts :: [ContractSignatureResponse (ContractDef t)]
crAvailableContracts :: [ContractSignatureResponse (ContractDef t)]
</span><a href="#local-6989586621680395359"><span class="hs-identifier hs-var hs-var">crAvailableContracts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ContractInstanceId, PartiallyDecodedResponse PABReq)]
crActiveContractStates :: [(ContractInstanceId, PartiallyDecodedResponse PABReq)]
crActiveContractStates :: [(ContractInstanceId, PartiallyDecodedResponse PABReq)]
</span><a href="#local-6989586621680395355"><span class="hs-identifier hs-var hs-var">crActiveContractStates</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#combinedUpdates"><span class="hs-identifier hs-type">combinedUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395432"><span class="annot"><a href="#local-6989586621680395432"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395431"><span class="annot"><a href="#local-6989586621680395431"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395432"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395431"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#CombinedWSStreamToClient"><span class="hs-identifier hs-type">CombinedWSStreamToClient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span id="combinedUpdates"><span class="annot"><span class="annottext">combinedUpdates :: WSState -&gt; PABAction t env (STMStream CombinedWSStreamToClient)
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedUpdates"><span class="hs-identifier hs-var hs-var">combinedUpdates</span></a></span></span><span> </span><span id="local-6989586621680395349"><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395349"><span class="hs-identifier hs-var">wsState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="annottext">WSState -&gt; BlockchainEnv -&gt; STMStream CombinedWSStreamToClient
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWSStreamToClient"><span class="hs-identifier hs-var">combinedWSStreamToClient</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395349"><span class="hs-identifier hs-var">wsState</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">(BlockchainEnv -&gt; STMStream CombinedWSStreamToClient)
-&gt; Eff (PABEffects t env) BlockchainEnv
-&gt; PABAction t env (STMStream CombinedWSStreamToClient)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (Reader (PABEnvironment t env)) effs =&gt;
Eff effs BlockchainEnv
forall t env (effs :: [* -&gt; *]).
Member (Reader (PABEnvironment t env)) effs =&gt;
Eff effs BlockchainEnv
</span><a href="Plutus.PAB.Core.html#askBlockchainEnv"><span class="hs-identifier hs-var">Core.askBlockchainEnv</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395432"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395431"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | The subscriptions for a websocket (wallet funds and contract instance notifications)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">data</span><span> </span><span id="WSState"><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-var">WSState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WSState"><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-var">WSState</span></a></span></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="wsInstances"><span class="annot"><span class="annottext">WSState -&gt; TVar (Map ContractInstanceId InstanceState)
</span><a href="Plutus.PAB.Webserver.WebSocket.html#wsInstances"><span class="hs-identifier hs-var hs-var">wsInstances</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM.TVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#InstanceState"><span class="hs-identifier hs-type">Instances.InstanceState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Contract instances that we want updates for</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wsWallets"><span class="annot"><span class="annottext">WSState -&gt; TVar (Set PubKeyHash)
</span><a href="Plutus.PAB.Webserver.WebSocket.html#wsWallets"><span class="hs-identifier hs-var hs-var">wsWallets</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM.TVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">PubKeyHash</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Wallets whose funds we are watching</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWSStreamToClient"><span class="hs-identifier hs-type">combinedWSStreamToClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#BlockchainEnv"><span class="hs-identifier hs-type">BlockchainEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#CombinedWSStreamToClient"><span class="hs-identifier hs-type">CombinedWSStreamToClient</span></a></span><span>
</span><span id="line-90"></span><span id="combinedWSStreamToClient"><span class="annot"><span class="annottext">combinedWSStreamToClient :: WSState -&gt; BlockchainEnv -&gt; STMStream CombinedWSStreamToClient
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWSStreamToClient"><span class="hs-identifier hs-var hs-var">combinedWSStreamToClient</span></a></span></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span class="hs-special">{</span><span id="local-6989586621680395343"><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
wsInstances :: TVar (Map ContractInstanceId InstanceState)
wsInstances :: WSState -&gt; TVar (Map ContractInstanceId InstanceState)
</span><a href="#local-6989586621680395343"><span class="hs-identifier hs-var hs-var">wsInstances</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680395342"><span class="annot"><span class="annottext">BlockchainEnv
</span><a href="#local-6989586621680395342"><span class="hs-identifier hs-var">blockchainEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621680395341"><span class="annot"><span class="annottext">Map ContractInstanceId InstanceState
</span><a href="#local-6989586621680395341"><span class="hs-identifier hs-var">instances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Map ContractInstanceId InstanceState -&gt; Set ContractInstanceId)
-&gt; STM (Map ContractInstanceId InstanceState)
-&gt; STMStream (Map ContractInstanceId InstanceState)
forall a b. Eq b =&gt; (a -&gt; b) -&gt; STM a -&gt; STMStream a
</span><a href="Control.Concurrent.STM.Extras.Stream.html#unfoldOn"><span class="hs-identifier hs-var">unfoldOn</span></a></span><span> </span><span class="annot"><span class="annottext">Map ContractInstanceId InstanceState -&gt; Set ContractInstanceId
forall k a. Map k a -&gt; Set k
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
-&gt; STM (Map ContractInstanceId InstanceState)
forall a. TVar a -&gt; STM a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.readTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
</span><a href="#local-6989586621680395343"><span class="hs-identifier hs-var">wsInstances</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680395338"><span class="annot"><span class="annottext">mkInstanceStream :: (ContractInstanceId, InstanceState)
-&gt; STMStream CombinedWSStreamToClient
</span><a href="#local-6989586621680395338"><span class="hs-identifier hs-var hs-var">mkInstanceStream</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680395337"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395337"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680395336"><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395336"><span class="hs-identifier hs-var">instanceState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
-&gt; InstanceStatusToClient -&gt; CombinedWSStreamToClient
</span><a href="Plutus.PAB.Webserver.Types.html#InstanceUpdate"><span class="hs-identifier hs-var">InstanceUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395337"><span class="hs-identifier hs-var">instanceId</span></a></span><span> </span><span class="annot"><span class="annottext">(InstanceStatusToClient -&gt; CombinedWSStreamToClient)
-&gt; STMStream InstanceStatusToClient
-&gt; STMStream CombinedWSStreamToClient
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STMStream InstanceStatusToClient
</span><a href="Plutus.PAB.Webserver.WebSocket.html#instanceUpdates"><span class="hs-identifier hs-var">instanceUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395336"><span class="hs-identifier hs-var">instanceState</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">[STMStream CombinedWSStreamToClient]
-&gt; STMStream CombinedWSStreamToClient
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Slot -&gt; CombinedWSStreamToClient
</span><a href="Plutus.PAB.Webserver.Types.html#SlotChange"><span class="hs-identifier hs-var">SlotChange</span></a></span><span> </span><span class="annot"><span class="annottext">(Slot -&gt; CombinedWSStreamToClient)
-&gt; STMStream Slot -&gt; STMStream CombinedWSStreamToClient
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BlockchainEnv -&gt; STMStream Slot
</span><a href="Plutus.PAB.Webserver.WebSocket.html#slotChange"><span class="hs-identifier hs-var">slotChange</span></a></span><span> </span><span class="annot"><span class="annottext">BlockchainEnv
</span><a href="#local-6989586621680395342"><span class="hs-identifier hs-var">blockchainEnv</span></a></span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((ContractInstanceId, InstanceState)
 -&gt; STMStream CombinedWSStreamToClient)
-&gt; [(ContractInstanceId, InstanceState)]
-&gt; STMStream CombinedWSStreamToClient
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceId, InstanceState)
-&gt; STMStream CombinedWSStreamToClient
</span><a href="#local-6989586621680395338"><span class="hs-identifier hs-var">mkInstanceStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map ContractInstanceId InstanceState
-&gt; [(ContractInstanceId, InstanceState)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map ContractInstanceId InstanceState
</span><a href="#local-6989586621680395341"><span class="hs-identifier hs-var">instances</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#initialWSState"><span class="hs-identifier hs-type">initialWSState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span>
</span><span id="line-99"></span><span id="initialWSState"><span class="annot"><span class="annottext">initialWSState :: STM WSState
</span><a href="Plutus.PAB.Webserver.WebSocket.html#initialWSState"><span class="hs-identifier hs-var hs-var">initialWSState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
-&gt; TVar (Set PubKeyHash) -&gt; WSState
</span><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-var">WSState</span></a></span><span> </span><span class="annot"><span class="annottext">(TVar (Map ContractInstanceId InstanceState)
 -&gt; TVar (Set PubKeyHash) -&gt; WSState)
-&gt; STM (TVar (Map ContractInstanceId InstanceState))
-&gt; STM (TVar (Set PubKeyHash) -&gt; WSState)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map ContractInstanceId InstanceState
-&gt; STM (TVar (Map ContractInstanceId InstanceState))
forall a. a -&gt; STM (TVar a)
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.newTVar</span></a></span><span> </span><span class="annot"><span class="annottext">Map ContractInstanceId InstanceState
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">STM (TVar (Set PubKeyHash) -&gt; WSState)
-&gt; STM (TVar (Set PubKeyHash)) -&gt; STM WSState
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Set PubKeyHash -&gt; STM (TVar (Set PubKeyHash))
forall a. a -&gt; STM (TVar a)
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.newTVar</span></a></span><span> </span><span class="annot"><span class="annottext">Set PubKeyHash
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#slotChange"><span class="hs-identifier hs-type">slotChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#BlockchainEnv"><span class="hs-identifier hs-type">BlockchainEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Slot</span></a></span><span>
</span><span id="line-102"></span><span id="slotChange"><span class="annot"><span class="annottext">slotChange :: BlockchainEnv -&gt; STMStream Slot
</span><a href="Plutus.PAB.Webserver.WebSocket.html#slotChange"><span class="hs-identifier hs-var hs-var">slotChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM Slot -&gt; STMStream Slot
forall a. Eq a =&gt; STM a -&gt; STMStream a
</span><a href="Control.Concurrent.STM.Extras.Stream.html#unfold"><span class="hs-identifier hs-var">unfold</span></a></span><span> </span><span class="annot"><span class="annottext">(STM Slot -&gt; STMStream Slot)
-&gt; (BlockchainEnv -&gt; STM Slot) -&gt; BlockchainEnv -&gt; STMStream Slot
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BlockchainEnv -&gt; STM Slot
</span><a href="Plutus.PAB.Core.ContractInstance.STM.html#currentSlot"><span class="hs-identifier hs-var">Instances.currentSlot</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#observableStateChange"><span class="hs-identifier hs-type">observableStateChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#InstanceState"><span class="hs-identifier hs-type">Instances.InstanceState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">JSON.Value</span></a></span><span>
</span><span id="line-105"></span><span id="observableStateChange"><span class="annot"><span class="annottext">observableStateChange :: InstanceState -&gt; STMStream Value
</span><a href="Plutus.PAB.Webserver.WebSocket.html#observableStateChange"><span class="hs-identifier hs-var hs-var">observableStateChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM Value -&gt; STMStream Value
forall a. Eq a =&gt; STM a -&gt; STMStream a
</span><a href="Control.Concurrent.STM.Extras.Stream.html#unfold"><span class="hs-identifier hs-var">unfold</span></a></span><span> </span><span class="annot"><span class="annottext">(STM Value -&gt; STMStream Value)
-&gt; (InstanceState -&gt; STM Value) -&gt; InstanceState -&gt; STMStream Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STM Value
</span><a href="Plutus.PAB.Core.ContractInstance.STM.html#observableContractState"><span class="hs-identifier hs-var">Instances.observableContractState</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#openEndpoints"><span class="hs-identifier hs-type">openEndpoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#InstanceState"><span class="hs-identifier hs-type">Instances.InstanceState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ActiveEndpoint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span id="openEndpoints"><span class="annot"><span class="annottext">openEndpoints :: InstanceState -&gt; STMStream [ActiveEndpoint]
</span><a href="Plutus.PAB.Webserver.WebSocket.html#openEndpoints"><span class="hs-identifier hs-var hs-var">openEndpoints</span></a></span></span><span> </span><span id="local-6989586621680395329"><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395329"><span class="hs-identifier hs-var">instanceState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">STM [ActiveEndpoint] -&gt; STMStream [ActiveEndpoint]
forall a. Eq a =&gt; STM a -&gt; STMStream a
</span><a href="Control.Concurrent.STM.Extras.Stream.html#unfold"><span class="hs-identifier hs-var">unfold</span></a></span><span> </span><span class="annot"><span class="annottext">(STM [ActiveEndpoint] -&gt; STMStream [ActiveEndpoint])
-&gt; STM [ActiveEndpoint] -&gt; STMStream [ActiveEndpoint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (RequestID, IterationID) OpenEndpoint -&gt; [ActiveEndpoint])
-&gt; STM (Map (RequestID, IterationID) OpenEndpoint)
-&gt; STM [ActiveEndpoint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((RequestID, IterationID), OpenEndpoint) -&gt; ActiveEndpoint)
-&gt; [((RequestID, IterationID), OpenEndpoint)] -&gt; [ActiveEndpoint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenEndpoint -&gt; ActiveEndpoint
</span><a href="Plutus.PAB.Core.ContractInstance.STM.html#oepName"><span class="hs-identifier hs-var hs-var">oepName</span></a></span><span> </span><span class="annot"><span class="annottext">(OpenEndpoint -&gt; ActiveEndpoint)
-&gt; (((RequestID, IterationID), OpenEndpoint) -&gt; OpenEndpoint)
-&gt; ((RequestID, IterationID), OpenEndpoint)
-&gt; ActiveEndpoint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((RequestID, IterationID), OpenEndpoint) -&gt; OpenEndpoint
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([((RequestID, IterationID), OpenEndpoint)] -&gt; [ActiveEndpoint])
-&gt; (Map (RequestID, IterationID) OpenEndpoint
    -&gt; [((RequestID, IterationID), OpenEndpoint)])
-&gt; Map (RequestID, IterationID) OpenEndpoint
-&gt; [ActiveEndpoint]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map (RequestID, IterationID) OpenEndpoint
-&gt; [((RequestID, IterationID), OpenEndpoint)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(STM (Map (RequestID, IterationID) OpenEndpoint)
 -&gt; STM [ActiveEndpoint])
-&gt; STM (Map (RequestID, IterationID) OpenEndpoint)
-&gt; STM [ActiveEndpoint]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STM (Map (RequestID, IterationID) OpenEndpoint)
</span><a href="Plutus.PAB.Core.ContractInstance.STM.html#openEndpoints"><span class="hs-identifier hs-var">Instances.openEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395329"><span class="hs-identifier hs-var">instanceState</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#yieldedExportTxsChange"><span class="hs-identifier hs-type">yieldedExportTxsChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#InstanceState"><span class="hs-identifier hs-type">Instances.InstanceState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ExportTx</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span id="yieldedExportTxsChange"><span class="annot"><span class="annottext">yieldedExportTxsChange :: InstanceState -&gt; STMStream [ExportTx]
</span><a href="Plutus.PAB.Webserver.WebSocket.html#yieldedExportTxsChange"><span class="hs-identifier hs-var hs-var">yieldedExportTxsChange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM [ExportTx] -&gt; STMStream [ExportTx]
forall a. Eq a =&gt; STM a -&gt; STMStream a
</span><a href="Control.Concurrent.STM.Extras.Stream.html#unfold"><span class="hs-identifier hs-var">unfold</span></a></span><span> </span><span class="annot"><span class="annottext">(STM [ExportTx] -&gt; STMStream [ExportTx])
-&gt; (InstanceState -&gt; STM [ExportTx])
-&gt; InstanceState
-&gt; STMStream [ExportTx]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STM [ExportTx]
</span><a href="Plutus.PAB.Core.ContractInstance.STM.html#yieldedExportTxs"><span class="hs-identifier hs-var">Instances.yieldedExportTxs</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#finalValue"><span class="hs-identifier hs-type">finalValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#InstanceState"><span class="hs-identifier hs-type">Instances.InstanceState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">JSON.Value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span id="finalValue"><span class="annot"><span class="annottext">finalValue :: InstanceState -&gt; STMStream (Maybe Value)
</span><a href="Plutus.PAB.Webserver.WebSocket.html#finalValue"><span class="hs-identifier hs-var hs-var">finalValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe Value) -&gt; STMStream (Maybe Value)
forall a. STM a -&gt; STMStream a
</span><a href="Control.Concurrent.STM.Extras.Stream.html#singleton"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe Value) -&gt; STMStream (Maybe Value))
-&gt; (InstanceState -&gt; STM (Maybe Value))
-&gt; InstanceState
-&gt; STMStream (Maybe Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STM (Maybe Value)
</span><a href="Plutus.PAB.Core.ContractInstance.STM.html#finalResult"><span class="hs-identifier hs-var">Instances.finalResult</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- | Get a stream of instance updates for a given 'InstanceState'</span><span>
</span><span id="line-118"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#instanceUpdates"><span class="hs-identifier hs-type">instanceUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#InstanceState"><span class="hs-identifier hs-type">Instances.InstanceState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#InstanceStatusToClient"><span class="hs-identifier hs-type">InstanceStatusToClient</span></a></span><span>
</span><span id="line-119"></span><span id="instanceUpdates"><span class="annot"><span class="annottext">instanceUpdates :: InstanceState -&gt; STMStream InstanceStatusToClient
</span><a href="Plutus.PAB.Webserver.WebSocket.html#instanceUpdates"><span class="hs-identifier hs-var hs-var">instanceUpdates</span></a></span></span><span> </span><span id="local-6989586621680395323"><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395323"><span class="hs-identifier hs-var">instanceState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="annottext">[STMStream InstanceStatusToClient]
-&gt; STMStream InstanceStatusToClient
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">([STMStream InstanceStatusToClient]
 -&gt; STMStream InstanceStatusToClient)
-&gt; [STMStream InstanceStatusToClient]
-&gt; STMStream InstanceStatusToClient
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Value -&gt; InstanceStatusToClient
</span><a href="Plutus.PAB.Webserver.Types.html#NewObservableState"><span class="hs-identifier hs-var">NewObservableState</span></a></span><span>  </span><span class="annot"><span class="annottext">(Value -&gt; InstanceStatusToClient)
-&gt; STMStream Value -&gt; STMStream InstanceStatusToClient
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STMStream Value
</span><a href="Plutus.PAB.Webserver.WebSocket.html#observableStateChange"><span class="hs-identifier hs-var">observableStateChange</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395323"><span class="hs-identifier hs-var">instanceState</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ActiveEndpoint] -&gt; InstanceStatusToClient
</span><a href="Plutus.PAB.Webserver.Types.html#NewActiveEndpoints"><span class="hs-identifier hs-var">NewActiveEndpoints</span></a></span><span>  </span><span class="annot"><span class="annottext">([ActiveEndpoint] -&gt; InstanceStatusToClient)
-&gt; STMStream [ActiveEndpoint] -&gt; STMStream InstanceStatusToClient
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STMStream [ActiveEndpoint]
</span><a href="Plutus.PAB.Webserver.WebSocket.html#openEndpoints"><span class="hs-identifier hs-var">openEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395323"><span class="hs-identifier hs-var">instanceState</span></a></span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExportTx] -&gt; InstanceStatusToClient
</span><a href="Plutus.PAB.Webserver.Types.html#NewYieldedExportTxs"><span class="hs-identifier hs-var">NewYieldedExportTxs</span></a></span><span> </span><span class="annot"><span class="annottext">([ExportTx] -&gt; InstanceStatusToClient)
-&gt; STMStream [ExportTx] -&gt; STMStream InstanceStatusToClient
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STMStream [ExportTx]
</span><a href="Plutus.PAB.Webserver.WebSocket.html#yieldedExportTxsChange"><span class="hs-identifier hs-var">yieldedExportTxsChange</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395323"><span class="hs-identifier hs-var">instanceState</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Value -&gt; InstanceStatusToClient
</span><a href="Plutus.PAB.Webserver.Types.html#ContractFinished"><span class="hs-identifier hs-var">ContractFinished</span></a></span><span>    </span><span class="annot"><span class="annottext">(Maybe Value -&gt; InstanceStatusToClient)
-&gt; STMStream (Maybe Value) -&gt; STMStream InstanceStatusToClient
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState -&gt; STMStream (Maybe Value)
</span><a href="Plutus.PAB.Webserver.WebSocket.html#finalValue"><span class="hs-identifier hs-var">finalValue</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395323"><span class="hs-identifier hs-var">instanceState</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Send all updates from an 'STMStream' to a websocket until it finishes.</span><span>
</span><span id="line-128"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#streamToWebsocket"><span class="hs-identifier hs-type">streamToWebsocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395474"><span class="annot"><a href="#local-6989586621680395474"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395473"><span class="annot"><a href="#local-6989586621680395473"><span class="hs-identifier hs-type">env</span></a></span></span><span> </span><span id="local-6989586621680395475"><span class="annot"><a href="#local-6989586621680395475"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Concurrent.STM.Extras.Stream.html#STMStream"><span class="hs-identifier hs-type">STMStream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395474"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395473"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span id="streamToWebsocket"><span class="annot"><span class="annottext">streamToWebsocket :: Connection -&gt; STMStream a -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#streamToWebsocket"><span class="hs-identifier hs-var hs-var">streamToWebsocket</span></a></span></span><span> </span><span id="local-6989586621680395321"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395321"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621680395320"><span class="annot"><span class="annottext">STMStream a
</span><a href="#local-6989586621680395320"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PABAction t env ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PABAction t env ()) -&gt; IO () -&gt; PABAction t env ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">STMStream a -&gt; (a -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a. STMStream a -&gt; (a -&gt; IO ()) -&gt; IO () -&gt; IO ()
</span><a href="Control.Concurrent.STM.Extras.Stream.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">STMStream a
</span><a href="#local-6989586621680395320"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; ByteString -&gt; IO ()
forall a. WebSocketsData a =&gt; Connection -&gt; a -&gt; IO ()
</span><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-var">WS.sendTextData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395321"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; (a -&gt; ByteString) -&gt; a -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">JSON.encode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Handler for WSAPI</span><span>
</span><span id="line-133"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#wsHandler"><span class="hs-identifier hs-type">wsHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395317"><span class="annot"><a href="#local-6989586621680395317"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395316"><span class="annot"><a href="#local-6989586621680395316"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">PendingConnection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395317"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395316"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="../file:///nix/store/vyn800dwc7jzx9nlwjw9m6vsd46p5skc-servant-lib-servant-0.18.3-haddock-doc/share/doc/servant/html/src"><span class="hs-operator hs-type">:&lt;|&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">PendingConnection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395317"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395316"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span id="wsHandler"><span class="annot"><span class="annottext">wsHandler :: (ContractInstanceId -&gt; PendingConnection -&gt; PABAction t env ())
:&lt;|&gt; (PendingConnection -&gt; PABAction t env ())
</span><a href="Plutus.PAB.Webserver.WebSocket.html#wsHandler"><span class="hs-identifier hs-var hs-var">wsHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">ContractInstanceId -&gt; PendingConnection -&gt; PABAction t env ()
forall t env.
ContractInstanceId -&gt; PendingConnection -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#contractInstanceUpdates"><span class="hs-identifier hs-var">contractInstanceUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceId -&gt; PendingConnection -&gt; PABAction t env ())
-&gt; (PendingConnection -&gt; PABAction t env ())
-&gt; (ContractInstanceId -&gt; PendingConnection -&gt; PABAction t env ())
   :&lt;|&gt; (PendingConnection -&gt; PABAction t env ())
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><a href="../file:///nix/store/vyn800dwc7jzx9nlwjw9m6vsd46p5skc-servant-lib-servant-0.18.3-haddock-doc/share/doc/servant/html/src"><span class="hs-operator hs-var">:&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PendingConnection -&gt; PABAction t env ()
forall t env. PendingConnection -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWebsocket"><span class="hs-identifier hs-var">combinedWebsocket</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#sendContractInstanceUpdatesToClient"><span class="hs-identifier hs-type">sendContractInstanceUpdatesToClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395450"><span class="annot"><a href="#local-6989586621680395450"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395449"><span class="annot"><a href="#local-6989586621680395449"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395450"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395449"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span id="sendContractInstanceUpdatesToClient"><span class="annot"><span class="annottext">sendContractInstanceUpdatesToClient :: ContractInstanceId -&gt; Connection -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#sendContractInstanceUpdatesToClient"><span class="hs-identifier hs-var hs-var">sendContractInstanceUpdatesToClient</span></a></span></span><span> </span><span id="local-6989586621680395314"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395314"><span class="hs-identifier hs-var">instanceId</span></a></span></span><span> </span><span id="local-6989586621680395313"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395313"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621680395312"><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395312"><span class="hs-identifier hs-var">instanceState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContractInstanceId -&gt; PABAction t env InstanceState
forall t env. ContractInstanceId -&gt; PABAction t env InstanceState
</span><a href="Plutus.PAB.Core.html#instanceStateInternal"><span class="hs-identifier hs-var">Core.instanceStateInternal</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395450"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680395449"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395314"><span class="hs-identifier hs-var">instanceId</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="annottext">Connection
-&gt; STMStream InstanceStatusToClient -&gt; PABAction t env ()
forall t env a.
ToJSON a =&gt;
Connection -&gt; STMStream a -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#streamToWebsocket"><span class="hs-identifier hs-var">streamToWebsocket</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395313"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstanceState -&gt; STMStream InstanceStatusToClient
</span><a href="Plutus.PAB.Webserver.WebSocket.html#instanceUpdates"><span class="hs-identifier hs-var">instanceUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395312"><span class="hs-identifier hs-var">instanceState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#contractInstanceUpdates"><span class="hs-identifier hs-type">contractInstanceUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395485"><span class="annot"><a href="#local-6989586621680395485"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395484"><span class="annot"><a href="#local-6989586621680395484"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">PendingConnection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395485"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395484"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span id="contractInstanceUpdates"><span class="annot"><span class="annottext">contractInstanceUpdates :: ContractInstanceId -&gt; PendingConnection -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#contractInstanceUpdates"><span class="hs-identifier hs-var hs-var">contractInstanceUpdates</span></a></span></span><span> </span><span id="local-6989586621680395310"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395310"><span class="hs-identifier hs-var">contractInstanceId</span></a></span></span><span> </span><span id="local-6989586621680395309"><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621680395309"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="Plutus.PAB.Core.html#PABRunner"><span class="hs-identifier hs-type">Core.PABRunner</span></a></span><span class="hs-special">{</span><span id="local-6989586621680395307"><span class="annot"><span class="annottext">forall a. PABAction t env a -&gt; IO (Either PABError a)
runPABAction :: forall t env.
PABRunner t env
-&gt; forall a. PABAction t env a -&gt; IO (Either PABError a)
runPABAction :: forall a. PABAction t env a -&gt; IO (Either PABError a)
</span><a href="Plutus.PAB.Core.html#runPABAction"><span class="hs-identifier hs-var hs-var">Core.runPABAction</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PABAction t env (PABRunner t env)
forall t env. PABAction t env (PABRunner t env)
</span><a href="Plutus.PAB.Core.html#pabRunner"><span class="hs-identifier hs-var">Core.pabRunner</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; PABAction t env ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PABAction t env ()) -&gt; IO () -&gt; PABAction t env ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>        </span><span id="local-6989586621680395304"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395304"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PendingConnection -&gt; IO Connection
</span><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-var">WS.acceptRequest</span></a></span><span> </span><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621680395309"><span class="hs-identifier hs-var">pending</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
</span><a href="#local-6989586621680395302"><span class="hs-identifier hs-var">disconnect</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; (IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Int -&gt; IO () -&gt; IO () -&gt; IO ()
forall a. Connection -&gt; Int -&gt; IO () -&gt; IO a -&gt; IO a
</span><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-var">WS.withPingThread</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395304"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Either PABError () -&gt; ()) -&gt; IO (Either PABError ()) -&gt; IO ()
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PABError -&gt; ()) -&gt; (() -&gt; ()) -&gt; Either PABError () -&gt; ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ()) -&gt; (PABError -&gt; [Char]) -&gt; PABError -&gt; ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PABError -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; ()
forall a. a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (Either PABError ()) -&gt; IO ())
-&gt; (PABAction t env () -&gt; IO (Either PABError ()))
-&gt; PABAction t env ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PABAction t env () -&gt; IO (Either PABError ())
forall a. PABAction t env a -&gt; IO (Either PABError a)
</span><a href="#local-6989586621680395307"><span class="hs-identifier hs-var">runPABAction</span></a></span><span> </span><span class="annot"><span class="annottext">(PABAction t env () -&gt; IO ()) -&gt; PABAction t env () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId -&gt; Connection -&gt; PABAction t env ()
forall t env.
ContractInstanceId -&gt; Connection -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#sendContractInstanceUpdatesToClient"><span class="hs-identifier hs-var">sendContractInstanceUpdatesToClient</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395310"><span class="hs-identifier hs-var">contractInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395304"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="#local-6989586621680395302"><span class="hs-identifier hs-type">disconnect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621680395302"><span class="annot"><span class="annottext">disconnect :: SomeException -&gt; IO ()
</span><a href="#local-6989586621680395302"><span class="hs-identifier hs-var hs-var">disconnect</span></a></span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWebsocket"><span class="hs-identifier hs-type">combinedWebsocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395481"><span class="annot"><a href="#local-6989586621680395481"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395480"><span class="annot"><a href="#local-6989586621680395480"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">PendingConnection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395481"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395480"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span id="combinedWebsocket"><span class="annot"><span class="annottext">combinedWebsocket :: PendingConnection -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWebsocket"><span class="hs-identifier hs-var hs-var">combinedWebsocket</span></a></span></span><span> </span><span id="local-6989586621680395296"><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621680395296"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621680395295"><span class="annot"><span class="annottext">PABRunner t env
</span><a href="#local-6989586621680395295"><span class="hs-identifier hs-var">pabRunner</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PABAction t env (PABRunner t env)
forall t env. PABAction t env (PABRunner t env)
</span><a href="Plutus.PAB.Core.html#pabRunner"><span class="hs-identifier hs-var">Core.pabRunner</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621680395294"><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395294"><span class="hs-identifier hs-var">wsState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO WSState -&gt; Eff (PABEffects t env) WSState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO WSState -&gt; Eff (PABEffects t env) WSState)
-&gt; IO WSState -&gt; Eff (PABEffects t env) WSState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM WSState -&gt; IO WSState
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.atomically</span></a></span><span> </span><span class="annot"><span class="annottext">STM WSState
</span><a href="Plutus.PAB.Webserver.WebSocket.html#initialWSState"><span class="hs-identifier hs-var">initialWSState</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; PABAction t env ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PABAction t env ()) -&gt; IO () -&gt; PABAction t env ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>        </span><span id="local-6989586621680395292"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395292"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PendingConnection -&gt; IO Connection
</span><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-var">WS.acceptRequest</span></a></span><span> </span><span class="annot"><span class="annottext">PendingConnection
</span><a href="#local-6989586621680395296"><span class="hs-identifier hs-var">pending</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
</span><a href="#local-6989586621680395291"><span class="hs-identifier hs-var">disconnect</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; (IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Int -&gt; IO () -&gt; IO () -&gt; IO ()
forall a. Connection -&gt; Int -&gt; IO () -&gt; IO a -&gt; IO a
</span><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-var">WS.withPingThread</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395292"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PABRunner t env -&gt; WSState -&gt; Connection -&gt; IO ()
forall t env. PABRunner t env -&gt; WSState -&gt; Connection -&gt; IO ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWebsocketThread"><span class="hs-identifier hs-var">combinedWebsocketThread</span></a></span><span> </span><span class="annot"><span class="annottext">PABRunner t env
</span><a href="#local-6989586621680395295"><span class="hs-identifier hs-var">pabRunner</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395294"><span class="hs-identifier hs-var">wsState</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395292"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="#local-6989586621680395291"><span class="hs-identifier hs-type">disconnect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621680395291"><span class="annot"><span class="annottext">disconnect :: SomeException -&gt; IO ()
</span><a href="#local-6989586621680395291"><span class="hs-identifier hs-var hs-var">disconnect</span></a></span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWebsocketThread"><span class="hs-identifier hs-type">combinedWebsocketThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395445"><span class="annot"><a href="#local-6989586621680395445"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395444"><span class="annot"><a href="#local-6989586621680395444"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABRunner"><span class="hs-identifier hs-type">Core.PABRunner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395445"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395444"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="combinedWebsocketThread"><span class="annot"><span class="annottext">combinedWebsocketThread :: PABRunner t env -&gt; WSState -&gt; Connection -&gt; IO ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedWebsocketThread"><span class="hs-identifier hs-var hs-var">combinedWebsocketThread</span></a></span></span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABRunner"><span class="hs-identifier hs-type">Core.PABRunner</span></a></span><span class="hs-special">{</span><span id="local-6989586621680395289"><span class="annot"><span class="annottext">forall a. PABAction t env a -&gt; IO (Either PABError a)
runPABAction :: forall a. PABAction t env a -&gt; IO (Either PABError a)
runPABAction :: forall t env.
PABRunner t env
-&gt; forall a. PABAction t env a -&gt; IO (Either PABError a)
</span><a href="#local-6989586621680395289"><span class="hs-identifier hs-var hs-var">Core.runPABAction</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680395288"><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395288"><span class="hs-identifier hs-var">wsState</span></a></span></span><span> </span><span id="local-6989586621680395287"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395287"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>        </span><span id="local-6989586621680395286"><span class="annot"><span class="annottext">[Async (Either PABError ())]
</span><a href="#local-6989586621680395286"><span class="hs-identifier hs-var">tasks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///nix/store/qbfqwxngc2v3vsmy4gi1kzmsvhddq0qv-async-lib-async-2.2.4-haddock-doc/share/doc/async/html/src"><span class="hs-identifier hs-type">Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Plutus.PAB.Types.html#PABError"><span class="hs-identifier hs-type">PABError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-169"></span><span>            </span><span class="annot"><span class="annottext">(PABAction t env () -&gt; IO (Async (Either PABError ())))
-&gt; [PABAction t env ()] -&gt; IO [Async (Either PABError ())]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span>
</span><span id="line-170"></span><span>                </span><span class="annot"><span class="annottext">PABAction t env () -&gt; IO (Async (Either PABError ()))
</span><a href="#local-6989586621680395285"><span class="hs-identifier hs-var">asyncApp</span></a></span><span>
</span><span id="line-171"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; WSState -&gt; PABAction t env ()
forall t env. Connection -&gt; WSState -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#sendCombinedUpdatesToClient"><span class="hs-identifier hs-var">sendCombinedUpdatesToClient</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395287"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395288"><span class="hs-identifier hs-var">wsState</span></a></span><span>
</span><span id="line-172"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; WSState -&gt; PABAction t env ()
forall t env. Connection -&gt; WSState -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#receiveMessagesFromClient"><span class="hs-identifier hs-var">receiveMessagesFromClient</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395287"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395288"><span class="hs-identifier hs-var">wsState</span></a></span><span>
</span><span id="line-173"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">IO (Async (Either PABError ()), Either PABError ()) -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Async (Either PABError ()), Either PABError ()) -&gt; IO ())
-&gt; IO (Async (Either PABError ()), Either PABError ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Async (Either PABError ())]
-&gt; IO (Async (Either PABError ()), Either PABError ())
forall a. [Async a] -&gt; IO (Async a, a)
</span><a href="../file:///nix/store/qbfqwxngc2v3vsmy4gi1kzmsvhddq0qv-async-lib-async-2.2.4-haddock-doc/share/doc/async/html/src"><span class="hs-identifier hs-var">waitAnyCancel</span></a></span><span> </span><span class="annot"><span class="annottext">[Async (Either PABError ())]
</span><a href="#local-6989586621680395286"><span class="hs-identifier hs-var">tasks</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>        </span><span id="local-6989586621680395285"><span class="annot"><span class="annottext">asyncApp :: PABAction t env () -&gt; IO (Async (Either PABError ()))
</span><a href="#local-6989586621680395285"><span class="hs-identifier hs-var hs-var">asyncApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either PABError ()) -&gt; IO (Async (Either PABError ()))
forall a. IO a -&gt; IO (Async a)
</span><a href="../file:///nix/store/qbfqwxngc2v3vsmy4gi1kzmsvhddq0qv-async-lib-async-2.2.4-haddock-doc/share/doc/async/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either PABError ()) -&gt; IO (Async (Either PABError ())))
-&gt; (PABAction t env () -&gt; IO (Either PABError ()))
-&gt; PABAction t env ()
-&gt; IO (Async (Either PABError ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PABAction t env () -&gt; IO (Either PABError ())
forall a. PABAction t env a -&gt; IO (Either PABError a)
</span><a href="#local-6989586621680395289"><span class="hs-identifier hs-var">runPABAction</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#sendCombinedUpdatesToClient"><span class="hs-identifier hs-type">sendCombinedUpdatesToClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395440"><span class="annot"><a href="#local-6989586621680395440"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395439"><span class="annot"><a href="#local-6989586621680395439"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395440"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395439"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="sendCombinedUpdatesToClient"><span class="annot"><span class="annottext">sendCombinedUpdatesToClient :: Connection -&gt; WSState -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#sendCombinedUpdatesToClient"><span class="hs-identifier hs-var hs-var">sendCombinedUpdatesToClient</span></a></span></span><span> </span><span id="local-6989586621680395282"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395282"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621680395281"><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395281"><span class="hs-identifier hs-var">wsState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WSState -&gt; PABAction t env (STMStream CombinedWSStreamToClient)
forall t env.
WSState -&gt; PABAction t env (STMStream CombinedWSStreamToClient)
</span><a href="Plutus.PAB.Webserver.WebSocket.html#combinedUpdates"><span class="hs-identifier hs-var">combinedUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395281"><span class="hs-identifier hs-var">wsState</span></a></span><span> </span><span class="annot"><span class="annottext">PABAction t env (STMStream CombinedWSStreamToClient)
-&gt; (STMStream CombinedWSStreamToClient -&gt; PABAction t env ())
-&gt; PABAction t env ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
-&gt; STMStream CombinedWSStreamToClient -&gt; PABAction t env ()
forall t env a.
ToJSON a =&gt;
Connection -&gt; STMStream a -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#streamToWebsocket"><span class="hs-identifier hs-var">streamToWebsocket</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395282"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#receiveMessagesFromClient"><span class="hs-identifier hs-type">receiveMessagesFromClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680395280"><span class="annot"><a href="#local-6989586621680395280"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680395279"><span class="annot"><a href="#local-6989586621680395279"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.html#PABAction"><span class="hs-identifier hs-type">PABAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395280"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680395279"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span id="receiveMessagesFromClient"><span class="annot"><span class="annottext">receiveMessagesFromClient :: Connection -&gt; WSState -&gt; PABAction t env ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#receiveMessagesFromClient"><span class="hs-identifier hs-var hs-var">receiveMessagesFromClient</span></a></span></span><span> </span><span id="local-6989586621680395278"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395278"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621680395277"><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395277"><span class="hs-identifier hs-var">wsState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PABAction t env () -&gt; PABAction t env ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(PABAction t env () -&gt; PABAction t env ())
-&gt; PABAction t env () -&gt; PABAction t env ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621680395276"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680395276"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; Eff (PABEffects t env) ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; Eff (PABEffects t env) ByteString)
-&gt; IO ByteString -&gt; Eff (PABEffects t env) ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ByteString
forall a. WebSocketsData a =&gt; Connection -&gt; IO a
</span><a href="../file:///nix/store/5zw5bj27ghd6c17g4y389fcf9a7yykrj-websockets-lib-websockets-0.12.7.3-haddock-doc/share/doc/websockets/html/src"><span class="hs-identifier hs-var">WS.receiveData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621680395278"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680395274"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#CombinedWSStreamToServer"><span class="hs-identifier hs-type">CombinedWSStreamToServer</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span id="local-6989586621680395274"><span class="annot"><span class="annottext">result :: Either Text CombinedWSStreamToServer
</span><a href="#local-6989586621680395274"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Text)
-&gt; Either [Char] CombinedWSStreamToServer
-&gt; Either Text CombinedWSStreamToServer
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-var">Text.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(Either [Char] CombinedWSStreamToServer
 -&gt; Either Text CombinedWSStreamToServer)
-&gt; Either [Char] CombinedWSStreamToServer
-&gt; Either Text CombinedWSStreamToServer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] CombinedWSStreamToServer
forall a. FromJSON a =&gt; ByteString -&gt; Either [Char] a
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">JSON.eitherDecode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680395276"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Text CombinedWSStreamToServer
</span><a href="#local-6989586621680395274"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#Subscribe"><span class="hs-identifier hs-type">Subscribe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680395271"><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680395271"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PABAction t env ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PABAction t env ()) -&gt; IO () -&gt; PABAction t env ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WSState -&gt; PubKeyHash -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#addWallet"><span class="hs-identifier hs-var">addWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395277"><span class="hs-identifier hs-var">wsState</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680395271"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#Subscribe"><span class="hs-identifier hs-type">Subscribe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680395269"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395269"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>            </span><span id="local-6989586621680395268"><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395268"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContractInstanceId -&gt; PABAction t env InstanceState
forall t env. ContractInstanceId -&gt; PABAction t env InstanceState
</span><a href="Plutus.PAB.Core.html#instanceStateInternal"><span class="hs-identifier hs-var">Core.instanceStateInternal</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395269"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-190"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; PABAction t env ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PABAction t env ()) -&gt; IO () -&gt; PABAction t env ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WSState -&gt; ContractInstanceId -&gt; InstanceState -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#addInstanceId"><span class="hs-identifier hs-var">addInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395277"><span class="hs-identifier hs-var">wsState</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395269"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395268"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.PAB.Webserver.Types.html#Unsubscribe"><span class="hs-identifier hs-type">Unsubscribe</span></a></span><span> </span><span id="local-6989586621680395266"><span class="annot"><span class="annottext">Either ContractInstanceId PubKeyHash
</span><a href="#local-6989586621680395266"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; PABAction t env ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; PABAction t env ()) -&gt; IO () -&gt; PABAction t env ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">STM.atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceId -&gt; STM ())
-&gt; (PubKeyHash -&gt; STM ())
-&gt; Either ContractInstanceId PubKeyHash
-&gt; STM ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSState -&gt; ContractInstanceId -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#removeInstanceId"><span class="hs-identifier hs-var">removeInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395277"><span class="hs-identifier hs-var">wsState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WSState -&gt; PubKeyHash -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#removeWallet"><span class="hs-identifier hs-var">removeWallet</span></a></span><span> </span><span class="annot"><span class="annottext">WSState
</span><a href="#local-6989586621680395277"><span class="hs-identifier hs-var">wsState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either ContractInstanceId PubKeyHash
</span><a href="#local-6989586621680395266"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680395263"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680395263"><span class="hs-identifier hs-var">e</span></a></span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PABError -&gt; PABAction t env ()
forall e (effs :: [* -&gt; *]) a.
Member (Error e) effs =&gt;
e -&gt; Eff effs a
</span><a href="../file:///nix/store/bvsf6n0jyy81dv6f71yfdy6shyr2f8sf-freer-simple-lib-freer-simple-1.2.1.2-haddock-doc/share/doc/freer-simple/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; PABError
</span><a href="Plutus.PAB.Types.html#OtherError"><span class="hs-identifier hs-var">OtherError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680395263"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#addInstanceId"><span class="hs-identifier hs-type">addInstanceId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.PAB.Core.ContractInstance.STM.html#InstanceState"><span class="hs-identifier hs-type">Instances.InstanceState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span id="addInstanceId"><span class="annot"><span class="annottext">addInstanceId :: WSState -&gt; ContractInstanceId -&gt; InstanceState -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#addInstanceId"><span class="hs-identifier hs-var hs-var">addInstanceId</span></a></span></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span class="hs-special">{</span><span id="local-6989586621680395262"><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
wsInstances :: TVar (Map ContractInstanceId InstanceState)
wsInstances :: WSState -&gt; TVar (Map ContractInstanceId InstanceState)
</span><a href="#local-6989586621680395262"><span class="hs-identifier hs-var hs-var">wsInstances</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680395261"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395261"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680395260"><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395260"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
-&gt; (Map ContractInstanceId InstanceState
    -&gt; Map ContractInstanceId InstanceState)
-&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">STM.modifyTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
</span><a href="#local-6989586621680395262"><span class="hs-identifier hs-var">wsInstances</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContractInstanceId
-&gt; InstanceState
-&gt; Map ContractInstanceId InstanceState
-&gt; Map ContractInstanceId InstanceState
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395261"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">InstanceState
</span><a href="#local-6989586621680395260"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#addWallet"><span class="hs-identifier hs-type">addWallet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">PubKeyHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span id="addWallet"><span class="annot"><span class="annottext">addWallet :: WSState -&gt; PubKeyHash -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#addWallet"><span class="hs-identifier hs-var hs-var">addWallet</span></a></span></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span class="hs-special">{</span><span id="local-6989586621680395257"><span class="annot"><span class="annottext">TVar (Set PubKeyHash)
wsWallets :: TVar (Set PubKeyHash)
wsWallets :: WSState -&gt; TVar (Set PubKeyHash)
</span><a href="#local-6989586621680395257"><span class="hs-identifier hs-var hs-var">wsWallets</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680395256"><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680395256"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar (Set PubKeyHash)
-&gt; (Set PubKeyHash -&gt; Set PubKeyHash) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">STM.modifyTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set PubKeyHash)
</span><a href="#local-6989586621680395257"><span class="hs-identifier hs-var">wsWallets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash -&gt; Set PubKeyHash -&gt; Set PubKeyHash
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680395256"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#removeInstanceId"><span class="hs-identifier hs-type">removeInstanceId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span id="removeInstanceId"><span class="annot"><span class="annottext">removeInstanceId :: WSState -&gt; ContractInstanceId -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#removeInstanceId"><span class="hs-identifier hs-var hs-var">removeInstanceId</span></a></span></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span class="hs-special">{</span><span id="local-6989586621680395254"><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
wsInstances :: TVar (Map ContractInstanceId InstanceState)
wsInstances :: WSState -&gt; TVar (Map ContractInstanceId InstanceState)
</span><a href="#local-6989586621680395254"><span class="hs-identifier hs-var hs-var">wsInstances</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680395253"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395253"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
-&gt; (Map ContractInstanceId InstanceState
    -&gt; Map ContractInstanceId InstanceState)
-&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">STM.modifyTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Map ContractInstanceId InstanceState)
</span><a href="#local-6989586621680395254"><span class="hs-identifier hs-var">wsInstances</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContractInstanceId
-&gt; Map ContractInstanceId InstanceState
-&gt; Map ContractInstanceId InstanceState
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.delete</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680395253"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#removeWallet"><span class="hs-identifier hs-type">removeWallet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">PubKeyHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span id="removeWallet"><span class="annot"><span class="annottext">removeWallet :: WSState -&gt; PubKeyHash -&gt; STM ()
</span><a href="Plutus.PAB.Webserver.WebSocket.html#removeWallet"><span class="hs-identifier hs-var hs-var">removeWallet</span></a></span></span><span> </span><span class="annot"><a href="Plutus.PAB.Webserver.WebSocket.html#WSState"><span class="hs-identifier hs-type">WSState</span></a></span><span class="hs-special">{</span><span id="local-6989586621680395251"><span class="annot"><span class="annottext">TVar (Set PubKeyHash)
wsWallets :: TVar (Set PubKeyHash)
wsWallets :: WSState -&gt; TVar (Set PubKeyHash)
</span><a href="#local-6989586621680395251"><span class="hs-identifier hs-var hs-var">wsWallets</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680395250"><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680395250"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar (Set PubKeyHash)
-&gt; (Set PubKeyHash -&gt; Set PubKeyHash) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><a href="../file:///nix/store/b738x068mpk6m31fqb2w33rzbqb41k86-stm-lib-stm-2.5.0.1-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier hs-var">STM.modifyTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar (Set PubKeyHash)
</span><a href="#local-6989586621680395251"><span class="hs-identifier hs-var">wsWallets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash -&gt; Set PubKeyHash -&gt; Set PubKeyHash
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Set.delete</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680395250"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span></pre></body></html>
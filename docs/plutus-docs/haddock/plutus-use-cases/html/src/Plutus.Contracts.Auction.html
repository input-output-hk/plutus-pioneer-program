<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass     #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric      #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia        #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GADTs              #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase         #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns     #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude  #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell    #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications   #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators      #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns       #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# OPTIONS_GHC -g -fplugin-opt PlutusTx.Plugin:coverage-all #-}</span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.Contracts.Auction</span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier">AuctionState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier">AuctionInput</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerSchema"><span class="hs-identifier">BuyerSchema</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#SellerSchema"><span class="hs-identifier">SellerSchema</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier">AuctionParams</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier">HighestBid</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionBuyer"><span class="hs-identifier">auctionBuyer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionSeller"><span class="hs-identifier">auctionSeller</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier">AuctionOutput</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier">AuctionError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">ThreadToken</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">SM.getThreadToken</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Auction.html#covIdx"><span class="hs-identifier">covIdx</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">makeClassyPrisms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">FromJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">ToJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/v5mncn1m77q8z96gsbph0gyf6rg9vh0w-semigroups-lib-semigroups-0.20-haddock-doc/share/doc/semigroups/html/src"><span class="hs-identifier">Data.Semigroup.Generic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/v5mncn1m77q8z96gsbph0gyf6rg9vh0w-semigroups-lib-semigroups-0.20-haddock-doc/share/doc/semigroups/html/src"><span class="hs-identifier">GenericSemigroupMonoid</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ada</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">POSIXTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">toPlutusAddress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Ada</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ada</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier">Ledger.Constraints</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Constraints</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier">Ledger.Constraints.TxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier">TxConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier">Ledger.Constraints.ValidityInterval</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Interval</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Typed.Scripts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Scripts</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Value</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract.StateMachine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">State</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">StateMachine</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">StateMachineClient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">ThreadToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Void</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>                                     </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">WaitingResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract.StateMachine</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SM</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">loopM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx.Code</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx.Coverage</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx.Prelude</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Haskell</span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | Definition of an auction</span><span>
</span><span id="line-56"></span><span id="local-6989586621680971726"><span id="local-6989586621680971727"></span></span><span class="hs-keyword">data</span><span> </span><span id="AuctionParams"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-var">AuctionParams</span></a></span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="AuctionParams"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-var">AuctionParams</span></a></span></span><span>
</span><span id="line-58"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="apOwner"><span class="annot"><span class="annottext">AuctionParams -&gt; Address
</span><a href="Plutus.Contracts.Auction.html#apOwner"><span class="hs-identifier hs-var hs-var">apOwner</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-comment">-- ^ Current owner of the asset. This is where the proceeds of the auction will be sent.</span><span>
</span><span id="line-59"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="apAsset"><span class="annot"><span class="annottext">AuctionParams -&gt; Value
</span><a href="Plutus.Contracts.Auction.html#apAsset"><span class="hs-identifier hs-var hs-var">apAsset</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-comment">-- ^ The asset itself. This value is going to be locked by the auction script output.</span><span>
</span><span id="line-60"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="apEndTime"><span class="annot"><span class="annottext">AuctionParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.Auction.html#apEndTime"><span class="hs-identifier hs-var hs-var">apEndTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">POSIXTime</span></a></span><span> </span><span class="hs-comment">-- ^ When the time window for bidding ends.</span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971718"><span id="local-6989586621680971720"><span class="annot"><span class="annottext">AuctionParams -&gt; AuctionParams -&gt; Bool
(AuctionParams -&gt; AuctionParams -&gt; Bool)
-&gt; (AuctionParams -&gt; AuctionParams -&gt; Bool) -&gt; Eq AuctionParams
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AuctionParams -&gt; AuctionParams -&gt; Bool
$c/= :: AuctionParams -&gt; AuctionParams -&gt; Bool
== :: AuctionParams -&gt; AuctionParams -&gt; Bool
$c== :: AuctionParams -&gt; AuctionParams -&gt; Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971711"><span id="local-6989586621680971713"><span id="local-6989586621680971715"><span class="annot"><span class="annottext">Int -&gt; AuctionParams -&gt; ShowS
[AuctionParams] -&gt; ShowS
AuctionParams -&gt; String
(Int -&gt; AuctionParams -&gt; ShowS)
-&gt; (AuctionParams -&gt; String)
-&gt; ([AuctionParams] -&gt; ShowS)
-&gt; Show AuctionParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AuctionParams] -&gt; ShowS
$cshowList :: [AuctionParams] -&gt; ShowS
show :: AuctionParams -&gt; String
$cshow :: AuctionParams -&gt; String
showsPrec :: Int -&gt; AuctionParams -&gt; ShowS
$cshowsPrec :: Int -&gt; AuctionParams -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. AuctionParams -&gt; Rep AuctionParams x)
-&gt; (forall x. Rep AuctionParams x -&gt; AuctionParams)
-&gt; Generic AuctionParams
forall x. Rep AuctionParams x -&gt; AuctionParams
forall x. AuctionParams -&gt; Rep AuctionParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AuctionParams x -&gt; AuctionParams
$cfrom :: forall x. AuctionParams -&gt; Rep AuctionParams x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971699"><span id="local-6989586621680971701"><span id="local-6989586621680971703"><span id="local-6989586621680971705"><span class="annot"><span class="annottext">[AuctionParams] -&gt; Encoding
[AuctionParams] -&gt; Value
AuctionParams -&gt; Encoding
AuctionParams -&gt; Value
(AuctionParams -&gt; Value)
-&gt; (AuctionParams -&gt; Encoding)
-&gt; ([AuctionParams] -&gt; Value)
-&gt; ([AuctionParams] -&gt; Encoding)
-&gt; ToJSON AuctionParams
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AuctionParams] -&gt; Encoding
$ctoEncodingList :: [AuctionParams] -&gt; Encoding
toJSONList :: [AuctionParams] -&gt; Value
$ctoJSONList :: [AuctionParams] -&gt; Value
toEncoding :: AuctionParams -&gt; Encoding
$ctoEncoding :: AuctionParams -&gt; Encoding
toJSON :: AuctionParams -&gt; Value
$ctoJSON :: AuctionParams -&gt; Value
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971694"><span id="local-6989586621680971696"><span class="annot"><span class="annottext">Value -&gt; Parser [AuctionParams]
Value -&gt; Parser AuctionParams
(Value -&gt; Parser AuctionParams)
-&gt; (Value -&gt; Parser [AuctionParams]) -&gt; FromJSON AuctionParams
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AuctionParams]
$cparseJSONList :: Value -&gt; Parser [AuctionParams]
parseJSON :: Value -&gt; Parser AuctionParams
$cparseJSON :: Value -&gt; Parser AuctionParams
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span id="local-6989586621680971689"><span id="local-6989586621680971691"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">AuctionParams</span></span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span id="local-6989586621680971683"><span id="local-6989586621680971684"></span></span><span class="hs-keyword">data</span><span> </span><span id="HighestBid"><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-var">HighestBid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>    </span><span id="HighestBid"><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-var">HighestBid</span></a></span></span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="highestBid"><span class="annot"><span class="annottext">HighestBid -&gt; Ada
</span><a href="Plutus.Contracts.Auction.html#highestBid"><span class="hs-identifier hs-var hs-var">highestBid</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Ada</span></a></span><span>
</span><span id="line-71"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="highestBidder"><span class="annot"><span class="annottext">HighestBid -&gt; Address
</span><a href="Plutus.Contracts.Auction.html#highestBidder"><span class="hs-identifier hs-var hs-var">highestBidder</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Address</span></a></span><span>
</span><span id="line-72"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971676"><span id="local-6989586621680971678"><span class="annot"><span class="annottext">HighestBid -&gt; HighestBid -&gt; Bool
(HighestBid -&gt; HighestBid -&gt; Bool)
-&gt; (HighestBid -&gt; HighestBid -&gt; Bool) -&gt; Eq HighestBid
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: HighestBid -&gt; HighestBid -&gt; Bool
$c/= :: HighestBid -&gt; HighestBid -&gt; Bool
== :: HighestBid -&gt; HighestBid -&gt; Bool
$c== :: HighestBid -&gt; HighestBid -&gt; Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971670"><span id="local-6989586621680971672"><span id="local-6989586621680971674"><span class="annot"><span class="annottext">Int -&gt; HighestBid -&gt; ShowS
[HighestBid] -&gt; ShowS
HighestBid -&gt; String
(Int -&gt; HighestBid -&gt; ShowS)
-&gt; (HighestBid -&gt; String)
-&gt; ([HighestBid] -&gt; ShowS)
-&gt; Show HighestBid
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [HighestBid] -&gt; ShowS
$cshowList :: [HighestBid] -&gt; ShowS
show :: HighestBid -&gt; String
$cshow :: HighestBid -&gt; String
showsPrec :: Int -&gt; HighestBid -&gt; ShowS
$cshowsPrec :: Int -&gt; HighestBid -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. HighestBid -&gt; Rep HighestBid x)
-&gt; (forall x. Rep HighestBid x -&gt; HighestBid) -&gt; Generic HighestBid
forall x. Rep HighestBid x -&gt; HighestBid
forall x. HighestBid -&gt; Rep HighestBid x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep HighestBid x -&gt; HighestBid
$cfrom :: forall x. HighestBid -&gt; Rep HighestBid x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971660"><span id="local-6989586621680971662"><span id="local-6989586621680971664"><span id="local-6989586621680971666"><span class="annot"><span class="annottext">[HighestBid] -&gt; Encoding
[HighestBid] -&gt; Value
HighestBid -&gt; Encoding
HighestBid -&gt; Value
(HighestBid -&gt; Value)
-&gt; (HighestBid -&gt; Encoding)
-&gt; ([HighestBid] -&gt; Value)
-&gt; ([HighestBid] -&gt; Encoding)
-&gt; ToJSON HighestBid
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [HighestBid] -&gt; Encoding
$ctoEncodingList :: [HighestBid] -&gt; Encoding
toJSONList :: [HighestBid] -&gt; Value
$ctoJSONList :: [HighestBid] -&gt; Value
toEncoding :: HighestBid -&gt; Encoding
$ctoEncoding :: HighestBid -&gt; Encoding
toJSON :: HighestBid -&gt; Value
$ctoJSON :: HighestBid -&gt; Value
</span><a href="#local-6989586621680971660"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971656"><span id="local-6989586621680971658"><span class="annot"><span class="annottext">Value -&gt; Parser [HighestBid]
Value -&gt; Parser HighestBid
(Value -&gt; Parser HighestBid)
-&gt; (Value -&gt; Parser [HighestBid]) -&gt; FromJSON HighestBid
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [HighestBid]
$cparseJSONList :: Value -&gt; Parser [HighestBid]
parseJSON :: Value -&gt; Parser HighestBid
$cparseJSON :: Value -&gt; Parser HighestBid
</span><a href="#local-6989586621680971656"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span id="local-6989586621680971650"><span id="local-6989586621680971652"><span id="local-6989586621680971654"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">HighestBid</span></span></span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | The states of the auction</span><span>
</span><span id="line-79"></span><span id="local-6989586621680971642"><span id="local-6989586621680971643"></span></span><span class="hs-keyword">data</span><span> </span><span id="AuctionState"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-var">AuctionState</span></a></span></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Ongoing"><span class="annot"><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-var">Ongoing</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span> </span><span class="hs-comment">-- Bids can be submitted.</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Finished"><span class="annot"><a href="Plutus.Contracts.Auction.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span> </span><span class="hs-comment">-- The auction is finished</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. AuctionState -&gt; Rep AuctionState x)
-&gt; (forall x. Rep AuctionState x -&gt; AuctionState)
-&gt; Generic AuctionState
forall x. Rep AuctionState x -&gt; AuctionState
forall x. AuctionState -&gt; Rep AuctionState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AuctionState x -&gt; AuctionState
$cfrom :: forall x. AuctionState -&gt; Rep AuctionState x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971632"><span id="local-6989586621680971634"><span id="local-6989586621680971636"><span class="annot"><span class="annottext">Int -&gt; AuctionState -&gt; ShowS
[AuctionState] -&gt; ShowS
AuctionState -&gt; String
(Int -&gt; AuctionState -&gt; ShowS)
-&gt; (AuctionState -&gt; String)
-&gt; ([AuctionState] -&gt; ShowS)
-&gt; Show AuctionState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AuctionState] -&gt; ShowS
$cshowList :: [AuctionState] -&gt; ShowS
show :: AuctionState -&gt; String
$cshow :: AuctionState -&gt; String
showsPrec :: Int -&gt; AuctionState -&gt; ShowS
$cshowsPrec :: Int -&gt; AuctionState -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971628"><span id="local-6989586621680971630"><span class="annot"><span class="annottext">AuctionState -&gt; AuctionState -&gt; Bool
(AuctionState -&gt; AuctionState -&gt; Bool)
-&gt; (AuctionState -&gt; AuctionState -&gt; Bool) -&gt; Eq AuctionState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AuctionState -&gt; AuctionState -&gt; Bool
$c/= :: AuctionState -&gt; AuctionState -&gt; Bool
== :: AuctionState -&gt; AuctionState -&gt; Bool
$c== :: AuctionState -&gt; AuctionState -&gt; Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971620"><span id="local-6989586621680971622"><span id="local-6989586621680971624"><span id="local-6989586621680971626"><span class="annot"><span class="annottext">[AuctionState] -&gt; Encoding
[AuctionState] -&gt; Value
AuctionState -&gt; Encoding
AuctionState -&gt; Value
(AuctionState -&gt; Value)
-&gt; (AuctionState -&gt; Encoding)
-&gt; ([AuctionState] -&gt; Value)
-&gt; ([AuctionState] -&gt; Encoding)
-&gt; ToJSON AuctionState
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AuctionState] -&gt; Encoding
$ctoEncodingList :: [AuctionState] -&gt; Encoding
toJSONList :: [AuctionState] -&gt; Value
$ctoJSONList :: [AuctionState] -&gt; Value
toEncoding :: AuctionState -&gt; Encoding
$ctoEncoding :: AuctionState -&gt; Encoding
toJSON :: AuctionState -&gt; Value
$ctoJSON :: AuctionState -&gt; Value
</span><a href="#local-6989586621680971620"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971616"><span id="local-6989586621680971618"><span class="annot"><span class="annottext">Value -&gt; Parser [AuctionState]
Value -&gt; Parser AuctionState
(Value -&gt; Parser AuctionState)
-&gt; (Value -&gt; Parser [AuctionState]) -&gt; FromJSON AuctionState
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AuctionState]
$cparseJSONList :: Value -&gt; Parser [AuctionState]
parseJSON :: Value -&gt; Parser AuctionState
$cparseJSON :: Value -&gt; Parser AuctionState
</span><a href="#local-6989586621680971616"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | Observable state of the auction app</span><span>
</span><span id="line-86"></span><span id="local-6989586621680971614"><span id="local-6989586621680971615"></span></span><span class="hs-keyword">data</span><span> </span><span id="AuctionOutput"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-var">AuctionOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>    </span><span id="AuctionOutput"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-var">AuctionOutput</span></a></span></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="auctionState"><span class="annot"><span class="annottext">AuctionOutput -&gt; Last AuctionState
</span><a href="Plutus.Contracts.Auction.html#auctionState"><span class="hs-identifier hs-var hs-var">auctionState</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Last</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="auctionThreadToken"><span class="annot"><span class="annottext">AuctionOutput -&gt; Last ThreadToken
</span><a href="Plutus.Contracts.Auction.html#auctionThreadToken"><span class="hs-identifier hs-var hs-var">auctionThreadToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Last</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ThreadToken</span></a></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. AuctionOutput -&gt; Rep AuctionOutput x)
-&gt; (forall x. Rep AuctionOutput x -&gt; AuctionOutput)
-&gt; Generic AuctionOutput
forall x. Rep AuctionOutput x -&gt; AuctionOutput
forall x. AuctionOutput -&gt; Rep AuctionOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AuctionOutput x -&gt; AuctionOutput
$cfrom :: forall x. AuctionOutput -&gt; Rep AuctionOutput x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971603"><span id="local-6989586621680971605"><span id="local-6989586621680971607"><span class="annot"><span class="annottext">Int -&gt; AuctionOutput -&gt; ShowS
[AuctionOutput] -&gt; ShowS
AuctionOutput -&gt; String
(Int -&gt; AuctionOutput -&gt; ShowS)
-&gt; (AuctionOutput -&gt; String)
-&gt; ([AuctionOutput] -&gt; ShowS)
-&gt; Show AuctionOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AuctionOutput] -&gt; ShowS
$cshowList :: [AuctionOutput] -&gt; ShowS
show :: AuctionOutput -&gt; String
$cshow :: AuctionOutput -&gt; String
showsPrec :: Int -&gt; AuctionOutput -&gt; ShowS
$cshowsPrec :: Int -&gt; AuctionOutput -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971599"><span id="local-6989586621680971601"><span class="annot"><span class="annottext">AuctionOutput -&gt; AuctionOutput -&gt; Bool
(AuctionOutput -&gt; AuctionOutput -&gt; Bool)
-&gt; (AuctionOutput -&gt; AuctionOutput -&gt; Bool) -&gt; Eq AuctionOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AuctionOutput -&gt; AuctionOutput -&gt; Bool
$c/= :: AuctionOutput -&gt; AuctionOutput -&gt; Bool
== :: AuctionOutput -&gt; AuctionOutput -&gt; Bool
$c== :: AuctionOutput -&gt; AuctionOutput -&gt; Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971591"><span id="local-6989586621680971593"><span id="local-6989586621680971595"><span id="local-6989586621680971597"><span class="annot"><span class="annottext">[AuctionOutput] -&gt; Encoding
[AuctionOutput] -&gt; Value
AuctionOutput -&gt; Encoding
AuctionOutput -&gt; Value
(AuctionOutput -&gt; Value)
-&gt; (AuctionOutput -&gt; Encoding)
-&gt; ([AuctionOutput] -&gt; Value)
-&gt; ([AuctionOutput] -&gt; Encoding)
-&gt; ToJSON AuctionOutput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AuctionOutput] -&gt; Encoding
$ctoEncodingList :: [AuctionOutput] -&gt; Encoding
toJSONList :: [AuctionOutput] -&gt; Value
$ctoJSONList :: [AuctionOutput] -&gt; Value
toEncoding :: AuctionOutput -&gt; Encoding
$ctoEncoding :: AuctionOutput -&gt; Encoding
toJSON :: AuctionOutput -&gt; Value
$ctoJSON :: AuctionOutput -&gt; Value
</span><a href="#local-6989586621680971591"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971587"><span id="local-6989586621680971589"><span class="annot"><span class="annottext">Value -&gt; Parser [AuctionOutput]
Value -&gt; Parser AuctionOutput
(Value -&gt; Parser AuctionOutput)
-&gt; (Value -&gt; Parser [AuctionOutput]) -&gt; FromJSON AuctionOutput
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AuctionOutput]
$cparseJSONList :: Value -&gt; Parser [AuctionOutput]
parseJSON :: Value -&gt; Parser AuctionOutput
$cparseJSON :: Value -&gt; Parser AuctionOutput
</span><a href="#local-6989586621680971587"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971581"><span id="local-6989586621680971583"><span id="local-6989586621680971585"><span class="annot"><span class="annottext">b -&gt; AuctionOutput -&gt; AuctionOutput
NonEmpty AuctionOutput -&gt; AuctionOutput
AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput
(AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput)
-&gt; (NonEmpty AuctionOutput -&gt; AuctionOutput)
-&gt; (forall b. Integral b =&gt; b -&gt; AuctionOutput -&gt; AuctionOutput)
-&gt; Semigroup AuctionOutput
forall b. Integral b =&gt; b -&gt; AuctionOutput -&gt; AuctionOutput
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
stimes :: b -&gt; AuctionOutput -&gt; AuctionOutput
$cstimes :: forall b. Integral b =&gt; b -&gt; AuctionOutput -&gt; AuctionOutput
sconcat :: NonEmpty AuctionOutput -&gt; AuctionOutput
$csconcat :: NonEmpty AuctionOutput -&gt; AuctionOutput
&lt;&gt; :: AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput
$c&lt;&gt; :: AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Semigroup</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971573"><span id="local-6989586621680971575"><span id="local-6989586621680971577"><span class="annot"><span class="annottext">Semigroup AuctionOutput
AuctionOutput
Semigroup AuctionOutput
-&gt; AuctionOutput
-&gt; (AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput)
-&gt; ([AuctionOutput] -&gt; AuctionOutput)
-&gt; Monoid AuctionOutput
[AuctionOutput] -&gt; AuctionOutput
AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput
forall a.
Semigroup a -&gt; a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
mconcat :: [AuctionOutput] -&gt; AuctionOutput
$cmconcat :: [AuctionOutput] -&gt; AuctionOutput
mappend :: AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput
$cmappend :: AuctionOutput -&gt; AuctionOutput -&gt; AuctionOutput
mempty :: AuctionOutput
$cmempty :: AuctionOutput
$cp1Monoid :: Semigroup AuctionOutput
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Monoid</span></a></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/v5mncn1m77q8z96gsbph0gyf6rg9vh0w-semigroups-lib-semigroups-0.20-haddock-doc/share/doc/semigroups/html/src"><span class="hs-identifier hs-type">GenericSemigroupMonoid</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionStateOut"><span class="hs-identifier hs-type">auctionStateOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span>
</span><span id="line-96"></span><span id="auctionStateOut"><span class="annot"><span class="annottext">auctionStateOut :: AuctionState -&gt; AuctionOutput
</span><a href="Plutus.Contracts.Auction.html#auctionStateOut"><span class="hs-identifier hs-var hs-var">auctionStateOut</span></a></span></span><span> </span><span id="local-6989586621680971570"><span class="annot"><span class="annottext">AuctionState
</span><a href="#local-6989586621680971570"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AuctionOutput
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.mempty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">auctionState :: Last AuctionState
</span><a href="Plutus.Contracts.Auction.html#auctionState"><span class="hs-identifier hs-var">auctionState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe AuctionState -&gt; Last AuctionState
forall a. Maybe a -&gt; Last a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuctionState -&gt; Maybe AuctionState
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionState
</span><a href="#local-6989586621680971570"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#threadTokenOut"><span class="hs-identifier hs-type">threadTokenOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ThreadToken</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span>
</span><span id="line-99"></span><span id="threadTokenOut"><span class="annot"><span class="annottext">threadTokenOut :: ThreadToken -&gt; AuctionOutput
</span><a href="Plutus.Contracts.Auction.html#threadTokenOut"><span class="hs-identifier hs-var hs-var">threadTokenOut</span></a></span></span><span> </span><span id="local-6989586621680971567"><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971567"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AuctionOutput
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.mempty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">auctionThreadToken :: Last ThreadToken
</span><a href="Plutus.Contracts.Auction.html#auctionThreadToken"><span class="hs-identifier hs-var">auctionThreadToken</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ThreadToken -&gt; Last ThreadToken
forall a. Maybe a -&gt; Last a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadToken -&gt; Maybe ThreadToken
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971567"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Initial 'AuctionState'. In the beginning the highest bid is 0 and the</span><span>
</span><span id="line-102"></span><span class="hs-comment">--   highest bidder is seller of the asset. So if nobody submits</span><span>
</span><span id="line-103"></span><span class="hs-comment">--   any bids, the seller gets the asset back after the auction has ended.</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#initialState"><span class="hs-identifier hs-type">initialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span>
</span><span id="line-105"></span><span id="initialState"><span class="annot"><span class="annottext">initialState :: Address -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#initialState"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span id="local-6989586621680971565"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971565"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-var">Ongoing</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid :: Ada -&gt; Address -&gt; HighestBid
</span><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">highestBid :: Ada
</span><a href="Plutus.Contracts.Auction.html#highestBid"><span class="hs-identifier hs-var">highestBid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ada
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">highestBidder :: Address
</span><a href="Plutus.Contracts.Auction.html#highestBidder"><span class="hs-identifier hs-var">highestBidder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971565"><span class="hs-identifier hs-var">self</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span id="local-6989586621680971559"><span id="local-6989586621680971561"><span id="local-6989586621680971563"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">AuctionState</span></span></span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Transition between auction states</span><span>
</span><span id="line-110"></span><span id="local-6989586621680971557"><span id="local-6989586621680971558"></span></span><span class="hs-keyword">data</span><span> </span><span id="AuctionInput"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-var">AuctionInput</span></a></span></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Bid"><span class="annot"><a href="Plutus.Contracts.Auction.html#Bid"><span class="hs-identifier hs-var">Bid</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="newBid"><span class="annot"><span class="annottext">AuctionInput -&gt; Ada
</span><a href="Plutus.Contracts.Auction.html#newBid"><span class="hs-identifier hs-var hs-var">newBid</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Ada</span></a></span><span class="hs-special">,</span><span> </span><span id="newBidder"><span class="annot"><span class="annottext">AuctionInput -&gt; Address
</span><a href="Plutus.Contracts.Auction.html#newBidder"><span class="hs-identifier hs-var hs-var">newBidder</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- Increase the price</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Payout"><span class="annot"><a href="Plutus.Contracts.Auction.html#Payout"><span class="hs-identifier hs-var">Payout</span></a></span></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. AuctionInput -&gt; Rep AuctionInput x)
-&gt; (forall x. Rep AuctionInput x -&gt; AuctionInput)
-&gt; Generic AuctionInput
forall x. Rep AuctionInput x -&gt; AuctionInput
forall x. AuctionInput -&gt; Rep AuctionInput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AuctionInput x -&gt; AuctionInput
$cfrom :: forall x. AuctionInput -&gt; Rep AuctionInput x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971545"><span id="local-6989586621680971547"><span id="local-6989586621680971549"><span class="annot"><span class="annottext">Int -&gt; AuctionInput -&gt; ShowS
[AuctionInput] -&gt; ShowS
AuctionInput -&gt; String
(Int -&gt; AuctionInput -&gt; ShowS)
-&gt; (AuctionInput -&gt; String)
-&gt; ([AuctionInput] -&gt; ShowS)
-&gt; Show AuctionInput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AuctionInput] -&gt; ShowS
$cshowList :: [AuctionInput] -&gt; ShowS
show :: AuctionInput -&gt; String
$cshow :: AuctionInput -&gt; String
showsPrec :: Int -&gt; AuctionInput -&gt; ShowS
$cshowsPrec :: Int -&gt; AuctionInput -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971537"><span id="local-6989586621680971539"><span id="local-6989586621680971541"><span id="local-6989586621680971543"><span class="annot"><span class="annottext">[AuctionInput] -&gt; Encoding
[AuctionInput] -&gt; Value
AuctionInput -&gt; Encoding
AuctionInput -&gt; Value
(AuctionInput -&gt; Value)
-&gt; (AuctionInput -&gt; Encoding)
-&gt; ([AuctionInput] -&gt; Value)
-&gt; ([AuctionInput] -&gt; Encoding)
-&gt; ToJSON AuctionInput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AuctionInput] -&gt; Encoding
$ctoEncodingList :: [AuctionInput] -&gt; Encoding
toJSONList :: [AuctionInput] -&gt; Value
$ctoJSONList :: [AuctionInput] -&gt; Value
toEncoding :: AuctionInput -&gt; Encoding
$ctoEncoding :: AuctionInput -&gt; Encoding
toJSON :: AuctionInput -&gt; Value
$ctoJSON :: AuctionInput -&gt; Value
</span><a href="#local-6989586621680971537"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971533"><span id="local-6989586621680971535"><span class="annot"><span class="annottext">Value -&gt; Parser [AuctionInput]
Value -&gt; Parser AuctionInput
(Value -&gt; Parser AuctionInput)
-&gt; (Value -&gt; Parser [AuctionInput]) -&gt; FromJSON AuctionInput
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AuctionInput]
$cparseJSONList :: Value -&gt; Parser [AuctionInput]
parseJSON :: Value -&gt; Parser AuctionInput
$cparseJSON :: Value -&gt; Parser AuctionInput
</span><a href="#local-6989586621680971533"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span id="local-6989586621680971527"><span id="local-6989586621680971529"><span id="local-6989586621680971531"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">AuctionInput</span></span></span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-keyword">type</span><span> </span><span id="AuctionMachine"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionMachine"><span class="hs-identifier hs-var">AuctionMachine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">StateMachine</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-type">AuctionInput</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionTransition"><span class="hs-pragma hs-type">auctionTransition</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- | The transitions of the auction state machine.</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionTransition"><span class="hs-identifier hs-type">auctionTransition</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-type">AuctionInput</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span id="auctionTransition"><span class="annot"><span class="annottext">auctionTransition :: AuctionParams
-&gt; State AuctionState
-&gt; AuctionInput
-&gt; Maybe (TxConstraints Void Void, State AuctionState)
</span><a href="Plutus.Contracts.Auction.html#auctionTransition"><span class="hs-identifier hs-var hs-var">auctionTransition</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680971525"><span class="annot"><span class="annottext">Address
apOwner :: Address
apOwner :: AuctionParams -&gt; Address
</span><a href="#local-6989586621680971525"><span class="hs-identifier hs-var hs-var">apOwner</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971524"><span class="annot"><span class="annottext">Value
apAsset :: Value
apAsset :: AuctionParams -&gt; Value
</span><a href="#local-6989586621680971524"><span class="hs-identifier hs-var hs-var">apAsset</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971523"><span class="annot"><span class="annottext">POSIXTime
apEndTime :: POSIXTime
apEndTime :: AuctionParams -&gt; POSIXTime
</span><a href="#local-6989586621680971523"><span class="hs-identifier hs-var hs-var">apEndTime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">State</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateData :: forall s. State s -&gt; s
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">stateData</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680971520"><span class="annot"><span class="annottext">AuctionState
</span><a href="#local-6989586621680971520"><span class="hs-identifier hs-var">oldStateData</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stateValue :: forall s. State s -&gt; Value
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">stateValue</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680971518"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680971518"><span class="hs-identifier hs-var">oldStateValue</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680971517"><span class="annot"><span class="annottext">AuctionInput
</span><a href="#local-6989586621680971517"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuctionState
</span><a href="#local-6989586621680971520"><span class="hs-identifier hs-var">oldStateData</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AuctionInput
</span><a href="#local-6989586621680971517"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-type">Ongoing</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span class="hs-special">{</span><span id="local-6989586621680971516"><span class="annot"><span class="annottext">Ada
highestBid :: Ada
highestBid :: HighestBid -&gt; Ada
</span><a href="#local-6989586621680971516"><span class="hs-identifier hs-var hs-var">highestBid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971515"><span class="annot"><span class="annottext">Address
highestBidder :: Address
highestBidder :: HighestBid -&gt; Address
</span><a href="#local-6989586621680971515"><span class="hs-identifier hs-var hs-var">highestBidder</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#Bid"><span class="hs-identifier hs-type">Bid</span></a></span><span class="hs-special">{</span><span id="local-6989586621680971514"><span class="annot"><span class="annottext">Ada
newBid :: Ada
newBid :: AuctionInput -&gt; Ada
</span><a href="#local-6989586621680971514"><span class="hs-identifier hs-var hs-var">newBid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971513"><span class="annot"><span class="annottext">Address
newBidder :: Address
newBidder :: AuctionInput -&gt; Address
</span><a href="#local-6989586621680971513"><span class="hs-identifier hs-var hs-var">newBidder</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971514"><span class="hs-identifier hs-var">newBid</span></a></span><span> </span><span class="annot"><span class="annottext">Ada -&gt; Ada -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971516"><span class="hs-identifier hs-var">highestBid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- if the new bid is higher,</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680971511"><span class="annot"><span class="annottext">constraints :: TxConstraints Void Void
</span><a href="#local-6989586621680971511"><span class="hs-identifier hs-var hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971516"><span class="hs-identifier hs-var">highestBid</span></a></span><span> </span><span class="annot"><span class="annottext">Ada -&gt; Ada -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Ada
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxConstraints Void Void
forall a. Monoid a =&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-132"></span><span>                    </span><span class="annot"><span class="annottext">Address -&gt; Value -&gt; TxConstraints Void Void
forall i o. Address -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971515"><span class="hs-identifier hs-var">highestBidder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ada -&gt; Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">Ada.toValue</span></a></span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971516"><span class="hs-identifier hs-var">highestBid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- we pay back the previous highest bid</span><span>
</span><span id="line-133"></span><span>                    </span><span class="annot"><span class="annottext">TxConstraints Void Void
-&gt; TxConstraints Void Void -&gt; TxConstraints Void Void
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; TxConstraints Void Void
forall i o. ValidityInterval POSIXTime -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustValidateInTimeRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; ValidityInterval POSIXTime
forall a. a -&gt; ValidityInterval a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Interval.lessThan</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; ValidityInterval POSIXTime)
-&gt; POSIXTime -&gt; ValidityInterval POSIXTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680971523"><span class="hs-identifier hs-var">apEndTime</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- but only if we haven't gone past 'apEndTime'</span><span>
</span><span id="line-134"></span><span>                </span><span id="local-6989586621680971501"><span class="annot"><span class="annottext">newState :: State AuctionState
</span><a href="#local-6989586621680971501"><span class="hs-identifier hs-var hs-var">newState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>                    </span><span class="annot"><span class="annottext">State :: forall s. s -&gt; Value -&gt; State s
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">State</span></a></span><span>
</span><span id="line-136"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stateData :: AuctionState
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">stateData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-var">Ongoing</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid :: Ada -&gt; Address -&gt; HighestBid
</span><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">highestBid :: Ada
</span><a href="Plutus.Contracts.Auction.html#highestBid"><span class="hs-identifier hs-var">highestBid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971514"><span class="hs-identifier hs-var">newBid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">highestBidder :: Address
</span><a href="Plutus.Contracts.Auction.html#highestBidder"><span class="hs-identifier hs-var">highestBidder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971513"><span class="hs-identifier hs-var">newBidder</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-137"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stateValue :: Value
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">stateValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">Value.noAdaValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680971518"><span class="hs-identifier hs-var">oldStateValue</span></a></span><span>
</span><span id="line-138"></span><span>                                    </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ada -&gt; Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">Ada.toValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Ada
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">Ada.fromValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680971518"><span class="hs-identifier hs-var">oldStateValue</span></a></span><span> </span><span class="annot"><span class="annottext">Ada -&gt; Ada -&gt; Ada
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971516"><span class="hs-identifier hs-var">highestBid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>                                    </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Ada -&gt; Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">Ada.toValue</span></a></span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971514"><span class="hs-identifier hs-var">newBid</span></a></span><span> </span><span class="hs-comment">-- and lock the new bid in the script output</span><span>
</span><span id="line-140"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(TxConstraints Void Void, State AuctionState)
-&gt; Maybe (TxConstraints Void Void, State AuctionState)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraints Void Void
</span><a href="#local-6989586621680971511"><span class="hs-identifier hs-var">constraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State AuctionState
</span><a href="#local-6989586621680971501"><span class="hs-identifier hs-var">newState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-type">Ongoing</span></a></span><span> </span><span id="local-6989586621680971497"><span class="annot"><span class="annottext">h :: HighestBid
</span><a href="#local-6989586621680971497"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span class="hs-special">{</span><span id="local-6989586621680971496"><span class="annot"><span class="annottext">Address
highestBidder :: Address
highestBidder :: HighestBid -&gt; Address
</span><a href="#local-6989586621680971496"><span class="hs-identifier hs-var hs-var">highestBidder</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971495"><span class="annot"><span class="annottext">Ada
highestBid :: Ada
highestBid :: HighestBid -&gt; Ada
</span><a href="#local-6989586621680971495"><span class="hs-identifier hs-var hs-var">highestBid</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AuctionInput
</span><a href="Plutus.Contracts.Auction.html#Payout"><span class="hs-identifier hs-var">Payout</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680971494"><span class="annot"><span class="annottext">constraints :: TxConstraints Void Void
</span><a href="#local-6989586621680971494"><span class="hs-identifier hs-var hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>                    </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; TxConstraints Void Void
forall i o. ValidityInterval POSIXTime -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustValidateInTimeRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; ValidityInterval POSIXTime
forall a. a -&gt; ValidityInterval a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Interval.from</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680971523"><span class="hs-identifier hs-var">apEndTime</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- When the auction has ended,</span><span>
</span><span id="line-146"></span><span>                    </span><span class="annot"><span class="annottext">TxConstraints Void Void
-&gt; TxConstraints Void Void -&gt; TxConstraints Void Void
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Value -&gt; TxConstraints Void Void
forall i o. Address -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971525"><span class="hs-identifier hs-var">apOwner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ada -&gt; Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">Ada.toValue</span></a></span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971495"><span class="hs-identifier hs-var">highestBid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- the owner receives the payment</span><span>
</span><span id="line-147"></span><span>                    </span><span class="annot"><span class="annottext">TxConstraints Void Void
-&gt; TxConstraints Void Void -&gt; TxConstraints Void Void
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Value -&gt; TxConstraints Void Void
forall i o. Address -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971496"><span class="hs-identifier hs-var">highestBidder</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680971524"><span class="hs-identifier hs-var">apAsset</span></a></span><span> </span><span class="hs-comment">-- and the highest bidder the asset</span><span>
</span><span id="line-148"></span><span>                </span><span id="local-6989586621680971492"><span class="annot"><span class="annottext">newState :: State AuctionState
</span><a href="#local-6989586621680971492"><span class="hs-identifier hs-var hs-var">newState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State :: forall s. s -&gt; Value -&gt; State s
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stateData :: AuctionState
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">stateData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971497"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stateValue :: Value
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">stateValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(TxConstraints Void Void, State AuctionState)
-&gt; Maybe (TxConstraints Void Void, State AuctionState)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraints Void Void
</span><a href="#local-6989586621680971494"><span class="hs-identifier hs-var">constraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State AuctionState
</span><a href="#local-6989586621680971492"><span class="hs-identifier hs-var">newState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-comment">-- Any other combination of 'AuctionState' and 'AuctionInput' is disallowed.</span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-comment">-- This rules out new bids that don't go over the current highest bid.</span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><span class="annottext">(AuctionState, AuctionInput)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TxConstraints Void Void, State AuctionState)
forall a. Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionStateMachine"><span class="hs-pragma hs-type">auctionStateMachine</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionStateMachine"><span class="hs-identifier hs-type">auctionStateMachine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ThreadToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionMachine"><span class="hs-identifier hs-type">AuctionMachine</span></a></span><span>
</span><span id="line-158"></span><span id="auctionStateMachine"><span class="annot"><span class="annottext">auctionStateMachine :: (ThreadToken, AuctionParams) -&gt; AuctionMachine
</span><a href="Plutus.Contracts.Auction.html#auctionStateMachine"><span class="hs-identifier hs-var hs-var">auctionStateMachine</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971490"><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971490"><span class="hs-identifier hs-var">threadToken</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971489"><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971489"><span class="hs-identifier hs-var">auctionParams</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">Maybe ThreadToken
-&gt; (State AuctionState
    -&gt; AuctionInput
    -&gt; Maybe (TxConstraints Void Void, State AuctionState))
-&gt; (AuctionState -&gt; Bool)
-&gt; AuctionMachine
forall s i.
Maybe ThreadToken
-&gt; (State s -&gt; i -&gt; Maybe (TxConstraints Void Void, State s))
-&gt; (s -&gt; Bool)
-&gt; StateMachine s i
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.mkStateMachine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadToken -&gt; Maybe ThreadToken
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971490"><span class="hs-identifier hs-var">threadToken</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuctionParams
-&gt; State AuctionState
-&gt; AuctionInput
-&gt; Maybe (TxConstraints Void Void, State AuctionState)
</span><a href="Plutus.Contracts.Auction.html#auctionTransition"><span class="hs-identifier hs-var">auctionTransition</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971489"><span class="hs-identifier hs-var">auctionParams</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AuctionState -&gt; Bool
</span><a href="#local-6989586621680971487"><span class="hs-identifier hs-var">isFinal</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621680971487"><span class="annot"><span class="annottext">isFinal :: AuctionState -&gt; Bool
</span><a href="#local-6989586621680971487"><span class="hs-identifier hs-var hs-var">isFinal</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="#local-6989586621680971487"><span class="hs-identifier hs-var">isFinal</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionState
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#mkValidator"><span class="hs-pragma hs-type">mkValidator</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#mkValidator"><span class="hs-identifier hs-type">mkValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ThreadToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">Scripts.ValidatorType</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionMachine"><span class="hs-identifier hs-type">AuctionMachine</span></a></span><span>
</span><span id="line-166"></span><span id="mkValidator"><span class="annot"><span class="annottext">mkValidator :: (ThreadToken, AuctionParams) -&gt; ValidatorType AuctionMachine
</span><a href="Plutus.Contracts.Auction.html#mkValidator"><span class="hs-identifier hs-var hs-var">mkValidator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AuctionMachine
-&gt; AuctionState -&gt; AuctionInput -&gt; ScriptContext -&gt; Bool
forall s i.
ToData s =&gt;
StateMachine s i -&gt; ValidatorType (StateMachine s i)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.mkValidator</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionMachine
 -&gt; AuctionState -&gt; AuctionInput -&gt; ScriptContext -&gt; Bool)
-&gt; ((ThreadToken, AuctionParams) -&gt; AuctionMachine)
-&gt; (ThreadToken, AuctionParams)
-&gt; AuctionState
-&gt; AuctionInput
-&gt; ScriptContext
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ThreadToken, AuctionParams) -&gt; AuctionMachine
</span><a href="Plutus.Contracts.Auction.html#auctionStateMachine"><span class="hs-identifier hs-var">auctionStateMachine</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | The script instance of the auction state machine. It contains the state</span><span>
</span><span id="line-169"></span><span class="hs-comment">--   machine compiled to a Plutus core validator script.</span><span>
</span><span id="line-170"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#typedValidator"><span class="hs-identifier hs-type">typedValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ThreadToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">Scripts.TypedValidator</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionMachine"><span class="hs-identifier hs-type">AuctionMachine</span></a></span><span>
</span><span id="line-171"></span><span id="typedValidator"><span class="annot"><span class="annottext">typedValidator :: (ThreadToken, AuctionParams) -&gt; TypedValidator AuctionMachine
</span><a href="Plutus.Contracts.Auction.html#typedValidator"><span class="hs-identifier hs-var hs-var">typedValidator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompiledCode
  ((ThreadToken, AuctionParams) -&gt; ValidatorType AuctionMachine)
-&gt; CompiledCode (ValidatorType AuctionMachine -&gt; UntypedValidator)
-&gt; (ThreadToken, AuctionParams)
-&gt; TypedValidator AuctionMachine
forall a param.
Lift DefaultUni param =&gt;
CompiledCode (param -&gt; ValidatorType a)
-&gt; CompiledCode (ValidatorType a -&gt; UntypedValidator)
-&gt; param
-&gt; TypedValidator a
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.mkTypedValidatorParam</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionMachine"><span class="hs-identifier hs-type">AuctionMachine</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">mkValidator</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">wrap</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621680971478"><span class="annot"><span class="annottext">wrap :: (AuctionState -&gt; AuctionInput -&gt; ScriptContext -&gt; Bool)
-&gt; UntypedValidator
</span><a href="#local-6989586621680971478"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AuctionState -&gt; AuctionInput -&gt; ScriptContext -&gt; Bool)
-&gt; UntypedValidator
forall sc d r.
(IsScriptContext sc, UnsafeFromData d, UnsafeFromData r) =&gt;
(d -&gt; r -&gt; sc -&gt; Bool) -&gt; UntypedValidator
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.mkUntypedValidator</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | The machine client of the auction state machine. It contains the script instance</span><span>
</span><span id="line-178"></span><span class="hs-comment">--   with the on-chain code, and the Haskell definition of the state machine for</span><span>
</span><span id="line-179"></span><span class="hs-comment">--   off-chain use.</span><span>
</span><span id="line-180"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#machineClient"><span class="hs-identifier hs-type">machineClient</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">Scripts.TypedValidator</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionMachine"><span class="hs-identifier hs-type">AuctionMachine</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ThreadToken</span></a></span><span> </span><span class="hs-comment">-- ^ Thread token of the instance</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">StateMachineClient</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-type">AuctionInput</span></a></span><span>
</span><span id="line-185"></span><span id="machineClient"><span class="annot"><span class="annottext">machineClient :: TypedValidator AuctionMachine
-&gt; ThreadToken
-&gt; AuctionParams
-&gt; StateMachineClient AuctionState AuctionInput
</span><a href="Plutus.Contracts.Auction.html#machineClient"><span class="hs-identifier hs-var hs-var">machineClient</span></a></span></span><span> </span><span id="local-6989586621680971475"><span class="annot"><span class="annottext">TypedValidator AuctionMachine
</span><a href="#local-6989586621680971475"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span id="local-6989586621680971474"><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971474"><span class="hs-identifier hs-var">threadToken</span></a></span></span><span> </span><span id="local-6989586621680971473"><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971473"><span class="hs-identifier hs-var">auctionParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680971472"><span class="annot"><span class="annottext">machine :: AuctionMachine
</span><a href="#local-6989586621680971472"><span class="hs-identifier hs-var hs-var">machine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ThreadToken, AuctionParams) -&gt; AuctionMachine
</span><a href="Plutus.Contracts.Auction.html#auctionStateMachine"><span class="hs-identifier hs-var">auctionStateMachine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971474"><span class="hs-identifier hs-var">threadToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971473"><span class="hs-identifier hs-var">auctionParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">StateMachineInstance AuctionState AuctionInput
-&gt; StateMachineClient AuctionState AuctionInput
forall state input.
StateMachineInstance state input -&gt; StateMachineClient state input
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.mkStateMachineClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuctionMachine
-&gt; TypedValidator AuctionMachine
-&gt; StateMachineInstance AuctionState AuctionInput
forall s i.
StateMachine s i
-&gt; TypedValidator (StateMachine s i) -&gt; StateMachineInstance s i
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.StateMachineInstance</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionMachine
</span><a href="#local-6989586621680971472"><span class="hs-identifier hs-var">machine</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator AuctionMachine
</span><a href="#local-6989586621680971475"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">type</span><span> </span><span id="BuyerSchema"><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerSchema"><span class="hs-identifier hs-var">BuyerSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bid&quot;</span></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Ada</span></a></span><span>
</span><span id="line-190"></span><span class="hs-keyword">type</span><span> </span><span id="SellerSchema"><span class="annot"><a href="Plutus.Contracts.Auction.html#SellerSchema"><span class="hs-identifier hs-var">SellerSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">EmptySchema</span></a></span><span> </span><span class="hs-comment">-- Don't need any endpoints: the contract runs automatically until the auction is finished.</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span id="local-6989586621680971466"><span id="local-6989586621680971467"></span></span><span class="hs-keyword">data</span><span> </span><span id="AuctionLog"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionLog"><span class="hs-identifier hs-var">AuctionLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-193"></span><span>    </span><span id="AuctionStarted"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionStarted"><span class="hs-identifier hs-var">AuctionStarted</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="AuctionFailed"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionFailed"><span class="hs-identifier hs-var">AuctionFailed</span></a></span></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.SMContractError</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="BidSubmitted"><span class="annot"><a href="Plutus.Contracts.Auction.html#BidSubmitted"><span class="hs-identifier hs-var">BidSubmitted</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="AuctionEnded"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionEnded"><span class="hs-identifier hs-var">AuctionEnded</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CurrentStateNotFound"><span class="annot"><a href="Plutus.Contracts.Auction.html#CurrentStateNotFound"><span class="hs-identifier hs-var">CurrentStateNotFound</span></a></span></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TransitionFailed"><span class="annot"><a href="Plutus.Contracts.Auction.html#TransitionFailed"><span class="hs-identifier hs-var">TransitionFailed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.InvalidTransition</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-type">AuctionInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971454"><span id="local-6989586621680971456"><span id="local-6989586621680971458"><span class="annot"><span class="annottext">Int -&gt; AuctionLog -&gt; ShowS
[AuctionLog] -&gt; ShowS
AuctionLog -&gt; String
(Int -&gt; AuctionLog -&gt; ShowS)
-&gt; (AuctionLog -&gt; String)
-&gt; ([AuctionLog] -&gt; ShowS)
-&gt; Show AuctionLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AuctionLog] -&gt; ShowS
$cshowList :: [AuctionLog] -&gt; ShowS
show :: AuctionLog -&gt; String
$cshow :: AuctionLog -&gt; String
showsPrec :: Int -&gt; AuctionLog -&gt; ShowS
$cshowsPrec :: Int -&gt; AuctionLog -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. AuctionLog -&gt; Rep AuctionLog x)
-&gt; (forall x. Rep AuctionLog x -&gt; AuctionLog) -&gt; Generic AuctionLog
forall x. Rep AuctionLog x -&gt; AuctionLog
forall x. AuctionLog -&gt; Rep AuctionLog x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AuctionLog x -&gt; AuctionLog
$cfrom :: forall x. AuctionLog -&gt; Rep AuctionLog x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971444"><span id="local-6989586621680971446"><span id="local-6989586621680971448"><span id="local-6989586621680971450"><span class="annot"><span class="annottext">[AuctionLog] -&gt; Encoding
[AuctionLog] -&gt; Value
AuctionLog -&gt; Encoding
AuctionLog -&gt; Value
(AuctionLog -&gt; Value)
-&gt; (AuctionLog -&gt; Encoding)
-&gt; ([AuctionLog] -&gt; Value)
-&gt; ([AuctionLog] -&gt; Encoding)
-&gt; ToJSON AuctionLog
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AuctionLog] -&gt; Encoding
$ctoEncodingList :: [AuctionLog] -&gt; Encoding
toJSONList :: [AuctionLog] -&gt; Value
$ctoJSONList :: [AuctionLog] -&gt; Value
toEncoding :: AuctionLog -&gt; Encoding
$ctoEncoding :: AuctionLog -&gt; Encoding
toJSON :: AuctionLog -&gt; Value
$ctoJSON :: AuctionLog -&gt; Value
</span><a href="#local-6989586621680971444"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971440"><span id="local-6989586621680971442"><span class="annot"><span class="annottext">Value -&gt; Parser [AuctionLog]
Value -&gt; Parser AuctionLog
(Value -&gt; Parser AuctionLog)
-&gt; (Value -&gt; Parser [AuctionLog]) -&gt; FromJSON AuctionLog
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AuctionLog]
$cparseJSONList :: Value -&gt; Parser [AuctionLog]
parseJSON :: Value -&gt; Parser AuctionLog
$cparseJSON :: Value -&gt; Parser AuctionLog
</span><a href="#local-6989586621680971440"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621680971438"><span id="local-6989586621680971439"></span></span><span class="hs-keyword">data</span><span> </span><span id="AuctionError"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-var">AuctionError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>    </span><span id="StateMachineContractError"><span class="annot"><a href="Plutus.Contracts.Auction.html#StateMachineContractError"><span class="hs-identifier hs-var">StateMachineContractError</span></a></span></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.SMContractError</span></a></span><span> </span><span class="hs-comment">-- ^ State machine operation failed</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="AuctionContractError"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionContractError"><span class="hs-identifier hs-var">AuctionContractError</span></a></span></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractError</span></a></span><span> </span><span class="hs-comment">-- ^ Endpoint, coin selection, etc. failed</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971432"><span id="local-6989586621680971434"><span class="annot"><span class="annottext">AuctionError -&gt; AuctionError -&gt; Bool
(AuctionError -&gt; AuctionError -&gt; Bool)
-&gt; (AuctionError -&gt; AuctionError -&gt; Bool) -&gt; Eq AuctionError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AuctionError -&gt; AuctionError -&gt; Bool
$c/= :: AuctionError -&gt; AuctionError -&gt; Bool
== :: AuctionError -&gt; AuctionError -&gt; Bool
$c== :: AuctionError -&gt; AuctionError -&gt; Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971426"><span id="local-6989586621680971428"><span id="local-6989586621680971430"><span class="annot"><span class="annottext">Int -&gt; AuctionError -&gt; ShowS
[AuctionError] -&gt; ShowS
AuctionError -&gt; String
(Int -&gt; AuctionError -&gt; ShowS)
-&gt; (AuctionError -&gt; String)
-&gt; ([AuctionError] -&gt; ShowS)
-&gt; Show AuctionError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AuctionError] -&gt; ShowS
$cshowList :: [AuctionError] -&gt; ShowS
show :: AuctionError -&gt; String
$cshow :: AuctionError -&gt; String
showsPrec :: Int -&gt; AuctionError -&gt; ShowS
$cshowsPrec :: Int -&gt; AuctionError -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. AuctionError -&gt; Rep AuctionError x)
-&gt; (forall x. Rep AuctionError x -&gt; AuctionError)
-&gt; Generic AuctionError
forall x. Rep AuctionError x -&gt; AuctionError
forall x. AuctionError -&gt; Rep AuctionError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AuctionError x -&gt; AuctionError
$cfrom :: forall x. AuctionError -&gt; Rep AuctionError x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680971416"><span id="local-6989586621680971418"><span id="local-6989586621680971420"><span id="local-6989586621680971422"><span class="annot"><span class="annottext">[AuctionError] -&gt; Encoding
[AuctionError] -&gt; Value
AuctionError -&gt; Encoding
AuctionError -&gt; Value
(AuctionError -&gt; Value)
-&gt; (AuctionError -&gt; Encoding)
-&gt; ([AuctionError] -&gt; Value)
-&gt; ([AuctionError] -&gt; Encoding)
-&gt; ToJSON AuctionError
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AuctionError] -&gt; Encoding
$ctoEncodingList :: [AuctionError] -&gt; Encoding
toJSONList :: [AuctionError] -&gt; Value
$ctoJSONList :: [AuctionError] -&gt; Value
toEncoding :: AuctionError -&gt; Encoding
$ctoEncoding :: AuctionError -&gt; Encoding
toJSON :: AuctionError -&gt; Value
$ctoJSON :: AuctionError -&gt; Value
</span><a href="#local-6989586621680971416"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680971412"><span id="local-6989586621680971414"><span class="annot"><span class="annottext">Value -&gt; Parser [AuctionError]
Value -&gt; Parser AuctionError
(Value -&gt; Parser AuctionError)
-&gt; (Value -&gt; Parser [AuctionError]) -&gt; FromJSON AuctionError
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AuctionError]
$cparseJSONList :: Value -&gt; Parser [AuctionError]
parseJSON :: Value -&gt; Parser AuctionError
$cparseJSON :: Value -&gt; Parser AuctionError
</span><a href="#local-6989586621680971412"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span id="_AuctionContractError"><span id="_StateMachineContractError"><span id="_AuctionError"><span id="local-6989586621680971404"><span id="local-6989586621680971406"><span id="local-6989586621680971408"><span id="local-6989586621680971410"><span id="local-6989586621680971411"><span id="AsAuctionError"><span id="local-6989586621680971920"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">AuctionError</span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680971379"><span id="local-6989586621680971381"><span id="local-6989586621680971383"><span id="local-6989586621680971385"><span id="local-6989586621680971387"><span id="local-6989586621680971389"><span id="local-6989586621680971391"><span id="local-6989586621680971393"><span id="local-6989586621680971395"><span id="local-6989586621680971397"><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">AsContractError</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-type">AuctionError</span></a></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621680971377"><span class="annot"><span class="annottext">_ContractError :: p ContractError (f ContractError)
-&gt; p AuctionError (f AuctionError)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">_ContractError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p ContractError (f ContractError)
-&gt; p AuctionError (f AuctionError)
forall r. AsAuctionError r =&gt; Prism' r ContractError
</span><a href="Plutus.Contracts.Auction.html#_AuctionContractError"><span class="hs-identifier hs-var">_AuctionContractError</span></a></span><span> </span><span class="annot"><span class="annottext">(p ContractError (f ContractError)
 -&gt; p AuctionError (f AuctionError))
-&gt; (p ContractError (f ContractError)
    -&gt; p ContractError (f ContractError))
-&gt; p ContractError (f ContractError)
-&gt; p AuctionError (f AuctionError)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">p ContractError (f ContractError)
-&gt; p ContractError (f ContractError)
forall r. AsContractError r =&gt; Prism' r ContractError
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">_ContractError</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680971369"><span id="local-6989586621680971371"><span id="local-6989586621680971373"><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.AsSMContractError</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-type">AuctionError</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621680971367"><span class="annot"><span class="annottext">_SMContractError :: p SMContractError (f SMContractError)
-&gt; p AuctionError (f AuctionError)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">_SMContractError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p SMContractError (f SMContractError)
-&gt; p AuctionError (f AuctionError)
forall r. AsAuctionError r =&gt; Prism' r SMContractError
</span><a href="Plutus.Contracts.Auction.html#_StateMachineContractError"><span class="hs-identifier hs-var">_StateMachineContractError</span></a></span><span> </span><span class="annot"><span class="annottext">(p SMContractError (f SMContractError)
 -&gt; p AuctionError (f AuctionError))
-&gt; (p SMContractError (f SMContractError)
    -&gt; p SMContractError (f SMContractError))
-&gt; p SMContractError (f SMContractError)
-&gt; p AuctionError (f AuctionError)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">p SMContractError (f SMContractError)
-&gt; p SMContractError (f SMContractError)
forall r. AsSMContractError r =&gt; Prism' r SMContractError
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM._SMContractError</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | Client code for the seller</span><span>
</span><span id="line-217"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionSeller"><span class="hs-identifier hs-type">auctionSeller</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">POSIXTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#SellerSchema"><span class="hs-identifier hs-type">SellerSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-type">AuctionError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span id="auctionSeller"><span class="annot"><span class="annottext">auctionSeller :: Value
-&gt; POSIXTime -&gt; Contract AuctionOutput SellerSchema AuctionError ()
</span><a href="Plutus.Contracts.Auction.html#auctionSeller"><span class="hs-identifier hs-var hs-var">auctionSeller</span></a></span></span><span> </span><span id="local-6989586621680971365"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680971365"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span id="local-6989586621680971364"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680971364"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621680971363"><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971363"><span class="hs-identifier hs-var">threadToken</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Contract AuctionOutput SellerSchema AuctionError ThreadToken
forall e w (schema :: Row *).
AsSMContractError e =&gt;
Contract w schema e ThreadToken
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.getThreadToken</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="annottext">AuctionOutput
-&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionOutput
 -&gt; Contract AuctionOutput SellerSchema AuctionError ())
-&gt; AuctionOutput
-&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken -&gt; AuctionOutput
</span><a href="Plutus.Contracts.Auction.html#threadTokenOut"><span class="hs-identifier hs-var">threadTokenOut</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971363"><span class="hs-identifier hs-var">threadToken</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621680971361"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971361"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AddressInEra BabbageEra -&gt; Address
forall era. AddressInEra era -&gt; Address
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">toPlutusAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressInEra BabbageEra -&gt; Address)
-&gt; Contract
     AuctionOutput SellerSchema AuctionError (AddressInEra BabbageEra)
-&gt; Contract AuctionOutput SellerSchema AuctionError Address
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput SellerSchema AuctionError (AddressInEra BabbageEra)
forall w (s :: Row *) e.
AsContractError e =&gt;
Contract w s e (AddressInEra BabbageEra)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">ownAddress</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680971358"><span class="annot"><span class="annottext">params :: AuctionParams
</span><a href="#local-6989586621680971358"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AuctionParams :: Address -&gt; Value -&gt; POSIXTime -&gt; AuctionParams
</span><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">apOwner :: Address
</span><a href="Plutus.Contracts.Auction.html#apOwner"><span class="hs-identifier hs-var">apOwner</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971361"><span class="hs-identifier hs-var">self</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">apAsset :: Value
</span><a href="Plutus.Contracts.Auction.html#apAsset"><span class="hs-identifier hs-var">apAsset</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680971365"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">apEndTime :: POSIXTime
</span><a href="Plutus.Contracts.Auction.html#apEndTime"><span class="hs-identifier hs-var">apEndTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680971364"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>        </span><span id="local-6989586621680971357"><span class="annot"><span class="annottext">inst :: TypedValidator AuctionMachine
</span><a href="#local-6989586621680971357"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ThreadToken, AuctionParams) -&gt; TypedValidator AuctionMachine
</span><a href="Plutus.Contracts.Auction.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971363"><span class="hs-identifier hs-var">threadToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971358"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>        </span><span id="local-6989586621680971356"><span class="annot"><span class="annottext">client :: StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971356"><span class="hs-identifier hs-var hs-var">client</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator AuctionMachine
-&gt; ThreadToken
-&gt; AuctionParams
-&gt; StateMachineClient AuctionState AuctionInput
</span><a href="Plutus.Contracts.Auction.html#machineClient"><span class="hs-identifier hs-var">machineClient</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator AuctionMachine
</span><a href="#local-6989586621680971357"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971363"><span class="hs-identifier hs-var">threadToken</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971358"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><span class="annottext">AuctionState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SMContractError
 -&gt; Contract AuctionOutput SellerSchema AuctionError AuctionState)
-&gt; Contract AuctionOutput SellerSchema SMContractError AuctionState
-&gt; Contract AuctionOutput SellerSchema AuctionError AuctionState
forall w (s :: Row *) e e' a.
(e -&gt; Contract w s e' a) -&gt; Contract w s e a -&gt; Contract w s e' a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">handleError</span></a></span><span>
</span><span id="line-227"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680971354"><span class="annot"><span class="annottext">SMContractError
</span><a href="#local-6989586621680971354"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">AuctionLog -&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMContractError -&gt; AuctionLog
</span><a href="Plutus.Contracts.Auction.html#AuctionFailed"><span class="hs-identifier hs-var">AuctionFailed</span></a></span><span> </span><span class="annot"><span class="annottext">SMContractError
</span><a href="#local-6989586621680971354"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">AuctionError
-&gt; Contract AuctionOutput SellerSchema AuctionError AuctionState
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SMContractError -&gt; AuctionError
</span><a href="Plutus.Contracts.Auction.html#StateMachineContractError"><span class="hs-identifier hs-var">StateMachineContractError</span></a></span><span> </span><span class="annot"><span class="annottext">SMContractError
</span><a href="#local-6989586621680971354"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; AuctionState
-&gt; Value
-&gt; Contract AuctionOutput SellerSchema SMContractError AuctionState
forall w e state (schema :: Row *) input.
(FromData state, ToData state, ToData input,
 AsSMContractError e) =&gt;
StateMachineClient state input
-&gt; state -&gt; Value -&gt; Contract w schema e state
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.runInitialise</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971356"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#initialState"><span class="hs-identifier hs-var">initialState</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971361"><span class="hs-identifier hs-var">self</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680971365"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">AuctionLog -&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionLog -&gt; Contract AuctionOutput SellerSchema AuctionError ())
-&gt; AuctionLog
-&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionParams -&gt; AuctionLog
</span><a href="Plutus.Contracts.Auction.html#AuctionStarted"><span class="hs-identifier hs-var">AuctionStarted</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971358"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">POSIXTime
-&gt; Contract AuctionOutput SellerSchema AuctionError POSIXTime
forall w (s :: Row *) e.
AsContractError e =&gt;
POSIXTime -&gt; Contract w s e POSIXTime
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">awaitTime</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680971364"><span class="hs-identifier hs-var">time</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621680971348"><span class="annot"><span class="annottext">TransitionResult AuctionState AuctionInput
</span><a href="#local-6989586621680971348"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; AuctionInput
-&gt; Contract
     AuctionOutput
     SellerSchema
     AuctionError
     (TransitionResult AuctionState AuctionInput)
forall w e state (schema :: Row *) input.
(AsSMContractError e, FromData state, ToData state,
 ToData input) =&gt;
StateMachineClient state input
-&gt; input -&gt; Contract w schema e (TransitionResult state input)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.runStep</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971356"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionInput
</span><a href="Plutus.Contracts.Auction.html#Payout"><span class="hs-identifier hs-var">Payout</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransitionResult AuctionState AuctionInput
</span><a href="#local-6989586621680971348"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.TransitionFailure</span></a></span><span> </span><span id="local-6989586621680971345"><span class="annot"><span class="annottext">InvalidTransition AuctionState AuctionInput
</span><a href="#local-6989586621680971345"><span class="hs-identifier hs-var">i</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionLog -&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidTransition AuctionState AuctionInput -&gt; AuctionLog
</span><a href="Plutus.Contracts.Auction.html#TransitionFailed"><span class="hs-identifier hs-var">TransitionFailed</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidTransition AuctionState AuctionInput
</span><a href="#local-6989586621680971345"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Add an endpoint &quot;retry&quot; to the seller?</span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.TransitionSuccess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Auction.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span id="local-6989586621680971343"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971343"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionLog -&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionLog -&gt; Contract AuctionOutput SellerSchema AuctionError ())
-&gt; AuctionLog
-&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionLog
</span><a href="Plutus.Contracts.Auction.html#AuctionEnded"><span class="hs-identifier hs-var">AuctionEnded</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971343"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-237"></span><span>        </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.TransitionSuccess</span></a></span><span> </span><span id="local-6989586621680971342"><span class="annot"><span class="annottext">AuctionState
</span><a href="#local-6989586621680971342"><span class="hs-identifier hs-var">s</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Contract AuctionOutput SellerSchema AuctionError ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logWarn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected state after Payout transition: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionState -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.show</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionState
</span><a href="#local-6989586621680971342"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- | Get the current state of the contract and log it.</span><span>
</span><span id="line-241"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#currentState"><span class="hs-identifier hs-type">currentState</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">StateMachineClient</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-type">AuctionInput</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerSchema"><span class="hs-identifier hs-type">BuyerSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-type">AuctionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span id="currentState"><span class="annot"><span class="annottext">currentState :: StateMachineClient AuctionState AuctionInput
-&gt; Contract
     AuctionOutput BuyerSchema AuctionError (Maybe HighestBid)
</span><a href="Plutus.Contracts.Auction.html#currentState"><span class="hs-identifier hs-var hs-var">currentState</span></a></span></span><span> </span><span id="local-6989586621680971338"><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971338"><span class="hs-identifier hs-var">client</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621680971337"><span class="annot"><span class="annottext">Maybe
  (OnChainState AuctionState AuctionInput,
   Map TxOutRef DecoratedTxOut)
</span><a href="#local-6989586621680971337"><span class="hs-identifier hs-var">mOcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SMContractError -&gt; AuctionError)
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     SMContractError
     (Maybe
        (OnChainState AuctionState AuctionInput,
         Map TxOutRef DecoratedTxOut))
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Maybe
        (OnChainState AuctionState AuctionInput,
         Map TxOutRef DecoratedTxOut))
forall w (s :: Row *) e e' a.
(e -&gt; e') -&gt; Contract w s e a -&gt; Contract w s e' a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mapError</span></a></span><span> </span><span class="annot"><span class="annottext">SMContractError -&gt; AuctionError
</span><a href="Plutus.Contracts.Auction.html#StateMachineContractError"><span class="hs-identifier hs-var">StateMachineContractError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     SMContractError
     (Maybe
        (OnChainState AuctionState AuctionInput,
         Map TxOutRef DecoratedTxOut))
forall e state i w (schema :: Row *).
(AsSMContractError e, FromData state, ToData state) =&gt;
StateMachineClient state i
-&gt; Contract
     w
     schema
     e
     (Maybe (OnChainState state i, Map TxOutRef DecoratedTxOut))
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.getOnChainState</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971338"><span class="hs-identifier hs-var">client</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe
  (OnChainState AuctionState AuctionInput,
   Map TxOutRef DecoratedTxOut)
</span><a href="#local-6989586621680971337"><span class="hs-identifier hs-var">mOcs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnChainState AuctionState AuctionInput -&gt; AuctionState
forall s i. OnChainState s i -&gt; s
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.getStateData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-type">Ongoing</span></a></span><span> </span><span id="local-6989586621680971333"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971333"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><span class="annottext">AuctionOutput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionOutput
 -&gt; Contract
      AuctionOutput
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      ())
-&gt; AuctionOutput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionState -&gt; AuctionOutput
</span><a href="Plutus.Contracts.Auction.html#auctionStateOut"><span class="hs-identifier hs-var">auctionStateOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionState -&gt; AuctionOutput) -&gt; AuctionState -&gt; AuctionOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-var">Ongoing</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971333"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><span class="annottext">Maybe HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Maybe HighestBid)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighestBid -&gt; Maybe HighestBid
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971333"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (OnChainState AuctionState AuctionInput,
   Map TxOutRef DecoratedTxOut)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">AuctionLog
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logWarn</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionLog
</span><a href="Plutus.Contracts.Auction.html#CurrentStateNotFound"><span class="hs-identifier hs-var">CurrentStateNotFound</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="annottext">Maybe HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Maybe HighestBid)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HighestBid
forall a. Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">{- Note [Buyer client]

In the buyer client we want to keep track of the on-chain state of the auction
to give our user a chance to react if they are outbid by somebody else.

At the same time we want to have the &quot;bid&quot; endpoint active for any bids of our
own, and we want to stop the client when the auction is over.

To achieve this, we have a loop where we wait for one of several events to
happen and then deal with the event. The waiting is implemented in
@waitForChange@ and the event handling is in @handleEvent@.

Updates to the user are provided via 'tell'.

-}</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-keyword">data</span><span> </span><span id="BuyerEvent"><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerEvent"><span class="hs-identifier hs-var">BuyerEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>        </span><span id="AuctionIsOver"><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionIsOver"><span class="hs-identifier hs-var">AuctionIsOver</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span> </span><span class="hs-comment">-- ^ The auction has ended with the highest bid</span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="SubmitOwnBid"><span class="annot"><a href="Plutus.Contracts.Auction.html#SubmitOwnBid"><span class="hs-identifier hs-var">SubmitOwnBid</span></a></span></span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Ada</span></a></span><span> </span><span class="hs-comment">-- ^ We want to submit a new bid</span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="OtherBid"><span class="annot"><a href="Plutus.Contracts.Auction.html#OtherBid"><span class="hs-identifier hs-var">OtherBid</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span> </span><span class="hs-comment">-- ^ Another buyer submitted a higher bid</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="NoChange"><span class="annot"><a href="Plutus.Contracts.Auction.html#NoChange"><span class="hs-identifier hs-var">NoChange</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span> </span><span class="hs-comment">-- ^ Nothing has changed</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#waitForChange"><span class="hs-identifier hs-type">waitForChange</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">StateMachineClient</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-type">AuctionInput</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerSchema"><span class="hs-identifier hs-type">BuyerSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-type">AuctionError</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerEvent"><span class="hs-identifier hs-type">BuyerEvent</span></a></span><span>
</span><span id="line-281"></span><span id="waitForChange"><span class="annot"><span class="annottext">waitForChange :: AuctionParams
-&gt; StateMachineClient AuctionState AuctionInput
-&gt; HighestBid
-&gt; Contract AuctionOutput BuyerSchema AuctionError BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#waitForChange"><span class="hs-identifier hs-var hs-var">waitForChange</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680971326"><span class="annot"><span class="annottext">POSIXTime
apEndTime :: POSIXTime
apEndTime :: AuctionParams -&gt; POSIXTime
</span><a href="#local-6989586621680971326"><span class="hs-identifier hs-var hs-var">apEndTime</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680971325"><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971325"><span class="hs-identifier hs-var">client</span></a></span></span><span> </span><span id="local-6989586621680971324"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971324"><span class="hs-identifier hs-var">lastHighestBid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-comment">-- Create a Promise that waits for either an update to the state machine's</span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- on chain state, or until the end of the auction</span><span>
</span><span id="line-284"></span><span>    </span><span id="local-6989586621680971323"><span class="annot"><span class="annottext">Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (WaitingResult
     POSIXTime AuctionInput (OnChainState AuctionState AuctionInput))
</span><a href="#local-6989586621680971323"><span class="hs-identifier hs-var">smUpdatePromise</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; Promise
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     POSIXTime
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Promise
        AuctionOutput
        ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
        AuctionError
        (WaitingResult
           POSIXTime AuctionInput (OnChainState AuctionState AuctionInput)))
forall state i t w (schema :: Row *) e.
(AsSMContractError e, AsContractError e, FromData state,
 ToData state, FromData i) =&gt;
StateMachineClient state i
-&gt; Promise w schema e t
-&gt; Contract
     w
     schema
     e
     (Promise w schema e (WaitingResult t i (OnChainState state i)))
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.waitForUpdateTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971325"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
-&gt; Promise
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     POSIXTime
forall w (s :: Row *) e.
AsContractError e =&gt;
POSIXTime -&gt; Promise w s e POSIXTime
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">isTime</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680971326"><span class="hs-identifier hs-var">apEndTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-287"></span><span>        </span><span id="local-6989586621680971320"><span class="annot"><span class="annottext">auctionOver :: Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
</span><a href="#local-6989586621680971320"><span class="hs-identifier hs-var hs-var">auctionOver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#AuctionIsOver"><span class="hs-identifier hs-var">AuctionIsOver</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971324"><span class="hs-identifier hs-var">lastHighestBid</span></a></span><span> </span><span class="annot"><span class="annottext">BuyerEvent
-&gt; Promise
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     POSIXTime
-&gt; Promise
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">Haskell.&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
-&gt; Promise
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     POSIXTime
forall w (s :: Row *) e.
AsContractError e =&gt;
POSIXTime -&gt; Promise w s e POSIXTime
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">isTime</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680971326"><span class="hs-identifier hs-var">apEndTime</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621680971318"><span class="annot"><span class="annottext">submitOwnBid :: Promise
  w
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
</span><a href="#local-6989586621680971318"><span class="hs-identifier hs-var hs-var">submitOwnBid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e b.
(HasEndpoint &quot;bid&quot; a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">endpoint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;bid&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Ada
  -&gt; Contract
       w
       ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
       AuctionError
       BuyerEvent)
 -&gt; Promise
      w
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      BuyerEvent)
-&gt; (Ada
    -&gt; Contract
         w
         ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
         AuctionError
         BuyerEvent)
-&gt; Promise
     w
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BuyerEvent
-&gt; Contract
     w
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(BuyerEvent
 -&gt; Contract
      w
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      BuyerEvent)
-&gt; (Ada -&gt; BuyerEvent)
-&gt; Ada
-&gt; Contract
     w
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ada -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#SubmitOwnBid"><span class="hs-identifier hs-var">SubmitOwnBid</span></a></span><span>
</span><span id="line-289"></span><span>        </span><span id="local-6989586621680971316"><span class="annot"><span class="annottext">otherBid :: Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
</span><a href="#local-6989586621680971316"><span class="hs-identifier hs-var hs-var">otherBid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>            </span><span class="annot"><span class="annottext">Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (WaitingResult
     POSIXTime AuctionInput (OnChainState AuctionState AuctionInput))
-&gt; (WaitingResult
      POSIXTime AuctionInput (OnChainState AuctionState AuctionInput)
    -&gt; Contract
         AuctionOutput
         ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
         AuctionError
         BuyerEvent)
-&gt; Promise
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall w (s :: Row *) e a b.
Promise w s e a -&gt; (a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">promiseBind</span></a></span><span>
</span><span id="line-291"></span><span>                </span><span class="annot"><span class="annottext">Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (WaitingResult
     POSIXTime AuctionInput (OnChainState AuctionState AuctionInput))
</span><a href="#local-6989586621680971323"><span class="hs-identifier hs-var">smUpdatePromise</span></a></span><span>
</span><span id="line-292"></span><span>                </span><span class="annot"><span class="annottext">((WaitingResult
    POSIXTime AuctionInput (OnChainState AuctionState AuctionInput)
  -&gt; Contract
       AuctionOutput
       ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
       AuctionError
       BuyerEvent)
 -&gt; Promise
      AuctionOutput
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      BuyerEvent)
-&gt; (WaitingResult
      POSIXTime AuctionInput (OnChainState AuctionState AuctionInput)
    -&gt; Contract
         AuctionOutput
         ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
         AuctionError
         BuyerEvent)
-&gt; Promise
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-293"></span><span>                  </span><span class="hs-comment">-- If the state machine instance ended, then the auction is over.</span><span>
</span><span id="line-294"></span><span>                  </span><span class="hs-comment">-- In this case match, 'currentState client' should always be</span><span>
</span><span id="line-295"></span><span>                  </span><span class="hs-comment">-- 'Nothing'.</span><span>
</span><span id="line-296"></span><span>                  </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractEnded</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuyerEvent
-&gt; (HighestBid -&gt; BuyerEvent) -&gt; Maybe HighestBid -&gt; BuyerEvent
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighestBid -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#AuctionIsOver"><span class="hs-identifier hs-var">AuctionIsOver</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971324"><span class="hs-identifier hs-var">lastHighestBid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#OtherBid"><span class="hs-identifier hs-var">OtherBid</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe HighestBid -&gt; BuyerEvent)
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Maybe HighestBid)
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; Contract
     AuctionOutput BuyerSchema AuctionError (Maybe HighestBid)
</span><a href="Plutus.Contracts.Auction.html#currentState"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971325"><span class="hs-identifier hs-var">client</span></a></span><span>
</span><span id="line-297"></span><span>                  </span><span class="hs-comment">-- The state machine transitionned to a new state</span><span>
</span><span id="line-298"></span><span>                  </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>                    </span><span id="local-6989586621680971311"><span class="annot"><span class="annottext">Maybe HighestBid
</span><a href="#local-6989586621680971311"><span class="hs-identifier hs-var">highestBidMaybe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; Contract
     AuctionOutput BuyerSchema AuctionError (Maybe HighestBid)
</span><a href="Plutus.Contracts.Auction.html#currentState"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971325"><span class="hs-identifier hs-var">client</span></a></span><span>
</span><span id="line-300"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HighestBid
</span><a href="#local-6989586621680971311"><span class="hs-identifier hs-var">highestBidMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>                      </span><span class="hs-comment">-- If there is no current state, then the auction is over.</span><span>
</span><span id="line-302"></span><span>                      </span><span class="annot"><span class="annottext">Maybe HighestBid
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuyerEvent
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(BuyerEvent
 -&gt; Contract
      AuctionOutput
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      BuyerEvent)
-&gt; BuyerEvent
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#AuctionIsOver"><span class="hs-identifier hs-var">AuctionIsOver</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971324"><span class="hs-identifier hs-var">lastHighestBid</span></a></span><span>
</span><span id="line-303"></span><span>                      </span><span class="hs-comment">-- If the next state transition contains a new state,</span><span>
</span><span id="line-304"></span><span>                      </span><span class="hs-comment">-- there is either no change to the current bid, or there</span><span>
</span><span id="line-305"></span><span>                      </span><span class="hs-comment">-- is a new bid emitted by another wallet.</span><span>
</span><span id="line-306"></span><span>                      </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680971310"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971310"><span class="hs-identifier hs-var">highestBid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971310"><span class="hs-identifier hs-var">highestBid</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; HighestBid -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">Haskell.==</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971324"><span class="hs-identifier hs-var">lastHighestBid</span></a></span><span>
</span><span id="line-308"></span><span>                           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BuyerEvent
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighestBid -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#NoChange"><span class="hs-identifier hs-var">NoChange</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971310"><span class="hs-identifier hs-var">highestBid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BuyerEvent
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighestBid -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#OtherBid"><span class="hs-identifier hs-var">OtherBid</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971310"><span class="hs-identifier hs-var">highestBid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>                  </span><span class="annot"><span class="annottext">WaitingResult
  POSIXTime AuctionInput (OnChainState AuctionState AuctionInput)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuyerEvent
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighestBid -&gt; BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#NoChange"><span class="hs-identifier hs-var">NoChange</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971324"><span class="hs-identifier hs-var">lastHighestBid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-comment">-- see note [Buyer client]</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- Also note that the order of the promises in the list is important. When</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- the auction is over, both 'auctionOver' and 'otherBid' contracts can be</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-comment">-- fully executed. However, if 'otherBid' is at the beginning of the list,</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-comment">-- it will return &quot;NoChange&quot; event before returning &quot;AuctionIsOver&quot;. Thus</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">-- the auction never ends and it results in an infinite loop.</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><span class="annottext">[Promise
   AuctionOutput
   ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
   AuctionError
   BuyerEvent]
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     BuyerEvent
forall w (s :: Row *) e a. [Promise w s e a] -&gt; Contract w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">selectList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
</span><a href="#local-6989586621680971320"><span class="hs-identifier hs-var">auctionOver</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
forall w.
Promise
  w
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
</span><a href="#local-6989586621680971318"><span class="hs-identifier hs-var">submitOwnBid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Promise
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
</span><a href="#local-6989586621680971316"><span class="hs-identifier hs-var">otherBid</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#handleEvent"><span class="hs-identifier hs-type">handleEvent</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">StateMachineClient</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionState"><span class="hs-identifier hs-type">AuctionState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionInput"><span class="hs-identifier hs-type">AuctionInput</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerEvent"><span class="hs-identifier hs-type">BuyerEvent</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerSchema"><span class="hs-identifier hs-type">BuyerSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-type">AuctionError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#HighestBid"><span class="hs-identifier hs-type">HighestBid</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span id="handleEvent"><span class="annot"><span class="annottext">handleEvent :: StateMachineClient AuctionState AuctionInput
-&gt; HighestBid
-&gt; BuyerEvent
-&gt; Contract
     AuctionOutput BuyerSchema AuctionError (Either HighestBid ())
</span><a href="Plutus.Contracts.Auction.html#handleEvent"><span class="hs-identifier hs-var hs-var">handleEvent</span></a></span></span><span> </span><span id="local-6989586621680971307"><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971307"><span class="hs-identifier hs-var">client</span></a></span></span><span> </span><span id="local-6989586621680971306"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971306"><span class="hs-identifier hs-var">lastHighestBid</span></a></span></span><span> </span><span id="local-6989586621680971305"><span class="annot"><span class="annottext">BuyerEvent
</span><a href="#local-6989586621680971305"><span class="hs-identifier hs-var">change</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680971304"><span class="annot"><span class="annottext">continue :: a
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a b)
</span><a href="#local-6989586621680971304"><span class="hs-identifier hs-var hs-var">continue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a b
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a b)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a b
 -&gt; Contract
      AuctionOutput
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      (Either a b))
-&gt; (a -&gt; Either a b)
-&gt; a
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Either a b
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span id="local-6989586621680971303"><span class="annot"><span class="annottext">stop :: Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (Either a ())
</span><a href="#local-6989586621680971303"><span class="hs-identifier hs-var hs-var">stop</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a ()
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Either a ()
forall a b. b -&gt; Either a b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-comment">-- see note [Buyer client]</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuyerEvent
</span><a href="#local-6989586621680971305"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionIsOver"><span class="hs-identifier hs-type">AuctionIsOver</span></a></span><span> </span><span id="local-6989586621680971302"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971302"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionOutput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuctionState -&gt; AuctionOutput
</span><a href="Plutus.Contracts.Auction.html#auctionStateOut"><span class="hs-identifier hs-var">auctionStateOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionState -&gt; AuctionOutput) -&gt; AuctionState -&gt; AuctionOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971302"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  ()
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (Either HighestBid ())
forall a.
Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (Either a ())
</span><a href="#local-6989586621680971303"><span class="hs-identifier hs-var">stop</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><a href="Plutus.Contracts.Auction.html#SubmitOwnBid"><span class="hs-identifier hs-type">SubmitOwnBid</span></a></span><span> </span><span id="local-6989586621680971301"><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971301"><span class="hs-identifier hs-var">ada</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="annottext">String
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Haskell.String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Submitting bid&quot;</span></span><span>
</span><span id="line-334"></span><span>            </span><span id="local-6989586621680971300"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971300"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AddressInEra BabbageEra -&gt; Address
forall era. AddressInEra era -&gt; Address
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">toPlutusAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressInEra BabbageEra -&gt; Address)
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (AddressInEra BabbageEra)
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     Address
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (AddressInEra BabbageEra)
forall w (s :: Row *) e.
AsContractError e =&gt;
Contract w s e (AddressInEra BabbageEra)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">ownAddress</span></a></span><span>
</span><span id="line-335"></span><span>            </span><span class="annot"><span class="annottext">String
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Haskell.String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Received address&quot;</span></span><span>
</span><span id="line-336"></span><span>            </span><span id="local-6989586621680971299"><span class="annot"><span class="annottext">TransitionResult AuctionState AuctionInput
</span><a href="#local-6989586621680971299"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; AuctionInput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (TransitionResult AuctionState AuctionInput)
forall w e state (schema :: Row *) input.
(AsSMContractError e, FromData state, ToData state,
 ToData input) =&gt;
StateMachineClient state input
-&gt; input -&gt; Contract w schema e (TransitionResult state input)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.runStep</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971307"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">Bid :: Ada -&gt; Address -&gt; AuctionInput
</span><a href="Plutus.Contracts.Auction.html#Bid"><span class="hs-identifier hs-type">Bid</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">newBid :: Ada
</span><a href="Plutus.Contracts.Auction.html#newBid"><span class="hs-identifier hs-var">newBid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ada
</span><a href="#local-6989586621680971301"><span class="hs-identifier hs-var">ada</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">newBidder :: Address
</span><a href="Plutus.Contracts.Auction.html#newBidder"><span class="hs-identifier hs-var">newBidder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621680971300"><span class="hs-identifier hs-var">self</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-337"></span><span>            </span><span class="annot"><span class="annottext">String
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Haskell.String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SM: runStep done&quot;</span></span><span>
</span><span id="line-338"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransitionResult AuctionState AuctionInput
</span><a href="#local-6989586621680971299"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-339"></span><span>                </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.TransitionFailure</span></a></span><span> </span><span id="local-6989586621680971298"><span class="annot"><span class="annottext">InvalidTransition AuctionState AuctionInput
</span><a href="#local-6989586621680971298"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionLog
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidTransition AuctionState AuctionInput -&gt; AuctionLog
</span><a href="Plutus.Contracts.Auction.html#TransitionFailed"><span class="hs-identifier hs-var">TransitionFailed</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidTransition AuctionState AuctionInput
</span><a href="#local-6989586621680971298"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  ()
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall a b.
a
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a b)
</span><a href="#local-6989586621680971304"><span class="hs-identifier hs-var">continue</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971306"><span class="hs-identifier hs-var">lastHighestBid</span></a></span><span>
</span><span id="line-340"></span><span>                </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.TransitionSuccess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-type">Ongoing</span></a></span><span> </span><span id="local-6989586621680971297"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971297"><span class="hs-identifier hs-var">newHighestBid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionLog
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionLog
</span><a href="Plutus.Contracts.Auction.html#BidSubmitted"><span class="hs-identifier hs-var">BidSubmitted</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971297"><span class="hs-identifier hs-var">newHighestBid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  ()
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall a b.
a
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a b)
</span><a href="#local-6989586621680971304"><span class="hs-identifier hs-var">continue</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971297"><span class="hs-identifier hs-var">newHighestBid</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>                </span><span class="hs-comment">-- the last case shouldn't happen because the &quot;Bid&quot; transition always results in the &quot;Ongoing&quot;</span><span>
</span><span id="line-343"></span><span>                </span><span class="hs-comment">-- but you never know :-)</span><span>
</span><span id="line-344"></span><span>                </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">SM.TransitionSuccess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Auction.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span id="local-6989586621680971296"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971296"><span class="hs-identifier hs-var">newHighestBid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionLog
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionLog
</span><a href="Plutus.Contracts.Auction.html#AuctionEnded"><span class="hs-identifier hs-var">AuctionEnded</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971296"><span class="hs-identifier hs-var">newHighestBid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  ()
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (Either HighestBid ())
forall a.
Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (Either a ())
</span><a href="#local-6989586621680971303"><span class="hs-identifier hs-var">stop</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><a href="Plutus.Contracts.Auction.html#OtherBid"><span class="hs-identifier hs-type">OtherBid</span></a></span><span> </span><span id="local-6989586621680971295"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971295"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>            </span><span class="annot"><span class="annottext">AuctionOutput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuctionState -&gt; AuctionOutput
</span><a href="Plutus.Contracts.Auction.html#auctionStateOut"><span class="hs-identifier hs-var">auctionStateOut</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionState -&gt; AuctionOutput) -&gt; AuctionState -&gt; AuctionOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid -&gt; AuctionState
</span><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-var">Ongoing</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971295"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="annottext">HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall a b.
a
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a b)
</span><a href="#local-6989586621680971304"><span class="hs-identifier hs-var">continue</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971295"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><a href="Plutus.Contracts.Auction.html#NoChange"><span class="hs-identifier hs-type">NoChange</span></a></span><span> </span><span id="local-6989586621680971294"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971294"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall a b.
a
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either a b)
</span><a href="#local-6989586621680971304"><span class="hs-identifier hs-var">continue</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971294"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#auctionBuyer"><span class="hs-identifier hs-type">auctionBuyer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ThreadToken</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionParams"><span class="hs-identifier hs-type">AuctionParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionOutput"><span class="hs-identifier hs-type">AuctionOutput</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#BuyerSchema"><span class="hs-identifier hs-type">BuyerSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Auction.html#AuctionError"><span class="hs-identifier hs-type">AuctionError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span id="auctionBuyer"><span class="annot"><span class="annottext">auctionBuyer :: ThreadToken
-&gt; AuctionParams
-&gt; Contract AuctionOutput BuyerSchema AuctionError ()
</span><a href="Plutus.Contracts.Auction.html#auctionBuyer"><span class="hs-identifier hs-var hs-var">auctionBuyer</span></a></span></span><span> </span><span id="local-6989586621680971293"><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971293"><span class="hs-identifier hs-var">currency</span></a></span></span><span> </span><span id="local-6989586621680971292"><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971292"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680971291"><span class="annot"><span class="annottext">inst :: TypedValidator AuctionMachine
</span><a href="#local-6989586621680971291"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ThreadToken, AuctionParams) -&gt; TypedValidator AuctionMachine
</span><a href="Plutus.Contracts.Auction.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971293"><span class="hs-identifier hs-var">currency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971292"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>        </span><span id="local-6989586621680971290"><span class="annot"><span class="annottext">client :: StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971290"><span class="hs-identifier hs-var hs-var">client</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator AuctionMachine
-&gt; ThreadToken
-&gt; AuctionParams
-&gt; StateMachineClient AuctionState AuctionInput
</span><a href="Plutus.Contracts.Auction.html#machineClient"><span class="hs-identifier hs-var">machineClient</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator AuctionMachine
</span><a href="#local-6989586621680971291"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971293"><span class="hs-identifier hs-var">currency</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971292"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-comment">-- the actual loop, see note [Buyer client]</span><span>
</span><span id="line-356"></span><span>        </span><span id="local-6989586621680971289"><span class="annot"><span class="annottext">loop :: HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
</span><a href="#local-6989586621680971289"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HighestBid
 -&gt; Contract
      AuctionOutput
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      (Either HighestBid ()))
-&gt; HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m (Either a b)) -&gt; a -&gt; m b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">loopM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680971288"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971288"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionParams
-&gt; StateMachineClient AuctionState AuctionInput
-&gt; HighestBid
-&gt; Contract AuctionOutput BuyerSchema AuctionError BuyerEvent
</span><a href="Plutus.Contracts.Auction.html#waitForChange"><span class="hs-identifier hs-var">waitForChange</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971292"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971290"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971288"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  BuyerEvent
-&gt; (BuyerEvent
    -&gt; Contract
         AuctionOutput
         ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
         AuctionError
         (Either HighestBid ()))
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (Either HighestBid ())
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; HighestBid
-&gt; BuyerEvent
-&gt; Contract
     AuctionOutput BuyerSchema AuctionError (Either HighestBid ())
</span><a href="Plutus.Contracts.Auction.html#handleEvent"><span class="hs-identifier hs-var">handleEvent</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971290"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971288"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><span class="annottext">AuctionOutput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">(AuctionOutput
 -&gt; Contract
      AuctionOutput
      ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
      AuctionError
      ())
-&gt; AuctionOutput
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken -&gt; AuctionOutput
</span><a href="Plutus.Contracts.Auction.html#threadTokenOut"><span class="hs-identifier hs-var">threadTokenOut</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadToken
</span><a href="#local-6989586621680971293"><span class="hs-identifier hs-var">currency</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621680971287"><span class="annot"><span class="annottext">Maybe HighestBid
</span><a href="#local-6989586621680971287"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; Contract
     AuctionOutput BuyerSchema AuctionError (Maybe HighestBid)
</span><a href="Plutus.Contracts.Auction.html#currentState"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971290"><span class="hs-identifier hs-var">client</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HighestBid
</span><a href="#local-6989586621680971287"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680971286"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971286"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
</span><a href="#local-6989586621680971289"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971286"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-comment">-- If the state can't be found we wait for it to appear.</span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><span class="annottext">Maybe HighestBid
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
-&gt; POSIXTime
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     (WaitingResult POSIXTime AuctionInput AuctionState)
forall e state i w (schema :: Row *).
(AsSMContractError e, AsContractError e, FromData state,
 ToData state, FromData i) =&gt;
StateMachineClient state i
-&gt; POSIXTime
-&gt; Contract w schema e (WaitingResult POSIXTime i state)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">SM.waitForUpdateUntilTime</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient AuctionState AuctionInput
</span><a href="#local-6989586621680971290"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuctionParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.Auction.html#apEndTime"><span class="hs-identifier hs-var hs-var">apEndTime</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionParams
</span><a href="#local-6989586621680971292"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Contract
  AuctionOutput
  ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
  AuctionError
  (WaitingResult POSIXTime AuctionInput AuctionState)
-&gt; (WaitingResult POSIXTime AuctionInput AuctionState
    -&gt; Contract
         AuctionOutput
         ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
         AuctionError
         ())
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-365"></span><span>            </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionInput
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-type">Ongoing</span></a></span><span> </span><span id="local-6989586621680971284"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971284"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
</span><a href="#local-6989586621680971289"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971284"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-366"></span><span>            </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">InitialState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Auction.html#Ongoing"><span class="hs-identifier hs-type">Ongoing</span></a></span><span> </span><span id="local-6989586621680971282"><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971282"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HighestBid
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
</span><a href="#local-6989586621680971289"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">HighestBid
</span><a href="#local-6989586621680971282"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><span class="annottext">WaitingResult POSIXTime AuctionInput AuctionState
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AuctionLog
-&gt; Contract
     AuctionOutput
     ('R '[ &quot;bid&quot; ':-&gt; (EndpointValue Ada, ActiveEndpoint)])
     AuctionError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logWarn</span></a></span><span> </span><span class="annot"><span class="annottext">AuctionLog
</span><a href="Plutus.Contracts.Auction.html#CurrentStateNotFound"><span class="hs-identifier hs-var">CurrentStateNotFound</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><a href="Plutus.Contracts.Auction.html#covIdx"><span class="hs-identifier hs-type">covIdx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">CoverageIndex</span></a></span><span>
</span><span id="line-370"></span><span id="covIdx"><span class="annot"><span class="annottext">covIdx :: CoverageIndex
</span><a href="Plutus.Contracts.Auction.html#covIdx"><span class="hs-identifier hs-var hs-var">covIdx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompiledCode
  ((ThreadToken, AuctionParams)
   -&gt; AuctionState -&gt; AuctionInput -&gt; ScriptContext -&gt; Bool)
-&gt; CoverageIndex
forall (uni :: * -&gt; *) fun a.
CompiledCodeIn uni fun a -&gt; CoverageIndex
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">getCovIdx</span></a></span><span> </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">mkValidator</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span></pre></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds                  #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass             #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric              #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies         #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses      #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns             #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude          #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings          #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards            #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell            #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications           #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies               #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators              #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# OPTIONS_GHC -fplugin-opt PlutusTx.Plugin:coverage-all #-}</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.Contracts.Uniswap.OffChain</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoinFromUniswapCurrency"><span class="hs-identifier">poolStateCoinFromUniswapCurrency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCoin"><span class="hs-identifier">liquidityCoin</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CreateParams"><span class="hs-identifier">CreateParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#SwapParams"><span class="hs-identifier">SwapParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CloseParams"><span class="hs-identifier">CloseParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#RemoveParams"><span class="hs-identifier">RemoveParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#AddParams"><span class="hs-identifier">AddParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapUserSchema"><span class="hs-identifier">UniswapUserSchema</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UserContractState"><span class="hs-identifier">UserContractState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapOwnerSchema"><span class="hs-identifier">UniswapOwnerSchema</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#start"><span class="hs-identifier">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#create"><span class="hs-identifier">create</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#add"><span class="hs-identifier">add</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#remove"><span class="hs-identifier">remove</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#close"><span class="hs-identifier">close</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#swap"><span class="hs-identifier">swap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#pools"><span class="hs-identifier">pools</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#ownerEndpoint"><span class="hs-identifier">ownerEndpoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#userEndpoints"><span class="hs-identifier">userEndpoints</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapA"><span class="hs-identifier">findSwapA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapB"><span class="hs-identifier">findSwapB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#covIdx"><span class="hs-identifier">covIdx</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-comment">-- exported for defining test endpoints</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactoryAndPool"><span class="hs-identifier">findUniswapFactoryAndPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier">uniswapInstance</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier">liquidityPolicy</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier">uniswapScript</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier">poolStateCoin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier">liquidityCurrency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Pool.html#lpTicker"><span class="hs-identifier">lpTicker</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Pool.html#calculateRemoval"><span class="hs-identifier">calculateRemoval</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#funds"><span class="hs-identifier">funds</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier">Cardano.Node.Emulator.Params</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier">testnet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-operator">(^?)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fmap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier">pack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">absurd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">CardanoAddress</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">DecoratedTxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">datumInDatumFromQuery</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">decoratedTxOutScriptDatum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">decoratedTxOutValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier">Ledger.Constraints</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Constraints</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier">adjustUnbalancedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Typed.Scripts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Scripts</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../playground-common/html/src"><span class="hs-identifier">Playground.Contract</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Contract</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract.Test.Coverage.Analysis</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contracts.Currency.html"><span class="hs-identifier">Plutus.Contracts.Currency</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Currency</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OnChain.html"><span class="hs-identifier">Plutus.Contracts.Uniswap.OnChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.OnChain.html#mkUniswapValidator"><span class="hs-identifier">mkUniswapValidator</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OnChain.html#validateLiquidityMinting"><span class="hs-identifier">validateLiquidityMinting</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Pool.html"><span class="hs-identifier">Plutus.Contracts.Uniswap.Pool</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html"><span class="hs-identifier">Plutus.Contracts.Uniswap.Types</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier">Plutus.Script.Utils.V1.Address</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier">mkValidatorCardanoAddress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier">Plutus.Script.Utils.V1.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier">scriptCurrencySymbol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V1.Ledger.Api</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">CurrencySymbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Datum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Datum</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">DatumHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">MintingPolicy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Redeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Redeemer</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Validator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>                             </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V1.Ledger.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">mkMintingPolicyScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx.Coverage</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">dropWhile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">flip</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Haskell</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">div</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">dropWhile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">flip</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">show</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(^)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Text.Printf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">printf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="Uniswapping"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Uniswapping"><span class="hs-identifier hs-var">Uniswapping</span></a></span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">Scripts.ValidatorTypes</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Uniswapping"><span class="hs-identifier hs-type">Uniswapping</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="RedeemerType"><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">RedeemerType</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Uniswapping"><span class="hs-identifier hs-type">Uniswapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#UniswapAction"><span class="hs-identifier hs-type">UniswapAction</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="DatumType"><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">DatumType</span></a></span></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Uniswapping"><span class="hs-identifier hs-type">Uniswapping</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#UniswapDatum"><span class="hs-identifier hs-type">UniswapDatum</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">type</span><span> </span><span id="UniswapOwnerSchema"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapOwnerSchema"><span class="hs-identifier hs-var">UniswapOwnerSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;start&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Schema for the endpoints for users of Uniswap.</span><span>
</span><span id="line-75"></span><span class="hs-keyword">type</span><span> </span><span id="UniswapUserSchema"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapUserSchema"><span class="hs-identifier hs-var">UniswapUserSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;create&quot;</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CreateParams"><span class="hs-identifier hs-type">CreateParams</span></a></span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><a href="../file:///nix/store/g8vgm61qs4g5v6yyv8hvi8bm9dvsf9sa-row-types-lib-row-types-1.0.1.2-haddock-doc/share/doc/row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;swap&quot;</span></span><span>   </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#SwapParams"><span class="hs-identifier hs-type">SwapParams</span></a></span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><a href="../file:///nix/store/g8vgm61qs4g5v6yyv8hvi8bm9dvsf9sa-row-types-lib-row-types-1.0.1.2-haddock-doc/share/doc/row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;close&quot;</span></span><span>  </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CloseParams"><span class="hs-identifier hs-type">CloseParams</span></a></span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><a href="../file:///nix/store/g8vgm61qs4g5v6yyv8hvi8bm9dvsf9sa-row-types-lib-row-types-1.0.1.2-haddock-doc/share/doc/row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;remove&quot;</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#RemoveParams"><span class="hs-identifier hs-type">RemoveParams</span></a></span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><a href="../file:///nix/store/g8vgm61qs4g5v6yyv8hvi8bm9dvsf9sa-row-types-lib-row-types-1.0.1.2-haddock-doc/share/doc/row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;add&quot;</span></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#AddParams"><span class="hs-identifier hs-type">AddParams</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><a href="../file:///nix/store/g8vgm61qs4g5v6yyv8hvi8bm9dvsf9sa-row-types-lib-row-types-1.0.1.2-haddock-doc/share/doc/row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;pools&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><a href="../file:///nix/store/g8vgm61qs4g5v6yyv8hvi8bm9dvsf9sa-row-types-lib-row-types-1.0.1.2-haddock-doc/share/doc/row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;funds&quot;</span></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><a href="../file:///nix/store/g8vgm61qs4g5v6yyv8hvi8bm9dvsf9sa-row-types-lib-row-types-1.0.1.2-haddock-doc/share/doc/row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;stop&quot;</span></span><span>   </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | Type of the Uniswap user contract state.</span><span>
</span><span id="line-86"></span><span id="local-6989586621680986419"><span id="local-6989586621680986420"></span></span><span class="hs-keyword">data</span><span> </span><span id="UserContractState"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UserContractState"><span class="hs-identifier hs-var">UserContractState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>      </span><span id="Pools"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Pools"><span class="hs-identifier hs-var">Pools</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Funds"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Funds"><span class="hs-identifier hs-var">Funds</span></a></span></span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Created"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Created"><span class="hs-identifier hs-var">Created</span></a></span></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Swapped"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Swapped"><span class="hs-identifier hs-var">Swapped</span></a></span></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Added"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Added"><span class="hs-identifier hs-var">Added</span></a></span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Removed"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Removed"><span class="hs-identifier hs-var">Removed</span></a></span></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Closed"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Stopped"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986405"><span id="local-6989586621680986407"><span id="local-6989586621680986409"><span class="annot"><span class="annottext">Int -&gt; UserContractState -&gt; ShowS
[UserContractState] -&gt; ShowS
UserContractState -&gt; String
(Int -&gt; UserContractState -&gt; ShowS)
-&gt; (UserContractState -&gt; String)
-&gt; ([UserContractState] -&gt; ShowS)
-&gt; Show UserContractState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [UserContractState] -&gt; ShowS
$cshowList :: [UserContractState] -&gt; ShowS
show :: UserContractState -&gt; String
$cshow :: UserContractState -&gt; String
showsPrec :: Int -&gt; UserContractState -&gt; ShowS
$cshowsPrec :: Int -&gt; UserContractState -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. UserContractState -&gt; Rep UserContractState x)
-&gt; (forall x. Rep UserContractState x -&gt; UserContractState)
-&gt; Generic UserContractState
forall x. Rep UserContractState x -&gt; UserContractState
forall x. UserContractState -&gt; Rep UserContractState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep UserContractState x -&gt; UserContractState
$cfrom :: forall x. UserContractState -&gt; Rep UserContractState x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986397"><span id="local-6989586621680986399"><span class="annot"><span class="annottext">Value -&gt; Parser [UserContractState]
Value -&gt; Parser UserContractState
(Value -&gt; Parser UserContractState)
-&gt; (Value -&gt; Parser [UserContractState])
-&gt; FromJSON UserContractState
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [UserContractState]
$cparseJSONList :: Value -&gt; Parser [UserContractState]
parseJSON :: Value -&gt; Parser UserContractState
$cparseJSON :: Value -&gt; Parser UserContractState
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986388"><span id="local-6989586621680986390"><span id="local-6989586621680986392"><span id="local-6989586621680986394"><span class="annot"><span class="annottext">[UserContractState] -&gt; Encoding
[UserContractState] -&gt; Value
UserContractState -&gt; Encoding
UserContractState -&gt; Value
(UserContractState -&gt; Value)
-&gt; (UserContractState -&gt; Encoding)
-&gt; ([UserContractState] -&gt; Value)
-&gt; ([UserContractState] -&gt; Encoding)
-&gt; ToJSON UserContractState
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [UserContractState] -&gt; Encoding
$ctoEncodingList :: [UserContractState] -&gt; Encoding
toJSONList :: [UserContractState] -&gt; Value
$ctoJSONList :: [UserContractState] -&gt; Value
toEncoding :: UserContractState -&gt; Encoding
$ctoEncoding :: UserContractState -&gt; Encoding
toJSON :: UserContractState -&gt; Value
$ctoJSON :: UserContractState -&gt; Value
</span><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapTokenName"><span class="hs-identifier hs-type">uniswapTokenName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateTokenName"><span class="hs-identifier hs-type">poolStateTokenName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">TokenName</span></a></span><span>
</span><span id="line-99"></span><span id="uniswapTokenName"><span class="annot"><span class="annottext">uniswapTokenName :: TokenName
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapTokenName"><span class="hs-identifier hs-var hs-var">uniswapTokenName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><span class="hs-string">&quot;Uniswap&quot;</span></span><span>
</span><span id="line-100"></span><span id="poolStateTokenName"><span class="annot"><span class="annottext">poolStateTokenName :: TokenName
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateTokenName"><span class="hs-identifier hs-var hs-var">poolStateTokenName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><span class="hs-string">&quot;Pool State&quot;</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-type">uniswapInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">Scripts.TypedValidator</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Uniswapping"><span class="hs-identifier hs-type">Uniswapping</span></a></span><span>
</span><span id="line-103"></span><span id="uniswapInstance"><span class="annot"><span class="annottext">uniswapInstance :: Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var hs-var">uniswapInstance</span></a></span></span><span> </span><span id="local-6989586621680986384"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986384"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompiledCode (ValidatorType Uniswapping)
-&gt; CompiledCode (ValidatorType Uniswapping -&gt; UntypedValidator)
-&gt; TypedValidator Uniswapping
forall a.
CompiledCode (ValidatorType a)
-&gt; CompiledCode (ValidatorType a -&gt; UntypedValidator)
-&gt; TypedValidator a
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.mkTypedValidator</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#Uniswapping"><span class="hs-identifier hs-type">Uniswapping</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">mkUniswapValidator</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">CompiledCode
  (Uniswap
   -&gt; Coin PoolState
   -&gt; UniswapDatum
   -&gt; UniswapAction
   -&gt; ScriptContext
   -&gt; Bool)
-&gt; CompiledCodeIn DefaultUni DefaultFun Uniswap
-&gt; CompiledCodeIn
     DefaultUni
     DefaultFun
     (Coin PoolState
      -&gt; UniswapDatum -&gt; UniswapAction -&gt; ScriptContext -&gt; Bool)
forall (uni :: * -&gt; *) fun a b.
(Closed uni, Everywhere uni Flat, Flat fun,
 Everywhere uni PrettyConst, GShow uni, Pretty fun) =&gt;
CompiledCodeIn uni fun (a -&gt; b)
-&gt; CompiledCodeIn uni fun a -&gt; CompiledCodeIn uni fun b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">`PlutusTx.applyCode`</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; CompiledCodeIn DefaultUni DefaultFun Uniswap
forall (uni :: * -&gt; *) a fun.
(Lift uni a, Throwable uni fun, Typecheckable uni fun) =&gt;
a -&gt; CompiledCodeIn uni fun a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.liftCode</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986384"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><span class="annottext">CompiledCodeIn
  DefaultUni
  DefaultFun
  (Coin PoolState
   -&gt; UniswapDatum -&gt; UniswapAction -&gt; ScriptContext -&gt; Bool)
-&gt; CompiledCodeIn DefaultUni DefaultFun (Coin PoolState)
-&gt; CompiledCodeIn
     DefaultUni
     DefaultFun
     (UniswapDatum -&gt; UniswapAction -&gt; ScriptContext -&gt; Bool)
forall (uni :: * -&gt; *) fun a b.
(Closed uni, Everywhere uni Flat, Flat fun,
 Everywhere uni PrettyConst, GShow uni, Pretty fun) =&gt;
CompiledCodeIn uni fun (a -&gt; b)
-&gt; CompiledCodeIn uni fun a -&gt; CompiledCodeIn uni fun b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">`PlutusTx.applyCode`</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
-&gt; CompiledCodeIn DefaultUni DefaultFun (Coin PoolState)
forall (uni :: * -&gt; *) a fun.
(Lift uni a, Throwable uni fun, Typecheckable uni fun) =&gt;
a -&gt; CompiledCodeIn uni fun a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.liftCode</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
</span><a href="#local-6989586621680986377"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>     </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">wrap</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="#local-6989586621680986377"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#PoolState"><span class="hs-identifier hs-type">PoolState</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621680986377"><span class="annot"><span class="annottext">c :: Coin PoolState
</span><a href="#local-6989586621680986377"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986384"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621680986376"><span class="annot"><span class="annottext">wrap :: (UniswapDatum -&gt; UniswapAction -&gt; ScriptContext -&gt; Bool)
-&gt; UntypedValidator
</span><a href="#local-6989586621680986376"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnsafeFromData UniswapDatum, UnsafeFromData UniswapAction) =&gt;
(UniswapDatum -&gt; UniswapAction -&gt; ScriptContext -&gt; Bool)
-&gt; UntypedValidator
forall sc d r.
(IsScriptContext sc, UnsafeFromData d, UnsafeFromData r) =&gt;
(d -&gt; r -&gt; sc -&gt; Bool) -&gt; UntypedValidator
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.mkUntypedValidator</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">Scripts.ScriptContextV1</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#UniswapDatum"><span class="hs-identifier hs-type">UniswapDatum</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#UniswapAction"><span class="hs-identifier hs-type">UniswapAction</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier hs-type">uniswapScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Validator</span></a></span><span>
</span><span id="line-115"></span><span id="uniswapScript"><span class="annot"><span class="annottext">uniswapScript :: Uniswap -&gt; Validator
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier hs-var hs-var">uniswapScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; Validator
forall a. TypedValidator a -&gt; Validator
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.validatorScript</span></a></span><span> </span><span class="annot"><span class="annottext">(TypedValidator Uniswapping -&gt; Validator)
-&gt; (Uniswap -&gt; TypedValidator Uniswapping) -&gt; Uniswap -&gt; Validator
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var">uniswapInstance</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapAddress"><span class="hs-identifier hs-type">uniswapAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">CardanoAddress</span></a></span><span>
</span><span id="line-118"></span><span id="uniswapAddress"><span class="annot"><span class="annottext">uniswapAddress :: Uniswap -&gt; CardanoAddress
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapAddress"><span class="hs-identifier hs-var hs-var">uniswapAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; Validator -&gt; CardanoAddress
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">mkValidatorCardanoAddress</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var">testnet</span></a></span><span> </span><span class="annot"><span class="annottext">(Validator -&gt; CardanoAddress)
-&gt; (Uniswap -&gt; Validator) -&gt; Uniswap -&gt; CardanoAddress
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Validator
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier hs-var">uniswapScript</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswap"><span class="hs-identifier hs-type">uniswap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span>
</span><span id="line-121"></span><span id="uniswap"><span class="annot"><span class="annottext">uniswap :: CurrencySymbol -&gt; Uniswap
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswap"><span class="hs-identifier hs-var hs-var">uniswap</span></a></span></span><span> </span><span id="local-6989586621680986369"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680986369"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin U -&gt; Uniswap
</span><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-var">Uniswap</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin U -&gt; Uniswap) -&gt; Coin U -&gt; Uniswap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin U
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680986369"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapTokenName"><span class="hs-identifier hs-var">uniswapTokenName</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier hs-type">liquidityPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">MintingPolicy</span></a></span><span>
</span><span id="line-124"></span><span id="liquidityPolicy"><span class="annot"><span class="annottext">liquidityPolicy :: Uniswap -&gt; MintingPolicy
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier hs-var hs-var">liquidityPolicy</span></a></span></span><span> </span><span id="local-6989586621680986365"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986365"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompiledCode (BuiltinData -&gt; BuiltinData -&gt; ()) -&gt; MintingPolicy
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">mkMintingPolicyScript</span></a></span><span> </span><span class="annot"><span class="annottext">(CompiledCode (BuiltinData -&gt; BuiltinData -&gt; ()) -&gt; MintingPolicy)
-&gt; CompiledCode (BuiltinData -&gt; BuiltinData -&gt; ()) -&gt; MintingPolicy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">t</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Scripts.mkUntypedMintingPolicy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">validateLiquidityMinting</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">t</span><span class="hs-special">)</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="annottext">CompiledCode
  (Uniswap -&gt; TokenName -&gt; BuiltinData -&gt; BuiltinData -&gt; ())
-&gt; CompiledCodeIn DefaultUni DefaultFun Uniswap
-&gt; CompiledCodeIn
     DefaultUni
     DefaultFun
     (TokenName -&gt; BuiltinData -&gt; BuiltinData -&gt; ())
forall (uni :: * -&gt; *) fun a b.
(Closed uni, Everywhere uni Flat, Flat fun,
 Everywhere uni PrettyConst, GShow uni, Pretty fun) =&gt;
CompiledCodeIn uni fun (a -&gt; b)
-&gt; CompiledCodeIn uni fun a -&gt; CompiledCodeIn uni fun b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">`PlutusTx.applyCode`</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; CompiledCodeIn DefaultUni DefaultFun Uniswap
forall (uni :: * -&gt; *) a fun.
(Lift uni a, Throwable uni fun, Typecheckable uni fun) =&gt;
a -&gt; CompiledCodeIn uni fun a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.liftCode</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986365"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">CompiledCodeIn
  DefaultUni
  DefaultFun
  (TokenName -&gt; BuiltinData -&gt; BuiltinData -&gt; ())
-&gt; CompiledCodeIn DefaultUni DefaultFun TokenName
-&gt; CompiledCode (BuiltinData -&gt; BuiltinData -&gt; ())
forall (uni :: * -&gt; *) fun a b.
(Closed uni, Everywhere uni Flat, Flat fun,
 Everywhere uni PrettyConst, GShow uni, Pretty fun) =&gt;
CompiledCodeIn uni fun (a -&gt; b)
-&gt; CompiledCodeIn uni fun a -&gt; CompiledCodeIn uni fun b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">`PlutusTx.applyCode`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; CompiledCodeIn DefaultUni DefaultFun TokenName
forall (uni :: * -&gt; *) a fun.
(Lift uni a, Throwable uni fun, Typecheckable uni fun) =&gt;
a -&gt; CompiledCodeIn uni fun a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.liftCode</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateTokenName"><span class="hs-identifier hs-var">poolStateTokenName</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#covIdx"><span class="hs-identifier hs-type">covIdx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">CoverageIndex</span></a></span><span>
</span><span id="line-130"></span><span id="covIdx"><span class="annot"><span class="annottext">covIdx :: CoverageIndex
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#covIdx"><span class="hs-identifier hs-var hs-var">covIdx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
String
String -&gt; Int -&gt; CoverageIndex -&gt; CoverageIndex
CompiledCodeIn
  DefaultUni
  DefaultFun
  (Uniswap
   -&gt; Coin PoolState
   -&gt; UniswapDatum
   -&gt; UniswapAction
   -&gt; ScriptContext
   -&gt; ())
-&gt; CoverageIndex
(CoverageIndex -&gt; CoverageIndex)
-&gt; (CompiledCodeIn
      DefaultUni
      DefaultFun
      (Uniswap
       -&gt; Coin PoolState
       -&gt; UniswapDatum
       -&gt; UniswapAction
       -&gt; ScriptContext
       -&gt; ())
    -&gt; CoverageIndex)
-&gt; CompiledCodeIn
     DefaultUni
     DefaultFun
     (Uniswap
      -&gt; Coin PoolState
      -&gt; UniswapDatum
      -&gt; UniswapAction
      -&gt; ScriptContext
      -&gt; ())
-&gt; CoverageIndex
forall a. CompiledCodeIn DefaultUni DefaultFun a -&gt; CoverageIndex
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
unsafeIgnoreLocationInCoverageIndex :: String -&gt; Int -&gt; CoverageIndex -&gt; CoverageIndex
computeRefinedCoverageIndex :: forall a. CompiledCodeIn DefaultUni DefaultFun a -&gt; CoverageIndex
. :: forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-contract/html/src"><span class="hs-var hs-var hs-var">$refinedCoverageIndex</span></a></span><span> </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">check</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mkUniswapValidator</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-type">liquidityCurrency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span>
</span><span id="line-133"></span><span id="liquidityCurrency"><span class="annot"><span class="annottext">liquidityCurrency :: Uniswap -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-var hs-var">liquidityCurrency</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; CurrencySymbol
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">scriptCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">(MintingPolicy -&gt; CurrencySymbol)
-&gt; (Uniswap -&gt; MintingPolicy) -&gt; Uniswap -&gt; CurrencySymbol
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; MintingPolicy
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier hs-var">liquidityPolicy</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-type">poolStateCoin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#PoolState"><span class="hs-identifier hs-type">PoolState</span></a></span><span>
</span><span id="line-136"></span><span id="poolStateCoin"><span class="annot"><span class="annottext">poolStateCoin :: Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var hs-var">poolStateCoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol -&gt; TokenName -&gt; Coin PoolState)
-&gt; TokenName -&gt; CurrencySymbol -&gt; Coin PoolState
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin PoolState
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateTokenName"><span class="hs-identifier hs-var">poolStateTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol -&gt; Coin PoolState)
-&gt; (Uniswap -&gt; CurrencySymbol) -&gt; Uniswap -&gt; Coin PoolState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-var">liquidityCurrency</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | Gets the 'Coin' used to identity liquidity pools.</span><span>
</span><span id="line-139"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoinFromUniswapCurrency"><span class="hs-identifier hs-type">poolStateCoinFromUniswapCurrency</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span> </span><span class="hs-comment">-- ^ The currency identifying the Uniswap instance.</span><span>
</span><span id="line-140"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#PoolState"><span class="hs-identifier hs-type">PoolState</span></a></span><span>
</span><span id="line-141"></span><span id="poolStateCoinFromUniswapCurrency"><span class="annot"><span class="annottext">poolStateCoinFromUniswapCurrency :: CurrencySymbol -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoinFromUniswapCurrency"><span class="hs-identifier hs-var hs-var">poolStateCoinFromUniswapCurrency</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Uniswap -&gt; Coin PoolState)
-&gt; (CurrencySymbol -&gt; Uniswap) -&gt; CurrencySymbol -&gt; Coin PoolState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Uniswap
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswap"><span class="hs-identifier hs-var">uniswap</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | Gets the liquidity token for a given liquidity pool.</span><span>
</span><span id="line-144"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCoin"><span class="hs-identifier hs-type">liquidityCoin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">CurrencySymbol</span></a></span><span> </span><span class="hs-comment">-- ^ The currency identifying the Uniswap instance.</span><span>
</span><span id="line-145"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>         </span><span class="hs-comment">-- ^ One coin in the liquidity pair.</span><span>
</span><span id="line-146"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>         </span><span class="hs-comment">-- ^ The other coin in the liquidity pair.</span><span>
</span><span id="line-147"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Liquidity"><span class="hs-identifier hs-type">Liquidity</span></a></span><span>
</span><span id="line-148"></span><span id="liquidityCoin"><span class="annot"><span class="annottext">liquidityCoin :: CurrencySymbol -&gt; Coin A -&gt; Coin B -&gt; Coin Liquidity
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCoin"><span class="hs-identifier hs-var hs-var">liquidityCoin</span></a></span></span><span> </span><span id="local-6989586621680986361"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680986361"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621680986360"><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986360"><span class="hs-identifier hs-var">coinA</span></a></span></span><span> </span><span id="local-6989586621680986359"><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986359"><span class="hs-identifier hs-var">coinB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin Liquidity
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-var">liquidityCurrency</span></a></span><span> </span><span class="annot"><span class="annottext">(Uniswap -&gt; CurrencySymbol) -&gt; Uniswap -&gt; CurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Uniswap
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswap"><span class="hs-identifier hs-var">uniswap</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680986361"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenName -&gt; Coin Liquidity) -&gt; TokenName -&gt; Coin Liquidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; TokenName
</span><a href="Plutus.Contracts.Uniswap.Pool.html#lpTicker"><span class="hs-identifier hs-var">lpTicker</span></a></span><span> </span><span class="annot"><span class="annottext">(LiquidityPool -&gt; TokenName) -&gt; LiquidityPool -&gt; TokenName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A -&gt; Coin B -&gt; LiquidityPool
</span><a href="Plutus.Contracts.Uniswap.Types.html#LiquidityPool"><span class="hs-identifier hs-var">LiquidityPool</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986360"><span class="hs-identifier hs-var">coinA</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986359"><span class="hs-identifier hs-var">coinB</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | Parameters for the @create@-endpoint, which creates a new liquidity pool.</span><span>
</span><span id="line-151"></span><span id="local-6989586621680986356"><span id="local-6989586621680986357"></span></span><span class="hs-keyword">data</span><span> </span><span id="CreateParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CreateParams"><span class="hs-identifier hs-var">CreateParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CreateParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CreateParams"><span class="hs-identifier hs-var">CreateParams</span></a></span></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="cpCoinA"><span class="annot"><span class="annottext">CreateParams -&gt; Coin A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#cpCoinA"><span class="hs-identifier hs-var hs-var">cpCoinA</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>   </span><span class="hs-comment">-- ^ One 'Coin' of the liquidity pair.</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cpCoinB"><span class="annot"><span class="annottext">CreateParams -&gt; Coin B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#cpCoinB"><span class="hs-identifier hs-var hs-var">cpCoinB</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>   </span><span class="hs-comment">-- ^ The other 'Coin'.</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cpAmountA"><span class="annot"><span class="annottext">CreateParams -&gt; Amount A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#cpAmountA"><span class="hs-identifier hs-var hs-var">cpAmountA</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span> </span><span class="hs-comment">-- ^ Amount of liquidity for the first 'Coin'.</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="cpAmountB"><span class="annot"><span class="annottext">CreateParams -&gt; Amount B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#cpAmountB"><span class="hs-identifier hs-var hs-var">cpAmountB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span> </span><span class="hs-comment">-- ^ Amount of liquidity for the second 'Coin'.</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986345"><span id="local-6989586621680986347"><span id="local-6989586621680986349"><span class="annot"><span class="annottext">Int -&gt; CreateParams -&gt; ShowS
[CreateParams] -&gt; ShowS
CreateParams -&gt; String
(Int -&gt; CreateParams -&gt; ShowS)
-&gt; (CreateParams -&gt; String)
-&gt; ([CreateParams] -&gt; ShowS)
-&gt; Show CreateParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CreateParams] -&gt; ShowS
$cshowList :: [CreateParams] -&gt; ShowS
show :: CreateParams -&gt; String
$cshow :: CreateParams -&gt; String
showsPrec :: Int -&gt; CreateParams -&gt; ShowS
$cshowsPrec :: Int -&gt; CreateParams -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. CreateParams -&gt; Rep CreateParams x)
-&gt; (forall x. Rep CreateParams x -&gt; CreateParams)
-&gt; Generic CreateParams
forall x. Rep CreateParams x -&gt; CreateParams
forall x. CreateParams -&gt; Rep CreateParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep CreateParams x -&gt; CreateParams
$cfrom :: forall x. CreateParams -&gt; Rep CreateParams x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986335"><span id="local-6989586621680986337"><span id="local-6989586621680986339"><span id="local-6989586621680986341"><span class="annot"><span class="annottext">[CreateParams] -&gt; Encoding
[CreateParams] -&gt; Value
CreateParams -&gt; Encoding
CreateParams -&gt; Value
(CreateParams -&gt; Value)
-&gt; (CreateParams -&gt; Encoding)
-&gt; ([CreateParams] -&gt; Value)
-&gt; ([CreateParams] -&gt; Encoding)
-&gt; ToJSON CreateParams
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [CreateParams] -&gt; Encoding
$ctoEncodingList :: [CreateParams] -&gt; Encoding
toJSONList :: [CreateParams] -&gt; Value
$ctoJSONList :: [CreateParams] -&gt; Value
toEncoding :: CreateParams -&gt; Encoding
$ctoEncoding :: CreateParams -&gt; Encoding
toJSON :: CreateParams -&gt; Value
$ctoJSON :: CreateParams -&gt; Value
</span><a href="#local-6989586621680986335"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986331"><span id="local-6989586621680986333"><span class="annot"><span class="annottext">Value -&gt; Parser [CreateParams]
Value -&gt; Parser CreateParams
(Value -&gt; Parser CreateParams)
-&gt; (Value -&gt; Parser [CreateParams]) -&gt; FromJSON CreateParams
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [CreateParams]
$cparseJSONList :: Value -&gt; Parser [CreateParams]
parseJSON :: Value -&gt; Parser CreateParams
$cparseJSON :: Value -&gt; Parser CreateParams
</span><a href="#local-6989586621680986331"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986329"><span class="annot"><span class="annottext">FormSchema
FormSchema -&gt; ToSchema CreateParams
forall a. FormSchema -&gt; ToSchema a
toSchema :: FormSchema
$ctoSchema :: FormSchema
</span><a href="../../../../playground-common/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">ToSchema</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">-- | Parameters for the @swap@-endpoint, which allows swaps between the two different coins in a liquidity pool.</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- One of the provided amounts must be positive, the other must be zero.</span><span>
</span><span id="line-160"></span><span id="local-6989586621680986326"><span id="local-6989586621680986327"></span></span><span class="hs-keyword">data</span><span> </span><span id="SwapParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#SwapParams"><span class="hs-identifier hs-var">SwapParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SwapParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#SwapParams"><span class="hs-identifier hs-var">SwapParams</span></a></span></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="spCoinA"><span class="annot"><span class="annottext">SwapParams -&gt; Coin A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#spCoinA"><span class="hs-identifier hs-var hs-var">spCoinA</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>         </span><span class="hs-comment">-- ^ One 'Coin' of the liquidity pair.</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="spCoinB"><span class="annot"><span class="annottext">SwapParams -&gt; Coin B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#spCoinB"><span class="hs-identifier hs-var hs-var">spCoinB</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>         </span><span class="hs-comment">-- ^ The other 'Coin'.</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="spAmountA"><span class="annot"><span class="annottext">SwapParams -&gt; Amount A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#spAmountA"><span class="hs-identifier hs-var hs-var">spAmountA</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>       </span><span class="hs-comment">-- ^ The amount the first 'Coin' that should be swapped.</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="spAmountB"><span class="annot"><span class="annottext">SwapParams -&gt; Amount B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#spAmountB"><span class="hs-identifier hs-var hs-var">spAmountB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>       </span><span class="hs-comment">-- ^ The amount of the second 'Coin' that should be swapped.</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986315"><span id="local-6989586621680986317"><span id="local-6989586621680986319"><span class="annot"><span class="annottext">Int -&gt; SwapParams -&gt; ShowS
[SwapParams] -&gt; ShowS
SwapParams -&gt; String
(Int -&gt; SwapParams -&gt; ShowS)
-&gt; (SwapParams -&gt; String)
-&gt; ([SwapParams] -&gt; ShowS)
-&gt; Show SwapParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SwapParams] -&gt; ShowS
$cshowList :: [SwapParams] -&gt; ShowS
show :: SwapParams -&gt; String
$cshow :: SwapParams -&gt; String
showsPrec :: Int -&gt; SwapParams -&gt; ShowS
$cshowsPrec :: Int -&gt; SwapParams -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. SwapParams -&gt; Rep SwapParams x)
-&gt; (forall x. Rep SwapParams x -&gt; SwapParams) -&gt; Generic SwapParams
forall x. Rep SwapParams x -&gt; SwapParams
forall x. SwapParams -&gt; Rep SwapParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SwapParams x -&gt; SwapParams
$cfrom :: forall x. SwapParams -&gt; Rep SwapParams x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986305"><span id="local-6989586621680986307"><span id="local-6989586621680986309"><span id="local-6989586621680986311"><span class="annot"><span class="annottext">[SwapParams] -&gt; Encoding
[SwapParams] -&gt; Value
SwapParams -&gt; Encoding
SwapParams -&gt; Value
(SwapParams -&gt; Value)
-&gt; (SwapParams -&gt; Encoding)
-&gt; ([SwapParams] -&gt; Value)
-&gt; ([SwapParams] -&gt; Encoding)
-&gt; ToJSON SwapParams
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [SwapParams] -&gt; Encoding
$ctoEncodingList :: [SwapParams] -&gt; Encoding
toJSONList :: [SwapParams] -&gt; Value
$ctoJSONList :: [SwapParams] -&gt; Value
toEncoding :: SwapParams -&gt; Encoding
$ctoEncoding :: SwapParams -&gt; Encoding
toJSON :: SwapParams -&gt; Value
$ctoJSON :: SwapParams -&gt; Value
</span><a href="#local-6989586621680986305"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986301"><span id="local-6989586621680986303"><span class="annot"><span class="annottext">Value -&gt; Parser [SwapParams]
Value -&gt; Parser SwapParams
(Value -&gt; Parser SwapParams)
-&gt; (Value -&gt; Parser [SwapParams]) -&gt; FromJSON SwapParams
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [SwapParams]
$cparseJSONList :: Value -&gt; Parser [SwapParams]
parseJSON :: Value -&gt; Parser SwapParams
$cparseJSON :: Value -&gt; Parser SwapParams
</span><a href="#local-6989586621680986301"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986299"><span class="annot"><span class="annottext">FormSchema
FormSchema -&gt; ToSchema SwapParams
forall a. FormSchema -&gt; ToSchema a
toSchema :: FormSchema
$ctoSchema :: FormSchema
</span><a href="#local-6989586621680986299"><span class="hs-identifier hs-var hs-var hs-var hs-var">ToSchema</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Parameters for the @close@-endpoint, which closes a liquidity pool.</span><span>
</span><span id="line-168"></span><span id="local-6989586621680986297"><span id="local-6989586621680986298"></span></span><span class="hs-keyword">data</span><span> </span><span id="CloseParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CloseParams"><span class="hs-identifier hs-var">CloseParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CloseParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CloseParams"><span class="hs-identifier hs-var">CloseParams</span></a></span></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="clpCoinA"><span class="annot"><span class="annottext">CloseParams -&gt; Coin A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#clpCoinA"><span class="hs-identifier hs-var hs-var">clpCoinA</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>         </span><span class="hs-comment">-- ^ One 'Coin' of the liquidity pair.</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="clpCoinB"><span class="annot"><span class="annottext">CloseParams -&gt; Coin B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#clpCoinB"><span class="hs-identifier hs-var hs-var">clpCoinB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>         </span><span class="hs-comment">-- ^ The other 'Coin' of the liquidity pair.</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986288"><span id="local-6989586621680986290"><span id="local-6989586621680986292"><span class="annot"><span class="annottext">Int -&gt; CloseParams -&gt; ShowS
[CloseParams] -&gt; ShowS
CloseParams -&gt; String
(Int -&gt; CloseParams -&gt; ShowS)
-&gt; (CloseParams -&gt; String)
-&gt; ([CloseParams] -&gt; ShowS)
-&gt; Show CloseParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CloseParams] -&gt; ShowS
$cshowList :: [CloseParams] -&gt; ShowS
show :: CloseParams -&gt; String
$cshow :: CloseParams -&gt; String
showsPrec :: Int -&gt; CloseParams -&gt; ShowS
$cshowsPrec :: Int -&gt; CloseParams -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. CloseParams -&gt; Rep CloseParams x)
-&gt; (forall x. Rep CloseParams x -&gt; CloseParams)
-&gt; Generic CloseParams
forall x. Rep CloseParams x -&gt; CloseParams
forall x. CloseParams -&gt; Rep CloseParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep CloseParams x -&gt; CloseParams
$cfrom :: forall x. CloseParams -&gt; Rep CloseParams x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986278"><span id="local-6989586621680986280"><span id="local-6989586621680986282"><span id="local-6989586621680986284"><span class="annot"><span class="annottext">[CloseParams] -&gt; Encoding
[CloseParams] -&gt; Value
CloseParams -&gt; Encoding
CloseParams -&gt; Value
(CloseParams -&gt; Value)
-&gt; (CloseParams -&gt; Encoding)
-&gt; ([CloseParams] -&gt; Value)
-&gt; ([CloseParams] -&gt; Encoding)
-&gt; ToJSON CloseParams
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [CloseParams] -&gt; Encoding
$ctoEncodingList :: [CloseParams] -&gt; Encoding
toJSONList :: [CloseParams] -&gt; Value
$ctoJSONList :: [CloseParams] -&gt; Value
toEncoding :: CloseParams -&gt; Encoding
$ctoEncoding :: CloseParams -&gt; Encoding
toJSON :: CloseParams -&gt; Value
$ctoJSON :: CloseParams -&gt; Value
</span><a href="#local-6989586621680986278"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986274"><span id="local-6989586621680986276"><span class="annot"><span class="annottext">Value -&gt; Parser [CloseParams]
Value -&gt; Parser CloseParams
(Value -&gt; Parser CloseParams)
-&gt; (Value -&gt; Parser [CloseParams]) -&gt; FromJSON CloseParams
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [CloseParams]
$cparseJSONList :: Value -&gt; Parser [CloseParams]
parseJSON :: Value -&gt; Parser CloseParams
$cparseJSON :: Value -&gt; Parser CloseParams
</span><a href="#local-6989586621680986274"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986272"><span class="annot"><span class="annottext">FormSchema
FormSchema -&gt; ToSchema CloseParams
forall a. FormSchema -&gt; ToSchema a
toSchema :: FormSchema
$ctoSchema :: FormSchema
</span><a href="#local-6989586621680986272"><span class="hs-identifier hs-var hs-var hs-var hs-var">ToSchema</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | Parameters for the @remove@-endpoint, which removes some liquidity from a liquidity pool.</span><span>
</span><span id="line-174"></span><span id="local-6989586621680986270"><span id="local-6989586621680986271"></span></span><span class="hs-keyword">data</span><span> </span><span id="RemoveParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#RemoveParams"><span class="hs-identifier hs-var">RemoveParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RemoveParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#RemoveParams"><span class="hs-identifier hs-var">RemoveParams</span></a></span></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="rpCoinA"><span class="annot"><span class="annottext">RemoveParams -&gt; Coin A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#rpCoinA"><span class="hs-identifier hs-var hs-var">rpCoinA</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>           </span><span class="hs-comment">-- ^ One 'Coin' of the liquidity pair.</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rpCoinB"><span class="annot"><span class="annottext">RemoveParams -&gt; Coin B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#rpCoinB"><span class="hs-identifier hs-var hs-var">rpCoinB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>           </span><span class="hs-comment">-- ^ The other 'Coin' of the liquidity pair.</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rpDiff"><span class="annot"><span class="annottext">RemoveParams -&gt; Amount Liquidity
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#rpDiff"><span class="hs-identifier hs-var hs-var">rpDiff</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Liquidity"><span class="hs-identifier hs-type">Liquidity</span></a></span><span> </span><span class="hs-comment">-- ^ The amount of liquidity tokens to burn in exchange for liquidity from the pool.</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986260"><span id="local-6989586621680986262"><span id="local-6989586621680986264"><span class="annot"><span class="annottext">Int -&gt; RemoveParams -&gt; ShowS
[RemoveParams] -&gt; ShowS
RemoveParams -&gt; String
(Int -&gt; RemoveParams -&gt; ShowS)
-&gt; (RemoveParams -&gt; String)
-&gt; ([RemoveParams] -&gt; ShowS)
-&gt; Show RemoveParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RemoveParams] -&gt; ShowS
$cshowList :: [RemoveParams] -&gt; ShowS
show :: RemoveParams -&gt; String
$cshow :: RemoveParams -&gt; String
showsPrec :: Int -&gt; RemoveParams -&gt; ShowS
$cshowsPrec :: Int -&gt; RemoveParams -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. RemoveParams -&gt; Rep RemoveParams x)
-&gt; (forall x. Rep RemoveParams x -&gt; RemoveParams)
-&gt; Generic RemoveParams
forall x. Rep RemoveParams x -&gt; RemoveParams
forall x. RemoveParams -&gt; Rep RemoveParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep RemoveParams x -&gt; RemoveParams
$cfrom :: forall x. RemoveParams -&gt; Rep RemoveParams x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986250"><span id="local-6989586621680986252"><span id="local-6989586621680986254"><span id="local-6989586621680986256"><span class="annot"><span class="annottext">[RemoveParams] -&gt; Encoding
[RemoveParams] -&gt; Value
RemoveParams -&gt; Encoding
RemoveParams -&gt; Value
(RemoveParams -&gt; Value)
-&gt; (RemoveParams -&gt; Encoding)
-&gt; ([RemoveParams] -&gt; Value)
-&gt; ([RemoveParams] -&gt; Encoding)
-&gt; ToJSON RemoveParams
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [RemoveParams] -&gt; Encoding
$ctoEncodingList :: [RemoveParams] -&gt; Encoding
toJSONList :: [RemoveParams] -&gt; Value
$ctoJSONList :: [RemoveParams] -&gt; Value
toEncoding :: RemoveParams -&gt; Encoding
$ctoEncoding :: RemoveParams -&gt; Encoding
toJSON :: RemoveParams -&gt; Value
$ctoJSON :: RemoveParams -&gt; Value
</span><a href="#local-6989586621680986250"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986246"><span id="local-6989586621680986248"><span class="annot"><span class="annottext">Value -&gt; Parser [RemoveParams]
Value -&gt; Parser RemoveParams
(Value -&gt; Parser RemoveParams)
-&gt; (Value -&gt; Parser [RemoveParams]) -&gt; FromJSON RemoveParams
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [RemoveParams]
$cparseJSONList :: Value -&gt; Parser [RemoveParams]
parseJSON :: Value -&gt; Parser RemoveParams
$cparseJSON :: Value -&gt; Parser RemoveParams
</span><a href="#local-6989586621680986246"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986244"><span class="annot"><span class="annottext">FormSchema
FormSchema -&gt; ToSchema RemoveParams
forall a. FormSchema -&gt; ToSchema a
toSchema :: FormSchema
$ctoSchema :: FormSchema
</span><a href="#local-6989586621680986244"><span class="hs-identifier hs-var hs-var hs-var hs-var">ToSchema</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">-- | Parameters for the @add@-endpoint, which adds liquidity to a liquidity pool in exchange for liquidity tokens.</span><span>
</span><span id="line-181"></span><span id="local-6989586621680986242"><span id="local-6989586621680986243"></span></span><span class="hs-keyword">data</span><span> </span><span id="AddParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#AddParams"><span class="hs-identifier hs-var">AddParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AddParams"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#AddParams"><span class="hs-identifier hs-var">AddParams</span></a></span></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="apCoinA"><span class="annot"><span class="annottext">AddParams -&gt; Coin A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#apCoinA"><span class="hs-identifier hs-var hs-var">apCoinA</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>         </span><span class="hs-comment">-- ^ One 'Coin' of the liquidity pair.</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="apCoinB"><span class="annot"><span class="annottext">AddParams -&gt; Coin B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#apCoinB"><span class="hs-identifier hs-var hs-var">apCoinB</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>         </span><span class="hs-comment">-- ^ The other 'Coin' of the liquidity pair.</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="apAmountA"><span class="annot"><span class="annottext">AddParams -&gt; Amount A
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#apAmountA"><span class="hs-identifier hs-var hs-var">apAmountA</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>       </span><span class="hs-comment">-- ^ The amount of coins of the first kind to add to the pool.</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="apAmountB"><span class="annot"><span class="annottext">AddParams -&gt; Amount B
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#apAmountB"><span class="hs-identifier hs-var hs-var">apAmountB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>       </span><span class="hs-comment">-- ^ The amount of coins of the second kind to add to the pool.</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986231"><span id="local-6989586621680986233"><span id="local-6989586621680986235"><span class="annot"><span class="annottext">Int -&gt; AddParams -&gt; ShowS
[AddParams] -&gt; ShowS
AddParams -&gt; String
(Int -&gt; AddParams -&gt; ShowS)
-&gt; (AddParams -&gt; String)
-&gt; ([AddParams] -&gt; ShowS)
-&gt; Show AddParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AddParams] -&gt; ShowS
$cshowList :: [AddParams] -&gt; ShowS
show :: AddParams -&gt; String
$cshow :: AddParams -&gt; String
showsPrec :: Int -&gt; AddParams -&gt; ShowS
$cshowsPrec :: Int -&gt; AddParams -&gt; ShowS
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. AddParams -&gt; Rep AddParams x)
-&gt; (forall x. Rep AddParams x -&gt; AddParams) -&gt; Generic AddParams
forall x. Rep AddParams x -&gt; AddParams
forall x. AddParams -&gt; Rep AddParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep AddParams x -&gt; AddParams
$cfrom :: forall x. AddParams -&gt; Rep AddParams x
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986221"><span id="local-6989586621680986223"><span id="local-6989586621680986225"><span id="local-6989586621680986227"><span class="annot"><span class="annottext">[AddParams] -&gt; Encoding
[AddParams] -&gt; Value
AddParams -&gt; Encoding
AddParams -&gt; Value
(AddParams -&gt; Value)
-&gt; (AddParams -&gt; Encoding)
-&gt; ([AddParams] -&gt; Value)
-&gt; ([AddParams] -&gt; Encoding)
-&gt; ToJSON AddParams
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [AddParams] -&gt; Encoding
$ctoEncodingList :: [AddParams] -&gt; Encoding
toJSONList :: [AddParams] -&gt; Value
$ctoJSONList :: [AddParams] -&gt; Value
toEncoding :: AddParams -&gt; Encoding
$ctoEncoding :: AddParams -&gt; Encoding
toJSON :: AddParams -&gt; Value
$ctoJSON :: AddParams -&gt; Value
</span><a href="#local-6989586621680986221"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986217"><span id="local-6989586621680986219"><span class="annot"><span class="annottext">Value -&gt; Parser [AddParams]
Value -&gt; Parser AddParams
(Value -&gt; Parser AddParams)
-&gt; (Value -&gt; Parser [AddParams]) -&gt; FromJSON AddParams
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [AddParams]
$cparseJSONList :: Value -&gt; Parser [AddParams]
parseJSON :: Value -&gt; Parser AddParams
$cparseJSON :: Value -&gt; Parser AddParams
</span><a href="#local-6989586621680986217"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986215"><span class="annot"><span class="annottext">FormSchema
FormSchema -&gt; ToSchema AddParams
forall a. FormSchema -&gt; ToSchema a
toSchema :: FormSchema
$ctoSchema :: FormSchema
</span><a href="#local-6989586621680986215"><span class="hs-identifier hs-var hs-var hs-var hs-var">ToSchema</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- | Creates a Uniswap &quot;factory&quot;. This factory will keep track of the existing liquidity pools and enforce that there will be at most one liquidity pool</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- for any pair of tokens at any given time.</span><span>
</span><span id="line-190"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#start"><span class="hs-identifier hs-type">start</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986525"><span class="annot"><a href="#local-6989586621680986525"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986524"><span class="annot"><a href="#local-6989586621680986524"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986525"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986524"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span>
</span><span id="line-191"></span><span id="start"><span class="annot"><span class="annottext">start :: Contract w s Text Uniswap
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#start"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621680986214"><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680986214"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Contract w s Text CardanoAddress
forall w (s :: Row *) e.
AsContractError e =&gt;
Contract w s e CardanoAddress
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">Contract.ownAddress</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621680986212"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680986212"><span class="hs-identifier hs-var">cs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(OneShotCurrency -&gt; CurrencySymbol)
-&gt; Contract w s Text OneShotCurrency
-&gt; Contract w s Text CurrencySymbol
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">OneShotCurrency -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Currency.html#currencySymbol"><span class="hs-identifier hs-var">Currency.currencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract w s Text OneShotCurrency
 -&gt; Contract w s Text CurrencySymbol)
-&gt; Contract w s Text OneShotCurrency
-&gt; Contract w s Text CurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-194"></span><span>           </span><span class="annot"><span class="annottext">(CurrencyError -&gt; Text)
-&gt; Contract w s CurrencyError OneShotCurrency
-&gt; Contract w s Text OneShotCurrency
forall w (s :: Row *) e e' a.
(e -&gt; e') -&gt; Contract w s e a -&gt; Contract w s e' a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mapError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-var">pack</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text)
-&gt; (CurrencyError -&gt; String) -&gt; CurrencyError -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Show CurrencyError =&gt; CurrencyError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Currency.html#CurrencyError"><span class="hs-identifier hs-type">Currency.CurrencyError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s CurrencyError OneShotCurrency
 -&gt; Contract w s Text OneShotCurrency)
-&gt; Contract w s CurrencyError OneShotCurrency
-&gt; Contract w s Text OneShotCurrency
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-195"></span><span>           </span><span class="annot"><span class="annottext">CardanoAddress
-&gt; [(TokenName, Integer)]
-&gt; Contract w s CurrencyError OneShotCurrency
forall w (s :: Row *) e.
AsCurrencyError e =&gt;
CardanoAddress
-&gt; [(TokenName, Integer)] -&gt; Contract w s e OneShotCurrency
</span><a href="Plutus.Contracts.Currency.html#mintContract"><span class="hs-identifier hs-var">Currency.mintContract</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680986214"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenName
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapTokenName"><span class="hs-identifier hs-var">uniswapTokenName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986207"><span class="annot"><span class="annottext">c :: Coin Any
</span><a href="#local-6989586621680986207"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin Any
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680986212"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapTokenName"><span class="hs-identifier hs-var">uniswapTokenName</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span id="local-6989586621680986206"><span class="annot"><span class="annottext">us :: Uniswap
</span><a href="#local-6989586621680986206"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Uniswap
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswap"><span class="hs-identifier hs-var">uniswap</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680986212"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span id="local-6989586621680986205"><span class="annot"><span class="annottext">inst :: TypedValidator Uniswapping
</span><a href="#local-6989586621680986205"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var">uniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986206"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span id="local-6989586621680986204"><span class="annot"><span class="annottext">tx :: TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986204"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LiquidityPool] -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Factory"><span class="hs-identifier hs-var">Factory</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxConstraints UniswapAction UniswapDatum)
-&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coin Any -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin Any
</span><a href="#local-6989586621680986207"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
-&gt; Contract w s Text UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; ScriptLookups Uniswapping
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping
</span><a href="#local-6989586621680986205"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986204"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text UnbalancedTx)
-&gt; Contract w s Text UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text ()) -&gt; Contract w s Text ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text ()
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitTxConfirmed</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">Contract w s Text Slot -&gt; Contract w s Text ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract w s Text Slot -&gt; Contract w s Text ())
-&gt; Contract w s Text Slot -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Contract w s Text Slot
forall w (s :: Row *) e.
AsContractError e =&gt;
Natural -&gt; Contract w s e Slot
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">waitNSlots</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
forall w (s :: Row *) e.
ToJSON String =&gt;
String -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;started Uniswap %s at address %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986206"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoAddress -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoAddress -&gt; String) -&gt; CardanoAddress -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; CardanoAddress
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapAddress"><span class="hs-identifier hs-var">uniswapAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986206"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">Uniswap -&gt; Contract w s Text Uniswap
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986206"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | Creates a liquidity pool for a pair of coins. The creator provides liquidity for both coins and gets liquidity tokens in return.</span><span>
</span><span id="line-209"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#create"><span class="hs-identifier hs-type">create</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986502"><span class="annot"><a href="#local-6989586621680986502"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986501"><span class="annot"><a href="#local-6989586621680986501"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CreateParams"><span class="hs-identifier hs-type">CreateParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986502"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986501"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span id="create"><span class="annot"><span class="annottext">create :: Uniswap -&gt; CreateParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#create"><span class="hs-identifier hs-var hs-var">create</span></a></span></span><span> </span><span id="local-6989586621680986193"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CreateParams"><span class="hs-identifier hs-type">CreateParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680986189"><span id="local-6989586621680986190"><span id="local-6989586621680986191"><span id="local-6989586621680986192"><span class="annot"><span class="annottext">Coin A
Coin B
Amount A
Amount B
cpAmountB :: Amount B
cpAmountA :: Amount A
cpCoinB :: Coin B
cpCoinA :: Coin A
cpAmountB :: CreateParams -&gt; Amount B
cpAmountA :: CreateParams -&gt; Amount A
cpCoinB :: CreateParams -&gt; Coin B
cpCoinA :: CreateParams -&gt; Coin A
</span><a href="#local-6989586621680986189"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin A -&gt; AssetClass
forall a. Coin a -&gt; AssetClass
</span><a href="Plutus.Contracts.Uniswap.Types.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986192"><span class="hs-identifier hs-var">cpCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass -&gt; AssetClass -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B -&gt; AssetClass
forall a. Coin a -&gt; AssetClass
</span><a href="Plutus.Contracts.Uniswap.Types.html#unCoin"><span class="hs-identifier hs-var hs-var">unCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986191"><span class="hs-identifier hs-var">cpCoinB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;coins must be different&quot;</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986190"><span class="hs-identifier hs-var">cpAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986189"><span class="hs-identifier hs-var">cpAmountB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;amounts must be positive&quot;</span></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680986182"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986182"><span class="hs-identifier hs-var">oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986181"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986181"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986180"><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680986180"><span class="hs-identifier hs-var">lps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool])
forall w (s :: Row *).
Uniswap
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool])
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactory"><span class="hs-identifier hs-var">findUniswapFactory</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986178"><span class="annot"><span class="annottext">liquidity :: Amount Liquidity
</span><a href="#local-6989586621680986178"><span class="hs-identifier hs-var hs-var">liquidity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount B -&gt; Amount Liquidity
</span><a href="Plutus.Contracts.Uniswap.Pool.html#calculateInitialLiquidity"><span class="hs-identifier hs-var">calculateInitialLiquidity</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986190"><span class="hs-identifier hs-var">cpAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986189"><span class="hs-identifier hs-var">cpAmountB</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621680986176"><span class="annot"><span class="annottext">lp :: LiquidityPool
</span><a href="#local-6989586621680986176"><span class="hs-identifier hs-var hs-var">lp</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiquidityPool :: Coin A -&gt; Coin B -&gt; LiquidityPool
</span><a href="Plutus.Contracts.Uniswap.Types.html#LiquidityPool"><span class="hs-identifier hs-type">LiquidityPool</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">lpCoinA :: Coin A
</span><a href="Plutus.Contracts.Uniswap.Types.html#lpCoinA"><span class="hs-identifier hs-var">lpCoinA</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986192"><span class="hs-identifier hs-var">cpCoinA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lpCoinB :: Coin B
</span><a href="Plutus.Contracts.Uniswap.Types.html#lpCoinB"><span class="hs-identifier hs-var">lpCoinB</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986191"><span class="hs-identifier hs-var">cpCoinB</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986173"><span class="annot"><span class="annottext">usInst :: TypedValidator Uniswapping
</span><a href="#local-6989586621680986173"><span class="hs-identifier hs-var hs-var">usInst</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var">uniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span id="local-6989586621680986172"><span class="annot"><span class="annottext">usScript :: Validator
</span><a href="#local-6989586621680986172"><span class="hs-identifier hs-var hs-var">usScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Validator
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier hs-var">uniswapScript</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span id="local-6989586621680986171"><span class="annot"><span class="annottext">usDat1 :: UniswapDatum
</span><a href="#local-6989586621680986171"><span class="hs-identifier hs-var hs-var">usDat1</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LiquidityPool] -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Factory"><span class="hs-identifier hs-var">Factory</span></a></span><span> </span><span class="annot"><span class="annottext">([LiquidityPool] -&gt; UniswapDatum)
-&gt; [LiquidityPool] -&gt; UniswapDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986176"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; [LiquidityPool] -&gt; [LiquidityPool]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680986180"><span class="hs-identifier hs-var">lps</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span id="local-6989586621680986170"><span class="annot"><span class="annottext">usDat2 :: UniswapDatum
</span><a href="#local-6989586621680986170"><span class="hs-identifier hs-var hs-var">usDat2</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; Amount Liquidity -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-var">Pool</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986176"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986178"><span class="hs-identifier hs-var">liquidity</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span id="local-6989586621680986168"><span class="annot"><span class="annottext">psC :: Coin PoolState
</span><a href="#local-6989586621680986168"><span class="hs-identifier hs-var hs-var">psC</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621680986167"><span class="annot"><span class="annottext">lC :: Coin Liquidity
</span><a href="#local-6989586621680986167"><span class="hs-identifier hs-var hs-var">lC</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin Liquidity
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-var">liquidityCurrency</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenName -&gt; Coin Liquidity) -&gt; TokenName -&gt; Coin Liquidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; TokenName
</span><a href="Plutus.Contracts.Uniswap.Pool.html#lpTicker"><span class="hs-identifier hs-var">lpTicker</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986176"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span id="local-6989586621680986166"><span class="annot"><span class="annottext">usVal :: Value
</span><a href="#local-6989586621680986166"><span class="hs-identifier hs-var hs-var">usVal</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin U -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin U -&gt; Value) -&gt; Coin U -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin U
</span><a href="Plutus.Contracts.Uniswap.Types.html#usCoin"><span class="hs-identifier hs-var hs-var">usCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-223"></span><span>        </span><span id="local-6989586621680986164"><span class="annot"><span class="annottext">lpVal :: Value
</span><a href="#local-6989586621680986164"><span class="hs-identifier hs-var hs-var">lpVal</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin A -&gt; Amount A -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986192"><span class="hs-identifier hs-var">cpCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986190"><span class="hs-identifier hs-var">cpAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B -&gt; Amount B -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986191"><span class="hs-identifier hs-var">cpCoinB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986189"><span class="hs-identifier hs-var">cpAmountB</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
</span><a href="#local-6989586621680986168"><span class="hs-identifier hs-var">psC</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>        </span><span id="local-6989586621680986162"><span class="annot"><span class="annottext">lookups :: ScriptLookups Uniswapping
</span><a href="#local-6989586621680986162"><span class="hs-identifier hs-var hs-var">lookups</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; ScriptLookups Uniswapping
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping
</span><a href="#local-6989586621680986173"><span class="hs-identifier hs-var">usInst</span></a></span><span>        </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-226"></span><span>                   </span><span class="annot"><span class="annottext">Validator -&gt; ScriptLookups Uniswapping
forall a. Validator -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1OtherScript</span></a></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621680986172"><span class="hs-identifier hs-var">usScript</span></a></span><span>                </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-227"></span><span>                   </span><span class="annot"><span class="annottext">MintingPolicy -&gt; ScriptLookups Uniswapping
forall a. MintingPolicy -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1MintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; MintingPolicy
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier hs-var">liquidityPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986193"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-228"></span><span>                   </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Uniswapping
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986182"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986181"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621680986157"><span class="annot"><span class="annottext">tx :: TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986157"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680986171"><span class="hs-identifier hs-var">usDat1</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986166"><span class="hs-identifier hs-var">usVal</span></a></span><span>                                     </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-231"></span><span>                   </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680986170"><span class="hs-identifier hs-var">usDat2</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986164"><span class="hs-identifier hs-var">lpVal</span></a></span><span>                                     </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-232"></span><span>                   </span><span class="annot"><span class="annottext">Value -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustMintValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin PoolState -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
</span><a href="#local-6989586621680986168"><span class="hs-identifier hs-var">psC</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin Liquidity -&gt; Amount Liquidity -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin Liquidity
</span><a href="#local-6989586621680986167"><span class="hs-identifier hs-var">lC</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986178"><span class="hs-identifier hs-var">liquidity</span></a></span><span class="hs-special">)</span><span>              </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-233"></span><span>                   </span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. TxOutRef -&gt; Redeemer -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986182"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">Redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.toBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">(UniswapAction -&gt; BuiltinData) -&gt; UniswapAction -&gt; BuiltinData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; UniswapAction
</span><a href="Plutus.Contracts.Uniswap.Types.html#Create"><span class="hs-identifier hs-var">Create</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986176"><span class="hs-identifier hs-var">lp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
-&gt; Contract w s Text UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
</span><a href="#local-6989586621680986162"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986157"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text UnbalancedTx)
-&gt; Contract w s Text UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text ()) -&gt; Contract w s Text ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text ()
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitTxConfirmed</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;created liquidity pool: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986176"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">-- | Closes a liquidity pool by burning all remaining liquidity tokens in exchange for all liquidity remaining in the pool.</span><span>
</span><span id="line-240"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#close"><span class="hs-identifier hs-type">close</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986498"><span class="annot"><a href="#local-6989586621680986498"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986497"><span class="annot"><a href="#local-6989586621680986497"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CloseParams"><span class="hs-identifier hs-type">CloseParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986498"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986497"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span id="close"><span class="annot"><span class="annottext">close :: Uniswap -&gt; CloseParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#close"><span class="hs-identifier hs-var hs-var">close</span></a></span></span><span> </span><span id="local-6989586621680986151"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#CloseParams"><span class="hs-identifier hs-type">CloseParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680986149"><span id="local-6989586621680986150"><span class="annot"><span class="annottext">Coin A
Coin B
clpCoinB :: Coin B
clpCoinA :: Coin A
clpCoinB :: CloseParams -&gt; Coin B
clpCoinA :: CloseParams -&gt; Coin A
</span><a href="#local-6989586621680986149"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680986148"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986148"><span class="hs-identifier hs-var">oref1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986147"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986147"><span class="hs-identifier hs-var">o1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986146"><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680986146"><span class="hs-identifier hs-var">lps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986145"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986145"><span class="hs-identifier hs-var">oref2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986144"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986144"><span class="hs-identifier hs-var">o2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986143"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986143"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986142"><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986142"><span class="hs-identifier hs-var">liquidity</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
forall w (s :: Row *).
Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactoryAndPool"><span class="hs-identifier hs-var">findUniswapFactoryAndPool</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986150"><span class="hs-identifier hs-var">clpCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986149"><span class="hs-identifier hs-var">clpCoinB</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986141"><span class="annot"><span class="annottext">usInst :: TypedValidator Uniswapping
</span><a href="#local-6989586621680986141"><span class="hs-identifier hs-var hs-var">usInst</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var">uniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span id="local-6989586621680986140"><span class="annot"><span class="annottext">usScript :: Validator
</span><a href="#local-6989586621680986140"><span class="hs-identifier hs-var hs-var">usScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Validator
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier hs-var">uniswapScript</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span id="local-6989586621680986139"><span class="annot"><span class="annottext">usDat :: UniswapDatum
</span><a href="#local-6989586621680986139"><span class="hs-identifier hs-var hs-var">usDat</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LiquidityPool] -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Factory"><span class="hs-identifier hs-var">Factory</span></a></span><span> </span><span class="annot"><span class="annottext">([LiquidityPool] -&gt; UniswapDatum)
-&gt; [LiquidityPool] -&gt; UniswapDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LiquidityPool -&gt; Bool) -&gt; [LiquidityPool] -&gt; [LiquidityPool]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiquidityPool -&gt; LiquidityPool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986143"><span class="hs-identifier hs-var">lp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680986146"><span class="hs-identifier hs-var">lps</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span id="local-6989586621680986136"><span class="annot"><span class="annottext">usC :: Coin U
</span><a href="#local-6989586621680986136"><span class="hs-identifier hs-var hs-var">usC</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin U
</span><a href="Plutus.Contracts.Uniswap.Types.html#usCoin"><span class="hs-identifier hs-var hs-var">usCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span id="local-6989586621680986135"><span class="annot"><span class="annottext">psC :: Coin PoolState
</span><a href="#local-6989586621680986135"><span class="hs-identifier hs-var hs-var">psC</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span id="local-6989586621680986134"><span class="annot"><span class="annottext">lC :: Coin Liquidity
</span><a href="#local-6989586621680986134"><span class="hs-identifier hs-var hs-var">lC</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin Liquidity
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-var">liquidityCurrency</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenName -&gt; Coin Liquidity) -&gt; TokenName -&gt; Coin Liquidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; TokenName
</span><a href="Plutus.Contracts.Uniswap.Pool.html#lpTicker"><span class="hs-identifier hs-var">lpTicker</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986143"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span id="local-6989586621680986133"><span class="annot"><span class="annottext">usVal :: Value
</span><a href="#local-6989586621680986133"><span class="hs-identifier hs-var hs-var">usVal</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin U -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin U
</span><a href="#local-6989586621680986136"><span class="hs-identifier hs-var">usC</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span id="local-6989586621680986132"><span class="annot"><span class="annottext">psVal :: Value
</span><a href="#local-6989586621680986132"><span class="hs-identifier hs-var hs-var">psVal</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin PoolState -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
</span><a href="#local-6989586621680986135"><span class="hs-identifier hs-var">psC</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span id="local-6989586621680986131"><span class="annot"><span class="annottext">lVal :: Value
</span><a href="#local-6989586621680986131"><span class="hs-identifier hs-var hs-var">lVal</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin Liquidity -&gt; Amount Liquidity -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin Liquidity
</span><a href="#local-6989586621680986134"><span class="hs-identifier hs-var">lC</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986142"><span class="hs-identifier hs-var">liquidity</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span id="local-6989586621680986130"><span class="annot"><span class="annottext">redeemer :: Redeemer
</span><a href="#local-6989586621680986130"><span class="hs-identifier hs-var hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">Redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.toBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction
</span><a href="Plutus.Contracts.Uniswap.Types.html#Close"><span class="hs-identifier hs-var">Close</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>        </span><span id="local-6989586621680986128"><span class="annot"><span class="annottext">lookups :: ScriptLookups Uniswapping
</span><a href="#local-6989586621680986128"><span class="hs-identifier hs-var hs-var">lookups</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; ScriptLookups Uniswapping
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping
</span><a href="#local-6989586621680986141"><span class="hs-identifier hs-var">usInst</span></a></span><span>        </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-255"></span><span>                   </span><span class="annot"><span class="annottext">Validator -&gt; ScriptLookups Uniswapping
forall a. Validator -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1OtherScript</span></a></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621680986140"><span class="hs-identifier hs-var">usScript</span></a></span><span>                </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-256"></span><span>                   </span><span class="annot"><span class="annottext">MintingPolicy -&gt; ScriptLookups Uniswapping
forall a. MintingPolicy -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1MintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; MintingPolicy
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier hs-var">liquidityPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986151"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-257"></span><span>                   </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Uniswapping
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986148"><span class="hs-identifier hs-var">oref1</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986147"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
-&gt; Map TxOutRef DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986145"><span class="hs-identifier hs-var">oref2</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986144"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>        </span><span id="local-6989586621680986127"><span class="annot"><span class="annottext">tx :: TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986127"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680986139"><span class="hs-identifier hs-var">usDat</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986133"><span class="hs-identifier hs-var">usVal</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-260"></span><span>                   </span><span class="annot"><span class="annottext">Value -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustMintValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">negate</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Value -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986132"><span class="hs-identifier hs-var">psVal</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986131"><span class="hs-identifier hs-var">lVal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-261"></span><span>                   </span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. TxOutRef -&gt; Redeemer -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986148"><span class="hs-identifier hs-var">oref1</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621680986130"><span class="hs-identifier hs-var">redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-262"></span><span>                   </span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. TxOutRef -&gt; Redeemer -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986145"><span class="hs-identifier hs-var">oref2</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621680986130"><span class="hs-identifier hs-var">redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-263"></span><span>                   </span><span class="annot"><span class="annottext">Datum -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. Datum -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustIncludeDatumInTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">Datum</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum) -&gt; BuiltinData -&gt; Datum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.toBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">(UniswapDatum -&gt; BuiltinData) -&gt; UniswapDatum -&gt; BuiltinData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; Amount Liquidity -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-var">Pool</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986143"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986142"><span class="hs-identifier hs-var">liquidity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
-&gt; Contract w s Text UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
</span><a href="#local-6989586621680986128"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986127"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text UnbalancedTx)
-&gt; Contract w s Text UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text ()) -&gt; Contract w s Text ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text ()
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitTxConfirmed</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;closed liquidity pool: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986143"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | Removes some liquidity from a liquidity pool in exchange for liquidity tokens.</span><span>
</span><span id="line-270"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#remove"><span class="hs-identifier hs-type">remove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986496"><span class="annot"><a href="#local-6989586621680986496"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986495"><span class="annot"><a href="#local-6989586621680986495"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#RemoveParams"><span class="hs-identifier hs-type">RemoveParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986496"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986495"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span id="remove"><span class="annot"><span class="annottext">remove :: Uniswap -&gt; RemoveParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#remove"><span class="hs-identifier hs-var hs-var">remove</span></a></span></span><span> </span><span id="local-6989586621680986124"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986124"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#RemoveParams"><span class="hs-identifier hs-type">RemoveParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680986121"><span id="local-6989586621680986122"><span id="local-6989586621680986123"><span class="annot"><span class="annottext">Coin A
Coin B
Amount Liquidity
rpDiff :: Amount Liquidity
rpCoinB :: Coin B
rpCoinA :: Coin A
rpDiff :: RemoveParams -&gt; Amount Liquidity
rpCoinB :: RemoveParams -&gt; Coin B
rpCoinA :: RemoveParams -&gt; Coin A
</span><a href="#local-6989586621680986121"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOutRef, DecoratedTxOut, [LiquidityPool])
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986120"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986120"><span class="hs-identifier hs-var">oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986119"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986119"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986118"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986118"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986117"><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986117"><span class="hs-identifier hs-var">liquidity</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
forall w (s :: Row *).
Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactoryAndPool"><span class="hs-identifier hs-var">findUniswapFactoryAndPool</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986124"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986123"><span class="hs-identifier hs-var">rpCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986122"><span class="hs-identifier hs-var">rpCoinB</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986121"><span class="hs-identifier hs-var">rpDiff</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity -&gt; Amount Liquidity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986121"><span class="hs-identifier hs-var">rpDiff</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity -&gt; Amount Liquidity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986117"><span class="hs-identifier hs-var">liquidity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;removed liquidity must be positive and less than total liquidity&quot;</span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986114"><span class="annot"><span class="annottext">usInst :: TypedValidator Uniswapping
</span><a href="#local-6989586621680986114"><span class="hs-identifier hs-var hs-var">usInst</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var">uniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986124"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621680986113"><span class="annot"><span class="annottext">usScript :: Validator
</span><a href="#local-6989586621680986113"><span class="hs-identifier hs-var hs-var">usScript</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Validator
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier hs-var">uniswapScript</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986124"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-276"></span><span>        </span><span id="local-6989586621680986112"><span class="annot"><span class="annottext">dat :: UniswapDatum
</span><a href="#local-6989586621680986112"><span class="hs-identifier hs-var hs-var">dat</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; Amount Liquidity -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-var">Pool</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986118"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">(Amount Liquidity -&gt; UniswapDatum)
-&gt; Amount Liquidity -&gt; UniswapDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986117"><span class="hs-identifier hs-var">liquidity</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity -&gt; Amount Liquidity -&gt; Amount Liquidity
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986121"><span class="hs-identifier hs-var">rpDiff</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span id="local-6989586621680986110"><span class="annot"><span class="annottext">psC :: Coin PoolState
</span><a href="#local-6989586621680986110"><span class="hs-identifier hs-var hs-var">psC</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986124"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span id="local-6989586621680986109"><span class="annot"><span class="annottext">lC :: Coin Liquidity
</span><a href="#local-6989586621680986109"><span class="hs-identifier hs-var hs-var">lC</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin Liquidity
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-var">liquidityCurrency</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986124"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenName -&gt; Coin Liquidity) -&gt; TokenName -&gt; Coin Liquidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; TokenName
</span><a href="Plutus.Contracts.Uniswap.Pool.html#lpTicker"><span class="hs-identifier hs-var">lpTicker</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986118"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span id="local-6989586621680986108"><span class="annot"><span class="annottext">psVal :: Value
</span><a href="#local-6989586621680986108"><span class="hs-identifier hs-var hs-var">psVal</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin PoolState -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
</span><a href="#local-6989586621680986110"><span class="hs-identifier hs-var">psC</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span id="local-6989586621680986107"><span class="annot"><span class="annottext">lVal :: Value
</span><a href="#local-6989586621680986107"><span class="hs-identifier hs-var hs-var">lVal</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin Liquidity -&gt; Amount Liquidity -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin Liquidity
</span><a href="#local-6989586621680986109"><span class="hs-identifier hs-var">lC</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986121"><span class="hs-identifier hs-var">rpDiff</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621680986106"><span class="annot"><span class="annottext">inVal :: Value
</span><a href="#local-6989586621680986106"><span class="hs-identifier hs-var hs-var">inVal</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value -&gt; DecoratedTxOut -&gt; Value
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value
Lens' DecoratedTxOut Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">decoratedTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986119"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-282"></span><span>        </span><span id="local-6989586621680986105"><span class="annot"><span class="annottext">inA :: Amount A
</span><a href="#local-6989586621680986105"><span class="hs-identifier hs-var hs-var">inA</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin A -&gt; Amount A
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986106"><span class="hs-identifier hs-var">inVal</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986123"><span class="hs-identifier hs-var">rpCoinA</span></a></span><span>
</span><span id="line-283"></span><span>        </span><span id="local-6989586621680986103"><span class="annot"><span class="annottext">inB :: Amount B
</span><a href="#local-6989586621680986103"><span class="hs-identifier hs-var hs-var">inB</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin B -&gt; Amount B
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986106"><span class="hs-identifier hs-var">inVal</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986122"><span class="hs-identifier hs-var">rpCoinB</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680986102"><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986102"><span class="hs-identifier hs-var">outA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986101"><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986101"><span class="hs-identifier hs-var">outB</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amount A
-&gt; Amount B
-&gt; Amount Liquidity
-&gt; Amount Liquidity
-&gt; (Amount A, Amount B)
</span><a href="Plutus.Contracts.Uniswap.Pool.html#calculateRemoval"><span class="hs-identifier hs-var">calculateRemoval</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986105"><span class="hs-identifier hs-var">inA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986103"><span class="hs-identifier hs-var">inB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986117"><span class="hs-identifier hs-var">liquidity</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986121"><span class="hs-identifier hs-var">rpDiff</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621680986100"><span class="annot"><span class="annottext">val :: Value
</span><a href="#local-6989586621680986100"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986108"><span class="hs-identifier hs-var">psVal</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A -&gt; Amount A -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986123"><span class="hs-identifier hs-var">rpCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986102"><span class="hs-identifier hs-var">outA</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B -&gt; Amount B -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986122"><span class="hs-identifier hs-var">rpCoinB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986101"><span class="hs-identifier hs-var">outB</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621680986099"><span class="annot"><span class="annottext">redeemer :: Redeemer
</span><a href="#local-6989586621680986099"><span class="hs-identifier hs-var hs-var">redeemer</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">Redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.toBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction
</span><a href="Plutus.Contracts.Uniswap.Types.html#Remove"><span class="hs-identifier hs-var">Remove</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621680986097"><span class="annot"><span class="annottext">lookups :: ScriptLookups Uniswapping
</span><a href="#local-6989586621680986097"><span class="hs-identifier hs-var hs-var">lookups</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; ScriptLookups Uniswapping
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping
</span><a href="#local-6989586621680986114"><span class="hs-identifier hs-var">usInst</span></a></span><span>          </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-289"></span><span>                   </span><span class="annot"><span class="annottext">Validator -&gt; ScriptLookups Uniswapping
forall a. Validator -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1OtherScript</span></a></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621680986113"><span class="hs-identifier hs-var">usScript</span></a></span><span>                  </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-290"></span><span>                   </span><span class="annot"><span class="annottext">MintingPolicy -&gt; ScriptLookups Uniswapping
forall a. MintingPolicy -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1MintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; MintingPolicy
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier hs-var">liquidityPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986124"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-291"></span><span>                   </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Uniswapping
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986120"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986119"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621680986096"><span class="annot"><span class="annottext">tx :: TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986096"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680986112"><span class="hs-identifier hs-var">dat</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986100"><span class="hs-identifier hs-var">val</span></a></span><span>          </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-294"></span><span>                   </span><span class="annot"><span class="annottext">Value -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustMintValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">negate</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986107"><span class="hs-identifier hs-var">lVal</span></a></span><span class="hs-special">)</span><span>        </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-295"></span><span>                   </span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. TxOutRef -&gt; Redeemer -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986120"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621680986099"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
-&gt; Contract w s Text UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
</span><a href="#local-6989586621680986097"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986096"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text UnbalancedTx)
-&gt; Contract w s Text UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text ()) -&gt; Contract w s Text ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text ()
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitTxConfirmed</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;removed liquidity from pool: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986118"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- | Adds some liquidity to an existing liquidity pool in exchange for newly minted liquidity tokens.</span><span>
</span><span id="line-302"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#add"><span class="hs-identifier hs-type">add</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986494"><span class="annot"><a href="#local-6989586621680986494"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986493"><span class="annot"><a href="#local-6989586621680986493"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#AddParams"><span class="hs-identifier hs-type">AddParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986494"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986493"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span id="add"><span class="annot"><span class="annottext">add :: Uniswap -&gt; AddParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#add"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621680986095"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986095"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#AddParams"><span class="hs-identifier hs-type">AddParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680986091"><span id="local-6989586621680986092"><span id="local-6989586621680986093"><span id="local-6989586621680986094"><span class="annot"><span class="annottext">Coin A
Coin B
Amount A
Amount B
apAmountB :: Amount B
apAmountA :: Amount A
apCoinB :: Coin B
apCoinA :: Coin A
apAmountB :: AddParams -&gt; Amount B
apAmountA :: AddParams -&gt; Amount A
apCoinB :: AddParams -&gt; Coin B
apCoinA :: AddParams -&gt; Coin A
</span><a href="#local-6989586621680986091"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOutRef, DecoratedTxOut, [LiquidityPool])
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986090"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986090"><span class="hs-identifier hs-var">oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986089"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986089"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986088"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986088"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986087"><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986087"><span class="hs-identifier hs-var">liquidity</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
forall w (s :: Row *).
Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactoryAndPool"><span class="hs-identifier hs-var">findUniswapFactoryAndPool</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986095"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986094"><span class="hs-identifier hs-var">apCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986093"><span class="hs-identifier hs-var">apCoinB</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986092"><span class="hs-identifier hs-var">apAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986091"><span class="hs-identifier hs-var">apAmountB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;amounts must not be negative&quot;</span></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986086"><span class="annot"><span class="annottext">outVal :: Value
</span><a href="#local-6989586621680986086"><span class="hs-identifier hs-var hs-var">outVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value -&gt; DecoratedTxOut -&gt; Value
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value
Lens' DecoratedTxOut Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">decoratedTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986089"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-307"></span><span>        </span><span id="local-6989586621680986085"><span class="annot"><span class="annottext">oldA :: Amount A
</span><a href="#local-6989586621680986085"><span class="hs-identifier hs-var hs-var">oldA</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin A -&gt; Amount A
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986086"><span class="hs-identifier hs-var">outVal</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986094"><span class="hs-identifier hs-var">apCoinA</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span id="local-6989586621680986084"><span class="annot"><span class="annottext">oldB :: Amount B
</span><a href="#local-6989586621680986084"><span class="hs-identifier hs-var hs-var">oldB</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin B -&gt; Amount B
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986086"><span class="hs-identifier hs-var">outVal</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986093"><span class="hs-identifier hs-var">apCoinB</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621680986083"><span class="annot"><span class="annottext">newA :: Amount A
</span><a href="#local-6989586621680986083"><span class="hs-identifier hs-var hs-var">newA</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986085"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Amount A
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986092"><span class="hs-identifier hs-var">apAmountA</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621680986081"><span class="annot"><span class="annottext">newB :: Amount B
</span><a href="#local-6989586621680986081"><span class="hs-identifier hs-var hs-var">newB</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986084"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Amount B
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986091"><span class="hs-identifier hs-var">apAmountB</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span id="local-6989586621680986080"><span class="annot"><span class="annottext">delL :: Amount Liquidity
</span><a href="#local-6989586621680986080"><span class="hs-identifier hs-var hs-var">delL</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amount A
-&gt; Amount B
-&gt; Amount Liquidity
-&gt; Amount A
-&gt; Amount B
-&gt; Amount Liquidity
</span><a href="Plutus.Contracts.Uniswap.Pool.html#calculateAdditionalLiquidity"><span class="hs-identifier hs-var">calculateAdditionalLiquidity</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986085"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986084"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986087"><span class="hs-identifier hs-var">liquidity</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986092"><span class="hs-identifier hs-var">apAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986091"><span class="hs-identifier hs-var">apAmountB</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621680986078"><span class="annot"><span class="annottext">inVal :: Value
</span><a href="#local-6989586621680986078"><span class="hs-identifier hs-var hs-var">inVal</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin A -&gt; Amount A -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986094"><span class="hs-identifier hs-var">apCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986092"><span class="hs-identifier hs-var">apAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B -&gt; Amount B -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986093"><span class="hs-identifier hs-var">apCoinB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986091"><span class="hs-identifier hs-var">apAmountB</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986080"><span class="hs-identifier hs-var">delL</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity -&gt; Amount Liquidity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;insufficient liquidity&quot;</span></span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
forall w (s :: Row *) e.
ToJSON String =&gt;
String -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
-&gt; Amount A
-&gt; Amount B
-&gt; Amount A
-&gt; Amount B
-&gt; Amount Liquidity
-&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oldA = %d, oldB = %d, newA = %d, newB = %d, delL = %d&quot;</span></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986085"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986084"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986083"><span class="hs-identifier hs-var">newA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986081"><span class="hs-identifier hs-var">newB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986080"><span class="hs-identifier hs-var">delL</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986077"><span class="annot"><span class="annottext">usInst :: TypedValidator Uniswapping
</span><a href="#local-6989586621680986077"><span class="hs-identifier hs-var hs-var">usInst</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var">uniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986095"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621680986076"><span class="annot"><span class="annottext">usScript :: Validator
</span><a href="#local-6989586621680986076"><span class="hs-identifier hs-var hs-var">usScript</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Validator
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapScript"><span class="hs-identifier hs-var">uniswapScript</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986095"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-318"></span><span>        </span><span id="local-6989586621680986075"><span class="annot"><span class="annottext">dat :: UniswapDatum
</span><a href="#local-6989586621680986075"><span class="hs-identifier hs-var hs-var">dat</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; Amount Liquidity -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-var">Pool</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986088"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">(Amount Liquidity -&gt; UniswapDatum)
-&gt; Amount Liquidity -&gt; UniswapDatum
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986087"><span class="hs-identifier hs-var">liquidity</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity -&gt; Amount Liquidity -&gt; Amount Liquidity
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986080"><span class="hs-identifier hs-var">delL</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621680986074"><span class="annot"><span class="annottext">psC :: Coin PoolState
</span><a href="#local-6989586621680986074"><span class="hs-identifier hs-var hs-var">psC</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986095"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-320"></span><span>        </span><span id="local-6989586621680986073"><span class="annot"><span class="annottext">lC :: Coin Liquidity
</span><a href="#local-6989586621680986073"><span class="hs-identifier hs-var hs-var">lC</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Coin Liquidity
forall a. CurrencySymbol -&gt; TokenName -&gt; Coin a
</span><a href="Plutus.Contracts.Uniswap.Types.html#mkCoin"><span class="hs-identifier hs-var">mkCoin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; CurrencySymbol
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityCurrency"><span class="hs-identifier hs-var">liquidityCurrency</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986095"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TokenName -&gt; Coin Liquidity) -&gt; TokenName -&gt; Coin Liquidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; TokenName
</span><a href="Plutus.Contracts.Uniswap.Pool.html#lpTicker"><span class="hs-identifier hs-var">lpTicker</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986088"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621680986072"><span class="annot"><span class="annottext">psVal :: Value
</span><a href="#local-6989586621680986072"><span class="hs-identifier hs-var hs-var">psVal</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin PoolState -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
</span><a href="#local-6989586621680986074"><span class="hs-identifier hs-var">psC</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span id="local-6989586621680986071"><span class="annot"><span class="annottext">lVal :: Value
</span><a href="#local-6989586621680986071"><span class="hs-identifier hs-var hs-var">lVal</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin Liquidity -&gt; Amount Liquidity -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin Liquidity
</span><a href="#local-6989586621680986073"><span class="hs-identifier hs-var">lC</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986080"><span class="hs-identifier hs-var">delL</span></a></span><span>
</span><span id="line-323"></span><span>        </span><span id="local-6989586621680986070"><span class="annot"><span class="annottext">val :: Value
</span><a href="#local-6989586621680986070"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986072"><span class="hs-identifier hs-var">psVal</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A -&gt; Amount A -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986094"><span class="hs-identifier hs-var">apCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986083"><span class="hs-identifier hs-var">newA</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B -&gt; Amount B -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986093"><span class="hs-identifier hs-var">apCoinB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986081"><span class="hs-identifier hs-var">newB</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621680986069"><span class="annot"><span class="annottext">redeemer :: Redeemer
</span><a href="#local-6989586621680986069"><span class="hs-identifier hs-var hs-var">redeemer</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">Redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.toBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction
</span><a href="Plutus.Contracts.Uniswap.Types.html#Add"><span class="hs-identifier hs-var">Add</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>        </span><span id="local-6989586621680986067"><span class="annot"><span class="annottext">lookups :: ScriptLookups Uniswapping
</span><a href="#local-6989586621680986067"><span class="hs-identifier hs-var hs-var">lookups</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; ScriptLookups Uniswapping
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping
</span><a href="#local-6989586621680986077"><span class="hs-identifier hs-var">usInst</span></a></span><span>             </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-327"></span><span>                   </span><span class="annot"><span class="annottext">Validator -&gt; ScriptLookups Uniswapping
forall a. Validator -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1OtherScript</span></a></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621680986076"><span class="hs-identifier hs-var">usScript</span></a></span><span>                     </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-328"></span><span>                   </span><span class="annot"><span class="annottext">MintingPolicy -&gt; ScriptLookups Uniswapping
forall a. MintingPolicy -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1MintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; MintingPolicy
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#liquidityPolicy"><span class="hs-identifier hs-var">liquidityPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986095"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>       </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-329"></span><span>                   </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Uniswapping
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986090"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986089"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>        </span><span id="local-6989586621680986066"><span class="annot"><span class="annottext">tx :: TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986066"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680986075"><span class="hs-identifier hs-var">dat</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986070"><span class="hs-identifier hs-var">val</span></a></span><span>          </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-332"></span><span>                   </span><span class="annot"><span class="annottext">Value -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986071"><span class="hs-identifier hs-var">lVal</span></a></span><span>                  </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-333"></span><span>                   </span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. TxOutRef -&gt; Redeemer -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986090"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621680986069"><span class="hs-identifier hs-var">redeemer</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
forall w (s :: Row *) e.
ToJSON String =&gt;
String -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;val = %s, inVal = %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986070"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986078"><span class="hs-identifier hs-var">inVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
</span><a href="#local-6989586621680986067"><span class="hs-identifier hs-var">lookups</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986066"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
-&gt; Contract w s Text UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
</span><a href="#local-6989586621680986067"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986066"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text UnbalancedTx)
-&gt; Contract w s Text UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text ()) -&gt; Contract w s Text ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text ()
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitTxConfirmed</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;added liquidity to pool: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986088"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="hs-comment">-- | Uses a liquidity pool two swap one sort of coins in the pool against the other.</span><span>
</span><span id="line-344"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#swap"><span class="hs-identifier hs-type">swap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986500"><span class="annot"><a href="#local-6989586621680986500"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986499"><span class="annot"><a href="#local-6989586621680986499"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#SwapParams"><span class="hs-identifier hs-type">SwapParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986500"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986499"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span id="swap"><span class="annot"><span class="annottext">swap :: Uniswap -&gt; SwapParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#swap"><span class="hs-identifier hs-var hs-var">swap</span></a></span></span><span> </span><span id="local-6989586621680986065"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986065"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#SwapParams"><span class="hs-identifier hs-type">SwapParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680986061"><span id="local-6989586621680986062"><span id="local-6989586621680986063"><span id="local-6989586621680986064"><span class="annot"><span class="annottext">Coin A
Coin B
Amount A
Amount B
spAmountB :: Amount B
spAmountA :: Amount A
spCoinB :: Coin B
spCoinA :: Coin A
spAmountB :: SwapParams -&gt; Amount B
spAmountA :: SwapParams -&gt; Amount A
spCoinB :: SwapParams -&gt; Coin B
spCoinA :: SwapParams -&gt; Coin A
</span><a href="#local-6989586621680986061"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986062"><span class="hs-identifier hs-var">spAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986061"><span class="hs-identifier hs-var">spAmountB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986062"><span class="hs-identifier hs-var">spAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986061"><span class="hs-identifier hs-var">spAmountB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;exactly one amount must be positive&quot;</span></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOutRef, DecoratedTxOut, [LiquidityPool])
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986057"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986057"><span class="hs-identifier hs-var">oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986056"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986056"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986055"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986055"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986054"><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986054"><span class="hs-identifier hs-var">liquidity</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
forall w (s :: Row *).
Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactoryAndPool"><span class="hs-identifier hs-var">findUniswapFactoryAndPool</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986065"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986064"><span class="hs-identifier hs-var">spCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986063"><span class="hs-identifier hs-var">spCoinB</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986053"><span class="annot"><span class="annottext">outVal :: Value
</span><a href="#local-6989586621680986053"><span class="hs-identifier hs-var hs-var">outVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value -&gt; DecoratedTxOut -&gt; Value
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value
Lens' DecoratedTxOut Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">decoratedTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986056"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986052"><span class="annot"><span class="annottext">oldA :: Amount A
</span><a href="#local-6989586621680986052"><span class="hs-identifier hs-var hs-var">oldA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin A -&gt; Amount A
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986053"><span class="hs-identifier hs-var">outVal</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986064"><span class="hs-identifier hs-var">spCoinA</span></a></span><span>
</span><span id="line-350"></span><span>        </span><span id="local-6989586621680986051"><span class="annot"><span class="annottext">oldB :: Amount B
</span><a href="#local-6989586621680986051"><span class="hs-identifier hs-var hs-var">oldB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin B -&gt; Amount B
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986053"><span class="hs-identifier hs-var">outVal</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986063"><span class="hs-identifier hs-var">spCoinB</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680986050"><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986050"><span class="hs-identifier hs-var">newA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986049"><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986049"><span class="hs-identifier hs-var">newB</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986062"><span class="hs-identifier hs-var">spAmountA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986048"><span class="annot"><span class="annottext">outB :: Amount B
</span><a href="#local-6989586621680986048"><span class="hs-identifier hs-var hs-var">outB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Amount B
forall a. Integer -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-var">Amount</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Amount B) -&gt; Integer -&gt; Amount B
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount B -&gt; Amount A -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapA"><span class="hs-identifier hs-var">findSwapA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986052"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986051"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986062"><span class="hs-identifier hs-var">spAmountA</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986048"><span class="hs-identifier hs-var">outB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;no payout&quot;</span></span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">(Amount A, Amount B) -&gt; Contract w s Text (Amount A, Amount B)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986052"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Amount A
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986062"><span class="hs-identifier hs-var">spAmountA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986051"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Amount B
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986048"><span class="hs-identifier hs-var">outB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986046"><span class="annot"><span class="annottext">outA :: Amount A
</span><a href="#local-6989586621680986046"><span class="hs-identifier hs-var hs-var">outA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Amount A
forall a. Integer -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-var">Amount</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Amount A) -&gt; Integer -&gt; Amount A
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount B -&gt; Amount B -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapB"><span class="hs-identifier hs-var">findSwapB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986052"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986051"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986061"><span class="hs-identifier hs-var">spAmountB</span></a></span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Contract w s Text () -&gt; Contract w s Text ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986046"><span class="hs-identifier hs-var">outA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s Text () -&gt; Contract w s Text ())
-&gt; Contract w s Text () -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;no payout&quot;</span></span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">(Amount A, Amount B) -&gt; Contract w s Text (Amount A, Amount B)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986052"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Amount A
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986046"><span class="hs-identifier hs-var">outA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986051"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Amount B
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986061"><span class="hs-identifier hs-var">spAmountB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
forall w (s :: Row *) e.
ToJSON String =&gt;
String -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
-&gt; Amount A
-&gt; Amount B
-&gt; Integer
-&gt; Amount A
-&gt; Amount B
-&gt; Integer
-&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oldA = %d, oldB = %d, old product = %d, newA = %d, newB = %d, new product = %d&quot;</span></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986052"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986051"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A -&gt; Integer
forall a. Amount a -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.Types.html#unAmount"><span class="hs-identifier hs-var hs-var">unAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986052"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Integer
forall a. Amount a -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.Types.html#unAmount"><span class="hs-identifier hs-var hs-var">unAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986051"><span class="hs-identifier hs-var">oldB</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986050"><span class="hs-identifier hs-var">newA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986049"><span class="hs-identifier hs-var">newB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A -&gt; Integer
forall a. Amount a -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.Types.html#unAmount"><span class="hs-identifier hs-var hs-var">unAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986050"><span class="hs-identifier hs-var">newA</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Integer
forall a. Amount a -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.Types.html#unAmount"><span class="hs-identifier hs-var hs-var">unAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986049"><span class="hs-identifier hs-var">newB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986043"><span class="annot"><span class="annottext">inst :: TypedValidator Uniswapping
</span><a href="#local-6989586621680986043"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; TypedValidator Uniswapping
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapInstance"><span class="hs-identifier hs-var">uniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986065"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span id="local-6989586621680986042"><span class="annot"><span class="annottext">val :: Value
</span><a href="#local-6989586621680986042"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin A -&gt; Amount A -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986064"><span class="hs-identifier hs-var">spCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986050"><span class="hs-identifier hs-var">newA</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B -&gt; Amount B -&gt; Value
forall a. Coin a -&gt; Amount a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986063"><span class="hs-identifier hs-var">spCoinB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986049"><span class="hs-identifier hs-var">newB</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState -&gt; Value
forall a. Coin a -&gt; Value
</span><a href="Plutus.Contracts.Uniswap.Types.html#unitValue"><span class="hs-identifier hs-var">unitValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986065"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>        </span><span id="local-6989586621680986041"><span class="annot"><span class="annottext">lookups :: ScriptLookups Uniswapping
</span><a href="#local-6989586621680986041"><span class="hs-identifier hs-var hs-var">lookups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; ScriptLookups Uniswapping
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping
</span><a href="#local-6989586621680986043"><span class="hs-identifier hs-var">inst</span></a></span><span>                 </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-366"></span><span>                  </span><span class="annot"><span class="annottext">Validator -&gt; ScriptLookups Uniswapping
forall a. Validator -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.plutusV1OtherScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator Uniswapping -&gt; Validator
forall a. TypedValidator a -&gt; Validator
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.validatorScript</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Uniswapping
</span><a href="#local-6989586621680986043"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; ScriptLookups Uniswapping -&gt; ScriptLookups Uniswapping
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-367"></span><span>                  </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Uniswapping
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986057"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986056"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>        </span><span id="local-6989586621680986040"><span class="annot"><span class="annottext">tx :: TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986040"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; TxConstraints UniswapAction UniswapDatum
forall i o. TxOutRef -&gt; Redeemer -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">mustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680986057"><span class="hs-identifier hs-var">oref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">Redeemer</span></a></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.toBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapAction
</span><a href="Plutus.Contracts.Uniswap.Types.html#Swap"><span class="hs-identifier hs-var">Swap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
-&gt; TxConstraints UniswapAction UniswapDatum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-370"></span><span>                  </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Value -&gt; TxConstraints UniswapAction UniswapDatum
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-ledger-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiquidityPool -&gt; Amount Liquidity -&gt; UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-var">Pool</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986055"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680986054"><span class="hs-identifier hs-var">liquidity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986042"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
-&gt; TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
-&gt; Contract w s Text UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Uniswapping
</span><a href="#local-6989586621680986041"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Uniswapping) (DatumType Uniswapping)
TxConstraints UniswapAction UniswapDatum
</span><a href="#local-6989586621680986040"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text UnbalancedTx)
-&gt; Contract w s Text UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s Text ()) -&gt; Contract w s Text ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s Text ()
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitTxConfirmed</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;swapped with: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986055"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-- | Finds all liquidity pools and their liquidity belonging to the Uniswap instance.</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- This merely inspects the blockchain and does not issue any transactions.</span><span>
</span><span id="line-378"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#pools"><span class="hs-identifier hs-type">pools</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986492"><span class="annot"><a href="#local-6989586621680986492"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986491"><span class="annot"><a href="#local-6989586621680986491"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986492"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986491"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span id="pools"><span class="annot"><span class="annottext">pools :: Uniswap
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#pools"><span class="hs-identifier hs-var hs-var">pools</span></a></span></span><span> </span><span id="local-6989586621680986038"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986038"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-380"></span><span>    </span><span id="local-6989586621680986037"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680986037"><span class="hs-identifier hs-var">utxos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CardanoAddress -&gt; Contract w s Text (Map TxOutRef DecoratedTxOut)
forall w (s :: Row *) e.
AsContractError e =&gt;
CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">utxosAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; CardanoAddress
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapAddress"><span class="hs-identifier hs-var">uniswapAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986038"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><span class="annottext">[DecoratedTxOut]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="#local-6989586621680986035"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">([DecoratedTxOut]
 -&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))])
-&gt; [DecoratedTxOut]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOutRef, DecoratedTxOut) -&gt; DecoratedTxOut
forall a b. (a, b) -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOutRef, DecoratedTxOut) -&gt; DecoratedTxOut)
-&gt; [(TxOutRef, DecoratedTxOut)] -&gt; [DecoratedTxOut]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; [(TxOutRef, DecoratedTxOut)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680986037"><span class="hs-identifier hs-var">utxos</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><a href="#local-6989586621680986035"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">DecoratedTxOut</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986492"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986491"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621680986035"><span class="annot"><span class="annottext">go :: [DecoratedTxOut]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="#local-6989586621680986035"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((Coin A, Amount A), (Coin B, Amount B))]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><a href="#local-6989586621680986035"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680986031"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986031"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621680986030"><span class="annot"><span class="annottext">[DecoratedTxOut]
</span><a href="#local-6989586621680986030"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986029"><span class="annot"><span class="annottext">v :: Value
</span><a href="#local-6989586621680986029"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value -&gt; DecoratedTxOut -&gt; Value
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value
Lens' DecoratedTxOut Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">decoratedTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986031"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin PoolState -&gt; Bool
forall a. Value -&gt; Coin a -&gt; Bool
</span><a href="Plutus.Contracts.Uniswap.Types.html#isUnity"><span class="hs-identifier hs-var">isUnity</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986029"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coin PoolState
</span><a href="#local-6989586621680986027"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-388"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>                </span><span id="local-6989586621680986026"><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680986026"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; Contract w s Text UniswapDatum
forall w (s :: Row *).
DecoratedTxOut -&gt; Contract w s Text UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#getUniswapDatum"><span class="hs-identifier hs-var">getUniswapDatum</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986031"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-390"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680986026"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>                    </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Factory"><span class="hs-identifier hs-type">Factory</span></a></span><span> </span><span class="annot"><span class="annottext">[LiquidityPool]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[DecoratedTxOut]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="#local-6989586621680986035"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[DecoratedTxOut]
</span><a href="#local-6989586621680986030"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-392"></span><span>                    </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-type">Pool</span></a></span><span> </span><span id="local-6989586621680986024"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986024"><span class="hs-identifier hs-var">lp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680986023"><span class="annot"><span class="annottext">coinA :: Coin A
</span><a href="#local-6989586621680986023"><span class="hs-identifier hs-var hs-var">coinA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; Coin A
</span><a href="Plutus.Contracts.Uniswap.Types.html#lpCoinA"><span class="hs-identifier hs-var hs-var">lpCoinA</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986024"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-394"></span><span>                            </span><span id="local-6989586621680986022"><span class="annot"><span class="annottext">coinB :: Coin B
</span><a href="#local-6989586621680986022"><span class="hs-identifier hs-var hs-var">coinB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; Coin B
</span><a href="Plutus.Contracts.Uniswap.Types.html#lpCoinB"><span class="hs-identifier hs-var hs-var">lpCoinB</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680986024"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-395"></span><span>                            </span><span id="local-6989586621680986021"><span class="annot"><span class="annottext">amtA :: Amount A
</span><a href="#local-6989586621680986021"><span class="hs-identifier hs-var hs-var">amtA</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin A -&gt; Amount A
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986029"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986023"><span class="hs-identifier hs-var">coinA</span></a></span><span>
</span><span id="line-396"></span><span>                            </span><span id="local-6989586621680986020"><span class="annot"><span class="annottext">amtB :: Amount B
</span><a href="#local-6989586621680986020"><span class="hs-identifier hs-var hs-var">amtB</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin B -&gt; Amount B
forall a. Value -&gt; Coin a -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#amountOf"><span class="hs-identifier hs-var">amountOf</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680986029"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986022"><span class="hs-identifier hs-var">coinB</span></a></span><span>
</span><span id="line-397"></span><span>                            </span><span id="local-6989586621680986019"><span class="annot"><span class="annottext">s :: ((Coin A, Amount A), (Coin B, Amount B))
</span><a href="#local-6989586621680986019"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680986023"><span class="hs-identifier hs-var">coinA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680986021"><span class="hs-identifier hs-var">amtA</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680986022"><span class="hs-identifier hs-var">coinB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680986020"><span class="hs-identifier hs-var">amtB</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; Contract w s Text ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;found pool: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin A, Amount A), (Coin B, Amount B)) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin A, Amount A), (Coin B, Amount B))
</span><a href="#local-6989586621680986019"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-399"></span><span>                        </span><span id="local-6989586621680986018"><span class="annot"><span class="annottext">[((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="#local-6989586621680986018"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DecoratedTxOut]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="#local-6989586621680986035"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[DecoratedTxOut]
</span><a href="#local-6989586621680986030"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-400"></span><span>                        </span><span class="annot"><span class="annottext">[((Coin A, Amount A), (Coin B, Amount B))]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([((Coin A, Amount A), (Coin B, Amount B))]
 -&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))])
-&gt; [((Coin A, Amount A), (Coin B, Amount B))]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin A, Amount A), (Coin B, Amount B))
</span><a href="#local-6989586621680986019"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin A, Amount A), (Coin B, Amount B))
-&gt; [((Coin A, Amount A), (Coin B, Amount B))]
-&gt; [((Coin A, Amount A), (Coin B, Amount B))]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="#local-6989586621680986018"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-401"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[DecoratedTxOut]
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="#local-6989586621680986035"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[DecoratedTxOut]
</span><a href="#local-6989586621680986030"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>        </span><span class="annot"><a href="#local-6989586621680986027"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#PoolState"><span class="hs-identifier hs-type">PoolState</span></a></span><span>
</span><span id="line-404"></span><span>        </span><span id="local-6989586621680986027"><span class="annot"><span class="annottext">c :: Coin PoolState
</span><a href="#local-6989586621680986027"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986038"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">-- | Gets the caller's funds.</span><span>
</span><span id="line-407"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#funds"><span class="hs-identifier hs-type">funds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986490"><span class="annot"><a href="#local-6989586621680986490"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986489"><span class="annot"><a href="#local-6989586621680986489"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986490"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986489"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-408"></span><span id="funds"><span class="annot"><span class="annottext">funds :: Contract w s Text Value
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#funds"><span class="hs-identifier hs-var hs-var">funds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>    </span><span id="local-6989586621680986017"><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680986017"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Contract w s Text CardanoAddress
forall w (s :: Row *) e.
AsContractError e =&gt;
Contract w s e CardanoAddress
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">Contract.ownAddress</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621680986016"><span class="annot"><span class="annottext">[DecoratedTxOut]
</span><a href="#local-6989586621680986016"><span class="hs-identifier hs-var">os</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((TxOutRef, DecoratedTxOut) -&gt; DecoratedTxOut)
-&gt; [(TxOutRef, DecoratedTxOut)] -&gt; [DecoratedTxOut]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOutRef, DecoratedTxOut) -&gt; DecoratedTxOut
forall a b. (a, b) -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxOutRef, DecoratedTxOut)] -&gt; [DecoratedTxOut])
-&gt; (Map TxOutRef DecoratedTxOut -&gt; [(TxOutRef, DecoratedTxOut)])
-&gt; Map TxOutRef DecoratedTxOut
-&gt; [DecoratedTxOut]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; [(TxOutRef, DecoratedTxOut)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef DecoratedTxOut -&gt; [DecoratedTxOut])
-&gt; Contract w s Text (Map TxOutRef DecoratedTxOut)
-&gt; Contract w s Text [DecoratedTxOut]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress -&gt; Contract w s Text (Map TxOutRef DecoratedTxOut)
forall w (s :: Row *) e.
AsContractError e =&gt;
CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">utxosAt</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680986017"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><span class="annottext">Value -&gt; Contract w s Text Value
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Contract w s Text Value)
-&gt; Value -&gt; Contract w s Text Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value -&gt; DecoratedTxOut -&gt; Value
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value
Lens' DecoratedTxOut Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">decoratedTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986013"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680986013"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986013"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DecoratedTxOut]
</span><a href="#local-6989586621680986016"><span class="hs-identifier hs-var">os</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span id="local-6989586621680986585"><span id="local-6989586621680986586"><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#getUniswapDatum"><span class="hs-identifier hs-type">getUniswapDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">DecoratedTxOut</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986586"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986585"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#UniswapDatum"><span class="hs-identifier hs-type">UniswapDatum</span></a></span></span></span><span>
</span><span id="line-414"></span><span id="getUniswapDatum"><span class="annot"><span class="annottext">getUniswapDatum :: DecoratedTxOut -&gt; Contract w s Text UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#getUniswapDatum"><span class="hs-identifier hs-var hs-var">getUniswapDatum</span></a></span></span><span> </span><span id="local-6989586621680986012"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986012"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680986011"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621680986011"><span class="hs-identifier hs-var">dh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680986010"><span class="annot"><span class="annottext">DatumFromQuery
</span><a href="#local-6989586621680986010"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Contract w s Text (DatumHash, DatumFromQuery)
-&gt; ((DatumHash, DatumFromQuery)
    -&gt; Contract w s Text (DatumHash, DatumFromQuery))
-&gt; Maybe (DatumHash, DatumFromQuery)
-&gt; Contract w s Text (DatumHash, DatumFromQuery)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">maybe</span></a></span><span>
</span><span id="line-416"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text (DatumHash, DatumFromQuery)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;no datum for a txout of a public key address&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>               </span><span class="annot"><span class="annottext">(DatumHash, DatumFromQuery)
-&gt; Contract w s Text (DatumHash, DatumFromQuery)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-418"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680986012"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; Getting
     (First (DatumHash, DatumFromQuery))
     DecoratedTxOut
     (DatumHash, DatumFromQuery)
-&gt; Maybe (DatumHash, DatumFromQuery)
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (First (DatumHash, DatumFromQuery))
  DecoratedTxOut
  (DatumHash, DatumFromQuery)
Traversal' DecoratedTxOut (DatumHash, DatumFromQuery)
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">decoratedTxOutScriptDatum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Datum</span></a></span><span> </span><span id="local-6989586621680986007"><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621680986007"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Contract w s Text Datum
-&gt; (Datum -&gt; Contract w s Text Datum)
-&gt; Maybe Datum
-&gt; Contract w s Text Datum
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatumHash -&gt; Contract w s Text Datum
forall w (s :: Row *). DatumHash -&gt; Contract w s Text Datum
</span><a href="#local-6989586621680986006"><span class="hs-identifier hs-var">getDatum</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621680986011"><span class="hs-identifier hs-var">dh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Contract w s Text Datum
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatumFromQuery
</span><a href="#local-6989586621680986010"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">DatumFromQuery
-&gt; Getting (First Datum) DatumFromQuery Datum -&gt; Maybe Datum
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (First Datum) DatumFromQuery Datum
Traversal' DatumFromQuery Datum
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">datumInDatumFromQuery</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="annottext">Contract w s Text UniswapDatum
-&gt; (UniswapDatum -&gt; Contract w s Text UniswapDatum)
-&gt; Maybe UniswapDatum
-&gt; Contract w s Text UniswapDatum
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text UniswapDatum
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum hash wrong type&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>        </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Contract w s Text UniswapDatum
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Maybe UniswapDatum
forall a. FromData a =&gt; BuiltinData -&gt; Maybe a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">PlutusTx.fromBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621680986007"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-424"></span><span>    </span><span id="local-6989586621680986564"><span id="local-6989586621680986565"><span class="annot"><a href="#local-6989586621680986006"><span class="hs-identifier hs-type">getDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">DatumHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986565"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986564"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Datum</span></a></span></span></span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621680986006"><span class="annot"><span class="annottext">getDatum :: DatumHash -&gt; Contract w s Text Datum
</span><a href="#local-6989586621680986006"><span class="hs-identifier hs-var hs-var">getDatum</span></a></span></span><span> </span><span id="local-6989586621680986004"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621680986004"><span class="hs-identifier hs-var">dh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-426"></span><span>      </span><span class="annot"><span class="annottext">DatumHash -&gt; Contract w s Text (Maybe Datum)
forall w (s :: Row *) e.
AsContractError e =&gt;
DatumHash -&gt; Contract w s e (Maybe Datum)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">datumFromHash</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621680986004"><span class="hs-identifier hs-var">dh</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s Text (Maybe Datum)
-&gt; (Maybe Datum -&gt; Contract w s Text Datum)
-&gt; Contract w s Text Datum
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="annot"><span class="annottext">Maybe Datum
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text Datum
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;datum not found&quot;</span></span><span>
</span><span id="line-427"></span><span>                                 </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680986002"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621680986002"><span class="hs-identifier hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Contract w s Text Datum
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621680986002"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapInstance"><span class="hs-identifier hs-type">findUniswapInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986550"><span class="annot"><a href="#local-6989586621680986550"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680986551"><span class="annot"><a href="#local-6989586621680986551"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621680986549"><span class="annot"><a href="#local-6989586621680986549"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986548"><span class="annot"><a href="#local-6989586621680986548"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986551"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#UniswapDatum"><span class="hs-identifier hs-type">UniswapDatum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986550"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986549"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986548"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">TxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">DecoratedTxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680986550"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span id="findUniswapInstance"><span class="annot"><span class="annottext">findUniswapInstance :: Uniswap
-&gt; Coin b
-&gt; (UniswapDatum -&gt; Maybe a)
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapInstance"><span class="hs-identifier hs-var hs-var">findUniswapInstance</span></a></span></span><span> </span><span id="local-6989586621680986000"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986000"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621680985999"><span class="annot"><span class="annottext">Coin b
</span><a href="#local-6989586621680985999"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680985998"><span class="annot"><span class="annottext">UniswapDatum -&gt; Maybe a
</span><a href="#local-6989586621680985998"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680985997"><span class="annot"><span class="annottext">addr :: CardanoAddress
</span><a href="#local-6989586621680985997"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap -&gt; CardanoAddress
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#uniswapAddress"><span class="hs-identifier hs-var">uniswapAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680986000"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
forall w (s :: Row *) e.
ToJSON String =&gt;
String -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;looking for Uniswap instance at address %s containing coin %s &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoAddress -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680985997"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin b -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Coin b
</span><a href="#local-6989586621680985999"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>    </span><span id="local-6989586621680985996"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680985996"><span class="hs-identifier hs-var">utxos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CardanoAddress -&gt; Contract w s Text (Map TxOutRef DecoratedTxOut)
forall w (s :: Row *) e.
AsContractError e =&gt;
CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">utxosAt</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680985997"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><span class="annottext">[(TxOutRef, DecoratedTxOut)]
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
</span><a href="#local-6989586621680985995"><span class="hs-identifier hs-var">go</span></a></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(TxOutRef, DecoratedTxOut)
</span><a href="#local-6989586621680985994"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680985994"><span class="annot"><span class="annottext">x :: (TxOutRef, DecoratedTxOut)
</span><a href="#local-6989586621680985994"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985993"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985993"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; [(TxOutRef, DecoratedTxOut)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../file:///nix/store/5giw0zbshrdz1qlvzc0csv9mspljr1ax-containers-lib-containers-0.6.5.1-haddock-doc/share/doc/containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680985996"><span class="hs-identifier hs-var">utxos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin b -&gt; Bool
forall a. Value -&gt; Coin a -&gt; Bool
</span><a href="Plutus.Contracts.Uniswap.Types.html#isUnity"><span class="hs-identifier hs-var">isUnity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value -&gt; DecoratedTxOut -&gt; Value
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../file:///nix/store/lwkxqy8dgzjvz62gfx89dnvl9mm03scy-lens-lib-lens-4.19.2-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value
Lens' DecoratedTxOut Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">decoratedTxOutValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985993"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin b
</span><a href="#local-6989586621680985999"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621680985995"><span class="annot"><span class="annottext">go :: [(TxOutRef, DecoratedTxOut)]
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
</span><a href="#local-6989586621680985995"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Uniswap instance not found&quot;</span></span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="#local-6989586621680985995"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680985992"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680985992"><span class="hs-identifier hs-var">oref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985991"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985991"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621680985990"><span class="annot"><span class="annottext">[(TxOutRef, DecoratedTxOut)]
</span><a href="#local-6989586621680985990"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>        </span><span id="local-6989586621680985989"><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680985989"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; Contract w s Text UniswapDatum
forall w (s :: Row *).
DecoratedTxOut -&gt; Contract w s Text UniswapDatum
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#getUniswapDatum"><span class="hs-identifier hs-var">getUniswapDatum</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985991"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniswapDatum -&gt; Maybe a
</span><a href="#local-6989586621680985998"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680985989"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-445"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(TxOutRef, DecoratedTxOut)]
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
</span><a href="#local-6989586621680985995"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxOutRef, DecoratedTxOut)]
</span><a href="#local-6989586621680985990"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-446"></span><span>            </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680985988"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985988"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-447"></span><span>                </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
forall w (s :: Row *) e.
ToJSON String =&gt;
String -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">logInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Contract w s Text ()) -&gt; String -&gt; Contract w s Text ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;found Uniswap instance with datum: %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniswapDatum -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UniswapDatum
</span><a href="#local-6989586621680985989"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>                </span><span class="annot"><span class="annottext">(TxOutRef, DecoratedTxOut, a)
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680985992"><span class="hs-identifier hs-var">oref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985991"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985988"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactory"><span class="hs-identifier hs-type">findUniswapFactory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986645"><span class="annot"><a href="#local-6989586621680986645"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986644"><span class="annot"><a href="#local-6989586621680986644"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986645"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986644"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">TxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">DecoratedTxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#LiquidityPool"><span class="hs-identifier hs-type">LiquidityPool</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span id="findUniswapFactory"><span class="annot"><span class="annottext">findUniswapFactory :: Uniswap
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool])
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactory"><span class="hs-identifier hs-var hs-var">findUniswapFactory</span></a></span></span><span> </span><span id="local-6989586621680985987"><span class="annot"><span class="annottext">us :: Uniswap
</span><a href="#local-6989586621680985987"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span class="hs-special">{</span><span id="local-6989586621680985986"><span class="annot"><span class="annottext">Coin U
usCoin :: Coin U
usCoin :: Uniswap -&gt; Coin U
</span><a href="#local-6989586621680985986"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Coin U
-&gt; (UniswapDatum -&gt; Maybe [LiquidityPool])
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool])
forall a b w (s :: Row *).
Uniswap
-&gt; Coin b
-&gt; (UniswapDatum -&gt; Maybe a)
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapInstance"><span class="hs-identifier hs-var">findUniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985987"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">Coin U
</span><a href="#local-6989586621680985986"><span class="hs-identifier hs-var">usCoin</span></a></span><span> </span><span class="annot"><span class="annottext">((UniswapDatum -&gt; Maybe [LiquidityPool])
 -&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool]))
-&gt; (UniswapDatum -&gt; Maybe [LiquidityPool])
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Factory"><span class="hs-identifier hs-type">Factory</span></a></span><span> </span><span id="local-6989586621680985985"><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680985985"><span class="hs-identifier hs-var">lps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LiquidityPool] -&gt; Maybe [LiquidityPool]
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680985985"><span class="hs-identifier hs-var">lps</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-type">Pool</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [LiquidityPool]
forall a. Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapPool"><span class="hs-identifier hs-type">findUniswapPool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986543"><span class="annot"><a href="#local-6989586621680986543"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986542"><span class="annot"><a href="#local-6989586621680986542"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#LiquidityPool"><span class="hs-identifier hs-type">LiquidityPool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986543"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986542"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">TxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">DecoratedTxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Liquidity"><span class="hs-identifier hs-type">Liquidity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span id="findUniswapPool"><span class="annot"><span class="annottext">findUniswapPool :: Uniswap
-&gt; LiquidityPool
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, Amount Liquidity)
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapPool"><span class="hs-identifier hs-var hs-var">findUniswapPool</span></a></span></span><span> </span><span id="local-6989586621680985983"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985983"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621680985982"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985982"><span class="hs-identifier hs-var">lp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Coin PoolState
-&gt; (UniswapDatum -&gt; Maybe (Amount Liquidity))
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, Amount Liquidity)
forall a b w (s :: Row *).
Uniswap
-&gt; Coin b
-&gt; (UniswapDatum -&gt; Maybe a)
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, a)
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapInstance"><span class="hs-identifier hs-var">findUniswapInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985983"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Uniswap -&gt; Coin PoolState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#poolStateCoin"><span class="hs-identifier hs-var">poolStateCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985983"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((UniswapDatum -&gt; Maybe (Amount Liquidity))
 -&gt; Contract w s Text (TxOutRef, DecoratedTxOut, Amount Liquidity))
-&gt; (UniswapDatum -&gt; Maybe (Amount Liquidity))
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, Amount Liquidity)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-457"></span><span>        </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Pool"><span class="hs-identifier hs-type">Pool</span></a></span><span> </span><span id="local-6989586621680985981"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985981"><span class="hs-identifier hs-var">lp'</span></a></span></span><span> </span><span id="local-6989586621680985980"><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680985980"><span class="hs-identifier hs-var">l</span></a></span></span><span>
</span><span id="line-458"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985982"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; LiquidityPool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985981"><span class="hs-identifier hs-var">lp'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Amount Liquidity -&gt; Maybe (Amount Liquidity)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680985980"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-459"></span><span>        </span><span class="annot"><span class="annottext">UniswapDatum
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Amount Liquidity)
forall a. Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactoryAndPool"><span class="hs-identifier hs-type">findUniswapFactoryAndPool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986626"><span class="annot"><a href="#local-6989586621680986626"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680986625"><span class="annot"><a href="#local-6989586621680986625"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-462"></span><span>                          </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span>
</span><span id="line-463"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span>
</span><span id="line-464"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span>
</span><span id="line-465"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986626"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986625"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">TxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">DecoratedTxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#LiquidityPool"><span class="hs-identifier hs-type">LiquidityPool</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">TxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">DecoratedTxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#LiquidityPool"><span class="hs-identifier hs-type">LiquidityPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Liquidity"><span class="hs-identifier hs-type">Liquidity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                                               </span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span id="findUniswapFactoryAndPool"><span class="annot"><span class="annottext">findUniswapFactoryAndPool :: Uniswap
-&gt; Coin A
-&gt; Coin B
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactoryAndPool"><span class="hs-identifier hs-var hs-var">findUniswapFactoryAndPool</span></a></span></span><span> </span><span id="local-6989586621680985979"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985979"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621680985978"><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680985978"><span class="hs-identifier hs-var">coinA</span></a></span></span><span> </span><span id="local-6989586621680985977"><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680985977"><span class="hs-identifier hs-var">coinB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680985976"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680985976"><span class="hs-identifier hs-var">oref1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985975"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985975"><span class="hs-identifier hs-var">o1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985974"><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680985974"><span class="hs-identifier hs-var">lps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool])
forall w (s :: Row *).
Uniswap
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, [LiquidityPool])
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapFactory"><span class="hs-identifier hs-var">findUniswapFactory</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985979"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985973"><span class="hs-identifier hs-var">lp'</span></a></span><span>
</span><span id="line-471"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680985973"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985973"><span class="hs-identifier hs-var">lp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680985974"><span class="hs-identifier hs-var">lps</span></a></span><span>
</span><span id="line-472"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985973"><span class="hs-identifier hs-var">lp'</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool -&gt; LiquidityPool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A -&gt; Coin B -&gt; LiquidityPool
</span><a href="Plutus.Contracts.Uniswap.Types.html#LiquidityPool"><span class="hs-identifier hs-var">LiquidityPool</span></a></span><span> </span><span class="annot"><span class="annottext">Coin A
</span><a href="#local-6989586621680985978"><span class="hs-identifier hs-var">coinA</span></a></span><span> </span><span class="annot"><span class="annottext">Coin B
</span><a href="#local-6989586621680985977"><span class="hs-identifier hs-var">coinB</span></a></span><span>
</span><span id="line-473"></span><span>         </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621680985972"><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985972"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-475"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680985971"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680985971"><span class="hs-identifier hs-var">oref2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985970"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985970"><span class="hs-identifier hs-var">o2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680985969"><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680985969"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; LiquidityPool
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, Amount Liquidity)
forall w (s :: Row *).
Uniswap
-&gt; LiquidityPool
-&gt; Contract w s Text (TxOutRef, DecoratedTxOut, Amount Liquidity)
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findUniswapPool"><span class="hs-identifier hs-var">findUniswapPool</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985979"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985972"><span class="hs-identifier hs-var">lp</span></a></span><span>
</span><span id="line-476"></span><span>            </span><span class="annot"><span class="annottext">((TxOutRef, DecoratedTxOut, [LiquidityPool]),
 (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680985976"><span class="hs-identifier hs-var">oref1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985975"><span class="hs-identifier hs-var">o1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LiquidityPool]
</span><a href="#local-6989586621680985974"><span class="hs-identifier hs-var">lps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680985971"><span class="hs-identifier hs-var">oref2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621680985970"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LiquidityPool
</span><a href="#local-6989586621680985972"><span class="hs-identifier hs-var">lp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Amount Liquidity
</span><a href="#local-6989586621680985969"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>                   </span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>        </span><span class="annot"><span class="annottext">[LiquidityPool]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Contract
     w
     s
     Text
     ((TxOutRef, DecoratedTxOut, [LiquidityPool]),
      (TxOutRef, DecoratedTxOut, LiquidityPool, Amount Liquidity))
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../file:///nix/store/50z9mfcyab831xv3ljzrgw24b0c22y3g-mtl-lib-mtl-2.2.2-haddock-doc/share/doc/mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;liquidity pool not found&quot;</span></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapA"><span class="hs-identifier hs-type">findSwapA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-482"></span><span id="findSwapA"><span class="annot"><span class="annottext">findSwapA :: Amount A -&gt; Amount B -&gt; Amount A -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapA"><span class="hs-identifier hs-var hs-var">findSwapA</span></a></span></span><span> </span><span id="local-6989586621680985968"><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680985968"><span class="hs-identifier hs-var">oldA</span></a></span></span><span> </span><span id="local-6989586621680985967"><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680985967"><span class="hs-identifier hs-var">oldB</span></a></span></span><span> </span><span id="local-6989586621680985966"><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680985966"><span class="hs-identifier hs-var">inA</span></a></span></span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985965"><span class="hs-identifier hs-var">ub'</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621680985964"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985965"><span class="hs-identifier hs-var">ub'</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="#local-6989586621680985963"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span id="local-6989586621680985963"><span class="annot"><span class="annottext">cs :: Integer -&gt; Bool
</span><a href="#local-6989586621680985963"><span class="hs-identifier hs-var hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621680985962"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985962"><span class="hs-identifier hs-var">outB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount B -&gt; Amount A -&gt; Amount B -&gt; Bool
</span><a href="Plutus.Contracts.Uniswap.Pool.html#checkSwap"><span class="hs-identifier hs-var">checkSwap</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680985968"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680985967"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680985968"><span class="hs-identifier hs-var">oldA</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount A -&gt; Amount A
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680985966"><span class="hs-identifier hs-var">inA</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680985967"><span class="hs-identifier hs-var">oldB</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B -&gt; Amount B -&gt; Amount B
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Amount B
forall a. Integer -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-var">Amount</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985962"><span class="hs-identifier hs-var">outB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="#local-6989586621680985965"><span class="hs-identifier hs-type">ub'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span id="local-6989586621680985965"><span class="annot"><span class="annottext">ub' :: Integer
</span><a href="#local-6989586621680985965"><span class="hs-identifier hs-var hs-var">ub'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Integer] -&gt; Integer
forall a. [a] -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([Integer] -&gt; Integer) -&gt; [Integer] -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Bool) -&gt; [Integer] -&gt; [Integer]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">dropWhile</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Bool
</span><a href="#local-6989586621680985963"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">^</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985959"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680985959"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680985959"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="#local-6989586621680985964"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621680985964"><span class="annot"><span class="annottext">go :: Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621680985964"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680985958"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985958"><span class="hs-identifier hs-var">lb</span></a></span></span><span> </span><span id="local-6989586621680985957"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985957"><span class="hs-identifier hs-var">ub</span></a></span></span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985957"><span class="hs-identifier hs-var">ub</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985958"><span class="hs-identifier hs-var">lb</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985958"><span class="hs-identifier hs-var">lb</span></a></span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-497"></span><span>        </span><span id="local-6989586621680985956"><span class="annot"><span class="annottext">m :: Integer
</span><a href="#local-6989586621680985956"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">div</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985957"><span class="hs-identifier hs-var">ub</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985958"><span class="hs-identifier hs-var">lb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span>
</span><span id="line-498"></span><span>      </span><span class="hs-keyword">in</span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Bool
</span><a href="#local-6989586621680985963"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985956"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621680985964"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985956"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985957"><span class="hs-identifier hs-var">ub</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621680985964"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985958"><span class="hs-identifier hs-var">lb</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680985956"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapB"><span class="hs-identifier hs-type">findSwapB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#A"><span class="hs-identifier hs-type">A</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-type">Amount</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#B"><span class="hs-identifier hs-type">B</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-502"></span><span id="findSwapB"><span class="annot"><span class="annottext">findSwapB :: Amount A -&gt; Amount B -&gt; Amount B -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapB"><span class="hs-identifier hs-var hs-var">findSwapB</span></a></span></span><span> </span><span id="local-6989586621680985955"><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680985955"><span class="hs-identifier hs-var">oldA</span></a></span></span><span> </span><span id="local-6989586621680985954"><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680985954"><span class="hs-identifier hs-var">oldB</span></a></span></span><span> </span><span id="local-6989586621680985953"><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680985953"><span class="hs-identifier hs-var">inB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Amount A -&gt; Amount B -&gt; Amount A -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#findSwapA"><span class="hs-identifier hs-var">findSwapA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount B -&gt; Amount A
forall a a. Amount a -&gt; Amount a
</span><a href="#local-6989586621680985952"><span class="hs-identifier hs-var">switch</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680985954"><span class="hs-identifier hs-var">oldB</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount A -&gt; Amount B
forall a a. Amount a -&gt; Amount a
</span><a href="#local-6989586621680985952"><span class="hs-identifier hs-var">switch</span></a></span><span> </span><span class="annot"><span class="annottext">Amount A
</span><a href="#local-6989586621680985955"><span class="hs-identifier hs-var">oldA</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Amount B -&gt; Amount A
forall a a. Amount a -&gt; Amount a
</span><a href="#local-6989586621680985952"><span class="hs-identifier hs-var">switch</span></a></span><span> </span><span class="annot"><span class="annottext">Amount B
</span><a href="#local-6989586621680985953"><span class="hs-identifier hs-var">inB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-504"></span><span>    </span><span id="local-6989586621680985952"><span class="annot"><span class="annottext">switch :: Amount a -&gt; Amount a
</span><a href="#local-6989586621680985952"><span class="hs-identifier hs-var hs-var">switch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Amount a
forall a. Integer -&gt; Amount a
</span><a href="Plutus.Contracts.Uniswap.Types.html#Amount"><span class="hs-identifier hs-var">Amount</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Amount a)
-&gt; (Amount a -&gt; Integer) -&gt; Amount a -&gt; Amount a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Amount a -&gt; Integer
forall a. Amount a -&gt; Integer
</span><a href="Plutus.Contracts.Uniswap.Types.html#unAmount"><span class="hs-identifier hs-var hs-var">unAmount</span></a></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#ownerEndpoint"><span class="hs-identifier hs-type">ownerEndpoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">EmptySchema</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span id="ownerEndpoint"><span class="annot"><span class="annottext">ownerEndpoint :: Contract (Last (Either Text Uniswap)) EmptySchema ContractError ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#ownerEndpoint"><span class="hs-identifier hs-var hs-var">ownerEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621680985951"><span class="annot"><span class="annottext">Either Text Uniswap
</span><a href="#local-6989586621680985951"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Void -&gt; ContractError)
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema Void (Either Text Uniswap)
-&gt; Contract
     (Last (Either Text Uniswap))
     EmptySchema
     ContractError
     (Either Text Uniswap)
forall w (s :: Row *) e e' a.
(e -&gt; e') -&gt; Contract w s e a -&gt; Contract w s e' a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mapError</span></a></span><span> </span><span class="annot"><span class="annottext">Void -&gt; ContractError
forall a. Void -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">absurd</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract
   (Last (Either Text Uniswap)) EmptySchema Void (Either Text Uniswap)
 -&gt; Contract
      (Last (Either Text Uniswap))
      EmptySchema
      ContractError
      (Either Text Uniswap))
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema Void (Either Text Uniswap)
-&gt; Contract
     (Last (Either Text Uniswap))
     EmptySchema
     ContractError
     (Either Text Uniswap)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Contract (Last (Either Text Uniswap)) EmptySchema Text Uniswap
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema Void (Either Text Uniswap)
forall w (s :: Row *) e e0 a.
Contract w s e a -&gt; Contract w s e0 (Either e a)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">runError</span></a></span><span> </span><span class="annot"><span class="annottext">Contract (Last (Either Text Uniswap)) EmptySchema Text Uniswap
forall w (s :: Row *). Contract w s Text Uniswap
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#start"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="annottext">Contract
  (Last (Either Text Uniswap)) EmptySchema ContractError Slot
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema ContractError ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract
   (Last (Either Text Uniswap)) EmptySchema ContractError Slot
 -&gt; Contract
      (Last (Either Text Uniswap)) EmptySchema ContractError ())
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema ContractError Slot
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema ContractError ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema ContractError Slot
forall w (s :: Row *) e.
AsContractError e =&gt;
Natural -&gt; Contract w s e Slot
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">waitNSlots</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><span class="annottext">Last (Either Text Uniswap)
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema ContractError ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">(Last (Either Text Uniswap)
 -&gt; Contract
      (Last (Either Text Uniswap)) EmptySchema ContractError ())
-&gt; Last (Either Text Uniswap)
-&gt; Contract
     (Last (Either Text Uniswap)) EmptySchema ContractError ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either Text Uniswap) -&gt; Last (Either Text Uniswap)
forall a. Maybe a -&gt; Last a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Last</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either Text Uniswap) -&gt; Last (Either Text Uniswap))
-&gt; Maybe (Either Text Uniswap) -&gt; Last (Either Text Uniswap)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either Text Uniswap -&gt; Maybe (Either Text Uniswap)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Either Text Uniswap
</span><a href="#local-6989586621680985951"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-comment">-- | Provides the following endpoints for users of a Uniswap instance:</span><span>
</span><span id="line-513"></span><span class="hs-comment">--</span><span>
</span><span id="line-514"></span><span class="hs-comment">--      [@create@]: Creates a liquidity pool for a pair of coins. The creator provides liquidity for both coins and gets liquidity tokens in return.</span><span>
</span><span id="line-515"></span><span class="hs-comment">--      [@swap@]: Uses a liquidity pool two swap one sort of coins in the pool against the other.</span><span>
</span><span id="line-516"></span><span class="hs-comment">--      [@close@]: Closes a liquidity pool by burning all remaining liquidity tokens in exchange for all liquidity remaining in the pool.</span><span>
</span><span id="line-517"></span><span class="hs-comment">--      [@remove@]: Removes some liquidity from a liquidity pool in exchange for liquidity tokens.</span><span>
</span><span id="line-518"></span><span class="hs-comment">--      [@add@]: Adds some liquidity to an existing liquidity pool in exchange for newly minted liquidity tokens.</span><span>
</span><span id="line-519"></span><span class="hs-comment">--      [@pools@]: Finds all liquidity pools and their liquidity belonging to the Uniswap instance. This merely inspects the blockchain and does not issue any transactions.</span><span>
</span><span id="line-520"></span><span class="hs-comment">--      [@funds@]: Gets the caller's funds. This merely inspects the blockchain and does not issue any transactions.</span><span>
</span><span id="line-521"></span><span class="hs-comment">--      [@stop@]: Stops the contract.</span><span>
</span><span id="line-522"></span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#userEndpoints"><span class="hs-identifier hs-type">userEndpoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Promise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UserContractState"><span class="hs-identifier hs-type">UserContractState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapUserSchema"><span class="hs-identifier hs-type">UniswapUserSchema</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span id="userEndpoints"><span class="annot"><span class="annottext">userEndpoints :: Uniswap
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#userEndpoints"><span class="hs-identifier hs-var hs-var">userEndpoints</span></a></span></span><span> </span><span id="local-6989586621680985947"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985947"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState)) UniswapUserSchema Void ()
Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
</span><a href="#local-6989586621680985946"><span class="hs-identifier hs-var">stop</span></a></span><span>
</span><span id="line-525"></span><span>        </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e a.
Promise w s e a -&gt; Promise w s e a -&gt; Promise w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-operator hs-var">`select`</span></a></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;create&quot;
-&gt; (() -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; CreateParams
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text ())
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
forall (l :: Symbol) a p.
(HasEndpoint l p UniswapUserSchema, FromJSON p) =&gt;
Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;create&quot;
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;create&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserContractState -&gt; () -&gt; UserContractState
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Created"><span class="hs-identifier hs-var">Created</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; CreateParams
-&gt; Contract
     (Last (Either Text UserContractState)) UniswapUserSchema Text ()
forall w (s :: Row *).
Uniswap -&gt; CreateParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#create"><span class="hs-identifier hs-var">create</span></a></span><span>                 </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e a.
Promise w s e a -&gt; Promise w s e a -&gt; Promise w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-operator hs-var">`select`</span></a></span><span>
</span><span id="line-527"></span><span>           </span><span class="annot"><span class="annottext">Proxy &quot;swap&quot;
-&gt; (() -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; SwapParams
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text ())
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
forall (l :: Symbol) a p.
(HasEndpoint l p UniswapUserSchema, FromJSON p) =&gt;
Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;swap&quot;
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;swap&quot;</span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserContractState -&gt; () -&gt; UserContractState
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Swapped"><span class="hs-identifier hs-var">Swapped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; SwapParams
-&gt; Contract
     (Last (Either Text UserContractState)) UniswapUserSchema Text ()
forall w (s :: Row *).
Uniswap -&gt; SwapParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#swap"><span class="hs-identifier hs-var">swap</span></a></span><span>                   </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e a.
Promise w s e a -&gt; Promise w s e a -&gt; Promise w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-operator hs-var">`select`</span></a></span><span>
</span><span id="line-528"></span><span>           </span><span class="annot"><span class="annottext">Proxy &quot;close&quot;
-&gt; (() -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; CloseParams
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text ())
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
forall (l :: Symbol) a p.
(HasEndpoint l p UniswapUserSchema, FromJSON p) =&gt;
Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;close&quot;
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;close&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserContractState -&gt; () -&gt; UserContractState
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Uniswap
-&gt; CloseParams
-&gt; Contract
     (Last (Either Text UserContractState)) UniswapUserSchema Text ()
forall w (s :: Row *).
Uniswap -&gt; CloseParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#close"><span class="hs-identifier hs-var">close</span></a></span><span>                  </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e a.
Promise w s e a -&gt; Promise w s e a -&gt; Promise w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-operator hs-var">`select`</span></a></span><span>
</span><span id="line-529"></span><span>           </span><span class="annot"><span class="annottext">Proxy &quot;remove&quot;
-&gt; (() -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; RemoveParams
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text ())
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
forall (l :: Symbol) a p.
(HasEndpoint l p UniswapUserSchema, FromJSON p) =&gt;
Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;remove&quot;
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;remove&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserContractState -&gt; () -&gt; UserContractState
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Removed"><span class="hs-identifier hs-var">Removed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; RemoveParams
-&gt; Contract
     (Last (Either Text UserContractState)) UniswapUserSchema Text ()
forall w (s :: Row *).
Uniswap -&gt; RemoveParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#remove"><span class="hs-identifier hs-var">remove</span></a></span><span>                 </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e a.
Promise w s e a -&gt; Promise w s e a -&gt; Promise w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-operator hs-var">`select`</span></a></span><span>
</span><span id="line-530"></span><span>           </span><span class="annot"><span class="annottext">Proxy &quot;add&quot;
-&gt; (() -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; AddParams
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text ())
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
forall (l :: Symbol) a p.
(HasEndpoint l p UniswapUserSchema, FromJSON p) =&gt;
Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;add&quot;
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;add&quot;</span></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UserContractState -&gt; () -&gt; UserContractState
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Added"><span class="hs-identifier hs-var">Added</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">Uniswap
-&gt; AddParams
-&gt; Contract
     (Last (Either Text UserContractState)) UniswapUserSchema Text ()
forall w (s :: Row *). Uniswap -&gt; AddParams -&gt; Contract w s Text ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#add"><span class="hs-identifier hs-var">add</span></a></span><span>                    </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e a.
Promise w s e a -&gt; Promise w s e a -&gt; Promise w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-operator hs-var">`select`</span></a></span><span>
</span><span id="line-531"></span><span>           </span><span class="annot"><span class="annottext">Proxy &quot;pools&quot;
-&gt; ([((Coin A, Amount A), (Coin B, Amount B))]
    -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; ()
    -&gt; Contract
         (Last (Either Text UserContractState))
         UniswapUserSchema
         Text
         [((Coin A, Amount A), (Coin B, Amount B))])
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
forall (l :: Symbol) a p.
(HasEndpoint l p UniswapUserSchema, FromJSON p) =&gt;
Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;pools&quot;
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;pools&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">[((Coin A, Amount A), (Coin B, Amount B))] -&gt; UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Pools"><span class="hs-identifier hs-var">Pools</span></a></span><span>           </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985942"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985942"><span class="hs-identifier hs-var">us'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Text
     [((Coin A, Amount A), (Coin B, Amount B))]
forall w (s :: Row *).
Uniswap
-&gt; Contract w s Text [((Coin A, Amount A), (Coin B, Amount B))]
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#pools"><span class="hs-identifier hs-var">pools</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985942"><span class="hs-identifier hs-var">us'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e a.
Promise w s e a -&gt; Promise w s e a -&gt; Promise w s e a
</span><a href="../../../../plutus-contract/html/src"><span class="hs-operator hs-var">`select`</span></a></span><span>
</span><span id="line-532"></span><span>           </span><span class="annot"><span class="annottext">Proxy &quot;funds&quot;
-&gt; (Value -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; ()
    -&gt; Contract
         (Last (Either Text UserContractState))
         UniswapUserSchema
         Text
         Value)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
forall (l :: Symbol) a p.
(HasEndpoint l p UniswapUserSchema, FromJSON p) =&gt;
Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;funds&quot;
forall k (t :: k). Proxy t
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;funds&quot;</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Value -&gt; UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Funds"><span class="hs-identifier hs-var">Funds</span></a></span><span>           </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680985941"><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985941"><span class="hs-identifier hs-var">_us</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Contract
  (Last (Either Text UserContractState)) UniswapUserSchema Text Value
forall w (s :: Row *). Contract w s Text Value
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#funds"><span class="hs-identifier hs-var">funds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>     </span><span class="annot"><span class="annottext">Promise
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Void
  ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#userEndpoints"><span class="hs-identifier hs-var">userEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985947"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><a href="#local-6989586621680985944"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680986508"><span class="annot"><a href="#local-6989586621680986508"><span class="hs-identifier hs-type">l</span></a></span></span><span> </span><span id="local-6989586621680986505"><span class="annot"><a href="#local-6989586621680986505"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680986507"><span class="annot"><a href="#local-6989586621680986507"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-536"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">HasEndpoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986508"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986507"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapUserSchema"><span class="hs-identifier hs-type">UniswapUserSchema</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/2m29g1mlr4lg9v93x77b5w3l6pyhq2vj-aeson-lib-aeson-2.0.2.0-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986507"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986508"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-538"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680986505"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UserContractState"><span class="hs-identifier hs-type">UserContractState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Uniswap.Types.html#Uniswap"><span class="hs-identifier hs-type">Uniswap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680986507"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UserContractState"><span class="hs-identifier hs-type">UserContractState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapUserSchema"><span class="hs-identifier hs-type">UniswapUserSchema</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680986505"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Promise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UserContractState"><span class="hs-identifier hs-type">UserContractState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapUserSchema"><span class="hs-identifier hs-type">UniswapUserSchema</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621680985944"><span class="annot"><span class="annottext">f :: Proxy l
-&gt; (a -&gt; UserContractState)
-&gt; (Uniswap
    -&gt; p
    -&gt; Contract
         (Last (Either Text UserContractState)) UniswapUserSchema Text a)
-&gt; Promise
     (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985944"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy l
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680985940"><span class="annot"><span class="annottext">a -&gt; UserContractState
</span><a href="#local-6989586621680985940"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621680985939"><span class="annot"><span class="annottext">Uniswap
-&gt; p
-&gt; Contract
     (Last (Either Text UserContractState)) UniswapUserSchema Text a
</span><a href="#local-6989586621680985939"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e1 e2 b.
(HasEndpoint l a s, AsContractError e1, FromJSON a) =&gt;
(Either e1 a -&gt; Contract w s e2 b) -&gt; Promise w s e2 b
forall (l :: Symbol) a w (s :: Row *) e1 e2 b.
(HasEndpoint l a s, AsContractError e1, FromJSON a) =&gt;
(Either e1 a -&gt; Contract w s e2 b) -&gt; Promise w s e2 b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">handleEndpoint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680986508"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><span class="annottext">((Either Text p
  -&gt; Contract
       (Last (Either Text UserContractState))
       ('R
          '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
             &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
             &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
             &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
             &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
             &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
             &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
             &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
       Void
       ())
 -&gt; Promise
      (Last (Either Text UserContractState))
      ('R
         '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
            &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
            &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
            &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
            &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
      Void
      ())
-&gt; (Either Text p
    -&gt; Contract
         (Last (Either Text UserContractState))
         ('R
            '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
               &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
               &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
               &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
               &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
         Void
         ())
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680985937"><span class="annot"><span class="annottext">Either Text p
</span><a href="#local-6989586621680985937"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>        </span><span id="local-6989586621680985936"><span class="annot"><span class="annottext">Either Text a
</span><a href="#local-6989586621680985936"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Text
 -&gt; Contract
      (Last (Either Text UserContractState))
      ('R
         '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
            &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
            &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
            &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
            &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
      Void
      (Either Text a))
-&gt; (p
    -&gt; Contract
         (Last (Either Text UserContractState))
         ('R
            '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
               &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
               &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
               &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
               &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
         Void
         (Either Text a))
-&gt; Either Text p
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     (Either Text a)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either Text a
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     (Either Text a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either Text a
 -&gt; Contract
      (Last (Either Text UserContractState))
      ('R
         '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
            &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
            &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
            &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
            &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
      Void
      (Either Text a))
-&gt; (Text -&gt; Either Text a)
-&gt; Text
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     (Either Text a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text a
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Contract
  (Last (Either Text UserContractState))
  ('R
     '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
        &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
        &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
        &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
        &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
  Text
  a
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     (Either Text a)
forall w (s :: Row *) e e0 a.
Contract w s e a -&gt; Contract w s e0 (Either e a)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">runError</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract
   (Last (Either Text UserContractState))
   ('R
      '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
         &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
         &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
         &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
         &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
         &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
         &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
         &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
   Text
   a
 -&gt; Contract
      (Last (Either Text UserContractState))
      ('R
         '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
            &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
            &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
            &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
            &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
      Void
      (Either Text a))
-&gt; (p
    -&gt; Contract
         (Last (Either Text UserContractState))
         ('R
            '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
               &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
               &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
               &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
               &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
         Text
         a)
-&gt; p
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     (Either Text a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
-&gt; p
-&gt; Contract
     (Last (Either Text UserContractState)) UniswapUserSchema Text a
</span><a href="#local-6989586621680985939"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Uniswap
</span><a href="#local-6989586621680985947"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either Text p
</span><a href="#local-6989586621680985937"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><span class="annottext">Last (Either Text UserContractState)
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">(Last (Either Text UserContractState)
 -&gt; Contract
      (Last (Either Text UserContractState))
      ('R
         '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
            &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
            &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
            &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
            &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
      Void
      ())
-&gt; Last (Either Text UserContractState)
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either Text UserContractState)
-&gt; Last (Either Text UserContractState)
forall a. Maybe a -&gt; Last a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Last</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either Text UserContractState)
 -&gt; Last (Either Text UserContractState))
-&gt; Maybe (Either Text UserContractState)
-&gt; Last (Either Text UserContractState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either Text UserContractState
-&gt; Maybe (Either Text UserContractState)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Either Text UserContractState
 -&gt; Maybe (Either Text UserContractState))
-&gt; Either Text UserContractState
-&gt; Maybe (Either Text UserContractState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Text a
</span><a href="#local-6989586621680985936"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-544"></span><span>            </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680985934"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680985934"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text UserContractState
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680985934"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-545"></span><span>            </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680985933"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985933"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UserContractState -&gt; Either Text UserContractState
forall a b. b -&gt; Either a b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(UserContractState -&gt; Either Text UserContractState)
-&gt; UserContractState -&gt; Either Text UserContractState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; UserContractState
</span><a href="#local-6989586621680985940"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680985933"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>    </span><span class="annot"><a href="#local-6989586621680985946"><span class="hs-identifier hs-type">stop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Promise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/71gg7bx8f4jr17lsf2w77qrjmdg3xvan-text-lib-text-1.2.4.1-haddock-doc/share/doc/text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UserContractState"><span class="hs-identifier hs-type">UserContractState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.Uniswap.OffChain.html#UniswapUserSchema"><span class="hs-identifier hs-type">UniswapUserSchema</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>    </span><span id="local-6989586621680985946"><span class="annot"><span class="annottext">stop :: Promise
  (Last (Either Text UserContractState)) UniswapUserSchema Void ()
</span><a href="#local-6989586621680985946"><span class="hs-identifier hs-var hs-var">stop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e1 e2 b.
(HasEndpoint &quot;stop&quot; a s, AsContractError e1, FromJSON a) =&gt;
(Either e1 a -&gt; Contract w s e2 b) -&gt; Promise w s e2 b
forall (l :: Symbol) a w (s :: Row *) e1 e2 b.
(HasEndpoint l a s, AsContractError e1, FromJSON a) =&gt;
(Either e1 a -&gt; Contract w s e2 b) -&gt; Promise w s e2 b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">handleEndpoint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;stop&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Either Text ()
  -&gt; Contract
       (Last (Either Text UserContractState))
       ('R
          '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
             &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
             &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
             &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
             &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
             &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
             &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
             &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
       Void
       ())
 -&gt; Promise
      (Last (Either Text UserContractState))
      ('R
         '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
            &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
            &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
            &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
            &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
      Void
      ())
-&gt; (Either Text ()
    -&gt; Contract
         (Last (Either Text UserContractState))
         ('R
            '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
               &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
               &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
               &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
               &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
         Void
         ())
-&gt; Promise
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680985932"><span class="annot"><span class="annottext">Either Text ()
</span><a href="#local-6989586621680985932"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>        </span><span class="annot"><span class="annottext">Last (Either Text UserContractState)
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">(Last (Either Text UserContractState)
 -&gt; Contract
      (Last (Either Text UserContractState))
      ('R
         '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
            &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
            &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
            &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
            &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
            &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
      Void
      ())
-&gt; Last (Either Text UserContractState)
-&gt; Contract
     (Last (Either Text UserContractState))
     ('R
        '[ &quot;add&quot; ':-&gt; (EndpointValue AddParams, ActiveEndpoint),
           &quot;close&quot; ':-&gt; (EndpointValue CloseParams, ActiveEndpoint),
           &quot;create&quot; ':-&gt; (EndpointValue CreateParams, ActiveEndpoint),
           &quot;funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;pools&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;remove&quot; ':-&gt; (EndpointValue RemoveParams, ActiveEndpoint),
           &quot;stop&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;swap&quot; ':-&gt; (EndpointValue SwapParams, ActiveEndpoint)])
     Void
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either Text UserContractState)
-&gt; Last (Either Text UserContractState)
forall a. Maybe a -&gt; Last a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Last</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Either Text UserContractState)
 -&gt; Last (Either Text UserContractState))
-&gt; Maybe (Either Text UserContractState)
-&gt; Last (Either Text UserContractState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either Text UserContractState
-&gt; Maybe (Either Text UserContractState)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Either Text UserContractState
 -&gt; Maybe (Either Text UserContractState))
-&gt; Either Text UserContractState
-&gt; Maybe (Either Text UserContractState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Text ()
</span><a href="#local-6989586621680985932"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-550"></span><span>            </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680985931"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680985931"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text UserContractState
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680985931"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-551"></span><span>            </span><span class="annot"><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UserContractState -&gt; Either Text UserContractState
forall a b. b -&gt; Either a b
</span><a href="../file:///nix/store/sc7phsrhp1xzn7n38mdjvapkbif3753i-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">UserContractState
</span><a href="Plutus.Contracts.Uniswap.OffChain.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span><span>
</span><span id="line-552"></span></pre></body></html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What is the order book pattern? &mdash; Plutus Tools SDK User Guide 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tutorials" href="../tutorials/index.html" />
    <link rel="prev" title="What is the PAB?" href="pab.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #fcfcfc" >
            <a href="../../index.html" class="icon icon-home"> Plutus Tools SDK User Guide
            <img src="../../_static/cardano-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Explore Plutus</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Explanations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plutus-tools-component-descriptions.html">Plutus tools in development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plutus-tools-component-descriptions.html#logical-components">Logical components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#marconi">1. Marconi</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#plutus-use-case-examples">2. Plutus use case examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#pab-plutus-application-backend">3. PAB (Plutus application backend)</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#contract-monad-emulator">4. Contract monad emulator</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#plutus-contract-model-testing">5. Plutus contract model testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#plutus-contract-state-machine">6. Plutus contract state machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#contract-api-also-known-as-contract-monad">7. Contract API (also known as Contract monad)</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#plutus-chain-index">8. Plutus chain index</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#plutus-ledger-constraints">9. Plutus ledger constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#plutus-tx-constraints">10. Plutus Tx constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#id10">11. Plutus ledger</a></li>
<li class="toctree-l4"><a class="reference internal" href="plutus-tools-component-descriptions.html#plutus-script-utils">12. Plutus script utils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rollback.html">What is a rollback?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rollback.html#what-does-this-mean-for-dapps">What does this mean for dapps?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pab.html">What is the PAB?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pab.html#client-interface">Client interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="pab.html#other-components">Other components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pab.html#chain-index">Chain index</a></li>
<li class="toctree-l4"><a class="reference internal" href="pab.html#alonzo-node">Alonzo node</a></li>
<li class="toctree-l4"><a class="reference internal" href="pab.html#wallet">Wallet</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pab.html#deployment-scenarios">Deployment Scenarios</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pab.html#hosted">Hosted</a></li>
<li class="toctree-l4"><a class="reference internal" href="pab.html#in-browser">In-browser</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">What is the order book pattern?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-distributed-exchange">Example: Distributed exchange</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#orders-and-plutus-scripts">Orders and Plutus scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decentralisation">Decentralisation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#generalising-the-pattern">Generalising the pattern</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#off-chain-oracles">Off-chain oracles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#on-chain-oracles">On-chain oracles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#state-machines">State machines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic-apps.html">Writing a basic Plutus app in an emulated environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/basic-apps.html#defining-the-types">Defining the types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/basic-apps.html#instances-for-data-types">Instances for data types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/basic-apps.html#defining-the-validator-script">Defining the validator script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/basic-apps.html#asking-for-input">Asking for input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/basic-apps.html#locking-the-funds">Locking the funds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/basic-apps.html#unlocking-the-funds">Unlocking the funds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/basic-apps.html#running-the-app-on-the-plutus-apps-emulator">Running the app on the Plutus apps emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/basic-apps.html#exercise">Exercise</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic-apps-constraints.html">Extending the basic Plutus app with the constraints API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/contract-testing.html">Property-based testing of Plutus contracts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-testing.html#an-overview-of-the-guessing-game">An overview of the guessing game</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#emulated-wallets">Emulated wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#values-and-tokens">Values and <span class="xref std std-term">tokens</span></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-testing.html#introducing-contract-models">Introducing contract models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#generating-actions">Generating actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#modelling-expectations">Modelling expectations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#restricting-test-cases-with-preconditions">Restricting test cases with preconditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#performing-actions">Performing actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#shrinking-actions">Shrinking Actions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-testing.html#debugging-the-model">Debugging the model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#adding-delays-to-test-cases">Adding delays to test cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#rerunning-a-failed-test">Rerunning a failed test</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#controlling-the-log-level">Controlling the log-level</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#refining-preconditions">Refining preconditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-testing.html#measuring-and-tuning-distributions">Measuring and tuning distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#custom-generators-vs-preconditions">Custom generators vs preconditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#instrumenting-contract-models-to-gather-statistics">Instrumenting contract models to gather statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-testing.html#goal-directed-testing-with-dynamic-logic">Goal-directed testing with dynamic logic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#introducing-the-dynamic-logic-monad">Introducing the dynamic logic monad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#quantifiers-in-dynamic-logic">Quantifiers in dynamic logic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#repeating-a-dynamic-logic-test">Repeating a dynamic logic test</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#something-good-is-always-possible">Something good is always possible</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#monitoring-and-tuning-dynamic-logic-tests">Monitoring and tuning dynamic logic tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#more-dynamic-logic">More dynamic logic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-testing.html#limitations">Limitations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#testing-only-via-contract-endpoints">Testing only via <span class="xref std std-term">contract endpoints</span></a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#test-assumptions-on-timing">Test assumptions on timing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-testing.html#testing-for-information-leaks">Testing for information leaks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-testing.html#further-examples">Further Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/contract-models.html">Testing Plutus Contracts with Contract Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#basic-contract-models">Basic Contract Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#example-a-simple-escrow-contract">Example: A Simple Escrow Contract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#the-contract-model-type">The Contract Model Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#what-contracts-shall-we-test">What contracts shall we test?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#what-actions-should-tests-perform">What actions should tests perform?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#generating-actions">Generating Actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#running-tests-and-debugging-the-model">Running tests and debugging the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#analysing-the-distribution-of-tests">Analysing the distribution of tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#parameterising-models-and-dynamic-contract-instances">Parameterising Models and Dynamic Contract Instances</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#adding-an-initial-action-and-test-case-phases">Adding an initial action, and test case phases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#dynamic-contract-instances">Dynamic contract instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#running-our-extended-tests-another-design-issue">Running our extended tests; another design issue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#id3">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#testing-no-locked-funds-with-dynamic-logic">Testing “No Locked Funds” with Dynamic Logic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#writing-and-testing-properties-using-dynamic-logic">Writing and testing properties using Dynamic Logic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#digression-revisiting-a-design-decision">Digression: revisiting a design decision</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#fair-s-fair-unilateral-strategies">Fair’s fair: Unilateral strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#fixing-the-contract-refunds">Fixing the contract: refunds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#id4">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#taking-time-into-account">Taking Time into Account</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#slots-and-posixtime">Slots and POSIXTime</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#initialising-the-deadline">Initialising the deadline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#modelling-the-passage-of-time">Modelling the passage of time</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#monitoring-and-the-distribution-of-tests">Monitoring and the distribution of tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#no-locked-funds">No locked funds?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#digression-testing-the-model-alone-for-speed">Digression: testing the model alone for speed</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#id5">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#measuring-coverage-of-on-chain-code">Measuring coverage of on-chain code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#adding-a-coverage-index">Adding a coverage index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#measuring-coverage">Measuring coverage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#interpreting-the-coverage-annotations">Interpreting the coverage annotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#the-generated-coverage-report">The generated coverage report</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#crashes-and-how-to-tolerate-them">Crashes, and how to tolerate them</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#id6">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#debugging-the-auction-contract-with-model-assertions">Debugging the Auction contract with model assertions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#modelling-the-auction-contract">Modelling the Auction contract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#id7">No locked funds?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#model-assertions-and-unexpected-expectations">Model assertions, and unexpected expectations.</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#crashing-the-auction">Crashing the auction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#coverage-of-the-auction-contract">Coverage of the Auction contract</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#id8">Exercises</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/contract-models.html#becoming-level-1-certification-ready">Becoming Level 1 Certification Ready</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/contract-models.html#id9">Exercises</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/index.html">How-to guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../howtos/getting-started.html">How to get started with the Plutus Platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../howtos/getting-started.html#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../howtos/writing-a-scalable-app.html">How to write a scalable Plutus app</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#the-building-blocks">The building blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#transaction-outputs">Transaction outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#state-of-transaction-outputs">State of transaction outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#changing-the-state-of-our-app">Changing the state of our app</a></li>
<li class="toctree-l4"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#minting-policy-scripts">Minting Policy Scripts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#scalability-guidelines">Scalability guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#decentralised-exchange">Decentralised exchange</a></li>
<li class="toctree-l4"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#marlowe">Marlowe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../howtos/writing-a-scalable-app.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../howtos/handling-blockchain-events.html">How to handle blockchain events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../howtos/handling-blockchain-events.html#transaction-output-lifecycle">Transaction output lifecycle</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../howtos/handling-blockchain-events.html#transaction-states">Transaction states</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../howtos/handling-blockchain-events.html#pab-functions-for-listening-to-state-changes">PAB functions for listening to state changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../howtos/analysing-scripts.html">How to analyse the cost and size of Plutus scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../howtos/analysing-scripts.html#resource-use-of-plutus-scripts">Resource use of Plutus scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../howtos/analysing-scripts.html#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../howtos/analysing-scripts.html#validator-scripts">Validator scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../howtos/analysing-scripts.html#partial-transactions">Partial transactions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../howtos/plutus-spending-script-example.html">Plutus Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../howtos/plutus-spending-script-example.html#what-is-a-plutus-spending-script">What is a Plutus spending script?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../howtos/plutus-spending-script-example.html#an-example-of-using-a-plutus-spending-script">An example of using a Plutus spending script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#error-codes">Error codes</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architectural decision records</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../adr/index.html">Architectural Decision Records</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0001-record-architecture-decisions.html">ADR 1: Record architectural decisions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0001-record-architecture-decisions.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0001-record-architecture-decisions.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0001-record-architecture-decisions.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0001-record-architecture-decisions.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0001-record-architecture-decisions.html#implications">Implications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0001-record-architecture-decisions.html#adr-template">ADR template</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0002-repository-standardization.html">ADR 2: Repository Standardization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0002-repository-standardization.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0002-repository-standardization.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0002-repository-standardization.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0002-repository-standardization.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0002-repository-standardization.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0002-repository-standardization.html#implications">Implications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0003-marconi-monorepo.html">ADR 3: Move Marconi into a separate repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0003-marconi-monorepo.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0003-marconi-monorepo.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0003-marconi-monorepo.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0003-marconi-monorepo.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0003-marconi-monorepo.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0003-marconi-monorepo.html#related-decisions">Related Decisions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0004-marconi-initiative.html">ADR 4: Making a case for Marconi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#design-principles-of-marconi">Design principles of Marconi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#indexing-solution">Indexing solution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#query-and-storage">Query and storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#identification-of-events">Identification of events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0004-marconi-initiative.html#event-streams">Event streams</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html">ADR 5: PAB and indexing component integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#decisions">Decisions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#alternative-solutions">Alternative solutions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#make-sure-all-components-are-in-sync">Make sure all components are in sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#add-indexing-specific-functions-in-the-contract-api">Add indexing specific functions in the Contract API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#query-functions-should-interact-with-a-single-source-of-truth">Query functions should interact with a single source of truth</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0005-pab-indexing-solution-integration.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0006-common-contract-api.html">ADR 6: Common Contract API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0006-common-contract-api.html#authors">Authors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0006-common-contract-api.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0006-common-contract-api.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0006-common-contract-api.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0006-common-contract-api.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0006-common-contract-api.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0006-common-contract-api.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0007-support-reference-inputs-in-constraint-library.html">ADR 7: Support reference inputs in constraint library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0007-support-reference-inputs-in-constraint-library.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0007-support-reference-inputs-in-constraint-library.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0007-support-reference-inputs-in-constraint-library.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0007-support-reference-inputs-in-constraint-library.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0007-support-reference-inputs-in-constraint-library.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0007-support-reference-inputs-in-constraint-library.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0008-support-inline-datums-in-constraint-library.html">ADR 8: Support inline datums in constraint library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0008-support-inline-datums-in-constraint-library.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0008-support-inline-datums-in-constraint-library.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0008-support-inline-datums-in-constraint-library.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0008-support-inline-datums-in-constraint-library.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0008-support-inline-datums-in-constraint-library.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0008-support-inline-datums-in-constraint-library.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0009-support-reference-scripts-in-constraint-library.html">ADR 9: Support reference scripts in constraint library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0009-support-reference-scripts-in-constraint-library.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0009-support-reference-scripts-in-constraint-library.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0009-support-reference-scripts-in-constraint-library.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0009-support-reference-scripts-in-constraint-library.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0009-support-reference-scripts-in-constraint-library.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0009-support-reference-scripts-in-constraint-library.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html">ADR 10: Rolling back on-disk data for Marconi indexers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#decision">Decision</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#events">Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#queries">Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#api-design">API Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0010-marconi-indexer-rollbacks.html#implementation">Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html">ADR 11: Support return and total collateral when building transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html#alternatives">Alternatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0011-support-return-and-total-collateral-when-building-transactions.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html">ADR 12: Commit to data types in cardano-api</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#alternatives">Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#define-our-own-data-types-for-off-chain-use">Define our own data types for off-chain use</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0012-commit-to-data-types-in-cardano-api.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html">ADR 13: Transaction validity time range fix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#alternatives">Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#add-mustvalidateinslotrange-constraint">Add <code class="docutils literal notranslate"><span class="pre">MustValidateInSlotRange</span></code> constraint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#remove-mustvalidateintimerange">Remove <code class="docutils literal notranslate"><span class="pre">mustValidateInTimeRange</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#alter-mustvalidateintimerange">Alter <code class="docutils literal notranslate"><span class="pre">mustValidateInTimeRange</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0013-tx-validity-time-range-fix.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0014-marconi-query-interface.html">ADR 14: Marconi Query Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0014-marconi-query-interface.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0014-marconi-query-interface.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0014-marconi-query-interface.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0014-marconi-query-interface.html#decision">Decision</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0014-marconi-query-interface.html#implications">Implications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0015-time-conversion.html">ADR 15: Time conversion semantic change</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#implications">Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#alternatives">Alternatives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0015-time-conversion.html#changing-the-representation-of-slotconfig-to-the-correct-one">Changing the representation of <code class="docutils literal notranslate"><span class="pre">SlotConfig</span></code> to the correct one</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0015-time-conversion.html#directly-use-epochinfo-in-the-emulator-and-contract-api">Directly use EpochInfo in the emulator and Contract API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0015-time-conversion.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0016-cardano-node-emulator.html">ADR 16: Self-contained cardano-node emulator component</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0016-cardano-node-emulator.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0016-cardano-node-emulator.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0016-cardano-node-emulator.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0016-cardano-node-emulator.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0016-cardano-node-emulator.html#argument">Argument</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0016-cardano-node-emulator.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html">ADR 17: End-to-end testing strategy for Plutus, cardano-ledger-api and cardano-node-client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#author-s">Author(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#decision">Decision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#types-of-plutus-tests-for-the-plutus-e2e-tests-haskell-framework">Types of Plutus tests for the <code class="docutils literal notranslate"><span class="pre">plutus-e2e-tests</span></code> Haskell framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#argument">Argument</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#pros-of-building-and-maintaining-our-own-test-framework">Pros of building and maintaining our own test framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#cons-of-building-and-maintaining-our-own-test-framework">Cons of building and maintaining our own test framework</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#additional-considerations">Additional Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#alternatives">Alternatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#notes">Notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../adr/0017-end-to-end-testing-strategy.html#other-places-spinning-up-a-local-testnet">Other places spinning up a local testnet</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/cost-model-parameters.html">Cost model parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/bibliography.html">Bibliography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/index.html#elsewhere">Elsewhere</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #fcfcfc" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Plutus Tools SDK User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Explanations</a> &raquo;</li>
      <li>What is the order book pattern?</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/input-output-hk/plutus/blob/master/doc/plutus/explanations/order-book-pattern.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="what-is-the-order-book-pattern">
<span id="id1"></span><h1>What is the order book pattern?<a class="headerlink" href="#what-is-the-order-book-pattern" title="Permalink to this heading"></a></h1>
<p>The order book pattern is a way of organising distributed applications on <a class="reference internal" href="../../reference/glossary.html#term-Cardano"><span class="xref std std-term">Cardano</span></a>.
The key idea of the order book pattern is to materialise <em>actions</em> that act on some state as <a class="reference internal" href="../../reference/glossary.html#term-UTXO"><span class="xref std std-term">UTXOs</span></a> on the <a class="reference internal" href="../../reference/glossary.html#term-ledger"><span class="xref std std-term">ledger</span></a>, separating them from the state they act on.
The spending of those UTXOs (applying the action to the state) can be performed by an untrusted third party.
The pattern is helpful for designing applications that follow the <a class="reference internal" href="../howtos/writing-a-scalable-app.html#scalability-guidelines"><span class="std std-ref">Scalability guidelines</span></a>.</p>
<section id="example-distributed-exchange">
<h2>Example: Distributed exchange<a class="headerlink" href="#example-distributed-exchange" title="Permalink to this heading"></a></h2>
<p>This is the example that gives the order book its name.
A distributed exchange is an app that lets users trade <a class="reference internal" href="../../reference/glossary.html#term-currency"><span class="xref std std-term">currency</span></a> values in a decentralised fashion, without a central broker.
At the heart of this app is the order book, a list of open buy and sell offers for specific amounts of currency.
Every buy order needs to be matched with a sell order.</p>
<p><strong>Example 1:</strong> “Buy 2000 PEAR at 15.00 ADA”, “Sell 2000 PEAR at 14.95 ADA” are buy and sell orders for PEAR <a class="reference internal" href="../../reference/glossary.html#term-token"><span class="xref std std-term">tokens</span></a>.
In this example, the quantities (2000 units) are identical, and the sell price is lower then the buy price, so we could match the two orders directly and keep the difference between buy and sell price as a fee.</p>
<p><strong>Example 2:</strong> “Buy 2000 PEAR at 15.00 ADA”, “Sell 1500 PEAR at 14.95 ADA”.
In this case we need to find at least one other sell order for 500 PEAR to make the quantities match up, for example “Sell 500 PEAR at 14.99”.
But this isn’t the only solution to the problem:
Maybe we can find another buy order and a bigger sell order, so that we can resolve four orders simultaneously.</p>
<p>The example illustrates where the complexity lies in the order book system:
In finding and matching orders in a way that is profitable for the match maker (broker).</p>
<section id="orders-and-plutus-scripts">
<h3>Orders and Plutus scripts<a class="headerlink" href="#orders-and-plutus-scripts" title="Permalink to this heading"></a></h3>
<p>The order book lends itself to a nice representation in the EUTXO model.
Every order is a single UTXO, and matching a set of orders means building a transaction that spends the relevant UTXOs.
The UTXOs are script UTXOs with a known address and a datum value that holds the quoted price and some bookkeeping information (for example, an address to pay the money to, and an expiration date).
The currency value locked in the UTXO is the “inverse” of the order.</p>
<p><strong>Example 3:</strong> “Buy 2000 PEAR at 15.00 ADA” results in a script UTXO with 2000 * 15 = 30,000 ADA. “Sell 2000 PEAR at 14.95 ADA” gives a UTXO with 2000 PEAR tokens.
The match maker can build a transaction that spends the two UTXOs, pays 2000 PEAR tokens to the buyer, 29,000 ADA to the seller and the difference (100 ADA) to the match maker without ever owning any PEAR tokens.</p>
</section>
<section id="decentralisation">
<h3>Decentralisation<a class="headerlink" href="#decentralisation" title="Permalink to this heading"></a></h3>
<p>It is clear that the match maker is a crucial component of the system.
Without someone monitoring the script address and building transactions that match buy orders with sell orders, the orders will never be fulfilled.
How can we make sure that the match maker does not become too powerful or too centralised?</p>
<p>We can achieve decentralisation by open-sourcing the scripts that lock the order outputs.
With this code available to the public, anyone can build and run a match-making service and earn fees from matching buy and sell orders.
There could even be a specialised <a class="reference internal" href="../../reference/glossary.html#term-pab"><span class="xref std std-term">PAB</span></a> available for download somewhere that only runs the match making service, allowing non-programmer users to run nodes for the DEX.</p>
<p>There is no risk of tokens being stolen because the Plutus script ensures that the outputs can only be spent if the order is met exactly as specified.
And while it is possible that the spending transactions suffer from <a class="reference internal" href="../../reference/glossary.html#term-utxo-congestion"><span class="xref std std-term">UTXO congestion</span></a> (if multiple transactions that match a particular order are submitted), this does not have a negative impact on the user experience, because the buyer or seller does not care which particular match maker ends up fulfilling their order.
In fact, match makers are incentivised to compete by providing faster fulfilment of orders, which actually results in a better outcome for end users.</p>
</section>
</section>
<section id="generalising-the-pattern">
<h2>Generalising the pattern<a class="headerlink" href="#generalising-the-pattern" title="Permalink to this heading"></a></h2>
<p>The original application matches buyers and sellers of currency values, but there are other areas where the pattern is useful.</p>
<section id="off-chain-oracles">
<h3>Off-chain oracles<a class="headerlink" href="#off-chain-oracles" title="Permalink to this heading"></a></h3>
<p>Imagine a Plutus script that says “If you give me the current USD/EUR exchange rate signed by a specific private key, then I will pay you 5 ADA (and use the exchange rate to run the rest of my <cite>$BUSINESS_LOGIC</cite>)”.
The match maker then builds a transaction that combines the oracle value with the Plutus script.
Of course this example requires the match maker to be able to obtain the signed value, but it does succeed in decoupling consumers of the information from  producers.</p>
</section>
<section id="on-chain-oracles">
<h3>On-chain oracles<a class="headerlink" href="#on-chain-oracles" title="Permalink to this heading"></a></h3>
<p>The pattern could also be a building block for on-chain oracles.</p>
<p>Let’s say we have a crypto-backed stablecoin, not too dissimilar to <a class="reference external" href="https://iohk.io/en/blog/posts/2021/08/18/djed-implementing-algorithmic-stablecoins-for-proven-price-stability/">Djed</a>, that relies on recent quotes of the exchange rate between Ada and PEAR tokens.
And we have a DEX like the one described above where Ada and PEAR are actively traded.
Every order fulfilled on the DEX gives us a snapshot of the exchange rate at that time.
Example 1 from above would result in “15.00 ADA / PEAR” (using the buy price here but that’s just a technicality).</p>
<p>This is exactly the information that we need for our dealings with the stablecoin, but how do we get it from the DEX to the stablecoin?
There are two options.
To choose the right one we need to consider the requirement and usage patterns of our application.</p>
<section id="oracle-utxos">
<h4>1. Oracle UTXOs<a class="headerlink" href="#oracle-utxos" title="Permalink to this heading"></a></h4>
<p>We could change the DEX contract to produce a new script UTXO for each fulfilled order that records the time and exchange rate of the order.
The stablecoin user creates a UTXO with a script that requires an oracle UTXO to be present in the spending transaction, and the match maker would put the oracle UTXO and the stablecoin-action UTXO into one transaction and submit it.</p>
</section>
<section id="oracle-tokens">
<h4>2. Oracle tokens<a class="headerlink" href="#oracle-tokens" title="Permalink to this heading"></a></h4>
<p>In a variation of the first idea, the DEX could produce <em>tokens</em> that encode the script-certified information we are interested in.
We could set the asset name of the token to be the hash of the exchange rate data, and allow the transaction to produce any quantitiy of these tokens when the order is fulfilled.</p>
<p>The <a class="reference internal" href="../../reference/glossary.html#term-minting-policy-script"><span class="xref std std-term">minting policy</span></a> of the oracle token should allow any number of tokens of the same asset name to be created as long as at least one token with that asset name exists already, reflecting the idea that information is hard to obtain but easy to replicate.</p>
<p>The consumer of the oracle token needs to check that a token with the expected minting policy hash is present in the transaction, and that the datum value of the token’s asset name is available.
Then it can use the information from the datum.
Maybe it could even destroy the token when it has been used.</p>
<p>This approach has the advantage of not clogging up the UTXO set too much, but the big question here is:
How do we make the oracle token available to the match maker?
It has to be stored in an output that the match maker can spend.
The solution depends on the project.
There is no general solution (yet) and some experimentation and research is needed.
Perhaps the tokenomics of the exchange could have incentives to make this information flow to where it is needed.</p>
</section>
</section>
<section id="state-machines">
<h3>State machines<a class="headerlink" href="#state-machines" title="Permalink to this heading"></a></h3>
<p>State machines are a way of modeling smart contracts that is easy to understand and reason about.
However, in their basic formulation they keep the entire state of each individual execution in a single UTXO, which puts them at risk of UTXO congestion caused by multiple users trying to transition the instance to a new state at the same time.</p>
<p>If we can batch multiple transitions into one (for example, by finding a suitable <cite>Semigroup</cite> instance for the state machine’s input type) then we could use the order book pattern to allow a number of users to submit transitions <em>without spending the UTXO</em> with the state machine instance’s state.
The match maker would construct a transaction that applies the sum of all proposed transitions in a single step.
IOG is actively pursuing research in this area.</p>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading"></a></h2>
<p>In the order book pattern we materialise <em>actions</em> as transaction outputs on the ledger, separating them from the state that they act on.
The pattern is attractive because it decouples submission of orders (actions, requests for oracle values, etc) from fulfilling them, and because it enables order fulfilment to be run in a fully decentralised, trustless fashion.
At the same time it fits the UTXO model very well, because it reduces the number of data dependencies on a single unspent output.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pab.html" class="btn btn-neutral float-left" title="What is the PAB?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tutorials/index.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1980, IOHK.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
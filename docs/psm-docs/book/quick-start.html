<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Quick start - Plutus-simple-model tutorial</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="quick-start.html" class="active"><strong aria-hidden="true">3.</strong> Quick start</a></li><li class="chapter-item expanded "><a href="use-tasty.html"><strong aria-hidden="true">4.</strong> Testing with Tasty</a></li><li class="chapter-item expanded "><a href="create-tx.html"><strong aria-hidden="true">5.</strong> Creation of transactions</a></li><li class="chapter-item expanded "><a href="typed-validator.html"><strong aria-hidden="true">6.</strong> Typed validators</a></li><li class="chapter-item expanded "><a href="test-scripts.html"><strong aria-hidden="true">7.</strong> Test scripts</a></li><li class="chapter-item expanded "><a href="time.html"><strong aria-hidden="true">8.</strong> Work with time</a></li><li class="chapter-item expanded "><a href="logs.html"><strong aria-hidden="true">9.</strong> Using logs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="logs/log-debug.html"><strong aria-hidden="true">9.1.</strong> Log debug information</a></li><li class="chapter-item expanded "><a href="logs/log-error.html"><strong aria-hidden="true">9.2.</strong> Log custom errors</a></li><li class="chapter-item expanded "><a href="logs/skip-logs.html"><strong aria-hidden="true">9.3.</strong> How to skip messages from logs</a></li><li class="chapter-item expanded "><a href="logs/human-readable-names.html"><strong aria-hidden="true">9.4.</strong> Human readable names</a></li></ol></li><li class="chapter-item expanded "><a href="fake-coins.html"><strong aria-hidden="true">10.</strong> Custom coins</a></li><li class="chapter-item expanded "><a href="check-balance.html"><strong aria-hidden="true">11.</strong> Check balances</a></li><li class="chapter-item expanded "><a href="unit-tests.html"><strong aria-hidden="true">12.</strong> How to use in unit tests</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="unit-tests/negative.html"><strong aria-hidden="true">12.1.</strong> Write negative tests</a></li><li class="chapter-item expanded "><a href="unit-tests/custom-fail.html"><strong aria-hidden="true">12.2.</strong> Fail on a custom condition</a></li><li class="chapter-item expanded "><a href="unit-tests/check-budget.html"><strong aria-hidden="true">12.3.</strong> Check TX budget</a></li></ol></li><li class="chapter-item expanded "><a href="box.html"><strong aria-hidden="true">13.</strong> Box - a typed TxOut</a></li><li class="chapter-item expanded "><a href="staking.html"><strong aria-hidden="true">14.</strong> Staking and certificates</a></li><li class="chapter-item expanded "><a href="rewards.html"><strong aria-hidden="true">15.</strong> Certificates and withdrawals of the rewards</a></li><li class="chapter-item expanded "><a href="ledger-export.html"><strong aria-hidden="true">16.</strong> Ledger reexports</a></li><li class="chapter-item expanded "><a href="query.html"><strong aria-hidden="true">17.</strong> How to query Blockchain</a></li><li class="chapter-item expanded "><a href="plutus-v2.html"><strong aria-hidden="true">18.</strong> Plutus V2 features</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Plutus-simple-model tutorial</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="quick-start"><a class="header" href="#quick-start">Quick start</a></h1>
<p>We can create simple mock blockchain data structure and update within context of State monad.
Update happens as a pure function and along TX-confirmation we have useful stats to estimate usage of resources.
Internaly it uses <code>evaluateTransactionExecutionUnits</code> and <code>evaluateTransactionBalance</code> 
functions from <code>cardano-ledger</code> to check that TX is valid.</p>
<p>To create mock blockchain we first need to specify blockchain config (<code>MockConfig</code>).
Config is specified by protocol parameters (<code>PParams</code>) and era history (<code>EraHistory CardanoMode</code>).
They are cardano config data types. To avoid gory details it's safe to use predefined config
and default parameters for Alonzo era:</p>
<pre><code class="language-haskell">defaultAlonzo :: MockConfig
</code></pre>
<p>also we can use parameters for Babbage era:</p>
<pre><code class="language-haskell">defaultBabbage :: MockConfig
</code></pre>
<p>The parameters era determine which era is going to be used for TX-representation and validation checks.</p>
<p>Once we have config available we can create initial state for blockchain with function:</p>
<pre><code class="language-haskell">initMock :: MockConfig -&gt; Value -&gt; Mock
initMock config adminValue = ...
</code></pre>
<p>It creates blockchain that has only one UTXO that belongs to the admin user. The value is how many coins
we are going to give to the admin. Admin can distribute values to test users from admin's reserves.</p>
<p>The rest of the code happens within <code>Run</code> monad which is a thin wrapper on State over <code>Mock</code>-blockchain under the hood.
We have scenarios of script usages as actions in the <code>Run</code> monad. When we are done we can get the result:</p>
<pre><code class="language-haskell">runMock :: Run a -&gt; Mock -&gt; (a, Mock)
</code></pre>
<p>It just runs the state updates.</p>
<p>Let's create test users:</p>
<pre><code class="language-haskell">-- | alocate 3 users with 1000 lovelaces each
setupUsers :: Run [PubKeyHash]
setupUsers = replicateM 3 $ newUser $ adaValue 1000
</code></pre>
<p><code>adaValue</code> is standard function that creates singleton ada <code>Value</code> out of amount of <strong>lovelaces</strong>.
It's defined in the module <code>Plutus.Model.Ada</code>.
We can create new user and send values from admin to the user with the function:</p>
<pre><code class="language-haskell">newUser :: Value -&gt; Run PubKeyHash
</code></pre>
<p>Users are identified by their pub key hashes. Note that admin should have the value that we want to share
with new user. Otherwise we will get run-time exception.</p>
<p>Users can send values to each other with function:</p>
<pre><code class="language-haskell">sendValue :: PubKeyHash -&gt; Value -&gt; PubKeyHash -&gt; Run ()
</code></pre>
<p>Let's share some values:</p>
<pre><code class="language-haskell">simpleSpend :: Run Bool
simpleSpend = do
  users &lt;- setupUsers                -- create 3 users and assign each 1000 lovelaces
  let [u1, u2, u3] = users           -- give names for users
  sendValue u1 (adaValue 100) u2     -- send 100 lovelaces from user 1 to user 2
  sendValue u2 (adaValue 100) u3     -- send 100 lovelaces from user 2 to user 3
  isOk &lt;- noErrors                   -- check that all TXs were accepted without errors
  vals &lt;- mapM valueAt users         -- read user values
  pure $ and                         -- check test predicate
    [ isOk
     , vals == fmap adaValue [900, 1000, 1100]
    ]
</code></pre>
<p>This example shows how we can create simple tests with library.
We create three users and exchange the values between the users.
In the test we check that there are no errors (all TXs were accepted to blockchain) and
that users have expected values.</p>
<p>To check for TX errors we use:</p>
<pre><code class="language-haskell">noErrors :: Run Bool
</code></pre>
<p>Blockchain logs all failed transactions to the list <code>mockFails</code>. We check that this list is empty.</p>
<p>To read total value for the user we use:</p>
<pre><code class="language-haskell">valueAt :: HasAddress addr =&gt; addr -&gt; Run Value
</code></pre>
<p>Complete working example of user exchange can be found at test suites (see <code>Suites.Plutus.Model.User</code>)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="install.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="use-tasty.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="install.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="use-tasty.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
